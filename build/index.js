(()=>{var e={9791:e=>{"use strict";e.exports=JSON.parse('{"format":[[{"name":"index","size":1,"type":5123},{"name":"position","size":3,"type":5126,"normalized":false,"stride":24,"offset":0},{"name":"normal","size":3,"type":5122,"normalized":true,"stride":24,"offset":12},{"name":"uv","size":2,"type":5123,"normalized":true,"stride":24,"offset":20}],[{"name":"index","size":1,"type":5123},{"name":"position","size":3,"type":5126,"normalized":false,"stride":32,"offset":0},{"name":"normal","size":3,"type":5122,"normalized":true,"stride":32,"offset":12},{"name":"uv","size":2,"type":5123,"normalized":true,"stride":32,"offset":20},{"name":"joint","size":4,"type":5121,"normalized":false,"stride":32,"offset":24},{"name":"weight","size":4,"type":5121,"normalized":true,"stride":32,"offset":28}],[{"name":"index","size":1,"type":5123},{"name":"position","size":3,"type":5126,"normalized":false,"stride":32,"offset":0},{"name":"normal","size":3,"type":5122,"normalized":true,"stride":32,"offset":12},{"name":"uv","size":2,"type":5123,"normalized":true,"stride":32,"offset":20},{"name":"color","size":4,"type":5123,"normalized":true,"stride":32,"offset":24}]],"buffer":["assets/models.bin"],"texture":["assets/dock.png","assets/cube_0.png","assets/cube_1.png","assets/cube_2.png","assets/cube_3.png","assets/cube_x.png","assets/cube_4.png","assets/cube_5.png","assets/cube_6.png","assets/cube_7.png","assets/cube_8.png","assets/scarab.png","assets/tarantula.png","assets/obelisk.png","assets/monolith.png","assets/stingray.png","assets/locust.png","assets/decapod.png","assets/isopod.png"],"model":[{"name":"the_cube","texture":-1,"format":0,"indices":{"byteOffset":2,"byteLength":72},"vertices":{"byteOffset":76,"byteLength":576}},{"name":"dock","texture":0,"format":1,"indices":{"byteOffset":654,"byteLength":24696},"vertices":{"byteOffset":25352,"byteLength":192800},"inverseBindPose":{"byteOffset":218156,"byteLength":384},"armature":[{"name":"base","parent":-1},{"name":"frame","position":[0,1,0],"parent":0},{"name":"rod","rotation":[0,0,0,1],"position":[0,1,0],"parent":0},{"name":"lamp","position":[0,1,0],"parent":0},{"name":"handle","position":[0,2,0],"parent":0},{"name":"pump","position":[0,1,0],"parent":0}]},{"name":"cube_0","texture":1,"format":1,"indices":{"byteOffset":218542,"byteLength":6024},"vertices":{"byteOffset":224568,"byteLength":58240},"inverseBindPose":{"byteOffset":282812,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"gun","position":[0,1,0],"parent":0},{"name":"magazine","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-0.1,0.7,0],"parent":1},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.4,0.7,0],"parent":1},{"name":"cover_11","rotation":[1,0,0,0],"position":[0.6,2,-0.6],"parent":0},{"name":"cover_10","rotation":[1,0,0,0],"position":[0.6,2,0.6],"parent":0},{"name":"cover_00","rotation":[1,0,0,0],"position":[-0.6,2,0.6],"parent":0},{"name":"cover_01","rotation":[1,0,0,0],"position":[-0.6,2,-0.6],"parent":0}]},{"name":"cube_1","texture":2,"format":1,"indices":{"byteOffset":283326,"byteLength":7452},"vertices":{"byteOffset":290780,"byteLength":65952},"inverseBindPose":{"byteOffset":356736,"byteLength":576},"armature":[{"name":"base","parent":-1},{"name":"cover_left","position":[0,0.8,-1.3],"parent":0},{"name":"lamp_left","position":[-0.5,1.2,-0.2],"parent":1},{"name":"cover_right","position":[0,0.8,1.3],"parent":0},{"name":"lamp_right","position":[-0.5,1.2,0.2],"parent":3},{"name":"gun","position":[-0.4,0.7,0],"parent":0},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.7,0.7,0],"parent":5},{"name":"bridge","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.3,0.8,0],"parent":5},{"name":"slide","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,1,0],"parent":5}]},{"name":"cube_2","texture":3,"format":1,"indices":{"byteOffset":357314,"byteLength":14940},"vertices":{"byteOffset":372256,"byteLength":149728},"inverseBindPose":{"byteOffset":521988,"byteLength":448},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,1,-1],"parent":0},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,1,1],"parent":0},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[1,1,0],"parent":0},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-1,1,0],"parent":0},{"name":"top","position":[0,2,0],"parent":0},{"name":"lamp","position":[0,2,0],"parent":0}]},{"name":"cube_3","texture":4,"format":1,"indices":{"byteOffset":522438,"byteLength":11748},"vertices":{"byteOffset":534188,"byteLength":95904},"inverseBindPose":{"byteOffset":630096,"byteLength":384},"armature":[{"name":"base","parent":-1},{"name":"top","position":[0,1,0],"parent":0},{"name":"cap","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[0.7,4.4,0],"parent":1},{"name":"lamp_bottom","position":[0,1,0],"parent":1},{"name":"lamp_top","position":[0,2,0],"parent":1},{"name":"rod","position":[0,3,0],"parent":1}]},{"name":"death","texture":5,"format":1,"indices":{"byteOffset":630482,"byteLength":6048},"vertices":{"byteOffset":636532,"byteLength":66848},"inverseBindPose":{"byteOffset":703384,"byteLength":576},"armature":[{"name":"base","parent":-1},{"name":"part_100","position":[1.6,-0.6,1.6],"parent":0},{"name":"part_110","position":[1.6,-0.6,-1.6],"parent":0},{"name":"part_101","position":[1.6,2.6,1.6],"parent":0},{"name":"part_111","rotation":[0,0,0,1],"position":[1.6,2.6,-1.6],"parent":0},{"name":"part_000","position":[-1.6,-0.6,1.6],"parent":0},{"name":"part_010","position":[-1.6,-0.6,-1.6],"parent":0},{"name":"part_001","position":[-1.6,2.6,1.6],"parent":0},{"name":"part_011","rotation":[0,0,0,1],"position":[-1.6,2.6,-1.6],"parent":0}]},{"name":"cube_debris","texture":-1,"format":2,"indices":{"byteOffset":703962,"byteLength":2856},"vertices":{"byteOffset":706820,"byteLength":44128}},{"name":"cube_open","texture":5,"format":1,"indices":{"byteOffset":750950,"byteLength":16344},"vertices":{"byteOffset":767296,"byteLength":135648},"inverseBindPose":{"byteOffset":902948,"byteLength":320},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,2,-1],"parent":0},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"scale":[1,1,1],"position":[0,2,1],"parent":0},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"position":[1,2,0],"parent":0},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"position":[-1,2,0],"parent":0}]},{"name":"cube_4","texture":6,"format":1,"indices":{"byteOffset":903270,"byteLength":12714},"vertices":{"byteOffset":915988,"byteLength":100128},"inverseBindPose":{"byteOffset":1016120,"byteLength":448},"armature":[{"name":"base","parent":-1},{"name":"gun","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,1,0],"parent":0},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.6,1,0],"parent":0},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,1,-1],"parent":0},{"name":"lamp_left","rotation":[0.707107,0,0,0.707107],"position":[0.5,0.5,1],"parent":3},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,1,1],"parent":0},{"name":"lamp_right","rotation":[0,0.707107,0.707107,0],"position":[-0.5,0.5,1],"parent":5}]},{"name":"mine","texture":7,"format":0,"indices":{"byteOffset":1016570,"byteLength":1128},"vertices":{"byteOffset":1017700,"byteLength":6528}},{"name":"cube_5","texture":7,"format":1,"indices":{"byteOffset":1024230,"byteLength":14184},"vertices":{"byteOffset":1038416,"byteLength":136384},"inverseBindPose":{"byteOffset":1174804,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"side_01","position":[-1,0.5,-1],"parent":0},{"name":"side_00","position":[-1,0.5,1],"parent":0},{"name":"side_11","position":[1,0.5,-1],"parent":0},{"name":"side_10","position":[1,0.5,1],"parent":0},{"name":"cage","position":[0,1,0],"parent":0},{"name":"rod","position":[0,2,0],"parent":5},{"name":"top","position":[0,-1,0],"parent":0}]},{"name":"cube_6","texture":8,"format":1,"indices":{"byteOffset":1175318,"byteLength":24012},"vertices":{"byteOffset":1199332,"byteLength":217248},"inverseBindPose":{"byteOffset":1416584,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0,-1],"parent":0},{"name":"side_right","rotation":[0.707107,0,0,0.707107],"scale":[1,1,1],"position":[0,0,1],"parent":0},{"name":"top","position":[0,2,0],"parent":0},{"name":"cap","position":[0,1,0],"parent":3},{"name":"rod","position":[0,1,0],"parent":4},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[1,0,0],"parent":0},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-1,0,0],"parent":0}]},{"name":"cube_7","texture":9,"format":1,"indices":{"byteOffset":1417098,"byteLength":32328},"vertices":{"byteOffset":1449428,"byteLength":288480},"inverseBindPose":{"byteOffset":1737912,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"top","position":[0,2.8,0],"parent":0},{"name":"cage","position":[0,-1.2,0],"parent":1},{"name":"cap","position":[0,2.2,0],"parent":1},{"name":"side_11","rotation":[1,0,0,0],"position":[0.7,2.2,-0.7],"parent":0},{"name":"side_10","rotation":[1,0,0,0],"position":[0.7,2.2,0.7],"parent":0},{"name":"side_01","rotation":[1,0,0,0],"position":[-0.7,2.2,-0.7],"parent":0},{"name":"side_00","rotation":[1,0,0,0],"position":[-0.7,2.2,0.7],"parent":0}]},{"name":"cube_8","texture":10,"format":1,"indices":{"byteOffset":1738426,"byteLength":17976},"vertices":{"byteOffset":1756404,"byteLength":150048},"inverseBindPose":{"byteOffset":1906456,"byteLength":448},"armature":[{"name":"base","parent":-1},{"name":"top","position":[0,2.8,0],"parent":0},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0,-1.2],"parent":1},{"name":"gun_left","rotation":[0.707107,0,0,0.707107],"position":[0,1.1,1],"parent":2},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,0,1.2],"parent":1},{"name":"gun_right","rotation":[0,0.707107,0.707107,0],"position":[0,1.1,1],"parent":4},{"name":"cap","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,0,0],"parent":1}]},{"name":"missile","texture":10,"format":0,"indices":{"byteOffset":1906906,"byteLength":408},"vertices":{"byteOffset":1907316,"byteLength":2544}},{"name":"scarab","texture":11,"format":1,"indices":{"byteOffset":1909862,"byteLength":4284},"vertices":{"byteOffset":1914148,"byteLength":38304},"inverseBindPose":{"byteOffset":1952456,"byteLength":256},"armature":[{"name":"base","parent":-1},{"name":"jaw","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,0.5,0],"parent":0},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0.5,-0.2],"parent":0},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,0.5,0.2],"parent":0}]},{"name":"tarantula","texture":12,"format":1,"indices":{"byteOffset":1952714,"byteLength":26928},"vertices":{"byteOffset":1979644,"byteLength":242304},"inverseBindPose":{"byteOffset":2221952,"byteLength":832},"armature":[{"name":"base","parent":-1},{"name":"leg_01","rotation":[-0.325914,0.20498,0.20498,0.899859],"position":[-0.3,0.2,-0.3],"parent":0},{"name":"foot_01","rotation":[-0.746041,0.239051,-0.022346,0.62111],"scale":[1,1,1],"position":[0,0.994987,0],"parent":1},{"name":"leg_11","rotation":[-0.325914,-0.20498,-0.20498,0.899859],"position":[0.3,0.2,-0.3],"parent":0},{"name":"foot_11","rotation":[-0.746041,-0.239051,0.022346,0.62111],"scale":[1,1,1],"position":[0,0.994987,0],"parent":3},{"name":"leg_00","rotation":[0.146064,0.356233,0.356233,0.851388],"position":[-0.3,0.2,0.3],"parent":0},{"name":"foot_00","rotation":[0.743794,-0.663601,0.062032,0.050561],"scale":[1,1,1],"position":[0,0.994988,0],"parent":5},{"name":"leg_10","rotation":[0.146064,-0.356233,-0.356233,0.851388],"position":[0.3,0.2,0.3],"parent":0},{"name":"foot_10","rotation":[0.743794,0.663601,-0.062032,0.050561],"scale":[1,1,1],"position":[0,0.994988,0],"parent":7},{"name":"gun","position":[0,1.1,0],"parent":0},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.2,0.7,0],"parent":9},{"name":"cage","position":[0,1.1,0],"parent":0},{"name":"rod","position":[0,1.2,0],"parent":11}]},{"name":"obelisk","texture":13,"format":1,"indices":{"byteOffset":2222786,"byteLength":16872},"vertices":{"byteOffset":2239660,"byteLength":151392},"inverseBindPose":{"byteOffset":2391056,"byteLength":320},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0.4,-1],"parent":-1},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,0.4,1],"parent":-1},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"position":[1,0.4,0],"parent":-1},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"position":[-1,0.4,0],"parent":-1}]},{"name":"monolith","texture":14,"format":1,"indices":{"byteOffset":2391378,"byteLength":52338},"vertices":{"byteOffset":2443720,"byteLength":444928},"inverseBindPose":{"byteOffset":2888652,"byteLength":1152},"armature":[{"name":"base","parent":-1},{"name":"cover_left","rotation":[-0.707107,0,0,0.707107],"position":[0,2.7,-1],"parent":0},{"name":"cover_right","rotation":[0,0.707107,0.707107,0],"position":[0,2.7,1],"parent":0},{"name":"cover_back","rotation":[-0.5,0.5,0.5,0.5],"position":[-1,2.7,0],"parent":0},{"name":"cover_front","rotation":[-0.5,-0.5,-0.5,0.5],"position":[1,2.7,0],"parent":0},{"name":"rod","position":[0,3.5,0],"parent":0},{"name":"spawner_front","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[2,1,0],"parent":0},{"name":"spawner_left","rotation":[-0.707107,0,0,0.707107],"position":[0,1,-2],"parent":0},{"name":"spawner_right","rotation":[0,0.707107,0.707107,0],"position":[0,1,2],"parent":0},{"name":"spawner_back","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-2,1,0],"parent":0},{"name":"turret_11","rotation":[0,0.707107,0,0.707107],"scale":[1,1,1],"position":[2,1,-2],"parent":0},{"name":"barrel_11","rotation":[0,0.707107,0.707107,0],"position":[0,0,1],"parent":10},{"name":"turret_01","position":[2,1,2],"parent":0},{"name":"barrel_01","rotation":[0,0.707107,0.707107,0],"position":[0,0,1],"parent":12},{"name":"turret_00","rotation":[0,-0.707107,0,0.707107],"scale":[1,1,1],"position":[-2,1,2],"parent":0},{"name":"barrel_00","rotation":[0,0.707107,0.707107,0],"position":[0,0,1],"parent":14},{"name":"turret_10","rotation":[0,1,0,0],"position":[-2,1,-2],"parent":0},{"name":"barrel_10","rotation":[0,0.707107,0.707107,0],"position":[0,0,1],"parent":16}]},{"name":"stingray","texture":15,"format":1,"indices":{"byteOffset":2889806,"byteLength":9528},"vertices":{"byteOffset":2899336,"byteLength":73856},"inverseBindPose":{"byteOffset":2973196,"byteLength":448},"armature":[{"name":"base","rotation":[-0.5,-0.5,-0.5,0.5],"position":[0,1.3,0],"parent":-1},{"name":"jaw_left","position":[-0.5,1.8,0],"parent":0},{"name":"tail0","rotation":[0,0,1,0],"position":[0,-0.3,0],"parent":0},{"name":"tail1","position":[0,0.825,0],"parent":2},{"name":"tail2","rotation":[0,0,0,1],"position":[0,0.725,0],"parent":3},{"name":"tail3","rotation":[0,0,0,1],"position":[0,0.725,0],"parent":4},{"name":"jaw_right","position":[0.5,1.8,0],"parent":0}]},{"name":"locust","texture":16,"format":1,"indices":{"byteOffset":2973646,"byteLength":26688},"vertices":{"byteOffset":3000336,"byteLength":200800},"inverseBindPose":{"byteOffset":3201140,"byteLength":384},"armature":[{"name":"base","parent":-1},{"name":"cage","position":[-1.3,0.7,0],"parent":0},{"name":"rod","position":[0,1,0],"parent":1},{"name":"gun","rotation":[-0.5,-0.5,-0.5,0.5],"position":[2.5,1.4,0],"parent":0},{"name":"cover_right","position":[0.6,0.3,0.2],"parent":0},{"name":"cover_left","position":[0.6,0.3,-0.2],"parent":0}]},{"name":"decapod","texture":17,"format":1,"indices":{"byteOffset":3201526,"byteLength":15192},"vertices":{"byteOffset":3216720,"byteLength":114688},"inverseBindPose":{"byteOffset":3331412,"byteLength":320},"armature":[{"name":"base","parent":-1},{"name":"side_left","position":[0,0.7,-0.5],"parent":0},{"name":"side_right","position":[0,0.7,0.5],"parent":0},{"name":"gun","position":[0,1.8,0],"parent":0},{"name":"barrel","position":[0,1,0],"parent":3}]},{"name":"isopod","texture":18,"format":1,"indices":{"byteOffset":3331734,"byteLength":12084},"vertices":{"byteOffset":3343820,"byteLength":92896},"inverseBindPose":{"byteOffset":3436720,"byteLength":256},"armature":[{"name":"base","parent":-1},{"name":"cover","rotation":[-0.146447,0.353553,0.353553,0.853554],"scale":[1,1,1],"position":[0.4,1.1,0],"parent":0},{"name":"gun","rotation":[-0.5,-0.5,-0.5,0.5],"position":[0.5,0.7,0],"parent":0},{"name":"barrel","rotation":[0,0,0,1],"position":[0,0.7,0],"parent":2}]}]}')},7082:e=>{"use strict";e.exports=JSON.parse('{"dock":{"open":[{"index":1,"frame":0,"position":[0,0,0]},{"index":1,"frame":1,"position":[0,2,0],"ease":"quadInOut"},{"index":2,"frame":0,"position":[0,1,0]},{"index":2,"frame":1,"position":[0,0.1,0],"ease":"quadOut"},{"index":3,"frame":0,"position":[0,-0.5,0]},{"index":3,"frame":1,"position":[0,1,0],"ease":"quadInOut"},{"index":4,"frame":0,"position":[0,0,0]},{"index":5,"frame":0,"position":[0,0,0]},{"index":5,"frame":1,"position":[0,-1,0],"ease":"quadOut"}],"lift":[{"index":1,"frame":0,"position":[0,2,0]},{"index":1,"frame":0.5,"position":[0,0,0],"ease":"quadIn"},{"index":2,"frame":0.25,"position":[0,0.1,0]},{"index":2,"frame":1,"position":[0,1,0],"ease":"sineOut"},{"index":3,"frame":0,"position":[0,1,0]},{"index":3,"frame":0.75,"position":[0,0.5,0],"ease":"quadOut"},{"index":4,"frame":0,"position":[0,0,0]},{"index":4,"frame":1,"position":[0,2,0],"ease":"quadIn"},{"index":5,"frame":0.25,"position":[0,-1,0]},{"index":5,"frame":1,"position":[0,1,0],"ease":"sineOut"}]},"cube_open":{"close":[{"index":1,"frame":0,"rotation":[-1,0,0,0]},{"index":2,"frame":0,"rotation":[0,0,1,0]},{"index":3,"frame":0,"rotation":[-0.707107,0,-0.707107,0]},{"index":4,"frame":0,"rotation":[-0.707107,0,0.707107,0]}],"open":[{"index":1,"frame":0,"rotation":[-1,0,0,0]},{"index":1,"frame":1,"rotation":[-0.707107,0,0,0.707107],"ease":"quadOut"},{"index":2,"frame":0,"rotation":[0,0,1,0]},{"index":2,"frame":1,"rotation":[0,0.707107,0.707107,0],"ease":"quadOut"},{"index":3,"frame":0,"rotation":[-0.707107,0,-0.707107,0]},{"index":3,"frame":1,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quadOut"},{"index":4,"frame":0,"rotation":[-0.707107,0,0.707107,0]},{"index":4,"frame":1,"rotation":[-0.5,0.5,0.5,0.5],"ease":"quadOut"}]},"death":{"close":[{"index":1,"frame":0,"position":[0.6,0.4,0.6]},{"index":2,"frame":0,"position":[0.6,0.4,-0.6]},{"index":3,"frame":0,"position":[0.6,1.6,0.6]},{"index":4,"frame":0,"position":[0.6,1.6,-0.6]},{"index":5,"frame":0,"position":[-0.6,0.4,0.6]},{"index":6,"frame":0,"position":[-0.6,0.4,-0.6]},{"index":7,"frame":0,"position":[-0.6,1.6,0.6]},{"index":8,"frame":0,"position":[-0.6,1.6,-0.6]}],"open":[{"index":1,"frame":0.0125,"position":[0.6,0.4,0.6],"rotation":[0,0,0,1]},{"index":2,"frame":0.025,"position":[0.6,0.4,-0.6],"rotation":[0,0,0,1]},{"index":3,"frame":0.0375,"position":[0.6,1.6,0.6],"rotation":[0,0,0,1]},{"index":4,"frame":0.05,"position":[0.6,1.6,-0.6],"rotation":[0,0,0,1]},{"index":5,"frame":0.0625,"position":[-0.6,0.4,0.6],"rotation":[0,0,0,1]},{"index":6,"frame":0.075,"position":[-0.6,0.4,-0.6],"rotation":[0,0,0,1]},{"index":7,"frame":0.0875,"position":[-0.6,1.6,0.6],"rotation":[0,0,0,1]},{"index":8,"frame":0.1,"position":[-0.6,1.6,-0.6],"rotation":[0,0,0,1]},{"index":1,"frame":0.4,"position":[1.6,1.2,1.6],"ease":"cubicOut"},{"index":2,"frame":0.4,"position":[1.6,1.2,-1.6],"ease":"cubicOut"},{"index":3,"frame":0.4,"position":[1.6,2.6,1.6],"ease":"cubicOut"},{"index":4,"frame":0.4,"position":[1.6,2.6,-1.6],"ease":"cubicOut"},{"index":5,"frame":0.4,"position":[-1.6,1.2,1.6],"ease":"cubicOut"},{"index":6,"frame":0.4,"position":[-1.6,1.2,-1.6],"ease":"cubicOut"},{"index":7,"frame":0.4,"position":[-1.6,2.6,1.6],"ease":"cubicOut"},{"index":8,"frame":0.4,"position":[-1.6,2.6,-1.6],"ease":"cubicOut"}]},"cube_0":{"close":[{"index":1,"frame":0,"position":[-0.2,0.4,0],"rotation":[0,0,0,1]},{"index":2,"frame":0,"position":[0.3,0.7,0]},{"index":3,"frame":0,"position":[-0.2,0.7,0]},{"index":4,"frame":0,"position":[0.1,2,-0.1]},{"index":5,"frame":0,"position":[0.1,2,0.1]},{"index":6,"frame":0,"position":[-0.1,2,0.1]},{"index":7,"frame":0,"position":[-0.1,2,-0.1]}],"open":[{"index":1,"frame":0,"position":[-0.2,0,0]},{"index":1,"frame":1,"position":[0,1,0],"ease":"quadOut"},{"index":2,"frame":0.5,"position":[0.3,0.7,0]},{"index":2,"frame":1,"position":[-0.1,0.7,0],"ease":"quadIn"},{"index":3,"frame":0.5,"position":[-0.2,0.7,0]},{"index":3,"frame":1,"position":[0.4,0.7,0],"ease":"quadIn"},{"index":4,"frame":0,"position":[0.1,2,-0.1]},{"index":4,"frame":0.5,"position":[0.6,2,-0.6],"ease":"sineOut"},{"index":4,"frame":1,"position":[0.6,1.5,-0.6],"ease":"quadIn"},{"index":5,"frame":0,"position":[0.1,2,0.1]},{"index":5,"frame":0.5,"position":[0.6,2,0.6],"ease":"sineOut"},{"index":5,"frame":1,"position":[0.6,1.5,0.6],"ease":"quadIn"},{"index":6,"frame":0,"position":[-0.1,2,0.1]},{"index":6,"frame":0.5,"position":[-0.6,2,0.6],"ease":"sineOut"},{"index":6,"frame":1,"position":[-0.6,1.5,0.6],"ease":"quadIn"},{"index":7,"frame":0,"position":[-0.1,2,-0.1]},{"index":7,"frame":0.5,"position":[-0.6,2,-0.6],"ease":"sineOut"},{"index":7,"frame":1,"position":[-0.6,1.5,-0.6],"ease":"quadIn"}],"activate0":[{"index":1,"frame":0.1,"position":[0,1,0],"rotation":[0,1,0,0]},{"index":1,"frame":0.25,"position":[0.2,1,0],"ease":"cubicOut"},{"index":1,"frame":0.45,"position":[0,1,0],"ease":"quadInOut"}],"activate1":[{"index":1,"frame":0.1,"position":[0,1,0],"rotation":[0,0.707107,0,-0.707107]},{"index":1,"frame":0.25,"position":[0,1,-0.2],"ease":"cubicOut"},{"index":1,"frame":0.45,"position":[0,1,0],"ease":"quadInOut"}],"activate2":[{"index":1,"frame":0.1,"position":[0,1,0],"rotation":[0,0,0,1]},{"index":1,"frame":0.25,"position":[-0.2,1,0],"ease":"cubicOut"},{"index":1,"frame":0.45,"position":[0,1,0],"ease":"quadInOut"}],"activate3":[{"index":1,"frame":0.1,"position":[0,1,0],"rotation":[0,0.707107,0,0.707107]},{"index":1,"frame":0.25,"position":[0,1,0.2],"ease":"cubicOut"},{"index":1,"frame":0.45,"position":[0,1,0],"ease":"quadInOut"}],"activate":[{"index":2,"frame":0,"position":[-0.1,0.7,0]},{"index":2,"frame":0.15,"position":[-0.7,0.7,0],"ease":"quartIn"},{"index":2,"frame":0.5,"position":[-0.1,0.7,0],"ease":"CubicBezier,0.34,1.56,0.64,1"},{"index":3,"frame":0,"position":[0.4,0.7,0]},{"index":3,"frame":0.1,"position":[-0.2,0.7,0],"ease":"cubicIn"},{"index":3,"frame":0.5,"position":[0.4,0.7,0],"ease":"cubicOut"}]},"cube_1":{"close":[{"index":1,"frame":0,"position":[0,0.8,-0.3],"rotation":[0,0,0,1]},{"index":2,"frame":0,"position":[-0.5,0.6,-0.2]},{"index":3,"frame":0,"position":[0,0.8,0.3],"rotation":[0,0,0,1]},{"index":4,"frame":0,"position":[-0.5,0.6,0.2]},{"index":5,"frame":0,"position":[0.2,0.7,0]},{"index":6,"frame":0,"position":[-0.5,0.7,0]},{"index":7,"frame":0,"position":[-0.5,0.7,0]},{"index":8,"frame":0,"position":[0,1,0]}],"open":[{"index":1,"frame":0,"position":[0,0.8,-0.3],"rotation":[0,0,0,1]},{"index":1,"frame":1,"position":[0,1,-0.7],"rotation":[-0.382683,0,0,0.92388],"ease":"quadOut"},{"index":2,"frame":0.5,"position":[-0.5,0.6,-0.2]},{"index":2,"frame":1,"position":[-0.5,1.2,-0.2],"ease":"quadOut"},{"index":3,"frame":0,"position":[0,0.8,0.3],"rotation":[0,0,0,1]},{"index":3,"frame":1,"position":[0,1,0.7],"rotation":[0.382683,0,0,0.92388],"ease":"quadOut"},{"index":4,"frame":0.5,"position":[-0.5,0.6,0.2]},{"index":4,"frame":1,"position":[-0.5,1.2,0.2],"ease":"quadOut"},{"index":5,"frame":0,"position":[0.2,-0.5,0]},{"index":5,"frame":0.5,"position":[0.2,0.7,0],"ease":"sineIn"},{"index":5,"frame":1,"position":[-0.4,0.7,0],"ease":"sineOut"},{"index":6,"frame":0.5,"position":[-0.5,0.7,0]},{"index":6,"frame":1,"position":[0.7,0.7,0],"ease":"quadOut"},{"index":7,"frame":0.5,"position":[-0.5,0.7,0]},{"index":7,"frame":1,"position":[0.3,0.7,0],"ease":"quadOut"},{"index":8,"frame":0,"position":[0,1,0]}],"activate":[{"index":2,"frame":1.2,"position":[-0.5,1.2,-0.2]},{"index":2,"frame":1.6,"position":[-0.5,0.8,-0.2],"ease":"cubicOut"},{"index":2,"frame":3,"position":[-0.5,1.2,-0.2],"ease":"sineIn"},{"index":4,"frame":1.2,"position":[-0.5,1.2,0.2]},{"index":4,"frame":1.6,"position":[-0.5,0.8,0.2],"ease":"cubicOut"},{"index":4,"frame":3,"position":[-0.5,1.2,0.2],"ease":"sineIn"},{"index":5,"frame":0,"position":[-0.4,0.7,0]},{"index":5,"frame":1,"position":[-0.6,0.7,0],"ease":"cubicOut"},{"index":5,"frame":1.4,"position":[0,0.7,0],"ease":"quadInOut"},{"index":5,"frame":3,"position":[-0.4,0.7,0],"ease":"sineIn"},{"index":6,"frame":0,"position":[0.7,0.7,0]},{"index":6,"frame":1.2,"position":[1,0.7,0],"ease":"cubicOut"},{"index":6,"frame":1.6,"position":[0.4,0.7,0],"ease":"quadInOut"},{"index":6,"frame":3,"position":[0.7,0.7,0],"ease":"sineIn"},{"index":7,"frame":1,"position":[0.3,0.7,0]},{"index":7,"frame":1.6,"position":[-0.2,0.7,0],"ease":"quadOut"},{"index":7,"frame":3,"position":[0.3,0.7,0],"ease":"quadIn"},{"index":8,"frame":0.8,"position":[0,1,0]},{"index":8,"frame":1.4,"position":[-0.6,1,0],"ease":"quadOut"},{"index":8,"frame":2,"position":[0,1,0],"ease":"quadIn"}]},"cube_2":{"close":[{"index":1,"frame":0,"position":[0,1,1]},{"index":2,"frame":0,"position":[0,1,-1]},{"index":3,"frame":0,"position":[-1,1,0]},{"index":4,"frame":0,"position":[1,1,0]},{"index":5,"frame":0,"position":[0,1,0]},{"index":6,"frame":0,"position":[0,0.8,0]}],"open":[{"index":1,"frame":0,"position":[0,1,1]},{"index":1,"frame":1,"position":[0,1,-1],"ease":"quadInOut"},{"index":2,"frame":0,"position":[0,1,-1]},{"index":2,"frame":1,"position":[0,1,1],"ease":"quadInOut"},{"index":3,"frame":0,"position":[-1,1,0]},{"index":3,"frame":1,"position":[1,1,0],"ease":"quadInOut"},{"index":4,"frame":0,"position":[1,1,0]},{"index":4,"frame":1,"position":[-1,1,0],"ease":"quadInOut"},{"index":5,"frame":0,"position":[0,1,0]},{"index":5,"frame":0.4,"position":[0,2,0],"ease":"quartOut"},{"index":6,"frame":0.4,"position":[0,0.8,0]},{"index":6,"frame":1,"position":[0,2,0],"ease":"quadInOut"}],"activate":[{"index":5,"frame":0,"position":[0,2,0]},{"index":5,"frame":0.2,"position":[0,1,0],"ease":"cubicOut"},{"index":5,"frame":0.5,"position":[0,2,0],"ease":"quartIn"},{"index":6,"frame":0,"position":[0,2,0]},{"index":6,"frame":0.3,"position":[0,1,0],"ease":"sineOut"},{"index":6,"frame":0.6,"position":[0,2,0],"ease":"CubicBezier,1,0,0.5,1.5"}]},"cube_3":{"close":[{"index":1,"frame":0,"position":[0,-2,0]},{"index":2,"frame":0,"position":[0.7,3.9,0],"rotation":[0.5,-0.5,0.5,0.5]},{"index":3,"frame":0,"position":[0,2,0],"rotation":[0,0.382683,0,0.92388]},{"index":4,"frame":0,"position":[0,3,0],"rotation":[0,-0.382683,0,0.92388]},{"index":5,"frame":0,"position":[0,4.5,0]}],"open":[{"index":1,"frame":0,"position":[0,-2,0]},{"index":1,"frame":1,"position":[0,0,0],"ease":"quadOut"},{"index":2,"frame":0,"position":[0.7,3.9,0],"rotation":[0.5,-0.5,0.5,0.5]},{"index":2,"frame":1,"position":[0.7,3.9,0],"rotation":[-0.5,0.5,0.5,0.5],"ease":"sineInOut"},{"index":3,"frame":0.2,"position":[0,1.5,0],"rotation":[0,0.382683,0,0.92388]},{"index":3,"frame":1,"position":[0,1,0],"rotation":[0,0,0,1],"ease":"sineIn"},{"index":4,"frame":0.2,"position":[0,2.5,0],"rotation":[0,-0.382683,0,0.92388]},{"index":4,"frame":1,"position":[0,2,0],"rotation":[0,0,0,1],"ease":"sineIn"},{"index":5,"frame":0,"position":[0,3,0]}],"activate":[{"index":1,"frame":0,"position":[0,0,0]},{"index":1,"frame":0.4,"position":[0,1,0],"ease":"quadInOut"},{"index":1,"frame":0.8,"position":[0,-1,0],"ease":"cubicIn"},{"index":1,"frame":1.8,"position":[0,0,0],"ease":"quadInOut"},{"index":2,"frame":0.6,"position":[0.7,3.9,0]},{"index":2,"frame":0.8,"position":[0.7,3.3,0],"ease":"quartIn"},{"index":2,"frame":1.6,"position":[0.7,3.9,0],"ease":"sineOut"},{"index":3,"frame":0,"position":[0,1,0],"rotation":[0,0,0,1]},{"index":3,"frame":0.5,"rotation":[0,1,0,0],"ease":"sineIn"},{"index":3,"frame":0.8,"rotation":[0,0.382683,0,-0.92388],"ease":"sineOut"},{"index":3,"frame":1.8,"position":[0,1,0],"rotation":[0,0,0,1],"ease":"quadInOut"},{"index":3,"frame":0.4,"position":[0,0,0],"ease":"quadInOut"},{"index":3,"frame":0.8,"position":[0,2,0],"ease":"cubicIn"},{"index":4,"frame":0,"position":[0,2,0],"rotation":[0,0,0,1]},{"index":4,"frame":0.5,"rotation":[0,-1,0,0],"ease":"sineIn"},{"index":4,"frame":0.8,"rotation":[0,-0.382683,0,-0.92388],"ease":"sineOut"},{"index":4,"frame":1.8,"position":[0,2,0],"rotation":[0,0,0,1],"ease":"quadInOut"},{"index":4,"frame":0.4,"position":[0,2,0],"ease":"quadInOut"},{"index":4,"frame":0.8,"position":[0,2.5,0],"ease":"cubicIn"}]},"cube_4":{"close":[{"index":1,"frame":0,"position":[-0.5,1,0],"rotation":[0.5,0.5,-0.5,0.5]},{"index":2,"frame":0,"position":[-0.5,1,0],"rotation":[-0.5,-0.5,0.5,-0.5]},{"index":3,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":4,"frame":0,"position":[0.5,0.5,0]},{"index":5,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":6,"frame":0,"position":[-0.5,0.5,0]}],"open":[{"index":1,"frame":0,"position":[-0.7,1,0],"rotation":[0.5,0.5,-0.5,0.5]},{"index":1,"frame":1,"position":[0,1,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"sineIn"},{"index":2,"frame":0,"position":[-0.9,1,0],"rotation":[-0.5,-0.5,0.5,-0.5]},{"index":2,"frame":1,"position":[0.6,1,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"sineIn"},{"index":3,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":3,"frame":1,"rotation":[-0.707107,0,0,0.707107],"ease":"quadInOut"},{"index":4,"frame":0.4,"position":[0.5,0.5,0.4],"scale":[0,1,0]},{"index":4,"frame":1,"position":[0.5,0.5,1],"scale":[1,1,1],"ease":"quadOut"},{"index":5,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":5,"frame":1,"rotation":[0,0.707107,0.707107,0],"ease":"quadInOut"},{"index":6,"frame":0.4,"position":[-0.5,0.5,0.4],"scale":[0,1,0]},{"index":6,"frame":1,"position":[-0.5,0.5,1],"scale":[1,1,1],"ease":"quadOut"}],"activate":[{"index":1,"frame":0.1,"position":[0,1,0],"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":1,"frame":0.6,"position":[0.5,1,0],"ease":"quadInOut"},{"index":1,"frame":0.8,"position":[-1,1,0],"ease":"quartIn"},{"index":1,"frame":0.6,"rotation":[0.683013,0.683013,-0.183013,0.183013],"ease":"quadIn"},{"index":1,"frame":0.9,"rotation":[0.183013,0.183013,-0.683013,0.683013],"ease":"linear"},{"index":1,"frame":1.4,"position":[0,1,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quadOut"},{"index":2,"frame":0,"position":[0.6,1,0],"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":2,"frame":0.6,"position":[1.4,1,0],"ease":"quadInOut"},{"index":2,"frame":0.8,"position":[-0.5,1,0],"ease":"quadIn"},{"index":2,"frame":0.5,"rotation":[0.183013,0.183013,-0.683013,0.683013],"ease":"quadIn"},{"index":2,"frame":0.8,"rotation":[0.683013,0.683013,-0.183013,0.183013],"ease":"linear"},{"index":2,"frame":1.5,"position":[0.6,1,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"sineOut"},{"index":4,"frame":0.6,"position":[0.5,0.5,1]},{"index":4,"frame":0.8,"position":[0.5,0.5,0.6],"ease":"cubicIn"},{"index":4,"frame":1.2,"position":[0.5,0.5,1],"ease":"cubicOut"},{"index":6,"frame":0.6,"position":[-0.5,0.5,1]},{"index":6,"frame":0.8,"position":[-0.5,0.5,0.6],"ease":"cubicIn"},{"index":6,"frame":1.2,"position":[-0.5,0.5,1],"ease":"cubicOut"}]},"cube_5":{"close":[{"index":1,"frame":0,"position":[-0.5,0.5,-0.5]},{"index":2,"frame":0,"position":[-0.5,0.5,0.5]},{"index":3,"frame":0,"position":[0.5,0.5,-0.5]},{"index":4,"frame":0,"position":[0.5,0.5,0.5]},{"index":5,"frame":0,"position":[0,0,0],"scale":[0,0,0]},{"index":6,"frame":0,"position":[0,-0.02,0]},{"index":7,"frame":0,"position":[0,0,0]}],"open":[{"index":1,"frame":0,"position":[-0.5,0.5,-0.5]},{"index":1,"frame":0.4,"position":[-1,1,-1],"ease":"quadOut"},{"index":1,"frame":1,"position":[-1,0.5,-1],"ease":"cubicIn"},{"index":2,"frame":0,"position":[-0.5,0.5,0.5]},{"index":2,"frame":0.4,"position":[-1,1,1],"ease":"quadOut"},{"index":2,"frame":1,"position":[-1,0.5,1],"ease":"cubicIn"},{"index":3,"frame":0,"position":[0.5,0.5,-0.5]},{"index":3,"frame":0.4,"position":[1,1,-1],"ease":"quadOut"},{"index":3,"frame":1,"position":[1,0.5,-1],"ease":"cubicIn"},{"index":4,"frame":0,"position":[0.5,0.5,0.5]},{"index":4,"frame":0.4,"position":[1,1,1],"ease":"quadOut"},{"index":4,"frame":1,"position":[1,0.5,1],"ease":"cubicIn"},{"index":5,"frame":0.5,"position":[0,-0.2,0],"scale":[1,1,1]},{"index":5,"frame":1,"position":[0,1,0],"ease":"sineOut"},{"index":6,"frame":0.5,"position":[0,-0.5,0]},{"index":6,"frame":1,"position":[0,1,0],"ease":"quadIn"},{"index":7,"frame":0,"position":[0,0,0]},{"index":7,"frame":0.5,"position":[0,-1,0],"ease":"cubicIn"}],"activate":[{"index":5,"frame":0.1,"position":[0,1,0]},{"index":5,"frame":0.7,"position":[0,1.6,0],"ease":"sineInOut"},{"index":5,"frame":1,"position":[0,0,0],"ease":"quartIn"},{"index":5,"frame":2,"position":[0,1,0],"ease":"quadInOut"},{"index":6,"frame":0,"position":[0,1,0],"rotation":[0,0,0,1]},{"index":6,"frame":0.6,"position":[0,1.4,0],"rotation":[0,0.707107,0,0.707107],"ease":"quadInOut"},{"index":6,"frame":1,"position":[0,0,0],"rotation":[0,0.707107,0,0.707107],"ease":"expoIn"},{"index":6,"frame":1.6,"position":[0,1,0],"rotation":[0,0,0,1],"ease":"quadInOut"},{"index":1,"frame":1,"position":[-1,0.5,-1]},{"index":2,"frame":1,"position":[-1,0.5,1]},{"index":3,"frame":1,"position":[1,0.5,-1]},{"index":4,"frame":1,"position":[1,0.5,1]},{"index":1,"frame":1.1,"position":[-1,0.8,-1],"ease":"quadOut"},{"index":2,"frame":1.1,"position":[-1,0.8,1],"ease":"quadOut"},{"index":3,"frame":1.1,"position":[1,0.8,-1],"ease":"quadOut"},{"index":4,"frame":1.1,"position":[1,0.8,1],"ease":"quadOut"},{"index":1,"frame":1.4,"position":[-1,0.5,-1],"ease":"cubicIn"},{"index":2,"frame":1.4,"position":[-1,0.5,1],"ease":"cubicIn"},{"index":3,"frame":1.4,"position":[1,0.5,-1],"ease":"cubicIn"},{"index":4,"frame":1.4,"position":[1,0.5,1],"ease":"cubicIn"}]},"cube_6":{"close":[{"index":1,"frame":0,"rotation":[0,0,0,1]},{"index":2,"frame":0,"rotation":[0,0,0,1]},{"index":6,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":7,"frame":0,"rotation":[0,0.707107,0,0.707107]},{"index":3,"frame":0,"position":[0,0.1,0],"scale":[0,0,0]},{"index":4,"frame":0,"position":[0,0,0]},{"index":5,"frame":0,"position":[0,0,0]}],"open":[{"index":1,"frame":0,"rotation":[0,0,0,1]},{"index":1,"frame":1,"rotation":[-0.707107,0,0,0.707107],"ease":"cubicIn"},{"index":2,"frame":0,"rotation":[0,0,0,1]},{"index":2,"frame":1,"rotation":[0.707107,0,0,0.707107],"ease":"cubicIn"},{"index":6,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":6,"frame":1,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"cubicIn"},{"index":7,"frame":0,"rotation":[0,0.707107,0,0.707107]},{"index":7,"frame":1,"rotation":[-0.5,0.5,0.5,0.5],"ease":"cubicIn"},{"index":3,"frame":0,"position":[0,0,0],"scale":[1,1,1]},{"index":3,"frame":0.4,"position":[0,2,0],"ease":"sineIn"},{"index":4,"frame":0.2,"position":[0,0,0]},{"index":4,"frame":0.8,"position":[0,1,0],"ease":"quadOut"},{"index":5,"frame":0.4,"position":[0,-2,0],"scale":[1,1,1],"rotation":[0,1,0,0]},{"index":5,"frame":1,"position":[0,0,0],"rotation":[0,0,0,1],"ease":"quadOut"}],"loop":[{"index":3,"frame":0,"position":[0,2,0]},{"index":3,"frame":1,"position":[0,1.9,0],"ease":"quartIn"},{"index":3,"frame":1.6,"position":[0,2,0],"ease":"cubicOut"},{"index":4,"frame":0,"position":[0,1,0]},{"index":4,"frame":1,"position":[0,0.7,0],"ease":"quadIn"},{"index":4,"frame":1.2,"position":[0,1,0],"ease":"quadOut"},{"index":5,"frame":0,"position":[0,0,0],"rotation":[0,0,0,1]},{"index":5,"frame":0.8,"position":[0,-1,0],"rotation":[0,1,0,0],"ease":"sineOut"},{"index":5,"frame":1.2,"position":[0,1,0],"rotation":[0,-0.309017,0,0.951057],"ease":"cubicInOut"},{"index":5,"frame":2,"position":[0,0,0],"rotation":[0,0,0,1],"ease":"sineIn"}]},"cube_7":{"close":[{"index":1,"frame":0,"position":[0,0.8,0],"scale":[1,0.5,1]},{"index":2,"frame":0,"position":[0,0,0],"rotation":[0,1,0,0]},{"index":3,"frame":0,"position":[0,1,0]},{"index":4,"frame":0,"position":[-0.8,1.5,0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]},{"index":5,"frame":0,"position":[-0.8,1.5,-0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]},{"index":6,"frame":0,"position":[0.8,1.5,0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]},{"index":7,"frame":0,"position":[0.8,1.5,-0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]}],"open":[{"index":1,"frame":0,"position":[0,-0.4,0],"scale":[1,1,1]},{"index":1,"frame":0.5,"position":[0,3.2,0],"ease":"quadOut"},{"index":1,"frame":1,"position":[0,2,0],"ease":"cubicIn"},{"index":2,"frame":0,"position":[0,0,0],"rotation":[0,1,0,0]},{"index":2,"frame":1,"position":[0,-1.2,0],"rotation":[0,0,0,1],"ease":"linear"},{"index":3,"frame":0.25,"position":[0,1,0]},{"index":3,"frame":0.75,"position":[0,2,0],"ease":"quadOut"},{"index":4,"frame":0,"position":[0.8,-0.25,-0.8],"rotation":[0,0.707107,0,-0.707107],"scale":[1,1,1]},{"index":4,"frame":0.6,"position":[0.4,3.2,-0.4],"ease":"sineInOut"},{"index":4,"frame":0.8,"rotation":[1,0,0,0],"ease":"quadInOut"},{"index":4,"frame":0.95,"position":[0.6,2.2,-0.6],"ease":"quadIn"},{"index":5,"frame":0,"position":[0.8,-0.25,0.8],"rotation":[0,0.707107,0,0.707107],"scale":[1,1,1]},{"index":5,"frame":0.6,"position":[0.4,3.2,0.4],"ease":"sineInOut"},{"index":5,"frame":0.8,"rotation":[1,0,0,0],"ease":"quadInOut"},{"index":5,"frame":0.95,"position":[0.6,2.2,0.6],"ease":"quadIn"},{"index":6,"frame":0,"position":[-0.8,-0.25,-0.8],"rotation":[0,-0.707107,0,-0.707107],"scale":[1,1,1]},{"index":6,"frame":0.6,"position":[-0.4,3.2,-0.4],"ease":"sineInOut"},{"index":6,"frame":0.8,"rotation":[1,0,0,0],"ease":"quadInOut"},{"index":6,"frame":0.95,"position":[-0.6,2.2,-0.6],"ease":"quadIn"},{"index":7,"frame":0,"position":[-0.8,-0.25,0.8],"rotation":[0,-0.707107,0,0.707107],"scale":[1,1,1]},{"index":7,"frame":0.6,"position":[-0.4,3.2,0.4],"ease":"sineInOut"},{"index":7,"frame":0.8,"rotation":[1,0,0,0],"ease":"quadInOut"},{"index":7,"frame":0.95,"position":[-0.6,2.2,0.6],"ease":"quadIn"}],"loop":[{"index":1,"frame":0,"position":[0,2,0],"rotation":[0,0,0,1]},{"index":1,"frame":0.5,"position":[0,1.8,0],"rotation":[0,1,0,0],"ease":"linear"},{"index":1,"frame":1,"position":[0,2,0],"rotation":[0,0,0,-1],"ease":"linear"},{"index":3,"frame":0,"position":[0,2,0],"rotation":[0,0,0,1]},{"index":3,"frame":0.5,"position":[0,2.3,0],"rotation":[0,-1,0,0],"ease":"linear"},{"index":3,"frame":1,"position":[0,2,0],"rotation":[0,0,0,-1],"ease":"linear"}]},"cube_8":{"close":[{"index":1,"frame":0,"position":[0,1,0],"rotation":[0,0,0,1]},{"index":2,"frame":0,"position":[0,0,0.8],"rotation":[-0.707107,0,0,0.707107]},{"index":3,"frame":0,"position":[0,1.1,-0.3]},{"index":4,"frame":0,"position":[0,0,-0.8],"rotation":[0,0.707107,0.707107,0]},{"index":5,"frame":0,"position":[0,1.1,-0.3]},{"index":6,"frame":0,"position":[0,0.5,0],"rotation":[-0.707107,0,-0.707107,0]}],"open":[{"index":1,"frame":0,"position":[0,1,0]},{"index":1,"frame":1,"position":[0,2.8,0],"ease":"cubicOut"},{"index":2,"frame":0,"position":[0,0,0.8],"rotation":[-0.707107,0,0,0.707107]},{"index":2,"frame":0.5,"position":[0,0,-1],"rotation":[-0.707107,0,0,0.707107],"ease":"quadOut"},{"index":2,"frame":1,"position":[0,0,-0.6],"rotation":[-0.5,0.5,-0.5,0.5],"ease":"sineInOut"},{"index":3,"frame":0.5,"position":[0,1.1,-0.3]},{"index":3,"frame":1,"position":[0,1.1,0.6],"ease":"quadIn"},{"index":4,"frame":0,"position":[0,0,-0.8],"rotation":[0,0.707107,0.707107,0]},{"index":4,"frame":0.5,"position":[0,0,1],"rotation":[0,0.707107,0.707107,0],"ease":"quadOut"},{"index":4,"frame":1,"position":[0,0,0.6],"rotation":[0.5,0.5,0.5,0.5],"ease":"sineInOut"},{"index":5,"frame":0.5,"position":[0,1.1,-0.3]},{"index":5,"frame":1,"position":[0,1.1,0.6],"ease":"quadIn"},{"index":6,"frame":0,"position":[0,0,0],"rotation":[-0.707107,0,-0.707107,0]},{"index":6,"frame":1,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quadIn"}],"activate":[{"index":1,"frame":0.8,"position":[0,2.8,0]},{"index":1,"frame":1,"position":[0,2.6,0],"ease":"quadOut"},{"index":1,"frame":1.8,"position":[0,2.8,0],"ease":"sineIn"},{"index":2,"frame":0,"position":[0,0,-0.6],"rotation":[-0.5,0.5,-0.5,0.5]},{"index":2,"frame":0.8,"position":[0,0,-1],"rotation":[-0.653281,0.270598,-0.270598,0.653281],"ease":"cubicInOut"},{"index":2,"frame":1.2,"rotation":[-0.683013,0.183013,-0.183013,0.683013],"ease":"quadOut"},{"index":2,"frame":2,"position":[0,0,-0.6],"rotation":[-0.5,0.5,-0.5,0.5],"ease":"sineInOut"},{"index":3,"frame":0,"position":[0,1.1,0.6]},{"index":3,"frame":0.6,"position":[0,1.1,1.4],"ease":"quadInOut"},{"index":3,"frame":0.8,"position":[0,1.1,0],"ease":"cubicIn"},{"index":3,"frame":1.8,"position":[0,1.1,0.6],"ease":"quadOut"},{"index":4,"frame":0,"position":[0,0,0.6],"rotation":[0.5,0.5,0.5,0.5]},{"index":4,"frame":0.8,"position":[0,0,1],"rotation":[0.270598,0.653281,0.653281,0.270598],"ease":"cubicInOut"},{"index":4,"frame":1.2,"rotation":[0.183013,0.683013,0.683013,0.183013],"ease":"quadOut"},{"index":4,"frame":2,"position":[0,0,0.6],"rotation":[0.5,0.5,0.5,0.5],"ease":"sineInOut"},{"index":5,"frame":0,"position":[0,1.1,0.6]},{"index":5,"frame":0.6,"position":[0,1.1,1.4],"ease":"quadInOut"},{"index":5,"frame":0.8,"position":[0,1.1,0],"ease":"cubicIn"},{"index":5,"frame":1.8,"position":[0,1.1,0.6],"ease":"quadOut"},{"index":6,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":6,"frame":0.8,"rotation":[-0.630037,-0.32102,-0.630037,0.32102],"ease":"quadInOut"},{"index":6,"frame":1.2,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quartOut"}]},"scarab":{"activate":[{"index":0,"frame":0,"position":[0,0.5,0],"rotation":[0,-0.707107,0,0.707107]},{"index":1,"frame":0.1,"scale":[0.8,0.5,0.8]},{"index":1,"frame":0.3,"scale":[1,0.8,1],"position":[-0.6,0.5,0],"rotation":[0,0,-0.707107,0.707107],"ease":"quartOut"},{"index":1,"frame":0.8,"scale":[1,1,1],"position":[0,0.5,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"expoOut"},{"index":1,"frame":1,"scale":[0.8,0.5,0.8],"position":[-0.6,0.5,0],"ease":"quadIn"},{"index":2,"frame":0,"position":[0,0.5,0.1]},{"index":2,"frame":0.4,"position":[0.1,0.5,-0.3],"ease":"cubicInOut"},{"index":2,"frame":0.7,"position":[0,0.5,-0.2],"ease":"quadOut"},{"index":2,"frame":1,"position":[0,0.5,0.1],"ease":"cubicIn"},{"index":3,"frame":0,"position":[0,0.5,-0.1]},{"index":3,"frame":0.4,"position":[0.1,0.5,0.3],"ease":"cubicInOut"},{"index":3,"frame":0.7,"position":[0,0.5,0.2],"ease":"quadOut"},{"index":3,"frame":1,"position":[0,0.5,-0.1],"ease":"cubicIn"}]},"tarantula":{"activate":[{"index":0,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":9,"frame":0,"scale":[0,0,0]},{"index":11,"frame":0,"position":[0,1.1,0],"scale":[1,1,1]},{"index":12,"frame":0,"position":[0,0,0],"rotation":[0,0,0,1]},{"index":11,"frame":0.6,"position":[0,1.4,0],"ease":"quadInOut"},{"index":11,"frame":0.8,"position":[0,0.8,0],"ease":"cubicIn"},{"index":11,"frame":1.6,"position":[0,1.1,0],"ease":"quadOut"},{"index":12,"frame":0.6,"position":[0,1.2,0],"rotation":[0,-1,0,0],"ease":"sineInOut"},{"index":12,"frame":0.8,"position":[0,-0.5,0],"rotation":[0,1,0,0],"ease":"quadIn"},{"index":12,"frame":1.6,"position":[0,0,0],"rotation":[0,0,0,1],"ease":"cubicOut"}],"activateVariant":[{"index":0,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":11,"frame":0,"scale":[0,0,0]},{"index":9,"frame":0,"scale":[1,1,1],"position":[0,1.1,0]},{"index":10,"frame":0,"position":[-0.2,0.7,0]},{"index":9,"frame":0.6,"position":[0.4,1.1,0],"ease":"sineInOut"},{"index":9,"frame":0.9,"position":[-0.2,1.1,0],"ease":"cubicIn"},{"index":9,"frame":1.2,"position":[0,1.1,0],"ease":"quadOut"},{"index":10,"frame":0.6,"position":[0.4,0.7,0],"ease":"quadInOut"},{"index":10,"frame":0.8,"position":[-0.8,0.7,0],"ease":"quadIn"},{"index":10,"frame":1.4,"position":[-0.2,0.7,0],"ease":"cubicOut"}]},"stingray":{"activate":[{"index":0,"frame":0,"rotation":[0,0.707107,0.707107,0],"position":[0,1.3,0]},{"index":0,"frame":0.6,"position":[0,1.7,-0.8],"rotation":[0,0.55557,0.83147,0],"ease":"quadInOut"},{"index":0,"frame":0.8,"position":[0,1.2,0.4],"rotation":[0,0.707107,0.707107,0],"ease":"cubicIn"},{"index":0,"frame":1.6,"position":[0,1.3,0],"ease":"quadOut"},{"index":1,"frame":0.6,"position":[-0.5,-1,0],"rotation":[0,0,0,1]},{"index":6,"frame":0.6,"position":[0.5,-1,0],"rotation":[0,0,0,1]},{"index":1,"frame":0.8,"position":[-0.5,1,0],"rotation":[0,1,0,0],"ease":"quartIn"},{"index":6,"frame":0.8,"position":[0.5,1,0],"rotation":[0,-1,0,0],"ease":"quartIn"},{"index":1,"frame":2,"position":[-0.5,-1,0],"rotation":[0,0,0,1],"ease":"sineOut"},{"index":6,"frame":2,"position":[0.5,-1,0],"rotation":[0,0,0,1],"ease":"sineOut"}]},"locust":{"activate":[{"index":0,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":1,"frame":0.4,"position":[-1.3,0.3,0]},{"index":2,"frame":0,"position":[0,-0.5,0],"rotation":[0,0,0,1]},{"index":3,"frame":0,"position":[-0.5,1.4,0]},{"index":1,"frame":0.8,"position":[-1.3,0.7,0],"ease":"quadOut"},{"index":2,"frame":0.6,"rotation":[0,-1,0,0],"ease":"quadIn"},{"index":2,"frame":1.2,"rotation":[0,0,0,-1],"ease":"CubicBezier,0.25,0.5,0.5,0.75"},{"index":2,"frame":1.8,"rotation":[0,-0.707107,0,0.707107],"ease":"linear"},{"index":2,"frame":0.6,"position":[0,2,0],"ease":"cubicInOut"},{"index":2,"frame":1,"position":[0,1,0],"ease":"sineInOut"}],"deactivate":[{"index":2,"frame":0,"rotation":[0,0,0,1],"position":[0,1,0],"ease":"linear"},{"index":2,"frame":1,"position":[0,-0.5,0],"ease":"quadInOut"},{"index":1,"frame":0,"position":[-1.3,0.7,0]},{"index":1,"frame":0.6,"position":[-1.3,0.3,0],"ease":"quadIn"}],"activateVariant":[{"index":4,"frame":0,"rotation":[0,0,0,1]},{"index":5,"frame":0,"rotation":[0,0,0,1]},{"index":4,"frame":0.8,"rotation":[0,-0.707107,0,0.707107],"ease":"CubicBezier,0.75,0.0,0.25,1.25"},{"index":5,"frame":0.8,"rotation":[0,0.707107,0,0.707107],"ease":"CubicBezier,0.75,0.0,0.25,1.25"},{"index":4,"frame":1.6,"rotation":[0,0,0,1],"ease":"quartIn"},{"index":5,"frame":1.6,"rotation":[0,0,0,1],"ease":"quartIn"},{"index":3,"frame":0.3,"position":[-0.5,1.4,0]},{"index":3,"frame":0.7,"position":[1.5,1.4,0],"ease":"cubicOut"},{"index":3,"frame":1,"position":[1,1.4,0],"ease":"sineInOut"},{"index":3,"frame":1.6,"position":[-0.5,1.4,0],"ease":"cubicIn"}]},"obelisk":{"activate":[{"index":0,"frame":0,"position":[0,0,0]},{"index":1,"frame":0,"position":[0,1,-0.612],"rotation":[0,0,0,1]},{"index":2,"frame":0,"position":[0,1,0.612],"rotation":[0,1,0,0]},{"index":3,"frame":0,"position":[0.612,1,0],"rotation":[0,-0.707107,0,0.707107]},{"index":4,"frame":0,"position":[-0.612,1,0],"rotation":[0,0.707107,0,0.707107]},{"index":0,"frame":0.56,"position":[0,-2,0],"ease":"cubicIn"},{"index":0,"frame":1.2,"position":[0,-1,0],"ease":"cubicOut"},{"index":1,"frame":0.8,"position":[0,0,-0.5],"rotation":[-0.707107,0,0,0.707107],"ease":"bounceIn,0.04,0.7"},{"index":2,"frame":0.8,"position":[0,0,0.5],"rotation":[0,0.707107,0.707107,0],"ease":"bounceIn,0.04,0.7"},{"index":3,"frame":0.8,"position":[0.5,0,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"bounceIn,0.04,0.7"},{"index":4,"frame":0.8,"position":[-0.5,0,0],"rotation":[-0.5,0.5,0.5,0.5],"ease":"bounceIn,0.04,0.7"}],"deactivate":[{"index":0,"frame":0.6,"position":[0,-1,0]},{"index":1,"frame":0.2,"position":[0,0,-0.5],"rotation":[-0.707107,0,0,0.707107]},{"index":2,"frame":0.2,"position":[0,0,0.5],"rotation":[0,0.707107,0.707107,0]},{"index":3,"frame":0.2,"position":[0.5,0,0],"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":4,"frame":0.2,"position":[-0.5,0,0],"rotation":[-0.5,0.5,0.5,0.5]},{"index":0,"frame":1,"position":[0,0,0],"ease":"quartIn"},{"index":1,"frame":1,"position":[0,1,-0.612],"rotation":[0,0,0,1],"ease":"quadIn"},{"index":2,"frame":1,"position":[0,1,0.612],"rotation":[0,1,0,0],"ease":"quadIn"},{"index":3,"frame":1,"position":[0.612,1,0],"rotation":[0,-0.707107,0,0.707107],"ease":"quadIn"},{"index":4,"frame":1,"position":[-0.612,1,0],"rotation":[0,0.707107,0,0.707107],"ease":"quadIn"}]},"monolith":{"activate":[{"index":1,"frame":0,"rotation":[0,0,0,1]},{"index":2,"frame":0,"rotation":[0,1,0,0]},{"index":3,"frame":0,"rotation":[0,0.707107,0,0.707107]},{"index":4,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":5,"frame":0.2,"position":[0,0,0],"rotation":[0,0,0,-1]},{"index":10,"frame":0,"rotation":[0,0.92388,0,0.382683]},{"index":12,"frame":0,"rotation":[0,0.382683,0,0.92388]},{"index":14,"frame":0,"rotation":[0,0.382683,0,-0.92388]},{"index":16,"frame":0,"rotation":[0,0.92388,0,-0.382683]},{"index":11,"frame":0,"position":[0,0,0.5]},{"index":13,"frame":0,"position":[0,0,0.5]},{"index":15,"frame":0,"position":[0,0,0.5]},{"index":17,"frame":0,"position":[0,0,0.5]},{"index":1,"frame":1.4,"rotation":[-0.707107,0,0,0.707107],"ease":"quadInOut"},{"index":2,"frame":1.4,"rotation":[0,0.707107,0.707107,0],"ease":"quadInOut"},{"index":3,"frame":1.4,"rotation":[-0.5,0.5,0.5,0.5],"ease":"quadInOut"},{"index":4,"frame":1.4,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quadInOut"},{"index":5,"frame":1.4,"position":[0,3.5,0],"ease":"CubicBezier,0.25,1.5,0.5,1.0"},{"index":5,"frame":0.8,"rotation":[0,1,0,0],"ease":"cubicIn"},{"index":5,"frame":1.6,"rotation":[0,0,0,1],"ease":"quadOut"},{"index":5,"frame":2.4,"position":[0,0,0],"rotation":[0,0,0,-1],"ease":"cubicIn"},{"index":1,"frame":2.4,"rotation":[0,0,0,1],"ease":"quartIn"},{"index":2,"frame":2.4,"rotation":[0,1,0,0],"ease":"quartIn"},{"index":3,"frame":2.4,"rotation":[0,0.707107,0,0.707107],"ease":"quartIn"},{"index":4,"frame":2.4,"rotation":[0,-0.707107,0,0.707107],"ease":"quartIn"}],"turret11":[{"index":11,"frame":0,"position":[0,0,0.5]},{"index":11,"frame":0.3,"position":[0,0,1],"ease":"quadInOut"},{"index":11,"frame":0.4,"position":[0,0,0.4],"ease":"cubicIn"},{"index":11,"frame":0.8,"position":[0,0,0.5],"ease":"quadOut"}],"turret01":[{"index":13,"frame":0,"position":[0,0,0.5]},{"index":13,"frame":0.3,"position":[0,0,1],"ease":"quadInOut"},{"index":13,"frame":0.4,"position":[0,0,0.4],"ease":"cubicIn"},{"index":13,"frame":0.8,"position":[0,0,0.5],"ease":"quadOut"}],"turret00":[{"index":15,"frame":0,"position":[0,0,0.5]},{"index":15,"frame":0.3,"position":[0,0,1],"ease":"quadInOut"},{"index":15,"frame":0.4,"position":[0,0,0.4],"ease":"cubicIn"},{"index":15,"frame":0.8,"position":[0,0,0.5],"ease":"quadOut"}],"turret10":[{"index":17,"frame":0,"position":[0,0,0.5]},{"index":17,"frame":0.3,"position":[0,0,1],"ease":"quadInOut"},{"index":17,"frame":0.4,"position":[0,0,0.4],"ease":"cubicIn"},{"index":17,"frame":0.8,"position":[0,0,0.5],"ease":"quadOut"}],"spawner6":[{"index":6,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":6,"frame":0.5,"rotation":[0,-0.707107,0,0.707107],"ease":"quadInOut"},{"index":6,"frame":1.4,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quintIn"}],"spawner7":[{"index":7,"frame":0,"rotation":[-0.707107,0,0,0.707107]},{"index":7,"frame":0.5,"rotation":[0,0,0,1],"ease":"quadInOut"},{"index":7,"frame":1.4,"rotation":[-0.707107,0,0,0.707107],"ease":"quintIn"}],"spawner8":[{"index":8,"frame":0,"rotation":[0,0.707107,0.707107,0]},{"index":8,"frame":0.5,"rotation":[0,1,0,0],"ease":"quadInOut"},{"index":8,"frame":1.4,"rotation":[0,0.707107,0.707107,0],"ease":"quintIn"}],"spawner9":[{"index":9,"frame":0,"rotation":[-0.5,0.5,0.5,0.5]},{"index":9,"frame":0.5,"rotation":[0,0.707107,0,0.707107],"ease":"quadInOut"},{"index":9,"frame":1.4,"rotation":[-0.5,0.5,0.5,0.5],"ease":"quintIn"}]},"decapod":{"activate":[{"index":0,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":1,"frame":0,"position":[0,0.7,-0.1]},{"index":2,"frame":0,"position":[0,0.7,0.1]},{"index":3,"frame":0,"scale":[1,0,0],"rotation":[0,0,0.707107,0.707107]},{"index":4,"frame":0,"position":[0,-0.2,0]},{"index":1,"frame":0.3,"position":[0,0.7,-0.7],"ease":"quadOut"},{"index":2,"frame":0.3,"position":[0,0.7,0.7],"ease":"quadOut"},{"index":1,"frame":0.6,"position":[0,0.7,-0.5],"ease":"quadIn"},{"index":2,"frame":0.6,"position":[0,0.7,0.5],"ease":"quadIn"},{"index":3,"frame":0.4,"scale":[1,1,1],"rotation":[0,0,0,1],"ease":"cubicOut"},{"index":3,"frame":0.8,"rotation":[0,0,-0.309017,0.951057],"ease":"sineIn"},{"index":4,"frame":0.5,"position":[0,0.5,0],"rotation":[0,1,0,0],"ease":"sineIn"},{"index":4,"frame":1,"position":[0,0,0],"rotation":[0,0,0,1],"ease":"sineOut"}],"deactivate":[{"index":4,"frame":0,"position":[0,0,0],"rotation":[0,0,0,1]},{"index":4,"frame":0.5,"position":[0,1,0],"rotation":[0,-1,0,0],"ease":"sineInOut"},{"index":4,"frame":0.7,"position":[0,-1,0],"rotation":[0,-1,0,0],"ease":"cubicIn"},{"index":4,"frame":1.2,"position":[0,0.2,0],"rotation":[0,0,0,-1],"ease":"quadOut"},{"index":4,"frame":1.6,"position":[0,-0.2,0],"ease":"cubicIn"},{"index":3,"frame":0.7,"rotation":[0,0,-0.309017,0.951057],"position":[0,1.8,0]},{"index":3,"frame":1.2,"rotation":[0,0,-0.156434,0.987688],"scale":[1,1,1],"position":[0,1.6,0],"ease":"cubicOut"},{"index":3,"frame":1.5,"rotation":[0,0,0.707107,0.707107],"ease":"sineIn"},{"index":3,"frame":1.6,"scale":[1,0,0],"position":[0,1.8,0],"ease":"quintIn"},{"index":1,"frame":0.7,"position":[0,0.7,-0.5]},{"index":2,"frame":0.7,"position":[0,0.7,0.5]},{"index":1,"frame":1.2,"position":[0,0.5,-0.7],"ease":"quadOut"},{"index":2,"frame":1.2,"position":[0,0.5,0.7],"ease":"quadOut"},{"index":1,"frame":1.6,"position":[0,0.7,-0.1],"ease":"sineIn"},{"index":2,"frame":1.6,"position":[0,0.7,0.1],"ease":"sineIn"}]},"isopod":{"activate":[{"index":0,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":1,"frame":0,"rotation":[0,0.382683,0,0.92388],"position":[0,0,0]},{"index":2,"frame":0,"position":[0,-0.5,0]},{"index":3,"frame":0.2,"position":[0,-1,0],"rotation":[0,0,0,1]},{"index":1,"frame":0.6,"rotation":[-0.146447,0.353553,0.353553,0.853554],"position":[-0.2,1.1,0],"ease":"quadInOut"},{"index":1,"frame":1.8,"rotation":[0,0.382683,0,0.92388],"position":[0,0,0],"ease":"quartIn"},{"index":2,"frame":0.6,"position":[0.5,0.7,0],"ease":"quadInOut"},{"index":2,"frame":1.2,"position":[-0.2,0.7,0],"ease":"cubicInOut"},{"index":2,"frame":1.6,"position":[0,-0.5,0],"ease":"quadIn"},{"index":3,"frame":0.6,"position":[0,1.4,0],"rotation":[0,-1,0,0],"ease":"sineOut"},{"index":3,"frame":1.2,"position":[0,0.5,0],"rotation":[0,0,0,-1],"ease":"cubicInOut"},{"index":3,"frame":1.6,"position":[0,-1,0],"ease":"sineIn"}]}}')},7716:function(e,t){"use strict";var r=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationSystem=t.ActionSignal=void 0,t.ActionSignal={WaitNextFrame:{continue:!0}};var a=function(){function e(e){this.context=e,this.index=1,this.pending=[],this.queue=[]}return e.zip=function(e){var t,a,n;return r(this,(function(r){switch(r.label){case 0:for(t=null,a=e.length-1;a>=0;a--)(n=e[a].next()).done||(t=n.value);return t?[3,1]:[3,4];case 1:return[4,t];case 2:r.sent(),r.label=3;case 3:return[3,0];case 4:return[2]}}))},e.join=function(e){var t,a,n;return r(this,(function(r){switch(r.label){case 0:t=0,r.label=1;case 1:if(!(t<e.length))return[3,7];a=e[t],r.label=2;case 2:return(n=a.next()).done?[3,6]:[3,3];case 3:return[4,n.value];case 4:r.sent(),r.label=5;case 5:return[3,2];case 6:return t++,[3,1];case 7:return[2]}}))},e.prototype.indexOf=function(e){for(var t=0;t<this.queue.length;t++){if(this.queue[t].index>e)return-1;if(this.queue[t].index===e)return t}return-1},e.prototype.await=function(e){if(null==e||-1==this.indexOf(e))return t.ActionSignal.WaitNextFrame;var r={target:e,continue:!1};return this.pending.push(r),r},e.prototype.dispatch=function(e){for(var t=0,r=0;r<this.pending.length;r++)this.pending[r].target===e?(this.pending[r].continue=!0,t++):this.pending[r-t]=this.pending[r];this.pending.length-=t},e.prototype.update=function(){for(var e=0,r=0;r<this.queue.length;r++){var a=this.queue[r];a.iterator&&a.iterator.value!==t.ActionSignal.WaitNextFrame&&!a.iterator.value.continue||(a.iterator=a.generator.next()),a.iterator.done&&this.dispatch(a.index),a.iterator.done?e++:this.queue[r-e]=a}this.queue.length-=e},e.prototype.start=function(e,t){var r={generator:e,iterator:null,index:this.index};if(t||!(r.iterator=r.generator.next()).done)return this.queue.push(r),this.index++},e}();t.AnimationSystem=a},2207:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.FollowPath=void 0;var o=r(7594),s=i(r(6992));function l(e){var t=o.vec3(),r=o.vec3();return function(a,n,i){e(a,t),o.vec3.subtract(t,i.position,r);var s=o.vec3.magnitudeSquared(r);s>0&&(o.vec3.scale(r,1/Math.sqrt(s),r),o.quat.fromNormal(r,o.vec3.AXIS_Y,i.rotation),o.quat.normalize(i.rotation,i.rotation)),o.vec3.copy(t,i.position),i.frame=0}}t.FollowPath=l,l.Line=function(e,t){return function(r,a,n){for(var i=n.path.length-1;i>=0;i--)e(r-i*t.length,n.path[i]);n.frame=0}},l.separate=function(e,t,r){return function(a,n){return n[0]=e(a,n[0]),n[1]=t(a,n[1]),n[2]=r(a,n[2]),n}},l.curve=function(e,t){return function(r,a){return r=o.clamp((r-t.frame)/t.duration,0,1),e(t.ease(r),a)}},l.spline=function(e,t,r){var a=t[0],n=t[t.length-1]-a,i=t.map((function(e){return(e-a)/n})),l=s.Spline(e.map((function(e){return e[0]})),i,3,r.tension),c=s.Spline(e.map((function(e){return e[1]})),i,3,r.tension),u=s.Spline(e.map((function(e){return e[2]})),i,3,r.tension);return function(e,t){var i=r.ease(o.clamp((e-a)/n,0,1));return o.vec3.set(l(i),c(i),u(i),t),t}}},2071:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BlendTween=t.parseEase=t.AnimationTimeline=t.EventTrigger=t.PropertyAnimation=void 0;var o=r(7594),s=i(r(6992));t.PropertyAnimation=function(e,t,r){void 0===r&&(r=1),e.sort((function(e,t){return e.frame-t.frame}));var a=e.length-1,n=0;return function(i,l){for(i*=r;;)if(n>0&&e[n].frame>i)n--;else{if(!(n<a&&e[n+1].frame<i))break;n++}var c=e[n];if(0===n&&c.frame>i)return t(l,c.value,1,l);if(n===a)return t(l,c.value,1,l);var u=e[n+1],f=o.clamp((i-c.frame)/(u.frame-c.frame),0,1);return t(c.value,u.value,(u.ease||s.linear)(f),l)}},t.EventTrigger=function(e,t){return function(r,a,n){for(var i=r-a,o=e.length,s=0;s<o&&!(e[s].frame>r);s++)e[s].frame>i&&t.call(this,n,e[s].value)}},t.EventTrigger.emit=function(e,t){return e.count+=t},t.EventTrigger.emitReset=function(e,t){for(var r in t)r in e.uniform.uniforms&&e.uniform.uniforms[r].set(t[r],0);e.count+=t.amount},t.AnimationTimeline=function(e,t){var r=Object.keys(t).map((function(r){for(var a=r.split(".").reverse(),n=e,i=a.length-1;i>0;i--)n=n[a[i]];return{sampler:t[r],property:a[0],target:n}}));return function(t,a){for(var n=r.length-1;n>=0;n--){var i=r[n],o=i.sampler,s=i.property,l=i.target;3===o.length?o.call(e,t,a,l[s]):l[s]=o.call(e,t,l[s]),isNaN(l.frame)||(l.frame=0)}}},t.parseEase=function(e){if(e){var t=e.split(","),r=t[0],a=t.slice(1);return a.length?s[r].apply(s,a.map(Number)):s[r]}},t.BlendTween={temp:o.quat(),vec3:function(e,t,r,a){return a[0]+=e[0]+r*(t[0]-e[0]),a[1]+=e[1]+r*(t[1]-e[1]),a[2]+=e[2]+r*(t[2]-e[2]),a},quat:function(e,r,a,n){return o.quat.slerp(e,r,a,t.BlendTween.temp),o.quat.multiply(n,t.BlendTween.temp,n),n}}},6992:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spline=t.slowInOut=t.expoInOut=t.expoOut=t.expoIn=t.circInOut=t.circOut=t.circIn=t.sineInOut=t.sineIn=t.sineOut=t.quintInOut=t.quartInOut=t.cubicInOut=t.quadInOut=t.quintOut=t.quartOut=t.cubicOut=t.quadOut=t.quintIn=t.quartIn=t.cubicIn=t.quadIn=t.cubicFadeInOut=t.fadeInOut=t.elasticOut=t.bounceIn=t.linear=t.stepped=t.CubicBezier=t.reverse=t.flip=t.join=t.split=void 0;var a=r(3850);function n(e,t,r,a,n){void 0===n&&(n=1e-5);var i=3*e,o=3*(r-e)-i,s=1-i-o,l=3*t,c=3*(a-t)-l,u=1-l-c,f=function(e){return((s*e+o)*e+i)*e},m=function(e){return(3*s*e+2*o)*e+i};return function(e){return t=function(e){if(e<0)return 0;if(e>1)return 1;for(var t=e,r=0;r<8;r++){var a=f(t)-e;if(Math.abs(a)<n)return t;var i=m(t);if(Math.abs(i)<n)break;t-=a/i}for(var o=0,s=1;o<s;){if(a=f(t),Math.abs(a-e)<n)return t;e>a?o=t:s=t,t=.5*(o+s)}return t}(e),((u*t+c)*t+l)*t;var t}}t.split=function(e,t,r){return function(a){return a<e?e*t(a/e):e+(1-e)*r((a-e)/(1-e))}},t.join=function(e,t,r){return function(a){return a<e?t(a/e):r((a-e)/(1-e))}},t.flip=function(e){return function(t){return 1-e(1-t)}},t.reverse=function(e){return function(t){return 1-e(t)}},t.CubicBezier=n,t.stepped=function(e){return e>=1?1:0},t.linear=function(e){return e},t.bounceIn=function(e,t){var r=1/(t*t),a=1/(1-t);return function(n){return n>=1?1:n<t?r*n*n:1-e*(1-Math.pow(a*(2*n-1-t),2))}},t.elasticOut=function(e,t){t/=Math.min(1,e),e=Math.max(1,e);var r=t/(2*Math.PI)*Math.asin(1/e)||0,a=2*Math.PI/t;return function(t){return e*Math.pow(2,-10*t)*Math.sin((t-r)*a)+1}},t.fadeInOut=function(e){return 4*(1-e)*e};var i=1/(Math.pow(1-1/3,2)*(1/3));t.cubicFadeInOut=function(e){return i*Math.pow(1-e,2)*e},t.quadIn=function(e){return e*e},t.cubicIn=function(e){return e*e*e},t.quartIn=function(e){return e*e*e*e},t.quintIn=function(e){return e*e*e*e*e},t.quadOut=t.flip(t.quadIn),t.cubicOut=t.flip(t.cubicIn),t.quartOut=t.flip(t.quartIn),t.quintOut=t.flip(t.quintIn),t.quadInOut=t.split(.5,t.quadIn,t.quadOut),t.cubicInOut=t.split(.5,t.cubicIn,t.cubicOut),t.quartInOut=t.split(.5,t.quartIn,t.quartOut),t.quintInOut=t.split(.5,t.quintIn,t.quintOut),t.sineOut=function(e){return Math.sin(.5*e*Math.PI)},t.sineIn=t.flip(t.sineOut),t.sineInOut=t.split(.5,t.sineIn,t.sineOut),t.circIn=function(e){return 1-Math.sqrt(1-e*e)},t.circOut=t.flip(t.circIn),t.circInOut=t.split(.5,t.circIn,t.circOut),t.expoIn=function(e){return 0==e?0:Math.pow(1024,e-1)},t.expoOut=t.flip(t.expoIn),t.expoInOut=t.split(.5,t.expoIn,t.expoOut),t.slowInOut=n(0,.5,1,.5),t.Spline=function(e,t,r,n){void 0===n&&(n=.5);var i=function(e,t){return e-t},o=e.length-1;t=t||e.map((function(e,t){return t/o}));var s=1/0,l=-1/0,c=0,u=0,f=0,m=0,h=0;return function(d){if(d<=t[0])return e[0];if(d>=t[o])return e[o];if(d<s||d>=l){var v=a.binarySearch(t,d,i)-1;s=t[v],l=t[v+1],c=s===l?0:1/(l-s),u=e[v],f=e[v+1];var p=0===v?2*t[0]-t[1]:t[v-1],y=v===o-1?2*t[v+1]-t[v]:t[v+2],g=0===v?2*e[0]-e[1]:e[v-1],x=v===o-1?2*e[v+1]-e[v]:e[v+2];m=n*(l===p?0:2*(l-s)/(l-p))*(f-g),h=n*(y===s?0:2*(l-s)/(y-s))*(x-u)}var b=c*(d-s);if(0===r)return u;if(1===r)return u+b*(f-u);if(2===r)return u+b*b*(3-2*b)*(f-u);var S=b*b,P=b+b,w=1-b,T=w*w;return u*((1+P)*T)+m*(b*T)+f*(S*(3-P))+h*(S*(b-1))}}},9519:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t},o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.ease=void 0,t.ease=i(r(6992)),o(r(7716),t),o(r(2071),t),o(r(2207),t)},9637:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BatchMesh=void 0;var a=r(7594),n=r(3453),i=function(){function e(e){this.index=-1,this.frame=0,this.order=0,this.color=a.vec4(1,1,1,1),this.bounds=new n.BoundingVolume,this.indices=e.indexArray,this._vertices=e.vertexArray;var t=e.vertexArray.byteLength/e.format[1].stride;this.vertices=new Float32Array(3*t),this.uvs=new Float32Array(2*t),this.normals=new Float32Array(3*t),this.boundingRadius=n.calculateBoundingRadius(e.vertexArray,e.format[1].stride/Float32Array.BYTES_PER_ELEMENT,e.format[1].offset/Float32Array.BYTES_PER_ELEMENT)}return e.prototype.update=function(e,t){if(!(this.frame>0&&this.frame>=this.transform.frame)){this.frame=e.frame;for(var r=this.vertices.length/3,a=this.transform.matrix,n=this.transform.calculateNormalMatrix(),i=r-1;i>=0;i--){var o=this._vertices[8*i+0],s=this._vertices[8*i+1],l=this._vertices[8*i+2];if(this.vertices[3*i+0]=a[0]*o+a[4]*s+a[8]*l+a[12],this.vertices[3*i+1]=a[1]*o+a[5]*s+a[9]*l+a[13],this.vertices[3*i+2]=a[2]*o+a[6]*s+a[10]*l+a[14],this.uvs[2*i+0]=this._vertices[8*i+6],this.uvs[2*i+1]=this._vertices[8*i+7],this.normals){var c=this._vertices[8*i+3],u=this._vertices[8*i+4],f=this._vertices[8*i+5];this.normals[3*i+0]=n[0]*c+n[3]*u+n[6]*f,this.normals[3*i+1]=n[1]*c+n[4]*u+n[7]*f,this.normals[3*i+2]=n[2]*c+n[5]*u+n[8]*f;var m=Math.hypot(this.normals[3*i+0],this.normals[3*i+1],this.normals[3*i+2]),h=m&&1/m;this.normals[3*i+0]*=h,this.normals[3*i+1]*=h,this.normals[3*i+2]*=h}}this.bounds.update(this.transform,this.boundingRadius)}},e}();t.BatchMesh=i},1189:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IKRig=t.IKChain=t.IKBone=t.LocalHingeConstraint=t.BallJointConstraint=t.SwingTwistConstraint=void 0;var a=r(7594),n=function(){function e(){this.localRotation=a.quat(),this.twist=a.quat(),this.swing=a.quat(),this.swingAngle=Math.PI,this.twistAngle=0*Math.PI}return e.prototype.apply=function(e,t,r){a.quat.conjugate((null==t?void 0:t.rotation)||a.quat.IDENTITY,this.localRotation),a.quat.multiply(this.localRotation,r,this.localRotation),a.quat.decompose(this.localRotation,s.FORWARD,this.swing,this.twist),this.limitRotation(this.swing,this.swingAngle),this.limitRotation(this.twist,this.twistAngle),a.quat.multiply(this.swing,this.twist,this.localRotation),a.quat.multiply((null==t?void 0:t.rotation)||a.quat.IDENTITY,this.localRotation,r),a.quat.normalize(r,r)},e.prototype.limitRotation=function(e,t){var r=Math.sin(.5*t),n=r*r;a.vec3.magnitudeSquared(e)<=n||(a.vec3.normalize(e,e),a.vec3.scale(e,r,e),e[3]=Math.sqrt(1-n)*(e[3]<0?-1:1))},e}();t.SwingTwistConstraint=n;var i=function(){function e(){this.localRotation=a.quat(),this.localDirection=a.vec3(),this.rotor=Math.PI,this.axis=a.vec3.copy(s.FORWARD,a.vec3())}return e.prototype.apply=function(e,t,r){a.quat.conjugate((null==t?void 0:t.rotation)||a.quat.IDENTITY,this.localRotation),a.quat.multiply(this.localRotation,r,this.localRotation),a.quat.transform(s.FORWARD,this.localRotation,this.localDirection);var n=a.vec3.angle(this.axis,this.localDirection);if(n<Number.EPSILON)a.quat.copy(a.quat.IDENTITY,this.localRotation);else{var i=a.vec3.cross(s.FORWARD,this.localDirection,this.localDirection);a.vec3.normalize(i,i),a.quat.axisAngle(i,a.clamp(n,0,this.rotor),this.localRotation)}a.quat.multiply((null==t?void 0:t.rotation)||a.quat.IDENTITY,this.localRotation,r),a.quat.normalize(r,r)},e}();t.BallJointConstraint=i;var o=function(){function e(){this.localRotation=a.quat(),this.localDirection=a.vec3(),this.referenceAxis=a.vec3(),this.projectedDirection=a.vec3(),this.min=-Math.PI,this.max=Math.PI,this.axis=a.vec3.copy(s.LEFT,a.vec3())}return e.prototype.apply=function(e,t,r){a.quat.conjugate((null==t?void 0:t.rotation)||a.quat.IDENTITY,this.localRotation),a.quat.multiply(this.localRotation,r,this.localRotation),a.quat.transform(s.FORWARD,this.localRotation,this.localDirection),this.limitAxis(this.axis,this.localDirection,this.min,this.max,this.localRotation),a.quat.multiply((null==t?void 0:t.rotation)||a.quat.IDENTITY,this.localRotation,r),a.quat.normalize(r,r)},e.prototype.limitAxis=function(e,t,r,n,i){var o=a.vec3.projectPlane(t,e,this.projectedDirection);if(a.vec3.dot(o,o)<Number.EPSILON)return a.quat.copy(a.quat.IDENTITY,i);var l=a.vec3.projectPlane(s.FORWARD,e,this.referenceAxis),c=a.vec3.angle(o,l),u=a.vec3.dot(e,a.vec3.cross(l,o,o))<0?-1:1;a.quat.axisAngle(e,a.clamp(c*u,r,n),i)},e}();t.LocalHingeConstraint=o;var s=function(){function e(){this.start=a.vec3(),this.end=a.vec3(),this.direction=a.vec3(),this.rotation=a.quat(),this.inverseBind=a.quat(),this.index=-1,this.length=0}return e.prototype.set=function(t,r){a.vec3.copy(t,this.start),a.vec3.copy(r,this.end),this.length=a.vec3.distance(this.start,this.end),a.vec3.subtract(this.end,this.start,this.direction),a.vec3.normalize(this.direction,this.direction),a.quat.fromNormal(this.direction,e.UP,this.rotation),a.quat.normalize(this.rotation,this.rotation)},e.UP=a.vec3.AXIS_Y,e.FORWARD=a.vec3.AXIS_Z,e.LEFT=a.vec3.AXIS_X,e}();t.IKBone=s;var l=function(){function e(){this.buffer=new Float32Array(0),this.bones=[],this.length=0,this.origin=a.vec3(),this.target=a.vec3(),this.lastOrigin=a.vec3(),this.lastTarget=a.vec3()}return Object.defineProperty(e.prototype,"first",{get:function(){return this.bones[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"last",{get:function(){return this.bones[this.bones.length-1]},enumerable:!1,configurable:!0}),e.prototype.add=function(e){var t=new s;return t.set(this.last?this.last.end:this.origin,e),this.bones.push(t),this.length+=t.length,t},e.prototype.remove=function(e){var t=this.bones.indexOf(e);-1!=t&&(this.length-=e.length,this.bones.splice(t,1))},e.prototype.solveFABRIK=function(){var t=this.target,r=this.parent,n=e.direction,i=e.rotation;if(null!=t)for(var o=t,l=this.bones.length-1;l>=0;l--){var c=this.bones[l];if(a.vec3.copy(o,c.end),a.vec3.subtract(c.end,c.start,n),a.vec3.normalize(n,n),a.quat.unitRotation(c.direction,n,i),a.quat.multiply(i,c.rotation,c.rotation),a.quat.normalize(c.rotation,c.rotation),l<this.bones.length-1){var u=this.bones[l+1];u.joint.apply(u,c,a.quat.copy(u.rotation,i));var f=a.quat.conjugate(i,i);a.quat.multiply(f,u.rotation,f),a.quat.multiply(f,c.rotation,c.rotation),a.quat.normalize(c.rotation,c.rotation)}a.quat.transform(s.FORWARD,c.rotation,c.direction),a.vec3.scale(c.direction,-c.length,c.start),o=a.vec3.add(c.end,c.start,c.start)}for(o=r?r.end:this.first.start,l=0;l<this.bones.length;l++)c=this.bones[l],a.vec3.copy(o,c.start),a.vec3.subtract(c.end,c.start,n),a.vec3.normalize(n,n),a.quat.unitRotation(c.direction,n,i),a.quat.multiply(i,c.rotation,c.rotation),a.quat.normalize(c.rotation,c.rotation),c.joint.apply(c,this.bones[l-1]||r,c.rotation),a.quat.transform(s.FORWARD,c.rotation,c.direction),a.vec3.scale(c.direction,c.length,c.end),o=a.vec3.add(c.start,c.end,c.end);return t?a.vec3.distance(this.last.end,t):0},e.prototype.solveCCD=function(){for(var t=this.target,r=this.parent,n=e.direction,i=e.rotation,o=e.temp,l=this.bones.length-1;l>=0;l--){var c=this.bones[l],u=a.vec3.subtract(this.last.end,c.start,n),f=a.vec3.subtract(t,c.start,c.direction),m=a.vec3.angle(u,f),h=a.vec3.cross(u,f,n);a.vec3.normalize(h,h),a.quat.axisAngle(h,m,i),a.quat.multiply(i,c.rotation,i),a.quat.normalize(i,i),c.joint.apply(c,this.bones[l-1]||r,i),a.quat.multiply(i,a.quat.conjugate(c.rotation,o),i);for(var d=l,v=c.start;d<this.bones.length;d++){var p=this.bones[d];a.vec3.copy(v,p.start),a.quat.multiply(i,p.rotation,p.rotation),a.quat.normalize(p.rotation,p.rotation),a.quat.transform(s.FORWARD,p.rotation,p.direction),a.vec3.scale(p.direction,p.length,p.end),v=a.vec3.add(p.start,p.end,p.end)}}return a.vec3.distance(this.last.end,t)},e.prototype.serialize=function(){this.buffer.length!=4*this.bones.length+4&&(this.buffer=new Float32Array(4*this.bones.length+4)),this.buffer.set(this.first.start,0);for(var e=0;e<this.bones.length;e++)this.buffer.set(this.bones[e].rotation,4+4*e);return this.buffer},e.prototype.deserialize=function(e){for(var t=e,r=0;r<this.bones.length;r++){var n=this.bones[r],i=4+4*r;a.quat.set(e[i+0],e[i+1],e[i+2],e[i+3],n.rotation),a.vec3.copy(t,n.start),a.quat.transform(s.FORWARD,n.rotation,n.direction),a.vec3.scale(n.direction,n.length,n.end),t=a.vec3.add(n.start,n.end,n.end)}},e.direction=a.vec3(),e.rotation=a.quat(),e.temp=a.quat(),e}();t.IKChain=l;var c=function(){function e(){this.chains=[],this.precision=1e-6,this.iterations=16,this.distanceThreshold=.1,this.deltaDistanceThreshold=.001,this.mode=0,this.enabled=!0}return e.prototype.update=function(){if(this.enabled)for(var e=this.chains.length-1;e>=0;e--){var t=this.chains[e],r=t.parent?t.parent.end:t.origin,n=t.target||a.vec3.ZERO;a.vec3.equals(r,t.lastOrigin,this.precision)&&a.vec3.equals(n,t.lastTarget,this.precision)||(a.vec3.copy(r,t.lastOrigin),a.vec3.copy(n,t.lastTarget),t.deserialize(this.solve(t)))}},e.prototype.solve=function(e){for(var t,r=1/0,a=1/0,n=this.iterations;n>0;n--){var i=this.mode?e.solveFABRIK():e.solveCCD();if(i<r){if(r=i,t=e.serialize(),r<=this.distanceThreshold)break}else if(Math.abs(i-a)<this.deltaDistanceThreshold)break;a=i}return t},e.prototype.add=function(e,t){var r=new l;return a.vec3.copy(e,r.origin),r.parent=t,this.chains.push(r),r},e.prototype.remove=function(e){var t=this.chains.indexOf(e);this.chains.splice(t,1)},e}();t.IKRig=c},6885:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Line=void 0;var a=r(8716),n=r(7594),i=r(3335),o=r(2130),s=function(){function e(e){this.order=0,this.frame=0,this.vertices=new Float32Array(0),this.uvs=new Float32Array(0),this.indices=new Uint16Array(0),this.color=n.vec4(1,1,1,1),this.normal=n.vec3(0,1,0),this.bounds=new i.BoundingVolume,this.ease=a.One,this.width=1,this.height=0,e&&(this.path=n.range(e).map((function(e){return n.vec3()})))}return e.prototype.update=function(t,r){if(!(this.frame>0&&this.frame>=r.frame)){this.frame=t.frame;var a=this.path.length;this.vertices&&this.vertices.length==6*a||this.resize(a);var i=e.forward,o=e.normal,s=e.tangent;n.vec3.copy(n.vec3.ZERO,s),n.vec3.set(-r.viewMatrix[2],-r.viewMatrix[6],-r.viewMatrix[10],i);for(var l=0,c=0;c<a;c++){var u=this.path[c],f=this.path[c+1]||u;n.vec3.subtract(f,u,o),n.vec3.normalize(o,o),n.vec3.add(s,o,s),n.vec3.cross(i,s,s),n.vec3.normalize(s,s),n.vec3.scale(s,.5*this.ease(c/(a-1))*this.width,s),this.vertices[6*c+0]=u[0]-s[0],this.vertices[6*c+1]=u[1]-s[1],this.vertices[6*c+2]=u[2]-s[2],this.vertices[6*c+3]=u[0]+s[0],this.vertices[6*c+4]=u[1]+s[1],this.vertices[6*c+5]=u[2]+s[2],n.vec3.copy(o,s),l+=n.vec3.distanceSquared(u,f)}this.height=Math.sqrt(l)/this.width,this.bounds.fromVertices(this.vertices,3,0,t.frame)}},e.prototype.resize=function(e){this.vertices=new Float32Array(2*e*3),this.uvs=new Float32Array(2*e*2),this.indices=new Uint16Array(6*(e-1));for(var t=e-2;t>=0;t--)this.indices[6*t+0]=2*t+0,this.indices[6*t+1]=2*t+1,this.indices[6*t+2]=2*t+2,this.indices[6*t+3]=2*t+2,this.indices[6*t+4]=2*t+1,this.indices[6*t+5]=2*t+3;for(t=e-1;t>=0;t--)this.uvs[4*t+1]=this.uvs[4*t+3]=1-t/(e-1),this.uvs[4*t+0]=0,this.uvs[4*t+2]=1},e.prototype.addColorFade=function(e,t){void 0===t&&(t=n.vec3.ONE),this.colors&&this.colors.length==2*this.path.length||(this.colors=new Uint32Array(2*this.path.length));for(var r=0;r<this.colors.length;r++){var a=e(Math.floor(r/2)/(this.path.length-1));this.colors[r]=o.uintNorm4x8(t[0]*a,t[1]*a,t[2]*a,a)}},e.forward=n.vec3(),e.normal=n.vec3(),e.tangent=n.vec3(),e}();t.Line=s},8783:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.MeshSystem=t.Mesh=t.Armature=void 0;var i=r(7594),o=r(8716),s=r(556),l=r(3335),c=r(43),u=r(6256),f=r(6240),m=function(){function e(e,t,r){var a=this;this.inverseBindPose=e,this.key=t,this.frame=0,this.boneMatrix=new Float32Array(12*r.length),this.nodes=r.map((function(e,t){var r=e.position,n=e.rotation,o=e.scale;return{parent:e.parent,position:i.vec3.copy(r||i.vec3.ZERO,i.vec3()),rotation:i.quat.copy(n||i.quat.IDENTITY,i.quat()),scale:i.vec3.copy(o||i.vec3.ONE,i.vec3()),globalTransform:i.mat4(),transform:new Float32Array(a.boneMatrix.buffer,12*t*Float32Array.BYTES_PER_ELEMENT,12)}}))}return e.prototype.update=function(t){if(!this.frame){this.frame=t.frame;for(var r=0;r<this.nodes.length;r++){var a=this.nodes[r];i.quat.normalize(a.rotation,a.rotation),i.mat4.fromRotationTranslationScale(a.rotation,a.position,a.scale,a.globalTransform),-1!=a.parent&&i.mat4.multiply(this.nodes[a.parent].globalTransform,a.globalTransform,a.globalTransform),i.mat4.multiply(a.globalTransform,this.inverseBindPose[r],e.tempMat4),i.mat4.transpose(e.tempMat4,a.transform)}}},e.prototype.updateBone=function(t){var r=this.nodes[t];i.mat4.multiply(r.globalTransform,this.inverseBindPose[t],e.tempMat4),i.mat4.transpose(e.tempMat4,r.transform)},e.tempMat4=i.mat4(),e}();t.Armature=m;var h=function(){function e(){this.index=-1,this.frame=0,this.order=0,this.layer=0,this.startTime=0,this.bounds=new l.BoundingVolume,this.color=i.vec4(1,1,1,1)}return e.prototype.update=function(e){var t;this.frame&&this.frame>=this.transform.frame||(this.frame=e.frame,this.uniform||(this.uniform=new s.UniformBlock(e.gl,{byteSize:88},s.UniformBlockBindings.ModelUniforms)),this.bounds.update(this.transform,this.buffer.radius),this.uniform.data.set((null===(t=this.transform)||void 0===t?void 0:t.matrix)||i.mat4.IDENTITY,0),this.uniform.data.set(this.color,16),this.uniform.data[20]=this.layer,this.uniform.data[21]=this.startTime)},e}();t.Mesh=h;var d=function(e){function t(t){var r=e.call(this,h)||this;r.context=t,r.models=Object.create(null);var a=f.createPlane({width:2,height:-2,columns:1,rows:1});return r.plane=r.uploadVertexData(a.vertexArray,a.indexArray,a.format),r}return n(t,e),t.prototype.delete=function(t){e.prototype.delete.call(this,t),t.frame=t.layer=t.order=0,t.armature=t.material=t.buffer=t.transform=null,i.vec4.copy(i.vec4.ONE,t.color)},t.prototype.unloadVertexData=function(e){this.context.gl.deleteBuffer(e.vbo),this.context.gl.deleteBuffer(e.ibo),this.context.gl.deleteVertexArray(e.vao)},t.prototype.updateVertexData=function(e,t){var r=this.context.gl;e.frame=this.context.frame,r.bindBuffer(34962,e.vbo),r.bufferSubData(34962,0,t,0,t.length),i.aabb3.calculate(t,e.format[1].stride,e.format[1].offset,e.aabb),e.radius=l.calculateBoundingRadius(t,e.format[1].stride,e.format[1].offset)},t.prototype.uploadVertexData=function(e,t,r,a){var n=this.context.gl,o=n.createVertexArray();n.bindVertexArray(o);var s=n.createBuffer();n.bindBuffer(34962,s),n.bufferData(34962,e,a?35048:35044);for(var c=1;c<r.length;c++){var u=r[c],f=u.size,m=u.type,h=u.normalized,d=u.stride,v=u.offset;n.enableVertexAttribArray(c-1),n.vertexAttribPointer(c-1,f,m,h,d,v),r[c].divisor&&n.vertexAttribDivisor(c-1,r[c].divisor)}var p=n.createBuffer();return n.bindBuffer(34963,p),n.bufferData(34963,t,35044),n.bindVertexArray(null),{vbo:s,ibo:p,frame:this.context.frame,vao:o,indexCount:t.length,indexOffset:0,format:r,drawMode:4,aabb:i.aabb3.calculate(e,r[1].stride,r[1].offset,i.aabb3()),radius:l.calculateBoundingRadius(e,r[1].stride,r[1].offset)}},t.prototype.update=function(){for(var e,t,r,a=this.list.length-1;a>=0;a--)if(0!=this.list[a].color[3]){if(a>0&&this.list[a-1].order>this.list[a].order){var n=this.list[a];this.list[a]=this.list[a-1],this.list[a-1]=n,this.list[a].index=a,this.list[a-1].index=a-1}var i=this.list[a];i.update(this.context),null===(e=i.armature)||void 0===e||e.update(this.context),null===(r=null===(t=i.armature)||void 0===t?void 0:t.ik)||void 0===r||r.update()}},t.prototype.load=function(e,t){for(var r=t.buffers[0],a=function(t){var a=e.model[t],i=new Float32Array(r,a.vertices.byteOffset,a.vertices.byteLength/Float32Array.BYTES_PER_ELEMENT),o=new Uint16Array(r,a.indices.byteOffset,a.indices.byteLength/Uint16Array.BYTES_PER_ELEMENT),s=e.format[a.format],l=n.uploadVertexData(i,o,s);if(n.models[a.name]={buffer:l,model:a},a.inverseBindPose&&(n.models[a.name].inverseBindPose=a.armature.map((function(e,t){return new Float32Array(r,a.inverseBindPose.byteOffset+16*t*Float32Array.BYTES_PER_ELEMENT,16)}))),-1!=a.texture){var f=n.models[a.name].material=new c.MeshMaterial;f.program=n.context.get(u.DeferredGeometryPass).programs[a.armature?1:2],f.diffuse=n.context.get(c.MaterialSystem).materials[a.texture].diffuse,f.normal=n.context.get(c.MaterialSystem).materials[a.texture].normal,f.index=n.context.get(c.MaterialSystem).materials[a.texture].index}},n=this,i=0;i<e.model.length;i++)a(i)},t.prototype.loadModel=function(e){var t=this.create(),r=this.models[e],a=r.model,n=r.inverseBindPose,i=r.buffer,o=r.material;return t.layer=a.armature?4:2,t.buffer=i,t.material=o,a.armature&&(t.armature=new m(n,a.name,a.armature)),t.order=a.armature?1:2,t},t}(o.Factory);t.MeshSystem=d},2721:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite=void 0;var a=r(7594),n=r(3335),i=function(){function e(){this.billboard=0,this.index=-1,this.frame=0,this.order=0,this.vertices=new Float32Array(12),this.uvs=e.quadUVs,this.indices=e.quadIndices,this.color=a.vec4(1,1,1,1),this.normal=a.vec3(1,0,0),this.bounds=new n.BoundingVolume,this.origin=a.vec2(.5,.5)}return e.prototype.update=function(t,r){if(!(this.frame>0&&this.frame>=r.frame&&this.frame>=this.transform.frame)){var n=1*-this.origin[0],i=n+1,o=1*-this.origin[1],s=o+1;(!this.frame||this.frame<this.transform.frame)&&this.bounds.update(this.transform,Math.max(1,1));var l=this.transform.matrix,c=e.tangent,u=e.binormal,f=e.forward,m=this.normal;switch(this.billboard){case 0:a.vec3.set(l[0],l[1],l[2],c),a.vec3.set(l[4],l[5],l[6],u),a.vec3.set(l[8],l[9],l[10],m),a.vec3.set(r.viewMatrix[2],r.viewMatrix[6],r.viewMatrix[10],f),a.vec3.scale(c,Math.sign(a.vec3.dot(f,m)),c);break;case 2:a.vec3.set(r.viewMatrix[0],r.viewMatrix[4],r.viewMatrix[8],c),a.vec3.set(r.viewMatrix[1],r.viewMatrix[5],r.viewMatrix[9],u),a.vec3.scale(c,this.transform.scale[0],c),a.vec3.scale(u,this.transform.scale[1],u),a.vec3.cross(c,u,m);break;case 3:a.vec3.set(l[4],l[5],l[6],c),a.vec3.set(l[12],l[13],l[14],f),a.vec3.subtract(r.position,f,f),a.vec3.cross(f,c,u),a.vec3.normalize(u,u),a.vec3.scale(u,Math.hypot(l[0],l[1],l[2]),u),a.vec3.cross(c,u,m)}this.vertices[0]=c[0]*n+u[0]*o+l[12],this.vertices[1]=c[1]*n+u[1]*o+l[13],this.vertices[2]=c[2]*n+u[2]*o+l[14],this.vertices[3]=c[0]*i+u[0]*o+l[12],this.vertices[4]=c[1]*i+u[1]*o+l[13],this.vertices[5]=c[2]*i+u[2]*o+l[14],this.vertices[6]=c[0]*i+u[0]*s+l[12],this.vertices[7]=c[1]*i+u[1]*s+l[13],this.vertices[8]=c[2]*i+u[2]*s+l[14],this.vertices[9]=c[0]*n+u[0]*s+l[12],this.vertices[10]=c[1]*n+u[1]*s+l[13],this.vertices[11]=c[2]*n+u[2]*s+l[14],this.frame=t.frame}},e.FlatUp=a.quat.axisAngle(a.vec3.AXIS_X,.5*Math.PI,a.quat()),e.FlatDown=a.quat.axisAngle(a.vec3.AXIS_X,-.5*Math.PI,a.quat()),e.quadIndices=new Uint16Array([0,1,2,0,2,3]),e.quadUVs=new Float32Array([0,0,1,0,1,1,0,1]),e.tangent=a.vec3(),e.binormal=a.vec3(),e.forward=a.vec3(),e}();t.Sprite=i},216:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite2D=t.Sprite2DMaterial=void 0;var a=r(7594),n=function(){function e(){this.size=a.vec2(1,1),this.uvMatrix=a.mat3x2(),this.domain=a.vec3(0,0,0)}return e.create=function(t,r,n){var i=new e;return e.calculateUVMatrix(r,n,i.uvMatrix),a.vec2.set(r[2]-r[0],r[3]-r[1],i.size),i.diffuse=t,i},e.calculateUVMatrix=function(e,t,r){return r[0]=(e[2]-e[0]-1)/t[0],r[1]=0,r[2]=0,r[3]=(e[3]-e[1]-1)/t[1],r[4]=(e[0]+.5)/t[0],r[5]=(e[1]+.5)/t[1],r},e.prototype.bind=function(e){e.cullFace(1029),e.enable(2884),e.depthFunc(515),e.enable(2929),e.enable(3042),e.blendFuncSeparate(1,771,0,1)},e.prototype.merge=function(e){return this===e||this.program===e.program&&("uSamplers"in this.program.uniforms||this.diffuse===e.diffuse)},e}();t.Sprite2DMaterial=n;var i=function(){function e(){this.index=-1,this.frame=0,this.order=0,this.vertices=new Float32Array(8),this.uvs=new Float32Array(8),this.indices=e.quadIndices,this.color=a.vec4(1,1,1,1),this.origin=a.vec2(0,0)}return e.prototype.update=function(t){if(this.material&&(0==this.frame&&this.applyTransform(e.quadUVs,this.material.uvMatrix,this.uvs,0),!(this.frame>0&&this.frame>=this.transform.frame))){var r=this.transform.matrix,a=r[0],n=r[1],i=r[2],o=r[3],s=r[4],l=r[5],c=this.material.size[0],u=this.material.size[1],f=-this.origin[0]*c,m=f+c,h=-this.origin[1]*u,d=h+u;this.vertices[0]=a*f+i*h+s,this.vertices[1]=o*h+n*f+l,this.vertices[2]=a*m+i*h+s,this.vertices[3]=o*h+n*m+l,this.vertices[4]=a*m+i*d+s,this.vertices[5]=o*d+n*m+l,this.vertices[6]=a*f+i*d+s,this.vertices[7]=o*d+n*f+l,this.frame=t.frame}},e.prototype.applyTransform=function(e,t,r,a){void 0===a&&(a=0);for(var n=t[0],i=t[1],o=t[2],s=t[3],l=t[4],c=t[5],u=e.length-1;u>0;u-=2){var f=e[u-1],m=e[u];r[a+u-1]=n*f+o*m+l,r[a+u]=i*f+s*m+c}},e.quadIndices=new Uint16Array([0,1,2,0,2,3]),e.quadUVs=new Float32Array([0,0,1,0,1,1,0,1]),e}();t.Sprite2D=i},391:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(8783),t),n(r(2721),t),n(r(6885),t),n(r(9637),t),n(r(216),t),n(r(1189),t)},1481:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Monitor=void 0;var r=function(){function e(e){var t=this;this.options=e,this.dom=document.createElement("div"),this.label=document.createElement("div"),this.canvas=document.createElement("canvas"),this.prevTimestamp=0,this.timeElapsed=0,this.values=[],this.update=function(e){var r=e-t.prevTimestamp;t.prevTimestamp=e,t.timeElapsed+=r,t.options.update&&t.options.update.call(t,r),t.timeElapsed>=t.options.refreshRate&&(t.timeElapsed=0,t.render()),requestAnimationFrame(t.update)},Object.assign(this.dom.style,{display:"inline-block",padding:"0.2em",backgroundColor:"rgba(0,0,0,1)",color:e.color}),this.dom.appendChild(this.label),Object.assign(this.canvas.style,{boxSizing:"border-box",border:"1px solid "+e.color}),this.dom.appendChild(this.canvas),Object.assign(this.canvas,{width:72,height:36}),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.ctx.imageSmoothingEnabled=!1,this.update(0)}return e.prototype.render=function(){var e=this,t=e.ctx,r=e.canvas,a=e.values,n=e.options,i=n.range,o=n.color;t.globalCompositeOperation="copy",t.drawImage(r,0,0,r.width,r.height,1,0,r.width,r.height),t.globalCompositeOperation="source-over";var s=a.reduce((function(e,t){return e+t}),0)/a.length;a.length=0;var l=(s-i[0])/(i[1]-i[0])*r.height|0;t.fillStyle=o,t.fillRect(0,r.height-l,1,l),this.label.innerText=this.options.label+": "+s.toFixed(2)},e}();t.Monitor=r},6786:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkeletonHelper=void 0;var a=r(7594),n=r(556),i=r(8211),o=r(6240),s=r(43),l=r(3335),c=r(391),u=function(){function e(e){this.context=e,this.enabled=!1,this.material=new s.MeshMaterial,this.material.program=n.ShaderProgram(this.context.gl,i.shaders.geometry_vert,i.shaders.geometry_frag,{}),this.material.diffuse=n.createTexture(this.context.gl,{width:1,height:1,data:new Uint8Array([255,255,255,127])});var t=o.applyTransform(o.createBox({width:1,height:1,depth:1,open:!1}),a.mat4.fromRotationTranslationScale(a.quat.IDENTITY,[0,0,.5],[.04,.04,1],a.mat4()));this.buffer=this.context.get(c.MeshSystem).uploadVertexData(t.vertexArray,t.indexArray,t.format,!1),this.uniform=new n.UniformBlock(this.context.gl,{byteSize:88},n.UniformBlockBindings.ModelUniforms),this.modelMatrix=this.uniform.data.subarray(0,16),this.color=this.uniform.data.subarray(16,20)}return e.prototype.update=function(){if(this.enabled){var e=this.context.gl,t=this.context.get(c.MeshSystem).list,r=this.context.get(l.CameraSystem).camera;e.useProgram(this.material.program.target),this.material.bind(e),e.bindVertexArray(this.buffer.vao);for(var i=t.length-1;i>=0;i--){var o=t[i];if(0!==o.color[3]&&o.armature&&r.culling.cull(o.bounds,o.layer)){for(var s=0;s<o.armature.nodes.length;s++){var u=o.armature.nodes[s];a.mat4.multiply(o.transform.matrix,u.globalTransform,this.modelMatrix),a.mat4.rotate(this.modelMatrix,-.5*Math.PI,a.vec3.AXIS_X,this.modelMatrix),a.vec4.set(.8,.7,.2,1,this.color),this.uniform.bind(e,n.UniformBlockBindings.ModelUniforms),e.drawElements(4,this.buffer.indexCount,5123,this.buffer.indexOffset)}if(o.armature.ik)for(var f=o.armature.ik,m=0;m<f.chains.length;m++)for(s=0;s<f.chains[m].bones.length;s++){var h=f.chains[m].bones[s];a.mat4.fromRotationTranslationScale(h.rotation,h.start,[2,2,h.length],this.modelMatrix),f.chains[m].target&&a.mat4.multiply(o.transform.matrix,this.modelMatrix,this.modelMatrix),a.vec4.set(.8,.2,.7,1,this.color),this.uniform.bind(e,n.UniformBlockBindings.ModelUniforms),e.drawElements(4,this.buffer.indexCount,5123,this.buffer.indexOffset)}}}}},e}();t.SkeletonHelper=u},7953:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebugSystem=void 0;var a=r(7594),n=r(556),i=r(8211),o=r(6256),s=r(6786),l=r(1481),c=function(){function e(e){this.context=e,this.skeleton=new s.SkeletonHelper(this.context),window.app=e,this.textureProgram=n.ShaderProgram(this.context.gl,i.shaders.fullscreen_vert,i.shaders.fullscreen_frag),this.textureProgram.uniforms.uMask=a.vec4.ONE,this.cubemapProgram=n.ShaderProgram(this.context.gl,i.shaders.fullscreen_vert,i.shaders.fullscreen_frag,{CUBEMAP:!0}),this.cubemapProgram.uniforms.uMask=a.vec4.ONE,this.attachDebugPanel()}return e.prototype.update=function(){this.skeleton.update(),this.texture&&this.renderDebugTexture(this.texture,3553),this.cubemap&&this.renderDebugTexture(this.cubemap,34067)},e.prototype.renderDebugTexture=function(e,t){void 0===t&&(t=3553);var r=this.context.gl,a=this.context.get(o.PostEffectPass).plane;switch(r.bindFramebuffer(36160,null),r.bindVertexArray(a.vao),t){case 3553:r.useProgram(this.textureProgram.target);break;case 34067:r.useProgram(this.cubemapProgram.target)}r.activeTexture(33984+n.UniformSamplerBindings.uSampler),r.bindTexture(t,e),r.drawElements(4,a.indexCount,5123,a.indexOffset)},e.prototype.attachDebugPanel=function(){var e=document.createElement("div");Object.assign(e.style,{position:"fixed",top:0,left:0,zIndex:128,fontSize:"0.8em"});var t=new l.Monitor({refreshRate:100,color:"#83e82a",label:"FPS",range:[0,60],update:function(e){this.values.push(1e3/e)}}),r={drawElements:0,drawArrays:0,drawArraysInstanced:0,drawElementsInstanced:0,blitFramebuffer:0},a=function(e){var t;n.context.gl[e]=(t=n.context.gl[e],function(){return r[e]++,t.apply(this,arguments)})},n=this;for(var i in r)a(i);var o=new l.Monitor({refreshRate:100,color:"#e8632a",label:"DC",range:[0,40],update:function(e){this.values.push(r.drawArrays+r.drawElements+r.drawArraysInstanced+r.drawElementsInstanced+r.blitFramebuffer),r.drawArrays=r.drawElements=r.drawArraysInstanced=r.drawElementsInstanced=r.blitFramebuffer=0}});e.appendChild(t.dom),e.appendChild(o.dom),document.body.appendChild(e)},e}();t.DebugSystem=c},4209:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardSystem=void 0;var r=function(){function e(e){var t=this;this.context=e,this.keys=Object.create(null),addEventListener("keydown",(function(e){t.keys[e.code]>0||(t.keys[e.code]=t.context.frame+1)})),addEventListener("keyup",(function(e){t.keys[e.code]=-t.context.frame-1}))}return e.prototype.update=function(){},e.prototype.down=function(e){return this.keys[e]>0},e.prototype.trigger=function(e){return this.keys[e]===this.context.frame},e.prototype.release=function(e){return this.keys[e]===-this.context.frame},e}();t.KeyboardSystem=r},557:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(4209),t)},2434:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Application=void 0;var a=r(2234),n=r(556),i=function(){function e(t){var r=this;this.canvas=document.createElement("canvas"),this.loader=new a.Loader,this.systems=[],this.previousTimestamp=0,this.timeScale=1,this.frame=0,this.currentTime=0,this.update=function(t){r.deltaTime=.001*r.timeScale*Math.min(e.timestep,t-r.previousTimestamp),r.previousTimestamp=t,r.currentTime+=r.deltaTime,r.frame++;for(var a=0;a<r.systems.length;a++)r.systems[a].update();requestAnimationFrame(r.update)},this.canvas.width=600,this.canvas.height=400,this.gl=new n.WebGLState(this.canvas.getContext("webgl2",{alpha:!1,antialias:!1,depth:!0,stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}));for(var i=0;i<t.length;i++)null==t[i].index&&(t[i].index=i),this.systems[t[i].index]=new t[i](this);a.Loader.awaitDocumentLoad((function(){return document.body.appendChild(r.canvas)}))}return e.prototype.get=function(e){return this.systems[e.index]},e.prototype.load=function(e){var t=this;this.loader.load(e,(function(r){for(var n=0;n<t.systems.length;n++)t.systems[n].load&&t.systems[n].load(e,r);a.Loader.awaitUserGesture((function(){return t.update(0)}))}))},e.timestep=2e3/60,e}();t.Application=i},3891:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryHeap=void 0;var r=function(){function e(e){this.comparator=e,this.list=[]}return e.prototype.moveUp=function(e,t,r,a){for(void 0===t&&(t=e.length-1),void 0===r&&(r=e[t]);;){var n=t-1>>1;if(n<0||a(r,e[n])>=0)break;e[t]=e[t=n]}e[t]=r},e.prototype.moveDown=function(e,t,r,a){if(void 0===t&&(t=0),void 0===r&&(r=e[t]),!(t>=e.length)){for(;;){var n=2*t+1;if(n+1<e.length&&a(e[n],e[n+1])>0&&n++,n>=e.length||a(r,e[n])<=0)break;e[t]=e[t=n]}e[t]=r}},Object.defineProperty(e.prototype,"length",{get:function(){return this.list.length},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this.moveUp(this.list,this.list.length,e,this.comparator)},e.prototype.get=function(e){return this.list[e]},e.prototype.shift=function(){var e=this.list[0],t=this.list.pop();return this.list.length&&this.moveDown(this.list,0,t,this.comparator),e},e.prototype.remove=function(e){var t=this.list.indexOf(e),r=this.list.pop();t!==this.list.length-1&&(this.comparator(r,e)<0?this.moveUp(this.list,t,r,this.comparator):this.moveDown(this.list,t,r,this.comparator))},e.prototype.update=function(e){this.moveUp(this.list,this.list.indexOf(e),void 0,this.comparator)},e.prototype.clear=function(){this.list.length=0},e}();t.BinaryHeap=r},294:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;var r=function(){function e(e){this.Factory=e,this.pool=[],this.list=[]}return e.prototype.create=function(){var e=this.pool.pop()||new this.Factory;return e.index=this.list.push(e)-1,e},e.prototype.delete=function(e){-1!=e.index&&(this.list[e.index]=this.list[this.list.length-1],this.list[e.index].index=e.index,this.list.length--,e.index=-1,this.pool.push(e))},e}();t.Factory=r},2234:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Loader=void 0;var r=function(){function e(){this.progressBarElement=document.querySelector(".progress_bar div")}return e.prototype.load=function(e,t){for(var r=this,a=[],n=[],i=[],o=e.texture.length+e.buffer.length,s=0,l=o,c=function(e,c){var u=0;return function(f,m){if(-1==f)return console.error(m);0==f&&m&&(l--,c[e]=m),s+=f-u,u=f,r.progressBarElement.style.width=Math.round(100*(1-s/o))+"%",0==l&&t({textures:a,buffers:n,audio:i})}},u=0;u<e.texture.length;u++)this.loadImage(e.texture[u],c(u,a));for(u=0;u<e.buffer.length;u++)this.loadFile(e.buffer[u],"arraybuffer",c(u,n))},e.prototype.loadFile=function(e,t,r){var a=new XMLHttpRequest;a.open("GET",encodeURI(e),!0),a.responseType=t||"text",a.onprogress=function(e){return e.lengthComputable&&r(1-e.loaded/e.total)},a.onreadystatechange=function(e){return a.readyState===XMLHttpRequest.DONE&&(200===a.status?r(0,a.response):r(-1,new Error(a.statusText)))},a.send()},e.prototype.loadImage=function(e,t){var r=new Image;r.crossOrigin="anonymous",r.onerror=function(r){return t(-1,new Error(""+e))},r.onload=function(e){return t(0,r)},r.src=e},e.awaitUserGesture=function(e){var t=document.querySelector(".overlay");t.addEventListener("pointerup",(function r(){t.removeEventListener("pointerup",r),t.style.opacity="0",e()}))},e.awaitDocumentLoad=function(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)},e}();t.Loader=r},4758:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.One=t.Zero=void 0,t.Zero=function(){return 0},t.One=function(){return 1}},8716:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(4758),t),n(r(3891),t),n(r(294),t),n(r(2234),t),n(r(2434),t)},4773:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBox=void 0;var a=r(8999);t.createBox=function(e){var t=.5*e.width,r=.5*e.height,n=.5*e.depth;return e.open?{format:a.VertexDataFormat.Static,vertexArray:new Float32Array([-t,-r,n,0,0,1,.75,0,t,-r,n,0,0,1,.5,0,t,r,n,0,0,1,.5,1,-t,r,n,0,0,1,.75,1,-t,-r,-n,0,0,-1,0,0,-t,r,-n,0,0,-1,0,1,t,r,-n,0,0,-1,.25,1,t,-r,-n,0,0,-1,.25,0,t,-r,-n,1,0,0,.25,0,t,r,-n,1,0,0,.25,1,t,r,n,1,0,0,.5,1,t,-r,n,1,0,0,.5,0,-t,-r,-n,-1,0,0,1,0,-t,-r,n,-1,0,0,.75,0,-t,r,n,-1,0,0,.75,1,-t,r,-n,-1,0,0,1,1]),indexArray:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15])}:{format:a.VertexDataFormat.Static,vertexArray:new Float32Array([-t,-r,n,0,0,1,0,0,t,-r,n,0,0,1,1,0,t,r,n,0,0,1,1,1,-t,r,n,0,0,1,0,1,-t,-r,-n,0,0,-1,1,0,-t,r,-n,0,0,-1,1,1,t,r,-n,0,0,-1,0,1,t,-r,-n,0,0,-1,0,0,-t,r,-n,0,1,0,0,1,-t,r,n,0,1,0,0,0,t,r,n,0,1,0,1,0,t,r,-n,0,1,0,1,1,-t,-r,-n,0,-1,0,1,1,t,-r,-n,0,-1,0,0,1,t,-r,n,0,-1,0,0,0,-t,-r,n,0,-1,0,1,0,t,-r,-n,1,0,0,1,0,t,r,-n,1,0,0,1,1,t,r,n,1,0,0,0,1,t,-r,n,1,0,0,0,0,-t,-r,-n,-1,0,0,0,0,-t,-r,n,-1,0,0,1,0,-t,r,n,-1,0,0,1,1,-t,r,-n,-1,0,0,0,1]),indexArray:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23])}}},3935:function(e,t,r){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.extrudePolygon=t.doubleSided=t.modifyGeometry=t.applyTransform=void 0;var n=r(7594),i=r(556);t.applyTransform=function(e,t){for(var r=e.vertexArray,a=e.format,i=r.byteLength/a[1].stride,o=a[1].stride/Float32Array.BYTES_PER_ELEMENT,s=i-1;s>=0;s--){var l=r[0+(m=s*o)],c=r[m+1],u=r[m+2];r[m+0]=t[0]*l+t[4]*c+t[8]*u+t[12],r[m+1]=t[1]*l+t[5]*c+t[9]*u+t[13],r[m+2]=t[2]*l+t[6]*c+t[10]*u+t[14]}var f=n.mat3.fromMat4(t,n.mat3());for(n.mat3.invert(f,f),n.mat3.transpose(f,f),s=i-1;s>=0;s--){var m;l=r[3+(m=s*o)],c=r[m+4],u=r[m+5],r[m+3]=f[0]*l+f[3]*c+f[6]*u,r[m+4]=f[1]*l+f[4]*c+f[7]*u,r[m+5]=f[2]*l+f[5]*c+f[8]*u}return e},t.modifyGeometry=function(e,t){for(var r=e.vertexArray,a=e.format,i=r.byteLength/a[1].stride,o=a[1].stride/Float32Array.BYTES_PER_ELEMENT,s=n.vec3(),l=n.vec3(),c=(n.quat(),i-1);c>=0;c--)s[0]=r[c*o+0],s[1]=r[c*o+1],s[2]=r[c*o+2],l[0]=r[c*o+3],l[1]=r[c*o+4],l[2]=r[c*o+5],t(s,l),r.set(s,c*o+0),r.set(l,c*o+3);return e},t.doubleSided=function(e){for(var t=new Uint16Array(2*e.indexArray.length),r=e.indexArray.length/3-1;r>=0;r--)t[3*r+0]=e.indexArray[3*r+2],t[3*r+1]=e.indexArray[3*r+1],t[3*r+2]=e.indexArray[3*r+0];return t.set(e.indexArray,e.indexArray.length),a(a({},e),{indexArray:t})},t.extrudePolygon=function(e,t){for(var r=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);for(var a=0,n=t,i=r-1;n<r;i=n++)a+=(e[i][0]-e[n][0])*(e[i][1]+e[n][1]);return-.5*a}(e)<0,a=new Float32Array(4*e.length*8),o=new Uint16Array(6*e.length),s=n.vec2(),l=e.length-1,c=0;l>=0;c=l,l--){var u=e[l],f=e[c];n.vec2.subtract(f,u,s),r?n.vec2.rotate90cw(s,s):n.vec2.rotate90ccw(s,s),n.vec2.normalize(s,s);var m=8*(4*l+0),h=8*(4*l+1),d=8*(4*l+2),v=8*(4*l+3);a[m+0]=a[v+0]=u[0],a[h+0]=a[d+0]=f[0],a[m+2]=a[v+2]=u[1],a[h+2]=a[d+2]=f[1],a[m+1]=a[h+1]=0,a[d+1]=a[v+1]=t,a[m+3]=a[h+3]=a[d+3]=a[v+3]=s[0],a[m+5]=a[h+5]=a[d+5]=a[v+5]=s[1],a[m+6]=a[v+6]=l/(e.length-1),a[h+6]=a[d+6]=c/(e.length-1),a[m+7]=a[h+7]=0,a[v+7]=a[d+7]=1,o[6*l+0]=4*l,o[6*l+1]=4*l+1,o[6*l+2]=4*l+2,o[6*l+3]=4*l+2,o[6*l+4]=4*l+3,o[6*l+5]=4*l}return{format:i.VertexDataFormat.Static,vertexArray:a,indexArray:o}}},341:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCylinder=void 0;var a=r(8999);t.createCylinder=function(e){for(var t=e.radiusTop,r=void 0===t?1:t,n=e.radiusBottom,i=void 0===n?1:n,o=e.height,s=void 0===o?1:o,l=e.radial,c=void 0===l?8:l,u=e.horizontal,f=void 0===u?1:u,m=(e.cap,e.angleStart),h=void 0===m?0:m,d=e.angleLength,v=void 0===d?2*Math.PI:d,p=c+1,y=new Float32Array((f+1)*p*8),g=new Uint16Array(c*f*6),x=(i-r)/s,b=0;b<=f;b++)for(var S=b/f,P=r+S*(i-r),w=0;w<=c;w++){var T=w/c,O=h+T*v,M=Math.sin(O),A=Math.cos(O);y[0+(_=8*(w+b*p))]=P*M,y[_+1]=-S*s+.5*s,y[_+2]=P*A;var E=M*M+x*x+A*A;E=E&&1/Math.sqrt(E),y[_+3]=E*M,y[_+4]=E*x,y[_+5]=E*A,y[_+6]=T,y[_+7]=1-S}for(w=0;w<c;w++)for(b=0;b<f;b++){var _;g[0+(_=6*(w*f+b))]=b*p+w,g[_+1]=g[_+3]=(b+1)*p+w,g[_+4]=(b+1)*p+(w+1),g[_+2]=g[_+5]=b*p+(w+1)}return{format:a.VertexDataFormat.Static,vertexArray:y,indexArray:g}}},6240:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(3935),t),n(r(8356),t),n(r(4523),t),n(r(4773),t),n(r(341),t)},4523:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPlane=void 0;var a=r(8999);t.createPlane=function(e){for(var t=e.width,r=e.height,n=e.columns,i=void 0===n?1:n,o=e.rows,s=void 0===o?1:o,l=i+1,c=s+1,u=new Float32Array(l*c*8),f=new Uint16Array(i*s*6),m=0;m<l;m++)for(var h=0;h<c;h++)u[0+(d=8*(m*c+h))]=t*m/i-.5*t,u[d+1]=0,u[d+2]=r*h/s-.5*r,u[d+3]=0,u[d+4]=1,u[d+5]=0,u[d+6]=m/i,u[d+7]=1-h/s;for(m=0;m<i;m++)for(h=0;h<s;h++){var d;f[0+(d=6*(m*s+h))]=h+c*m,f[d+1]=h+1+c*m,f[d+2]=h+c*(m+1),f[d+3]=h+c*(m+1),f[d+4]=h+1+c*m,f[d+5]=h+1+c*(m+1)}return{format:a.VertexDataFormat.Static,vertexArray:u,indexArray:f}}},8356:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSphere=void 0;var a=r(8999);t.createSphere=function(e){for(var t=e.longitude,r=void 0===t?32:t,n=e.latitude,i=void 0===n?32:n,o=e.radius,s=void 0===o?1:o,l=e.thetaStart,c=void 0===l?0:l,u=e.thetaLength,f=void 0===u?Math.PI:u,m=e.phiStart,h=void 0===m?0:m,d=e.phiLength,v=void 0===d?2*Math.PI:d,p=new Float32Array(r*i*4*8),y=new Uint16Array(r*i*6),g=0,x=0,b=0;b<i;b++)for(var S=b/i,P=(b+1)/i,w=c+f*S,T=c+f*P,O=Math.sin(w),M=Math.sin(T),A=Math.cos(w),E=Math.cos(T),_=0;_<r;_++){var I=_/r,q=(_+1)/r,R=h+v*I,k=h+v*q,N=Math.sin(R),z=Math.sin(k),U=Math.cos(R),D=Math.cos(k),L=8*g;p[L+0]=O*U*s,p[L+1]=A*s,p[L+2]=O*N*s,p[L+8]=O*D*s,p[L+9]=A*s,p[L+10]=O*z*s,p[L+16]=M*U*s,p[L+17]=E*s,p[L+18]=M*N*s,p[L+24]=M*D*s,p[L+25]=E*s,p[L+26]=M*z*s,p[L+3]=O*U,p[L+4]=A,p[L+5]=O*N,p[L+11]=O*D,p[L+12]=A,p[L+13]=O*z,p[L+19]=M*U,p[L+20]=E,p[L+21]=M*N,p[L+27]=M*D,p[L+28]=E,p[L+29]=M*z,p[L+6]=p[L+22]=1-I,p[L+7]=p[L+15]=1-S,p[L+14]=p[L+30]=1-q,p[L+23]=p[L+31]=1-P,y[x+0]=g+0,y[x+1]=g+1,y[x+2]=g+2,y[x+3]=g+2,y[x+4]=g+1,y[x+5]=g+3,g+=4,x+=6}return{format:a.VertexDataFormat.Static,vertexArray:p,indexArray:y}}},7168:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.DecalMaterial=void 0;var i=r(7594),o=r(5397),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uvTransform=i.vec4(0,0,1,1),t.depthTest=518,t.cullFace=1028,t.depthWrite=!1,t.blendMode=o.ShaderMaterial.Premultiply,t.layer=1,t}return n(t,e),t.prototype.bind=function(t){e.prototype.bind.call(this,t)},t.prototype.merge=function(t){return e.prototype.merge.call(this,t)&&this.diffuse===t.diffuse},t}(o.ShaderMaterial);t.DecalMaterial=s},7490:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.EffectMaterial=void 0;var i=r(556),o=r(8211),s=r(5397),l=function(e){function t(t,r,a){var n=e.call(this)||this;for(var l in n.depthTest=515,n.blendMode=s.ShaderMaterial.Premultiply,n.program=i.ShaderProgram(t,o.shaders.batch_vert,o.shaders.vfx_frag,r),n.uniform=new i.UniformBlock(t,n.program.uniforms.EffectUniforms,i.UniformBlockBindings.EffectUniforms),a)n.uniform.uniforms[l].set(a[l],0);return n}return n(t,e),t.prototype.bind=function(t){e.prototype.bind.call(this,t),this.uniform.bind(t,i.UniformBlockBindings.EffectUniforms),t.activeTexture(33984+i.UniformSamplerBindings.uDiffuseMap),t.bindTexture(3553,this.diffuse),t.activeTexture(33984+i.UniformSamplerBindings.uGradientMap),t.bindTexture(3553,this.gradient),t.activeTexture(33984+i.UniformSamplerBindings.uDisplacementMap),t.bindTexture(3553,this.displacement)},t.prototype.merge=function(t){return e.prototype.merge.call(this,t)&&t===this},t}(s.ShaderMaterial);t.EffectMaterial=l},2408:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.EmitterMaterial=void 0;var i=r(556),o=r(5397),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.depthTest=515,t.cullFace=0,t.depthWrite=!1,t.blendMode=o.ShaderMaterial.Premultiply,t}return n(t,e),t.prototype.bind=function(t){e.prototype.bind.call(this,t),t.activeTexture(33984+i.UniformSamplerBindings.uSampler),t.bindTexture(3553,this.diffuse),this.gradientRamp&&(t.activeTexture(33984+i.UniformSamplerBindings.uGradient),t.bindTexture(3553,this.gradientRamp)),this.curveSampler&&(t.activeTexture(33984+i.UniformSamplerBindings.uAttributes),t.bindTexture(3553,this.curveSampler)),this.displacementMap&&(t.activeTexture(33984+i.UniformSamplerBindings.uDisplacementMap),t.bindTexture(3553,this.displacementMap))},t}(o.ShaderMaterial);t.EmitterMaterial=s},460:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GradientRamp=void 0;var a=r(556);t.GradientRamp=function(e,t,r){void 0===r&&(r=1);for(var n=new Uint8Array(4*t.length),i=0;i<t.length;i++)n[4*i+0]=t[i]>>>24&255,n[4*i+1]=t[i]>>>16&255,n[4*i+2]=t[i]>>>8&255,n[4*i+3]=t[i]>>>0&255;return a.createTexture(e,{width:t.length/r,height:r,data:n},{flipY:!0,mipmaps:0,filter:9729,wrap:33071,type:3553,format:32856})}},7269:function(e,t,r){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialSystem=void 0;var n=r(556),i=r(6256),o=r(8211),s=r(2058),l=r(391),c=function(){function e(e){this.context=e,this.white=new s.MeshMaterial,this.materials=Object.create(null),this.staticMaterials=Object.create(null),this.enabled=!0,this.renderQueue=[],this.white.diffuse=n.createTexture(this.context.gl,{width:1,height:1,data:new Uint8Array([127,127,127,0])}),this.white.normal=n.createTexture(this.context.gl,{width:1,height:1,data:new Uint8Array([127,127,255,0])})}return e.prototype.create=function(){var e=new s.MeshMaterial;return e.program=this.context.get(i.DeferredGeometryPass).programs[0],e},e.prototype.createRenderTexture=function(e,t,r,i){void 0===r&&(r=1);var o=this.context.gl,s=r>1?35866:3553,l=!(r>1),c=n.createTexture(o,{width:e,height:t,depth:r},a({flipY:!1,mipmaps:l?0:9728,type:s,filter:9729,wrap:10497},i)),u=Array(r);if(1===r)u[0]=o.createFramebuffer(),o.bindFramebuffer(36160,u[0]),o.framebufferTexture2D(36160,36064,3553,c,0);else for(var f=0;f<r;f++)u[f]=o.createFramebuffer(),o.bindFramebuffer(36160,u[f]),o.framebufferTextureLayer(36160,36064,c,0,f);return{width:e,height:t,layers:r,target:c,mipmaps:l,type:s,fbo:u}},e.prototype.renderTexture=function(e,t,r,a){var n=this.context.gl;n.bindFramebuffer(36160,e.fbo[t]),n.disable(3042),n.viewport(0,0,e.width,e.height),n.useProgram(r.target),r.uniforms.uTime=this.context.currentTime;var i=1;for(var o in a)a[o]instanceof WebGLTexture?(n.activeTexture(33984+i),n.bindTexture(3553,a[o]),r.uniforms[o]=i++):r.uniforms[o]=a[o];var s=this.context.get(l.MeshSystem).plane;n.bindVertexArray(s.vao),n.drawElements(4,s.indexCount,5123,s.indexOffset),e.mipmaps&&(n.activeTexture(33984),n.bindTexture(e.type,e.target),n.generateMipmap(3553))},e.prototype.addRenderTexture=function(e,t,r,a,n){var i=this.context.gl;return a.uScreenSize=[e.width,e.height],n<1?(this.renderTexture(e,t,r,a),i.deleteFramebuffer(e.fbo[t]),i.deleteProgram(r.target),e.fbo[t]=null,r.target=null):this.renderQueue.push({rate:n,texture:e,layer:t,program:r,uniforms:a}),e},e.prototype.update=function(){if(this.enabled){this.context.gl;for(var e=this.renderQueue.length-1;e>=0;e--){var t=this.renderQueue[e],r=t.rate,a=t.texture,n=t.layer,i=t.program,o=t.uniforms;this.context.frame%r==0&&this.renderTexture(a,n,i,o)}}},e.prototype.load=function(t,r){function a(r,a,i){if(t.model.find((function(e){return e.texture===r.index}))){var s=this.addRenderTexture(this.createRenderTexture(a,i,1),0,n.ShaderProgram(this.context.gl,o.shaders.fullscreen_vert,o.shaders.bumpmap_frag),{uSampler:r.diffuse,uScale:e.heightmapScale,uScreenSize:[a,i]},0).target;r.normal=s}}for(var i=t.texture.length-1;i>=0;i--){var l=this.materials[i]=new s.MeshMaterial;l.index=i;var c=r.textures[i],u=c.naturalWidth,f=c.naturalHeight,m=n.createTexture(this.context.gl,{width:u,height:f,data:c});l.diffuse=m,a.call(this,l,u,f)}},e.prototype.loadTexture=function(){(new Image).crossOrigin="anonymous"},e.pack2x4=function(e,t){return(Math.floor(15*e)+16*Math.floor(15*t))/255},e.unpack2x4=function(e){return[17*e%1,1.0625*e%1]},e.textureSize=256,e.heightmapScale=10,e}();t.MaterialSystem=c},2058:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.MeshMaterial=void 0;var i=r(556),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.depthTest=515,t.cullFace=1029,t.blendMode=null,t.depthWrite=!0,t}return n(t,e),t.prototype.bind=function(t){e.prototype.bind.call(this,t),t.activeTexture(33984+i.UniformSamplerBindings.uDiffuseMap),t.bindTexture(3553,this.diffuse),t.activeTexture(33984+i.UniformSamplerBindings.uNormalMap),t.bindTexture(3553,this.normal),this.array&&(t.activeTexture(33984+i.UniformSamplerBindings.uArrayMap),t.bindTexture(35866,this.array),this.program.uniforms.uArrayMapLayers=this.arrayLayers-1)},t.prototype.merge=function(e){return e===this},t}(r(5397).ShaderMaterial);t.MeshMaterial=o},5397:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderMaterial=void 0;var r=function(){function e(){this.depthWrite=!1,this.cullFace=1029,this.depthTest=513,this.blendMode=null,this.program=void 0}return e.prototype.bind=function(e){e.depthMask(this.depthWrite),this.cullFace?(e.enable(2884),e.cullFace(this.cullFace)):e.disable(2884),this.depthTest?(e.enable(2929),e.depthFunc(this.depthTest)):e.disable(2929),this.blendMode?(e.enable(3042),1==this.blendMode[0].length?e.blendEquation(this.blendMode[0][0]):e.blendEquationSeparate(this.blendMode[0][0],this.blendMode[0][1]),2==this.blendMode[1].length?e.blendFunc(this.blendMode[1][0],this.blendMode[1][1]):e.blendFuncSeparate(this.blendMode[1][0],this.blendMode[1][1],this.blendMode[1][2],this.blendMode[1][3])):e.disable(3042)},e.prototype.merge=function(e){return this===e||this.program===e.program&&this.depthWrite===e.depthWrite&&this.depthTest===e.depthTest&&this.cullFace===e.cullFace&&this.blendMode===e.blendMode},e.Add=[[32774],[1,1]],e.Blend=[[32774],[770,771,0,1]],e.Premultiply=[[32774],[1,771,0,1]],e}();t.ShaderMaterial=r},523:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteMaterial=void 0;var i=r(7594),o=r(5397),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uvTransform=i.vec4(0,0,1,1),t.depthTest=515,t.blendMode=o.ShaderMaterial.Premultiply,t}return n(t,e),t.prototype.bind=function(t){e.prototype.bind.call(this,t),"uUVTransform"in this.program.uniforms&&(this.program.uniforms.uUVTransform=this.uvTransform)},t.prototype.merge=function(t){return e.prototype.merge.call(this,t)&&("uSamplers"in this.program.uniforms||this.diffuse===t.diffuse)},t}(o.ShaderMaterial);t.SpriteMaterial=s},43:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(460),t),n(r(7269),t),n(r(5397),t),n(r(2058),t),n(r(523),t),n(r(7168),t),n(r(7490),t),n(r(2408),t)},9552:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aabb2=void 0,t.aabb2=function(e,r,a,n){return void 0===e&&(e=1/0),void 0===r&&(r=1/0),void 0===a&&(a=-1/0),void 0===n&&(n=-1/0),t.aabb2.set(e,r,a,n,new Float32Array(4))},t.aabb2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.aabb2.set=function(e,t,r,a,n){return n[0]=e,n[1]=t,n[2]=r,n[3]=a,n},t.aabb2.overlap=function(e,t){return e[0]<=t[2]&&e[1]<=t[3]&&e[2]>=t[0]&&e[3]>=t[1]},t.aabb2.contains=function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[2]&&e[3]>=t[3]},t.aabb2.add=function(e,t,r){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r},t.aabb2.intersect=function(e,t,r){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.min(e[3],t[3]),r},t.aabb2.pad=function(e,t,r){return r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]+t,r[3]=e[3]+t,r}},7432:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aabb3=void 0,t.aabb3=function(e,r,a,n,i,o){return void 0===e&&(e=1/0),void 0===r&&(r=1/0),void 0===a&&(a=1/0),void 0===n&&(n=-1/0),void 0===i&&(i=-1/0),void 0===o&&(o=1/0),t.aabb3.set(e,r,a,n,i,o,new Float32Array(6))},t.aabb3.set=function(e,t,r,a,n,i,o){return o[0]=e,o[1]=t,o[2]=r,o[3]=a,o[4]=n,o[5]=i,o},t.aabb3.overlap=function(e,t){return e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]&&e[3]>=t[0]&&e[4]>=t[1]&&e[5]>=t[2]},t.aabb3.contains=function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]<=t[2]&&e[3]>=t[3]&&e[4]>=t[4]&&e[5]>=t[5]},t.aabb3.add=function(e,t,r){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r[4]=Math.max(e[4],t[4]),r[5]=Math.max(e[5],t[5]),r},t.aabb3.calculate=function(e,r,a,n){t.aabb3.set(1/0,1/0,1/0,-1/0,-1/0,-1/0,n);for(var i=0;i<e.length;i+=r)n[0]=Math.min(n[0],e[i+a+0]),n[1]=Math.min(n[1],e[i+a+1]),n[2]=Math.min(n[2],e[i+a+2]),n[3]=Math.max(n[3],e[i+a+0]),n[4]=Math.max(n[4],e[i+a+1]),n[5]=Math.max(n[5],e[i+a+2]);return n}},3850:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.solveQuadratic=t.insertionSort=t.binarySearch=t.hashString=t.int32pow2Floor=t.int32pow2Ceil=t.int32pow2=t.shuffle=t.range=t.smoothstep=t.lerpAngle=t.shortestAngle=t.randomInt=t.randomFloat=t.mod=t.clamp=t.lerp=t.random=void 0,t.random=(r=502,function(){var e=r+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}),t.lerp=function(e,t,r){return e+(t-e)*r},t.clamp=function(e,t,r){return Math.min(r,Math.max(t,e))},t.mod=function(e,t){return(e%t+t)%t},t.randomFloat=function(e,t,r){return r()*(t-e)+e},t.randomInt=function(e,t,r){return Math.floor(r()*(t-e+1))+e},t.shortestAngle=function(e,t){var r=(t-e)%(2*Math.PI);return 2*r%(2*Math.PI)-r},t.lerpAngle=function(e,r,a){return e+t.shortestAngle(e,r)*a},t.smoothstep=function(e,r,a){return e===r?a<e?0:1:(a=t.clamp((a-e)/(r-e),0,1))*a*(3-2*a)},t.range=function(e,t,r){void 0===r&&(r=[]),null==t&&(t=e,e=0);for(var a=e,n=0;a<t;a++,n++)r[n]=a;return r},t.shuffle=function(e,t){for(var r=e.length-1;r>0;r--){var a=t()*(r+1)|0,n=e[r];e[r]=e[a],e[a]=n}return e},t.int32pow2=function(e){return!(e&e-1||!e)},t.int32pow2Ceil=function(e){return e+=+(0===e),--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)},t.int32pow2Floor=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.hashString=function(e){for(var t=0,r=e.length,a=0;a<r;a++)t=(t<<5)-t+e.charCodeAt(a),t|=0;return t},t.binarySearch=function(e,t,r,a){for(var n=0,i=e.length;n<i;){var o=n+i>>>1;(a?r(e[o],t)<=0:r(e[o],t)<0)?n=o+1:i=o}return a?i:n},t.insertionSort=function(e,t){for(var r=e.length,a=void 0,n=0;n<r;n++){var i=e[n];for(a=n-1;a>=0&&t(i,e[a])>0;a--)e[a+1]=e[a];e[a+1]=i}},t.solveQuadratic=function(e,t,r){var a=t*t-4*e*r;if(a<0)return-1;var n=-.5*(t+Math.sign(t)*Math.sqrt(a));return Math.max(n/e,r/n)}},4501:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cubicBezierNormal3D=t.quadraticBezierNormal3D=t.cubicBezier3D=t.quadraticBezier3D=void 0,t.quadraticBezier3D=function(e,t,r,a,n){var i=a*a,o=1-a,s=o*o;return n[0]=s*e[0]+2*a*o*t[0]+i*r[0],n[1]=s*e[1]+2*a*o*t[1]+i*r[1],n[2]=s*e[2]+2*a*o*t[2]+i*r[2],n},t.cubicBezier3D=function(e,t,r,a,n,i){var o=n*n,s=n*n*n,l=1-n,c=l*l,u=c*l;return i[0]=u*e[0]+3*n*c*t[0]+3*o*l*r[0]+s*a[0],i[1]=u*e[1]+3*n*c*t[1]+3*o*l*r[1]+s*a[1],i[2]=u*e[2]+3*n*c*t[2]+3*o*l*r[2]+s*a[2],i},t.quadraticBezierNormal3D=function(e,t,r,a,n){return n[0]=2*(1-a)*(t[0]-e[0])+2*a*(r[0]-t[0]),n[1]=2*(1-a)*(t[1]-e[1])+2*a*(r[1]-t[1]),n[2]=2*(1-a)*(t[2]-e[2])+2*a*(r[2]-t[2]),n},t.cubicBezierNormal3D=function(e,t,r,a,n,i){var o=n*n,s=1-n,l=s*s;return i[0]=3*l*(t[0]-e[0])+6*s*n*(r[0]-t[0])+3*o*(a[0]-r[0]),i[1]=3*l*(t[1]-e[1])+6*s*n*(r[1]-t[1])+3*o*(a[1]-r[1]),i[2]=3*l*(t[2]-e[2])+6*s*n*(r[2]-t[2])+3*o*(a[2]-r[2]),i}},6518:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dualquat=void 0,t.dualquat=function(){return t.dualquat.set(0,0,0,1,0,0,0,0,new Float32Array(8))},t.dualquat.set=function(e,t,r,a,n,i,o,s,l){return l[0]=e,l[1]=t,l[2]=r,l[3]=a,l[4]=n,l[5]=i,l[6]=o,l[7]=s,l},t.dualquat.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},t.dualquat.slerp=function(e,t,r,a){var n=e[0],i=e[1],o=e[2],s=e[3],l=t[0],c=t[1],u=t[2],f=t[3],m=e[4],h=e[5],d=e[6],v=e[7];return n*l+i*c+o*u+s*f<0?(a[0]=r*(l+n)-n,a[1]=r*(c+i)-i,a[2]=r*(u+o)-o,a[3]=r*(f+s)-s,a[4]=-m+r*(t[4]+m),a[5]=-h+r*(t[5]+h),a[6]=-d+r*(t[6]+d),a[7]=-v+r*(t[7]+v)):(a[0]=n+r*(l-n),a[1]=i+r*(c-i),a[2]=o+r*(u-o),a[3]=s+r*(f-s),a[4]=m+r*(t[4]-m),a[5]=h+r*(t[5]-h),a[6]=d+r*(t[6]-d),a[7]=v+r*(t[7]-v)),a},t.dualquat.fromRotationTranslation=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=.5*t[0],l=.5*t[1],c=.5*t[2];return r[0]=a,r[1]=n,r[2]=i,r[3]=o,r[4]=+s*o+l*i-c*n,r[5]=-s*i+l*o+c*a,r[6]=+s*n-l*a+c*o,r[7]=-s*a-l*n-c*i,r},t.dualquat.multiply=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=t[4],l=t[5],c=t[6],u=t[7],f=e[4],m=e[5],h=e[6],d=e[7],v=t[0],p=t[1],y=t[2],g=t[3];return r[0]=a*g+o*v+n*y-i*p,r[1]=n*g+o*p+i*v-a*y,r[2]=i*g+o*y+a*p-n*v,r[3]=o*g-a*v-n*p-i*y,r[4]=a*u+o*s+n*c-i*l+f*g+d*v+m*y-h*p,r[5]=n*u+o*l+i*s-a*c+m*g+d*p+h*v-f*y,r[6]=i*u+o*c+a*l-n*s+h*g+d*y+f*p-m*v,r[7]=o*u-a*s-n*l-i*c+d*g-f*v-m*p-h*y,r}},7594:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(3850),t),n(r(9243),t),n(r(2820),t),n(r(4809),t),n(r(8422),t),n(r(643),t),n(r(6163),t),n(r(9369),t),n(r(1247),t),n(r(6518),t),n(r(9552),t),n(r(7432),t),n(r(7144),t),n(r(4501),t)},8422:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat2=void 0,t.mat2=function(){return t.mat2.identity(new Float32Array(4))},t.mat2.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.mat2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.mat2.transpose=function(e,t){var r=e[1];return t[1]=e[2],t[2]=r,t===e||(t[0]=e[0],t[3]=e[3]),t},t.mat2.invert=function(e,t){var r=e[0],a=e[1],n=e[2],i=e[3],o=r*i-n*a;return o=o?1/o:0,t[0]=i*o,t[1]=-a*o,t[2]=-n*o,t[3]=r*o,t},t.mat2.multiply=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=t[0],l=t[1],c=t[2],u=t[3];return r[0]=a*s+i*l,r[1]=n*s+o*l,r[2]=a*c+i*u,r[3]=n*c+o*u,r},t.mat2.transform=function(e,t,r){var a=e[0],n=e[1];return r[0]=t[0]*a+t[2]*n,r[1]=t[1]*a+t[3]*n,r}},6163:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=void 0,t.mat3=function(){return t.mat3.identity(new Float32Array(9))},t.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.mat3.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.mat3.transpose=function(e,t){var r=e[1];return t[1]=e[3],t[3]=r,r=e[2],t[2]=e[6],t[6]=r,r=e[5],t[5]=e[7],t[7]=r,t===e||(t[0]=e[0],t[4]=e[4],t[8]=e[8]),t},t.mat3.invert=function(e,t){var r=e[0],a=e[1],n=e[2],i=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],f=u*o-s*c,m=-u*i+s*l,h=c*i-o*l,d=r*f+a*m+n*h;return d=d?1/d:0,t[0]=f*d,t[1]=(-u*a+n*c)*d,t[2]=(s*a-n*o)*d,t[3]=m*d,t[4]=(u*r-n*l)*d,t[5]=(-s*r+n*i)*d,t[6]=h*d,t[7]=(-c*r+a*l)*d,t[8]=(o*r-a*i)*d,t},t.mat3.multiply=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],f=e[8],m=t[0],h=t[1],d=t[2];return r[0]=m*a+h*o+d*c,r[1]=m*n+h*s+d*u,r[2]=m*i+h*l+d*f,m=t[3],h=t[4],d=t[5],r[3]=m*a+h*o+d*c,r[4]=m*n+h*s+d*u,r[5]=m*i+h*l+d*f,m=t[6],h=t[7],d=t[8],r[6]=m*a+h*o+d*c,r[7]=m*n+h*s+d*u,r[8]=m*i+h*l+d*f,r},t.mat3.fromMat3x2=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},t.mat3.fromMat4=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.mat3.fromQuat=function(e,t){var r=e[0],a=e[1],n=e[2],i=e[3],o=2*r,s=2*a,l=2*n,c=r*o,u=a*s,f=n*l,m=r*s,h=r*l,d=a*l,v=i*o,p=i*s,y=i*l;return t[0]=1-u-f,t[1]=m+y,t[2]=h-p,t[3]=m-y,t[4]=1-c-f,t[5]=d+v,t[6]=h+p,t[7]=d-v,t[8]=1-c-u,t},t.mat3.transform=function(e,t,r){var a=e[0],n=e[1],i=e[2];return r[0]=t[0]*a+t[3]*n+t[6]*i,r[1]=t[1]*a+t[4]*n+t[7]*i,r[2]=t[2]*a+t[5]*n+t[8]*i,r},t.mat3.normalize=function(e,t){var r=Math.hypot(e[0],e[1],e[2]);r=r&&1/r;var a=Math.hypot(e[3],e[4],e[5]);a=a&&1/a;var n=Math.hypot(e[6],e[7],e[8]);return n=n&&1/n,t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*a,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},t.mat3.normalMatrix=function(e,t){var r=e[0],a=e[1],n=e[2],i=e[4],o=e[5],s=e[6],l=e[8],c=e[9],u=e[10];return t[0]=o*u-s*c,t[1]=s*l-i*u,t[2]=i*c-o*l,t[3]=n*c-a*u,t[4]=r*u-n*l,t[5]=a*l-r*c,t[6]=a*s-n*o,t[7]=n*i-r*s,t[8]=r*o-a*i,t},t.mat3.orthonormal=function(e,r){var a=e[2]>=0?1:-1,n=-1/(a+e[2]),i=e[0]*e[1]*n;return r[0]=1+a*e[0]*e[0]*n,r[1]=a*i,r[2]=-a*e[0],r[3]=i,r[4]=a+e[1]*e[1]*n,r[5]=-e[1],r[6]=e[0],r[7]=e[1],r[8]=e[2],t.mat3.normalize(r,r),r},t.mat3.rotation=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=Math.sin(t),s=Math.cos(t),l=1-s,c=a*n*l,u=a*i*l,f=n*i*l;return r[0]=a*a*l+s,r[1]=c+i*o,r[2]=u-n*o,r[3]=c-i*o,r[4]=n*n*l+s,r[5]=f+a*o,r[6]=u+n*o,r[7]=f-a*o,r[8]=i*i*l+s,r},t.mat3.IDENTITY=t.mat3()},643:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3x2=void 0,t.mat3x2=function(){return t.mat3x2.identity(new Float32Array(6))},t.mat3x2.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.mat3x2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.mat3x2.invert=function(e,t){var r=e[0],a=e[1],n=e[2],i=e[3],o=e[4],s=e[5],l=r*i-a*n,c=l&&1/l;return t[0]=i*c,t[1]=-a*c,t[2]=-n*c,t[3]=r*c,t[4]=(n*s-i*o)*c,t[5]=(a*o-r*s)*c,t},t.mat3x2.multiply=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=t[0],l=t[1],c=t[2],u=t[3],f=t[4],m=t[5];return r[0]=a*s+i*l,r[1]=n*s+o*l,r[2]=a*c+i*u,r[3]=n*c+o*u,r[4]=a*f+i*m+e[4],r[5]=n*f+o*m+e[5],r},t.mat3x2.orthogonal=function(e,t,r,a,n){var i=1/(e-t),o=1/(r-a);return n[0]=-2*i,n[1]=0,n[2]=0,n[3]=-2*o,n[4]=(e+t)*i,n[5]=(a+r)*o,n},t.mat3x2.transform=function(e,t,r){var a=e[0],n=e[1];return r[0]=t[0]*a+t[2]*n+t[4],r[1]=t[1]*a+t[3]*n+t[5],r},t.mat3x2.fromTransform=function(e,t,r,a,n,i,o,s,l,c){return c[0]=Math.cos(o+l)*n,c[1]=Math.sin(o+l)*n,c[2]=-Math.sin(o-s)*i,c[3]=Math.cos(o-s)*i,c[4]=e-r*c[0]-a*c[2],c[5]=t-r*c[1]-a*c[3],c},t.mat3x2.IDENTITY=t.mat3x2()},9369:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat4=void 0,t.mat4=function(){return t.mat4.identity(new Float32Array(16))},t.mat4.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.mat4.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.mat4.transpose=function(e,t){var r=e[1];return t[1]=e[4],t[4]=r,r=e[2],t[2]=e[8],t[8]=r,r=e[3],t[3]=e[12],t[12]=r,r=e[6],t[6]=e[9],t[9]=r,r=e[7],t[7]=e[13],t[13]=r,r=e[11],t[11]=e[14],t[14]=r,t===e||(t[0]=e[0],t[5]=e[5],t[10]=e[10],t[15]=e[15]),t},t.mat4.invert=function(e,t){var r=e[0],a=e[1],n=e[2],i=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],f=e[9],m=e[10],h=e[11],d=e[12],v=e[13],p=e[14],y=e[15],g=r*s-a*o,x=r*l-n*o,b=r*c-i*o,S=a*l-n*s,P=a*c-i*s,w=n*c-i*l,T=u*v-f*d,O=u*p-m*d,M=u*y-h*d,A=f*p-m*v,E=f*y-h*v,_=m*y-h*p,I=g*_-x*E+b*A+S*M-P*O+w*T;return I=I?1/I:0,t[0]=(s*_-l*E+c*A)*I,t[1]=(n*E-a*_-i*A)*I,t[2]=(v*w-p*P+y*S)*I,t[3]=(m*P-f*w-h*S)*I,t[4]=(l*M-o*_-c*O)*I,t[5]=(r*_-n*M+i*O)*I,t[6]=(p*b-d*w-y*x)*I,t[7]=(u*w-m*b+h*x)*I,t[8]=(o*E-s*M+c*T)*I,t[9]=(a*M-r*E-i*T)*I,t[10]=(d*P-v*b+y*g)*I,t[11]=(f*b-u*P-h*g)*I,t[12]=(s*O-o*A-l*T)*I,t[13]=(r*A-a*O+n*T)*I,t[14]=(v*x-d*S-p*g)*I,t[15]=(u*S-f*x+m*g)*I,t},t.mat4.multiply=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],f=e[8],m=e[9],h=e[10],d=e[11],v=e[12],p=e[13],y=e[14],g=e[15],x=t[0],b=t[1],S=t[2],P=t[3];return r[0]=x*a+b*s+S*f+P*v,r[1]=x*n+b*l+S*m+P*p,r[2]=x*i+b*c+S*h+P*y,r[3]=x*o+b*u+S*d+P*g,x=t[4],b=t[5],S=t[6],P=t[7],r[4]=x*a+b*s+S*f+P*v,r[5]=x*n+b*l+S*m+P*p,r[6]=x*i+b*c+S*h+P*y,r[7]=x*o+b*u+S*d+P*g,x=t[8],b=t[9],S=t[10],P=t[11],r[8]=x*a+b*s+S*f+P*v,r[9]=x*n+b*l+S*m+P*p,r[10]=x*i+b*c+S*h+P*y,r[11]=x*o+b*u+S*d+P*g,x=t[12],b=t[13],S=t[14],P=t[15],r[12]=x*a+b*s+S*f+P*v,r[13]=x*n+b*l+S*m+P*p,r[14]=x*i+b*c+S*h+P*y,r[15]=x*o+b*u+S*d+P*g,r},t.mat4.fromEulerRotation=function(e,t,r,a){var n=Math.sin(e),i=Math.sin(t),o=Math.sin(r),s=Math.cos(e),l=Math.cos(t),c=Math.cos(r);return a[0]=l*c,a[1]=l*o,a[2]=-i,a[3]=0,a[4]=n*i*c-s*o,a[5]=n*i*o+s*c,a[6]=n*l,a[7]=0,a[8]=s*i*c+n*o,a[9]=s*i*o-n*c,a[10]=s*l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},t.mat4.perspective=function(e,t,r,a,n){var i=1/Math.tan(e/2),o=1/(r-a);return n[0]=i/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(a+r)*o,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*a*r*o,n[15]=0,n},t.mat4.transform=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=null==e[3]?1:e[3];return r[0]=t[0]*a+t[4]*n+t[8]*i+t[12]*o,r[1]=t[1]*a+t[5]*n+t[9]*i+t[13]*o,r[2]=t[2]*a+t[6]*n+t[10]*i+t[14]*o,r[3]=t[3]*a+t[7]*n+t[11]*i+t[15]*o,r},t.mat4.transformNormal=function(e,t,r){var a=e[0],n=e[1],i=e[2];return r[0]=t[0]*a+t[4]*n+t[8]*i,r[1]=t[1]*a+t[5]*n+t[9]*i,r[2]=t[2]*a+t[6]*n+t[10]*i,r},t.mat4.orthogonal=function(e,t,r,a,n,i,o){var s=1/(e-t),l=1/(r-a),c=1/(n-i);return o[0]=-2*s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*c,o[11]=0,o[12]=(e+t)*s,o[13]=(a+r)*l,o[14]=(i+n)*c,o[15]=1,o},t.mat4.translate=function(e,t,r){var a=t[0],n=t[1],i=t[2];return r[12]=e[0]*a+e[4]*n+e[8]*i+e[12],r[13]=e[1]*a+e[5]*n+e[9]*i+e[13],r[14]=e[2]*a+e[6]*n+e[10]*i+e[14],r[15]=e[3]*a+e[7]*n+e[11]*i+e[15],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11]),r},t.mat4.scale=function(e,t,r){var a=t[0],n=t[1],i=t[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*i,r[9]=e[9]*i,r[10]=e[10]*i,r[11]=e[11]*i,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},t.mat4.rotate=function(e,t,r,a){var n=r[0],i=r[1],o=r[2],s=Math.sin(t),l=Math.cos(t),c=1-l,u=e[0],f=e[1],m=e[2],h=e[3],d=e[4],v=e[5],p=e[6],y=e[7],g=e[8],x=e[9],b=e[10],S=e[11],P=n*n*c+l,w=i*n*c+o*s,T=o*n*c-i*s,O=n*i*c-o*s,M=i*i*c+l,A=o*i*c+n*s,E=n*o*c+i*s,_=i*o*c-n*s,I=o*o*c+l;return a[0]=u*P+d*w+g*T,a[1]=f*P+v*w+x*T,a[2]=m*P+p*w+b*T,a[3]=h*P+y*w+S*T,a[4]=u*O+d*M+g*A,a[5]=f*O+v*M+x*A,a[6]=m*O+p*M+b*A,a[7]=h*O+y*M+S*A,a[8]=u*E+d*_+g*I,a[9]=f*E+v*_+x*I,a[10]=m*E+p*_+b*I,a[11]=h*E+y*_+S*I,a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a},t.mat4.fromRotationTranslationScale=function(e,t,r,a){var n=e[0],i=e[1],o=e[2],s=e[3],l=n+n,c=i+i,u=o+o,f=n*l,m=n*c,h=n*u,d=i*c,v=i*u,p=o*u,y=s*l,g=s*c,x=s*u,b=r[0],S=r[1],P=r[2];return a[0]=(1-(d+p))*b,a[1]=(m+x)*b,a[2]=(h-g)*b,a[3]=0,a[4]=(m-x)*S,a[5]=(1-(f+p))*S,a[6]=(v+y)*S,a[7]=0,a[8]=(h+g)*P,a[9]=(v-y)*P,a[10]=(1-(f+d))*P,a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a},t.mat4.lookAt=function(e,t,r,a){var n=e[0],i=e[1],o=e[2],s=t[0],l=t[1],c=t[2],u=r[0],f=r[1],m=r[2],h=n-s,d=i-l,v=o-c,p=Math.sqrt(h*h+d*d+v*v),y=p?1/p:0,g=f*(v*=y)-m*(d*=y),x=m*(h*=y)-u*v,b=u*d-f*h,S=d*(b*=y=(p=Math.sqrt(g*g+x*x+b*b))?1/p:0)-v*(x*=y),P=v*(g*=y)-h*b,w=h*x-d*g;return S*=y=(p=Math.sqrt(S*S+P*P+w*w))?1/p:0,P*=y,w*=y,a[0]=g,a[1]=S,a[2]=h,a[3]=0,a[4]=x,a[5]=P,a[6]=d,a[7]=0,a[8]=b,a[9]=w,a[10]=v,a[11]=0,a[12]=-(g*n+x*i+b*o),a[13]=-(S*n+P*i+w*o),a[14]=-(h*n+d*i+v*o),a[15]=1,a},t.mat4.targetTo=function(e,t,r,a){var n=e[0],i=e[1],o=e[2],s=r[0],l=r[1],c=r[2],u=n-t[0],f=i-t[1],m=o-t[2],h=Math.sqrt(u*u+f*f+m*m),d=h?1/h:1,v=l*(m*=d)-c*(f*=d),p=c*(u*=d)-s*m,y=s*f-l*u;return v*=d=(h=Math.sqrt(v*v+p*p+y*y))?1/h:1,p*=d,y*=d,a[0]=v,a[1]=p,a[2]=y,a[3]=0,a[4]=f*y-m*p,a[5]=m*v-u*y,a[6]=u*p-f*v,a[7]=0,a[8]=u,a[9]=f,a[10]=m,a[11]=0,a[12]=n,a[13]=i,a[14]=o,a[15]=1,a},t.mat4.fromDualquat=function(e,t){var r=e[0],a=e[1],n=e[2],i=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=2*r*r,f=2*a*a,m=2*n*n,h=2*r*a,d=2*r*n,v=2*r*i,p=2*a*n,y=2*a*i,g=2*n*i;return t[0]=1-f-m,t[1]=h+g,t[2]=d-y,t[3]=0,t[4]=h-g,t[5]=1-u-m,t[6]=p+v,t[7]=0,t[8]=d+y,t[9]=p-v,t[10]=1-u-f,t[11]=0,t[12]=2*(-c*r+o*i-s*n+l*a),t[13]=2*(-c*a+o*n+s*i-l*r),t[14]=2*(-c*n-o*a+s*r+l*i),t[15]=1,t},t.mat4.decompose=function(e,t,r,a){t[0]=e[12],t[1]=e[13],t[2]=e[14];var n=e[0],i=e[1],o=e[2],s=e[4],l=e[5],c=e[6],u=e[8],f=e[9],m=e[10];r[0]=Math.hypot(n,i,o),r[1]=Math.hypot(s,l,c),r[2]=Math.hypot(u,f,m);var h=r[0]&&1/r[0],d=r[1]&&1/r[1],v=r[2]&&1/r[2];s*=h,u*=h,i*=d,f*=d,o*=v,c*=v;var p=(n*=h)+(l*=d)+(m*=v);if(p>0){var y=2*Math.sqrt(p+1);a[3]=.25*y,a[0]=(c-f)/y,a[1]=(u-o)/y,a[2]=(i-s)/y}else n>l&&n>m?(y=2*Math.sqrt(1+n-l-m),a[3]=(c-f)/y,a[0]=.25*y,a[1]=(i+s)/y,a[2]=(u+o)/y):l>m?(y=2*Math.sqrt(1+l-n-m),a[3]=(u-o)/y,a[0]=(i+s)/y,a[1]=.25*y,a[2]=(c+f)/y):(y=2*Math.sqrt(1+m-n-l),a[3]=(i-s)/y,a[0]=(u+o)/y,a[1]=(c+f)/y,a[2]=.25*y)},t.mat4.IDENTITY=t.mat4()},7144:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noise3D=t.noise2D=t.noise1D=void 0;var r=198491317;function a(e,t){return e*=3039394381,e+=t,e^=e>>8,e+=1759714724,e^=e>>8,e*=458671337,(e^=e>>8)/2147483647}t.noise1D=a,t.noise2D=function(e,t,n){return a(e+r*t,n)},t.noise3D=function(e,t,n,i){return a(e+r*t+6542989*n,i)}},1247:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quat=void 0;var a=r(2820),n=r(4809);t.quat=function(){return n.vec4(0,0,0,1)},t.quat.copy=n.vec4.copy,t.quat.set=n.vec4.set,t.quat.normalize=n.vec4.normalize,t.quat.multiply=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=t[0],l=t[1],c=t[2],u=t[3];return r[0]=a*u+o*s+n*c-i*l,r[1]=n*u+o*l+i*s-a*c,r[2]=i*u+o*c+a*l-n*s,r[3]=o*u-a*s-n*l-i*c,r},t.quat.conjugate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.quat.transform=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=t[0],s=t[1],l=t[2],c=t[3],u=c*a+s*i-l*n,f=c*n+l*a-o*i,m=c*i+o*n-s*a,h=-o*a-s*n-l*i;return r[0]=u*c+h*-o+f*-l-m*-s,r[1]=f*c+h*-s+m*-o-u*-l,r[2]=m*c+h*-l+u*-s-f*-o,r[3]=null==e[3]?1:e[3],r},t.quat.slerp=function(e,t,r,a){var n=e[0],i=e[1],o=e[2],s=e[3],l=t[0],c=t[1],u=t[2],f=t[3],m=n*l+i*c+o*u+s*f,h=Math.abs(m),d=1-r,v=r;if(1-h>1e-6){var p=Math.acos(h),y=Math.sin(p);d=Math.sin(d*p)/y,v=Math.sin(v*p)/y}return m<0&&(v*=-1),a[0]=d*n+v*l,a[1]=d*i+v*c,a[2]=d*o+v*u,a[3]=d*s+v*f,a},t.quat.axisAngle=function(e,t,r){var a=Math.sin(t*=.5);return r[0]=a*e[0],r[1]=a*e[1],r[2]=a*e[2],r[3]=Math.cos(t),r};var i={xyz:[1,-1,1,-1],xzy:[-1,-1,1,1],yxz:[1,-1,-1,1],yzx:[1,1,-1,-1],zxy:[-1,1,1,-1],zyx:[-1,1,-1,1]};t.quat.euler=function(e,t,r,a,n){var o=Math.sin(e*=.5),s=Math.cos(e),l=Math.sin(t*=.5),c=Math.cos(t),u=Math.sin(r*=.5),f=Math.cos(r),m=i[a];return n[0]=o*c*f+m[0]*s*l*u,n[1]=s*l*f+m[1]*o*c*u,n[2]=s*c*u+m[2]*o*l*f,n[3]=s*c*f+m[3]*o*l*u,n},t.quat.extractEuler=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=e[3],s=a*a,l=n*n,c=a*a;switch(t){case"yzx":(u=a*n+i*o)*(f=u<0?-1:1)>.5-Number.EPSILON?(r[1]=2*f*Math.atan2(a,o),r[2]=.5*f*Math.PI,r[0]=0):(r[1]=Math.atan2(2*n*o-2*a*i,1-2*l-2*c),r[2]=Math.asin(2*u),r[0]=Math.atan2(2*a*o-2*n*i,1-2*s-2*c));break;case"xyz":var u,f;(u=a*o-n*i)*(f=u<0?-1:1)>.5-Number.EPSILON?(r[1]=2*f*Math.atan2(n,a),r[0]=.5*f*Math.PI,r[2]=0):(r[1]=Math.atan2(2*o*n+2*i*a,1-2*s-2*l),r[0]=Math.asin(2*u),r[2]=Math.atan2(2*o*i+2*a*n,1-2*c-2*s))}return r},t.quat.rotation=function(e,r,n){var i=a.vec3.dot(e,r),o=Math.sqrt(a.vec3.magnitudeSquared(e)*a.vec3.magnitudeSquared(r)),s=i/o;return s>=1?t.quat.copy(t.quat.IDENTITY,n):s<=-1?(a.vec3.orthogonal(e,n),a.vec3.normalize(n,n),n[3]=0,n):(a.vec3.cross(e,r,n),n[3]=o+i,t.quat.normalize(n,n))},t.quat.unitRotation=function(e,r,n){var i=a.vec3.dot(e,r);return i>=1?t.quat.copy(t.quat.IDENTITY,n):(i<=-1?(a.vec3.orthogonal(e,n),n[3]=0):(a.vec3.cross(e,r,n),n[3]=1+i),t.quat.normalize(n,n))},t.quat.fromNormal=function(e,t,r){var n=e[0],i=e[1],o=e[2],s=r;a.vec3.cross(t,e,s),a.vec3.normalize(s,s);var l=s[0],c=s[1],u=s[2];a.vec3.cross(e,s,s);var f=s[0],m=s[1],h=s[2],d=l+m+o;if(d>0){var v=.5/Math.sqrt(d+1);r[0]=(h-i)*v,r[1]=(n-u)*v,r[2]=(c-f)*v,r[3]=.25/v}else l>=m&&l>=o?(v=.5/Math.sqrt(1+l-m-o),r[0]=.25/v,r[1]=(c+f)*v,r[2]=(u+n)*v,r[3]=(h-i)*v):m>o?(v=.5/Math.sqrt(1+m-l-o),r[0]=(f+c)*v,r[1]=.25/v,r[2]=(i+h)*v,r[3]=(n-u)*v):(v=.5/Math.sqrt(1+o-l-m),r[0]=(n+u)*v,r[1]=(i+h)*v,r[2]=.25/v,r[3]=(c-f)*v);return r},t.quat.angle=function(e,t){var r=n.vec4.dot(e,t);return Math.acos(2*r*r-1)},t.quat.pow=function(e,t,r){var n=2*Math.acos(e[3]);a.vec3.normalize(e,r);var i=Math.cos(.5*t*n),o=Math.sin(.5*t*n);return r[0]*=o,r[1]*=o,r[2]*=o,r[3]=i,r},t.quat.decompose=function(e,r,i,o){var s=a.vec3.dot(r,e);if(a.vec3.scale(r,s,o),o[3]=e[3],n.vec4.dot(o,o)<Number.EPSILON)return t.quat.copy(e,i),void t.quat.copy(t.quat.IDENTITY,o);t.quat.normalize(o,o),t.quat.conjugate(o,i),t.quat.multiply(e,i,i)},t.quat.IDENTITY=t.quat()},9243:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec2=void 0,t.vec2=function(e,r){return void 0===e&&(e=0),void 0===r&&(r=e),t.vec2.set(e,r,new Float32Array(2))},t.vec2.set=function(e,t,r){return r[0]=e,r[1]=t,r},t.vec2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t},t.vec2.cross=function(e,t){return e[0]*t[1]-e[1]*t[0]},t.vec2.rotate=function(e,t,r){var a=Math.cos(t),n=Math.sin(t),i=e[0],o=e[1];return r[0]=a*i-n*o,r[1]=n*i+a*o,r},t.vec2.rotate90cw=function(e,t){var r=-e[0];return t[0]=e[1],t[1]=r,t},t.vec2.rotate90ccw=function(e,t){var r=-e[1];return t[1]=e[0],t[0]=r,t},t.vec2.add=function(e,t,r){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r},t.vec2.subtract=function(e,t,r){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r},t.vec2.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r},t.vec2.divide=function(e,t,r){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r},t.vec2.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r},t.vec2.distanceSquared=function(e,t){var r=t[0]-e[0],a=t[1]-e[1];return r*r+a*a},t.vec2.distance=function(e,r){return Math.sqrt(t.vec2.distanceSquared(e,r))},t.vec2.manhattan=function(e,t){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])},t.vec2.magnitudeSquared=function(e){return e[0]*e[0]+e[1]*e[1]},t.vec2.magnitude=function(e){return Math.sqrt(t.vec2.magnitudeSquared(e))},t.vec2.normalize=function(e,t){var r=e[0],a=e[1],n=r*r+a*a,i=n&&1/Math.sqrt(n);return t[0]=r*i,t[1]=a*i,t},t.vec2.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.vec2.lerp=function(e,t,r,a){return a[0]=e[0]+r*(t[0]-e[0]),a[1]=e[1]+r*(t[1]-e[1]),a},t.vec2.reflect=function(e,t,r){var a=e[0]*t[0]+e[1]*t[1];return r[0]=e[0]-2*t[0]*a,r[1]=e[1]-2*t[1]*a,r},t.vec2.angle=function(e,r){return Math.acos(t.vec2.dot(e,r))},t.vec2.rotation=function(e){return Math.atan2(e[1],e[0])},t.vec2.equals=function(e,t,r){return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r},t.vec2.ZERO=t.vec2(0,0),t.vec2.ONE=t.vec2(1,1),t.vec2.AXIS_Y=t.vec2(0,1),t.vec2.AXIS_X=t.vec2(1,0)},2820:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=void 0,t.vec3=function(e,r,a){return void 0===e&&(e=0),void 0===r&&(r=0),void 0===a&&(a=0),t.vec3.set(e,r,a,new Float32Array(3))},t.vec3.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.vec3.set=function(e,t,r,a){return a[0]=e,a[1]=t,a[2]=r,a},t.vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},t.vec3.subtract=function(e,t,r){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r},t.vec3.add=function(e,t,r){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r},t.vec3.cross=function(e,t,r){var a=e[0],n=e[1],i=e[2],o=t[0],s=t[1],l=t[2];return r[0]=n*l-i*s,r[1]=i*o-a*l,r[2]=a*s-n*o,r},t.vec3.magnitudeSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},t.vec3.distanceSquared=function(e,t){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return r*r+a*a+n*n},t.vec3.magnitude=function(e){return Math.sqrt(t.vec3.magnitudeSquared(e))},t.vec3.distance=function(e,r){return Math.sqrt(t.vec3.distanceSquared(e,r))},t.vec3.normalize=function(e,t){var r=e[0],a=e[1],n=e[2],i=r*r+a*a+n*n,o=i&&1/Math.sqrt(i);return t[0]=r*o,t[1]=a*o,t[2]=n*o,t},t.vec3.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r},t.vec3.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r},t.vec3.lerp=function(e,t,r,a){return a[0]=e[0]+r*(t[0]-e[0]),a[1]=e[1]+r*(t[1]-e[1]),a[2]=e[2]+r*(t[2]-e[2]),a},t.vec3.angle=function(e,r){var a=Math.sqrt(t.vec3.magnitudeSquared(e)*t.vec3.magnitudeSquared(r)),n=a&&t.vec3.dot(e,r)/a;return Math.acos(Math.min(Math.max(n,-1),1))},t.vec3.random=function(e,t,r){return e=2*e*Math.PI,t=2*t-1,r[2]=t,t=Math.sqrt(1-t*t),r[0]=Math.cos(e)*t,r[1]=Math.sin(e)*t,r},t.vec3.equals=function(e,t,r){return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r},t.vec3.orthogonal=function(e,r){var a=Math.abs(e[0]),n=Math.abs(e[1]),i=Math.abs(e[2]),o=a<n?a<i?t.vec3.AXIS_X:t.vec3.AXIS_Z:n<i?t.vec3.AXIS_Y:t.vec3.AXIS_Z;return t.vec3.cross(e,o,r),r},t.vec3.slerp=function(e,r,a,n){var i=t.vec3.angle(e,r),o=Math.sin(i),s=Math.sin((1-a)*i)/o,l=Math.sin(a*i)/o;return n[0]=e[0]*s+r[0]*l,n[1]=e[1]*s+r[1]*l,n[2]=e[2]*s+r[2]*l,n},t.vec3.project=function(e,r,a){var n=t.vec3.magnitudeSquared(r),i=n&&t.vec3.dot(e,r)/n;return t.vec3.scale(r,i,a)},t.vec3.projectPlane=function(e,r,a){var n=t.vec3.dot(e,r);return a[0]=e[0]-r[0]*n,a[1]=e[1]-r[1]*n,a[2]=e[2]-r[2]*n,a},t.vec3.centroid=function(){for(var e=arguments.length-1,t=1/e,r=0,a=0,n=0,i=e-1;i>=0;i--)r+=arguments[i][0],a+=arguments[i][1],n+=arguments[i][2];return arguments[e][0]=r*t,arguments[e][1]=a*t,arguments[e][2]=n*t,arguments[e]},t.vec3.ZERO=t.vec3(0,0,0),t.vec3.ONE=t.vec3(1,1,1),t.vec3.AXIS_X=t.vec3(1,0,0),t.vec3.AXIS_Y=t.vec3(0,1,0),t.vec3.AXIS_Z=t.vec3(0,0,1)},4809:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=void 0,t.vec4=function(e,r,a,n){return void 0===e&&(e=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===n&&(n=1),t.vec4.set(e,r,a,n,new Float32Array(4))},t.vec4.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.vec4.set=function(e,t,r,a,n){return n[0]=e,n[1]=t,n[2]=r,n[3]=a,n},t.vec4.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.vec4.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r},t.vec4.normalize=function(e,t){var r=e[0],a=e[1],n=e[2],i=e[3],o=r*r+a*a+n*n+i*i,s=o&&1/Math.sqrt(o);return t[0]=r*s,t[1]=a*s,t[2]=n*s,t[3]=i*s,t},t.vec4.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r},t.vec4.lerp=function(e,t,r,a){return a[0]=e[0]+r*(t[0]-e[0]),a[1]=e[1]+r*(t[1]-e[1]),a[2]=e[2]+r*(t[2]-e[2]),a[3]=e[3]+r*(t[3]-e[3]),a},t.vec4.ZERO=t.vec4(0,0,0,0),t.vec4.ONE=t.vec4(1,1,1,1)},7557:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleEmitter=void 0;var a=r(7594),n=r(556),i=function(){function e(e,t){this.range=a.vec2(),this.offset=0,this.count=0,this.rate=0,this.amount=1,this.elapsed=0,this.queue=[],this.uniform=new n.UniformBlock(e,t.uniforms.EmitterUniforms,n.UniformBlockBindings.EmitterUniforms)}return e.prototype.update=function(e,t,r){var a=e.currentTime,n=e.deltaTime;if(this.uniform.uniforms.uLastID[0]=this.offset+this.range[1],this.rate)for(this.elapsed+=n;this.elapsed>this.rate;this.elapsed-=this.rate)this.count+=this.amount;else this.elapsed=0;for(;this.queue.length&&this.queue[0]<a;){this.queue.shift();var i=this.queue.shift();this.offset+=i,this.count-=i,this.range[1]-=i}var o=Math.min(r.limit-this.offset,0|this.count),s=o-this.range[1],l=this.uniform.uniforms.uLifespan[1]-this.uniform.uniforms.uLifespan[2];return s>0&&this.queue.push(a+l,s),this.range[0]=this.offset,this.range[1]=o,this.offset=t,o},e}();t.ParticleEmitter=i},7219:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleGeometry=t.AttributeCurveSampler=void 0;var a=r(556);t.AttributeCurveSampler=function(e,t,r){for(var n,i,o,s,l=Math.ceil(r.length/4),c=new Float32Array(t*l*4),u=1/(t-1),f=0;f<l;f++)for(var m=0;m<t;m++){var h=m+f*t,d=m*u;c[4*h+0]=(null===(n=r[4*f+0])||void 0===n?void 0:n.call(r,d))||0,c[4*h+1]=(null===(i=r[4*f+1])||void 0===i?void 0:i.call(r,d))||0,c[4*h+2]=(null===(o=r[4*f+2])||void 0===o?void 0:o.call(r,d))||0,c[4*h+3]=(null===(s=r[4*f+3])||void 0===s?void 0:s.call(r,d))||0}return a.createTexture(e,{width:t,height:l,data:c},{format:34842,filter:9728,wrap:33071,flipY:!1,mipmaps:0,type:3553})};var n=function(){function e(){}return e.quad=function(e){var t=e.createBuffer();return e.bindBuffer(34962,t),e.bufferData(34962,new Float32Array([-.5,.5,0,0,0,-.5,-.5,0,0,1,.5,-.5,0,1,1,.5,.5,0,1,0]),35044),{drawMode:6,vbo:t,frame:0,indexOffset:0,indexCount:4,vao:null,aabb:null,radius:.5,format:[{name:"aPosition",size:3,type:5126,stride:20,offset:0},{name:"aUV",size:2,type:5126,stride:20,offset:12}]}},e.board=function(e,t){var r=e.createBuffer();return e.bindBuffer(34962,r),e.bufferData(34962,new Float32Array([0,t,0,0,0,0,-t,0,0,1,1,-t,0,1,1,1,t,0,1,0]),35044),{drawMode:6,vbo:r,frame:0,indexOffset:0,indexCount:4,vao:null,aabb:null,radius:.5,format:[{name:"aPosition",size:3,type:5126,stride:20,offset:0},{name:"aUV",size:2,type:5126,stride:20,offset:12}]}},e.stripe=function(e,t,r){var a=e.createBuffer();e.bindBuffer(34962,a);for(var n=new Float32Array(2*t*5),i=0;i<t;i++){var o=i/(t-1);n[2*i*5+0]=-.5*r(o),n[2*i*5+1]=o,n[2*i*5+2]=0,n[2*i*5+3]=0,n[2*i*5+4]=o,n[2*i*5+5]=.5*r(o),n[2*i*5+6]=o,n[2*i*5+7]=0,n[2*i*5+8]=1,n[2*i*5+9]=o}return e.bufferData(34962,n,35044),{drawMode:5,vbo:a,frame:0,indexOffset:0,indexCount:2*t,vao:null,aabb:null,radius:0,format:[{name:"aPosition",size:3,type:5126,stride:20,offset:0},{name:"aUV",size:2,type:5126,stride:20,offset:12}]}},e}();t.ParticleGeometry=n},422:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleSystem=void 0;var a=r(556),n=r(7557),i=function(){function e(e,t,r,a,n){this.context=e,this.options=t,this.mesh=r,this.program=a,this.transform=n,this.pool=[],this.enabled=!0,this.index=0,this.instances=0,this.tfbWrite=[],this.tfbRead=[],this.vao=[],this.buffer=[],this.emitters=[];for(var i=this.context.gl,o=0;o<2;o++){if(this.buffer[o]=i.createBuffer(),i.bindBuffer(34962,this.buffer[o]),i.bufferData(34962,t.limit*t.format[0].stride,n?35042:35048),n&&(this.tfbWrite[o]=i.createTransformFeedback(),i.bindTransformFeedback(36386,this.tfbWrite[o]),i.bindBufferBase(35982,0,this.buffer[o]),i.bindTransformFeedback(36386,null)),n&&r){this.tfbRead[o]=i.createVertexArray(),i.bindVertexArray(this.tfbRead[o]),i.bindBuffer(34962,this.buffer[o]);for(var s=0;s<t.format.length;s++){var l=t.format[s],c=l.size,u=l.type,f=l.normalized,m=l.stride,h=l.offset;i.enableVertexAttribArray(s),i.vertexAttribPointer(s,c,u,f,m,h)}i.bindVertexArray(null)}if(this.program){var d=0;this.vao[o]=i.createVertexArray(),i.bindVertexArray(this.vao[o]),i.bindBuffer(34962,this.buffer[o]);for(var v=0;v<t.format.length;v++,d++){var p=t.format[v];c=p.size,u=p.type,f=p.normalized,m=p.stride,h=p.offset,i.enableVertexAttribArray(d),i.vertexAttribPointer(d,c,u,f,m,h),this.mesh&&i.vertexAttribDivisor(d,1)}if(this.mesh){this.mesh.ibo&&i.bindBuffer(34963,this.mesh.ibo),i.bindBuffer(34962,this.mesh.vbo);for(var y=this.mesh.ibo?1:0;y<this.mesh.format.length;y++,d++){var g=this.mesh.format[y];c=g.size,u=g.type,f=g.normalized,m=g.stride,h=g.offset,i.enableVertexAttribArray(d),i.vertexAttribPointer(d,c,u,f,m,h)}}i.bindVertexArray(null)}if(!n)break}}return e.prototype.apply=function(){if(this.enabled){if(this.transform)for(var e=this.instances=0;e<this.emitters.length;e++)this.instances+=this.emitters[e].update(this.context,this.instances,this.options);if(this.instances){var t=this.context.gl;if(this.material.bind(t),this.transform&&this.emitters.length){for(t.useProgram(this.transform.target),t.bindVertexArray(this.tfbRead[this.index]),t.bindTransformFeedback(36386,this.tfbWrite[this.index^=1]),this.mesh&&t.enable(35977),t.beginTransformFeedback(0),e=0;e<this.emitters.length;e++){var r=this.emitters[e];r.range[1]&&(r.uniform.bind(t,a.UniformBlockBindings.EmitterUniforms),t.drawArrays(0,r.range[0],r.range[1]))}t.endTransformFeedback(),this.mesh&&t.disable(35977),t.bindTransformFeedback(36386,null)}this.program&&(t.useProgram(this.program.target),t.bindVertexArray(this.vao[this.index]),this.mesh?this.mesh.ibo?t.drawElementsInstanced(this.mesh.drawMode,this.mesh.indexCount,5123,this.mesh.indexOffset,this.instances):t.drawArraysInstanced(this.mesh.drawMode,this.mesh.indexOffset,this.mesh.indexCount,this.instances):t.drawArrays(0,0,this.instances))}}},e.prototype.add=function(e){var t=this.pool.pop()||new n.ParticleEmitter(this.context.gl,this.transform);for(var r in e)t.uniform.uniforms[r].set(e[r],0);return this.emitters.push(t),t},e.prototype.remove=function(e){var t=this.emitters.indexOf(e);~t&&(this.emitters[t]=this.emitters[this.emitters.length-1],this.emitters.length--,this.pool.push(e))},e}();t.ParticleSystem=i},1088:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StaticParticleSystem=void 0;var r=function(){function e(e,t,r,a,n){this.context=e,this.options=t,this.mesh=r,this.program=a,this.enabled=!0,this.instances=0,this.list=[],this.samplers=[];var i=this.context.gl;this.buffer=i.createBuffer(),i.bindBuffer(34962,this.buffer),i.bufferData(34962,t.limit*t.format[0].stride,35048);var o=0;this.vao=i.createVertexArray(),i.bindVertexArray(this.vao);for(var s=0;s<t.format.length;s++,o++){var l=t.format[s],c=l.size,u=l.type,f=l.normalized,m=l.stride,h=l.offset;i.enableVertexAttribArray(o),i.vertexAttribPointer(o,c,u,f,m,h),this.mesh&&i.vertexAttribDivisor(o,1)}if(this.mesh)for(this.mesh.ibo&&i.bindBuffer(34963,this.mesh.ibo),i.bindBuffer(34962,this.mesh.vbo),s=this.mesh.ibo?1:0;s<this.mesh.format.length;s++,o++){var d=this.mesh.format[s];c=d.size,u=d.type,f=d.normalized,m=d.stride,h=d.offset,i.enableVertexAttribArray(o),i.vertexAttribPointer(o,c,u,f,m,h)}i.bindVertexArray(null),this.stride=this.options.format[0].stride/Float32Array.BYTES_PER_ELEMENT;var v=function(e){var t=p.options.format.find((function(t){return t.name===e}));if(!t)throw new Error(e+"!="+p.options.format.map((function(e){return e.name})).join(","));var r=t.offset/Float32Array.BYTES_PER_ELEMENT;p.samplers.push({offset:r,sample:n[e]})},p=this;for(var y in n)v(y)}return e.prototype.uploadVertexData=function(){var e=this.context.gl;this.instances=0;for(var t=0,r=0;r<this.list.length;r++){var a=this.list[r];if(a.expiry>0&&a.expiry<=this.context.currentTime)t++;else{t&&(this.list[r-t]=a);var n=this.instances*this.stride*Float32Array.BYTES_PER_ELEMENT;if(this.instances+a.count>=this.options.limit)break;this.instances+=a.count,a.frame>0&&a.offset===n||(a.frame=this.context.frame,e.bindBuffer(34962,this.buffer),e.bufferSubData(34962,a.offset=n,a.vertexArray))}}this.list.length-=t},e.prototype.apply=function(){if(this.enabled){var e=this.context.gl;this.uploadVertexData(),this.instances&&(this.material.bind(e),e.useProgram(this.program.target),e.bindVertexArray(this.vao),this.mesh?this.mesh.ibo?e.drawElementsInstanced(this.mesh.drawMode,this.mesh.indexCount,5123,this.mesh.indexOffset,this.instances):e.drawArraysInstanced(this.mesh.drawMode,this.mesh.indexOffset,this.mesh.indexCount,this.instances):e.drawArrays(0,0,this.instances))}},e.prototype.start=function(e,t){for(var r=new Float32Array(this.stride*e),a=0;a<e;a++)for(var n=a*this.stride,i=this.samplers.length-1;i>=0;i--)this.samplers[i].sample.call(this,t,n+this.samplers[i].offset,r);return this.list.push({count:e,vertexArray:r,offset:-1,frame:0,expiry:-1}),this.list[this.list.length-1]},e.prototype.stop=function(e){for(var t=e.vertexArray,r=e.count,a=this.context.currentTime,n=0;n<r;n++){var i=n*this.stride,o=t[i+0],s=t[i+3],l=Math.max(0,this.context.currentTime-o)%s,c=Math.floor(Math.max(0,this.context.currentTime-o)/s);t[i+0]=this.context.currentTime-l,t[i+2]+=.1*c,t[i+3]=0,a=Math.max(a,this.context.currentTime-l+s)}e.expiry=a,e.frame=0},e}();t.StaticParticleSystem=r},9217:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(7557),t),n(r(422),t),n(r(7219),t),n(r(1088),t)},4913:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.AmbientLightPass=t.HemisphereLight=void 0;var i=r(7594),o=r(556),s=r(7400),l=r(2047),c=r(8211),u=r(8906),f=r(9706),m=r(3335),h=function(){function e(){this.frame=0,this.axis=i.vec3(0,1,0),this.color0=i.vec3(.15,.16,.18),this.color1=i.vec3(.05,.04,.03)}return e.prototype.update=function(e){this.frame||(this.frame=e.frame,this.uniform||(this.uniform=new o.UniformBlock(e.gl,{byteSize:48},o.UniformBlockBindings.LightUniforms)),this.uniform.data.set(this.axis,0),this.uniform.data.set(this.color0,4),this.uniform.data.set(this.color1,8))},e}();t.HemisphereLight=h;var d=function(e){function t(t){var r=e.call(this,t)||this;return r.environment=new h,r.program=o.ShaderProgram(r.context.gl,c.shaders.fullscreen_vert,c.shaders.ambient_frag,{REFLECTION_MAP:!0,IRRADIANCE_MAP:!1,IBL:!0}),r.program.uniforms.uBRDFLUT=o.UniformSamplerBindings.uAttributes,r.reflection=new f.LightField(r.context),r}return n(t,e),t.prototype.update=function(){var e=this.context.gl,t=this.context.get(m.CameraSystem),r=t.camera,a=t.controller;this.reflection.relocateProbes(a.cameraTarget),r.uniform.bind(e,o.UniformBlockBindings.CameraUniforms),this.context.get(l.PostEffectPass).swapRenderTarget(!1,!1),e.depthMask(!1),e.disable(2929),e.enable(3042),e.blendFunc(1,1),e.enable(2884),e.cullFace(1029),e.clear(16384),this.context.get(s.DeferredGeometryPass).bindReadBuffer(),this.environment.update(this.context);var n=this.context.get(l.PostEffectPass).plane;e.activeTexture(33984+o.UniformSamplerBindings.uAttributes),e.bindTexture(3553,this.reflection.brdfLUT),e.useProgram(this.program.target),e.bindVertexArray(n.vao),this.environment.uniform.bind(e,o.UniformBlockBindings.LightUniforms);for(var i=this.reflection.probes.length-1;i>=0;i--){var c=this.reflection.probes[i],u=this.reflection.calculateWeight(a.cameraTarget,c);u&&(this.program.uniforms.uWeight=u,e.activeTexture(33984+o.UniformSamplerBindings.uEnvironmentMap),e.bindTexture(34067,c.cubemap),e.drawElements(4,n.indexCount,5123,n.indexOffset))}},t}(u.PipelinePass);t.AmbientLightPass=d},5380:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.DecalPass=t.Decal=void 0;var i=r(7594),o=r(1974),s=r(7400),l=r(3453),c=r(556),u=r(2130),f=r(8211),m=r(8906),h=function(){function e(){this.frame=0,this.order=0,this.color=i.vec4(1,1,1,1),this.threshold=0,this.bounds=new l.BoundingVolume}return e.prototype.update=function(e,t){this.frame&&this.frame>=this.transform.frame||(this.frame=e,this.bounds.update(this.transform,1))},e}();t.Decal=h;var d=function(e){function t(t){var r=e.call(this,t)||this;r.pool=[],r.list=[],r.effects=[];var a=r.context.gl;r.batch=new u.DecalBatch(a,128),r.program=c.ShaderProgram(a,f.shaders.decal_vert,f.shaders.decal_frag,{INSTANCED:!0,NORMAL_MAPPING:!0,MASK:!0}),r.program.uniforms.uLayer=1,r.program.uniforms.uDissolveEdge=.1,r.defaultNormalMap=c.createTexture(a,{width:1,height:1,data:new Uint8Array([127,127,127,0])});var n=r.context.get(s.DeferredGeometryPass);return r.fbo=a.createFramebuffer(),a.bindFramebuffer(36160,r.fbo),a.framebufferRenderbuffer(36160,36096,36161,n.depth),a.framebufferTexture2D(36160,36064,3553,n.albedo,0),a.framebufferTexture2D(36160,36065,3553,n.normal,0),a.drawBuffers([36064,36065]),a.bindFramebuffer(36160,null),r}return n(t,e),t.prototype.create=function(e){var r=this.pool.pop()||new h;r.order=e;var a=i.binarySearch(this.list,r,t.orderSort,!0);return this.list.splice(a,0,r),r},t.prototype.delete=function(e){var t=this.list.indexOf(e);-1!=t&&(this.list.splice(t,1),this.pool.push(e),i.vec4.copy(i.vec4.ONE,e.color),e.frame=e.threshold=0,e.transform=e.material=null)},t.prototype.update=function(){var e=this.context.gl;e.bindFramebuffer(36160,this.fbo),e.activeTexture(33984+c.UniformSamplerBindings.uPositionBuffer),e.bindTexture(3553,this.context.get(s.DeferredGeometryPass).position);for(var t=this.context.get(o.CameraSystem).camera,r=null,a=this.list.length-1;a>=0;a--){var n=this.list[a];if(n.update(this.context.frame,this.context),t.culling.cull(n.bounds,65535)){if(r||(r=n.material),n.material.diffuse!==r.diffuse||n.material.program!==r.program)a++;else if(this.batch.render(n)){if(a)continue}else a++;var i=r;r=null;var l=this.batch.instanceOffset;l&&(this.batch.bind(),e.useProgram((i.program||this.program).target),i.bind(e),e.activeTexture(33984+c.UniformSamplerBindings.uDiffuseMap),e.bindTexture(3553,i.diffuse),e.activeTexture(33984+c.UniformSamplerBindings.uNormalMap),e.bindTexture(3553,i.normal||this.defaultNormalMap),e.drawElementsInstanced(4,u.DecalBatch.unitCubeIndices.length,5123,0,l))}}for(a=this.effects.length-1;a>=0;a--)this.effects[a].apply()},t.orderSort=function(e,t){return e.order-t.order},t}(m.PipelinePass);t.DecalPass=d},7400:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.DeferredGeometryPass=void 0;var i=r(3335),o=r(391),s=r(556),l=r(8211),c=function(e){function t(t){var r=e.call(this,t)||this;r.effects=[];var a=t.gl;return r.allocateGeometryBuffer(a,a.drawingBufferWidth,a.drawingBufferHeight),r.programs=[s.ShaderProgram(a,l.shaders.geometry_vert,l.shaders.geometry_frag,{NORMAL_MAPPING:!0}),s.ShaderProgram(a,l.shaders.geometry_vert,l.shaders.geometry_frag,{SKINNING:!0,NORMAL_MAPPING:!0,COLOR_INDEX:!0}),s.ShaderProgram(a,l.shaders.geometry_vert,l.shaders.geometry_frag,{NORMAL_MAPPING:!0,COLOR_INDEX:!0})],r}return n(t,e),t.prototype.bindReadBuffer=function(){var e=this.context.gl;e.activeTexture(33984+s.UniformSamplerBindings.uPositionBuffer),e.bindTexture(3553,this.position),e.activeTexture(33984+s.UniformSamplerBindings.uNormalBuffer),e.bindTexture(3553,this.normal),e.activeTexture(33984+s.UniformSamplerBindings.uAlbedoBuffer),e.bindTexture(3553,this.albedo)},t.prototype.update=function(){var e=this.context.gl;e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.bindFramebuffer(36160,this.gbuffer),e.clearColor(0,0,0,0),e.clearDepth(1),e.depthMask(!0),e.clear(16640);var t=this.context.get(i.CameraSystem).camera;t.uniform.bind(e,s.UniformBlockBindings.CameraUniforms),this.context.get(i.CameraSystem).uniform.bind(e,s.UniformBlockBindings.GlobalUniforms);var r=this.context.get(o.MeshSystem).list;this.render(r,t.culling)},t.prototype.render=function(e,t){for(var r=this.context.gl,a=null,n=e.length-1;n>=0;n--){var i=e[n];0!==i.color[3]&&t.cull(i.bounds,i.layer)&&(a!==i.material.program&&r.useProgram((a=i.material.program).target),i.uniform.bind(r,s.UniformBlockBindings.ModelUniforms),i.armature&&(i.material.program.uniforms.uBoneMatrix=i.armature.boneMatrix),i.material.bind(r),r.bindVertexArray(i.buffer.vao),r.drawElements(4,i.buffer.indexCount,5123,i.buffer.indexOffset))}for(n=this.effects.length-1;n>=0;n--)this.effects[n].apply()},t.prototype.allocateGeometryBuffer=function(e,t,r){if(!e.getExtension("EXT_color_buffer_float"))throw new Error("FLOAT color buffer not available");if(this.position=s.createTexture(e,{width:t,height:r},{format:34842,filter:9728,wrap:33071,mipmaps:0}),this.normal=s.createTexture(e,{width:t,height:r},{format:34842,filter:9728,wrap:33071,mipmaps:0}),this.albedo=s.createTexture(e,{width:t,height:r},{format:32856,filter:9728,wrap:33071,mipmaps:0}),this.depth=e.createRenderbuffer(),e.bindRenderbuffer(36161,this.depth),e.renderbufferStorage(36161,33189,t,r),this.gbuffer=e.createFramebuffer(),e.bindFramebuffer(36160,this.gbuffer),e.framebufferRenderbuffer(36160,36096,36161,this.depth),e.framebufferTexture2D(36160,36064,3553,this.albedo,0),e.framebufferTexture2D(36160,36065,3553,this.normal,0),e.framebufferTexture2D(36160,36066,3553,this.position,0),e.drawBuffers([36064,36065,36066]),36053!=e.checkFramebufferStatus(36160))throw new Error("Framebuffer incomplete!");e.bindFramebuffer(36160,null)},t}(r(8906).PipelinePass);t.DeferredGeometryPass=c},4308:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.OverlayPass=void 0;var i=r(7594),o=r(556),s=r(2130),l=function(e){function t(t){var a=e.call(this,t)||this,n=t.gl,l=n.getParameter(34930),c=r(2652);return c=c.replace(/^#FOR(.*)$/gm,(function(e,t){return i.range(l).map((function(e){return t.replace(/#i/g,e)})).join("\n")})),a.program=o.ShaderProgram(n,r(3582),c,{MAX_TEXTURE_UNITS:l}),a.program.uniforms.uSamplers=i.range(l),a.batch=new s.Batch2D(a.context.gl,4096,6144,null),a}return n(t,e),t.prototype.update=function(){},t}(r(8906).PipelinePass);t.OverlayPass=l},8990:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleEffectPass=void 0;var i=r(7594),o=r(556),s=r(2130),l=r(1974),c=r(7400),u=r(8906),f=r(8211),m=function(e){function t(r){var a=e.call(this,r)||this;a.effects=[],a.list=[];var n=r.gl,l=n.getParameter(34930);return a.batch=new s.GeometryBatch(n,4*t.batchSize,6*t.batchSize),a.program=o.ShaderProgram(n,f.shaders.batch_vert,f.shaders.batch_frag.replace(/^#FOR(.*)$/gm,(function(e,t){return i.range(l).map((function(e){return t.replace(/#i/g,e)})).join("\n")})),{MAX_TEXTURE_UNITS:l}),a.program.uniforms.uSamplers=i.range(l),a}return n(t,e),t.prototype.add=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=this.list).push.apply(e,t)},t.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=e.length-1;r>=0;r--){var a=e[r],n=this.list.indexOf(a);-1!=n&&(this.list[n]=this.list[this.list.length-1],this.list.length--)}},t.prototype.sort=function(e,t){for(var r=e.length,a=void 0,n=0;n<r;n++){var i=e[n];for(a=n-1;a>=0&&i.order>e[a].order;a--)e[a+1]=e[a];e[a+1]=i}},t.prototype.update=function(){this.render(this.list),this.context.get(c.DeferredGeometryPass).bindReadBuffer();for(var e=this.effects.length-1;e>=0;e--)this.effects[e].apply()},t.prototype.render=function(e){var r=this.context.gl,a=this.context.get(l.CameraSystem).camera;i.insertionSort(e,t.orderSort);for(var n=null,s=e.length-1;s>=0;s--){var c=e[s];if(c.update(this.context,a),a.culling.cull(c.bounds,65535)){if(!n){if(!c.vertices){r.bindVertexArray(c.buffer.vao),r.useProgram(c.material.program.target),c.material.bind(r),c.uniform.bind(r,o.UniformBlockBindings.ModelUniforms),r.drawElements(c.buffer.drawMode,c.buffer.indexCount,5123,c.buffer.indexOffset);continue}n=c.material}if(n.merge(c.material))if(this.batch.render(c)){if(s)continue}else s++;else s++;var u=this.batch.indexOffset;u&&(r.useProgram(n.program.target),n.bind(r),this.batch.bind(),r.drawElements(4,u,5123,0)),n=null}}},t.orderSort=function(e,t){return e.order-t.order},t.batchSize=1024,t}(u.PipelinePass);t.ParticleEffectPass=m},8906:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PipelinePass=void 0;t.PipelinePass=function(e){this.context=e}},7449:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.PointLightPass=t.PointLight=void 0;var i=r(7594),o=r(6240),s=r(8783),l=r(1974),c=r(3453),u=r(556),f=r(8906),m=r(8211),h=function(){function e(){this.index=-1,this.frame=0,this.color=i.vec3(1,1,1),this.intensity=1,this.radius=1,this.bounds=new c.BoundingVolume}return e.prototype.update=function(e){var t;this.frame&&this.frame>=this.transform.frame||(this.frame=e.frame,this.uniform||(this.uniform=new u.UniformBlock(e.gl,{byteSize:88},u.UniformBlockBindings.LightUniforms)),this.bounds.update(this.transform,this.radius),this.uniform.data.set((null===(t=this.transform)||void 0===t?void 0:t.matrix)||i.mat4.IDENTITY,0),this.uniform.data.set(this.color,16),this.uniform.data[20]=this.radius,this.uniform.data[21]=this.intensity)},e}();t.PointLight=h;var d=function(e){function t(t){var r=e.call(this,t)||this;r.pool=[],r.list=[];var a=t.gl;r.program=u.ShaderProgram(a,m.shaders.light_vert,m.shaders.pbr_frag,{OMNILIGHT:!0,GGX:!0,SCHLICK:!0});var n=o.createSphere({longitude:32,latitude:32,radius:1});return r.sphere=r.context.get(s.MeshSystem).uploadVertexData(n.vertexArray,n.indexArray,n.format),r}return n(t,e),t.prototype.create=function(e){var t=this.pool.pop()||new h;return t.index=this.list.push(t)-1,t.frame=0,i.vec3.copy(e||i.vec3.ONE,t.color),t.intensity=1,t.radius=1,t},t.prototype.delete=function(e){-1!=e.index&&(this.list[e.index]=this.list[this.list.length-1],this.list[e.index].index=e.index,this.list.length--,e.index=-1,this.pool.push(e))},t.prototype.update=function(){var e=this.context.gl,t=this.context.get(l.CameraSystem).camera,r=this.list;e.enable(2884),e.cullFace(1028),e.useProgram(this.program.target),e.bindVertexArray(this.sphere.vao);for(var a=r.length-1;a>=0;a--){var n=r[a];n.update(this.context),t.culling.cull(n.bounds,65535)&&(n.uniform.bind(e,u.UniformBlockBindings.LightUniforms),e.drawElements(4,this.sphere.indexCount,5123,this.sphere.indexOffset))}},t}(f.PipelinePass);t.PointLightPass=d},2047:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.PostEffectPass=void 0;var i=r(6240),o=r(8783),s=r(556),l=r(7400),c=r(8990),u=r(9706),f=function(e){function t(t){var r=e.call(this,t)||this;r.fbo=[],r.renderTarget=[],r.index=0,r.list=[],r.effects=[];var a=t.gl,n=i.createPlane({width:2,height:-2,columns:1,rows:1});r.plane=r.context.get(o.MeshSystem).uploadVertexData(n.vertexArray,n.indexArray,n.format);for(var c=0;c<2;c++)r.fbo[c]=a.createFramebuffer(),r.renderTarget[c]=s.createTexture(a,{width:a.drawingBufferWidth,height:a.drawingBufferHeight},{flipY:!1,wrap:33071,format:32856,mipmaps:0,filter:9729}),a.bindFramebuffer(36160,r.fbo[c]),a.framebufferRenderbuffer(36160,36096,36161,r.context.get(l.DeferredGeometryPass).depth),a.framebufferTexture2D(36160,36064,3553,r.renderTarget[c],0);return r.effects.push(r.fog=new u.FogEffect(r.context),r.bloom=new u.BloomEffect(r.context)),r}return n(t,e),t.prototype.swapRenderTarget=function(e,t){var r=this.context.gl;r.activeTexture(33984+s.UniformSamplerBindings.uSampler),r.bindTexture(3553,this.renderTarget[this.index]),e?r.bindFramebuffer(36160,null):r.bindFramebuffer(36160,this.fbo[this.index^=1]),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),t?(r.bindFramebuffer(36009,e?null:this.fbo[this.index]),r.bindFramebuffer(36008,this.fbo[e?this.index:1^this.index]),r.blitFramebuffer(0,0,r.drawingBufferWidth,r.drawingBufferHeight,0,0,r.drawingBufferWidth,r.drawingBufferHeight,16384,9728)):e||(r.clearColor(0,0,0,0),r.clear(16384))},t.prototype.add=function(e){this.list.push(e)},t.prototype.remove=function(e){var t=this.list.indexOf(e);-1!=t&&this.list.splice(t,1)},t.prototype.update=function(){var e=this.context.gl;this.list.length&&(e.activeTexture(33984+s.UniformSamplerBindings.uAlbedoBuffer),e.bindTexture(3553,this.renderTarget[this.index]),this.swapRenderTarget(!1,!0),e.disable(3042),e.disable(2884),e.depthFunc(515),e.enable(2929),this.context.get(c.ParticleEffectPass).render(this.list));for(var t=this.effects.length-1;t>=0;t--)this.effects[t].active&&this.effects[t].apply(this,!1);this.swapRenderTarget(!0,!0)},t}(r(8906).PipelinePass);t.PostEffectPass=f},9460:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Batch2D=void 0;var i=r(556),o=r(2121),s=r(9755),l=function(e){function t(t,r,a,n){var o=e.call(this,t,i.VertexDataFormat.Batched2D,r,a,n)||this;return o.textures=[],o.maxTextures=t.getParameter(34930),o}return n(t,e),t.prototype.render=function(e){var t=e.vertices,r=e.uvs,a=e.indices,n=e.colors,i=e.material,o=a.length,l=t.length>>>1;0==this.indexOffset&&(this.textures.length=0);var c=this.textures.indexOf(i.diffuse);if(-1==c&&this.textures.length>=this.maxTextures||this.indexOffset+o>this.maxIndices||this.vertexOffset+l>this.maxVertices)return!1;-1==c&&(c=this.textures.push(i.diffuse)-1);var u=s.uintNorm4x8(e.color[0],e.color[1],e.color[2],e.color[3]),f=c<<24;if(!this.fixedIndices)for(var m=0;m<o;m++)this.indexArray[this.indexOffset+m]=a[m]+this.vertexOffset;this.indexOffset+=o;for(var h=this.format[1].stride>>>2,d=(m=0,this.vertexOffset*h);m<l;m++,d+=h)this.float32View[d+0]=t[2*m+0],this.float32View[d+1]=t[2*m+1],this.uint32View[d+2]=s.uintNorm2x16(r[2*m],r[2*m+1]),this.uint32View[d+3]=n?n[m]:u,this.uint32View[d+4]=f;return this.vertexOffset+=l,!0},t.prototype.bind=function(){e.prototype.bind.call(this),this.bindTextures(this.textures)},t.prototype.bindTextures=function(e){for(var t=this.gl,r=0;r<e.length;r++)t.activeTexture(33984+r),t.bindTexture(3553,e[r])},t.quadIndices=[0,1,2,0,2,3],t}(o.VertexDataBatch);t.Batch2D=l},3432:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DecalBatch=void 0;var a=r(7594),n=r(556),i=r(9755),o=function(){function e(t,r){this.gl=t,this.batchSize=r,this.format=n.VertexDataFormat.Decal,this.instanceOffset=0,this.vao=t.createVertexArray(),t.bindVertexArray(this.vao),this.indexBuffer=t.createBuffer(),t.bindBuffer(34963,this.indexBuffer),t.bufferData(34963,e.unitCubeIndices,35044),this.vertexBuffer=t.createBuffer(),t.bindBuffer(34962,this.vertexBuffer),t.bufferData(34962,e.unitCubeVertices,35044),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,5126,!1,0,0),this.stride=this.format[0].stride/Float32Array.BYTES_PER_ELEMENT,this.float32View=new Float32Array(this.stride*r),this.uint32View=new Uint32Array(this.float32View.buffer),this.instanceBuffer=t.createBuffer(),t.bindBuffer(34962,this.instanceBuffer),t.bufferData(34962,this.float32View.byteLength,35048);for(var a=0,i=0;i<this.format.length;i++)for(var o=this.format[i],s=o.size,l=o.type,c=o.normalized,u=o.stride,f=o.offset,m=s;m>0;m-=4)t.enableVertexAttribArray(++a),t.vertexAttribPointer(a,Math.min(4,m),l,c,u,f),t.vertexAttribDivisor(a,1),f+=Math.min(4,m)*n.GLSLDataType[l].BYTES_PER_ELEMENT;t.bindVertexArray(null)}return e.prototype.render=function(t){var r,n;if(this.instanceOffset+1>=this.batchSize)return!1;var o=i.uintNorm4x8(t.color[0],t.color[1],t.color[2],t.color[3]);if(!o)return!0;var s=(null===(r=t.transform)||void 0===r?void 0:r.matrix)||a.mat4.IDENTITY,l=(null===(n=t.material)||void 0===n?void 0:n.uvTransform)||e.uvTransform,c=this.instanceOffset*this.stride;return this.float32View.set(s,c),this.float32View[c+3]=t.threshold,this.float32View[c+7]=0,this.float32View[c+11]=0,this.float32View[c+15]=1,this.uint32View[c+16]=i.uintNorm2x16(l[0],l[1]),this.uint32View[c+17]=i.uintNorm2x16(l[0]+l[2],l[1]+l[3]),this.uint32View[c+18]=o,this.instanceOffset++,!0},e.prototype.bind=function(){var e=this.gl;e.bindVertexArray(this.vao),this.instanceOffset&&(e.bindBuffer(34962,this.instanceBuffer),e.bufferSubData(34962,0,this.float32View.subarray(0,this.instanceOffset*this.stride)),this.instanceOffset=0)},e.prototype.delete=function(){this.gl.deleteBuffer(this.indexBuffer),this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.instanceBuffer),this.gl.deleteVertexArray(this.vao)},e.uvTransform=a.vec4(0,0,1,1),e.unitCubeVertices=new Float32Array([-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5]),e.unitCubeIndices=new Uint16Array([1,5,7,1,7,3,0,2,6,0,6,4,2,3,7,2,7,6,0,4,5,0,5,1,4,6,7,4,7,5,0,1,3,0,3,2]),e}();t.DecalBatch=o},6710:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryBatch=void 0;var i=r(556),o=r(2121),s=r(9755),l=function(e){function t(t,r,a,n){var o=e.call(this,t,i.VertexDataFormat.Batched,r,a,n)||this;return o.textures=[],o.maxTextures=t.getParameter(34930),o}return n(t,e),t.prototype.render=function(e){var t=e.vertices,r=e.uvs,a=e.indices,n=e.colors,i=e.normals,o=e.material,l=a.length,c=t.length>>>1;0==this.indexOffset&&(this.textures.length=0);var u=this.textures.indexOf(o.diffuse);if(l>this.maxIndices||c>this.maxVertices)throw new Error(l+">"+this.maxIndices+" or "+c+">"+this.maxVertices);if(-1==u&&this.textures.length>=this.maxTextures||this.indexOffset+l>this.maxIndices||this.vertexOffset+c>this.maxVertices)return!1;var f=s.uintNorm4x8(e.color[0],e.color[1],e.color[2],e.color[3]);if(!f)return!0;-1==u&&(u=this.textures.push(o.diffuse)-1);var m=s.uint8x4(0,0,0,u)|(e.normal?s.intNorm4x8(e.normal[0],e.normal[1],e.normal[2],0):0);if(!this.fixedIndices)for(var h=0;h<l;h++)this.indexArray[this.indexOffset+h]=a[h]+this.vertexOffset;this.indexOffset+=l;for(var d=this.format[1].stride>>>2,v=(h=0,this.vertexOffset*d);h<c;h++,v+=d)this.float32View[v+0]=t[3*h+0],this.float32View[v+1]=t[3*h+1],this.float32View[v+2]=t[3*h+2],this.uint32View[v+3]=s.uintNorm2x16(r[2*h],r[2*h+1]),this.uint32View[v+4]=n?n[h]:f,this.uint32View[v+5]=i?m|s.intNorm4x8(i[3*h+0],i[3*h+1],i[3*h+2],0):m;return this.vertexOffset+=c,!0},t.prototype.bind=function(){e.prototype.bind.call(this),this.bindTextures(this.textures)},t.prototype.bindTextures=function(e){for(var t=this.gl,r=0;r<e.length;r++)t.activeTexture(33984+r),t.bindTexture(3553,e[r])},t.quadIndices=[0,1,2,0,2,3],t}(o.VertexDataBatch);t.GeometryBatch=l},2121:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexDataBatch=void 0;var r=function(){function e(e,t,r,a,n){if(this.gl=e,this.format=t,this.maxVertices=r,this.maxIndices=a,this.fixedIndices=n,this.indexOffset=0,this.vertexOffset=0,this.indexArray=new Uint16Array(a),n)for(var i=0;i<this.indexArray.length;i++)this.indexArray[i]=n[i%n.length]+4*Math.floor(i/n.length);var o=new ArrayBuffer(r*t[1].stride);this.float32View=new Float32Array(o),this.uint32View=new Uint32Array(o),this.vao=e.createVertexArray(),e.bindVertexArray(this.vao),this.indexBuffer=e.createBuffer(),e.bindBuffer(34963,this.indexBuffer),e.bufferData(34963,this.indexArray,n?35044:35048),this.vertexBuffer=e.createBuffer(),e.bindBuffer(34962,this.vertexBuffer),e.bufferData(34962,o.byteLength,35048);for(var s=1;s<t.length;s++){var l=t[s],c=l.size,u=l.type,f=l.normalized,m=l.stride,h=l.offset;e.enableVertexAttribArray(s-1),e.vertexAttribPointer(s-1,c,u,f,m,h)}e.bindVertexArray(null)}return e.prototype.bind=function(){var e=this.gl;e.bindVertexArray(this.vao),this.indexOffset&&(this.fixedIndices||(e.bindBuffer(34963,this.indexBuffer),e.bufferSubData(34963,0,this.indexArray.subarray(0,this.indexOffset))),e.bindBuffer(34962,this.vertexBuffer),e.bufferSubData(34962,0,this.float32View.subarray(0,this.vertexOffset*(this.format[1].stride>>>2))),this.indexOffset=0,this.vertexOffset=0)},e.prototype.delete=function(){this.gl.deleteBuffer(this.indexBuffer),this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteVertexArray(this.vao)},e}();t.VertexDataBatch=r},9755:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.intNorm4x8=t.uintNorm2x16=t.uintNorm4x8=t.uint16x2=t.uint8x4=void 0,t.uint8x4=function(e,t,r,a){return 255&e|65280&t<<8|16711680&r<<16|4278190080&a<<24},t.uint16x2=function(e,t){return 4294901760&t<<16|65535&e},t.uintNorm4x8=function(e,t,r,a){return 255*e|255*t<<8|255*r<<16|255*a<<24},t.uintNorm2x16=function(e,t){return 65535*t<<16|65535&(65535*e|0)},t.intNorm4x8=function(e,t,r,a){return 127*e&255|(127*t&255)<<8|(127*r&255)<<16|(127*a&255)<<24}},2130:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9755),t),n(r(2121),t),n(r(9460),t),n(r(6710),t),n(r(3432),t)},290:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BloomEffect=void 0;var a=r(7594),n=r(556),i=r(8211),o=function(){function e(t){this.context=t,this.enabled=!0,this.fbo=[],this.renderTarget=[],this.iterations=2,this.mask=a.vec4(2,2,2,2);var o=t.gl;this.brightness=n.ShaderProgram(o,i.shaders.fullscreen_vert,r(4948),{MASK:!0,BRIGHTNESS:!1}),this.blur=n.ShaderProgram(o,i.shaders.fullscreen_vert,r(1241),{KERNEL_SIZE:9}),this.width=o.drawingBufferWidth/e.downscale,this.height=o.drawingBufferHeight/e.downscale;for(var s=0;s<2;s++)this.renderTarget[s]=n.createTexture(o,{width:this.width,height:this.height},{flipY:!1,wrap:33071,format:32856,mipmaps:0,filter:9729}),this.fbo[s]=o.createFramebuffer(),o.bindFramebuffer(36160,this.fbo[s]),o.framebufferTexture2D(36160,36064,3553,this.renderTarget[s],0);o.bindFramebuffer(36160,null)}return e.prototype.apply=function(t){if(this.enabled){var r=this.context.gl;r.disable(2929),r.disable(3042),r.disable(2884),r.activeTexture(33984+n.UniformSamplerBindings.uSampler),r.bindTexture(3553,t.renderTarget[t.index]),r.useProgram(this.brightness.target),r.bindFramebuffer(36160,this.fbo[0]),r.viewport(0,0,this.width,this.height),r.bindVertexArray(t.plane.vao),this.context.gl.drawElements(4,t.plane.indexCount,5123,t.plane.indexOffset),r.useProgram(this.blur.target);for(var a=0,i=0;i<this.iterations;i++)r.bindTexture(3553,this.renderTarget[a]),a^=1,this.blur.uniforms.uSize=a?e.horizontal:e.vertical,r.bindFramebuffer(36160,this.fbo[a]),this.context.gl.drawElements(4,t.plane.indexCount,5123,t.plane.indexOffset)}},Object.defineProperty(e.prototype,"active",{get:function(){return this.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.enabled?this.renderTarget[1&this.iterations]:null},enumerable:!1,configurable:!0}),e.downscale=4,e.horizontal=a.vec2(1,0),e.vertical=a.vec2(0,1),e}();t.BloomEffect=o},6946:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FogEffect=void 0;var a=r(556),n=r(7594),i=r(8211),o=function(){function e(e){this.context=e,this.enabled=!0,this.color=n.vec4(.2,.2,.2,0),this.range=n.vec2(5,30),this.height=n.vec2(0,1),this.frame=0,this.program=a.ShaderProgram(this.context.gl,i.shaders.fullscreen_vert,i.shaders.fog_frag,{LINEAR_FOG:!0,HALFSPACE:!0,BLOOM:!0}),this.program.uniforms.uBloomMap=a.UniformSamplerBindings.uNormalMap}return Object.defineProperty(e.prototype,"active",{get:function(){return this.enabled},enumerable:!1,configurable:!0}),e.prototype.apply=function(e,t){var r=this.context.gl;r.disable(2929),r.disable(3042),r.disable(2884),e.swapRenderTarget(t,!1),r.useProgram(this.program.target),0==this.frame&&(this.frame=this.context.frame,this.program.uniforms.uFogColor=this.color,this.program.uniforms.uFogRange=this.range,this.program.uniforms.uFogHeight=this.height),r.activeTexture(33984+a.UniformSamplerBindings.uNormalMap),r.bindTexture(3553,e.bloom.texture),this.program.uniforms.uBloomMask=e.bloom.mask,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.bindVertexArray(e.plane.vao),r.drawElements(4,e.plane.indexCount,5123,e.plane.indexOffset)},e}();t.FogEffect=o},9697:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LightField=t.ReflectionProbe=void 0;var a=r(7594),n=r(556),i=r(391),o=r(3335),s=r(7400),l=r(43),c=r(8211),u=function(){function e(e,t){this.gl=e,this.index=t,this.culling=new o.FrustumCulling,this.ubo=e.createBuffer(),this.dataView=new Float32Array(52),this.viewProjectionMatrix=this.dataView.subarray(0,16),this.projectionMatrix=this.dataView.subarray(16,32),this.viewMatrix=this.dataView.subarray(32,48),this.position=this.dataView.subarray(48,52),e.bindBufferBase(35345,n.UniformBlockBindings.CameraUniforms,this.ubo),e.bufferData(35345,this.dataView.byteLength,35048),this.culling.layerMask=3}return e.prototype.update=function(t){a.vec3.scale(t,-1,this.position),a.mat4.copy(e.matrices[this.index],this.viewMatrix),a.mat4.translate(this.viewMatrix,this.position,this.viewMatrix),a.mat4.multiply(this.projectionMatrix,this.viewMatrix,this.viewProjectionMatrix),a.vec3.copy(t,this.position),this.culling.update(this.viewMatrix,this.projectionMatrix)},e.prototype.bind=function(e,t){e.bindBufferBase(35345,t,this.ubo),e.bufferSubData(35345,0,this.dataView)},e.prototype.delete=function(){this.gl.deleteBuffer(this.ubo)},e.matrices=[a.mat4.lookAt(a.vec3.ZERO,a.vec3(1,0,0),a.vec3(0,-1,0),a.mat4()),a.mat4.lookAt(a.vec3.ZERO,a.vec3(-1,0,0),a.vec3(0,-1,0),a.mat4()),a.mat4.lookAt(a.vec3.ZERO,a.vec3(0,1,0),a.vec3(0,0,1),a.mat4()),a.mat4.lookAt(a.vec3.ZERO,a.vec3(0,-1,0),a.vec3(0,0,-1),a.mat4()),a.mat4.lookAt(a.vec3.ZERO,a.vec3(0,0,1),a.vec3(0,-1,0),a.mat4()),a.mat4.lookAt(a.vec3.ZERO,a.vec3(0,0,-1),a.vec3(0,-1,0),a.mat4())],e.targets=[34069,34070,34071,34072,34073,34074],e}(),f=function(){function e(t){this.context=t,this.width=e.resolution,this.height=e.resolution,this.position=a.vec3(0,0,0),this.frame=0,this.fbo=[],this.faces=[];var r=this.context.gl;this.cubemap=r.createTexture(),r.bindTexture(34067,this.cubemap),r.texParameteri(34067,10242,33071),r.texParameteri(34067,10243,33071),r.texParameteri(34067,10241,e.mipmaps?9987:9729),r.texParameteri(34067,10240,9729),this.depth=r.createRenderbuffer(),r.bindRenderbuffer(36161,this.depth),r.renderbufferStorage(36161,33189,this.width,this.height);for(var n=0;n<u.targets.length;n++){var i=u.targets[n];r.texImage2D(i,0,6408,this.width,this.height,0,6408,5121,null);var o=this.fbo[n]=r.createFramebuffer();r.bindFramebuffer(36160,o),r.framebufferRenderbuffer(36160,36096,36161,this.depth),r.framebufferTexture2D(36160,36064,i,this.cubemap,0),r.drawBuffers([36064,0,0]),this.faces[n]=new u(r,n),a.mat4.perspective(.5*Math.PI,1,e.near,e.far,this.faces[n].projectionMatrix)}}return e.prototype.update=function(t){if(!(this.frame>=this.faces.length)){if(0==this.frame){a.vec3.copy(t,this.position);for(var r=this.faces.length-1;r>=0;r--)this.faces[r].update(this.position);console.log("%cenv cubemap "+this.width+"x"+this.height+" - ["+this.position+"]","color:#a0d050")}var o=this.context.gl;for(r=this.faces.length-1;r>=0;r--){var l=this.faces[r];r===this.frame&&(o.viewport(0,0,this.width,this.height),o.bindFramebuffer(36160,this.fbo[r]),o.depthMask(!0),o.clear(16640),l.bind(o,n.UniformBlockBindings.CameraUniforms),this.context.get(s.DeferredGeometryPass).render(this.context.get(i.MeshSystem).list,l.culling))}this.frame++,e.mipmaps&&this.frame===this.faces.length&&(o.activeTexture(33984+n.UniformSamplerBindings.uEnvironmentMap),o.bindTexture(34067,this.cubemap),o.generateMipmap(34067))}},e.prototype.delete=function(){var e=this.context.gl;this.fbo.forEach((function(t){return e.deleteFramebuffer(t)})),this.faces.forEach((function(e){return e.delete()})),e.deleteTexture(this.cubemap),e.deleteRenderbuffer(this.depth)},e.resolution=256,e.near=.1,e.far=100,e.mipmaps=!0,e}();t.ReflectionProbe=f;var m=function(){function e(e){this.context=e,this.probes=[],this.gridSize=2,this.innerSize=18,this.outerSize=22,this.enabled=!0;for(var t=this.gridSize*this.gridSize-1;t>=0;t--)this.probes[t]=new f(this.context);var r=this.context.get(l.MaterialSystem);this.brdfLUT=r.addRenderTexture(r.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0,format:33327}),0,n.ShaderProgram(e.gl,c.shaders.fullscreen_vert,c.shaders.brdflut_frag),{},0).target}return e.prototype.relocateProbes=function(t){if(this.enabled&&1!=this.context.frame)for(var r=.5*(this.innerSize+this.outerSize),n=Math.floor(t[0]/r),i=Math.floor(t[1]/r),o=Math.floor(t[2]/r),s=0;s<this.gridSize;s++)for(var l=0;l<this.gridSize;l++){var c=this.probes[s+l*this.gridSize],u=n+a.mod(s-n,this.gridSize),f=o+a.mod(l-o,this.gridSize),m=a.vec3.set(u*r,i*r+2,f*r,e.target);m[0]===c.position[0]&&m[2]===c.position[2]||(c.frame=0);var h=c.frame<6;if(c.update(m),h)return}},e.prototype.calculateWeight=function(e,t){var r=2*Math.abs(e[0]-t.position[0]),n=2*Math.abs(e[2]-t.position[2]),i=1/(this.outerSize-this.innerSize);return(1-a.clamp((r-this.innerSize)*i,0,1))*(1-a.clamp((n-this.innerSize)*i,0,1))},e.target=a.vec3(),e}();t.LightField=m},9706:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(290),t),n(r(6946),t),n(r(9697),t)},6256:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(8906),t),n(r(7400),t),n(r(5380),t),n(r(4913),t),n(r(7449),t),n(r(8990),t),n(r(2047),t),n(r(4308),t)},1974:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSystem=t.PerspectiveCamera=void 0;var a=r(7594),n=r(556),i=r(1513),o=r(3453),s=function(){this.frame=0,this.zNear=.1,this.zFar=100,this.fieldOfView=Math.PI/2,this.aspectRatio=1,this.viewMatrix=a.mat4(),this.projectionMatrix=a.mat4(),this.viewProjectionMatrix=a.mat4(),this.position=a.vec3(),this.culling=new o.FrustumCulling};t.PerspectiveCamera=s;var l=function(){function e(e){this.camera=e,this.cameraTarget=a.vec3(0,0,0),this.cameraOffset=a.vec3(0,8,4),this.cameraPivot=a.vec3(0,0,0),this.cameraYaw=a.quat(),this.cameraPitch=a.quat(),this.cameraSmoothness=.1}return e.prototype.adjustCamera=function(e){a.vec3.add(this.cameraOffset,e,this.cameraPivot),a.vec3.lerp(this.camera.transform.position,this.cameraPivot,this.cameraSmoothness,this.camera.transform.position),a.vec3.copy(e,this.cameraTarget);var t=this.camera.transform.position[0]-e[0],r=this.camera.transform.position[1]-e[1],n=this.camera.transform.position[2]-e[2],i=Math.sqrt(t*t+n*n);a.quat.axisAngle(a.vec3.AXIS_Y,Math.atan2(t,n),this.cameraYaw),a.quat.axisAngle(a.vec3.AXIS_X,Math.atan2(-r,i),this.cameraPitch),a.quat.multiply(this.cameraYaw,this.cameraPitch,this.camera.transform.rotation),a.quat.normalize(this.camera.transform.rotation,this.camera.transform.rotation),this.camera.transform.frame=0},e}(),c=function(){function e(e){this.context=e,this.camera=new s,this.camera.transform=this.context.get(i.TransformSystem).create(),this.controller=new l(this.camera),this.uniform=new n.UniformBlock(this.context.gl,{byteSize:16})}return e.prototype.update=function(){this.uniform.data[0]=this.context.currentTime,this.uniform.data[1]=this.context.deltaTime,this.uniform.data[2]=this.context.frame,this.uniform.data[3]=this.context.currentTime%1e3,this.updatePerspectiveCamera(this.camera)},e.prototype.updatePerspectiveCamera=function(e){if(!(e.frame&&e.frame>=e.transform.frame)){e.uniform||(e.uniform=new n.UniformBlock(this.context.gl,{byteSize:208})),e.frame||(e.aspectRatio=this.context.gl.drawingBufferWidth/this.context.gl.drawingBufferHeight,a.mat4.perspective(e.fieldOfView,e.aspectRatio,e.zNear,e.zFar,e.projectionMatrix)),e.culling.updateCamera(e);var t=e.transform?e.transform.matrix:a.mat4.IDENTITY;a.mat4.invert(t,e.viewMatrix),a.mat4.multiply(e.projectionMatrix,e.viewMatrix,e.viewProjectionMatrix),e.uniform.data.set(e.viewProjectionMatrix,0),e.uniform.data.set(e.projectionMatrix,16),e.uniform.data.set(e.viewMatrix,32),e.uniform.data[48]=e.position[0]=t[12],e.uniform.data[49]=e.position[1]=t[13],e.uniform.data[50]=e.position[2]=t[14],e.frame=this.context.frame}},e}();t.CameraSystem=c},3453:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrustumCulling=t.BoundingVolume=t.calculateBoundingRadius=void 0;var a=r(7594);function n(e,t,r,n){void 0===n&&(n=a.vec3.ZERO);for(var i=0,o=0;o<e.length;o+=t){var s=e[o+r+0]-n[0],l=e[o+r+1]-n[1],c=e[o+r+2]-n[2];i=Math.max(i,s*s+l*l+c*c)}return Math.sqrt(i)}t.calculateBoundingRadius=n;var i=function(){function e(){this.frame=-1,this.position=a.vec3(0,0,0),this.scale=a.vec3(1,1,1),this.radius=0}return e.prototype.update=function(e,t){this.scale[0]=Math.hypot(e.matrix[0],e.matrix[1],e.matrix[2]),this.scale[1]=Math.hypot(e.matrix[4],e.matrix[5],e.matrix[6]),this.scale[2]=Math.hypot(e.matrix[8],e.matrix[9],e.matrix[10]),a.vec3.set(e.matrix[12],e.matrix[13],e.matrix[14],this.position),this.radius=t*Math.max(this.scale[0],this.scale[1],this.scale[2]),this.frame=e.frame},e.prototype.fromVertices=function(e,t,r,i){a.vec3.copy(a.vec3.ZERO,this.position);for(var o=0;o<e.length;o+=t)this.position[0]+=e[o+r+0],this.position[1]+=e[o+r+1],this.position[2]+=e[o+r+2];a.vec3.scale(this.position,e.length&&t/e.length,this.position),this.radius=n(e,t,r,this.position),this.frame=i},e}();t.BoundingVolume=i;var o=function(){function e(){this.layerMask=65535,this.modelMatrix=a.mat4(),this.AXIS_X=this.modelMatrix.subarray(0,3),this.AXIS_Y=this.modelMatrix.subarray(4,7),this.AXIS_Z=this.modelMatrix.subarray(8,11),this.position=this.modelMatrix.subarray(12,14)}return e.prototype.update=function(e,t){this.near=t[14]/(t[10]-1),this.far=t[14]/(t[10]+1),this.fieldOfView=2*Math.atan(1/t[5]),this.aspectRatio=t[5]/t[0],a.mat4.invert(e,this.modelMatrix),this.tangent=Math.tan(this.fieldOfView/2),this.sphereFactorY=1/Math.cos(this.fieldOfView/2),this.sphereFactorX=1/Math.cos(Math.atan(this.tangent*this.aspectRatio))},e.prototype.updateCamera=function(e){var t;this.fieldOfView=e.fieldOfView,this.aspectRatio=e.aspectRatio,this.near=e.zNear,this.far=e.zFar,this.tangent=Math.tan(this.fieldOfView/2),this.sphereFactorY=1/Math.cos(this.fieldOfView/2),this.sphereFactorX=1/Math.cos(Math.atan(this.tangent*this.aspectRatio));var r=(null===(t=e.transform)||void 0===t?void 0:t.matrix)||a.mat4.IDENTITY;a.vec3.set(r[0],r[1],r[2],this.AXIS_X),a.vec3.set(r[4],r[5],r[6],this.AXIS_Y),a.vec3.set(-r[8],-r[9],-r[10],this.AXIS_Z),a.vec3.set(r[12],r[13],r[14],this.position)},e.prototype.cull=function(e,t){return 0!=(this.layerMask&t)&&this.cullSphere(e.position,e.radius)},e.prototype.cullSphere=function(t,r){var n=a.vec3.subtract(t,this.position,e.temp),i=-a.vec3.dot(n,this.AXIS_Z);if(i>this.far+r||i<this.near-r)return!1;var o=a.vec3.dot(n,this.AXIS_Y),s=i*this.tangent+r*this.sphereFactorY;if(o>s||o<-s)return!1;var l=a.vec3.dot(n,this.AXIS_X),c=i*this.tangent*this.aspectRatio+r*this.sphereFactorX;return!(l>c||l<-c)},e.temp=a.vec3(0,0,0),e}();t.FrustumCulling=o},1513:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransformSystem=t.Transform=t.Transform2D=void 0;var a=r(7594),n=function(){function e(){this.index=-1,this.frame=0,this.position=a.vec2(0,0),this.scale=a.vec2(1,1),this.rotation=0,this.matrix=a.mat3x2()}return e.prototype.recalculate=function(e){a.mat3x2.fromTransform(this.position[0],this.position[1],0,0,this.scale[0],this.scale[1],this.rotation,0,0,this.matrix),this.parent&&a.mat3x2.multiply(this.parent.matrix,this.matrix,this.matrix),this.frame=e},e}();t.Transform2D=n;var i=function(){function e(){this.index=-1,this.frame=0,this.position=a.vec3(0,0,0),this.scale=a.vec3(1,1,1),this.rotation=a.quat(),this.matrix=a.mat4()}return e.prototype.recalculate=function(e){a.mat4.fromRotationTranslationScale(this.rotation,this.position,this.scale,this.matrix),this.parent&&a.mat4.multiply(this.parent.matrix,this.matrix,this.matrix),this.frame=e},e.prototype.calculateNormalMatrix=function(){return a.mat3.normalMatrix(this.matrix,e.normalMatrix)},e.matrix=a.mat4(),e.normalMatrix=a.mat3(),e}();t.Transform=i;var o=function(){function e(e){this.context=e,this.pool=[],this.list=[]}return e.prototype.create=function(e,t,r,n){var o=this.pool.pop()||new i;return o.index=this.list.push(o)-1,o.frame=0,o.parent=n||null,a.vec3.copy(e||a.vec3.ZERO,o.position),a.vec3.copy(r||a.vec3.ONE,o.scale),a.quat.copy(t||a.quat.IDENTITY,o.rotation),o},e.prototype.delete=function(e){-1!=e.index&&(this.list[e.index]=this.list[this.list.length-1],this.list[e.index].index=e.index,this.list.length--,this.pool.push(e),e.index=-1)},e.prototype.update=function(){for(var e=this.list.length-1;e>=0;e--){var t=this.list[e];if(t.parent&&t.parent.index<e){if(-1!=t.parent.index){this.list[t.parent.index]=t,this.list[e]=t.parent,t.index=t.parent.index,t.parent.index=e++;continue}t.parent=null}t.frame&&(!t.parent||t.frame>=t.parent.frame)||t.recalculate(this.context.frame)}},e}();t.TransformSystem=o},3335:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(1513),t),n(r(1974),t),n(r(3453),t)},8211:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shaders=void 0,t.shaders={batch_vert:r(5610),batch_frag:r(3949),stripe_vert:r(4570),verlet_vert:r(2720),billboard_vert:r(8719),billboard_frag:r(1628),decal_vert:r(2098),decal_frag:r(1014),particle_vert:r(7745),fullscreen_vert:r(9679),fullscreen_frag:r(5434),geometry_vert:r(1964),geometry_frag:r(4350),noise_frag:r(7966),distortion_frag:r(2289),fog_frag:r(6633),light_vert:r(5197),pbr_frag:r(632),ambient_frag:r(252),vfx_frag:r(3932),debris_vert:r(3653),sky_frag:r(9890),bumpmap_frag:r(9868),brdflut_frag:r(4640)}},5360:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},556:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(5360),t),n(r(9374),t),n(r(8598),t),n(r(9246),t),n(r(8999),t)},8598:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UniformBlock=t.locateUniforms=t.compileProgram=t.ShaderProgram=void 0;var a=r(8999);function n(e,t,r,a){var n=e.createShader(35633);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,35713))throw new Error(e.getShaderInfoLog(n));var i=e.createShader(35632);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,35713))throw new Error(e.getShaderInfoLog(i));var o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,i),a&&e.transformFeedbackVaryings(o,a,35980),e.linkProgram(o),e.deleteShader(n),e.deleteShader(i),!e.getProgramParameter(o,35714))throw new Error(e.getProgramInfoLog(o));return o}function i(e,t){for(var r in e.useProgram(t),a.UniformBlockBindings){var n=e.getUniformBlockIndex(t,r);4294967295!=n&&e.uniformBlockBinding(t,n,a.UniformBlockBindings[r])}for(var i=Object.create(null),o=e.getProgramParameter(t,35382)-1;o>=0;o--){for(var s=e.getActiveUniformBlockParameter(t,o,35392),l=e.getActiveUniformBlockParameter(t,o,35395),c=e.getActiveUniforms(t,l,35387),u=e.getActiveUniformBlockName(t,o),f=(e.getActiveUniforms(t,l,35386),Array(l.length)),m=0;m<l.length;m++)f[m]=e.getActiveUniform(t,l[m]);i[u]={byteSize:s,offsets:c,uniforms:f}}for(o=e.getProgramParameter(t,35718)-1;o>=0;o--){var h=e.getActiveUniform(t,o),d=e.getUniformLocation(t,h.name);if(d){var v=void 0;switch(h.type){case 5124:case 35678:case 36289:case 35680:v=h.size>1?e.uniform1iv.bind(e,d):e.uniform1i.bind(e,d);break;case 5126:v=h.size>1?e.uniform1fv.bind(e,d):e.uniform1f.bind(e,d);break;case 35664:v=e.uniform2fv.bind(e,d);break;case 35665:v=e.uniform3fv.bind(e,d);break;case 35666:v=e.uniform4fv.bind(e,d);break;case 35674:v=e.uniformMatrix2fv.bind(e,d,!1);break;case 35675:v=e.uniformMatrix3fv.bind(e,d,!1);break;case 35676:v=e.uniformMatrix4fv.bind(e,d,!1)}Object.defineProperty(i,h.name.replace(/\[0\]$/,""),{set:v})}}for(var r in a.UniformSamplerBindings)r in i&&(i[r]=a.UniformSamplerBindings[r]);return i}t.ShaderProgram=function(e,t,r,a){if(a)for(var o in a)if(0!=a[o]){var s="\n#define "+o.toUpperCase()+(1==a[o]?"":" "+a[o])+"\n";t=t.replace(/\n/,s),r=null==r?void 0:r.replace(/\n/,s)}var l=[],c=n(e,t=t.replace(/^layout\([^\)]*\) (out \S+ (\S+);)$/gim,(function(e,t,r){return l.push(r),t})),r||"#version 300 es\nvoid main(){}",l.length?l:null);return{target:c,uniforms:i(e,c)}},t.compileProgram=n,t.locateUniforms=i;var o=function(){function e(e,t,r){var n;void 0===r&&(r=0),this.frame=0,this.uniforms=Object.create(null),this.buffer=e.createBuffer(),this.data=new Float32Array(t.byteSize/Float32Array.BYTES_PER_ELEMENT);for(var i=(null===(n=t.uniforms)||void 0===n?void 0:n.length)-1;i>=0;i--){var o=t.offsets[i],s=t.uniforms[i],l=s.type,c=s.size,u=s.name,f=a.GLSLTypeSize[l]*c,m=new a.GLSLDataType[l](this.data.buffer,o,f);this.uniforms[u]=m}e.bindBufferBase(35345,r,this.buffer),e.bufferData(35345,this.data.byteLength,35048)}return e.prototype.bind=function(e,t,r){e.bindBufferBase(35345,t,this.buffer),e.bufferSubData(35345,0,this.data)},e}();t.UniformBlock=o},8999:(e,t)=>{"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.GLSLDataType=t.GLSLTypeSize=t.VertexDataFormat=t.UniformSamplerBindings=t.UniformBlockBindings=void 0,t.UniformBlockBindings={CameraUniforms:0,ModelUniforms:1,LightUniforms:2,GlobalUniforms:3,EmitterUniforms:2,EffectUniforms:4,MaterialUniforms:4},t.UniformSamplerBindings={uEnvironmentMap:0,uSampler:0,uGradient:1,uGradientMap:1,uDisplacementMap:5,uAttributes:6,uDiffuseMap:0,uNormalMap:1,uPositionBuffer:2,uNormalBuffer:3,uAlbedoBuffer:4,uArrayMap:7},t.VertexDataFormat={Skinned:{},Static:[{name:"index",size:1,type:5123},{name:"position",size:3,type:5126,normalized:!1,stride:32,offset:0},{name:"normal",size:3,type:5126,normalized:!1,stride:32,offset:12},{name:"uv",size:2,type:5126,normalized:!1,stride:32,offset:24}],Batched2D:[{name:"index",size:1,type:5123},{name:"position",size:2,type:5126,normalized:!1,stride:20,offset:0},{name:"uv",size:2,type:5123,normalized:!0,stride:20,offset:8},{name:"color",size:4,type:5121,normalized:!0,stride:20,offset:12},{name:"material",size:4,type:5121,normalized:!1,stride:20,offset:16}],Batched:[{name:"index",size:1,type:5123},{name:"position",size:3,type:5126,normalized:!1,stride:24,offset:0},{name:"uv",size:2,type:5123,normalized:!0,stride:24,offset:12},{name:"color",size:4,type:5121,normalized:!0,stride:24,offset:16},{name:"normal",size:3,type:5120,normalized:!0,stride:24,offset:20},{name:"material",size:1,type:5121,normalized:!1,stride:24,offset:23}],Decal:[{name:"aModelMatrix",size:16,type:5126,normalized:!1,stride:76,offset:0},{name:"aUV",size:4,type:5123,normalized:!0,stride:76,offset:64},{name:"aColor",size:4,type:5121,normalized:!0,stride:76,offset:72}],Particle:[{name:"aLifetime",size:4,type:5126,normalized:!1,stride:80,offset:0},{name:"aSize",size:4,type:5126,normalized:!1,stride:80,offset:16},{name:"aTransform",size:4,type:5126,normalized:!1,stride:80,offset:32},{name:"aVelocity",size:4,type:5126,normalized:!1,stride:80,offset:48},{name:"aAcceleration",size:4,type:5126,normalized:!1,stride:80,offset:64}]},t.GLSLTypeSize=((r={})[5124]=1,r[35678]=1,r[36289]=1,r[5126]=1,r[35664]=2,r[35665]=3,r[35666]=4,r[35674]=4,r[35675]=9,r[35676]=16,r),t.GLSLDataType=((a={})[5120]=Int8Array,a[5121]=Uint8Array,a[5122]=Int16Array,a[5123]=Uint16Array,a[5124]=Int32Array,a[5125]=Uint32Array,a[35678]=Int32Array,a[36289]=Int32Array,a[5126]=Float32Array,a[35664]=Float32Array,a[35665]=Float32Array,a[35666]=Float32Array,a[35674]=Float32Array,a[35675]=Float32Array,a[35676]=Float32Array,a)},9374:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLState=void 0;var r=function(){function e(e){var t,r;for(var a in this.gl=e,this.extensions={color_buffer_float:this.gl.getExtension("EXT_color_buffer_float"),color_buffer_half_float:this.gl.getExtension("EXT_color_buffer_half_float"),float_blend:this.gl.getExtension("EXT_float_blend"),texture_filter_anisotropic:this.gl.getExtension("EXT_texture_filter_anisotropic"),texture_norm16:this.gl.getExtension("EXT_texture_norm16"),texture_float_linear:this.gl.getExtension("OES_texture_float_linear")},this.cache=((t={})[35661]=this.gl.getParameter(35661),t[35660]=this.gl.getParameter(35660),t[34930]=this.gl.getParameter(34930),t[34921]=this.gl.getParameter(34921),t[36347]=this.gl.getParameter(36347),t[36349]=this.gl.getParameter(36349),t[36348]=this.gl.getParameter(36348),t[3386]=this.gl.getParameter(3386),t[3379]=this.gl.getParameter(3379),t[34024]=this.gl.getParameter(34024),t[34852]=this.gl.getParameter(34852),t[36063]=this.gl.getParameter(36063),t.fragment=this.gl.getShaderPrecisionFormat(35632,36338),t.vertex=this.gl.getShaderPrecisionFormat(35633,36338),t),this.state=((r={})[34229]=null,r[36006]=null,r[36010]=null,r[36007]=null,r[2978]=new Int32Array(4),r[35725]=null,r[34964]=null,r[34016]=33984,r[3553]=Array(this.cache[34930]),r[35866]=Array(this.cache[34930]),r[34067]=Array(this.cache[34930]),r[32879]=Array(this.cache[34930]),r[3106]=new Float32Array(4),r[2931]=1,r[2961]=0,r[2929]=!1,r[2932]=513,r[2928]=[0,1],r[2930]=!0,r[2884]=!1,r[2885]=1029,r[2886]=2305,r[3042]=!1,r[32969]=1,r[32968]=0,r[32971]=1,r[32970]=0,r[32773]=new Float32Array(4),r[32777]=32774,r[34877]=32774,r[3107]=[!0,!0,!0,!0],r[3089]=!1,r[3088]=new Int32Array(4),r),WebGL2RenderingContext.prototype)if(!(a in this)){var n=this.gl[a];"function"==typeof n&&(this[a]=n.bind(this.gl))}}return Object.defineProperty(e.prototype,"canvas",{get:function(){return this.gl.canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.gl.drawingBufferHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawingBufferWidth",{get:function(){return this.gl.drawingBufferWidth},enumerable:!1,configurable:!0}),e.prototype.disable=function(e){this.state[e]&&(this.state[e]=!1,this.gl.disable(e))},e.prototype.enable=function(e){this.state[e]||(this.state[e]=!0,this.gl.enable(e))},e.prototype.viewport=function(e,t,r,a){this.state[2978][0]===e&&this.state[2978][1]===t&&this.state[2978][2]===r&&this.state[2978][3]===a||this.gl.viewport(this.state[2978][0]=e,this.state[2978][1]=t,this.state[2978][2]=r,this.state[2978][3]=a)},e.prototype.blendColor=function(e,t,r,a){this.state[32773][0]===e&&this.state[32773][1]===t&&this.state[32773][2]===r&&this.state[32773][3]===a||this.gl.blendColor(this.state[32773][0]=e,this.state[32773][1]=t,this.state[32773][2]=r,this.state[32773][3]=a)},e.prototype.blendEquation=function(e){this.state[32777]===e&&this.state[34877]===e||this.gl.blendEquation(this.state[32777]=this.state[34877]=e)},e.prototype.blendEquationSeparate=function(e,t){this.state[32777]===e&&this.state[34877]===t||this.gl.blendEquationSeparate(this.state[32777]=e,this.state[34877]=t)},e.prototype.blendFunc=function(e,t){this.state[32969]===e&&this.state[32968]===t&&this.state[32971]===e&&this.state[32970]===t||this.gl.blendFunc(this.state[32969]=this.state[32971]=e,this.state[32968]=this.state[32970]=t)},e.prototype.blendFuncSeparate=function(e,t,r,a){this.state[32969]===e&&this.state[32968]===t&&this.state[32971]===r&&this.state[32970]===a||this.gl.blendFuncSeparate(this.state[32969]=e,this.state[32968]=t,this.state[32971]=r,this.state[32970]=a)},e.prototype.clearColor=function(e,t,r,a){this.state[3106][0]===e&&this.state[3106][1]===t&&this.state[3106][2]===r&&this.state[3106][3]===a||this.gl.clearColor(this.state[3106][0]=e,this.state[3106][1]=t,this.state[3106][2]=r,this.state[3106][3]=a)},e.prototype.clearDepth=function(e){this.state[2931]!==e&&this.gl.clearDepth(this.state[2931]=e)},e.prototype.colorMask=function(e,t,r,a){this.state[3107][0]===e&&this.state[3107][1]===t&&this.state[3107][2]===r&&this.state[3107][3]===a||this.gl.colorMask(this.state[3107][0]=e,this.state[3107][1]=t,this.state[3107][2]=r,this.state[3107][3]=a)},e.prototype.cullFace=function(e){this.state[2885]!==e&&this.gl.cullFace(this.state[2885]=e)},e.prototype.depthFunc=function(e){this.state[2932]!==e&&this.gl.depthFunc(this.state[2932]=e)},e.prototype.depthMask=function(e){this.state[2930]!==e&&this.gl.depthMask(this.state[2930]=e)},e.prototype.depthRange=function(e,t){this.state[2928][0]===e&&this.state[2928][1]===t||this.gl.depthRange(this.state[2928][0]=e,this.state[2928][1]=t)},e.prototype.frontFace=function(e){this.state[2886]!==e&&this.gl.frontFace(this.state[2886]=e)},e.prototype.scissor=function(e,t,r,a){this.state[3088][0]===e&&this.state[3088][1]===t&&this.state[3088][2]===r&&this.state[3088][3]===a||this.gl.scissor(this.state[3088][0]=e,this.state[3088][1]=t,this.state[3088][2]=r,this.state[3088][3]=a)},e.prototype.bindBuffer=function(e,t){this.gl.bindBuffer(e,t)},e.prototype.bindVertexArray=function(e){this.state[34229]!==e&&this.gl.bindVertexArray(this.state[34229]=e)},e.prototype.activeTexture=function(e){this.state[34016]!==e&&this.gl.activeTexture(this.state[34016]=e)},e.prototype.bindTexture=function(e,t){var r=this.state[34016]-33984;this.state[e][r]!==t&&this.gl.bindTexture(e,this.state[e][r]=t)},e.prototype.useProgram=function(e){this.state[35725]!==e&&this.gl.useProgram(this.state[35725]=e)},e.prototype.blitFramebuffer=function(e,t,r,a,n,i,o,s,l,c){this.gl.blitFramebuffer(e,t,r,a,n,i,o,s,l,c)},e.prototype.drawArraysInstanced=function(e,t,r,a){this.gl.drawArraysInstanced(e,t,r,a)},e.prototype.drawElementsInstanced=function(e,t,r,a,n){this.gl.drawElementsInstanced(e,t,r,a,n)},e.prototype.drawRangeElements=function(e,t,r,a,n,i){this.gl.drawRangeElements(e,t,r,a,n,i)},e.prototype.drawArrays=function(e,t,r){this.gl.drawArrays(e,t,r)},e.prototype.drawElements=function(e,t,r,a){this.gl.drawElements(e,t,r,a)},e.prototype.shaderSource=function(e,t){this.gl.shaderSource(e,t)},e}();t.WebGLState=r},9246:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTexture=void 0;var a=r(3850);t.createTexture=function(e,t,r){var n=void 0===r?{}:r,i=n.flipY,o=n.premultiply,s=n.format,l=void 0===s?32856:s,c=n.mipmaps,u=void 0===c?9728:c,f=n.wrap,m=void 0===f?10497:f,h=n.filter,d=void 0===h?9729:h,v=n.type,p=void 0===v?3553:v,y=e.createTexture();e.activeTexture(33984),e.bindTexture(p,y),e.pixelStorei(37440,i),e.pixelStorei(37441,o);var g=a.int32pow2(t.width)&&a.int32pow2(t.height);return g&&u?(e.texParameteri(p,10240,d),e.texParameteri(p,10241,9729===d?9729===u?9987:9985:9729===u?9986:9984)):(e.texParameteri(p,10240,d),e.texParameteri(p,10241,d)),e.texParameteri(p,10242,m),e.texParameteri(p,10243,m),3553===p?(e.texStorage2D(p,1,l,t.width,t.height),t.data&&e.texSubImage2D(p,0,0,0,t.width,t.height,6408,t.data instanceof Float32Array?5126:5121,t.data)):35866===p&&(e.texStorage3D(p,1,l,t.width,t.height,t.depth),t.data&&e.texSubImage3D(p,0,0,0,0,t.width,t.height,t.depth,6408,5121,t.data)),t.data&&g&&u&&e.generateMipmap(p),y}},439:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(8716),i=r(1513),o=r(1974),s=r(7716),l=r(7269),c=r(8783),u=r(557),f=r(6256),m=r(7953),h=r(7455),d=a(r(9791));new n.Application([u.KeyboardSystem,s.AnimationSystem,i.TransformSystem,o.CameraSystem,l.MaterialSystem,c.MeshSystem,f.DeferredGeometryPass,f.DecalPass,f.AmbientLightPass,f.PointLightPass,f.ParticleEffectPass,f.PostEffectPass,f.OverlayPass,h.SharedSystem,h.TurnBasedSystem,h.TerrainSystem,h.EconomySystem,h.PlayerSystem,h.AISystem,m.DebugSystem]).load(d.default)},1160:function(e,t,r){"use strict";var a,n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.modelAnimations=t.ArmatureAnimation=t.CubeModuleModel=void 0;var i=r(7594),o=r(9519),s=n(r(7082));for(var l in t.CubeModuleModel=((a={})[0]="cube_open",a[1]="death",a[2]="cube_0",a[3]="cube_1",a[4]="cube_2",a[5]="cube_3",a[6]="cube_4",a[7]="cube_5",a[8]="cube_6",a[9]="cube_7",a[10]="cube_8",a),t.ArmatureAnimation=function(e){return function(t,r){for(var a,n,i,o=e.length-1;o>=0;o--){var s=e[o],l=r.nodes[s.index];null===(a=s.position)||void 0===a||a.call(s,t,l.position),null===(n=s.rotation)||void 0===n||n.call(s,t,l.rotation),null===(i=s.scale)||void 0===i||i.call(s,t,l.scale)}return r.frame=0,r}},t.modelAnimations=Object.create(null),s.default)for(var c in s.default[l]){for(var u=s.default[l][c],f=[],m=0;m<u.length;m++){var h=u[m],d=h.frame,v=h.index,p=h.position,y=h.rotation,g=h.scale,x=o.parseEase(u[m].ease);f[v]||(f[v]={index:v,position:[],rotation:[],scale:[]}),p&&f[v].position.push({frame:d,value:p,ease:x}),g&&f[v].scale.push({frame:d,value:g,ease:x}),y&&f[v].rotation.push({frame:d,value:y,ease:x})}var b=t.ArmatureAnimation(f.map((function(e){var t=e.index,r=e.position,a=e.scale,n=e.rotation;return{index:t,position:r.length?o.PropertyAnimation(r,i.vec3.lerp,1):void 0,scale:a.length?o.PropertyAnimation(a,i.vec3.lerp,1):void 0,rotation:n.length?o.PropertyAnimation(n,i.quat.slerp,1):void 0}})).filter(Boolean));t.modelAnimations[l]=t.modelAnimations[l]||Object.create(null),t.modelAnimations[l][c]=b}},4524:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TurnBasedSystem=void 0;var a=r(9519),n=function(){function e(e){this.context=e,this.actors=[],this.turn=0,this.index=0,this.lastAction=a.ActionSignal.WaitNextFrame}return e.prototype.add=function(e){for(var t=this.actors.length-1;t>=0&&this.actors[t].order-e.order>0;)t--;this.actors.splice(t+1,0,e),t+1<=this.index&&this.index++},e.prototype.remove=function(e){var t=this.actors.indexOf(e);this.actors.splice(t,1),t<=this.index&&this.index--},e.prototype.update=function(){if(this.lastAction.continue){var e=this.context.get(a.AnimationSystem);for(this.index>=this.actors.length&&this.actors.length&&(this.index=0,this.turn++);this.index<this.actors.length;){var t=this.actors[this.index];if(this.lastAction=e.await(t.actionIndex),!this.lastAction.continue)break;this.index++;var r=t.execute();if(r&&(t.actionIndex=e.start(r,!0),this.lastAction=e.await(t.actionIndex),!this.lastAction.continue))break}}},e}();t.TurnBasedSystem=n},8261:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(4524),t)},9269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EconomySystem=void 0;var a=r(2392),n=r(4799),i=function(){function e(e){this.context=e,this.pool=[],this.list=[]}return e.prototype.update=function(){var e=this.context.get(a.TerrainSystem),t=e.bounds;if(!(e.frame<this.context.frame))for(var r=this.list.length-1;r>=0;r--){var n=this.list[r];n.tile[0]>=t[0]&&n.tile[1]>=t[1]&&n.tile[0]<t[3]&&n.tile[1]<t[3]||(n.delete(),this.delete(n))}},e.prototype.createDeposit=function(e,t,r){var a=this.pool.pop()||new n.ResourceSpot(this.context);return a.place(e,t),a.capacity=a.amount=r,this.list.push(a),a},e.prototype.delete=function(e){var t=this.list.indexOf(e);-1!=t&&(this.pool.push(e),this.list[t]=this.list[this.list.length-1],this.list.length--)},e.prototype.get=function(e,t){for(var r=this.list.length-1;r>=0;r--)if(this.list[r].tile[0]===e&&this.list[r].tile[1]===t)return this.list[r];return null},e}();t.EconomySystem=i},4799:function(e,t,r){"use strict";var a=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceSpot=void 0;var n=r(7594),i=r(3335),o=r(6256),s=r(9519),l=r(9258),c=r(2392),u=r(9269),f=function(){function e(e){this.context=e,this.tile=n.vec2()}return e.prototype.place=function(e,t){n.vec2.set(e,t,this.tile);var r=this.context.get(c.TerrainSystem).tilePosition(e,t,n.vec3());this.decal=this.context.get(o.DecalPass).create(8),this.decal.transform=this.context.get(i.TransformSystem).create(r,n.quat.IDENTITY,[10,2,10]),this.decal.material=l.SharedSystem.materials.resourceSpotMaterial,this.emitter=l.SharedSystem.particles.glow.start(16,{uLifespan:[1,2,-3,0],uOrigin:r,uRadius:[0,1.8],uSize:[.2,.6],uGravity:[0,4.2,0]})},e.prototype.delete=function(){this.context.get(i.TransformSystem).delete(this.decal.transform),this.context.get(o.DecalPass).delete(this.decal),l.SharedSystem.particles.glow.stop(this.emitter)},e.prototype.drain=function(e){var t,r,i;return a(this,(function(a){switch(a.label){case 0:this.amount--,t=s.AnimationTimeline(this,{"decal.threshold":s.PropertyAnimation([{frame:0,value:this.decal.threshold},{frame:e,value:n.lerp(1,0,this.amount/this.capacity),ease:s.ease.linear}],n.lerp)}),r=this.context.currentTime,a.label=1;case 1:return i=this.context.currentTime-r,t(i,this.context.deltaTime),i>e?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:return this.amount>0||(this.delete(),this.context.get(u.EconomySystem).delete(this)),[2]}}))},e}();t.ResourceSpot=f},6745:function(e,t,r){"use strict";var a=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Workshop=void 0;var n=r(7594),i=r(3335),o=r(9519),s=r(391),l=r(6256),c=r(557),u=r(2392),f=r(1160),m=r(8261),h=r(9040),d=r(9258),v=function(){function e(e){this.context=e,this.weight=0,this.order=1,this.tile=n.vec2(),this.opened=!1}return e.prototype.place=function(t,r){n.vec2.set(t,r,this.tile),this.mesh=this.context.get(s.MeshSystem).loadModel("dock"),this.mesh.layer=2,this.mesh.transform=this.context.get(i.TransformSystem).create();var a=this.mesh.transform.position;this.context.get(u.TerrainSystem).tilePosition(t,r,a);var o=this.context.get(u.TerrainSystem).chunk(t,r),l=[a[0]-3,a[2]-3,a[0]+3,a[2]+3];o.mapRegion(l,l),o.terraform(l,(function(){return a[1]})),this.context.get(u.TerrainSystem).tilePosition(t,r,a),n.quat.axisAngle(n.vec3.AXIS_Y,.5*Math.PI,this.mesh.armature.nodes[0].rotation),f.modelAnimations.dock.open(0,this.mesh.armature);for(var c=0;c<e.area.length;c++)this.context.get(u.TerrainSystem).setTile(e.area[c][0]+t,e.area[c][1]+r,this);this.context.get(m.TurnBasedSystem).add(this)},e.prototype.delete=function(){this.mesh&&(this.context.get(m.TurnBasedSystem).remove(this),this.context.get(i.TransformSystem).delete(this.mesh.transform),this.context.get(s.MeshSystem).delete(this.mesh),this.mesh=null)},e.prototype.execute=function(){var e,t,r,n,i,s,l,c,m;return a(this,(function(a){switch(a.label){case 0:for(e=this.mesh.armature,t=null,r=-2;r<=2;r++)if((n=this.context.get(u.TerrainSystem).getTile(this.tile[0],this.tile[1]+r))instanceof h.Cube){t=n;break}if(this.opened)return[3,5];if(!t)return[2];this.opened=!0,i=.64,s=this.context.currentTime,a.label=1;case 1:return l=Math.min(1,(this.context.currentTime-s)/i),f.modelAnimations.dock.open(l,e),l>=1?[3,4]:[4,o.ActionSignal.WaitNextFrame];case 2:a.sent(),a.label=3;case 3:return[3,1];case 4:return[3,15];case 5:if(t)return[3,10];this.opened=!1,i=.64,s=this.context.currentTime,a.label=6;case 6:return l=Math.min(1,(this.context.currentTime-s)/i),f.modelAnimations.dock.open(1-l,e),l>=1?[3,9]:[4,o.ActionSignal.WaitNextFrame];case 7:a.sent(),a.label=8;case 8:return[3,6];case 9:return[3,15];case 10:if(!t||t.state.tile[1]!==this.tile[1])return[3,15];c=this.enterWorkshop(t),a.label=11;case 11:return(m=c.next()).done?[3,15]:[3,12];case 12:return[4,m.value];case 13:a.sent(),a.label=14;case 14:return[3,11];case 15:return[2]}}))},e.prototype.enterWorkshop=function(e){var t,r,u,m,v,p,y,g,x,b,S,P,w,T;return a(this,(function(a){switch(a.label){case 0:return[4,this.context.get(o.AnimationSystem).await(e.actionIndex)];case 1:a.sent(),t=this.cubeMesh=e.meshes[e.state.side],r=n.vec3.copy(t.transform.position,n.vec3()),u=n.vec3.add(this.mesh.transform.position,[0,2,0],n.vec3()),m=this.context.get(h.PlayerSystem).cameraOffset,v=n.vec3.copy(m,n.vec3()),p=n.vec3(-2,4,2),P=1,w=this.context.currentTime,a.label=2;case 2:return T=Math.min(1,(this.context.currentTime-w)/P),f.modelAnimations.dock.lift(T,this.mesh.armature),n.vec3.lerp(r,u,o.ease.quadIn(T),t.transform.position),n.vec3.lerp(v,p,o.ease.quadInOut(T),m),t.transform.frame=0,T>=1?[3,5]:[4,o.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,2];case 5:y=[2,3,5,6,4,7,8,9,10],g=this.context.get(c.KeyboardSystem),this.smoke=d.SharedSystem.particles.smoke.add({uOrigin:n.vec3.add(t.transform.position,[0,1,0],n.vec3()),uLifespan:[.8,1.2,-.2,0],uRotation:[0,2*Math.PI],uGravity:[0,10,0],uSize:[2,5],uFieldDomain:n.vec4.ONE,uFieldStrength:[8,0]}),this.glow=new s.BatchMesh(d.SharedSystem.geometry.openBox),this.glow.material=d.SharedSystem.materials.gradientMaterial,this.glow.transform=this.context.get(i.TransformSystem).create(n.vec3.ZERO,n.quat.IDENTITY,n.vec3.ONE,t.transform),this.context.get(l.ParticleEffectPass).add(this.glow),this.cover=new s.Sprite,n.vec4.copy(n.vec4.ZERO,this.cover.color),this.cover.billboard=0,this.cover.material=d.SharedSystem.materials.planeDissolveMaterial,this.cover.transform=this.context.get(i.TransformSystem).create([0,2.02,0],s.Sprite.FlatUp,n.vec3(2,2,2),t.transform),this.context.get(l.ParticleEffectPass).add(this.cover),a.label=6;case 6:return g.down("KeyW")||g.down("KeyS")?[3,15]:g.trigger("KeyA")?(y.push(y.shift()),console.log("available",y[0]),[3,13]):[3,7];case 7:return g.trigger("KeyD")?(y.unshift(y.pop()),console.log("available",y[0]),[3,13]):[3,8];case 8:if(!g.trigger("Space"))return[3,13];x=(4-e.state.direction)%4,e.installModule(e.state.side,x,y[0]),b=o.AnimationTimeline(this,{"cubeMesh.color":o.PropertyAnimation([{frame:0,value:[8,0,2,.2]},{frame:.6,value:n.vec4.ONE,ease:o.ease.quadOut}],n.vec4.lerp),smoke:o.EventTrigger([{frame:0,value:16}],o.EventTrigger.emit),"glow.transform.scale":o.PropertyAnimation([{frame:0,value:[2,0,2]},{frame:.6,value:[2,6,2],ease:o.ease.quintOut}],n.vec3.lerp),"glow.color":o.PropertyAnimation([{frame:0,value:[.9,1,.6,0]},{frame:.6,value:n.vec4.ZERO,ease:o.ease.sineIn}],n.vec4.lerp),"cover.color":o.PropertyAnimation([{frame:0,value:n.vec4.ONE},{frame:.6,value:[1,.6,.2,0],ease:o.ease.sineOut}],n.vec4.lerp)}),P=.6,w=this.context.currentTime,a.label=9;case 9:return S=this.context.currentTime-w,b(S,this.context.deltaTime),S>P?[3,13]:[3,10];case 10:return[4,o.ActionSignal.WaitNextFrame];case 11:a.sent(),a.label=12;case 12:return[3,9];case 13:return[4,o.ActionSignal.WaitNextFrame];case 14:return a.sent(),[3,6];case 15:P=1,w=this.context.currentTime,a.label=16;case 16:return T=Math.min(1,(this.context.currentTime-w)/P),f.modelAnimations.dock.lift(1-T,this.mesh.armature),n.vec3.lerp(r,u,o.ease.quadIn(1-T),t.transform.position),n.vec3.lerp(v,p,o.ease.quadInOut(1-T),m),t.transform.frame=0,T>=1?[3,19]:[4,o.ActionSignal.WaitNextFrame];case 17:a.sent(),a.label=18;case 18:return[3,16];case 19:return this.context.get(l.ParticleEffectPass).remove(this.cover),this.context.get(l.ParticleEffectPass).remove(this.glow),d.SharedSystem.particles.smoke.remove(this.smoke),[2]}}))},e.area=[[-1,-1],[1,-1],[-1,0],[1,0],[-1,1],[1,1]],e}();t.Workshop=v},4437:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(4799),t),n(r(6745),t),n(r(9269),t)},7455:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9258),t),n(r(2392),t),n(r(4437),t),n(r(9040),t),n(r(7940),t),n(r(8261),t)},2061:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AISystem=void 0;var a=r(9519),n=r(8261),i=r(4246),o=function(){function e(e){this.context=e,this.order=2,this.factory=i.UnitFactory(this.context),this.list=[],this.context.get(n.TurnBasedSystem).add(this)}return e.prototype.update=function(){},e.prototype.create=function(e,t,r){var a=new this.factory[r](this.context);return this.list.push(a),a.place(e,t),a},e.prototype.delete=function(e){},e.prototype.query=function(e,t){var r=[];r.push(this.list[0]);for(var a=this.list.length-1;a>=0;a--);return r},e.prototype.execute=function(){console.time("AI");for(var e=this.list.length-1;e>=0;e--)(n=this.list[e]).movementPoints=Math.min(n.movementPoints+n.gainMovementPoints,Math.max(1,n.gainMovementPoints)),n.actionPoints=Math.min(n.actionPoints+n.gainActionPoints,Math.max(1,n.gainActionPoints)),n.strategy.unit=n,n.strategy.precalculate();for(var t=this.list.slice(),r=[];t.length;){var n,i=void 0,o=void 0;for(e=t.length-1;e>=0;e--){var s=t[e].strategy.plan(null==o?void 0:o.priority);o&&o.priority>=s.priority||(o=s,i=e)}(n=t.splice(i,1)[0]).strategy.clear(),r.push(n.execute(o))}return console.timeEnd("AI"),a.AnimationSystem.zip(r)},e}();t.AISystem=o},1629:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AIStrategy=void 0;var a=r(7594),n=r(2392),i=r(9040),o=function(){function e(e,t){void 0===t&&(t=6),this.context=e,this.lookahead=t,this.size=2*this.lookahead+1,this.influence=new Uint16Array(this.size*this.size).fill(65535),this.map=this.context.get(n.TerrainSystem).pathfinder,this.optimal={priority:0,skill:-1,origin:a.vec2()},this.diagonal=!1,this.fuzzy=0,this.skill=0,this.aware=!0}return e.lineOfSight=function(e,t,r){for(var a=t[0]<=r[0]?1:-1,n=t[1]<=r[1]?1:-1,i=Math.abs(r[0]-t[0]),o=Math.abs(r[1]-t[1]),s=t[0],l=t[1],c=0,u=0;c<i||u<o;){var f=(1+2*c)*o-(1+2*u)*i;if(0===f){if(0==e.weight[e.tileIndex(s+a,l)]&&0==e.weight[e.tileIndex(s,l+n)])return!1;s+=a,l+=n,c++,u++}else f<0?(s+=a,c++):(l+=n,u++);if(0==e.weight[e.tileIndex(s,l)])return!1}return!0},e.prototype.precalculate=function(){if(this.aware){for(var t=this.context.get(n.TerrainSystem).pathfinder,r=e.tile,o=this.context.get(i.PlayerSystem).cube,s=this.unit.skills[this.skill],l=s.radius,c=s.cardinal,u=Math.ceil(l),f=l*l,m=-u;m<=u;m++)for(var h=-u;h<=u;h++)m*m+h*h>f||c&&0!=m&&0!=h||(a.vec2.set(o.tile[0]+m,o.tile[1]+h,r),0!==t.weight[t.tileIndex(r[0],r[1])]&&(t.add(r),-1!=(p=this.tileIndex(r[0],r[1]))&&(this.influence[p]=0)));var d=t.linkPath(t.search(this.unit.tile,this.unit.size,this.diagonal));t.clear();for(var v=0;v<d.length;v++){var p;t.indexTile(d[v],r),-1!=(p=this.tileIndex(r[0],r[1]))&&(this.influence[p]=v)}t.add(this.unit.tile),t.walk(this.walkPropagate,this,this.unit.size,this.diagonal,void 0,!0);for(var y=0;y<this.size;y++)for(var g=0;g<this.size;g++){r[0]=y+this.unit.tile[0]-this.lookahead,r[1]=g+this.unit.tile[1]-this.lookahead;var x=y+g*this.size,b=t.tileIndex(r[0],r[1]);this.influence[x]=t.flags[b]?0|this.evaluate(r,t.distance[b],this.influence[x]):0,t.influence[b]+=this.influence[x]}t.clear()}},e.prototype.plan=function(e){var t=this;if(!this.aware)return this.optimal;if(this.optimal.priority=Number.MIN_SAFE_INTEGER,a.vec2.copy(this.unit.tile,this.optimal.origin),this.map.add(this.unit.tile),this.map.walk(this.walkFind,this,this.unit.size,this.diagonal,1,!1),this.optimal.path=null,!(this.optimal.priority===Number.MIN_SAFE_INTEGER||this.optimal.priority<e)){var r=this.map.linkPath(this.map.tileIndex(this.optimal.origin[0],this.optimal.origin[1])).slice(0,1+Math.floor(this.unit.movementPoints));r.length<2||(this.optimal.path=r.map((function(e){return t.map.indexTile(e,a.vec2())})))}if(this.map.clear(),this.optimal.skill=-1,!(this.unit.skills[this.skill].cost>this.unit.actionPoints)){var n=this.context.get(i.PlayerSystem).cube;this.optimal.reverse=this.unit.skills[this.skill].active,this.optimal.target=this.unit.skills[this.skill].aim(this.optimal.reverse?this.unit.tile:this.optimal.origin,n.tiles),this.optimal.target&&(this.optimal.skill=this.skill)}return this.optimal},e.prototype.walkPropagate=function(t,r,a,n,i){if(a>this.lookahead)return!1;var o=this.tileIndex(r[0],r[1]);if(-1!==n){var s=this.map.indexTile(n,e.tile),l=this.tileIndex(s[0],s[1]);this.influence[o]=Math.min(this.influence[o],this.influence[l]+1),this.influence[l]=Math.min(this.influence[l],this.influence[o]+1)}return i&&(this.map.estimate[t]=this.influence[o]),!0},e.prototype.walkFind=function(e,t,r,n,i){if(r>this.unit.movementPoints||!i)return!1;var o=this.influence[this.tileIndex(t[0],t[1])],s=this.map.influence[e]-o,l=a.randomFloat(1-this.fuzzy,1+this.fuzzy,a.random)*o/(1+s/o);return l>this.optimal.priority&&(a.vec2.copy(t,this.optimal.origin),this.optimal.priority=l),!0},e.prototype.evaluate=function(e,t,r){var a=this.context.get(i.PlayerSystem).cube,n=this.unit.skills[this.skill],o=n.radius,s=n.cardinal,l=(n.damage,15/(1+r));if(this.unit.skills[this.skill].aim(e,a.tiles)&&(l=15,l*=2),!(s||o<2)){var c=Math.min(Math.abs(e[0]-a.tile[0]),Math.abs(e[1]-a.tile[1]));l*=Math.min(1,.5+.25*c)}var u=Math.ceil(Math.max(0,t-this.unit.movementPoints)/this.unit.gainMovementPoints);return l*Math.pow(.5,u)},e.prototype.tileIndex=function(e,t){return e-=this.unit.tile[0]-this.lookahead,t-=this.unit.tile[1]-this.lookahead,e<0||t<0||e>=this.size||t>=this.size?-1:e+t*this.size},e.prototype.clear=function(){for(var e=this.unit.tile[0]-this.lookahead,t=this.unit.tile[1]-this.lookahead,r=0;r<this.size;r++)for(var a=0;a<this.size;a++){var n=r+a*this.size,i=this.map.tileIndex(r+e,a+t);this.map.influence[i]-=this.influence[n],this.influence[n]=65535}},e.tile=a.vec2(),e}();t.AIStrategy=o},4918:function(e,t,r){"use strict";var a=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AIUnit=void 0;var n=r(7594),i=r(9519),o=r(2392),s=function(){function e(e){this.context=e,this.tile=n.vec2(),this.size=n.vec2.ONE,this.weight=2,this.movementFloat=0,this.movementPoints=0,this.actionPoints=0,this.healthPoints=0,this.maxHealthPoints=10,this.gainMovementPoints=1,this.gainActionPoints=1}return e.prototype.execute=function(e){var t=this.context.get(o.TerrainSystem).pathfinder,r=[];if(e.path){this.movementPoints-=e.path.length-1;for(var a=[],s=this.context.currentTime,l=0;l<e.path.length-1;l++){var c=e.path[l],u=e.path[l+1],f=t.marked[t.tileIndex(u[0],u[1])];s=Math.max(s,f),a.push(s-this.context.currentTime),s+=l?this.movementDuration:2*this.movementDuration,t.marked[t.tileIndex(c[0],c[1])]=s}a.push(s-this.context.currentTime),a.push(a[a.length-1]+2*this.movementDuration),r.push(this.move(e.path,a)),this.markTiles(!1),n.vec2.copy(e.path[e.path.length-1],this.tile),this.markTiles(!0)}if(-1!=e.skill){this.actionPoints-=this.skills[e.skill].cost;var m=this.skills[e.skill].use(this,e.target);e.reverse?r.unshift(m):r.push(m)}return i.AnimationSystem.join(r)},e.prototype.moveAlongPath=function(e,t,r){var o,s,l,c,u,f,m,h,d,v,p,y,g,x,b,S,P,w;return a(this,(function(a){switch(a.label){case 0:o=this.mesh.transform,s=n.vec3(),l=n.quat.copy(o.rotation,n.quat()),c=n.vec3(),u=n.vec3(),f=n.vec3(),m=this.context.currentTime,h=t[t.length-1],d=e.length-1,v=0,a.label=1;case 1:if(!(v<=d))return[3,6];p=e[v],this.snapPosition(p,f),0==v?n.vec3.copy(f,c):this.snapPosition(e[v-1],c),v==d?n.vec3.copy(f,u):this.snapPosition(e[v+1],u),n.vec3.centroid(c,f,c),n.vec3.centroid(u,f,u),0!=v&&v!=d||n.vec3.centroid(c,u,f),g=0==(y=0==v?0:v==d?2:1)?i.ease.quadIn:2==y?i.ease.quadOut:i.ease.linear,x=t[v],b=t[v+1]-x,a.label=2;case 2:return S=Math.max(0,this.context.currentTime-m-x),P=Math.min(1,S/b),n.quadraticBezier3D(c,f,u,g(P),o.position),r&&(0==y?(n.vec3.subtract(u,c,s),n.quat.fromNormal(n.vec3.normalize(s,s),n.vec3.AXIS_Y,o.rotation),n.quat.slerp(l,o.rotation,i.ease.quadOut(P),o.rotation)):(n.quadraticBezierNormal3D(c,f,u,g(P),s),n.quat.fromNormal(n.vec3.normalize(s,s),n.vec3.AXIS_Y,o.rotation),n.quat.normalize(o.rotation,o.rotation))),o.frame=0,w=this.context.currentTime-m,this.movementFloat=n.clamp(Math.min(h-w,w)/this.movementDuration,0,1),S>b?[3,5]:[4,i.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,2];case 5:return v++,[3,1];case 6:return[2]}}))},e.prototype.rotate=function(e,t){var r,o,s,l,c,u,f;return a(this,(function(a){switch(a.label){case 0:if(r=Math.atan2(e[0]-(this.tile[0]+.5*(this.size[0]-1)),e[1]-(this.tile[1]+.5*(this.size[1]-1))),t&&(r=.5*Math.round(2*r/Math.PI)*Math.PI),o=this.mesh.transform.rotation,s=n.quat.axisAngle(n.vec3.AXIS_Y,r,n.quat()),n.quat.angle(o,s)<.001)return[2];l=this.movementDuration,c=this.context.currentTime,a.label=1;case 1:return u=this.context.currentTime-c,f=Math.min(1,u/l),n.quat.slerp(o,s,i.ease.quadInOut(f),this.mesh.transform.rotation),this.mesh.transform.frame=0,u>l?[3,5]:[3,2];case 2:return[4,i.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:return[2]}}))},e.prototype.snapPosition=function(e,t){var r=e[0]+.5*(this.size[0]-1),a=e[1]+.5*(this.size[1]-1);this.context.get(o.TerrainSystem).tilePosition(r,a,t)},e.prototype.markTiles=function(e){for(var t=this.context.get(o.TerrainSystem),r=0;r<this.size[0];r++)for(var a=0;a<this.size[1];a++)t.setTile(this.tile[0]+r,this.tile[1]+a,e?this:null)},e}();t.AIUnit=s},4885:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AIUnitSkill=void 0;var a=r(7594),n=r(2392),i=function(){function e(e){this.context=e,this.active=!1}return e.damage=function(e,t){var r=this.context.get(n.TerrainSystem).getTile(t[0],t[1]);r&&r.damage(e)},e.prototype.validate=function(e,t){return this.cardinal?e[0]===t[0]&&Math.abs(e[1]-t[1])<=this.radius||e[1]===t[1]&&Math.abs(e[0]-t[0])<=this.radius:a.vec2.distanceSquared(e,t)<=this.radius*this.radius},e.prototype.aim=function(e,t){for(var r=t.length-1;r>=0;r--)if(this.validate(e,t[r]))return t[r]},e}();t.AIUnitSkill=i},7940:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(4918),t),n(r(4885),t),n(r(1629),t),n(r(2061),t)},4268:function(e,t,r){"use strict";var a=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Cube=void 0;var n=r(7594),i=r(391),o=r(3335),s=r(9519),l=r(557),c=r(6256),u=r(1160),f=r(1522),m=r(6830),h=r(2392),d=r(9258),v=function(){function e(e){this.context=e,this.weight=0,this.order=0,this.hash=0,this.meshes=[],this.state={tile:n.vec2(0,0),side:0,direction:0,sides:n.range(6).map((function(e){return{type:0,direction:0,level:0,open:0}})),armor:10},this.tiles=[this.tile],this.transform=this.context.get(o.TransformSystem).create()}return Object.defineProperty(e.prototype,"tile",{get:function(){return this.state.tile},enumerable:!1,configurable:!0}),e.prototype.place=function(e,t){n.vec2.set(e,t,this.state.tile),this.context.get(h.TerrainSystem).tilePosition(e,t,this.transform.position),this.transform.frame=0;for(var r=0;r<this.state.sides.length;r++)this.installModule(r,this.state.sides[r].direction,this.state.sides[r].type);this.context.get(h.TerrainSystem).setTile(this.state.tile[0],this.state.tile[1],this),this.light=this.context.get(c.PointLightPass).create(),this.light.transform=this.context.get(o.TransformSystem).create(),this.light.transform.parent=this.transform,this.light.transform.position[1]=4,this.light.radius=12,this.light.intensity=1,n.vec3.set(1,1,.8,this.light.color),this.dust=d.SharedSystem.particles.dust.add({uOrigin:[0,0,0],uLifespan:[.8,1.2,-.16,0],uSize:[2,4],uRadius:[.2,.4],uOrientation:n.quat.IDENTITY,uForce:[4,8],uTarget:[0,0,0],uGravity:[0,9.8,0],uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]})},e.prototype.installModule=function(e,t,r){this.meshes[e]&&this.context.get(i.MeshSystem).delete(this.meshes[e]);var a=this.meshes[e]=this.context.get(i.MeshSystem).loadModel(u.CubeModuleModel[r]);a.transform=this.transform,a.color[3]=this.state.side==e?1:0,this.state.sides[e].direction=t,this.state.sides[e].type=r;var o=f.DirectionAngle[(this.state.direction+this.state.sides[e].direction)%4];n.quat.copy(o,a.armature.nodes[0].rotation),u.modelAnimations[u.CubeModuleModel[r]].close(0,a.armature),this.hash=this.state.sides.reduce((function(e,t){return 4*e*11+11*t.direction+t.type}),0)},e.prototype.delete=function(){},e.prototype.execute=function(){var e,t,r,n,i,o,c,u,h,d;return a(this,(function(a){switch(a.label){case 0:e=this.context.get(l.KeyboardSystem),t=this.state.sides[this.state.side],this.meshes[this.state.side],r=f.DirectionAngle[(this.state.direction+t.direction)%4],n=this.context.get(m.PlayerSystem).skills[t.type],i=0,a.label=1;case 1:return i!==this.context.frame?[3,3]:[4,s.ActionSignal.WaitNextFrame];case 2:a.sent(),a.label=3;case 3:if(o=-1,e.down("KeyA")?o=3:e.down("KeyD")?o=1:e.down("KeyW")?o=2:e.down("KeyS")&&(o=0),c=e.down("Space"),i=this.context.frame,0!=t.open||!c)return[3,9];u=n.open(),a.label=4;case 4:return(h=u.next()).done?[3,32]:[3,5];case 5:return[4,h.value];case 6:a.sent(),a.label=7;case 7:return[3,4];case 8:return[3,14];case 9:if(1!=t.open||c||-1==o)return[3,14];u=n.close(),a.label=10;case 10:return(h=u.next()).done?[3,32]:[3,11];case 11:return[4,h.value];case 12:a.sent(),a.label=13;case 13:return[3,10];case 14:switch(t.type){case 3:case 7:case 6:case 5:return[3,15];case 10:case 2:return[3,20];case 4:case 8:return[3,25];case 9:return[3,30]}return[3,31];case 15:if(1!=t.open)return[3,31];if(!c)return[3,31];u=n.activate(this.transform.matrix,r),a.label=16;case 16:return(h=u.next()).done?[2,h.value]:[3,17];case 17:return[4,h.value];case 18:a.sent(),a.label=19;case 19:return[3,16];case 20:if(1!=t.open)return[3,31];if(!c||-1===o)return[3,31];u=n.activate(this.transform.matrix,r,o),a.label=21;case 21:return(h=u.next()).done?[2,h.value]:[3,22];case 22:return[4,h.value];case 23:a.sent(),a.label=24;case 24:return[3,21];case 25:if(1!=t.open)return[3,31];if(!c)return[3,31];if(n.active)return[3,31];u=n.activate(this.transform.matrix,r),a.label=26;case 26:return(h=u.next()).done?[2,h.value]:[3,27];case 27:return[4,h.value];case 28:a.sent(),a.label=29;case 29:return[3,26];case 30:return t.open,[3,31];case 31:if(0==t.open&&-1!=o&&(d=this.moveTransition(o)))return this.actionIndex=this.context.get(s.AnimationSystem).start(d,!0),[3,33];a.label=32;case 32:return[3,1];case 33:return[2]}}))},e.prototype.damage=function(e){var t=this.context.get(m.PlayerSystem).skills[1];this.context.get(s.AnimationSystem).start(t.damage(),!0)},e.prototype.moveTransition=function(e){var t=f.CubeOrientation.roll(f.CubeOrientation(this.state.side,this.state.direction),e),r=3&t,i=t>>>2,o=n.vec2.copy(this.state.tile,n.vec2()),l=n.quat(),c=f.DirectionAngle[(r+this.state.sides[i].direction)%4],d=n.vec3();switch(e){case 3:o[0]--,n.quat.axisAngle(n.vec3.AXIS_Z,-.5*Math.PI,l),d[0]=-.5*h.TerrainChunk.tileSize;break;case 1:o[0]++,n.quat.axisAngle(n.vec3.AXIS_Z,.5*Math.PI,l),d[0]=.5*h.TerrainChunk.tileSize;break;case 0:o[1]++,n.quat.axisAngle(n.vec3.AXIS_X,-.5*Math.PI,l),d[2]=.5*h.TerrainChunk.tileSize;break;case 2:o[1]--,n.quat.axisAngle(n.vec3.AXIS_X,.5*Math.PI,l),d[2]=-.5*h.TerrainChunk.tileSize}if(null==this.context.get(h.TerrainSystem).getTile(o[0],o[1])){console.log("%cF "+this.state.side+"-"+i+" D "+this.state.direction+"-"+r+" > "+e,"color:#80dfaf;text-decoration:underline"),this.meshes[this.state.side].color[3]=0,this.meshes[i].color[3]=1,this.state.direction=r,this.state.side=i,this.context.get(h.TerrainSystem).setTile(this.state.tile[0],this.state.tile[1],null),this.context.get(h.TerrainSystem).setTile(o[0],o[1],this),n.vec2.copy(o,this.state.tile);var v=this.meshes[this.state.side];u.modelAnimations[u.CubeModuleModel[this.state.sides[this.state.side].type]].close(0,v.armature);var p=v.armature.nodes[0],y=n.vec3.copy(v.transform.position,n.vec3()),g=this.context.get(h.TerrainSystem).tilePosition(this.state.tile[0],this.state.tile[1],n.vec3());n.quat.multiply(l,c,l);var x=n.vec3.subtract(g,d,n.vec3());return n.quat.transform(d,n.quat.conjugate(c,n.quat()),d),this.context.get(m.PlayerSystem).tilemap.renderFaceTiles(this),function(){var e,t,r,i,o,u;return a(this,(function(a){switch(a.label){case 0:e=s.EventTrigger([{frame:.36,value:{amount:16,uOrigin:g,uTarget:g}}],s.EventTrigger.emitReset),t=s.ease.bounceIn(.064,.8),r=.64,i=this.context.currentTime,a.label=1;case 1:return o=this.context.currentTime-i,u=Math.min(1,o/r),v.transform.frame=0,v.armature.frame=0,n.vec3.lerp(y,g,u,v.transform.position),n.quat.slerp(l,c,t(u),p.rotation),n.quat.normalize(p.rotation,p.rotation),n.quat.transform(d,p.rotation,p.position),n.vec3.subtract(p.position,v.transform.position,p.position),n.vec3.add(x,p.position,p.position),p.position[1]+=v.transform.position[1]-g[1],e(o,this.context.deltaTime,this.dust),u>=1?[3,4]:[4,s.ActionSignal.WaitNextFrame];case 2:a.sent(),a.label=3;case 3:return[3,1];case 4:return[2]}}))}.call(this)}},e}();t.Cube=v},6876:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1522:(e,t,r)=>{"use strict";var a,n,i,o,s,l,c,u;Object.defineProperty(t,"__esModule",{value:!0}),t.CubeOrientation=t.DirectionTile=t.DirectionAngle=void 0;var f=r(7594);t.DirectionAngle=((a={})[0]=f.quat.axisAngle(f.vec3.AXIS_Y,.5*Math.PI,f.quat()),a[1]=f.quat.axisAngle(f.vec3.AXIS_Y,1*Math.PI,f.quat()),a[2]=f.quat.axisAngle(f.vec3.AXIS_Y,1.5*Math.PI,f.quat()),a[3]=f.quat.axisAngle(f.vec3.AXIS_Y,2*Math.PI,f.quat()),a),t.DirectionTile=[f.vec2(0,1),f.vec2(1,0),f.vec2(0,-1),f.vec2(-1,0)],t.CubeOrientation=function(e,t){return e<<2|t},t.CubeOrientation.rotate=function(e,r){var a=e>>>2,n=3&e;return t.CubeOrientation(a,(4+n+r)%4)},t.CubeOrientation.roll=function(e,r){var a=3&e,n=m[28&e][(4+r-a)%4];return t.CubeOrientation.rotate(n,a)};var m=((n={})[0]=((i={})[0]=4,i[1]=21,i[2]=18,i[3]=11,i),n[4]=((o={})[0]=12,o[1]=20,o[2]=0,o[3]=8,o),n[8]=((s={})[0]=15,s[1]=4,s[2]=1,s[3]=16,s),n[20]=((l={})[0]=13,l[1]=16,l[2]=3,l[3]=4,l),n[12]=((c={})[0]=18,c[1]=23,c[2]=4,c[3]=9,c),n[16]=((u={})[0]=14,u[1]=8,u[2]=2,u[3]=20,u),n)},4672:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CubeTileMap=void 0;var a=r(7594),n=r(556),i=r(2130),o=r(4308),s=r(216),l=r(1513),c=r(43),u=r(1522),f=function(){function e(e){this.context=e,this.batchRanges=[],this.tiles=[],this.materials=[],this.projectionMatrix=a.mat3(),this.side=-1,this.hash=-1,this.batch=new i.Batch2D(this.context.gl,144,216,i.Batch2D.quadIndices),this.program=n.ShaderProgram(this.context.gl,r(3582),r(4265))}return e.prototype.renderTexture=function(e,t,r,a){var n=this.context.gl;n.bindFramebuffer(36160,e.fbo),n.viewport(0,0,e.size[0],e.size[1]),n.useProgram(a.target),a.uniforms.uProjectionMatrix=this.projectionMatrix,a.uniforms.uScale=c.MaterialSystem.heightmapScale,a.uniforms.uScreenSize=e.size,this.batch.bind(),n.drawElements(4,t,5123,2*r)},e.prototype.extractTileMap=function(e,t,r){var n=this.context.gl,i=this.context.get(c.MaterialSystem).createRenderTexture(t*e.length,t,1,{filter:9728,wrap:33071}),u=a.vec2(t*r,t*r),f=new s.Sprite2D;f.transform=new l.Transform2D,f.material=new s.Sprite2DMaterial,a.vec2.set(t,t,f.material.size),s.Sprite2DMaterial.calculateUVMatrix(a.aabb2(5*t,0,6*t,t),u,f.material.uvMatrix);for(var m=0;m<e.length;m++){var h=e[m],d=n.createFramebuffer();n.bindFramebuffer(36160,d),n.framebufferTexture2D(36160,36064,3553,h.diffuse,0),n.framebufferTexture2D(36160,36065,3553,h.normal,0),n.drawBuffers([36064,36065]),this.materials[h.index]={size:u,fbo:d},f.material.diffuse=h.diffuse,a.vec2.set(m*t,0,f.transform.position),f.transform.recalculate(0),f.frame=0,f.update(this.context),this.batch.render(f);var v=this.tiles[h.index]=new s.Sprite2DMaterial;v.diffuse=i.target,a.vec2.set(t,t,v.size),s.Sprite2DMaterial.calculateUVMatrix(a.aabb2(m*t,0,(m+1)*t,t),a.vec2(t*e.length,t),v.uvMatrix)}var p=this.batch.indexOffset,y=a.mat3x2.orthogonal(0,i.width,0,i.height,a.mat3x2());a.mat3.fromMat3x2(y,this.projectionMatrix),this.renderTexture({fbo:i.fbo[0],size:a.vec2(i.width,i.height)},p,0,this.context.get(o.OverlayPass).program),this.batch.bindTextures(Array(e.length).fill(null)),a.mat3x2.orthogonal(0,t*r,0,t*r,y),a.mat3.fromMat3x2(y,this.projectionMatrix)},e.prototype.precomputeTileFaces=function(e){return a.range(6).map((function(t){var r=u.CubeOrientation(t,(4-e.state.sides[t].direction)%4),a=u.CubeOrientation.roll(r,0),n=u.CubeOrientation.roll(r,2),i=u.CubeOrientation.roll(a,0),o=u.CubeOrientation.roll(r,3),s=u.CubeOrientation.roll(r,1);return[i,a,s=u.CubeOrientation.rotate(s,3),o=u.CubeOrientation.rotate(o,1),n=u.CubeOrientation.rotate(n,2),r]}))},e.prototype.prepareBatch=function(e){this.tileFaces=this.precomputeTileFaces(e);var t=new s.Sprite2D;a.vec2.set(.5,.5,t.origin),t.transform=new l.Transform2D;for(var r=0,n=0;n<6;n++){for(var i=this.tileFaces[n],o=0;o<i.length;o++){var c=i[o]>>>2,u=((3&i[o])+e.state.sides[c].direction)%4,f=e.meshes[c].material.index;t.material=this.tiles[f],t.transform.rotation=.5*-u*Math.PI,a.vec2.set(o*t.material.size[0]+.5*t.material.size[0],.5*t.material.size[0],t.transform.position),t.transform.recalculate(0),t.frame=0,t.update(this.context),this.batch.render(t)}this.batchRanges[n]=[r,this.batch.indexOffset-r],r=this.batch.indexOffset}},e.prototype.renderFaceTiles=function(e){if(this.side!=e.state.side||this.hash!=e.hash){this.hash!=e.hash&&this.prepareBatch(e),this.hash=e.hash,this.side=e.state.side;var t=e.meshes[this.side].material.index,r=this.batchRanges[this.side];this.renderTexture(this.materials[t],r[1],r[0],this.program)}},e.prototype.renderSubstitute=function(e){var t=e.index,r=this.batchRanges[this.side];this.renderTexture(this.materials[t],r[1],r[0],this.program)},e}();t.CubeTileMap=f},6830:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerSystem=void 0;var a=r(7594),n=r(1974),i=r(9519),o=r(4268),s=r(4672),l=r(1373),c=r(9258),u=r(391),f=r(8261),m=r(7940),h=r(557),d=function(){function e(e){var t=this;this.context=e,this.cameraOffset=a.vec3(0,8,4),this.cube=new o.Cube(this.context),this.tilemap=new s.CubeTileMap(this.context),this.skills=l.CubeSkills(this.context,this.cube),window.orbit=function(e){return void 0===e&&(e=.1),setInterval((function(){t.cameraOffset[0]=4*Math.sin(e*performance.now()/1e3),t.cameraOffset[2]=4*Math.cos(e*performance.now()/1e3)}),10)},this.context.get(f.TurnBasedSystem).add(this.cube)}return e.prototype.update=function(){var e=this;1==this.context.frame&&this.cube.place(4,6),1==this.context.frame&&(this.cube.installModule(this.cube.state.side,0,6),window.quat=a.quat,window.vec3=a.vec3,window.curUnit=3,window.u7=this.context.get(m.AISystem).create(3,10,7),window.move=function(t,r){return e.context.get(i.AnimationSystem).start(r.move(t),!0)},window.strike=function(t,r){return e.context.get(i.AnimationSystem).start(r.strike(t),!0)},window.die=function(t){return e.context.get(i.AnimationSystem).start(t.disappear(),!0)},window.app.systems[17].cameraOffset=[2,6,2]),window["u"+window.curUnit],this.tilemap.renderFaceTiles(this.cube),this.cube.meshes[this.cube.state.side].armature.frame=0,window.a=this.cube.meshes[this.cube.state.side].armature;for(var t=0;t<=8;t++){var r=window["u"+t];r&&(r.mesh.armature.frame=0,window["a"+t]=r.mesh.armature)}this.context.get(h.KeyboardSystem),a.vec3.copy(this.cameraOffset,this.context.get(n.CameraSystem).controller.cameraOffset),this.context.get(n.CameraSystem).controller.adjustCamera(this.cube.transform.position)},e.prototype.load=function(){this.context.get(c.SharedSystem).grid.decal.transform.parent=this.cube.transform;var e=this.context.get(u.MeshSystem).models,t=[];for(var r in e)e[r].material&&(e[r].material.array=c.SharedSystem.textures.indexedTexture.array,e[r].material.arrayLayers=c.SharedSystem.textures.indexedTexture.arrayLayers,-1!=r.indexOf("cube")&&(t[e[r].material.index]=e[r].material));this.tilemap.extractTileMap(t.filter(Boolean),64,8)},e}();t.PlayerSystem=d},9040:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(1522),t),n(r(6876),t),n(r(4268),t),n(r(6830),t)},2830:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EffectLibrary=void 0,t.EffectLibrary=function(e){return{}}},8147:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryLibrary=void 0;var a=r(7594),n=r(9519),i=r(6240),o=r(391);t.GeometryLibrary=function(e){var t=a.mat4(),r=a.quat(),s=i.createSphere({longitude:32,latitude:32,radius:1}),l=e.get(o.MeshSystem).uploadVertexData(s.vertexArray,s.indexArray,s.format,!1),c=i.createSphere({longitude:16,latitude:16,radius:1}),u=i.applyTransform(i.createSphere({longitude:8,latitude:4,radius:1,thetaStart:0,thetaLength:.5*Math.PI,phiStart:0,phiLength:2*Math.PI}),a.mat4.fromRotationTranslationScale(o.Sprite.FlatUp,a.vec3(0,0,-1),a.vec3.ONE,t)),f=i.doubleSided(i.createCylinder({radiusTop:.5,radiusBottom:.5,height:1,radial:32,horizontal:1,cap:!1,angleStart:0,angleLength:2*Math.PI})),m=i.doubleSided(i.applyTransform(i.createCylinder({radiusTop:0,radiusBottom:2,height:1,horizontal:4,radial:16,cap:!1,angleStart:0,angleLength:2*Math.PI}),a.mat4.translate(a.mat4.IDENTITY,a.vec3(0,-.5,0),t))),h=i.doubleSided(i.applyTransform(i.createCylinder({radiusTop:.5,radiusBottom:.5,height:1,radial:16,horizontal:1,cap:!1,angleStart:0,angleLength:2*Math.PI}),a.mat4.translate(a.mat4.IDENTITY,a.vec3(0,.5,0),t))),d=i.doubleSided(i.applyTransform(i.createCylinder({radiusTop:.5,radiusBottom:.5,height:1,radial:16,horizontal:1,cap:!1,angleStart:0,angleLength:2*Math.PI}),a.mat4.translate(a.mat4.IDENTITY,a.vec3(0,-.5,0),t))),v=i.doubleSided(i.extrudePolygon([[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,1],[3,1],[3,-1],[1,-1],[1,-3]],1)),p=i.doubleSided(i.createBox({width:1,height:1,depth:1,open:!1})),y=i.doubleSided(i.applyTransform(i.createBox({width:1,height:1,depth:1,open:!0}),a.mat4.fromRotationTranslationScale(a.quat.IDENTITY,a.vec3(0,.5,0),a.vec3.ONE,t))),g=i.createCylinder({radiusTop:.5,radiusBottom:4,height:4,horizontal:8,radial:8,cap:!1,angleStart:0,angleLength:2*Math.PI});return i.modifyGeometry(g,(function(e,t){var i=1.6*Math.PI*n.ease.circIn(.5+e[1]/4);a.quat.axisAngle(a.vec3.AXIS_Y,i,r),a.quat.transform(e,r,e),a.quat.transform(t,r,t)})),i.applyTransform(g,a.mat4.fromRotationTranslationScale(o.Sprite.FlatUp,a.vec3(0,0,-2),a.vec3.ONE,t)),{sphere:s,lowpolySphere:c,hemisphere:u,cylinder:f,cone:m,box:p,openBox:y,sphereMesh:l,cross:v,lowpolyCylinder:h,funnel:g=i.doubleSided(g),lopolyCylinderFlip:d}}},7080:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GradientLibrary=void 0;var a=r(460);t.GradientLibrary=function(e){return{yellowViolet:a.GradientRamp(e.gl,[4294967040,4294759936,4041975808,3267195952,2786021456,0],1),purple:a.GradientRamp(e.gl,[3756847344,2360597376,1582744672,1663673920,1326208032,0],1),teal:a.GradientRamp(e.gl,[4294967040,3741314560,2329193744,1758767136,446787888,123490080,53491744,0],1),darkTeal:a.GradientRamp(e.gl,[4294967040,4294967040,4025808645,3386631186,2580010060,1520741789,508646011,0],1),tealLine:a.GradientRamp(e.gl,[0,71727168,567061024,3388139008,567061024,71727168,0],1),yellowLine:a.GradientRamp(e.gl,[0,1460667168,4159945216,1460667168,0],1),redPurple:a.GradientRamp(e.gl,[4294967040,3951794496,3156629632,3156629664,3106302704,2084077664,706167840,0],1),tealBlue:a.GradientRamp(e.gl,[4042979845,2816072202,2025373465,1822338595,1501337128,1096120094,724850708,455098378,252782853,0],1),yellowRed2D:a.GradientRamp(e.gl,[4294967040,4294946560,4289699584,4286513152,4294967295,4160211887,4293549695,3427338255,3183065519,2104520831,1110388543,0,255,175,127,0],4),purpleGrey2D:a.GradientRamp(e.gl,[3589666048,2620944160,1108813072,0,1347444735,538980351,168431615,0,808468479,269492223,168431615,0,255,175,127,0],4),brightRed:a.GradientRamp(e.gl,[4294967295,4294967295,4294946799,4294946735,4289699711,3766517856,2686459968,0],1),orange2D:a.GradientRamp(e.gl,[4126201600,3179117824,1380403199,0,2139062271,538976511,255,0],2),simple:a.GradientRamp(e.gl,[0,4294967295],2),white:a.GradientRamp(e.gl,[4294967295,0],1),darkRed:a.GradientRamp(e.gl,[4294967295,3956988624,3515520912,2483436704,1361984624,689972016,0,0],1),brightPurple:a.GradientRamp(e.gl,[4294967040,3319849728,2292759808,1854194720,1312530736,2181843232,939726096,0],1)}}},581:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialLibrary=void 0;var a=r(7594),n=r(556),i=r(8211),o=r(43),s=r(6256),l=r(9258);t.MaterialLibrary=function(e){var t=e.get(o.MaterialSystem),c=new o.DecalMaterial;c.program=n.ShaderProgram(e.gl,i.shaders.decal_vert,r(5433),{INSTANCED:!0,ALPHA_CUTOFF:.01}),c.program.uniforms.uLayer=1;var u=n.ShaderProgram(e.gl,i.shaders.batch_vert,i.shaders.distortion_frag,{PANNING:!0,VERTICAL_MASK:!0});u.uniforms.uDistortionStrength=.01,u.uniforms.uUVTransform=a.vec4(0,0,4,2),u.uniforms.uUVPanning=a.vec2(0,-.8),u.uniforms.uVerticalMask=a.vec4(0,.2,.8,1);var f=n.ShaderProgram(e.gl,i.shaders.batch_vert,i.shaders.distortion_frag,{});f.uniforms.uDistortionStrength=.01;var m=n.ShaderProgram(e.gl,i.shaders.batch_vert,i.shaders.distortion_frag,{CHROMATIC_ABERRATION:!0});m.uniforms.uDistortionStrength=.01;var h=new o.MeshMaterial;h.program=e.get(s.DeferredGeometryPass).programs[0],h.diffuse=t.addRenderTexture(t.createRenderTexture(o.MaterialSystem.textureSize,o.MaterialSystem.textureSize),0,n.ShaderProgram(e.gl,i.shaders.fullscreen_vert,r(8450)),{uScreenSize:[o.MaterialSystem.textureSize,o.MaterialSystem.textureSize]},0).target,h.normal=t.addRenderTexture(t.createRenderTexture(o.MaterialSystem.textureSize,o.MaterialSystem.textureSize),0,n.ShaderProgram(e.gl,i.shaders.fullscreen_vert,r(8063)),{uScreenSize:[o.MaterialSystem.textureSize,o.MaterialSystem.textureSize]},0).target;var d=new o.MeshMaterial;d.program=n.ShaderProgram(e.gl,i.shaders.geometry_vert,r(5870),{});var v=new o.DecalMaterial;v.program=n.ShaderProgram(e.gl,i.shaders.decal_vert,r(2888),{INSTANCED:!0,ALPHA_CUTOFF:.01}),v.program.uniforms.uLayer=2;var p=new o.ShaderMaterial;p.program=n.ShaderProgram(e.gl,i.shaders.geometry_vert,r(6075),{}),p.cullFace=0,p.blendMode=o.ShaderMaterial.Add;var y=new o.ShaderMaterial;y.program=n.ShaderProgram(e.gl,i.shaders.geometry_vert,r(6075),{DISPLACEMENT:!0});var g=new o.EffectMaterial(e.gl,{VERTICAL_MASK:!0,PANNING:!0,GREYSCALE:!0,GRADIENT:!0},{uUVTransform:a.vec4(0,0,2,.2),uVerticalMask:a.vec4(0,.5,0,0),uUVPanning:a.vec2(-.2,-.4),uUV2Transform:a.vec4(0,0,1,.5),uUV2Panning:a.vec2(.3,-.7),uColorAdjustment:a.vec3(1,.8,0)});g.diffuse=l.SharedSystem.textures.cellularNoise,g.gradient=l.SharedSystem.gradients.teal;var x=new o.EffectMaterial(e.gl,{PANNING:!0,VERTICAL_MASK:!0,GREYSCALE:!0,GRADIENT:!0},{uVerticalMask:a.vec4(0,.9,.9,1),uUVTransform:a.vec4(0,0,1,1),uUVPanning:a.vec2(0,-.32),uUV2Transform:a.vec4(0,0,1,1),uUV2Panning:a.vec2(0,-.64),uColorAdjustment:a.vec3(1.4,.9,0)});x.diffuse=l.SharedSystem.textures.directionalNoise,x.gradient=l.SharedSystem.gradients.darkTeal;var b=new o.EffectMaterial(e.gl,{FRESNEL:!0,PANNING:!0,VERTICAL_MASK:!0},{uUVTransform:a.vec4(0,0,1,1),uUVPanning:a.vec2(0,-.6),uVerticalMask:a.vec4(0,0,.8,1),uFresnelMask:a.vec2(.1,.5)});b.diffuse=l.SharedSystem.textures.stripes;var S=new o.EffectMaterial(e.gl,{VERTICAL_MASK:!0,PANNING:!0,GREYSCALE:!0,GRADIENT:!0,POLAR:!0,DEPTH_OFFSET:5.2},{uUVTransform:a.vec4(0,0,1,.8),uVerticalMask:a.vec4(.2,.4,.6,1),uUVPanning:a.vec2(.2,-.1),uUV2Transform:a.vec4(0,0,1,1.6),uUV2Panning:a.vec2(-.2,-.3),uColorAdjustment:a.vec3(1,.9,0)});S.diffuse=l.SharedSystem.textures.cellularNoise,S.gradient=l.SharedSystem.gradients.teal;var P=new o.EffectMaterial(e.gl,{VERTICAL_MASK:!0,PANNING:!0,HALF:!0,GREYSCALE:!0,GRADIENT:!0},{uUVTransform:a.vec4(0,0,1,.3),uUVPanning:a.vec2(.2,-.2),uVerticalMask:a.vec4(0,.4,.6,1),uColorAdjustment:a.vec3(3,1,0),uUV2Transform:a.vec4(0,0,1,.6),uUV2Panning:a.vec2(-.2,-.3)});P.diffuse=l.SharedSystem.textures.voronoiNoise,P.gradient=l.SharedSystem.gradients.purple;var w=new o.EffectMaterial(e.gl,{POLAR:!0,VERTICAL_MASK:!0,PANNING:!0,GRADIENT:!0,DISSOLVE:!0,GREYSCALE:!0},{uUVTransform:a.vec4(.1,0,2,2.4),uUV2Transform:a.vec4(.3,0,1,.6),uColorAdjustment:a.vec3(1,.8,0),uUVPanning:a.vec2(0,-.8),uUV2Panning:a.vec2(.1,-.2),uVerticalMask:a.vec4(.2,.5,.8,1),uDissolveColor:a.vec4(1,0,0,1),uDissolveThreshold:a.vec3(.2,0,0)});w.diffuse=l.SharedSystem.textures.cellularNoise,w.gradient=l.SharedSystem.gradients.yellowViolet;var T=new o.EffectMaterial(e.gl,{PANNING:!0,GRADIENT:!0,DISSOLVE:!0,GREYSCALE:!0,VERTICAL_MASK:!0,FRESNEL:!0},{uUVTransform:a.vec4(0,0,1,1.8),uUVPanning:a.vec2(-.3,0),uDissolveColor:a.vec4.ZERO,uDissolveThreshold:a.vec3(0,.04,0),uColorAdjustment:a.vec3(1,.8,0),uUV2Transform:a.vec4(.71,.29,1,3.8),uUV2Panning:a.vec2(-.5,.2),uVerticalMask:a.vec4(.2,.5,.8,1),uFresnelMask:a.vec2(.1,.5)});T.diffuse=l.SharedSystem.textures.cellularNoise,T.gradient=l.SharedSystem.gradients.yellowRed2D;var O=new o.EffectMaterial(e.gl,{FRESNEL:!0,PANNING:!0,GRADIENT:!0,GREYSCALE:!0},{uUVTransform:a.vec4(0,0,2,1.7),uUVPanning:a.vec2(-.1,.9),uFresnelMask:a.vec2(.2,.6),uColorAdjustment:a.vec3(1,.9,0),uUV2Transform:a.vec4(0,.7,3,2.9),uUV2Panning:a.vec2(.1,.7)});O.diffuse=l.SharedSystem.textures.sineNoise,O.gradient=l.SharedSystem.gradients.brightRed;var M=new o.EffectMaterial(e.gl,{PANNING:!0,GRADIENT:!0,DISSOLVE:!0,GREYSCALE:!0,VERTICAL_MASK:!0},{uUVTransform:a.vec4(0,0,1,.6),uUVPanning:a.vec2(-.3,-.04),uDissolveColor:a.vec4.ZERO,uDissolveThreshold:a.vec3(0,.04,0),uColorAdjustment:a.vec3(1,.64,.1),uUV2Transform:a.vec4(0,0,1,1.7),uUV2Panning:a.vec2(-.5,.1),uVerticalMask:a.vec4(0,.1,.9,1)});M.diffuse=l.SharedSystem.textures.cellularNoise,M.gradient=l.SharedSystem.gradients.orange2D;var A=new o.SpriteMaterial;A.program=e.get(s.ParticleEffectPass).program,A.diffuse=l.SharedSystem.gradients.simple;var E=n.ShaderProgram(e.gl,i.shaders.geometry_vert,i.shaders.geometry_frag,{SKINNING:!0,NORMAL_MAPPING:!0,COLOR_INDEX:!0,DISSOLVE:!0});E.uniforms.uDissolveDirection=a.vec3(0,-1,0),E.uniforms.uDissolveThreshold=.36,E.uniforms.uDissolveColor=a.vec4(1,.2,.4,.8),E.uniforms.uDissolveUVScale=a.vec3(16,16,.8);var _=n.ShaderProgram(e.gl,i.shaders.batch_vert,r(9627)),I=n.ShaderProgram(e.gl,i.shaders.batch_vert,r(9627),{RADIAL:!0}),q=new o.EffectMaterial(e.gl,{PANNING:!0,GREYSCALE:!0,GRADIENT:!0,VERTICAL_MASK:!0},{uUVTransform:a.vec4(0,0,3,2),uUVPanning:a.vec2(-.4,-.8),uColorAdjustment:a.vec3(1,1,0),uUV2Transform:a.vec4(0,.04,2,2),uUV2Panning:a.vec2(.4,-.8),uVerticalMask:a.vec4(0,.5,.8,1)});q.diffuse=l.SharedSystem.textures.boxStripes,q.gradient=l.SharedSystem.gradients.darkRed;var R=new o.EffectMaterial(e.gl,{VERTICAL_MASK:!0,PANNING:!0,HALF:!0,DISSOLVE:!0,GRADIENT:!0,DISPLACEMENT:!0},{uUVTransform:a.vec4(0,0,1,1.4),uUVPanning:a.vec2(-.2,-.4),uVerticalMask:a.vec4(.2,.4,.4,1),uDissolveColor:a.vec4(1,.2,.4,.8),uDissolveThreshold:a.vec3(.1,.02,.1),uDisplacementAmount:[.08],uUV3Transform:a.vec4(0,0,1,3),uUV3Panning:a.vec2(0,.1)});R.diffuse=l.SharedSystem.textures.boxStripes,R.gradient=l.SharedSystem.gradients.white,R.displacement=l.SharedSystem.textures.boxStripes;var k=new o.DecalMaterial;k.program=n.ShaderProgram(e.gl,i.shaders.decal_vert,r(2792),{INSTANCED:!0}),k.program.uniforms.uLayer=k.layer,k.program.uniforms.uDissolveEdge=1;var N=new o.DecalMaterial;N.program=n.ShaderProgram(e.gl,i.shaders.decal_vert,r(2792),{INSTANCED:!0,POLAR:!0}),N.program.uniforms.uLayer=N.layer,N.program.uniforms.uDissolveEdge=1;var z=new o.DecalMaterial;z.program=n.ShaderProgram(e.gl,i.shaders.decal_vert,r(4290),{INSTANCED:!0}),z.program.uniforms.uLayer=z.layer;var U=new o.EffectMaterial(e.gl,{PANNING:!0,HORIZONTAL_MASK:!0,GREYSCALE:!0,GRADIENT:!0},{uHorizontalMask:a.vec4(0,.4,.6,1),uUVTransform:a.vec4(0,0,.4,1.7),uUVPanning:a.vec2(-.1,1.1),uUV2Transform:a.vec4(0,0,.7,1.5),uUV2Panning:a.vec2(.1,.9),uColorAdjustment:a.vec3(1,.8,.2)});U.gradient=l.SharedSystem.gradients.purpleGrey2D,U.diffuse=l.SharedSystem.textures.cloudNoise;var D=new o.EffectMaterial(e.gl,{PANNING:!0,HORIZONTAL_MASK:!0,GREYSCALE:!0,GRADIENT:!0},{uHorizontalMask:a.vec4(0,.5,.5,1),uUVTransform:a.vec4(0,0,.4,1),uUVPanning:a.vec2(.04,-.6),uUV2Transform:a.vec4(0,0,.25,.8),uUV2Panning:a.vec2(-.08,-.4),uColorAdjustment:a.vec3(1,1.2,.1)});D.diffuse=l.SharedSystem.textures.sineNoise,D.gradient=l.SharedSystem.gradients.purple;var L=new o.EffectMaterial(e.gl,{PANNING:!0,VERTICAL_MASK:!0,FRESNEL:!0,GRADIENT:!0,DISPLACEMENT:!0},{uUVTransform:a.vec4(0,0,1,.6),uUVPanning:a.vec2(0,.16),uVerticalMask:a.vec4(0,.2,.8,1),uFresnelMask:a.vec2(1.2,.5),uDisplacementAmount:[.1],uUV3Transform:a.vec4(0,0,1,1),uUV3Panning:a.vec2(0,-.2)});L.diffuse=l.SharedSystem.textures.sineNoise,L.gradient=l.SharedSystem.gradients.purple,L.displacement=l.SharedSystem.textures.perlinNoise;var C=new o.EffectMaterial(e.gl,{GRADIENT:!0,DISSOLVE:!0,DISPLACEMENT:!0,PANNING:!0},{uUVTransform:a.vec4(0,0,1,1),uUVPanning:a.vec2(0,.1),uDissolveColor:a.vec4(1,.8,.6,1),uDissolveThreshold:a.vec3(0,.01,.2),uDisplacementAmount:[.05],uUV3Transform:a.vec4(0,0,1,1),uUV3Panning:a.vec2(0,.2)});C.diffuse=l.SharedSystem.textures.sineNoise,C.gradient=l.SharedSystem.gradients.white,C.displacement=l.SharedSystem.textures.perlinNoise;var V=new o.EffectMaterial(e.gl,{PANNING:!0,VERTICAL_MASK:!0,GREYSCALE:!0,GRADIENT:!0},{uVerticalMask:a.vec4(0,.4,.6,.8),uUVTransform:a.vec4(-.1,0,1,.5),uUVPanning:a.vec2(-.1,1.4),uUV2Transform:a.vec4(0,0,1,.7),uUV2Panning:a.vec2(.2,1.8),uColorAdjustment:a.vec3(2,2,.2)});return V.diffuse=l.SharedSystem.textures.cellularNoise,V.gradient=l.SharedSystem.gradients.brightPurple,{distortion:f,chromaticAberration:m,heatDistortion:u,dunesMaterial:h,dissolveProgram:E,orbMaterial:d,coneTealMaterial:g,gradientMaterial:A,absorbTealMaterial:x,stripesMaterial:b,beamLinearProgram:_,beamRadialProgram:I,stripesBlockyMaterial:R,glowSquaresLinearMaterial:k,glowSquaresRadialMaterial:N,reticleMaterial:z,trailSmokeMaterial:U,exhaustMaterial:V,auraTealMaterial:S,energyHalfPurpleMaterial:P,flashYellowMaterial:w,coreYellowMaterial:T,coreWhiteMaterial:O,ringDustMaterial:M,stripesRedMaterial:q,energyPurpleMaterial:L,planeDissolveMaterial:C,shieldDisplacementMaterial:y,shieldMaterial:p,trailEnergyMaterial:D,resourceSpotMaterial:c,corrosionMaterial:v}}},4632:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleLibrary=void 0;var a=r(8716),n=r(7594),i=r(9519),o=r(556),s=r(6256),l=r(8211),c=r(43),u=r(9217),f=r(9258);t.ParticleLibrary=function(e){var t=e.get(c.MaterialSystem),m=new u.ParticleSystem(e,{limit:512,format:o.VertexDataFormat.Particle},u.ParticleGeometry.quad(e.gl),o.ShaderProgram(e.gl,l.shaders.billboard_vert,l.shaders.billboard_frag,{ALIGNED:!0,SOFT:!1,MASK:!1,GRADIENT:!0,STRETCH:.04}),o.ShaderProgram(e.gl,l.shaders.particle_vert,null,{SPHERE:!0,TARGETED:!0,LUT:!0,RADIAL:!0}));m.material=new c.EmitterMaterial,m.material.diffuse=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,o.ShaderProgram(e.gl,l.shaders.fullscreen_vert,r(3135),{BLINK:!0}),{uColor:[1,1,1,1]},0).target,m.material.gradientRamp=c.GradientRamp(e.gl,[0,842543487,642596415,2377692672,0,287052623,491404095,1067030016,0,135399983,220602159,962353951,0,0,0,0],4),m.material.curveSampler=u.AttributeCurveSampler(e.gl,32,Object.values({size0:function(e){return 1-i.ease.quadIn(e)},size1:function(e){return 1-i.ease.quartIn(e)},linear0:function(e){return 1-.5*i.ease.cubicIn(e)},linear1:function(e){return 1-.5*i.ease.cubicIn(e)},rotational0:a.Zero,rotational1:a.Zero,radial0:function(e){return 4*i.ease.sineIn(e)},radial1:function(e){return 4*i.ease.sineIn(e)}}));var h=new u.ParticleSystem(e,{limit:1024,format:o.VertexDataFormat.Particle},u.ParticleGeometry.stripe(e.gl,8,(function(e){return 2*e})),o.ShaderProgram(e.gl,l.shaders.stripe_vert,l.shaders.billboard_frag,{STRIP:!0,SOFT:!1,MASK:!0,GRADIENT:!0}),o.ShaderProgram(e.gl,l.shaders.particle_vert,null,{SPHERE:!0,TARGETED:!0,STATIC:!0,TRAIL:!0}));h.material=new c.EmitterMaterial,h.material.diffuse=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,o.ShaderProgram(e.gl,l.shaders.fullscreen_vert,r(3135),{ROUNDED_BOX:!0}),{uColor:[1,1,1,1],uRadius:.4,uSize:.2},0).target,h.material.gradientRamp=c.GradientRamp(e.gl,[0,3355242671,2397300351,1132706367,557224960,152130560,0,2178207103,1335140671,660113920,321086208,101462784,0,713197312,541882368,270292736,101264128,0,0,0,0,0,0,0],4);var d=new u.ParticleSystem(e,{limit:1024,format:o.VertexDataFormat.Particle},u.ParticleGeometry.quad(e.gl),o.ShaderProgram(e.gl,l.shaders.billboard_vert,l.shaders.billboard_frag,{SPHERICAL:!0,SOFT:!1,MASK:!0,GRADIENT:!0,UV_OFFSET:.2}),o.ShaderProgram(e.gl,l.shaders.particle_vert,null,{CIRCLE:!0,TARGETED:!0,LUT:!0,ANGULAR:!0}));d.material=new c.EmitterMaterial,d.material.diffuse=f.SharedSystem.textures.cloudNoise,d.material.gradientRamp=c.GradientRamp(e.gl,[3216617215,1886019583,420942431,0,420942463,0,0,0],2),d.material.curveSampler=u.AttributeCurveSampler(e.gl,32,Object.values({size0:i.ease.cubicOut,size1:i.ease.cubicOut,linear0:function(e){return 1-.2*i.ease.linear(e)},linear1:function(e){return 1-.2*i.ease.linear(e)},rotational0:function(e){return 1-.2*i.ease.linear(e)},rotational1:function(e){return 1-.2*i.ease.linear(e)},radial0:a.Zero,radial1:a.Zero}));var v=new u.ParticleSystem(e,{limit:1024,format:o.VertexDataFormat.Particle},u.ParticleGeometry.quad(e.gl),o.ShaderProgram(e.gl,l.shaders.billboard_vert,r(1220),{SPHERICAL:!0,MASK:!0,GRADIENT:!0}),o.ShaderProgram(e.gl,l.shaders.particle_vert,null,{LUT:!0,VECTOR_FIELD:!0}));v.material=new c.EmitterMaterial,v.material.diffuse=f.SharedSystem.textures.sineNoise,v.material.gradientRamp=c.GradientRamp(e.gl,[168434351,235802751,437919551,0,0,0,0,0],2),v.material.curveSampler=u.AttributeCurveSampler(e.gl,32,Object.values({size0:i.ease.linear,size1:i.ease.quadOut,linear0:function(e){return.98},linear1:function(e){return.98},rotational0:a.Zero,rotational1:a.Zero,radial0:a.Zero,radial1:a.Zero}));var p=new u.ParticleSystem(e,{limit:1024,format:o.VertexDataFormat.Particle},u.ParticleGeometry.quad(e.gl),o.ShaderProgram(e.gl,l.shaders.billboard_vert,l.shaders.billboard_frag,{FRAMES:!0,SWIPE:.1}),o.ShaderProgram(e.gl,l.shaders.particle_vert,null,{CIRCLE:!0,FRAMES:!0}));p.material=new c.EmitterMaterial,p.material.diffuse=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,o.ShaderProgram(e.gl,l.shaders.fullscreen_vert,r(2811),{}),{uTiles:4},0).target;var y=new u.ParticleSystem(e,{limit:512,format:o.VertexDataFormat.Particle},u.ParticleGeometry.quad(e.gl),o.ShaderProgram(e.gl,l.shaders.billboard_vert,l.shaders.billboard_frag,{ALIGNED:!0,GRADIENT:!0,STRETCH:.04}),o.ShaderProgram(e.gl,l.shaders.particle_vert,null,{CIRCLE:!0,TARGETED:!0,LUT:!0}));y.material=new c.EmitterMaterial,y.material.diffuse=f.SharedSystem.textures.particle,y.material.gradientRamp=c.GradientRamp(e.gl,[4294967040,4210608640,4074077184,3482272272,3007715120,2182088736,805502992,0,0,0,0,0,0,0,0,0],2),y.material.curveSampler=u.AttributeCurveSampler(e.gl,32,Object.values({size0:function(e){return 1-i.ease.sineIn(e)},size1:function(e){return 1-i.ease.quadIn(e)},linear0:function(e){return.98},linear1:function(e){return.96},rotational0:a.Zero,rotational1:a.Zero,radial0:a.Zero,radial1:a.Zero}));var g=new u.ParticleSystem(e,{limit:512,format:o.VertexDataFormat.Particle},u.ParticleGeometry.quad(e.gl),o.ShaderProgram(e.gl,l.shaders.billboard_vert,r(9237),{ALIGNED:!0}),o.ShaderProgram(e.gl,l.shaders.particle_vert,null,{SPHERE:!0,RELATIVE:!0}));g.material=new c.EmitterMaterial,g.material.diffuse=f.SharedSystem.textures.noise;var x=new u.ParticleSystem(e,{limit:256,format:o.VertexDataFormat.Particle},u.ParticleGeometry.board(e.gl,.2),o.ShaderProgram(e.gl,l.shaders.billboard_vert,l.shaders.billboard_frag,{ALIGNED:!0,GRADIENT:!0,FRAMES:!0}),o.ShaderProgram(e.gl,l.shaders.particle_vert,null,{SPHERE:!0,TARGETED:!0,LUT:!0,FRAMES:!0}));x.material=new c.EmitterMaterial,x.material.diffuse=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,o.ShaderProgram(e.gl,l.shaders.fullscreen_vert,r(796),{SPIKE:!0,TILED:!0}),{uTiles:[2,2]},0).target,x.material.gradientRamp=c.GradientRamp(e.gl,[3991720192,1798129663,3341175664,1110324944,1964190032,639443616,0,0],4),x.material.curveSampler=u.AttributeCurveSampler(e.gl,32,Object.values({size0:function(e){return Math.sqrt(i.ease.fadeInOut(i.ease.cubicOut(e)))},size1:function(e){return Math.sqrt(i.ease.fadeInOut(i.ease.cubicOut(e)))},linear0:i.ease.reverse(i.ease.sineIn),linear1:i.ease.reverse(i.ease.sineIn),rotational0:a.Zero,rotational1:a.Zero,radial0:a.Zero,radial1:a.Zero}));var b=new u.StaticParticleSystem(e,{limit:512,format:o.VertexDataFormat.Particle},u.ParticleGeometry.quad(e.gl),o.ShaderProgram(e.gl,l.shaders.verlet_vert,l.shaders.billboard_frag,{SPHERICAL:!0,GRADIENT:!0,VECTOR_FIELD:!0,LUT:!0}),{aLifetime:function(t,r,a){a[r+0]=e.currentTime-n.randomFloat(t.uLifespan[2],t.uLifespan[3],n.random),a[r+1]=n.randomFloat(t.uLifespan[0],t.uLifespan[1],n.random),a[r+2]=n.random(),a[r+3]=-t.uLifespan[2]},aSize:function(e,t,r){r[t+0]=n.randomFloat(e.uSize[0],e.uSize[1],n.random),r[t+1]=r[t+0],r[t+2]=0,r[t+3]=1},aTransform:function(e,t,r){var a=n.randomFloat(0,2*Math.PI,n.random),i=n.randomFloat(e.uRadius[0],e.uRadius[1],n.random),o=i*Math.cos(a),s=i*Math.sin(a);r[t+0]=e.uOrigin[0]+o,r[t+1]=e.uOrigin[1],r[t+2]=e.uOrigin[2]+s,r[t+3]=0},aVelocity:function(e,t,r){r[t+0]=0,r[t+1]=0,r[t+2]=0,r[t+3]=0},aAcceleration:function(e,t,r){r[t+0]=e.uGravity[0],r[t+1]=e.uGravity[1],r[t+2]=e.uGravity[2],r[t+3]=0}});return b.material=new c.EmitterMaterial,b.material.diffuse=f.SharedSystem.textures.glow,b.material.gradientRamp=c.GradientRamp(e.gl,[4160219904,2509606864,3638204944,1532126624,1194804032,858271360,0,0],4),b.material.curveSampler=u.AttributeCurveSampler(e.gl,32,Object.values({size0:i.ease.fadeInOut,size1:i.ease.fadeInOut,displacement0:i.ease.quadIn,displacement1:i.ease.sineIn})),b.material.displacementMap=f.SharedSystem.textures.perlinNoise,e.get(s.ParticleEffectPass).effects.push(b,d,x,v,m,h,p,y,g),{glow:b,dust:d,spikes:x,smoke:v,energy:m,sparks:h,bolts:p,embers:y,fire:g}}},6663:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureLibrary=void 0;var a=r(7594),n=r(556),i=r(7269),o=r(8211);t.TextureLibrary=function(e){var t=e.get(i.MaterialSystem),s=t.addRenderTexture(t.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(3135),{CIRCLE:!0}),{uColor:[1,1,1,1]},0).target,l=t.addRenderTexture(t.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(3135),{GLOW:!0}),{uColor:[1,1,1,1]},0).target,c=t.addRenderTexture(t.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(3135),{BULGE:!0}),{uColor:[1,1,1,1]},0).target,u=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(3135),{SPARKLE:!0}),{uColor:[1,1,1,1]},0).target,f=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(3135),{RING:!0}),{uColor:[1,1,1,1]},0).target,m=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(3135),{CRESCENT:!0}),{uColor:[1,1,1,1]},0).target,h=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(3135),{WAVE:!0}),{uColor:[1,1,1,1]},0).target,d=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(3135),{RETICLE:!0}),{uColor:[1,1,1,1]},0).target,v=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(796),{SWIRL:!0}),{},0).target,p=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(796),{}),{},0).target,y=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(796),{RING:!0}),{},0).target,g=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(796),{INNER:!0}),{},0).target,x=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(796),{WRAP:!0}),{},0).target,b=t.addRenderTexture(t.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(796),{BEAM:!0}),{},0).target,S=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(7457),{LINE:!0}),{},0).target,P=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(7457),{}),{},0).target,w=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,o.shaders.noise_frag,{}),{uColor:a.vec4.ONE},0).target,T=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,o.shaders.noise_frag,{CELLULAR:!0}),{uColor:a.vec4.ONE},0).target,O=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,o.shaders.noise_frag,{VORONOI:!0}),{uColor:a.vec4.ONE},0).target,M=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,o.shaders.noise_frag,{PERLIN:!0}),{uColor:a.vec4.ONE},0).target,A=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,o.shaders.noise_frag,{SINE:!0}),{uColor:a.vec4.ONE},0).target,E=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(8193),{}),{uColor:[1,1,1,1]},0).target,_=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(3135),{STRIPE:!0}),{uColor:[.6,1,1,.6]},0).target,I=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(8193),{BOX_STRIPE:!0}),{uColor:[1,1,1,1]},0).target,q=n.createTexture(e.gl,{width:1,height:1,data:new Uint8Array([255,255,255,255])}),R=n.createTexture(e.gl,{width:1,height:1,data:new Uint8Array([0,0,0,0])}),k=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,o.shaders.noise_frag,{}),{uColor:[3,2.5,1.5,1]},0).target,N=function(e){for(var t=e.get(i.MaterialSystem),a=[{shader:r(5325),rate:0,uniforms:{uColor:[0,0,0,.5]}},{shader:r(5325),rate:0,uniforms:{uColor:[.91,.23,.52,1]}},{shader:r(5325),rate:0,uniforms:{uColor:[.2,.2,.2,.12]}},{shader:r(7330),rate:2,uniforms:{}},{shader:r(1857),rate:0,uniforms:{uColor:[.8,.9,1]}},{shader:r(1069),define:{RUST:!1},rate:0,uniforms:{}},{shader:r(5427),rate:2,uniforms:{}},{shader:r(1069),define:{RUST:!0},rate:0,uniforms:{}},{shader:r(1069),define:{PIPE:!0},rate:0,uniforms:{}}],s=t.createRenderTexture(i.MaterialSystem.textureSize,i.MaterialSystem.textureSize,a.length),l=0;l<a.length;l++)t.addRenderTexture(s,l,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,a[l].shader,a[l].define),a[l].uniforms,a[l].rate);return{array:s.target,arrayLayers:a.length}}(e),z=t.addRenderTexture(t.createRenderTexture(256,256,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(796),{CRACKS:!0}),{},0).target,U=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(796),{GROUND:!0}),{},0).target,D=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,o.shaders.bumpmap_frag,{PREMULTIPLY:!0}),{uSampler:z,uScale:-i.MaterialSystem.heightmapScale,uScreenSize:[128,128]},0).target;return{particle:s,glow:l,bulge:c,sparkle:u,ring:f,crescent:m,wave:h,reticle:d,swirl:v,rays:p,raysRing:y,raysInner:g,raysWrap:x,raysBeam:b,wind:E,stripes:_,boxStripes:I,trail:S,noise:k,directionalNoise:P,cloudNoise:w,cellularNoise:T,voronoiNoise:O,perlinNoise:M,sineNoise:A,white:q,black:R,grey:t.white.diffuse,cracksNormal:D,cracks:z,groundDust:U,indexedTexture:N}}},9878:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebrisEffect=void 0;var a=r(7594),n=r(556),i=r(391),o=r(43),s=r(3335),l=r(8211),c=r(9258),u=function(){function e(e,t){this.context=e,this.material=new o.MeshMaterial,this.material.program=n.ShaderProgram(this.context.gl,l.shaders.debris_vert,l.shaders.geometry_frag,{VERTEX_COLOR:!0,COLOR_INDEX:!0}),this.material.array=c.SharedSystem.textures.indexedTexture.array,this.material.arrayLayers=c.SharedSystem.textures.indexedTexture.arrayLayers,Object.assign(this.material.program.uniforms,{uGravity:a.vec3(0,-19.6,0),uAngularVelocity:[.2*Math.PI*2,4*Math.PI*2],uVelocityMax:a.vec3(4,10,4),uVelocityMin:a.vec3(-4,4,-4)}),this.buffer=this.context.get(i.MeshSystem).models[t].buffer,this.buffer.radius+=16}return e.prototype.create=function(e){var t=this.context.get(i.MeshSystem).create();return t.transform=this.context.get(s.TransformSystem).create(),a.vec3.copy(e,t.transform.position),t.buffer=this.buffer,t.material=this.material,t.layer=1,t.order=3,t.startTime=this.context.currentTime,t},e.prototype.delete=function(e){this.context.get(s.TransformSystem).delete(e.transform),this.context.get(i.MeshSystem).delete(e)},e}();t.DebrisEffect=u},2725:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridEffect=void 0;var a=r(7594),n=r(556),i=r(8211),o=r(3335),s=r(43),l=r(6256),c=function(){function e(e,t){this.context=e,this.gridSize=t,this.material=new s.DecalMaterial,this.material.program=n.ShaderProgram(this.context.gl,i.shaders.decal_vert,r(4267),{INSTANCED:!0,WORLD:!0}),this.material.blendMode=[[32774],[770,771,0,1]],this.material.program.uniforms.uGridSize=1/t,this.decal=this.context.get(l.DecalPass).create(1),this.decal.transform=this.context.get(o.TransformSystem).create(),a.vec3.set(2*t,10,2*t,this.decal.transform.scale),this.decal.material=this.material}return Object.defineProperty(e.prototype,"enabled",{get:function(){return 0!=this.decal.color[3]},set:function(e){a.vec4.copy(e?a.vec4.ONE:a.vec4.ZERO,this.decal.color)},enumerable:!1,configurable:!0}),e}();t.GridEffect=c},2405:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.MistEffect=void 0;var i=r(7594),o=r(556),s=r(8211),l=r(1974),c=r(9217),u=r(43),f=function(e){function t(t,a,n){var l=e.call(this,t,{limit:a,format:[{name:"aTransform",size:3,type:5126,normalized:!1,stride:12,offset:0}]},null,o.ShaderProgram(t.gl,r(8683),s.shaders.billboard_frag,{POINT:!0}),null)||this;l.center=i.vec3(0,0,0),l.ray=i.vec3(0,0,0),l.frame=0,l.material=new u.EmitterMaterial,l.material.blendMode=u.ShaderMaterial.Blend,l.program.uniforms.uArea=i.vec3(n[3]-n[0],n[4]-n[1],n[5]-n[2]),l.instances=a;for(var c=l.context.gl,f=new Float32Array(3*l.instances),m=0;m<l.instances;m++)f[3*m+0]=i.randomFloat(n[0],n[3],i.random),f[3*m+1]=i.randomFloat(n[1],n[4],i.random),f[3*m+2]=i.randomFloat(n[2],n[5],i.random);c.bindBuffer(34962,l.buffer[0]),c.bufferSubData(34962,0,f);var h=l.context.get(u.MaterialSystem);return l.material.diffuse=h.addRenderTexture(h.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,o.ShaderProgram(t.gl,s.shaders.fullscreen_vert,r(3135),{CIRCLE:!0}),{uColor:[.5,.5,.5,1]},0).target,l}return n(t,e),t.prototype.apply=function(){var t,r,a,n,o,s,c,u,f=this.context.get(l.CameraSystem).camera;this.frame>=f.frame&&this.frame||(this.frame=this.context.frame,i.vec3.set(f.viewMatrix[2],f.viewMatrix[6],f.viewMatrix[10],this.ray),t=f.transform.position,r=this.ray,a=i.vec3.AXIS_Y,n=i.vec3.ZERO,o=this.center,s=-i.vec3.dot(n,a),c=i.vec3.dot(r,a),u=-(i.vec3.dot(t,a)+s)/c,i.vec3.scale(r,u,o),i.vec3.add(o,t,o),this.context.gl.useProgram(this.program.target),this.program.uniforms.uCenter=this.center,this.program.uniforms.uSize=.2*this.context.gl.drawingBufferHeight*.5*f.projectionMatrix[5]),e.prototype.apply.call(this)},t}(c.ParticleSystem);t.MistEffect=f},1531:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyEffect=void 0;var a=r(7594),n=r(6256),i=r(43),o=r(556),s=r(8211),l=function(){function e(e){this.context=e,this.enabled=!0,this.color=a.vec3(1.2,.4,.6),this.buffer=this.context.get(n.PostEffectPass).plane,this.material=new i.ShaderMaterial,this.material.blendMode=null,this.material.cullFace=1029,this.material.depthTest=515,this.material.depthWrite=!0,this.material.program=o.ShaderProgram(this.context.gl,s.shaders.fullscreen_vert,s.shaders.sky_frag,{RAYCAST:!0}),this.material.program.uniforms.uLayer=0,this.material.program.uniforms.uFogColor=this.context.get(n.PostEffectPass).fog.color,this.material.program.uniforms.uSkyColor=this.color}return e.prototype.apply=function(){if(this.enabled){var e=this.context.gl;e.useProgram(this.material.program.target),this.material.bind(e),e.bindVertexArray(this.buffer.vao),e.drawElements(this.buffer.drawMode,this.buffer.indexCount,5123,this.buffer.indexOffset)}},e}();t.SkyEffect=l},9729:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9878),t),n(r(2725),t),n(r(1531),t),n(r(2405),t)},9258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharedSystem=void 0;var a=r(6256),n=r(6663),i=r(7080),o=r(581),s=r(4632),l=r(8147),c=r(2830),u=r(9729),f=function(){function e(t){this.context=t,e.textures=n.TextureLibrary(this.context),e.gradients=i.GradientLibrary(this.context),e.materials=o.MaterialLibrary(this.context),e.geometry=l.GeometryLibrary(this.context),e.particles=s.ParticleLibrary(this.context),e.effects=c.EffectLibrary(this.context)}return e.prototype.update=function(){},e.prototype.load=function(){this.sky=new u.SkyEffect(this.context),this.context.get(a.DeferredGeometryPass).effects.push(this.sky),this.debris=new u.DebrisEffect(this.context,"cube_debris"),this.grid=new u.GridEffect(this.context,10),this.mist=new u.MistEffect(this.context,256,[-8,0,-8,8,6,8]),this.context.get(a.ParticleEffectPass).effects.push(this.mist),this.mist.enabled=!1},e}();t.SharedSystem=f},2099:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArtillerySkill=void 0;var s=r(7594),l=r(9519),c=r(3335),u=r(391),f=r(43),m=r(6256),h=r(1160),d=r(9258),v=r(9040),p=r(1515),y=r(2392),g={"burn.transform.scale":l.PropertyAnimation([{frame:0,value:[0,4,0]},{frame:.4,value:[8,4,8],ease:l.ease.cubicOut}],s.vec3.lerp),"burn.color":l.PropertyAnimation([{frame:0,value:[0,0,0,1]},{frame:1,value:s.vec4.ZERO,ease:l.ease.quadIn}],s.vec4.lerp),"wave.transform.scale":l.PropertyAnimation([{frame:0,value:s.vec3.ZERO},{frame:.6,value:[12,12,12],ease:l.ease.quartOut}],s.vec3.lerp),"wave.color":l.PropertyAnimation([{frame:0,value:s.vec4.ONE},{frame:.6,value:s.vec4.ZERO,ease:l.ease.sineOut}],s.vec4.lerp),"ring.transform.scale":l.PropertyAnimation([{frame:0,value:[0,2,0]},{frame:.8,value:[6,2,6],ease:l.ease.cubicOut}],s.vec3.lerp),"ring.color":l.PropertyAnimation([{frame:0,value:[.3,.3,.4,1]},{frame:.8,value:[0,0,0,0],ease:l.ease.sineIn}],s.vec4.lerp),"pillar.transform.scale":l.PropertyAnimation([{frame:0,value:[1,0,1]},{frame:.4,value:[2,6,2],ease:l.ease.quartOut},{frame:.8,value:s.vec3.ZERO,ease:l.ease.quadIn}],s.vec3.lerp),"pillar.color":l.PropertyAnimation([{frame:0,value:[.6,.6,.8,.2]},{frame:.4,value:[.18,.16,.2,1],ease:l.ease.sineIn},{frame:.8,value:s.vec4.ZERO,ease:l.ease.sineOut}],s.vec4.lerp),"flash.transform.scale":l.PropertyAnimation([{frame:0,value:s.vec3.ZERO},{frame:.3,value:[4.4,4.4,4.4],ease:l.ease.quintOut}],s.vec3.lerp),"flash.color":l.PropertyAnimation([{frame:0,value:[1,.9,.8,.2]},{frame:.3,value:s.vec4.ZERO,ease:l.ease.quadIn}],s.vec4.lerp)},x=function(){function e(e,t){this.context=e,this.parent=t,this.origin=s.vec3(),this.normal=s.vec3(),this.trail=new u.Line,this.trail.order=4,this.trail.width=.4,this.trail.ease=l.ease.cubicFadeInOut,this.trail.path=s.range(16).map((function(e){return s.vec3()})),this.trail.addColorFade(this.trail.ease),this.trail.material=d.SharedSystem.materials.trailSmokeMaterial,this.exhaust=new u.BatchMesh(d.SharedSystem.geometry.hemisphere),this.exhaust.order=2,this.exhaust.material=d.SharedSystem.materials.exhaustMaterial,this.ring=new u.BatchMesh(d.SharedSystem.geometry.cylinder),this.ring.order=6,this.ring.material=d.SharedSystem.materials.ringDustMaterial,this.wave=new u.Sprite,this.wave.billboard=0,this.wave.material=this.parent.waveMaterial,this.pillar=new u.Sprite,this.pillar.billboard=3,s.vec2.set(0,.5,this.pillar.origin),this.pillar.material=this.parent.pillarMaterial,this.flash=new u.Sprite,this.flash.billboard=0,this.flash.material=this.parent.flashMaterial}return e.prototype.launch=function(e,t){var r,a,n,f,h,v,p,y,x;return o(this,(function(o){switch(o.label){case 0:this.head=this.context.get(u.MeshSystem).loadModel("missile"),this.head.transform=this.context.get(c.TransformSystem).create(),s.vec3.copy(this.origin,this.head.transform.position),s.quat.fromNormal(this.normal,s.vec3.AXIS_Y,this.head.transform.rotation),s.quat.normalize(this.head.transform.rotation,this.head.transform.rotation),this.context.get(m.ParticleEffectPass).add(this.trail),this.exhaust.transform=this.context.get(c.TransformSystem).create(),this.exhaust.transform.parent=this.head.transform,s.vec3.set(.24,.24,1.2,this.exhaust.transform.scale),this.context.get(m.ParticleEffectPass).add(this.exhaust),this.smoke=d.SharedSystem.particles.smoke.add({uLifespan:[1,1.5,-.8,0],uOrigin:s.vec3.add(this.origin,s.vec3.scale(this.normal,-.5,s.vec3()),s.vec3()),uGravity:[0,3.6,0],uRotation:[0,2*Math.PI],uSize:[1,2],uFieldDomain:[.5,.5,.5,0],uFieldStrength:[6,0]}),this.embers=d.SharedSystem.particles.embers.add({uLifespan:[.3,.5,-.04,0],uOrigin:s.vec3.add(this.origin,s.vec3.scale(this.normal,-1,s.vec3()),s.vec3()),uRadius:[0,.04],uOrientation:s.quat.rotation(s.vec3.AXIS_Y,this.normal,s.quat()),uGravity:s.vec3.ZERO,uRotation:s.vec2.ZERO,uSize:[.2,.7],uForce:[8,14],uTarget:s.vec3.add(this.origin,s.vec3.scale(this.normal,-1.2,s.vec3()),s.vec3())}),this.burn=this.context.get(m.DecalPass).create(0),this.burn.transform=this.context.get(c.TransformSystem).create(),s.vec3.copy(e,this.burn.transform.position),s.quat.axisAngle(s.vec3.AXIS_Y,s.randomFloat(0,2*Math.PI,s.random),this.burn.transform.rotation),this.burn.material=this.parent.burnMaterial,this.wave.transform=this.context.get(c.TransformSystem).create(),s.vec3.add([0,1,0],e,this.wave.transform.position),s.quat.axisAngle(s.vec3.AXIS_X,-.5*Math.PI,this.wave.transform.rotation),this.context.get(m.PostEffectPass).add(this.wave),this.ring.transform=this.context.get(c.TransformSystem).create(),s.vec3.copy(e,this.ring.transform.position),this.context.get(m.ParticleEffectPass).add(this.ring),this.pillar.transform=this.context.get(c.TransformSystem).create(),s.vec3.copy(e,this.pillar.transform.position),this.context.get(m.ParticleEffectPass).add(this.pillar),this.flash.transform=this.context.get(c.TransformSystem).create(),s.vec3.add(s.vec3.AXIS_Y,e,this.flash.transform.position),s.quat.axisAngle(s.vec3.AXIS_X,-.5*Math.PI,this.flash.transform.rotation),this.context.get(m.ParticleEffectPass).add(this.flash),r=this.buildPath(e,5),a=r.path,n=r.intervals,f=1+.25*t,h=l.FollowPath.spline(a,n.map((function(e){return f*e-f})),{ease:l.ease.CubicBezier(.5,.5,1,.5),tension:.5}),v=l.AnimationTimeline(this,i(i({},g),{embers:l.EventTrigger([{frame:-f,value:16}],l.EventTrigger.emit),smoke:l.EventTrigger([{frame:-f,value:24}],l.EventTrigger.emit),trail:l.FollowPath.Line(h,{length:.08}),"head.transform":l.FollowPath(h)})),p=f+1,y=this.context.currentTime,o.label=1;case 1:return x=this.context.currentTime-y,v(x-f,this.context.deltaTime),x>p?[3,4]:[4,l.ActionSignal.WaitNextFrame];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:return d.SharedSystem.particles.embers.remove(this.embers),d.SharedSystem.particles.smoke.remove(this.smoke),this.context.get(c.TransformSystem).delete(this.head.transform),this.context.get(c.TransformSystem).delete(this.exhaust.transform),this.context.get(c.TransformSystem).delete(this.burn.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.pillar.transform),this.context.get(c.TransformSystem).delete(this.flash.transform),this.context.get(u.MeshSystem).delete(this.head),this.context.get(m.DecalPass).delete(this.burn),this.context.get(m.PostEffectPass).remove(this.wave),this.context.get(m.ParticleEffectPass).remove(this.trail),this.context.get(m.ParticleEffectPass).remove(this.exhaust),this.context.get(m.ParticleEffectPass).remove(this.ring),this.context.get(m.ParticleEffectPass).remove(this.pillar),this.context.get(m.ParticleEffectPass).remove(this.flash),this.parent.pool.push(this),[2]}}))},e.prototype.buildPath=function(e,t){var r=[this.origin],a=[0],n=s.vec3.scale(this.normal,1,s.vec3());s.vec3.add(this.origin,n,n);var i=s.vec3.scale(this.normal,3,s.vec3());s.vec3.add(n,i,i);var o=s.vec3.subtract(e,i,s.vec3()),l=s.vec3.dot(this.normal,o);s.vec3.scale(this.normal,l,o),s.vec3.subtract(e,o,o);for(var c=s.vec2(1,Math.max(0,this.origin[1])+6),u=s.vec3(),f=0,m=0;m<=t;m++){var h=r[r.length-1],d=s.cubicBezier3D(n,i,o,e,m/t,s.vec3());r.push(d),s.vec3.random(s.random(),s.random(),u),s.vec3.scale(u,s.random()*(0==m||m==t?0:1),u),s.vec3.add(d,u,d),d[1]=s.clamp(d[1],c[0],c[1]),a.push(f+=Math.sqrt(s.vec3.distanceSquared(h,d)))}r.push(s.vec3.subtract(e,[0,2,0],s.vec3())),a.push(a[a.length-1]+1/t);for(var v=1/a[m=a.length-1];m>=0;m--)a[m]*=v;return{path:r,intervals:a}},e}(),b=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.pool=[],a.pivots=[s.vec3(-1,4.4,-2.1),s.vec3(-1.6,3.8,-2.1),s.vec3(-1,4.4,2.1),s.vec3(-1.6,3.8,2.1)],a.burnMaterial=new f.DecalMaterial,a.burnMaterial.program=a.context.get(m.DecalPass).program,a.burnMaterial.diffuse=d.SharedSystem.textures.rays,a.waveMaterial=new f.SpriteMaterial,a.waveMaterial.blendMode=null,a.waveMaterial.program=d.SharedSystem.materials.chromaticAberration,a.waveMaterial.diffuse=d.SharedSystem.textures.wave,a.pillarMaterial=new f.SpriteMaterial,a.pillarMaterial.program=a.context.get(m.ParticleEffectPass).program,a.pillarMaterial.diffuse=d.SharedSystem.textures.groundDust,a.flashMaterial=new f.SpriteMaterial,a.flashMaterial.program=a.context.get(m.ParticleEffectPass).program,a.flashMaterial.diffuse=d.SharedSystem.textures.ring,a}return n(t,e),t.prototype.activate=function(e,t,r){var a,n,i,c,u,f,m,d,p,g,b,S,P=this;return o(this,(function(e){switch(e.label){case 0:a=this.cube.meshes[this.cube.state.side],n=h.modelAnimations[h.CubeModuleModel[this.cube.state.sides[this.cube.state.side].type]],i=l.PropertyAnimation([{frame:0,value:s.quat.copy(a.armature.nodes[1].rotation,s.quat())},{frame:.6,value:v.DirectionAngle[s.mod(r-this.direction-3,4)],ease:l.ease.quadInOut}],s.quat.slerp),c=this.findTarget(r),u=this.pivots.map((function(e){var t=P.pool.pop()||new x(P.context,P);return s.vec3.copy(e,t.origin),s.vec3.normalize([-1,1,0],t.normal),s.quat.transform(t.origin,v.DirectionAngle[r],t.origin),s.mat4.transform(t.origin,P.cube.transform.matrix,t.origin),s.quat.transform(t.normal,v.DirectionAngle[r],t.normal),t})),f=2,m=this.context.currentTime,e.label=1;case 1:if(d=this.context.currentTime-m,i(d,a.armature.nodes[1].rotation),n.activate(d,a.armature),d>.6&&u.length)for(p=0;u.length;p++)g=u.pop(),b=c[p],S=this.context.get(y.TerrainSystem).tilePosition(b[0],b[1],s.vec3()),this.context.get(l.AnimationSystem).start(g.launch(S,p),!0);return d>f?[3,4]:[4,l.ActionSignal.WaitNextFrame];case 2:e.sent(),e.label=3;case 3:return[3,1];case 4:return[2]}}))},t.prototype.close=function(){var t,r,a,n,i,c;return o(this,(function(o){switch(o.label){case 0:t=this.cube.meshes[this.cube.state.side],r=l.PropertyAnimation([{frame:0,value:s.quat.copy(t.armature.nodes[1].rotation,s.quat())},{frame:.4,value:s.quat.IDENTITY,ease:l.ease.quadInOut}],s.quat.slerp),a=e.prototype.close.call(this),n=this.context.currentTime,o.label=1;case 1:return i=this.context.currentTime-n,r(i,t.armature.nodes[1].rotation),(c=a.next()).done?[2,c.value]:[3,2];case 2:return[4,c.value];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return[2]}}))},t.prototype.findTarget=function(e){for(var t=[],r=this.cube.state.tile,a=this.context.get(y.TerrainSystem),n=.5*(e-1)*Math.PI,i=s.vec2(),o=-4;o<=4;o++)for(var l=-4;l<=4;l++){s.vec2.set(o,l,i);s.shortestAngle(n,s.vec2.rotation(i));s.vec2.magnitudeSquared(i),s.vec2.add(r,i,i),a.getTile(i[0],i[1])}for(;t.length<4;)t.push(s.vec2(r[0]+s.randomInt(-4,4,s.random),r[1]+s.randomInt(-4,4,s.random)));return t},t}(p.CubeSkill);t.ArtillerySkill=b},1640:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BeamSkill=void 0;var s=r(7594),l=r(6256),c=r(43),u=r(3335),f=r(9519),m=r(391),h=r(1160),d=r(9258),v=r(1515),p={"light.radius":f.PropertyAnimation([{frame:1,value:0},{frame:1.4,value:8,ease:f.ease.quadOut}],s.lerp),"light.intensity":f.PropertyAnimation([{frame:1,value:0},{frame:1.4,value:4,ease:f.ease.quadOut},{frame:3,value:0,ease:f.ease.quadIn}],s.lerp),"center.transform.scale":f.PropertyAnimation([{frame:1.2,value:s.vec3.ZERO},{frame:1.8,value:[8,8,8],ease:f.ease.cubicOut}],s.vec3.lerp),"center.color":f.PropertyAnimation([{frame:2.4,value:s.vec4.ONE},{frame:3,value:s.vec4.ZERO,ease:f.ease.quadIn}],s.vec4.lerp),"cone.transform.scale":f.PropertyAnimation([{frame:0,value:[6,0,6]},{frame:1,value:[3,3,3],ease:f.ease.quadOut},{frame:1.5,value:[0,6,0],ease:f.ease.cubicIn}],s.vec3.lerp),"cone.color":f.PropertyAnimation([{frame:0,value:[0,0,0,0]},{frame:1.2,value:[1,1,1,1],ease:f.ease.quadOut},{frame:1.4,value:[1,1,1,0],ease:f.ease.quadIn}],s.vec4.lerp),"cone.material.uniform.uniforms.uUVTransform.1":f.PropertyAnimation([{frame:.4,value:0},{frame:1.5,value:.0072*-255,ease:f.ease.quartIn},{frame:2,value:0,ease:f.ease.stepped}],s.lerp),"cone.material.uniform.uniforms.uUV2Transform.1":f.PropertyAnimation([{frame:.4,value:0},{frame:1.5,value:.0144*-255,ease:f.ease.quartIn},{frame:2,value:0,ease:f.ease.stepped}],s.lerp),"ring.transform.scale":f.PropertyAnimation([{frame:.8,value:[4,4,4]},{frame:1.1,value:[8,8,8],ease:f.ease.sineOut},{frame:1.4,value:[0,0,0],ease:f.ease.cubicIn}],s.vec3.lerp),"ring.color":f.PropertyAnimation([{frame:.8,value:[0,0,0,0]},{frame:1.1,value:[.1,.5,.6,.5],ease:f.ease.quadOut},{frame:1.4,value:[.5,1,1,0],ease:f.ease.sineIn}],s.vec4.lerp),"flash.transform.scale":f.PropertyAnimation([{frame:1.3,value:[0,0,0]},{frame:1.8,value:[10,10,10],ease:f.ease.cubicOut}],s.vec3.lerp),"flash.color":f.PropertyAnimation([{frame:1.3,value:[.7,1,1,0]},{frame:1.8,value:s.vec4.ZERO,ease:f.ease.quadIn}],s.vec4.lerp),"beam.width":f.PropertyAnimation([{frame:1.3,value:0},{frame:1.6,value:2,ease:f.ease.sineIn}],s.lerp),"beam.color":f.PropertyAnimation([{frame:2.4,value:s.vec4.ONE},{frame:3,value:s.vec4.ZERO,ease:f.ease.quadIn}],s.vec4.lerp)},y=function(e){function t(t,r){var a=e.call(this,t,r)||this;a._direction=s.vec3(),a.cone=new m.BatchMesh(d.SharedSystem.geometry.cone),a.cone.material=d.SharedSystem.materials.absorbTealMaterial,a.center=new m.Sprite,a.center.billboard=2,a.center.material=new c.SpriteMaterial,a.center.material.program=d.SharedSystem.materials.beamRadialProgram,s.vec2.set(8,4,a.center.material.uvTransform),a.center.material.diffuse=d.SharedSystem.gradients.tealBlue,a.beam=new m.Line,a.beam.path=[s.vec3(),s.vec3()],a.beam.material=new c.SpriteMaterial,a.beam.material.program=d.SharedSystem.materials.beamLinearProgram,s.vec2.set(4,8,a.beam.material.uvTransform),a.beam.material.diffuse=d.SharedSystem.gradients.tealBlue;var n=new c.SpriteMaterial;n.diffuse=d.SharedSystem.textures.ring,n.program=a.context.get(l.ParticleEffectPass).program;var i=new c.SpriteMaterial;return i.diffuse=d.SharedSystem.textures.rays,i.program=a.context.get(l.ParticleEffectPass).program,a.ring=new m.Sprite,a.ring.billboard=2,a.ring.material=n,a.flash=new m.Sprite,a.flash.billboard=2,a.flash.material=i,a}return n(t,e),t.prototype.clear=function(){this.smoke=void d.SharedSystem.particles.smoke.remove(this.smoke)},t.prototype.activate=function(e,t){var r,a,n,c,m,v,y,g,x;return o(this,(function(o){switch(o.label){case 0:r=s.vec3(.6,1.5,0),a=s.vec3(20,1.5,0),s.quat.transform(r,t,r),s.quat.transform(a,t,a),s.mat4.transform(r,e,r),s.mat4.transform(a,e,a),n=this.context.get(l.ParticleEffectPass),s.vec3.subtract(a,r,this._direction),this.cone.transform=this.context.get(u.TransformSystem).create(),s.vec3.copy(r,this.cone.transform.position),s.quat.rotation([0,-1,0],this._direction,this.cone.transform.rotation),this.center.transform=this.context.get(u.TransformSystem).create(),s.vec3.copy(r,this.center.transform.position),this.flash.transform=this.context.get(u.TransformSystem).create(),s.vec3.copy(r,this.flash.transform.position),this.ring.transform=this.context.get(u.TransformSystem).create(),s.vec3.copy(r,this.ring.transform.position),s.vec3.copy(r,this.beam.path[0]),this.light=this.context.get(l.PointLightPass).create(),this.light.transform=this.context.get(u.TransformSystem).create(),s.vec3.copy(r,this.light.transform.position),s.vec3.set(.5,1,1,this.light.color),n.add(this.cone,this.ring,this.flash,this.beam,this.center),this.energy=d.SharedSystem.particles.energy.add({uLifespan:[1,1.8,0,0],uOrigin:r,uRotation:s.vec2.ZERO,uGravity:s.vec3.ZERO,uSize:[.4,.8],uRadius:[8,12],uForce:s.vec2.ZERO,uTarget:r}),this.sparks=d.SharedSystem.particles.sparks.add({uLifespan:[.5,1,-.2,0],uOrigin:r,uLength:[.2,.4],uGravity:[0,-9.8,0],uSize:[.1,.4],uRadius:[.2,.5],uForce:[4,10],uTarget:r}),this.smoke=this.smoke||d.SharedSystem.particles.smoke.add({uOrigin:r,uLifespan:[1.6,2,-1,0],uRotation:[0,2*Math.PI],uGravity:[0,3.2,0],uSize:[1,3],uFieldDomain:s.vec4.ONE,uFieldStrength:s.vec2.ZERO}),c=this.cube.meshes[this.cube.state.side],m=h.modelAnimations[h.CubeModuleModel[this.cube.state.sides[this.cube.state.side].type]],v=f.AnimationTimeline(this,i(i({},p),{"beam.path.1":f.PropertyAnimation([{frame:1.3,value:r},{frame:1.6,value:a,ease:f.ease.cubicOut}],s.vec3.lerp),energy:f.EventTrigger([{frame:0,value:{amount:128,uOrigin:r,uTarget:r}}],f.EventTrigger.emitReset),sparks:f.EventTrigger([{frame:1.2,value:{amount:32,uOrigin:r,uTarget:r}}],f.EventTrigger.emitReset),smoke:f.EventTrigger([{frame:2.5,value:{amount:8,uOrigin:r}}],f.EventTrigger.emitReset)})),y=3,g=this.context.currentTime,o.label=1;case 1:return x=this.context.currentTime-g,v(x,this.context.deltaTime),m.activate(x,c.armature),x>y?[3,4]:[4,f.ActionSignal.WaitNextFrame];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:return d.SharedSystem.particles.energy.remove(this.energy),d.SharedSystem.particles.sparks.remove(this.sparks),n.remove(this.cone,this.ring,this.flash,this.beam,this.center),this.context.get(u.TransformSystem).delete(this.ring.transform),this.context.get(u.TransformSystem).delete(this.flash.transform),this.context.get(u.TransformSystem).delete(this.cone.transform),this.context.get(u.TransformSystem).delete(this.center.transform),this.context.get(u.TransformSystem).delete(this.light.transform),this.context.get(l.PointLightPass).delete(this.light),[2]}}))},t}(v.CubeSkill);t.BeamSkill=y},1515:function(e,t,r){"use strict";var a=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CubeSkill=void 0;var n=r(7594),i=r(9519),o=r(1160),s=function(){function e(e,t){this.context=e,this.cube=t}return Object.defineProperty(e.prototype,"direction",{get:function(){return n.mod(this.cube.state.direction+this.cube.state.sides[this.cube.state.side].direction,4)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this.cube.meshes[this.cube.state.side]},enumerable:!1,configurable:!0}),e.prototype.open=function(){var e,t,r,n,s,l;return a(this,(function(a){switch(a.label){case 0:if(!this.validate())return[2];e=this.cube.state.sides[this.cube.state.side],t=this.cube.meshes[this.cube.state.side],r=o.modelAnimations[o.CubeModuleModel[e.type]],n=.8,s=this.context.currentTime,a.label=1;case 1:return l=this.context.currentTime-s,r.open(l/n,t.armature),l>n?[3,4]:[4,i.ActionSignal.WaitNextFrame];case 2:a.sent(),a.label=3;case 3:return[3,1];case 4:return e.open=1,[2]}}))},e.prototype.close=function(){var e,t,r,n,s,l;return a(this,(function(a){switch(a.label){case 0:e=this.cube.state.sides[this.cube.state.side],t=this.cube.meshes[this.cube.state.side],r=o.modelAnimations[o.CubeModuleModel[e.type]],n=.8,s=this.context.currentTime,a.label=1;case 1:return l=this.context.currentTime-s,r.open(1-l/n,t.armature),l>n?[3,4]:[4,i.ActionSignal.WaitNextFrame];case 2:a.sent(),a.label=3;case 3:return[3,1];case 4:return e.open=0,this.clear(),[2]}}))},e.prototype.validate=function(){return!0},e.prototype.clear=function(){},e}();t.CubeSkill=s},8825:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.DeathSkill=void 0;var o=r(7594),s=r(9519),l=r(3335),c=r(391),u=r(43),f=r(6256),m=r(1160),h=r(9258),d=r(9040),v=function(e){function t(t,r){return e.call(this,t,r)||this}return n(t,e),t.prototype.open=function(){var e,t,r,a,n,v;return i(this,(function(i){switch(i.label){case 0:o.vec4.copy(o.vec4.ZERO,this.cube.meshes[this.cube.state.side].color),this.wreck=this.context.get(c.MeshSystem).loadModel(m.CubeModuleModel[1]),this.wreck.transform=this.cube.transform,e=this.cube.state.sides[this.cube.state.side],t=d.DirectionAngle[(this.cube.state.direction+e.direction)%4],o.quat.copy(t,this.wreck.armature.nodes[0].rotation),m.modelAnimations[m.CubeModuleModel[1]].close(0,this.wreck.armature),this.context.get(d.PlayerSystem).tilemap.renderSubstitute(this.wreck.material),this.spikes=h.SharedSystem.particles.spikes.add({uLifespan:[.5,1,-.1,0],uOrigin:o.vec3.add([0,.2,0],this.wreck.transform.position,o.vec3()),uTarget:this.wreck.transform.position,uGravity:o.vec3.ZERO,uRotation:o.vec2.ZERO,uFrame:[0,2],uSize:[1,4],uRadius:[.2,.4],uForce:[1,4]}),this.light=this.context.get(f.PointLightPass).create([1,.4,.6]),this.light.transform=this.context.get(l.TransformSystem).create([0,1,0],o.quat.IDENTITY,o.vec3.ONE,this.wreck.transform),this.wave=new c.Sprite,this.wave.billboard=0,this.wave.material=new u.SpriteMaterial,this.wave.material.blendMode=null,this.wave.material.program=h.SharedSystem.materials.distortion,this.wave.material.diffuse=h.SharedSystem.textures.ring,this.wave.transform=this.context.get(l.TransformSystem).create([0,1,0],c.Sprite.FlatUp,o.vec3.ONE,this.wreck.transform),this.context.get(f.PostEffectPass).add(this.wave),this.burn=this.context.get(f.DecalPass).create(4),this.burn.material=new u.DecalMaterial,this.burn.material.program=this.context.get(f.DecalPass).program,this.burn.material.diffuse=h.SharedSystem.textures.rays,this.burn.transform=this.context.get(l.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.wreck.transform),this.ring=new c.Sprite,this.ring.billboard=0,this.ring.material=new u.SpriteMaterial,this.ring.material.program=this.context.get(f.ParticleEffectPass).program,this.ring.material.diffuse=h.SharedSystem.textures.raysInner,this.ring.transform=this.context.get(l.TransformSystem).create([0,1,0],c.Sprite.FlatUp,o.vec3.ONE,this.wreck.transform),this.context.get(f.ParticleEffectPass).add(this.ring),this.debris=this.context.get(h.SharedSystem).debris.create(this.wreck.transform.position),r=s.AnimationTimeline(this,{"wreck.armature":(p=this.wreck.armature.nodes.slice(1).map((function(e,t){var r=o.vec3.copy(e.position,o.vec3()),a=o.quat.copy(e.rotation,o.quat()),n=o.vec3.subtract(r,[o.randomFloat(-.4,.4,o.random),o.randomFloat(-2,-1,o.random),o.randomFloat(-.4,.4,o.random)],o.vec3());o.vec3.normalize(n,n),o.vec3.scale(n,o.randomFloat(6,12,o.random),n);var i=o.vec3.subtract(o.vec3.AXIS_Y,r,o.vec3());return o.vec3.cross(i,n,i),{index:t+1,position:r,rotation:a,gravity:o.vec3(0,-30,0),velocity:n,angular:i}})),y=p.map((function(e){var t=e.gravity,r=e.velocity,a=e.position;return o.solveQuadratic(t[1],2*r[1],2*a[1])})),function(e,t){for(var r=p.length-1;r>=0;r--){var a=p[r],n=a.index,i=a.position,o=a.rotation,s=a.velocity,l=a.angular,c=a.gravity,u=Math.min(e,y[r]),f=t.nodes[n];f.position[0]=i[0]+u*s[0]+.5*u*u*c[0],f.position[1]=i[1]+u*s[1]+.5*u*u*c[1],f.position[2]=i[2]+u*s[2]+.5*u*u*c[2],f.rotation[0]=o[0]+.5*u*(l[0]*o[3]+l[1]*o[2]-l[2]*o[1]),f.rotation[1]=o[1]+.5*u*(l[1]*o[3]+l[2]*o[0]-l[0]*o[2]),f.rotation[2]=o[2]+.5*u*(l[2]*o[3]+l[0]*o[1]-l[1]*o[0]),f.rotation[3]=o[3]+.5*u*(-l[0]*o[0]-l[1]*o[1]-l[2]*o[2])}return t.frame=0,t}),"cube.light.intensity":s.PropertyAnimation([{frame:.2,value:1},{frame:.6,value:0,ease:s.ease.quadIn}],o.lerp),"debris.color":s.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.6,value:[0,0,0,.02],ease:s.ease.quadIn}],o.vec4.lerp),"wreck.color":s.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.8,value:[.2,.2,.2,.02],ease:s.ease.quadIn}],o.vec4.lerp),spikes:s.EventTrigger([{frame:0,value:36}],s.EventTrigger.emit),"light.radius":s.PropertyAnimation([{frame:0,value:0},{frame:.4,value:8,ease:s.ease.cubicOut}],o.lerp),"light.intensity":s.PropertyAnimation([{frame:0,value:10},{frame:.4,value:0,ease:s.ease.sineIn}],o.lerp),"wave.transform.scale":s.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.5,value:[12,12,12],ease:s.ease.cubicOut}],o.vec3.lerp),"wave.color":s.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.5,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp),"burn.transform.scale":s.PropertyAnimation([{frame:.2,value:o.vec3.ZERO},{frame:.6,value:[10,10,10],ease:s.ease.cubicOut}],o.vec3.lerp),"burn.color":s.PropertyAnimation([{frame:.2,value:[0,0,0,1]},{frame:1.2,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp),"ring.transform.scale":s.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.4,value:[6,6,6],ease:s.ease.quartOut}],o.vec3.lerp),"ring.color":s.PropertyAnimation([{frame:0,value:[1,.5,.6,.6]},{frame:.4,value:o.vec4.ZERO,ease:s.ease.sineIn}],o.vec4.lerp)}),a=1.2,n=this.context.currentTime,i.label=1;case 1:return v=this.context.currentTime-n,r(v,this.context.deltaTime),v>a?[3,4]:[4,s.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return this.context.get(h.SharedSystem).debris.delete(this.debris),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(l.TransformSystem).delete(this.burn.transform),this.context.get(l.TransformSystem).delete(this.wave.transform),this.context.get(l.TransformSystem).delete(this.light.transform),h.SharedSystem.particles.spikes.remove(this.spikes),this.context.get(f.PostEffectPass).remove(this.wave),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.DecalPass).delete(this.burn),this.context.get(c.MeshSystem).delete(this.wreck),[2]}var p,y}))},t.prototype.damage=function(){var e,t,r,a,n,m,d;return i(this,(function(i){switch(i.label){case 0:e=this.context.get(h.SharedSystem).debris.create(this.cube.transform.position),(t=new c.Sprite).billboard=0,t.material=new u.SpriteMaterial,t.material.program=this.context.get(f.ParticleEffectPass).program,t.material.diffuse=h.SharedSystem.textures.raysInner,t.transform=this.context.get(l.TransformSystem).create(o.vec3.AXIS_Y,c.Sprite.FlatUp,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(t),r=h.SharedSystem.particles.spikes.add({uLifespan:[.6,1,0,0],uOrigin:o.vec3.add([0,.5,0],this.cube.transform.position,o.vec3()),uTarget:this.cube.transform.position,uGravity:o.vec3.ZERO,uRotation:o.vec2.ZERO,uFrame:[0,2],uSize:[2,4],uRadius:[.2,.4],uForce:[1,4]}),a=s.AnimationTimeline({ring:t,spikes:r,debris:e},{"debris.transform.scale":s.PropertyAnimation([{frame:0,value:[1.4,1.4,1.4]}],o.vec3.lerp),"ring.transform.scale":s.PropertyAnimation([{frame:.2,value:o.vec3.ZERO},{frame:.7,value:[6,6,6],ease:s.ease.cubicOut}],o.vec3.lerp),"ring.color":s.PropertyAnimation([{frame:.2,value:[.8,.6,.8,.6]},{frame:.7,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp),spikes:s.EventTrigger([{frame:.2,value:8}],s.EventTrigger.emit)}),n=2,m=this.context.currentTime,i.label=1;case 1:return d=this.context.currentTime-m,a(d,this.context.deltaTime),d>n?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return h.SharedSystem.particles.spikes.remove(r),this.context.get(h.SharedSystem).debris.delete(e),this.context.get(l.TransformSystem).delete(t.transform),this.context.get(f.ParticleEffectPass).remove(t),[2]}}))},t}(r(1515).CubeSkill);t.DeathSkill=v},4202:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.DetonateSkill=void 0;var s=r(7594),l=r(556),c=r(8211),u=r(6256),f=r(43),m=r(391),h=r(3335),d=r(9519),v=r(1160),p=r(9258),y=r(1515),g=r(5583),x={dust:d.EventTrigger([{frame:1,value:48}],d.EventTrigger.emit),"light.radius":d.PropertyAnimation([{frame:1,value:0},{frame:1.5,value:8,ease:d.ease.cubicOut}],s.lerp),"light.intensity":d.PropertyAnimation([{frame:1,value:8},{frame:1.5,value:0,ease:d.ease.quadOut}],s.lerp),"stamp.transform.scale":d.PropertyAnimation([{frame:1,value:[10,4,10]}],s.vec3.lerp),"stamp.threshold":d.PropertyAnimation([{frame:.9,value:2.5},{frame:1.3,value:0,ease:d.ease.quadOut},{frame:2,value:-2.5,ease:d.ease.sineIn}],s.lerp),"tube.transform.scale":d.PropertyAnimation([{frame:0,value:[0,2,0]},{frame:1.2,value:[2.6,7,2.6],ease:d.ease.cubicOut}],s.vec3.lerp),"tube.color":d.PropertyAnimation([{frame:0,value:s.vec4.ONE},{frame:1.2,value:s.vec4.ZERO,ease:d.ease.quartIn}],s.vec4.lerp),"chargeX.transform.scale":d.PropertyAnimation([{frame:0,value:[12,2,2]}],s.vec3.lerp),"chargeY.transform.scale":d.PropertyAnimation([{frame:0,value:[12,2,2]}],s.vec3.lerp),"chargeX.threshold":d.PropertyAnimation([{frame:0,value:3},{frame:.7,value:0,ease:d.ease.sineIn},{frame:1.4,value:-3,ease:d.ease.sineOut}],s.lerp),"chargeY.threshold":d.PropertyAnimation([{frame:0,value:3},{frame:.7,value:0,ease:d.ease.sineIn},{frame:1.4,value:-3,ease:d.ease.sineOut}],s.lerp),"beam.transform.scale":d.PropertyAnimation([{frame:0,value:s.vec3.ZERO},{frame:.9,value:[2,7,1],ease:d.ease.sineIn}],s.vec3.lerp),"beam.color":d.PropertyAnimation([{frame:.9,value:[1,.5,.6,0]},{frame:1.4,value:s.vec4.ZERO,ease:d.ease.quadIn}],s.vec4.lerp)},b=function(e){function t(t,a){var n=e.call(this,t,a)||this;n.minefield=new g.Minefield(n.context);var i=t.get(f.MaterialSystem);return n.stampMaterial=new f.DecalMaterial,n.stampMaterial.blendMode=null,n.stampMaterial.program=l.ShaderProgram(n.context.gl,c.shaders.decal_vert,c.shaders.decal_frag,{INSTANCED:!0,ALPHA_CUTOFF:.01,NORMAL_MAPPING:!0,MASK:!0}),n.stampMaterial.program.uniforms.uLayer=1,n.stampMaterial.program.uniforms.uDissolveEdge=.1,n.stampMaterial.diffuse=i.addRenderTexture(i.createRenderTexture(512,512,1,{wrap:33071,mipmaps:0,format:32856}),0,l.ShaderProgram(t.gl,c.shaders.fullscreen_vert,r(1550),{}),{},0).target,n.stampMaterial.normal=i.addRenderTexture(i.createRenderTexture(512,512,1,{wrap:33071,mipmaps:0,format:32856}),0,l.ShaderProgram(t.gl,c.shaders.fullscreen_vert,r(1550),{NORMAL_MAP:!0}),{},0).target,n.tube=new m.BatchMesh(p.SharedSystem.geometry.cylinder),n.tube.material=p.SharedSystem.materials.stripesRedMaterial,n.beam=new m.Sprite,n.beam.billboard=3,s.vec2.set(0,.5,n.beam.origin),n.beam.material=new f.SpriteMaterial,n.beam.material.program=n.context.get(u.ParticleEffectPass).program,n.beam.material.diffuse=p.SharedSystem.textures.raysBeam,n}return n(t,e),t.prototype.activate=function(e,t){var r,a,n,l,c,f,m,y;return o(this,(function(e){switch(e.label){case 0:r=this.cube.meshes[this.cube.state.side],a=v.modelAnimations[v.CubeModuleModel[this.cube.state.sides[this.cube.state.side].type]],n=s.mat4.transform([0,0,0],this.cube.transform.matrix,s.vec3()),this.tube.transform=this.context.get(h.TransformSystem).create(),s.vec3.add(n,[0,3,0],this.tube.transform.position),this.context.get(u.ParticleEffectPass).add(this.tube),this.stamp=this.context.get(u.DecalPass).create(0),this.stamp.material=this.stampMaterial,this.stamp.transform=this.context.get(h.TransformSystem).create(),s.vec3.copy(n,this.stamp.transform.position),this.chargeX=this.context.get(u.DecalPass).create(0),this.chargeX.material=p.SharedSystem.materials.glowSquaresLinearMaterial,this.chargeX.transform=this.context.get(h.TransformSystem).create(),s.vec3.copy(n,this.chargeX.transform.position),this.chargeY=this.context.get(u.DecalPass).create(0),this.chargeY.material=p.SharedSystem.materials.glowSquaresLinearMaterial,this.chargeY.transform=this.context.get(h.TransformSystem).create(),s.vec3.copy(n,this.chargeY.transform.position),s.quat.axisAngle(s.vec3.AXIS_Y,.5*Math.PI,this.chargeY.transform.rotation),this.beam.transform=this.context.get(h.TransformSystem).create(),s.vec3.copy(n,this.beam.transform.position),this.context.get(u.ParticleEffectPass).add(this.beam),this.light=this.context.get(u.PointLightPass).create(),this.light.transform=this.context.get(h.TransformSystem).create(),s.vec3.add(n,[0,2,0],this.light.transform.position),s.vec3.set(1,0,.2,this.light.color),this.dust=p.SharedSystem.particles.dust.add({uOrigin:n,uOrientation:s.quat.IDENTITY,uLifespan:[.5,1,0,0],uSize:[3,6],uRadius:[.5,1],uForce:[6,12],uTarget:n,uGravity:[0,9.8,0],uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]}),l=d.AnimationTimeline(this,i({},x)),c=this.minefield.create(),f=2,m=this.context.currentTime,e.label=1;case 1:return y=this.context.currentTime-m,l(y,this.context.deltaTime),a.activate(y,r.armature),y>=1&&!c.enabled&&c.place(this.cube.state.tile[0],this.cube.state.tile[1]),y>f?[3,4]:[4,d.ActionSignal.WaitNextFrame];case 2:e.sent(),e.label=3;case 3:return[3,1];case 4:return this.context.get(h.TransformSystem).delete(this.chargeX.transform),this.context.get(h.TransformSystem).delete(this.chargeY.transform),this.context.get(h.TransformSystem).delete(this.light.transform),this.context.get(h.TransformSystem).delete(this.beam.transform),this.context.get(h.TransformSystem).delete(this.stamp.transform),this.context.get(h.TransformSystem).delete(this.tube.transform),this.context.get(u.DecalPass).delete(this.chargeX),this.context.get(u.DecalPass).delete(this.chargeY),this.context.get(u.DecalPass).delete(this.stamp),p.SharedSystem.particles.dust.remove(this.dust),this.context.get(u.PointLightPass).delete(this.light),this.context.get(u.ParticleEffectPass).remove(this.beam),this.context.get(u.ParticleEffectPass).remove(this.tube),[2]}}))},t}(y.CubeSkill);t.DetonateSkill=b},9641:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExtractSkill=void 0;var o=r(7594),s=r(9519),l=r(3335),c=r(391),u=r(43),f=r(6256),m=r(1160),h=r(9258),d=r(9040),v=r(1515),p=r(2392),y=r(4437),g={"cube.light.intensity":s.PropertyAnimation([{frame:.8,value:1},{frame:1.2,value:3,ease:s.ease.quadIn},{frame:1.6,value:1,ease:s.ease.sineOut}],o.lerp),"glow.transform.scale":s.PropertyAnimation([{frame:1,value:[1,0,1]},{frame:1.8,value:[1,4,1],ease:s.ease.quadOut}],o.vec3.lerp),"glow.color":s.PropertyAnimation([{frame:1,value:[.89,.93,.64,0]},{frame:1.8,value:o.vec4.ZERO,ease:s.ease.sineOut}],o.vec4.lerp),"ring.transform.scale":s.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1,value:[2,2,2],ease:s.ease.quadIn},{frame:1.6,value:[4,4,4],ease:s.ease.cubicOut}],o.vec3.lerp),"ring.color":s.PropertyAnimation([{frame:1,value:[.12,.1,.16,.8]},{frame:1.6,value:o.vec4.ZERO,ease:s.ease.sineIn}],o.vec4.lerp),"beam.transform.scale":s.PropertyAnimation([{frame:.2,value:[1,0,1]},{frame:.8,value:[1,4,1],ease:s.ease.quadOut}],o.vec3.lerp),"beam.color":s.PropertyAnimation([{frame:.8,value:[.89,.93,.64,0]},{frame:1,value:o.vec4.ZERO,ease:s.ease.sineIn}],o.vec4.lerp),"tube.transform.scale":s.PropertyAnimation([{frame:0,value:[4,-10,4]},{frame:.8,value:[2,-8,2],ease:s.ease.sineOut}],o.vec3.lerp),"tube.color":s.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:.8,value:[.4,1,.8,1],ease:s.ease.cubicOut},{frame:1.2,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp),"cracks.transform.scale":s.PropertyAnimation([{frame:0,value:[16,4,16]}],o.vec3.lerp),"cracks.threshold":s.PropertyAnimation([{frame:1,value:-3},{frame:1.4,value:0,ease:s.ease.quadOut},{frame:1.8,value:3,ease:s.ease.cubicIn}],o.lerp),"cracks.color":s.PropertyAnimation([{frame:1.2,value:[.92,.94,.74,0]},{frame:1.8,value:o.vec3.ZERO,ease:s.ease.sineIn}],o.vec4.lerp),"cracks.transform.rotation":s.EventTrigger([{frame:0,value:null}],(function(e){return o.quat.axisAngle(o.vec3.AXIS_Y,2*Math.PI*o.random(),e)})),"smoke.rate":s.PropertyAnimation([{frame:0,value:.05},{frame:.5,value:.01,ease:s.ease.quadIn},{frame:1,value:0,ease:s.ease.stepped}],o.lerp)},x=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.glow=new c.BatchMesh(h.SharedSystem.geometry.cross),a.glow.material=h.SharedSystem.materials.gradientMaterial,a.cracksMaterial=new u.DecalMaterial,a.cracksMaterial.program=a.context.get(f.DecalPass).program,a.cracksMaterial.diffuse=h.SharedSystem.textures.cracks,a.cracksMaterial.normal=h.SharedSystem.textures.cracksNormal,a.tube=new c.BatchMesh(h.SharedSystem.geometry.cylinder),a.tube.material=h.SharedSystem.materials.stripesRedMaterial,a.beam=new c.Sprite,a.beam.billboard=3,a.beam.material=new u.SpriteMaterial,a.beam.material.program=a.context.get(f.ParticleEffectPass).program,a.beam.material.diffuse=h.SharedSystem.textures.raysBeam,o.vec2.set(0,.5,a.beam.origin),a.ring=new c.Sprite,a.ring.billboard=0,a.ring.material=new u.SpriteMaterial,a.ring.material.program=a.context.get(f.ParticleEffectPass).program,a.ring.material.diffuse=h.SharedSystem.textures.ring,a}return n(t,e),t.prototype.open=function(){var t,r,a,n,l,c;return i(this,(function(i){switch(i.label){case 0:t=o.mat4.transform(o.vec3.ZERO,this.cube.transform.matrix,o.vec3()),r=s.EventTrigger([{frame:.6,value:{amount:36,uOrigin:t,uTarget:t}}],s.EventTrigger.emitReset),a=e.prototype.open.call(this),n=this.context.currentTime,i.label=1;case 1:return l=this.context.currentTime-n,r(l,this.context.deltaTime,this.cube.dust),(c=a.next()).done?[2,c.value]:[3,2];case 2:return[4,c.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return[2]}}))},t.prototype.close=function(){var t,r;return i(this,(function(a){switch(a.label){case 0:t=e.prototype.close.call(this),a.label=1;case 1:return(r=t.next()).done?[2,r.value]:[3,2];case 2:return[4,r.value];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:return[2]}}))},t.prototype.activate=function(){var e,t,r,a,n,c,u,d,v;return i(this,(function(i){switch(i.label){case 0:if(!(e=this.context.get(y.EconomySystem).get(this.cube.state.tile[0],this.cube.state.tile[1])))return[2];t=this.cube.meshes[this.cube.state.side],r=m.modelAnimations[m.CubeModuleModel[this.cube.state.sides[this.cube.state.side].type]],a=o.mat4.transform(o.vec3.ZERO,this.cube.transform.matrix,o.vec3()),this.cracks=this.context.get(f.DecalPass).create(0),this.cracks.material=this.cracksMaterial,this.cracks.transform=this.context.get(l.TransformSystem).create(),o.vec3.copy(a,this.cracks.transform.position),this.tube.transform=this.context.get(l.TransformSystem).create(),o.vec3.add([0,4,0],a,this.tube.transform.position),this.context.get(f.ParticleEffectPass).add(this.tube),this.beam.transform=this.context.get(l.TransformSystem).create(),o.vec3.add([0,4,0],a,this.beam.transform.position),this.context.get(f.ParticleEffectPass).add(this.beam),this.glow.transform=this.context.get(l.TransformSystem).create(),o.vec3.copy(a,this.glow.transform.position),this.context.get(f.ParticleEffectPass).add(this.glow),this.ring.transform=this.context.get(l.TransformSystem).create(),o.vec3.add([0,4,0],a,this.ring.transform.position),o.quat.axisAngle(o.vec3.AXIS_X,-.5*Math.PI,this.ring.transform.rotation),this.context.get(f.ParticleEffectPass).add(this.ring),this.smoke=this.smoke||h.SharedSystem.particles.smoke.add({uLifespan:[1,2,0,0],uOrigin:o.vec3.add([0,4,0],a,o.vec3()),uRotation:[0,2*Math.PI],uGravity:[0,5.6,0],uSize:[1,4],uFieldDomain:[.4,.4,.4,0],uFieldStrength:[4,0]}),n=s.AnimationTimeline(this,g),c=e.drain(2),u=2,d=this.context.currentTime,i.label=1;case 1:return v=this.context.currentTime-d,n(v,this.context.deltaTime),r.loop(v,t.armature),c.next(),v>u?[3,4]:[4,s.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return this.context.get(l.TransformSystem).delete(this.cracks.transform),this.context.get(l.TransformSystem).delete(this.tube.transform),this.context.get(l.TransformSystem).delete(this.beam.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(l.TransformSystem).delete(this.glow.transform),this.context.get(f.ParticleEffectPass).remove(this.tube),this.context.get(f.ParticleEffectPass).remove(this.beam),this.context.get(f.ParticleEffectPass).remove(this.glow),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.DecalPass).delete(this.cracks),[2]}}))},t.prototype.validate=function(){for(var e=this.context.get(p.TerrainSystem),t=this.cube.tile,r=d.DirectionTile.length-1;r>=0;r--)if(null!=e.getTile(t[0]+d.DirectionTile[r][0],t[1]+d.DirectionTile[r][1]))return!1;for(r=d.DirectionTile.length-1;r>=0;r--){var a=o.vec2.add(t,d.DirectionTile[r],o.vec2());e.setTile(a[0],a[1],this.cube),this.cube.tiles.push(a)}return!0},t.prototype.clear=function(){this.smoke=void h.SharedSystem.particles.smoke.remove(this.smoke);for(var e=this.context.get(p.TerrainSystem);this.cube.tiles.length>1;){var t=this.cube.tiles.pop();e.setTile(t[0],t[1],null)}},t}(v.CubeSkill);t.ExtractSkill=x},5583:function(e,t,r){"use strict";var a=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LandMine=t.Minefield=void 0;var n=r(7594),i=r(391),o=r(3335),s=r(9519),l=r(6256),c=r(43),u=r(9258),f=r(2392),m={"spark.transform.scale":s.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.2,value:[16,16,16],ease:s.ease.quintOut}],n.vec3.lerp),"spark.color":s.PropertyAnimation([{frame:0,value:[1,.8,.8,0]},{frame:.2,value:n.vec3.ZERO,ease:s.ease.sineIn}],n.vec4.lerp),"core.transform.scale":s.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.6,value:[4,4,4],ease:s.ease.quintOut}],n.vec3.lerp),"core.color":s.PropertyAnimation([{frame:.4,value:n.vec4.ONE},{frame:.6,value:n.vec4.ZERO,ease:s.ease.quadOut}],n.vec4.lerp),"ring.transform.scale":s.PropertyAnimation([{frame:0,value:[0,5,0]},{frame:.8,value:[10,5,10],ease:s.ease.quartOut}],n.vec3.lerp),"ring.color":s.PropertyAnimation([{frame:0,value:n.vec4.ONE},{frame:.8,value:[1,1,1,0],ease:s.ease.linear}],n.vec4.lerp),"light.radius":s.PropertyAnimation([{frame:0,value:0},{frame:.4,value:12,ease:s.ease.quintOut}],n.lerp),"light.intensity":s.PropertyAnimation([{frame:0,value:6},{frame:.4,value:0,ease:s.ease.sineIn}],n.lerp),"perimeter.transform.scale":s.PropertyAnimation([{frame:0,value:[0,4,0]},{frame:.5,value:[18,4,18],ease:s.ease.expoOut}],n.vec3.lerp),"perimeter.color":s.PropertyAnimation([{frame:0,value:[1,.8,.5,.5]},{frame:.5,value:[0,0,0,.5],ease:s.ease.cubicIn},{frame:2,value:n.vec4.ZERO,ease:s.ease.quadIn}],n.vec4.lerp),"wave.transform.scale":s.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.3,value:[20,20,20],ease:s.ease.quartOut}],n.vec3.lerp),"wave.color":s.PropertyAnimation([{frame:0,value:n.vec4.ONE},{frame:.3,value:n.vec4.ZERO,ease:s.ease.sineIn}],n.vec4.lerp),"burn.transform.scale":s.PropertyAnimation([{frame:0,value:[8,2,8]}],n.vec3.lerp),"burn.color":s.PropertyAnimation([{frame:0,value:n.vec4.ZERO},{frame:.8,value:[0,0,0,1],ease:s.ease.cubicIn},{frame:3,value:n.vec4.ZERO,ease:s.ease.quadIn}],n.vec4.lerp),smoke:s.EventTrigger([{frame:0,value:36}],s.EventTrigger.emit),particles:s.EventTrigger([{frame:0,value:64}],s.EventTrigger.emit)},h=function(){function e(e){this.context=e,this.pool=[],this.list=[],this.burnMaterial=new c.DecalMaterial,this.burnMaterial.diffuse=u.SharedSystem.textures.glow,this.perimeterMaterial=new c.DecalMaterial,this.perimeterMaterial.diffuse=u.SharedSystem.textures.raysRing,this.waveMaterial=new c.SpriteMaterial,this.waveMaterial.blendMode=null,this.waveMaterial.program=u.SharedSystem.materials.chromaticAberration,this.waveMaterial.diffuse=u.SharedSystem.textures.ring,this.sparkMaterial=new c.SpriteMaterial,this.sparkMaterial.program=this.context.get(l.ParticleEffectPass).program,this.sparkMaterial.diffuse=u.SharedSystem.textures.rays}return e.prototype.create=function(){var e=new d(this.context,this);return this.list.push(e),this.list.length>2&&this.list[0].activate(),e},e.prototype.activate=function(e){var t=this.list.indexOf(e);this.list.splice(t,1),this.context.get(s.AnimationSystem).start(this.detonate(e),!0)},e.prototype.createExplosion=function(){if(this.pool.length)return this.pool.pop();var e=new i.BatchMesh(u.SharedSystem.geometry.lowpolySphere);e.order=4,e.material=u.SharedSystem.materials.coreWhiteMaterial;var t=new i.Sprite;t.billboard=0,t.material=this.waveMaterial;var r=new i.BatchMesh(u.SharedSystem.geometry.cylinder);r.material=u.SharedSystem.materials.ringDustMaterial;var a=new i.Sprite;return a.billboard=2,a.material=this.sparkMaterial,{core:e,wave:t,ring:r,spark:a,light:null,burn:null,perimeter:null,particles:null,smoke:null}},e.prototype.detonate=function(e){var t,r,i,c,f,h;return a(this,(function(a){switch(a.label){case 0:t=n.mat4.transform(n.vec3.ZERO,e.mesh.transform.matrix,n.vec3()),e.kill(),(r=this.createExplosion()).core.transform=this.context.get(o.TransformSystem).create(),n.vec3.copy(t,r.core.transform.position),this.context.get(l.ParticleEffectPass).add(r.core),r.burn=this.context.get(l.DecalPass).create(0),r.burn.material=this.burnMaterial,r.burn.transform=this.context.get(o.TransformSystem).create(),n.vec3.copy(t,r.burn.transform.position),r.perimeter=this.context.get(l.DecalPass).create(0),r.perimeter.material=this.perimeterMaterial,r.perimeter.transform=this.context.get(o.TransformSystem).create(),n.vec3.copy(t,r.perimeter.transform.position),r.smoke=u.SharedSystem.particles.smoke.add({uLifespan:[1.5,2,-.5,0],uOrigin:n.vec3.add(t,[0,-.8,0],n.vec3()),uRotation:[0,2*Math.PI],uGravity:[0,4.8,0],uSize:[2,6],uFieldDomain:[.2,.2,.2,0],uFieldStrength:[8,0]}),r.particles=u.SharedSystem.particles.embers.add({uLifespan:[.6,.9,-.3,0],uOrigin:t,uRotation:n.vec2.ZERO,uGravity:n.vec3(0,3*-9.8,0),uSize:[.2,.8],uRadius:[.5,1],uOrientation:n.quat.IDENTITY,uForce:[14,28],uTarget:n.vec3.add(t,[0,-.5,0],n.vec3())}),r.light=this.context.get(l.PointLightPass).create(),r.light.transform=this.context.get(o.TransformSystem).create(),n.vec3.add(t,[0,2,0],r.light.transform.position),n.vec3.set(1,.5,.5,r.light.color),r.wave.transform=this.context.get(o.TransformSystem).create(),n.quat.axisAngle(n.vec3.AXIS_X,-.5*Math.PI,r.wave.transform.rotation),n.vec3.add(t,[0,2,0],r.wave.transform.position),this.context.get(l.PostEffectPass).add(r.wave),r.ring.transform=this.context.get(o.TransformSystem).create(),n.vec3.copy(t,r.ring.transform.position),this.context.get(l.ParticleEffectPass).add(r.ring),r.spark.transform=this.context.get(o.TransformSystem).create(),n.vec3.add(t,[0,1,0],r.spark.transform.position),this.context.get(l.ParticleEffectPass).add(r.spark),i=s.AnimationTimeline(r,m),c=3,f=this.context.currentTime,a.label=1;case 1:return h=this.context.currentTime-f,i(h,this.context.deltaTime),h>c?[3,4]:[4,s.ActionSignal.WaitNextFrame];case 2:a.sent(),a.label=3;case 3:return[3,1];case 4:return this.context.get(o.TransformSystem).delete(r.wave.transform),this.context.get(o.TransformSystem).delete(r.spark.transform),this.context.get(o.TransformSystem).delete(r.ring.transform),this.context.get(o.TransformSystem).delete(r.perimeter.transform),this.context.get(o.TransformSystem).delete(r.light.transform),this.context.get(o.TransformSystem).delete(r.core.transform),this.context.get(o.TransformSystem).delete(r.burn.transform),u.SharedSystem.particles.smoke.remove(r.smoke),u.SharedSystem.particles.embers.remove(r.particles),this.context.get(l.PostEffectPass).remove(r.wave),this.context.get(l.ParticleEffectPass).remove(r.spark),this.context.get(l.ParticleEffectPass).remove(r.core),this.context.get(l.ParticleEffectPass).remove(r.ring),this.context.get(l.PointLightPass).delete(r.light),this.context.get(l.DecalPass).delete(r.burn),this.context.get(l.DecalPass).delete(r.perimeter),this.pool.push(r),[2]}}))},e}();t.Minefield=h;var d=function(){function e(e,t){this.context=e,this.parent=t,this.tile=n.vec2()}return Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.mesh},enumerable:!1,configurable:!0}),e.prototype.place=function(e,t){n.vec2.set(e,t,this.tile),this.mesh=this.context.get(i.MeshSystem).loadModel("mine"),this.mesh.transform=this.context.get(o.TransformSystem).create(),this.context.get(f.TerrainSystem).tilePosition(e,t,this.mesh.transform.position)},e.prototype.kill=function(){this.context.get(o.TransformSystem).delete(this.mesh.transform),this.context.get(i.MeshSystem).delete(this.mesh),this.mesh=null},e.prototype.activate=function(){this.parent.activate(this)},e}();t.LandMine=d},4244:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrbSkill=void 0;var o=r(7594),s=r(6240),l=r(9519),c=r(3335),u=r(391),f=r(43),m=r(6256),h=r(1160),d=r(9258),v=r(9040),p=r(1515),y=r(2392),g={particles:l.EventTrigger([{frame:.2,value:48}],l.EventTrigger.emit),"cone.transform.scale":l.PropertyAnimation([{frame:0,value:[.2,.2,1]},{frame:.6,value:o.vec3.ONE,ease:l.ease.sineOut},{frame:.8,value:[0,0,2],ease:l.ease.quartIn}],o.vec3.lerp),"cone.color":l.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:.6,value:o.vec4.ONE,ease:l.ease.quadOut},{frame:.8,value:[1,0,1,0],ease:l.ease.cubicIn}],o.vec4.lerp),"glow.transform.position":l.PropertyAnimation([{frame:0,value:[0,0,-3]}],o.vec3.lerp),"glow.transform.scale":l.PropertyAnimation([{frame:.5,value:o.vec3.ZERO},{frame:.8,value:[8,8,8],ease:l.ease.quartOut}],o.vec3.lerp),"glow.color":l.PropertyAnimation([{frame:.5,value:[.7,1,.9,0]},{frame:.8,value:o.vec4.ZERO,ease:l.ease.quadIn}],o.vec4.lerp),"ring.transform.scale":l.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.7,value:[6,6,6],ease:l.ease.quadIn},{frame:1.6,value:[12,12,12],ease:l.ease.cubicOut}],o.vec3.lerp),"ring.transform.position":l.PropertyAnimation([{frame:0,value:[0,0,-1]},{frame:1.6,value:[0,0,-3],ease:l.ease.quartOut}],o.vec3.lerp),"ring.transform.rotation":l.PropertyAnimation([{frame:0,value:[0,0,0,1]},{frame:.8,value:[0,0,-1,0],ease:l.ease.quadIn},{frame:1.6,value:[0,0,0,-1],ease:l.ease.quadOut}],o.quat.slerp),"ring.color":l.PropertyAnimation([{frame:.8,value:[.6,1,.9,0]},{frame:1.6,value:o.vec4.ZERO,ease:l.ease.sineOut}],o.vec4.lerp),"sphere.transform.position":l.PropertyAnimation([{frame:0,value:[0,0,-2]},{frame:.7,value:[0,0,-2.8],ease:l.ease.quadInOut}],o.vec3.lerp),"sphere.transform.scale":l.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.7,value:[2,2,2],ease:l.ease.quadIn},{frame:1,value:[0,3,0],ease:l.ease.cubicIn}],o.vec3.lerp),"distortion.transform.scale":l.PropertyAnimation([{frame:.7,value:[16,16,16]},{frame:.9,value:o.vec3.ZERO,ease:l.ease.cubicIn}],o.vec3.lerp),"distortion.color":l.PropertyAnimation([{frame:.7,value:o.vec4.ZERO},{frame:.9,value:[1,1,.5,.5],ease:l.ease.sineOut}],o.vec4.lerp)},x=function(){function e(e,t){this.context=e,this.parent=t,this.tile=o.vec2()}return Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.orb},enumerable:!1,configurable:!0}),e.prototype.place=function(e,t){o.vec2.set(e,t,this.tile),this.transform=this.context.get(c.TransformSystem).create(),this.context.get(y.TerrainSystem).tilePosition(e,t,this.transform.position),this.transform.position[1]+=1,this.decal=this.context.get(m.DecalPass).create(8),this.decal.material=d.SharedSystem.materials.corrosionMaterial,this.decal.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ZERO,this.transform),this.orb=new u.Mesh,this.orb.buffer=d.SharedSystem.geometry.sphereMesh,this.orb.order=3,this.orb.layer=3,this.context.get(u.MeshSystem).list.push(this.orb),this.orb.material=d.SharedSystem.materials.orbMaterial,this.orb.transform=this.context.get(c.TransformSystem).create(),this.orb.transform.parent=this.transform,this.aura=new u.Sprite,this.aura.order=4,this.aura.billboard=2,this.aura.material=d.SharedSystem.materials.auraTealMaterial,this.aura.transform=this.context.get(c.TransformSystem).create(),this.aura.transform.parent=this.transform,this.context.get(m.ParticleEffectPass).add(this.aura),this.fire=d.SharedSystem.particles.fire.add({uLifespan:o.vec4(.8,1,0,0),uOrigin:this.transform.position,uRotation:o.vec2.ZERO,uGravity:o.vec3.ZERO,uSize:o.vec2(1,3),uRadius:o.vec2(.8,1.2)})},e.prototype.kill=function(){this.context.get(c.TransformSystem).delete(this.transform),this.context.get(c.TransformSystem).delete(this.aura.transform),this.context.get(c.TransformSystem).delete(this.orb.transform),this.context.get(c.TransformSystem).delete(this.decal.transform),this.context.get(m.DecalPass).delete(this.decal),this.orb=this.aura=null,d.SharedSystem.particles.fire.remove(this.fire)},e.prototype.appear=function(e){var t,r,a,n;return i(this,(function(i){switch(i.label){case 0:t=l.AnimationTimeline(this,{"decal.transform.scale":l.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[8,8,8],ease:l.ease.quadOut}],o.vec3.lerp),"aura.transform.parent.position":l.PropertyAnimation([{frame:0,value:e},{frame:1,value:o.vec3.copy(this.aura.transform.parent.position,o.vec3()),ease:l.ease.sineInOut}],o.vec3.lerp),"aura.transform.scale":l.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[4,4,4],ease:l.ease.elasticOut(1,.5)}],o.vec3.lerp),"orb.transform.scale":l.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[1,1,1],ease:l.ease.elasticOut(1,.8)}],o.vec3.lerp)}),this.fire.rate=.36,r=1,a=this.context.currentTime,i.label=1;case 1:return n=this.context.currentTime-a,t(n,this.context.deltaTime),n>r?[3,4]:[4,l.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return[2]}}))},e.prototype.dissolve=function(){var e,t,r,a,n;return i(this,(function(i){switch(i.label){case 0:this.fire.rate=0,e=l.AnimationTimeline(this,{"decal.color":l.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:1,value:[1,1,1,0],ease:l.ease.sineOut}],o.vec4.lerp),"aura.color":l.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:1,value:o.vec4.ZERO,ease:l.ease.sineOut}],o.vec4.lerp),"orb.color":l.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:1,value:o.vec4.ZERO,ease:l.ease.quadIn}],o.vec4.lerp)}),t=1,r=this.context.currentTime,i.label=1;case 1:return a=this.context.currentTime-r,e(a,this.context.deltaTime),a>t?[3,4]:[4,l.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return this.kill(),n=this.parent.list.indexOf(this),this.parent.list.splice(n,1),this.parent.pool.push(this),[2]}}))},e}(),b=function(e){function t(t,r){var a=e.call(this,t,r)||this;a.pool=[],a.list=[];var n=s.createCylinder({radiusTop:.5,radiusBottom:4,height:4,horizontal:8,radial:8,cap:!1,angleStart:0,angleLength:2*Math.PI}),i=o.quat();return s.modifyGeometry(n,(function(e,t){var r=1.6*Math.PI*l.ease.circIn(.5+e[1]/4);o.quat.axisAngle(o.vec3.AXIS_Y,r,i),o.quat.transform(e,i,e),o.quat.transform(t,i,t)})),s.applyTransform(n,o.mat4.fromRotationTranslationScale(u.Sprite.FlatUp,o.vec3(0,0,-2),o.vec3.ONE,o.mat4())),a.cone=new u.BatchMesh(s.doubleSided(n)),a.cone.material=d.SharedSystem.materials.coneTealMaterial,a.glow=new u.Sprite,a.glow.order=-8,a.glow.billboard=2,a.glow.material=new f.SpriteMaterial,a.glow.material.cullFace=0,a.glow.material.program=a.context.get(m.ParticleEffectPass).program,a.glow.material.diffuse=d.SharedSystem.textures.sparkle,a.ring=new u.Sprite,a.ring.billboard=0,a.ring.material=new f.SpriteMaterial,a.ring.material.cullFace=0,a.ring.material.program=a.context.get(m.ParticleEffectPass).program,a.ring.material.diffuse=d.SharedSystem.textures.swirl,a.sphere=new u.BatchMesh(d.SharedSystem.geometry.lowpolySphere),a.sphere.material=d.SharedSystem.materials.coneTealMaterial,a.distortion=new u.Sprite,a.distortion.billboard=0,a.distortion.material=new f.SpriteMaterial,a.distortion.material.cullFace=0,a.distortion.material.blendMode=null,a.distortion.material.program=d.SharedSystem.materials.chromaticAberration,a.distortion.material.diffuse=d.SharedSystem.textures.wave,a}return n(t,e),t.prototype.activate=function(e,t){var r,a,n,s,u,f,p,y,b,S,P,w;return i(this,(function(e){switch(e.label){case 0:r=this.cube.meshes[this.cube.state.side],a=h.modelAnimations[h.CubeModuleModel[this.cube.state.sides[this.cube.state.side].type]],n=o.mat4.transform([0,1,0],this.cube.transform.matrix,o.vec3()),s=this.context.get(c.TransformSystem).create(),o.vec3.copy(n,s.position),o.quat.copy(v.DirectionAngle[o.mod(this.direction+3,4)],s.rotation),u=o.quat.transform([0,1,-3],s.rotation,o.vec3()),o.mat4.transform(u,this.cube.transform.matrix,u),this.cone.transform=this.context.get(c.TransformSystem).create(),this.cone.transform.parent=s,this.context.get(m.ParticleEffectPass).add(this.cone),this.sphere.transform=this.context.get(c.TransformSystem).create(),this.sphere.transform.parent=s,o.quat.axisAngle(o.vec3.AXIS_X,.5*Math.PI,this.sphere.transform.rotation),this.context.get(m.ParticleEffectPass).add(this.sphere),this.glow.transform=this.context.get(c.TransformSystem).create(),this.glow.transform.parent=s,this.context.get(m.ParticleEffectPass).add(this.glow),this.ring.transform=this.context.get(c.TransformSystem).create(),this.ring.transform.parent=s,this.context.get(m.ParticleEffectPass).add(this.ring),this.distortion.transform=this.context.get(c.TransformSystem).create(),this.distortion.transform.parent=s,o.vec3.set(0,0,-2,this.distortion.transform.position),this.context.get(m.PostEffectPass).add(this.distortion),f=o.quat.transform([0,-.2,.5],s.rotation,o.vec3()),o.vec3.add(n,f,f),this.particles=d.SharedSystem.particles.sparks.add({uLifespan:[.5,.8,-.5,0],uOrigin:n,uLength:[.2,.5],uGravity:o.quat.transform([0,0,10],s.rotation,o.vec3()),uSize:[.2,.8],uRadius:[0,.5],uForce:[6,10],uTarget:f}),p=l.AnimationTimeline(this,g),y=this.pool.pop()||new x(this.context,this),b=[o.vec2(0,-2),o.vec2(-2,0),o.vec2(0,2),o.vec2(2,0)][this.direction],o.vec2.add(this.cube.state.tile,b,b),this.list.length>0&&this.context.get(l.AnimationSystem).start(this.list[0].dissolve(),!0),S=1.6,P=this.context.currentTime,e.label=1;case 1:return w=this.context.currentTime-P,p(w,this.context.deltaTime),a.activate(w,r.armature),w>.8&&!y.enabled&&(this.list.push(y),y.place(b[0],b[1]),this.context.get(l.AnimationSystem).start(y.appear(u),!0)),w>S?[3,4]:[4,l.ActionSignal.WaitNextFrame];case 2:e.sent(),e.label=3;case 3:return[3,1];case 4:return this.context.get(c.TransformSystem).delete(s),this.context.get(c.TransformSystem).delete(this.cone.transform),this.context.get(c.TransformSystem).delete(this.glow.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.sphere.transform),this.context.get(c.TransformSystem).delete(this.distortion.transform),this.context.get(m.ParticleEffectPass).remove(this.cone),this.context.get(m.ParticleEffectPass).remove(this.glow),this.context.get(m.ParticleEffectPass).remove(this.ring),this.context.get(m.ParticleEffectPass).remove(this.sphere),this.context.get(m.PostEffectPass).remove(this.distortion),d.SharedSystem.particles.bolts.remove(this.particles),[2]}}))},t}(p.CubeSkill);t.OrbSkill=b},2162:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectileSkill=void 0;var o=r(7594),s=r(391),l=r(43),c=r(6256),u=r(3335),f=r(9519),m=r(1160),h=r(9040),d=r(1515),v=r(9258),p=r(2392),y={particles:f.EventTrigger([{frame:0,value:36}],f.EventTrigger.emit),"bulge.transform.scale":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.5,value:[3,3,3],ease:f.ease.quartOut}],o.vec3.lerp),"bulge.color":f.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.5,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"flash.transform.scale":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.5,value:[4,4,4],ease:f.ease.cubicOut}],o.vec3.lerp),"flash.color":f.PropertyAnimation([{frame:.2,value:o.vec4.ONE},{frame:.5,value:[1,1,1,.2],ease:f.ease.sineIn}],o.vec4.lerp),"core.transform.scale":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.1,value:[4,4,4],ease:f.ease.cubicIn},{frame:.3,value:o.vec3.ZERO,ease:f.ease.quadOut}],o.vec3.lerp),"core.color":f.PropertyAnimation([{frame:0,value:[1,1,.8,0]},{frame:.3,value:[.6,.6,0,0],ease:f.ease.quadIn}],o.vec4.lerp),"light.radius":f.PropertyAnimation([{frame:0,value:0},{frame:.5,value:5,ease:f.ease.quartOut}],o.lerp),"light.intensity":f.PropertyAnimation([{frame:0,value:0},{frame:.1,value:4,ease:f.ease.quadIn},{frame:.5,value:0,ease:f.ease.cubicOut}],o.lerp)},g=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.pool=[],a.pivot=o.vec3(0,1.8,0),a.trailMaterial=new l.SpriteMaterial,a.trailMaterial.program=a.context.get(c.ParticleEffectPass).program,a.trailMaterial.diffuse=v.SharedSystem.gradients.yellowLine,a.glowMaterial=new l.SpriteMaterial,a.glowMaterial.diffuse=v.SharedSystem.textures.raysRing,a.glowMaterial.program=a.context.get(c.ParticleEffectPass).program,a.burnMaterial=new l.DecalMaterial,a.burnMaterial.program=a.context.get(c.DecalPass).program,a.burnMaterial.diffuse=v.SharedSystem.textures.particle,a.waveMaterial=new l.SpriteMaterial,a.waveMaterial.blendMode=null,a.waveMaterial.program=v.SharedSystem.materials.distortion,a.waveMaterial.diffuse=v.SharedSystem.textures.wave,a.bulge=new s.Sprite,a.bulge.billboard=2,a.bulge.material=new l.SpriteMaterial,a.bulge.material.blendMode=null,a.bulge.material.program=v.SharedSystem.materials.chromaticAberration,a.bulge.material.diffuse=v.SharedSystem.textures.particle,a.core=new s.Sprite,a.core.billboard=2,a.core.material=new l.SpriteMaterial,a.core.material.program=a.context.get(c.ParticleEffectPass).program,a.core.material.diffuse=v.SharedSystem.textures.rays,a.flash=new s.Sprite,a.flash.billboard=0,a.flash.material=v.SharedSystem.materials.flashYellowMaterial,a}return n(t,e),t.prototype.activate=function(e,t,r){var a,n,s,l,d,p,g,x,b,S,P,w;return i(this,(function(e){switch(e.label){case 0:if(a=m.modelAnimations[m.CubeModuleModel[this.cube.state.sides[this.cube.state.side].type]],n=o.mod(r-this.cube.state.direction-this.cube.state.sides[this.cube.state.side].direction,4),s=o.mat4.fromRotationTranslationScale(h.DirectionAngle[(r+3)%4],this.pivot,o.vec3.ONE,o.mat4()),o.mat4.multiply(this.cube.transform.matrix,s,s),l=o.vec3(0,0,1.2),o.mat4.transform(l,s,l),d=o.quat.copy(this.mesh.armature.nodes[1].rotation,o.quat()),p=h.DirectionAngle[(n+1)%4],o.quat.angle(d,p)<.001)return[3,4];g=f.PropertyAnimation([{frame:0,value:d},{frame:.2,value:p,ease:f.ease.quadInOut}],o.quat.slerp),S=.2,P=this.context.currentTime,e.label=1;case 1:return w=this.context.currentTime-P,g(w,this.mesh.armature.nodes[1].rotation),this.mesh.armature.frame=0,w>S?[3,4]:[4,f.ActionSignal.WaitNextFrame];case 2:e.sent(),e.label=3;case 3:return[3,1];case 4:x=this.context.get(u.TransformSystem).create(),o.quat.copy(h.DirectionAngle[(r+3)%4],x.rotation),o.vec3.copy(l,x.position),this.bulge.transform=this.context.get(u.TransformSystem).create(),o.vec3.copy(l,this.bulge.transform.position),this.context.get(c.PostEffectPass).add(this.bulge),this.core.transform=this.context.get(u.TransformSystem).create(),o.vec3.copy(l,this.core.transform.position),this.context.get(c.ParticleEffectPass).add(this.core),this.flash.transform=this.context.get(u.TransformSystem).create(),this.flash.transform.parent=x,this.context.get(c.ParticleEffectPass).add(this.flash),this.light=this.context.get(c.PointLightPass).create(),this.light.transform=x,o.vec3.set(1,.9,.5,this.light.color),this.particles=v.SharedSystem.particles.embers.add({uLifespan:[.1,.4,-.1,0],uOrigin:o.mat4.transform([0,0,2],s,o.vec3()),uRotation:o.vec2.ZERO,uGravity:o.vec3.ZERO,uSize:[.1,.6],uRadius:[0,.4],uOrientation:o.quat.axisAngle(o.quat.transform(o.vec3.AXIS_Z,h.DirectionAngle[r],o.vec3()),.5*Math.PI,o.quat()),uForce:[8,16],uTarget:o.mat4.transform(o.vec3.ZERO,s,o.vec3())}),b=f.AnimationTimeline(this,y),this.context.get(f.AnimationSystem).start(this.animateProjectile(s,this.findTarget(r)),!0),S=.5,P=this.context.currentTime,e.label=5;case 5:return w=this.context.currentTime-P,b(w,this.context.deltaTime),a.activate(w,this.mesh.armature),a["activate"+n](w,this.mesh.armature),w>S?[3,8]:[4,f.ActionSignal.WaitNextFrame];case 6:e.sent(),e.label=7;case 7:return[3,5];case 8:return v.SharedSystem.particles.embers.remove(this.particles),this.context.get(u.TransformSystem).delete(x),this.context.get(u.TransformSystem).delete(this.bulge.transform),this.context.get(u.TransformSystem).delete(this.core.transform),this.context.get(u.TransformSystem).delete(this.flash.transform),this.context.get(c.PointLightPass).delete(this.light),this.context.get(c.ParticleEffectPass).remove(this.core),this.context.get(c.ParticleEffectPass).remove(this.flash),this.context.get(c.PostEffectPass).remove(this.bulge),[2]}}))},t.prototype.createProjectile=function(){if(this.pool.length)return this.pool.pop();var e=new s.Line;e.order=-2,e.width=.4,e.ease=function(e){return 1-e*e},e.path=o.range(8).map((function(e){return o.vec3()})),e.addColorFade(e.ease),e.material=this.trailMaterial;var t=new s.BatchMesh(v.SharedSystem.geometry.lowpolySphere);t.order=8,t.material=v.SharedSystem.materials.coreYellowMaterial;var r=new s.Sprite;r.billboard=0,r.material=this.glowMaterial;var a=new s.Sprite;return a.billboard=0,a.material=this.waveMaterial,{trail:e,sphere:t,wave:a,glow:r,origin:o.vec3(),transform:null,particles:null,light:null,burn:null}},t.prototype.animateProjectile=function(e,t){var r,a,n,s,l,m,h,d;return i(this,(function(i){switch(i.label){case 0:for(r=this.createProjectile(),a=o.mat4.transform(o.vec3.ZERO,e,r.origin),r.transform=this.context.get(u.TransformSystem).create(),o.vec3.copy(a,r.transform.position),n=r.trail.path.length-1;n>=0;n--)o.vec3.copy(a,r.trail.path[n]);this.context.get(c.ParticleEffectPass).add(r.trail),r.sphere.transform=this.context.get(u.TransformSystem).create(),o.vec3.copy(t,r.sphere.transform.position),this.context.get(c.ParticleEffectPass).add(r.sphere),r.glow.transform=this.context.get(u.TransformSystem).create(),o.vec3.copy(t,r.glow.transform.position),o.quat.axisAngle(o.vec3.AXIS_X,-.5*Math.PI,r.glow.transform.rotation),this.context.get(c.ParticleEffectPass).add(r.glow),r.burn=this.context.get(c.DecalPass).create(0),r.burn.material=this.burnMaterial,r.burn.transform=this.context.get(u.TransformSystem).create(),o.vec3.copy(t,r.burn.transform.position),r.wave.transform=this.context.get(u.TransformSystem).create(),o.vec3.copy(t,r.wave.transform.position),o.quat.axisAngle(o.vec3.AXIS_X,-.5*Math.PI,r.wave.transform.rotation),this.context.get(c.PostEffectPass).add(r.wave),r.light=this.context.get(c.PointLightPass).create(),r.light.transform=this.context.get(u.TransformSystem).create(),o.vec3.add(t,[0,.5,0],r.light.transform.position),o.vec3.set(1,.9,.5,r.light.color),r.particles=v.SharedSystem.particles.embers.add({uLifespan:[.2,.4,-.2,0],uOrigin:t,uRotation:o.vec2.ZERO,uGravity:o.vec3(0,-19.6,0),uSize:[.2,.6],uRadius:[.2,.5],uOrientation:o.quat.IDENTITY,uForce:[8,16],uTarget:o.vec3.add(t,[0,-.2,0],o.vec3())}),s=.05*Math.sqrt(o.vec3.distanceSquared(a,t))/2,l=f.AnimationTimeline(r,{particles:f.EventTrigger([{frame:s,value:72}],f.EventTrigger.emit),trail:f.FollowPath.Line(f.FollowPath.separate(f.PropertyAnimation([{frame:0,value:a[0]},{frame:s,value:t[0],ease:f.ease.linear}],o.lerp),f.PropertyAnimation([{frame:0,value:a[1]},{frame:s,value:t[1],ease:f.ease.cubicIn}],o.lerp),f.PropertyAnimation([{frame:0,value:a[2]},{frame:s,value:t[2],ease:f.ease.linear}],o.lerp)),{length:.06}),"transform.position.1":f.PropertyAnimation([{frame:0,value:a[1]},{frame:s,value:t[1],ease:f.ease.cubicIn}],o.lerp),"transform.position":f.PropertyAnimation([{frame:0,value:a},{frame:s,value:t,ease:f.ease.linear}],o.vec3.lerp),"sphere.color":f.PropertyAnimation([{frame:s+.1,value:o.vec4.ONE},{frame:s+.6,value:o.vec4.ZERO,ease:f.ease.cubicIn}],o.vec4.lerp),"sphere.transform.scale":f.PropertyAnimation([{frame:s+.1,value:o.vec3.ZERO},{frame:s+.6,value:[1.8,1.8,1.8],ease:f.ease.cubicOut}],o.vec3.lerp),"glow.color":f.PropertyAnimation([{frame:s,value:[1,.9,.6,0]},{frame:s+.3,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"glow.transform.scale":f.PropertyAnimation([{frame:s,value:o.vec3.ZERO},{frame:s+.3,value:[8,8,8],ease:f.ease.quartOut}],o.vec3.lerp),"burn.transform.scale":f.PropertyAnimation([{frame:s,value:o.vec3.ZERO},{frame:s+.1,value:[8,4,8],ease:f.ease.cubicOut}],o.vec3.lerp),"burn.color":f.PropertyAnimation([{frame:s+1,value:[0,0,0,1]},{frame:s+2,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"light.radius":f.PropertyAnimation([{frame:s,value:0},{frame:s+.3,value:4,ease:f.ease.cubicOut}],o.lerp),"light.intensity":f.PropertyAnimation([{frame:s,value:8},{frame:s+.3,value:0,ease:f.ease.sineIn}],o.lerp),"wave.transform.scale":f.PropertyAnimation([{frame:s+.1,value:o.vec3.ZERO},{frame:s+.4,value:[8,8,8],ease:f.ease.quartOut}],o.vec3.lerp),"wave.color":f.PropertyAnimation([{frame:s+.1,value:[1,1,1,.4]},{frame:s+.4,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp)}),m=2+s,h=this.context.currentTime,i.label=1;case 1:return d=this.context.currentTime-h,l(d,this.context.deltaTime),d>m?[3,4]:[4,f.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return this.context.get(u.TransformSystem).delete(r.transform),this.context.get(u.TransformSystem).delete(r.glow.transform),this.context.get(u.TransformSystem).delete(r.burn.transform),this.context.get(u.TransformSystem).delete(r.light.transform),this.context.get(u.TransformSystem).delete(r.sphere.transform),this.context.get(u.TransformSystem).delete(r.wave.transform),v.SharedSystem.particles.embers.remove(r.particles),this.context.get(c.PointLightPass).delete(r.light),this.context.get(c.ParticleEffectPass).remove(r.sphere),this.context.get(c.ParticleEffectPass).remove(r.glow),this.context.get(c.ParticleEffectPass).remove(r.trail),this.context.get(c.DecalPass).delete(r.burn),this.context.get(c.PostEffectPass).remove(r.wave),this.pool.push(r),[2]}}))},t.prototype.findTarget=function(e){for(var t,r=this.cube.state.tile,a=this.context.get(p.TerrainSystem),n=(t={},t[0]=[0,1],t[1]=[1,0],t[2]=[0,-1],t[3]=[-1,0],t)[e],i=o.vec2(),s=1;s<=4;s++)if(o.vec2.scale(n,s,i),o.vec2.add(r,i,i),null!=a.getTile(i[0],i[1]))return a.tilePosition(i[0],i[1],o.vec3());return a.tilePosition(i[0],i[1],o.vec3())},t}(d.CubeSkill);t.ProjectileSkill=g},4617:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.RestoreSkill=void 0;var o=r(7594),s=r(9519),l=r(3335),c=r(391),u=r(43),f=r(6256),m=r(1160),h=r(9258),d=r(9040),v=r(1515),p=r(2392),y={"tubeX.transform.scale":s.PropertyAnimation([{frame:.3,value:[0,6,0]},{frame:1,value:[1.4,6,1.4],ease:s.ease.cubicOut}],o.vec3.lerp),"tubeZ.transform.scale":s.PropertyAnimation([{frame:.3,value:[0,6,0]},{frame:1,value:[1.4,6,1.4],ease:s.ease.cubicOut}],o.vec3.lerp),"tubeX.color":s.PropertyAnimation([{frame:.3,value:[1,0,0,1]},{frame:.6,value:o.vec4.ONE,ease:s.ease.sineIn}],o.vec4.lerp),"tubeZ.color":s.PropertyAnimation([{frame:.3,value:[1,0,0,1]},{frame:.6,value:o.vec4.ONE,ease:s.ease.sineIn}],o.vec4.lerp),"light.radius":s.PropertyAnimation([{frame:.5,value:0},{frame:.8,value:8,ease:s.ease.quartOut}],o.lerp),"light.intensity":s.PropertyAnimation([{frame:.5,value:8},{frame:.8,value:1,ease:s.ease.sineIn}],o.lerp),"bolts.rate":s.PropertyAnimation([{frame:0,value:0},{frame:.5,value:.02,ease:s.ease.stepped}],o.lerp),"ring.transform.scale":s.PropertyAnimation([{frame:0,value:[12,4,12],ease:s.ease.quadOut},{frame:.3,value:o.vec3.ZERO,ease:s.ease.quadIn}],o.vec3.lerp),"ring.color":s.PropertyAnimation([{frame:0,value:o.vec4.ZERO,ease:s.ease.quadIn},{frame:.3,value:[.7,.7,1,.6],ease:s.ease.quadOut}],o.vec4.lerp),sparks:s.EventTrigger([{frame:.4,value:64}],s.EventTrigger.emit),"flash.transform.scale":s.PropertyAnimation([{frame:.5,value:o.vec3.ZERO},{frame:.9,value:[10,10,10],ease:s.ease.quartOut}],o.vec3.lerp),"flash.color":s.PropertyAnimation([{frame:.5,value:[.8,.8,1,0]},{frame:.9,value:o.vec4.ZERO,ease:s.ease.sineIn}],o.vec4.lerp),"conduit.transform.scale":s.PropertyAnimation([{frame:.5,value:[3,0,3]},{frame:1,value:[2.5,4.5,2.5],ease:s.ease.cubicOut}],o.vec3.lerp),"conduit.color":s.PropertyAnimation([{frame:.5,value:[1,0,.3,0]},{frame:.8,value:[.8,.6,.8,1],ease:s.ease.quadIn}],o.vec4.lerp),"cube.light.intensity":s.PropertyAnimation([{frame:0,value:1},{frame:.3,value:0,ease:s.ease.quadIn}],o.lerp)},g={"bolts.rate":s.PropertyAnimation([{frame:0,value:0}],o.lerp),"light.intensity":s.PropertyAnimation([{frame:0,value:1},{frame:.5,value:0,ease:s.ease.quadIn}],o.lerp),"tubeX.transform.scale":s.PropertyAnimation([{frame:0,value:[1.4,6,1.4]},{frame:.5,value:[0,6,0],ease:s.ease.quadIn}],o.vec3.lerp),"tubeZ.transform.scale":s.PropertyAnimation([{frame:0,value:[1.4,6,1.4]},{frame:.5,value:[0,6,0],ease:s.ease.quadIn}],o.vec3.lerp),"tubeX.color":s.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.5,value:[.5,0,0,1],ease:s.ease.quadOut}],o.vec4.lerp),"tubeZ.color":s.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.5,value:[.5,0,0,1],ease:s.ease.quadOut}],o.vec4.lerp),"conduit.transform.scale":s.PropertyAnimation([{frame:0,value:[2.5,4.5,2.5]},{frame:.5,value:[4,0,4],ease:s.ease.sineIn}],o.vec3.lerp),"conduit.color":s.PropertyAnimation([{frame:0,value:[.8,.6,.8,1]},{frame:.5,value:[.5,0,.2,1],ease:s.ease.quadOut}],o.vec4.lerp),"cube.light.intensity":s.PropertyAnimation([{frame:0,value:0},{frame:.5,value:1,ease:s.ease.quadIn}],o.lerp)},x=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.active=!1,a.tubeX=new c.BatchMesh(h.SharedSystem.geometry.cylinder),a.tubeZ=new c.BatchMesh(h.SharedSystem.geometry.cylinder),a.tubeX.material=a.tubeZ.material=h.SharedSystem.materials.energyHalfPurpleMaterial,a.ringMaterial=new u.DecalMaterial,a.ringMaterial.program=a.context.get(f.DecalPass).program,a.ringMaterial.diffuse=h.SharedSystem.textures.ring,a.flash=new c.Sprite,a.flash.billboard=0,a.flash.material=new u.SpriteMaterial,a.flash.material.program=a.context.get(f.ParticleEffectPass).program,a.flash.material.diffuse=h.SharedSystem.textures.sparkle,a.conduit=new c.BatchMesh(h.SharedSystem.geometry.openBox),a.conduit.material=h.SharedSystem.materials.stripesMaterial,a}return n(t,e),t.prototype.activate=function(e,t){var r,a,n,c,u,d,v;return i(this,(function(e){switch(e.label){case 0:r=this.cube.meshes[this.cube.state.side],a=m.modelAnimations[m.CubeModuleModel[this.cube.state.sides[this.cube.state.side].type]],n=o.mat4.transform([0,1,0],this.cube.transform.matrix,o.vec3()),this.tubeX.transform=this.context.get(l.TransformSystem).create(),o.vec3.copy(n,this.tubeX.transform.position),o.quat.axisAngle(o.vec3.AXIS_X,.5*Math.PI,this.tubeX.transform.rotation),this.context.get(f.ParticleEffectPass).add(this.tubeX),this.tubeZ.transform=this.context.get(l.TransformSystem).create(),o.vec3.copy(n,this.tubeZ.transform.position),o.quat.axisAngle(o.vec3.AXIS_Z,.5*Math.PI,this.tubeZ.transform.rotation),this.context.get(f.ParticleEffectPass).add(this.tubeZ),this.flash.transform=this.context.get(l.TransformSystem).create(),o.vec3.add([0,1.2,0],n,this.flash.transform.position),o.quat.axisAngle(o.vec3.AXIS_X,-.5*Math.PI,this.flash.transform.rotation),this.context.get(f.ParticleEffectPass).add(this.flash),this.light=this.context.get(f.PointLightPass).create(),this.light.transform=this.context.get(l.TransformSystem).create(),o.vec3.add([0,2,0],n,this.light.transform.position),o.vec3.set(.6,.6,1,this.light.color),this.ring=this.context.get(f.DecalPass).create(0),this.ring.material=this.ringMaterial,this.ring.transform=this.context.get(l.TransformSystem).create(),o.vec3.copy(n,this.ring.transform.position),this.conduit.transform=this.context.get(l.TransformSystem).create(),this.conduit.transform.parent=this.cube.transform,this.context.get(f.ParticleEffectPass).add(this.conduit),this.bolts=h.SharedSystem.particles.bolts.add({uOrigin:o.vec3.add([0,.5,0],n,o.vec3()),uRadius:[1.5,2.5],uLifespan:[.2,.6,0,0],uGravity:[0,0,0],uRotation:[0,2*Math.PI],uOrientation:o.quat.IDENTITY,uSize:[.6,1.8],uFrame:[3.4,4]}),this.sparks=h.SharedSystem.particles.sparks.add({uLifespan:[.4,.8,-.1,0],uOrigin:o.vec3.add([0,.5,0],n,o.vec3()),uLength:[.05,.1],uGravity:[0,-19.6,0],uSize:[.1,.4],uRadius:[.2,.8],uForce:[7,10],uTarget:o.vec3.add([0,-.5,0],n,o.vec3())}),c=s.AnimationTimeline(this,y),u=1,d=this.context.currentTime,e.label=1;case 1:return v=this.context.currentTime-d,c(v,this.context.deltaTime),a.activate(v,r.armature),v>u?[3,4]:[4,s.ActionSignal.WaitNextFrame];case 2:e.sent(),e.label=3;case 3:return[3,1];case 4:return this.active=!0,h.SharedSystem.particles.sparks.remove(this.sparks),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(l.TransformSystem).delete(this.flash.transform),this.context.get(f.DecalPass).delete(this.ring),this.context.get(f.ParticleEffectPass).remove(this.flash),[2]}}))},t.prototype.close=function(){var t,r,a,n,o,c;return i(this,(function(i){switch(i.label){case 0:if(!this.active)return[3,5];t=s.AnimationTimeline(this,g),r=.5,a=this.context.currentTime,i.label=1;case 1:return n=this.context.currentTime-a,t(n,this.context.deltaTime),n>r?[3,4]:[4,s.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:this.active=!1,h.SharedSystem.particles.bolts.remove(this.bolts),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.conduit.transform),this.context.get(l.TransformSystem).delete(this.tubeX.transform),this.context.get(l.TransformSystem).delete(this.tubeZ.transform),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.ParticleEffectPass).remove(this.conduit),this.context.get(f.ParticleEffectPass).remove(this.tubeX),this.context.get(f.ParticleEffectPass).remove(this.tubeZ),i.label=5;case 5:o=e.prototype.close.call(this),i.label=6;case 6:return(c=o.next()).done?[2,c.value]:[3,7];case 7:return[4,c.value];case 8:i.sent(),i.label=9;case 9:return[3,6];case 10:return[2]}}))},t.prototype.validate=function(){for(var e=this.context.get(p.TerrainSystem),t=this.cube.tile,r=d.DirectionTile.length-1;r>=0;r--)if(null!=e.getTile(t[0]+d.DirectionTile[r][0],t[1]+d.DirectionTile[r][1]))return!1;for(r=d.DirectionTile.length-1;r>=0;r--){var a=o.vec2.add(t,d.DirectionTile[r],o.vec2());e.setTile(a[0],a[1],this.cube),this.cube.tiles.push(a)}return!0},t.prototype.clear=function(){for(var e=this.context.get(p.TerrainSystem);this.cube.tiles.length>1;){var t=this.cube.tiles.pop();e.setTile(t[0],t[1],null)}},t}(v.CubeSkill);t.RestoreSkill=x},4464:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShieldSkill=void 0;var o=r(7594),s=r(9519),l=r(3335),c=r(391),u=r(43),f=r(6256),m=r(1160),h=r(9258),d=r(1515),v={dust:s.EventTrigger([{frame:.85,value:36}],s.EventTrigger.emit),"shield.transform.scale":s.PropertyAnimation([{frame:1,value:o.vec3.ZERO},{frame:3,value:[3,5,3],ease:s.ease.elasticOut(1,.75)}],o.vec3.lerp),"shield.color":s.PropertyAnimation([{frame:1,value:[1,0,.5,0]},{frame:2.5,value:o.vec4.ONE,ease:s.ease.cubicOut}],o.vec4.lerp),"displacement.transform.scale":s.PropertyAnimation([{frame:1,value:o.vec3.ZERO},{frame:2.5,value:[3,5,3],ease:s.ease.elasticOut(1,.75)}],o.vec3.lerp),"displacement.color":s.PropertyAnimation([{frame:1,value:[1,.2,.8,1]},{frame:2,value:[1,1,1,.1],ease:s.ease.quadOut}],o.vec4.lerp),"wave.transform.scale":s.PropertyAnimation([{frame:.8,value:[0,2,0]},{frame:1.4,value:[12,2,12],ease:s.ease.cubicOut}],o.vec3.lerp),"wave.color":s.PropertyAnimation([{frame:.8,value:[.6,1,.9,0]},{frame:1.4,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp),"beam.transform.scale":s.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:2,value:[1.4,4.2,1.4],ease:s.ease.cubicOut}],o.vec3.lerp),"beam.color":s.PropertyAnimation([{frame:.8,value:[1,.4,.8,1]},{frame:1.4,value:[.5,1,1,0],ease:s.ease.sineIn},{frame:2,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp),"tube.transform.scale":s.PropertyAnimation([{frame:.6,value:[1,3,1]},{frame:1,value:[2.4,3.6,2.4],ease:s.ease.quadOut},{frame:1.4,value:[5,2,5],ease:s.ease.sineIn}],o.vec3.lerp),"tube.transform.position":s.PropertyAnimation([{frame:.2,value:[0,0,0]},{frame:1.2,value:[0,4,0],ease:s.ease.sineOut}],o.vec3.lerp),"tube.color":s.PropertyAnimation([{frame:1,value:o.vec4.ONE},{frame:1.4,value:o.vec4.ZERO,ease:s.ease.cubicIn}],o.vec4.lerp),"sphere.transform.rotation":s.PropertyAnimation([{frame:0,value:o.quat.axisAngle(o.vec3.AXIS_X,Math.PI,o.quat())}],o.quat.slerp),"sphere.transform.scale":s.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.2,value:[4,6,4],ease:s.ease.cubicOut},{frame:2.2,value:[3,5,3],ease:s.ease.quadInOut}],o.vec3.lerp),"sphere.color":s.PropertyAnimation([{frame:1.2,value:o.vec4.ONE},{frame:2.2,value:o.vec4.ZERO,ease:s.ease.cubicIn}],o.vec4.lerp)},p={"shield.transform.scale":s.PropertyAnimation([{frame:.2,value:[3,5,3]},{frame:1,value:o.vec3.ZERO,ease:s.ease.CubicBezier(.36,0,.66,-.56)}],o.vec3.lerp),"shield.color":s.PropertyAnimation([{frame:.2,value:o.vec4.ONE},{frame:1,value:o.vec4.ZERO,ease:s.ease.sineIn}],o.vec4.lerp),"displacement.color":s.PropertyAnimation([{frame:0,value:[1,1,1,.1]},{frame:.4,value:[1,.6,.9,1],ease:s.ease.quadOut},{frame:.8,value:[1,1,1,0],ease:s.ease.sineIn}],o.vec4.lerp)},y=function(e){function t(t,r){var a=e.call(this,t,r)||this;return a.active=!1,a.idleIndex=-1,a.waveMaterial=new u.DecalMaterial,a.waveMaterial.program=a.context.get(f.DecalPass).program,a.waveMaterial.diffuse=h.SharedSystem.textures.ring,a.shield=new c.Mesh,a.shield.order=1,a.shield.buffer=h.SharedSystem.geometry.sphereMesh,a.shield.material=h.SharedSystem.materials.shieldMaterial,a.displacement=new c.Mesh,a.displacement.order=0,a.displacement.buffer=h.SharedSystem.geometry.sphereMesh,a.displacement.material=h.SharedSystem.materials.shieldDisplacementMaterial,a.beam=new c.Sprite,a.beam.billboard=3,o.vec2.set(0,.5,a.beam.origin),a.beam.material=new u.SpriteMaterial,a.beam.material.program=a.context.get(f.ParticleEffectPass).program,a.beam.material.diffuse=h.SharedSystem.textures.raysBeam,a.tube=new c.BatchMesh(h.SharedSystem.geometry.cylinder),a.tube.material=h.SharedSystem.materials.stripesMaterial,a.sphere=new c.BatchMesh(h.SharedSystem.geometry.lowpolySphere),a.sphere.material=a.tube.material,a}return n(t,e),t.prototype.open=function(){var e,t,r,a,n,c,u,d;return i(this,(function(i){switch(i.label){case 0:e=this.cube.state.sides[this.cube.state.side],t=this.cube.meshes[this.cube.state.side],r=m.modelAnimations[m.CubeModuleModel[e.type]],a=o.mat4.transform([0,0,0],this.cube.transform.matrix,o.vec3()),this.wave=this.context.get(f.DecalPass).create(0),this.wave.transform=this.context.get(l.TransformSystem).create(),o.vec3.copy(a,this.wave.transform.position),this.wave.material=this.waveMaterial,this.beam.transform=this.context.get(l.TransformSystem).create(),o.vec3.add(a,[0,4,0],this.beam.transform.position),this.context.get(f.ParticleEffectPass).add(this.beam),this.tube.transform=this.context.get(l.TransformSystem).create(),this.tube.transform.parent=this.cube.transform,this.context.get(f.ParticleEffectPass).add(this.tube),this.sphere.transform=this.context.get(l.TransformSystem).create(),this.sphere.transform.parent=this.cube.transform,this.context.get(f.ParticleEffectPass).add(this.sphere),this.displacement.transform=this.context.get(l.TransformSystem).create(),this.displacement.transform.parent=this.cube.transform,this.context.get(f.PostEffectPass).add(this.displacement),this.shield.transform=this.context.get(l.TransformSystem).create(),this.shield.transform.parent=this.cube.transform,this.context.get(f.PostEffectPass).add(this.shield),this.dust=h.SharedSystem.particles.dust.add({uOrigin:a,uLifespan:[.6,1,-.1,0],uSize:[2,5],uRadius:[.5,.8],uOrientation:o.quat.IDENTITY,uForce:[6,12],uTarget:a,uGravity:[0,9.8,0],uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]}),n=s.AnimationTimeline(this,v),c=3,u=this.context.currentTime,i.label=1;case 1:return(d=this.context.currentTime-u)<=1?r.open(d,t.armature):-1==this.idleIndex&&(this.idleIndex=this.context.get(s.AnimationSystem).start(this.idle(),!0)),n(d,this.context.deltaTime),d>c?[3,4]:[4,s.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return e.open=1,this.context.get(l.TransformSystem).delete(this.wave.transform),this.context.get(l.TransformSystem).delete(this.beam.transform),this.context.get(l.TransformSystem).delete(this.tube.transform),this.context.get(l.TransformSystem).delete(this.sphere.transform),h.SharedSystem.particles.dust.remove(this.dust),this.context.get(f.ParticleEffectPass).remove(this.sphere),this.context.get(f.ParticleEffectPass).remove(this.tube),this.context.get(f.ParticleEffectPass).remove(this.beam),this.context.get(f.DecalPass).delete(this.wave),[2]}}))},t.prototype.close=function(){var e,t,r,a,n,o,c,u;return i(this,(function(i){switch(i.label){case 0:e=this.cube.state.sides[this.cube.state.side],t=this.cube.meshes[this.cube.state.side],r=m.modelAnimations[m.CubeModuleModel[e.type]],a=this.context.get(s.AnimationSystem).await(this.idleIndex),this.idleIndex=-1,i.label=1;case 1:return a.continue?[3,3]:[4,s.ActionSignal.WaitNextFrame];case 2:return i.sent(),[3,1];case 3:n=s.AnimationTimeline(this,p),o=1,c=this.context.currentTime,i.label=4;case 4:return u=this.context.currentTime-c,r.open(1-u,t.armature),n(u,this.context.deltaTime),u>o?[3,7]:[4,s.ActionSignal.WaitNextFrame];case 5:i.sent(),i.label=6;case 6:return[3,4];case 7:return e.open=0,this.context.get(l.TransformSystem).delete(this.shield.transform),this.context.get(l.TransformSystem).delete(this.displacement.transform),this.context.get(f.PostEffectPass).remove(this.shield),this.context.get(f.PostEffectPass).remove(this.displacement),[2]}}))},t.prototype.idle=function(){var e,t,r,a,n,o,l,c,u,f,h;return i(this,(function(i){switch(i.label){case 0:e=this.cube.state.sides[this.cube.state.side],t=this.cube.meshes[this.cube.state.side],r=m.modelAnimations[m.CubeModuleModel[e.type]],(a=function(e,t,r){var a=(t-e)/r,n=r*(e+.5*(t-e));return function(i){return i<=r?e*i+i*i*.5*a:t*i+n}}).duration=function(e,t,r){return r/(e+.5*(t-e))},n=a(0,1,.5),o=0,f=this.context.currentTime,i.label=1;case 1:return h=this.context.currentTime-f,o=n(h)%1,r.loop(o,t.armature),-1==this.idleIndex?[3,4]:[4,s.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:l=.25-o%.25,c=a.duration(1,0,l),u=a(1,0,c),f=this.context.currentTime,i.label=5;case 5:return h=this.context.currentTime-f,r.loop((o+u(h))%1,t.armature),h>c?[3,8]:[4,s.ActionSignal.WaitNextFrame];case 6:i.sent(),i.label=7;case 7:return[3,5];case 8:return[2]}}))},t}(d.CubeSkill);t.ShieldSkill=y},874:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShockwaveSkill=void 0;var s=r(7594),l=r(556),c=r(3335),u=r(9519),f=r(391),m=r(43),h=r(6256),d=r(8211),v=r(1160),p=r(9258),y=r(1515),g={"ring.transform.scale":u.PropertyAnimation([{frame:0,value:[16,2,16]},{frame:.6,value:[0,2,0],ease:u.ease.quadIn}],s.vec3.lerp),"ring.color":u.PropertyAnimation([{frame:0,value:s.vec4.ZERO},{frame:.6,value:[.8,.3,.6,.4],ease:u.ease.quadOut}],s.vec4.lerp),"crack.transform.scale":u.PropertyAnimation([{frame:0,value:[16,2,16]}],s.vec3.lerp),"crack.threshold":u.PropertyAnimation([{frame:.7,value:2.5},{frame:1.2,value:0,ease:u.ease.cubicOut},{frame:2,value:-2.5,ease:u.ease.sineOut}],s.lerp),"crack.color":u.PropertyAnimation([{frame:1,value:s.vec4.ONE},{frame:1.6,value:[0,0,0,1],ease:u.ease.sineOut}],s.vec4.lerp),"bolts.rate":u.PropertyAnimation([{frame:0,value:0},{frame:.8,value:.004,ease:u.ease.stepped},{frame:1.8,value:0,ease:u.ease.stepped}],s.lerp),"bolts.uniform.uniforms.uRadius":u.PropertyAnimation([{frame:.8,value:s.vec2.ONE},{frame:1.8,value:[6,7],ease:u.ease.sineOut}],s.vec2.lerp),"wave.transform.scale":u.PropertyAnimation([{frame:.7,value:[0,0,0]},{frame:1.2,value:[20,20,20],ease:u.ease.cubicOut}],s.vec3.lerp),"wave.color":u.PropertyAnimation([{frame:.8,value:s.vec4.ONE},{frame:1.2,value:s.vec4.ZERO,ease:u.ease.cubicIn}],s.vec4.lerp),"light.radius":u.PropertyAnimation([{frame:.7,value:0},{frame:1.2,value:12,ease:u.ease.cubicOut},{frame:2,value:0,ease:u.ease.cubicIn}],s.lerp),"light.intensity":u.PropertyAnimation([{frame:.6,value:0},{frame:.8,value:4,ease:u.ease.cubicIn},{frame:1.4,value:.5,ease:u.ease.cubicOut},{frame:2,value:0,ease:u.ease.sineIn}],s.lerp),"light.color":u.PropertyAnimation([{frame:.8,value:[.5,.8,1]},{frame:1.4,value:[1,.2,.6],ease:u.ease.cubicOut}],s.vec3.lerp),"flash.transform.scale":u.PropertyAnimation([{frame:.6,value:s.vec3.ZERO},{frame:1,value:[6,6,6],ease:u.ease.quartOut}],s.vec3.lerp),"flash.color":u.PropertyAnimation([{frame:.6,value:[.6,.8,1,0]},{frame:1,value:[0,0,0,0],ease:u.ease.quadIn}],s.vec4.lerp),"beam.transform.scale":u.PropertyAnimation([{frame:.6,value:[0,2,1]},{frame:1.2,value:[1.4,4.8,1],ease:u.ease.cubicOut}],s.vec3.lerp),"beam.color":u.PropertyAnimation([{frame:.6,value:[1,.6,.8,0]},{frame:1.2,value:s.vec4.ZERO,ease:u.ease.quadIn}],s.vec4.lerp),"cylinder.transform.scale":u.PropertyAnimation([{frame:0,value:[8,2,8]},{frame:.5,value:[3,8,3],ease:u.ease.sineOut},{frame:.8,value:[6,1,6],ease:u.ease.cubicIn}],s.vec3.lerp),"cylinder.transform.rotation":u.PropertyAnimation([{frame:0,value:s.quat.IDENTITY},{frame:.5,value:s.quat.axisAngle(s.vec3.AXIS_Y,-1*Math.PI,s.quat()),ease:u.ease.quadIn},{frame:.8,value:s.quat.axisAngle(s.vec3.AXIS_Y,-1.5*Math.PI,s.quat()),ease:u.ease.quadOut}],s.quat.slerp),"cylinder.color":u.PropertyAnimation([{frame:0,value:s.vec4.ZERO},{frame:.5,value:[1,1,1,1],ease:u.ease.quadOut},{frame:.8,value:s.vec4.ZERO,ease:u.ease.quartIn}],s.vec4.lerp)},x=function(e){function t(t,a){var n=e.call(this,t,a)||this,i=t.get(m.MaterialSystem);return n.shatterMaterial=new m.DecalMaterial,n.shatterMaterial.diffuse=i.addRenderTexture(i.createRenderTexture(512,512,1,{wrap:33071,mipmaps:0,format:32856}),0,l.ShaderProgram(t.gl,d.shaders.fullscreen_vert,r(6246),{}),{},0).target,n.shatterMaterial.normal=i.addRenderTexture(i.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,l.ShaderProgram(t.gl,d.shaders.fullscreen_vert,r(6246),{MASK:!0}),{},0).target,n.wave=new f.Sprite,n.wave.billboard=0,n.wave.material=new m.SpriteMaterial,n.wave.material.blendMode=null,n.wave.material.program=p.SharedSystem.materials.distortion,n.wave.material.diffuse=p.SharedSystem.textures.wave,n.flash=new f.Sprite,n.flash.billboard=0,n.flash.material=new m.SpriteMaterial,n.flash.material.program=n.context.get(h.ParticleEffectPass).program,n.flash.material.diffuse=p.SharedSystem.textures.wave,n.beam=new f.Sprite,n.beam.billboard=3,n.beam.material=new m.SpriteMaterial,n.beam.material.program=n.context.get(h.ParticleEffectPass).program,n.beam.material.diffuse=p.SharedSystem.textures.raysBeam,s.vec2.set(0,.5,n.beam.origin),n.bolts=p.SharedSystem.particles.bolts.add({uOrigin:[0,0,0],uRadius:s.vec2.ZERO,uLifespan:[.1,.8,0,0],uGravity:s.vec3.ZERO,uRotation:[0,2*Math.PI],uOrientation:s.quat.IDENTITY,uSize:[.1,1.2],uFrame:[8,4]}),n.cylinder=new f.BatchMesh(p.SharedSystem.geometry.cylinder),n.cylinder.material=new m.SpriteMaterial,n.cylinder.material.program=n.context.get(h.ParticleEffectPass).program,n.cylinder.material.diffuse=p.SharedSystem.textures.wind,n}return n(t,e),t.prototype.activate=function(e,t){var r,a,n,l,f,d,y;return o(this,(function(t){switch(t.label){case 0:r=s.mat4.transform([0,0,0],e,s.vec3()),this.ring=this.context.get(h.DecalPass).create(0),this.ring.transform=this.context.get(c.TransformSystem).create(),s.vec3.copy(r,this.ring.transform.position),this.ring.material=new m.DecalMaterial,this.ring.material.diffuse=p.SharedSystem.textures.raysRing,this.crack=this.context.get(h.DecalPass).create(1),this.crack.transform=this.context.get(c.TransformSystem).create(),s.vec3.copy(r,this.crack.transform.position),this.crack.material=this.shatterMaterial,this.wave.transform=this.context.get(c.TransformSystem).create(),s.quat.axisAngle(s.vec3.AXIS_X,-.5*Math.PI,this.wave.transform.rotation),s.vec3.add(r,[0,1.5,0],this.wave.transform.position),this.context.get(h.PostEffectPass).add(this.wave),this.flash.transform=this.context.get(c.TransformSystem).create(),s.quat.axisAngle(s.vec3.AXIS_X,-.5*Math.PI,this.flash.transform.rotation),s.vec3.add(r,[0,1.6,0],this.flash.transform.position),this.context.get(h.ParticleEffectPass).add(this.flash),this.beam.transform=this.context.get(c.TransformSystem).create(),s.vec3.add(r,[0,3,0],this.beam.transform.position),this.context.get(h.ParticleEffectPass).add(this.beam),this.cylinder.transform=this.context.get(c.TransformSystem).create(),s.vec3.add(r,[0,1,0],this.cylinder.transform.position),this.context.get(h.ParticleEffectPass).add(this.cylinder),this.light=this.context.get(h.PointLightPass).create(),this.light.transform=this.context.get(c.TransformSystem).create(),s.vec3.add(r,[0,4,0],this.light.transform.position),s.vec3.add(r,[0,2,0],this.bolts.uniform.uniforms.uOrigin),a=this.cube.meshes[this.cube.state.side],n=v.modelAnimations[v.CubeModuleModel[this.cube.state.sides[this.cube.state.side].type]],l=u.AnimationTimeline(this,i({},g)),f=2,d=this.context.currentTime,t.label=1;case 1:return y=this.context.currentTime-d,l(y,this.context.deltaTime),n.activate(y,a.armature),y>f?[3,4]:[4,u.ActionSignal.WaitNextFrame];case 2:t.sent(),t.label=3;case 3:return[3,1];case 4:return this.context.get(c.TransformSystem).delete(this.light.transform),this.context.get(c.TransformSystem).delete(this.crack.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.flash.transform),this.context.get(c.TransformSystem).delete(this.beam.transform),this.context.get(c.TransformSystem).delete(this.cylinder.transform),this.context.get(h.PointLightPass).delete(this.light),this.context.get(h.DecalPass).delete(this.ring),this.context.get(h.DecalPass).delete(this.crack),this.context.get(h.PostEffectPass).remove(this.wave),this.context.get(h.ParticleEffectPass).remove(this.flash),this.context.get(h.ParticleEffectPass).remove(this.beam),this.context.get(h.ParticleEffectPass).remove(this.cylinder),[2]}}))},t}(y.CubeSkill);t.ShockwaveSkill=x},1373:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CubeSkills=void 0;var a=r(1515),n=r(8825),i=r(1640),o=r(874),s=r(4464),l=r(2162),c=r(4202),u=r(4244),f=r(2099),m=r(4617),h=r(9641);t.CubeSkills=function(e,t){var r;return(r={})[0]=new a.CubeSkill(e,t),r[1]=new n.DeathSkill(e,t),r[3]=new i.BeamSkill(e,t),r[5]=new o.ShockwaveSkill(e,t),r[9]=new s.ShieldSkill(e,t),r[2]=new l.ProjectileSkill(e,t),r[7]=new c.DetonateSkill(e,t),r[6]=new u.OrbSkill(e,t),r[10]=new f.ArtillerySkill(e,t),r[4]=new m.RestoreSkill(e,t),r[8]=new h.ExtractSkill(e,t),r}},2435:function(e,t,r){"use strict";var a=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LevelGenerator=void 0;var n=r(7594),i=r(7573),o=r(8914),s=r(4437),l=function(){function e(e){this.context=e}return e.prototype.random2D=function(e,t){var r=39916801*n.noise2D(e,t,214),a=1;return function(){return a=n.noise1D(a,r)}},e.prototype.populate=function(t){var r=this,a=o.TerrainChunk.chunkTiles*t.column/e.zoneSize|0,i=o.TerrainChunk.chunkTiles*t.row/e.zoneSize|0,l=a*e.zoneSize-o.TerrainChunk.chunkTiles*t.column,c=i*e.zoneSize-o.TerrainChunk.chunkTiles*t.row,u=this.random2D(a,i);t.terraform(n.aabb2.pad(o.TerrainChunk.bounds,1,n.aabb2()),(function(e,t){return 8*r.sampleDunes(.2*e,.2*t,173)}));var f=l+n.randomInt(1,e.zoneSize-2,u),m=c+n.randomInt(1,e.zoneSize-2,u);0==a&&0==i&&(f=l+4,m=c+2),f<0||m<0||f>=o.TerrainChunk.chunkTiles||m>=o.TerrainChunk.chunkTiles||new s.Workshop(this.context).place(f-l,m-c),u=this.random2D(t.column,t.row);for(var h=this.randomTile(-t.offsetX,-t.offsetZ,o.TerrainChunk.chunkTiles,o.TerrainChunk.chunkTiles,u),d=this.context.get(s.EconomySystem),v=n.randomInt(0,1,u);v>0;v--){var p=h.next().value;d.createDeposit(p[0],p[1],4)}},e.prototype.sampleDunes=function(e,t,r){return(1*Math.pow(1-2*Math.abs(i.perlin2D(.5*e,.5*t,r)-.5),2)+2*Math.pow(1-2*Math.abs(i.perlin2D(.25*e,.25*t,r)-.5),2)+4*n.smoothstep(0,1,i.perlin2D(.2*e,.2*t,r)))/7},e.prototype.randomTile=function(t,r,i,o,s){var l,c,u;return a(this,(function(a){switch(a.label){case 0:l=n.range(i*o),c=e.tile,a.label=1;case 1:return l.length?(u=n.randomInt(0,l.length-1,s),c[0]=t+l[u%i],c[1]=r+l[u/i|0],l[u]=l[l.length-1],[4,c]):[3,4];case 2:a.sent(),a.label=3;case 3:return l.length--,[3,1];case 4:return[2]}}))},e.tile=n.vec2(),e.zoneSize=64,e}();t.LevelGenerator=l},3073:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pathfinder=void 0;var a=r(8716),n=r(7594),i=function(){function e(e,t){var r=this;this.context=e,this.size=t,this.heap=new a.BinaryHeap((function(e,t){return r.estimate[e]+r.distance[e]-(r.estimate[t]+r.distance[t])})),this.orderedQueue=new a.BinaryHeap((function(e,t){return r.distance[e]-r.distance[t]||r.estimate[e]-r.estimate[t]})),this.dirty=[],this.queue=[],this.parent=new Uint32Array(this.size*this.size),this.flags=new Uint8Array(this.size*this.size),this.distance=new Float32Array(this.size*this.size),this.estimate=new Float32Array(this.size*this.size),this.weight=new Float32Array(this.size*this.size).fill(-1),this.marked=new Float32Array(this.size*this.size),this.influence=new Uint32Array(this.size*this.size),this.offset=n.vec2(0,0)}return e.prototype.calculateSingleWeight=function(e,t,r,a){var n=this.weight[t[0]+t[1]*this.size];if(e[0]!==t[0]&&e[1]!==t[1]){var i=this.weight[e[0]+t[1]*this.size],o=this.weight[t[0]+e[1]*this.size];if(!i&&!o)return 0;n+=(Math.SQRT2-1)*Math.max(i,o)}return null!=a&&n>a?0:n},e.prototype.calculateAreaWeight=function(e,t,r,a){var n=t[0],i=t[0]+r[0],o=t[1],s=t[1]+r[1],l=t[0]-e[0],c=t[1]-e[1];0===l?c>0?o=Math.max(o,s-c):s=Math.min(s,o-c):0===c&&(l>0?n=Math.max(n,i-l):i=Math.min(i,n-l));for(var u=1,f=n;f<i;f++)for(var m=o;m<s;m++){var h=this.weight[f+m*this.size];if(!h)return 0;u=Math.max(u,h)}return null!=a&&u>a?0:u},e.prototype.tileIndex=function(e,t){return e+this.offset[0]+(t+this.offset[1])*this.size},e.prototype.indexTile=function(e,t){return t[0]=e%this.size-this.offset[0],t[1]=(e/this.size|0)-this.offset[1],t},e.prototype.add=function(e){this.dirty.push(this.tileIndex(e[0],e[1]))},e.prototype.search=function(t,r,a,i){for(var o=a?e.heuristic.diagonal:e.heuristic.manhattan,s=a?e.neighbours.diagonal:e.neighbours.cardinal,l=n.vec2.equals(n.vec2.ONE,r,0)?this.calculateSingleWeight:this.calculateAreaWeight,c=e.tile0,u=e.tile1,f=this.dirty.length-1;f>=0;f--){var m=this.dirty[f];this.flags[m]||(this.indexTile(m,c),this.estimate[m]=o(c,t),this.flags[m]|=1,this.heap.push(m))}for(var h=this.tileIndex(t[0],t[1]),d=this.heap.get(0);this.heap.length;){var v=this.heap.shift();if(v===h)break;for(this.flags[v]|=2,c[0]=v%this.size,c[1]=v/this.size|0,f=s.length-1;f>=0;f--)if(n.vec2.add(s[f],c,u),!(u[0]<0||u[1]<0||u[0]>=this.size||u[1]>=this.size)){var p=u[0]+u[1]*this.size,y=l.call(this,c,u,r,i);if(0==(2&this.flags[p])&&0!=y){var g=this.distance[v]+y,x=0!=(1&this.flags[p]);x&&g>=this.distance[p]||(this.parent[p]=v+1,this.distance[p]=g,x||(this.flags[p]|=1,n.vec2.subtract(u,this.offset,u),this.estimate[p]=o(u,t),this.dirty.push(p)),(this.estimate[p]===this.estimate[d]?this.distance[p]<this.distance[d]:this.estimate[p]<this.estimate[d])&&(d=p),x?this.heap.update(p):this.heap.push(p))}}}return d},e.prototype.linkPath=function(e){for(var t=[],r=e;r>=0;r=this.parent[r]-1)t.unshift(r);return t},e.prototype.walk=function(t,r,a,i,o,s){for(var l=i?e.neighbours.diagonal:e.neighbours.cardinal,c=n.vec2.equals(n.vec2.ONE,a,0)?this.calculateSingleWeight:this.calculateAreaWeight,u=s?this.orderedQueue:this.queue,f=e.tile0,m=e.tile1,h=this.dirty.length-1;h>=0;h--){var d=this.dirty[h];this.flags[d]||t.call(r,d,this.indexTile(d,f),0,-1,!0)&&(u.push(d),this.flags[d]=1)}for(;u.length;){var v=u.shift(),p=this.distance[v];for(f[0]=v%this.size,f[1]=v/this.size|0,h=l.length-1;h>=0;h--)if(n.vec2.add(l[h],f,m),!(m[0]<0||m[1]<0||m[0]>=this.size||m[1]>=this.size)){var y=m[0]+m[1]*this.size;0!=c.call(this,f,m,a,o)&&t.call(r,y,n.vec2.subtract(m,this.offset,m),p+1,v,!this.flags[y])&&1!==this.flags[y]&&(this.flags[y]=1,this.parent[y]=v+1,this.distance[y]=p+1,this.dirty.push(y),u.push(y))}}},e.prototype.clear=function(){for(this.heap.clear(),this.orderedQueue.clear(),this.queue.length=0;this.dirty.length;){var e=this.dirty.pop();this.estimate[e]=this.distance[e]=0,this.parent[e]=this.flags[e]=0}},e.heuristic={manhattan:n.vec2.manhattan,euclidean:n.vec2.distance,diagonal:function(e,t){var r=Math.abs(t[0]-e[0]),a=Math.abs(t[1]-e[1]);return Math.max(r,a)+(Math.SQRT2-1)*Math.min(r,a)}},e.neighbours={cardinal:[n.vec2(1,0),n.vec2(0,1),n.vec2(-1,0),n.vec2(0,-1)],diagonal:[n.vec2(1,0),n.vec2(1,1),n.vec2(0,1),n.vec2(-1,1),n.vec2(-1,0),n.vec2(-1,-1),n.vec2(0,-1),n.vec2(1,-1)]},e.tile0=n.vec2(),e.tile1=n.vec2(),e}();t.Pathfinder=i},6433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainSystem=void 0;var a=r(7594),n=r(3335),i=r(2435),o=r(3073),s=r(8914),l=r(9258),c=function(){function e(e){this.context=e,this.positionOffset=-.5*s.TerrainChunk.chunkSize+.5*s.TerrainChunk.tileSize,this.gridSize=3,this.gridBounds=a.aabb2(),this.bounds=a.aabb2(),this.frame=0,this.chunks=Array(this.gridSize*this.gridSize),this.levelGenerator=new i.LevelGenerator(this.context),this.pathfinder=new o.Pathfinder(this.context,this.gridSize*s.TerrainChunk.chunkTiles)}return e.prototype.update=function(){var t=this.context.get(n.CameraSystem).controller.cameraTarget,r=Math.floor(t[0]/s.TerrainChunk.chunkSize-.5*this.gridSize+1),i=Math.floor(t[2]/s.TerrainChunk.chunkSize-.5*this.gridSize+1);if(this.gridBounds[0]!=r||this.gridBounds[1]!=i){for(var o=this.chunks.length-1;o>=0;o--)if(y=this.chunks[o]){var c=y.column-r+(y.row-i)*this.gridSize;c!==o&&(y.column<r||y.row<i||y.column>=r+this.gridSize||y.row>=i+this.gridSize?(y.clear(),e.pool.push(y),this.chunks[o]=null):(this.chunks[o]=this.chunks[c],this.chunks[c]=y,o++))}this.frame=this.context.frame,a.aabb2.set(r,i,r+this.gridSize,i+this.gridSize,this.gridBounds),a.vec4.scale(this.gridBounds,s.TerrainChunk.chunkTiles,this.bounds);var u=this.pathfinder,f=u.offset,m=u.size,h=u.weight;a.vec2.set(-r*s.TerrainChunk.chunkTiles,-i*s.TerrainChunk.chunkTiles,f);for(var d=m-1;d>=0;d--)for(var v=m-1;v>=0;v--){var p=this.getTile(d-f[0],v-f[1]);h[d+v*m]=p?p.weight:1}for(d=this.gridSize-1;d>=0;d--)for(v=this.gridSize-1;v>=0;v--)if(!this.chunks[d+v*this.gridSize]){var y,g=d+r,x=v+i;(y=e.pool.pop()||new s.TerrainChunk(this.context)).column=g,y.row=x,y.offsetX=-g*s.TerrainChunk.chunkTiles,y.offsetZ=-x*s.TerrainChunk.chunkTiles,this.chunks[d+v*this.gridSize]=y,this.levelGenerator.populate(y),y.build(),y.mesh.material=l.SharedSystem.materials.dunesMaterial}}},e.prototype.chunk=function(e,t){var r=Math.floor(e/s.TerrainChunk.chunkTiles)-this.gridBounds[0],a=Math.floor(t/s.TerrainChunk.chunkTiles)-this.gridBounds[1];return r<0||a<0||r>=this.gridSize||a>=this.gridSize?null:this.chunks[r+a*this.gridSize]},e.prototype.getTile=function(e,t){var r;return null===(r=this.chunk(e,t))||void 0===r?void 0:r.get(e,t)},e.prototype.setTile=function(e,t,r){var a;null===(a=this.chunk(e,t))||void 0===a||a.set(e,t,r),this.pathfinder.weight[this.pathfinder.tileIndex(e,t)]=r?r.weight:1},e.prototype.tilePosition=function(e,t,r){var a;return r[0]=s.TerrainChunk.tileSize*e+this.positionOffset,r[2]=s.TerrainChunk.tileSize*t+this.positionOffset,r[1]=(null===(a=this.chunk(e,t))||void 0===a?void 0:a.sample(r[0],r[2]))||0,r},e.prototype.snapToGround=function(e){var t,r=Math.round((e[0]-this.positionOffset)/s.TerrainChunk.tileSize),a=Math.round((e[1]-this.positionOffset)/s.TerrainChunk.tileSize);e[1]=(null===(t=this.chunk(r,a))||void 0===t?void 0:t.sample(e[0],e[2]))||0},e.pool=[],e}();t.TerrainSystem=c},8914:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainChunk=void 0;var a=r(7594),n=r(6240),i=r(8783),o=r(1513),s=function(){function e(t){this.context=t,this.grid=Array(e.chunkTiles*e.chunkTiles).fill(null);var r=e.chunkLOD,a=e.chunkLOD,o=n.createPlane({columns:r,rows:a,width:e.chunkSize,height:e.chunkSize}),s=o.vertexArray,l=o.indexArray,c=o.format;this.heightmap=new Float32Array((r+3)*(a+3)),this.vertexArray=s,this.vertexBuffer=this.context.get(i.MeshSystem).uploadVertexData(s,l,c),this.stride=this.vertexBuffer.format[1].stride>>>2}return e.prototype.sample=function(t,r){var a=e.chunkLOD+1,n=a+2,i=0|(t/e.chunkSize-this.column+.5)*a,o=0|(r/e.chunkSize-this.row+.5)*a;return this.heightmap[(i+1)*n+(o+1)]},e.prototype.mapRegion=function(t,r){var n=e.chunkLOD+1;return r[0]=Math.floor((t[0]/e.chunkSize-this.column+.5)*n),r[1]=Math.floor((t[1]/e.chunkSize-this.row+.5)*n),r[2]=Math.floor((t[2]/e.chunkSize-this.column+.5)*n),r[3]=Math.floor((t[3]/e.chunkSize-this.row+.5)*n),a.aabb2.intersect(e.bounds,r,r)},e.prototype.terraform=function(t,r){for(var a=e.chunkLOD+1+2,n=e.chunkSize/e.chunkLOD,i=-.5*e.chunkSize+this.column*e.chunkSize,o=-.5*e.chunkSize+this.row*e.chunkSize,s=t[0];s<=t[2];s++)for(var l=t[1];l<=t[3];l++){var c=(s+1)*a+(l+1),u=i+s*n,f=o+l*n;this.heightmap[c]=r(u,f)}},e.prototype.get=function(t,r){var a=t+this.offsetX+(r+this.offsetZ)*e.chunkTiles;return this.grid[a]},e.prototype.set=function(t,r,a){var n=t+this.offsetX+(r+this.offsetZ)*e.chunkTiles;this.grid[n]=a},e.prototype.build=function(){for(var t=e.chunkLOD+1,r=t+2,n=0;n<t;n++)for(var s=0;s<t;s++){var l=(n*t+s)*this.stride;this.vertexArray[l+1]=this.heightmap[(n+1)*r+(s+1)];var c=this.heightmap[(n+2)*r+(s+1)],u=this.heightmap[(n+0)*r+(s+1)],f=this.heightmap[(n+1)*r+(s+2)],m=this.heightmap[(n+1)*r+(s+0)],h=this.vertexArray.subarray(l+3,l+6);a.vec3.set(2*(c-u),4,2*(m-f),h),a.vec3.normalize(h,h)}this.mesh=this.context.get(i.MeshSystem).create(),this.context.get(i.MeshSystem).updateVertexData(this.vertexBuffer,this.vertexArray),this.mesh.layer=1,this.mesh.buffer=this.vertexBuffer,this.mesh.buffer.frame=0,this.mesh.transform=this.context.get(o.TransformSystem).create(),a.vec3.set(this.column*e.chunkSize,0,this.row*e.chunkSize,this.mesh.transform.position)},e.prototype.clear=function(){for(var e=this.grid.length-1;e>=0;e--)this.grid[e]&&this.grid[e].delete();this.grid.fill(null),this.context.get(o.TransformSystem).delete(this.mesh.transform),this.context.get(i.MeshSystem).delete(this.mesh),this.mesh=null},e.prototype.delete=function(){this.context.get(i.MeshSystem).unloadVertexData(this.vertexBuffer)},e.chunkLOD=16,e.chunkSize=20,e.tileSize=2,e.chunkTiles=e.chunkSize/e.tileSize,e.bounds=a.aabb2(0,0,e.chunkLOD,e.chunkLOD),e}();t.TerrainChunk=s},2392:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(7573),t),n(r(8914),t),n(r(2435),t),n(r(3073),t),n(r(6433),t)},7573:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.perlin2D=void 0;var a=r(3850),n=r(7144),i=function(e){return e*e*e*(e*(6*e-15)+10)};function o(e,t,r,a,i){var o=2*Math.PI*n.noise2D(e,t,i);return r*Math.cos(o)+a*Math.sin(o)}t.perlin2D=function(e,t,r){var n=Math.floor(e),s=Math.floor(t),l=o(n,s,e-=n,t-=s,r),c=o(n+1,s,e-1,t,r),u=o(n,s+1,e,t-1,r),f=o(n+1,s+1,e-1,t-1,r),m=i(e),h=i(t);return a.lerp(a.lerp(l,c,m),a.lerp(u,f,m),h)}},3196:function(e,t,r){"use strict";var a=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.DeathEffect=void 0;var n=r(7594),i=r(43),o=r(391),s=r(6256),l=r(3335),c=r(9519),u=r(9258),f=function(){function e(e){this.context=e}return e.prototype.use=function(e){var t,r,f,m;return a(this,(function(a){switch(a.label){case 0:this.mesh=e.mesh,this.mesh.material.program=u.SharedSystem.materials.dissolveProgram,this.burn=this.context.get(s.DecalPass).create(4),this.burn.transform=this.context.get(l.TransformSystem).create(n.vec3.ZERO,n.quat.IDENTITY,n.vec3.ONE,this.mesh.transform),this.burn.material=new i.DecalMaterial,this.burn.material.program=this.context.get(s.DecalPass).program,this.burn.material.diffuse=u.SharedSystem.textures.glow,this.wave=new o.Sprite,this.wave.billboard=0,this.wave.material=new i.SpriteMaterial,this.wave.material.blendMode=null,this.wave.material.program=u.SharedSystem.materials.chromaticAberration,this.wave.material.diffuse=u.SharedSystem.textures.wave,this.wave.transform=this.context.get(l.TransformSystem).create(n.vec3.add([0,.5,0],this.mesh.transform.position,n.vec3()),o.Sprite.FlatUp,n.vec3.ONE),this.context.get(s.PostEffectPass).add(this.wave),this.ring=new o.Sprite,this.ring.billboard=0,this.ring.material=new i.SpriteMaterial,this.ring.material.program=this.context.get(s.ParticleEffectPass).program,this.ring.material.diffuse=u.SharedSystem.textures.raysInner,this.ring.transform=this.context.get(l.TransformSystem).create(n.vec3.add([0,.5,0],this.mesh.transform.position,n.vec3()),o.Sprite.FlatUp,n.vec3.ONE),this.context.get(s.ParticleEffectPass).add(this.ring),this.light=this.context.get(s.PointLightPass).create(),this.light.transform=this.context.get(l.TransformSystem).create([0,1.5,0],n.quat.IDENTITY,n.vec3.ONE,this.mesh.transform),this.pillar=new o.Sprite,this.pillar.billboard=3,n.vec2.set(0,.5,this.pillar.origin),this.pillar.transform=this.context.get(l.TransformSystem).create(n.vec3.ZERO,n.quat.IDENTITY,n.vec3.ONE,this.mesh.transform),this.pillar.material=new i.SpriteMaterial,this.pillar.material.program=this.context.get(s.ParticleEffectPass).program,this.pillar.material.diffuse=u.SharedSystem.textures.groundDust,this.context.get(s.ParticleEffectPass).add(this.pillar),this.spikes=u.SharedSystem.particles.spikes.add({uLifespan:[.4,.8,-.1,0],uOrigin:this.mesh.transform.position,uGravity:n.vec3.ZERO,uSize:[1*e.size[0],4*e.size[0]],uRotation:n.vec2.ZERO,uForce:[2,6],uTarget:n.vec3.subtract(this.mesh.transform.position,[0,.2,0],n.vec3()),uRadius:[.2,.2],uFrame:[0,2]}),t=c.AnimationTimeline(this,{spikes:c.EventTrigger([{frame:0,value:8*e.size[0]}],(function(e,t){return e.count+=t})),"pillar.transform.scale":c.PropertyAnimation([{frame:.1,value:[0,3,0]},{frame:.3,value:[2,6,2],ease:c.ease.cubicOut},{frame:.8,value:[4,1,4],ease:c.ease.sineIn}],n.vec3.lerp),"pillar.color":c.PropertyAnimation([{frame:.1,value:[.1,.02,.05,1]},{frame:.8,value:n.vec4.ZERO,ease:c.ease.quadIn}],n.vec4.lerp),"light.color":c.PropertyAnimation([{frame:0,value:[1,.2,.4]}],n.vec3.lerp),"light.radius":c.PropertyAnimation([{frame:0,value:0},{frame:.6,value:4*e.size[0],ease:c.ease.cubicOut}],n.lerp),"light.intensity":c.PropertyAnimation([{frame:0,value:8},{frame:.6,value:0,ease:c.ease.sineIn}],n.lerp),"ring.transform.scale":c.PropertyAnimation([{frame:.1,value:n.vec3.ZERO},{frame:.7,value:[8*e.size[0],8*e.size[1],1],ease:c.ease.cubicOut}],n.vec3.lerp),"ring.color":c.PropertyAnimation([{frame:.1,value:[.6,.4,.5,.8]},{frame:.7,value:n.vec4.ZERO,ease:c.ease.sineIn}],n.vec4.lerp),"wave.transform.scale":c.PropertyAnimation([{frame:.1,value:n.vec3.ZERO},{frame:.5,value:[8*e.size[0],8*e.size[1],1],ease:c.ease.quartOut}],n.vec3.lerp),"wave.color":c.PropertyAnimation([{frame:.1,value:[1,1,1,1]},{frame:.5,value:n.vec4.ZERO,ease:c.ease.sineIn}],n.vec4.lerp),"mesh.color":c.PropertyAnimation([{frame:0,value:[1,1,1,-2*e.mesh.buffer.radius]},{frame:.1,value:[.8,1,0,-2*e.mesh.buffer.radius],ease:c.ease.sineIn},{frame:.4,value:[.2,.5,0,-e.mesh.buffer.radius],ease:c.ease.quadOut},{frame:3,value:[.2,.5,0,1],ease:c.ease.slowInOut}],n.vec4.lerp),"mesh.transform.position":c.PropertyAnimation([{frame:0,value:n.vec3.copy(e.mesh.transform.position,n.vec3())},{frame:.4,value:n.vec3.add(e.mesh.transform.position,[0,-.5,0],n.vec3()),ease:c.ease.bounceIn(.1,.6)}],n.vec3.lerp),"burn.transform.scale":c.PropertyAnimation([{frame:0,value:[0,0,0]},{frame:.4,value:[8*e.size[0],4,8*e.size[1]],ease:c.ease.cubicOut}],n.vec3.lerp),"burn.color":c.PropertyAnimation([{frame:.4,value:[.2,.2,.2,1]},{frame:3,value:n.vec4.ZERO,ease:c.ease.cubicIn}],n.vec4.lerp)}),r=3,f=this.context.currentTime,a.label=1;case 1:return m=this.context.currentTime-f,t(m,this.context.deltaTime),m>r?[3,4]:[4,c.ActionSignal.WaitNextFrame];case 2:a.sent(),a.label=3;case 3:return[3,1];case 4:return u.SharedSystem.particles.spikes.remove(this.spikes),this.context.get(l.TransformSystem).delete(this.burn.transform),this.context.get(l.TransformSystem).delete(this.wave.transform),this.context.get(l.TransformSystem).delete(this.pillar.transform),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(s.PointLightPass).delete(this.light),this.context.get(s.PostEffectPass).remove(this.wave),this.context.get(s.DecalPass).delete(this.burn),this.context.get(s.ParticleEffectPass).remove(this.pillar),this.context.get(s.ParticleEffectPass).remove(this.ring),[2]}}))},e}();t.DeathEffect=f},7207:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(3196),t)},4275:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArtillerySkill=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(6256),u=r(43),f=r(6240),m=r(9519),h=r(2392),d=r(1160),v=r(9258),p=r(7940),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=8,t.cardinal=!1,t.damage=10,t.target=o.vec2(),t}return n(t,e),t.prototype.aim=function(t,r){return this.active?this.target:e.prototype.aim.call(this,t,r)},t.prototype.use=function(e,t){this.mesh=e.mesh;var r=this.context.get(h.TerrainSystem).tilePosition(t[0],t[1],o.vec3());return this.active?(this.active=!1,this.launch(this.target)):(o.vec2.copy(t,this.target),this.active=!0,this.activate(r))},t.prototype.launch=function(e){var t,r,a,n,y,g,x,b,S;return i(this,(function(i){switch(i.label){case 0:t=this.context.get(h.TerrainSystem).tilePosition(e[0],e[1],o.vec3()),this.smoke=v.SharedSystem.particles.smoke.add({uLifespan:[.8,1.4,-.3,0],uOrigin:o.mat4.transform([0,3.2,.8],this.mesh.transform.matrix,o.vec3()),uGravity:[0,4,0],uRotation:[0,2*Math.PI],uSize:[1,3],uFieldDomain:[.5,.5,.5,0],uFieldStrength:[8,0]}),this.muzzle=new s.Sprite,this.muzzle.billboard=2,this.muzzle.material=new u.SpriteMaterial,this.muzzle.material.program=this.context.get(c.ParticleEffectPass).program,this.muzzle.material.diffuse=v.SharedSystem.textures.rays,this.muzzle.transform=this.context.get(l.TransformSystem).create([0,3.4,1],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(c.ParticleEffectPass).add(this.muzzle),this.trail=new s.Line(8),this.trail.width=.6,this.trail.ease=m.ease.cubicFadeInOut,this.trail.addColorFade(this.trail.ease,o.vec3(1,.6,.4)),this.trail.material=v.SharedSystem.materials.trailSmokeMaterial,this.context.get(c.ParticleEffectPass).add(this.trail),this.wave=new s.Sprite,this.wave.billboard=0,this.wave.material=new u.SpriteMaterial,this.wave.material.blendMode=null,this.wave.material.program=v.SharedSystem.materials.distortion,this.wave.material.diffuse=v.SharedSystem.textures.wave,this.wave.transform=this.context.get(l.TransformSystem).create(o.vec3.add([0,.5,0],t,o.vec3()),s.Sprite.FlatUp,o.vec3.ONE),this.context.get(c.PostEffectPass).add(this.wave),this.embers=v.SharedSystem.particles.embers.add({uLifespan:[.4,.8,0,0],uOrigin:t,uTarget:o.vec3.add(t,[0,-.2,0],o.vec3()),uRotation:o.vec2.ZERO,uOrientation:o.quat.IDENTITY,uGravity:o.vec3(0,-14,0),uSize:[.2,.8],uRadius:[0,.5],uForce:[6,16]}),this.projectile=new s.BatchMesh(f.doubleSided(v.SharedSystem.geometry.hemisphere)),this.projectile.transform=this.context.get(l.TransformSystem).create(),this.projectile.material=v.SharedSystem.materials.exhaustMaterial,this.context.get(c.ParticleEffectPass).add(this.projectile),this.splash=new s.Sprite,this.splash.billboard=0,this.splash.transform=this.context.get(l.TransformSystem).create(o.vec3.add(t,[0,.5,0],o.vec3()),s.Sprite.FlatUp,o.vec3.ONE),this.splash.material=new u.SpriteMaterial,this.splash.material.program=this.context.get(c.ParticleEffectPass).program,this.splash.material.diffuse=v.SharedSystem.textures.raysInner,this.context.get(c.ParticleEffectPass).add(this.splash),this.burn=this.context.get(c.DecalPass).create(4),this.burn.transform=this.context.get(l.TransformSystem).create(t),this.burn.material=new u.DecalMaterial,this.burn.material.program=this.context.get(c.DecalPass).program,this.burn.material.diffuse=v.SharedSystem.textures.rays,this.pillar=new s.Sprite,this.pillar.billboard=3,o.vec2.set(0,.5,this.pillar.origin),this.pillar.material=new u.SpriteMaterial,this.pillar.material.program=this.context.get(c.ParticleEffectPass).program,this.pillar.material.diffuse=v.SharedSystem.textures.groundDust,this.pillar.transform=this.context.get(l.TransformSystem).create(t),this.context.get(c.ParticleEffectPass).add(this.pillar),this.hitLight=this.context.get(c.PointLightPass).create(),this.hitLight.transform=this.context.get(l.TransformSystem).create(o.vec3.add(t,[0,2,0],o.vec3())),o.vec3.set(1,.8,.5,this.hitLight.color),r=o.mat4.transform([0,3.4,.8],this.mesh.transform.matrix,o.vec3()),a=o.mat4.transform([0,5,3],this.mesh.transform.matrix,o.vec3()),n=o.vec3.set(t[0],a[1],t[2],o.vec3()),o.vec3.centroid(n,a,n),y=m.FollowPath.curve(o.cubicBezier3D.bind(null,r,a,n,t),{frame:.6,duration:.8,ease:m.ease.CubicBezier(0,.75,1,.75)}),g=m.AnimationTimeline(this,{"mesh.armature":d.modelAnimations[this.mesh.armature.key].deactivate,trail:m.FollowPath.Line(y,{length:.1}),"projectile.color":m.PropertyAnimation([{frame:0,value:[1,1,.5,1]}],o.vec4.lerp),"projectile.transform":m.FollowPath(y),"projectile.transform.scale":m.PropertyAnimation([{frame:.6,value:o.vec3.ZERO},{frame:.7,value:[.2,.2,1],ease:m.ease.expoOut},{frame:1.4,value:o.vec3.ZERO,ease:m.ease.expoIn}],o.vec3.lerp),embers:m.EventTrigger([{frame:1.4,value:36}],m.EventTrigger.emit),"hitLight.intensity":m.PropertyAnimation([{frame:1.4,value:10},{frame:1.6,value:0,ease:m.ease.sineIn}],o.lerp),"hitLight.radius":m.PropertyAnimation([{frame:1.4,value:0},{frame:1.6,value:6,ease:m.ease.quartOut}],o.lerp),"pillar.transform.scale":m.PropertyAnimation([{frame:1.4,value:o.vec3.ZERO},{frame:1.9,value:[2,6,2],ease:m.ease.cubicOut}],o.vec3.lerp),"pillar.color":m.PropertyAnimation([{frame:1.4,value:[1,.9,.6,.4]},{frame:1.9,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),"splash.transform.scale":m.PropertyAnimation([{frame:1.4,value:o.vec3.ZERO},{frame:1.8,value:[6,6,6],ease:m.ease.cubicOut}],o.vec3.lerp),"splash.color":m.PropertyAnimation([{frame:1.4,value:[1,.8,.4,.4]},{frame:1.8,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),"burn.transform.scale":m.PropertyAnimation([{frame:1.4,value:o.vec3.ZERO},{frame:1.8,value:[8,4,8],ease:m.ease.quartOut}],o.vec3.lerp),"burn.color":m.PropertyAnimation([{frame:1.6,value:[.2,0,0,1]},{frame:2.4,value:o.vec4.ZERO,ease:m.ease.quadIn}],o.vec4.lerp),"wave.transform.scale":m.PropertyAnimation([{frame:1.4,value:o.vec3.ZERO},{frame:2,value:[10,10,10],ease:m.ease.cubicOut}],o.vec3.lerp),"wave.color":m.PropertyAnimation([{frame:1.4,value:o.vec4.ONE},{frame:2,value:o.vec4.ZERO,ease:m.ease.cubicIn}],o.vec4.lerp),smoke:m.EventTrigger([{frame:.6,value:24}],m.EventTrigger.emit),"muzzle.transform.scale":m.PropertyAnimation([{frame:.6,value:o.vec3.ZERO},{frame:.9,value:[4,4,4],ease:m.ease.quartOut}],o.vec3.lerp),"muzzle.color":m.PropertyAnimation([{frame:.6,value:[1,.8,.4,0]},{frame:.9,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),"light.intensity":m.PropertyAnimation([{frame:.7,value:2},{frame:.9,value:20,ease:m.ease.cubicOut}],o.lerp),"light.color":m.PropertyAnimation([{frame:.6,value:[1,.4,.6]},{frame:.8,value:[1,.6,.4],ease:m.ease.quadIn},{frame:1.1,value:o.vec3.ZERO,ease:m.ease.sineOut}],o.vec3.lerp),"aura.threshold":m.PropertyAnimation([{frame:0,value:0},{frame:1,value:3,ease:m.ease.sineOut}],o.lerp),"reticle.color":m.PropertyAnimation([{frame:0,value:[1,.4,.8,.6]},{frame:1,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),damage:m.EventTrigger([{frame:1.4,value:e}],p.AIUnitSkill.damage)}),x=2.4,b=this.context.currentTime,i.label=1;case 1:return S=this.context.currentTime-b,g(S,this.context.deltaTime),S>x?[3,4]:[4,m.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return v.SharedSystem.particles.smoke.remove(this.smoke),v.SharedSystem.particles.embers.remove(this.embers),this.context.get(l.TransformSystem).delete(this.aura.transform),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.muzzle.transform),this.context.get(l.TransformSystem).delete(this.wave.transform),this.context.get(l.TransformSystem).delete(this.burn.transform),this.context.get(l.TransformSystem).delete(this.splash.transform),this.context.get(l.TransformSystem).delete(this.pillar.transform),this.context.get(l.TransformSystem).delete(this.projectile.transform),this.context.get(l.TransformSystem).delete(this.reticle.transform),this.context.get(c.PointLightPass).delete(this.light),this.context.get(c.DecalPass).delete(this.aura),this.context.get(c.DecalPass).delete(this.burn),this.context.get(c.DecalPass).delete(this.reticle),this.context.get(c.PostEffectPass).remove(this.wave),this.context.get(c.ParticleEffectPass).remove(this.trail),this.context.get(c.ParticleEffectPass).remove(this.muzzle),this.context.get(c.ParticleEffectPass).remove(this.splash),this.context.get(c.ParticleEffectPass).remove(this.pillar),this.context.get(c.ParticleEffectPass).remove(this.projectile),[2]}}))},t.prototype.activate=function(e){var t,r,a,n,f,h;return i(this,(function(i){switch(i.label){case 0:t=this.mesh.transform.position,r=Math.atan2(e[0]-t[0],e[2]-t[2]),this.aura=this.context.get(c.DecalPass).create(4),this.aura.transform=this.context.get(l.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.aura.material=v.SharedSystem.materials.glowSquaresRadialMaterial,this.reticle=this.context.get(c.DecalPass).create(4),this.reticle.transform=this.context.get(l.TransformSystem).create(e),this.reticle.material=new u.DecalMaterial,this.reticle.material.program=this.context.get(c.DecalPass).program,this.reticle.material.diffuse=v.SharedSystem.textures.reticle,this.cylinder=new s.BatchMesh(v.SharedSystem.geometry.lowpolyCylinder),this.cylinder.material=v.SharedSystem.materials.stripesMaterial,this.cylinder.transform=this.context.get(l.TransformSystem).create([0,1.8,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(c.ParticleEffectPass).add(this.cylinder),this.light=this.context.get(c.PointLightPass).create(),this.light.transform=this.context.get(l.TransformSystem).create([0,3,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.light.radius=4,this.flash=new s.Sprite,this.flash.billboard=2,this.flash.transform=this.context.get(l.TransformSystem).create([0,3.4,1.2],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.flash.material=new u.SpriteMaterial,this.flash.material.program=this.context.get(c.ParticleEffectPass).program,this.flash.material.diffuse=v.SharedSystem.textures.sparkle,this.context.get(c.ParticleEffectPass).add(this.flash),this.ring=new s.Sprite,this.ring.billboard=0,this.ring.transform=this.context.get(l.TransformSystem).create(o.vec3.AXIS_Y,s.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.ring.material=new u.SpriteMaterial,this.ring.material.program=this.context.get(c.ParticleEffectPass).program,this.ring.material.diffuse=v.SharedSystem.textures.ring,this.context.get(c.ParticleEffectPass).add(this.ring),a=m.AnimationTimeline(this,{"mesh.armature":d.modelAnimations[this.mesh.armature.key].activate,"mesh.transform.rotation":m.PropertyAnimation([{frame:.2,value:o.quat.copy(this.mesh.transform.rotation,o.quat())},{frame:.8,value:o.quat.axisAngle(o.vec3.AXIS_Y,r,o.quat()),ease:m.ease.quadInOut}],o.quat.slerp),"flash.transform.scale":m.PropertyAnimation([{frame:.9,value:o.vec3.ZERO},{frame:1.2,value:[2,2,2],ease:m.ease.quartOut}],o.vec3.lerp),"flash.color":m.PropertyAnimation([{frame:.9,value:[1,.7,.9,0]},{frame:1.2,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),"ring.transform.scale":m.PropertyAnimation([{frame:.5,value:o.vec3.ZERO},{frame:.9,value:[6,6,6],ease:m.ease.quartOut}],o.vec3.lerp),"ring.color":m.PropertyAnimation([{frame:.5,value:[.8,.2,.4,1]},{frame:.9,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),"light.intensity":m.PropertyAnimation([{frame:.8,value:0},{frame:1.4,value:2,ease:m.ease.sineOut}],o.lerp),"light.color":m.PropertyAnimation([{frame:0,value:[1,.4,.6]}],o.vec3.lerp),"aura.transform.scale":m.PropertyAnimation([{frame:.4,value:[0,4,0]},{frame:.8,value:[5,4,5],ease:m.ease.cubicOut}],o.vec3.lerp),"aura.threshold":m.PropertyAnimation([{frame:.2,value:-3},{frame:1.6,value:0,ease:m.ease.sineOut}],o.lerp),"reticle.transform.scale":m.PropertyAnimation([{frame:.4,value:o.vec3.ZERO},{frame:.8,value:[4,4,4],ease:m.ease.sineOut}],o.vec3.lerp),"reticle.color":m.PropertyAnimation([{frame:0,value:[1,.4,.8,.4]}],o.vec4.lerp),"cylinder.transform.rotation":m.PropertyAnimation([{frame:.4,value:[0,0,0,1]},{frame:.8,value:[.309017,0,0,.951057],ease:m.ease.sineIn}],o.quat.slerp),"cylinder.transform.scale":m.PropertyAnimation([{frame:.4,value:[3,0,3]},{frame:1,value:[0,3,0],ease:m.ease.CubicBezier(.25,.75,.5,.5)}],o.vec3.lerp),"cylinder.color":m.PropertyAnimation([{frame:.4,value:o.vec4.ZERO},{frame:.6,value:[1,.2,.4,1],ease:m.ease.cubicOut}],o.vec4.lerp)}),n=1.6,f=this.context.currentTime,i.label=1;case 1:return h=this.context.currentTime-f,a(h,this.context.deltaTime),h>n?[3,4]:[4,m.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return this.context.get(l.TransformSystem).delete(this.flash.transform),this.context.get(l.TransformSystem).delete(this.cylinder.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(c.ParticleEffectPass).remove(this.flash),this.context.get(c.ParticleEffectPass).remove(this.cylinder),this.context.get(c.ParticleEffectPass).remove(this.ring),[2]}}))},t}(p.AIUnitSkill);t.ArtillerySkill=y},5214:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Decapod=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(6256),u=r(43),f=r(9519),m=r(2392),h=r(1160),d=r(9258),v=r(7940),p=r(4275),y=r(7207),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new p.ArtillerySkill(t.context)],t.strategy=new v.AIStrategy(t.context),t.deathEffect=new y.DeathEffect(t.context),t.movementDuration=.4,t}return n(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("decapod"),this.mesh.transform=this.context.get(l.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),h.modelAnimations[this.mesh.armature.key].activate(0,this.mesh.armature),this.markTiles(!0),this.dust=d.SharedSystem.particles.dust.add({uOrigin:o.vec3.ZERO,uLifespan:[.6,1.2,0,0],uSize:[2,4],uRadius:[0,.2],uOrientation:o.quat.IDENTITY,uForce:[2,5],uTarget:o.vec3.ZERO,uGravity:o.vec3.ZERO,uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]})},t.prototype.delete=function(){this.context.get(l.TransformSystem).delete(this.mesh.transform),this.context.get(s.MeshSystem).delete(this.mesh)},t.prototype.damage=function(e){return i(this,(function(e){return[2]}))},t.prototype.death=function(){return this.deathEffect.use(this)},t.prototype.move=function(e,t){var r,a,n,s,h,v,p;return i(this,(function(i){switch(i.label){case 0:this.shadow=this.context.get(c.DecalPass).create(4),this.shadow.transform=this.context.get(l.TransformSystem).create(),this.shadow.transform.parent=this.mesh.transform,this.shadow.material=new u.DecalMaterial,this.shadow.material.program=this.context.get(c.DecalPass).program,this.shadow.material.diffuse=d.SharedSystem.textures.glow,r=f.AnimationTimeline(this,{"shadow.color":f.PropertyAnimation([{frame:0,value:[.4,.6,1,.4]}],o.vec4.lerp),"shadow.transform.scale":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[6,6,6],ease:f.ease.quadOut}],o.vec3.lerp),"mesh.transform.position":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.4,0],ease:f.ease.cubicOut}],f.BlendTween.vec3),"mesh.transform.rotation":f.PropertyAnimation([{frame:0,value:o.quat.IDENTITY},{frame:1,value:o.quat.axisAngle(o.vec3.AXIS_X,.1*Math.PI,o.quat()),ease:f.ease.sineOut}],f.BlendTween.quat)}),a=t[t.length-1],this.context.get(m.TerrainSystem).tilePosition(e[e.length-1][0],e[e.length-1][1],this.dust.uniform.uniforms.uOrigin),o.vec3.copy(this.dust.uniform.uniforms.uOrigin,this.dust.uniform.uniforms.uTarget),n=f.EventTrigger([{frame:a-.5*this.movementDuration,value:16}],f.EventTrigger.emit),s=this.moveAlongPath(e,t,!0),h=this.context.currentTime,i.label=1;case 1:return v=s.next(),p=this.context.currentTime-h,r(this.movementFloat,this.context.deltaTime),n(p,this.context.deltaTime,this.dust),v.done?[3,5]:[3,2];case 2:return[4,v.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return this.context.get(l.TransformSystem).delete(this.shadow.transform),this.context.get(c.DecalPass).delete(this.shadow),[2]}}))},t}(v.AIUnit);t.Decapod=g},4246:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnitFactory=void 0;var a=r(8636),n=r(5009),i=r(3065),o=r(1427),s=r(5681),l=r(7271),c=r(5214),u=r(9305);t.UnitFactory=function(e){return{0:a.Scarab,1:n.Tarantula,2:i.Stingray,3:o.Locust,4:s.Obelisk,5:l.Monolith,6:c.Decapod,7:u.Isopod,8:n.TarantulaVariant}}},9305:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Isopod=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(6256),u=r(43),f=r(9519),m=r(2392),h=r(1160),d=r(9258),v=r(7940),p=r(7433),y=r(7207),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new p.OrbSkill(t.context)],t.strategy=new v.AIStrategy(t.context),t.deathEffect=new y.DeathEffect(t.context),t.movementDuration=.4,t}return n(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("isopod"),this.mesh.transform=this.context.get(l.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),h.modelAnimations[this.mesh.armature.key].activate(0,this.mesh.armature),this.markTiles(!0),this.dust=d.SharedSystem.particles.dust.add({uOrigin:o.vec3.ZERO,uLifespan:[.6,1.2,0,0],uSize:[2,4],uRadius:[0,.2],uOrientation:o.quat.IDENTITY,uForce:[2,5],uTarget:o.vec3.ZERO,uGravity:o.vec3.ZERO,uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]})},t.prototype.delete=function(){this.context.get(l.TransformSystem).delete(this.mesh.transform),this.context.get(s.MeshSystem).delete(this.mesh),d.SharedSystem.particles.dust.remove(this.dust)},t.prototype.damage=function(e){return i(this,(function(e){return[2]}))},t.prototype.death=function(){return this.deathEffect.use(this)},t.prototype.move=function(e,t){var r,a,n,s,h,v,p;return i(this,(function(i){switch(i.label){case 0:this.shadow=this.context.get(c.DecalPass).create(4),this.shadow.transform=this.context.get(l.TransformSystem).create(),this.shadow.transform.parent=this.mesh.transform,this.shadow.material=new u.DecalMaterial,this.shadow.material.program=this.context.get(c.DecalPass).program,this.shadow.material.diffuse=d.SharedSystem.textures.glow,this.context.get(m.TerrainSystem).tilePosition(e[e.length-1][0],e[e.length-1][1],this.dust.uniform.uniforms.uOrigin),o.vec3.copy(this.dust.uniform.uniforms.uOrigin,this.dust.uniform.uniforms.uTarget),r=f.AnimationTimeline(this,{"shadow.transform.scale":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[6,6,6],ease:f.ease.quadOut}],o.vec3.lerp),"shadow.color":f.PropertyAnimation([{frame:0,value:[.4,.6,1,.4]}],o.vec4.lerp),"mesh.transform.position":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,1,0],ease:f.ease.quartOut}],f.BlendTween.vec3)}),a=t[t.length-1],n=f.EventTrigger([{frame:a-.1,value:16}],f.EventTrigger.emit),s=this.moveAlongPath(e,t,!0),h=this.context.currentTime,i.label=1;case 1:return v=s.next(),p=this.context.currentTime-h,r(this.movementFloat,this.context.deltaTime),n(p,this.context.deltaTime,this.dust),v.done?[3,5]:[3,2];case 2:return[4,v.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return this.context.get(l.TransformSystem).delete(this.shadow.transform),this.context.get(c.DecalPass).delete(this.shadow),[2]}}))},t}(v.AIUnit);t.Isopod=g},7433:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrbSkill=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(6256),u=r(43),f=r(9519),m=r(1160),h=r(9258),d=r(7940),v=r(7718),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=2,t.cardinal=!0,t.damage=0,t}return n(t,e),t.prototype.use=function(e,t){var r,a,n,d,p=this;return i(this,(function(t){switch(t.label){case 0:this.mesh=e.mesh,o.vec2.add([0,1],e.tile,o.vec2()),this.funnel=new s.BatchMesh(h.SharedSystem.geometry.funnel),this.funnel.transform=this.context.get(l.TransformSystem).create([0,.7,.8],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.funnel.material=h.SharedSystem.materials.coneTealMaterial,this.context.get(c.ParticleEffectPass).add(this.funnel),this.core=new s.BatchMesh(h.SharedSystem.geometry.lowpolySphere),this.core.transform=this.context.get(l.TransformSystem).create([0,.7,2.5],s.Sprite.FlatDown,o.vec3.ONE,this.mesh.transform),this.core.material=h.SharedSystem.materials.coreYellowMaterial,this.context.get(c.ParticleEffectPass).add(this.core),this.cone=new s.BatchMesh(h.SharedSystem.geometry.cone),this.cone.transform=this.context.get(l.TransformSystem).create([0,.7,.8],s.Sprite.FlatDown,o.vec3.ONE,this.mesh.transform),this.cone.material=new u.SpriteMaterial,this.cone.material.program=this.context.get(c.ParticleEffectPass).program,this.cone.material.diffuse=h.SharedSystem.textures.wind,this.context.get(c.ParticleEffectPass).add(this.cone),this.beam=new s.Sprite,this.beam.billboard=3,o.vec2.set(0,.5,this.beam.origin),this.beam.material=new u.SpriteMaterial,this.beam.material.program=this.context.get(c.ParticleEffectPass).program,this.beam.material.diffuse=h.SharedSystem.textures.raysBeam,this.beam.transform=this.context.get(l.TransformSystem).create(o.vec3.ZERO,s.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(c.ParticleEffectPass).add(this.beam),this.light=this.context.get(c.PointLightPass).create(),this.light.transform=this.context.get(l.TransformSystem).create([0,1,2.5],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.bulge=new s.Sprite,this.bulge.billboard=2,this.bulge.material=new u.SpriteMaterial,this.bulge.material.blendMode=null,this.bulge.material.program=h.SharedSystem.materials.chromaticAberration,this.bulge.material.diffuse=h.SharedSystem.textures.bulge,this.bulge.transform=this.context.get(l.TransformSystem).create([0,.7,2.5],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(c.PostEffectPass).add(this.bulge),this.ring=new s.Sprite,this.ring.billboard=0,this.ring.material=new u.SpriteMaterial,this.ring.material.program=this.context.get(c.ParticleEffectPass).program,this.ring.material.diffuse=h.SharedSystem.textures.swirl,this.ring.transform=this.context.get(l.TransformSystem).create([0,.7,1.5],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(c.ParticleEffectPass).add(this.ring),r=f.AnimationTimeline(this,{"mesh.armature":m.modelAnimations[this.mesh.armature.key].activate,"ring.transform.scale":f.PropertyAnimation([{frame:.8,value:[0,0,0]},{frame:1.4,value:[8,8,8],ease:f.ease.quadOut}],o.vec3.lerp),"ring.transform.rotation":f.PropertyAnimation([{frame:.8,value:o.quat.IDENTITY},{frame:1.4,value:o.quat.axisAngle(o.vec3.AXIS_Z,Math.PI,o.quat()),ease:f.ease.sineIn}],o.quat.slerp),"ring.color":f.PropertyAnimation([{frame:.8,value:[.8,.2,1,.4]},{frame:1.4,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"bulge.transform.scale":f.PropertyAnimation([{frame:1,value:o.vec3.ZERO},{frame:1.8,value:[10,10,10],ease:f.ease.cubicOut}],o.vec3.lerp),"bulge.color":f.PropertyAnimation([{frame:1,value:o.vec4.ONE},{frame:1.8,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"light.radius":f.PropertyAnimation([{frame:.8,value:0},{frame:1.6,value:5,ease:f.ease.cubicOut}],o.lerp),"light.intensity":f.PropertyAnimation([{frame:.8,value:6},{frame:1.6,value:0,ease:f.ease.sineIn}],o.lerp),"light.color":f.PropertyAnimation([{frame:1,value:[.4,.2,1]}],o.vec3.lerp),"beam.transform.position":f.PropertyAnimation([{frame:0,value:[0,-.5,0]},{frame:.6,value:[0,.7,1.8],ease:f.ease.quadInOut}],o.vec3.lerp),"beam.transform.scale":f.PropertyAnimation([{frame:.2,value:o.vec3.ZERO},{frame:.8,value:[1.5,6,1.5],ease:f.ease.quartOut}],o.vec3.lerp),"beam.color":f.PropertyAnimation([{frame:.2,value:[1,.6,1,0]},{frame:.8,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"funnel.transform.scale":f.PropertyAnimation([{frame:.4,value:[0,0,-2]},{frame:1.4,value:[.6,.6,-.6],ease:f.ease.quadInOut}],o.vec3.lerp),"funnel.color":f.PropertyAnimation([{frame:.8,value:[.8,.2,1,1],ease:f.ease.cubicOut},{frame:1.4,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"core.transform.scale":f.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.6,value:[1.5,1.5,1.5],ease:f.ease.quadOut}],o.vec3.lerp),"core.color":f.PropertyAnimation([{frame:.8,value:[.4,.2,1,1]},{frame:1.6,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"cone.transform.scale":f.PropertyAnimation([{frame:.6,value:[0,1,0]},{frame:1.2,value:[.6,4,.6],ease:f.ease.sineOut}],o.vec3.lerp),"cone.transform.rotation":f.PropertyAnimation([{frame:.6,value:s.Sprite.FlatDown},{frame:1.2,value:o.quat.multiply(s.Sprite.FlatDown,o.quat.axisAngle(o.vec3.AXIS_Y,Math.PI,o.quat()),o.quat()),ease:f.ease.quadOut}],o.quat.slerp),"cone.color":f.PropertyAnimation([{frame:.6,value:[.4,.6,1,1]},{frame:1.2,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"":f.EventTrigger([{frame:1,value:new v.StaticOrb(this.context)}],(function(t,r){r.enabled||(r.place(e.tile[0],e.tile[1]+1),p.context.get(f.AnimationSystem).start(r.appear(p.mesh.transform.position),!0))}))}),a=2,n=this.context.currentTime,t.label=1;case 1:return d=this.context.currentTime-n,r(d,this.context.deltaTime),d>a?[3,4]:[4,f.ActionSignal.WaitNextFrame];case 2:t.sent(),t.label=3;case 3:return[3,1];case 4:return this.context.get(l.TransformSystem).delete(this.cone.transform),this.context.get(l.TransformSystem).delete(this.core.transform),this.context.get(l.TransformSystem).delete(this.funnel.transform),this.context.get(l.TransformSystem).delete(this.beam.transform),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.bulge.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(c.PointLightPass).delete(this.light),this.context.get(c.PostEffectPass).remove(this.bulge),this.context.get(c.ParticleEffectPass).remove(this.cone),this.context.get(c.ParticleEffectPass).remove(this.core),this.context.get(c.ParticleEffectPass).remove(this.funnel),this.context.get(c.ParticleEffectPass).remove(this.beam),this.context.get(c.ParticleEffectPass).remove(this.ring),[2]}}))},t}(d.AIUnitSkill);t.OrbSkill=p},7718:function(e,t,r){"use strict";var a=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.StaticOrb=void 0;var n=r(7594),i=r(391),o=r(3335),s=r(6256),l=r(9519),c=r(2392),u=r(9258),f=function(){function e(e){this.context=e,this.tile=n.vec2()}return Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.orb},enumerable:!1,configurable:!0}),e.prototype.place=function(e,t){n.vec2.set(e,t,this.tile),this.transform=this.context.get(o.TransformSystem).create(),this.context.get(c.TerrainSystem).tilePosition(this.tile[0],this.tile[1],this.transform.position),this.orb=new i.Mesh,this.orb.buffer=u.SharedSystem.geometry.sphereMesh,this.orb.order=3,this.orb.layer=3,this.context.get(i.MeshSystem).list.push(this.orb),this.orb.transform=this.context.get(o.TransformSystem).create(),this.orb.transform.parent=this.transform,this.orb.material=u.SharedSystem.materials.orbMaterial,this.orb.color[0]=0,this.decal=this.context.get(s.DecalPass).create(8),this.decal.transform=this.context.get(o.TransformSystem).create(n.vec3.ZERO,n.quat.IDENTITY,n.vec3.ZERO,this.transform),this.decal.material=u.SharedSystem.materials.corrosionMaterial,this.bolts=u.SharedSystem.particles.bolts.add({uOrigin:n.vec3.add([0,.5,0],this.transform.position,n.vec3()),uRadius:[.6,1.2],uLifespan:[.2,.4,0,0],uGravity:n.vec3.ZERO,uRotation:[0,2*Math.PI],uOrientation:n.quat.IDENTITY,uSize:[.5,2],uFrame:[0,4]})},e.prototype.kill=function(){this.context.get(o.TransformSystem).delete(this.transform),this.context.get(o.TransformSystem).delete(this.orb.transform),this.context.get(o.TransformSystem).delete(this.decal.transform),this.context.get(s.DecalPass).delete(this.decal),this.orb=null,u.SharedSystem.particles.bolts.remove(this.bolts)},e.prototype.appear=function(e){var t,r,i,o;return a(this,(function(a){switch(a.label){case 0:t=l.AnimationTimeline(this,{"transform.position":l.PropertyAnimation([{frame:0,value:n.vec3(this.transform.position[0],e[1]+.7,this.transform.position[2])},{frame:.5,value:n.vec3.copy(this.transform.position,n.vec3()),ease:l.ease.quadIn}],n.vec3.lerp),"decal.transform.scale":l.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.5,value:[8,8,8],ease:l.ease.cubicOut}],n.vec3.lerp),"decal.color":l.PropertyAnimation([{frame:0,value:[0,1,1,1]}],n.vec4.lerp),"orb.transform.scale":l.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.5,value:n.vec3.ONE,ease:l.ease.elasticOut(1,.8)}],n.vec3.lerp)}),this.bolts.rate=.02,r=.5,i=this.context.currentTime,a.label=1;case 1:return o=this.context.currentTime-i,t(o,this.context.deltaTime),o>r?[3,4]:[4,l.ActionSignal.WaitNextFrame];case 2:a.sent(),a.label=3;case 3:return[3,1];case 4:return this.context.get(l.AnimationSystem).start(this.dissolve(),!0),[2]}}))},e.prototype.dissolve=function(){var e,t,r,i;return a(this,(function(a){switch(a.label){case 0:this.bolts.rate=0,e=l.AnimationTimeline(this,{"orb.color":l.PropertyAnimation([{frame:0,value:[0,1,1,1]},{frame:1,value:n.vec4.ZERO,ease:l.ease.quadIn}],n.vec4.lerp),"decal.color":l.PropertyAnimation([{frame:0,value:[0,1,1,1]},{frame:1,value:[0,1,1,0],ease:l.ease.sineOut}],n.vec4.lerp)}),t=1,r=this.context.currentTime,a.label=1;case 1:return i=this.context.currentTime-r,e(i,this.context.deltaTime),i>t?[3,4]:[4,l.ActionSignal.WaitNextFrame];case 2:a.sent(),a.label=3;case 3:return[3,1];case 4:return this.kill(),[2]}}))},e}();t.StaticOrb=f},8362:function(e,t,r){"use strict";var a=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.EnergyLinkEffect=void 0;var n=r(7594),i=r(391),o=r(3335),s=r(9519),l=r(43),c=r(6256),u=r(9258),f=function(){function e(e){this.context=e,this.idleIndex=-1,this.start=n.vec3(),this.middle=n.vec3(),this.end=n.vec3(),this.curve=s.FollowPath.curve(n.quadraticBezier3D.bind(null,this.start,this.middle,this.end),{frame:0,duration:1,ease:s.ease.sineOut})}return e.prototype.activate=function(){var e,t,r,f,m,h;return a(this,(function(a){switch(a.label){case 0:this.shield=new i.Mesh,this.shield.buffer=u.SharedSystem.geometry.sphereMesh,this.shield.material=u.SharedSystem.materials.shieldMaterial,this.shield.transform=this.context.get(o.TransformSystem).create(n.vec3.ZERO,n.quat.IDENTITY,n.vec3.ONE,this.target.mesh.transform),this.context.get(c.ParticleEffectPass).add(this.shield),this.glow=new i.Sprite,this.glow.billboard=2,this.glow.material=new l.SpriteMaterial,this.glow.material.program=this.context.get(c.ParticleEffectPass).program,this.glow.material.diffuse=u.SharedSystem.textures.particle,this.glow.transform=this.context.get(o.TransformSystem).create([0,1.5,0],n.quat.IDENTITY,n.vec3.ONE,this.target.mesh.transform),this.context.get(c.ParticleEffectPass).add(this.glow),this.line=new i.Line(16),e=function(e){return 1-s.ease.quadOut(Math.max(0,1-2*e))-s.ease.quadIn(Math.max(0,4*(e-1)+1))},this.line.ease=function(e){return.2+.8*s.ease.sineIn(Math.max(0,1-2*e))},this.line.addColorFade(e,[1,.8,1]),this.line.material=u.SharedSystem.materials.trailEnergyMaterial,this.context.get(c.ParticleEffectPass).add(this.line),t=s.AnimationTimeline(this,{"shield.color":s.PropertyAnimation([{frame:1,value:[.6,.2,1,1]},{frame:2,value:n.vec4.ZERO,ease:s.ease.sineIn}],n.vec3.lerp),"shield.transform.scale":s.PropertyAnimation([{frame:.2,value:n.vec3.ZERO},{frame:1,value:[1,2,1],ease:s.ease.elasticOut(1,.75)}],n.vec3.lerp),line:s.FollowPath.Line(this.curve,{length:1/(this.line.path.length-1)}),"line.width":s.PropertyAnimation([{frame:0,value:0},{frame:1,value:3,ease:s.ease.quartOut},{frame:2,value:0,ease:s.ease.quadIn}],n.lerp),"glow.transform.scale":s.PropertyAnimation([{frame:.2,value:n.vec3.ZERO},{frame:1,value:[4,4,4],ease:s.ease.quadOut}],n.vec3.lerp),"glow.color":s.PropertyAnimation([{frame:1,value:[.6,.4,1,.2]},{frame:2,value:n.vec4.ZERO,ease:s.ease.sineIn}],n.vec4.lerp)}),r=1,f=this.context.currentTime,a.label=1;case 1:for(m=this.context.currentTime-f,n.mat4.transform([0,4.5,-1.3],this.parent.mesh.transform.matrix,this.start),n.mat4.transform([0,2,0],this.target.mesh.transform.matrix,this.end),n.vec3.set(this.end[0],this.start[1],this.end[2],this.middle),t(Math.min(1,m),this.context.deltaTime),h=0;h<this.line.path.length;h++)this.line.path[h][1]+=.4*Math.cos((this.context.currentTime+.08*h)*Math.PI*2)*e(h/(this.line.path.length-1));return m>r&&-1==this.idleIndex?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:r=2,f=this.context.currentTime,a.label=6;case 6:for(m=this.context.currentTime-f+1,n.mat4.transform([0,4.5,-1.3],this.parent.mesh.transform.matrix,this.start),n.mat4.transform([0,2,0],this.target.mesh.transform.matrix,this.end),n.vec3.set(this.end[0],this.start[1],this.end[2],this.middle),t(m,this.context.deltaTime),h=0;h<this.line.path.length;h++)this.line.path[h][1]+=.4*Math.cos((this.context.currentTime+.08*h)*Math.PI*2)*e(h/(this.line.path.length-1));return m>r?[3,10]:[3,7];case 7:return[4,s.ActionSignal.WaitNextFrame];case 8:a.sent(),a.label=9;case 9:return[3,6];case 10:return this.context.get(o.TransformSystem).delete(this.shield.transform),this.context.get(o.TransformSystem).delete(this.glow.transform),this.context.get(c.ParticleEffectPass).remove(this.shield),this.context.get(c.ParticleEffectPass).remove(this.glow),this.context.get(c.ParticleEffectPass).remove(this.line),[2]}}))},e}();t.EnergyLinkEffect=f},9484:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.FlamethrowerSkill=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(9519),u=r(43),f=r(6256),m=r(1160),h=r(9258),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=4,t.cardinal=!0,t.damage=5,t}return n(t,e),t.prototype.validate=function(e,t){var r=Math.max(t[0]-e[0]-1,e[0]-t[0]),a=Math.max(t[1]-e[1]-1,e[1]-t[1]);return Math.max(r,a)<=this.radius&&0==Math.min(r,a)},t.prototype.use=function(e,t){var r,a,n,d,v,p;return i(this,(function(i){switch(i.label){case 0:r=e.rotate(t,!0),i.label=1;case 1:return(a=r.next()).done?[3,5]:[3,2];case 2:return[4,a.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:this.mesh=e.mesh,this.corridor=new s.BatchMesh(h.SharedSystem.geometry.openBox),this.corridor.material=h.SharedSystem.materials.coreYellowMaterial,this.corridor.transform=this.context.get(l.TransformSystem).create([0,1.2,0],s.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.corridor),this.fire=h.SharedSystem.particles.fire.add({uLifespan:o.vec4(.4,.8,-.3,0),uOrigin:o.mat4.transform([0,1,1],this.mesh.transform.matrix,o.vec3()),uRotation:o.vec2.ZERO,uGravity:o.mat4.transformNormal([0,0,12],this.mesh.transform.matrix,o.vec3()),uSize:o.vec2(.5,1.5),uRadius:o.vec2(0,1.5)}),this.lineA=new s.Line(2),this.lineB=new s.Line(2),this.lineA.width=1.6,this.lineB.width=1.6,o.mat4.transform([0,1.3,0],this.mesh.transform.matrix,this.lineA.path[0]),o.mat4.transform([0,1.7,0],this.mesh.transform.matrix,this.lineB.path[0]),o.mat4.transform([0,1.3,10],this.mesh.transform.matrix,this.lineA.path[1]),o.mat4.transform([0,1.7,10],this.mesh.transform.matrix,this.lineB.path[1]),this.lineA.material=h.SharedSystem.materials.exhaustMaterial,this.lineB.material=h.SharedSystem.materials.exhaustMaterial,this.context.get(f.ParticleEffectPass).add(this.lineA),this.context.get(f.ParticleEffectPass).add(this.lineB),this.burn=this.context.get(f.DecalPass).create(4),this.burn.material=new u.DecalMaterial,this.burn.material.program=this.context.get(f.DecalPass).program,this.burn.material.diffuse=h.SharedSystem.textures.groundDust,this.burn.transform=this.context.get(l.TransformSystem).create([0,0,6],o.quat.axisAngle(o.vec3.AXIS_Y,-.5*Math.PI,o.quat()),o.vec3.ONE,this.mesh.transform),this.light=this.context.get(f.PointLightPass).create([.2,1,.6]),this.light.transform=this.context.get(l.TransformSystem).create([0,2,2],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.heat=new s.BatchMesh(h.SharedSystem.geometry.openBox),this.heat.material=new u.SpriteMaterial,this.heat.material.blendMode=null,this.heat.material.diffuse=h.SharedSystem.textures.perlinNoise,this.heat.material.program=h.SharedSystem.materials.heatDistortion,this.heat.transform=this.context.get(l.TransformSystem).create([0,1,0],s.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(f.PostEffectPass).add(this.heat),this.ring=new s.Sprite,this.ring.billboard=0,this.ring.material=h.SharedSystem.materials.auraTealMaterial,this.ring.transform=this.context.get(l.TransformSystem).create([0,1,1.5],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.ring),n=c.AnimationTimeline(this,{"mesh.armature":m.modelAnimations[this.mesh.armature.key].activateVariant,"ring.transform.scale":c.PropertyAnimation([{frame:.2,value:o.vec3.ZERO},{frame:1.2,value:[6,6,6],ease:c.ease.cubicOut}],o.vec3.lerp),"ring.color":c.PropertyAnimation([{frame:.2,value:[.5,1,.8,1]},{frame:1.2,value:o.vec4.ZERO,ease:c.ease.quadIn}],o.vec4.lerp),"heat.transform.scale":c.PropertyAnimation([{frame:.2,value:[2,0,2]},{frame:1.6,value:[3,8,3],ease:c.ease.cubicOut}],o.vec3.lerp),"heat.color":c.PropertyAnimation([{frame:.2,value:[.2,1,1,1]},{frame:1.6,value:o.vec4.ZERO,ease:c.ease.quadIn}],o.vec4.lerp),"light.radius":c.PropertyAnimation([{frame:.3,value:0},{frame:1.4,value:5,ease:c.ease.cubicOut}],o.lerp),"light.intensity":c.PropertyAnimation([{frame:.3,value:10},{frame:1.4,value:0,ease:c.ease.quadIn}],o.lerp),"corridor.transform.scale":c.PropertyAnimation([{frame:.2,value:[1.5,0,2]},{frame:1,value:[1.5,6,2],ease:c.ease.sineOut}],o.vec3.lerp),"corridor.color":c.PropertyAnimation([{frame:.2,value:[.2,1,1,1]},{frame:1,value:[0,1,1,0],ease:c.ease.quadIn}],o.vec4.lerp),fire:c.EventTrigger([{frame:.2,value:48}],c.EventTrigger.emit),"lineA.path.1":c.PropertyAnimation([{frame:.4,value:this.lineA.path[0]},{frame:1.4,value:o.vec3.copy(this.lineA.path[1],o.vec3()),ease:c.ease.quartOut}],o.vec3.lerp),"lineB.path.1":c.PropertyAnimation([{frame:.4,value:this.lineB.path[0]},{frame:1.4,value:o.vec3.copy(this.lineB.path[1],o.vec3()),ease:c.ease.quartOut}],o.vec3.lerp),"lineA.color":c.PropertyAnimation([{frame:.4,value:[.2,1,.8,1]},{frame:1.4,value:o.vec4.ZERO,ease:c.ease.quadIn}],o.vec4.lerp),"lineB.color":c.PropertyAnimation([{frame:.4,value:[.2,1,.8,1]},{frame:1.4,value:o.vec4.ZERO,ease:c.ease.quadIn}],o.vec4.lerp),"burn.transform.scale":c.PropertyAnimation([{frame:0,value:[10,4,5]}],o.vec3.lerp),"burn.color":c.PropertyAnimation([{frame:.4,value:o.vec4.ZERO},{frame:1,value:[0,0,0,1],ease:c.ease.sineOut},{frame:1.8,value:o.vec4.ZERO,ease:c.ease.quadIn}],o.vec4.lerp)}),d=1.8,v=this.context.currentTime,i.label=6;case 6:return p=this.context.currentTime-v,n(p,this.context.deltaTime),p>d?[3,9]:[4,c.ActionSignal.WaitNextFrame];case 7:i.sent(),i.label=8;case 8:return[3,6];case 9:return this.context.get(l.TransformSystem).delete(this.corridor.transform),this.context.get(l.TransformSystem).delete(this.burn.transform),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.heat.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),h.SharedSystem.particles.fire.remove(this.fire),this.context.get(f.PostEffectPass).remove(this.heat),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.DecalPass).delete(this.burn),this.context.get(f.ParticleEffectPass).remove(this.corridor),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.ParticleEffectPass).remove(this.lineA),this.context.get(f.ParticleEffectPass).remove(this.lineB),[2]}}))},t}(r(7940).AIUnitSkill);t.FlamethrowerSkill=d},1427:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Locust=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(9519),u=r(6256),f=r(1160),m=r(9258),h=r(7940),d=r(7207),v=r(9484),p=r(4293),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=o.vec2(2,2),t.skills=[new v.FlamethrowerSkill(t.context),new p.ShieldLinkSkill(t.context)],t.strategy=new h.AIStrategy(t.context),t.deathEffect=new d.DeathEffect(t.context),t.movementDuration=.8,t}return n(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("locust"),this.mesh.transform=this.context.get(l.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),f.modelAnimations[this.mesh.armature.key].activate(0,this.mesh.armature),this.markTiles(!0)},t.prototype.delete=function(){this.context.get(l.TransformSystem).delete(this.mesh.transform),this.context.get(s.MeshSystem).delete(this.mesh)},t.prototype.damage=function(e){return i(this,(function(e){return[2]}))},t.prototype.death=function(){return this.deathEffect.use(this)},t.prototype.move=function(e,t){var r,a,n;return i(this,(function(i){switch(i.label){case 0:this.motorLeft=new s.BatchMesh(m.SharedSystem.geometry.lowpolyCylinder),this.motorLeft.material=m.SharedSystem.materials.stripesMaterial,this.motorLeft.transform=this.context.get(l.TransformSystem).create([1.3,.7,1.2],s.Sprite.FlatUp,[1,-1.6,1],this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.motorLeft),this.motorRight=new s.BatchMesh(m.SharedSystem.geometry.lowpolyCylinder),this.motorRight.material=m.SharedSystem.materials.stripesMaterial,this.motorRight.transform=this.context.get(l.TransformSystem).create([-1.3,.7,1.2],s.Sprite.FlatUp,[1,-1.6,1],this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.motorRight),r=c.AnimationTimeline(this,{"motorLeft.color":c.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:1,value:[.5,.3,.8,1],ease:c.ease.cubicOut}],o.vec4.lerp),"motorRight.color":c.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:1,value:[.5,.3,.8,1],ease:c.ease.cubicOut}],o.vec4.lerp)}),a=this.moveAlongPath(e,t,!0),i.label=1;case 1:return n=a.next(),r(this.movementFloat,this.context.deltaTime),n.done?[3,5]:[3,2];case 2:return[4,n.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return this.context.get(l.TransformSystem).delete(this.motorLeft.transform),this.context.get(l.TransformSystem).delete(this.motorRight.transform),this.context.get(u.ParticleEffectPass).remove(this.motorLeft),this.context.get(u.ParticleEffectPass).remove(this.motorRight),[2]}}))},t}(h.AIUnit);t.Locust=y},4293:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShieldLinkSkill=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(9519),u=r(43),f=r(6256),m=r(1160),h=r(9258),d=r(7940),v=r(8362),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=4,t.cardinal=!1,t.damage=0,t.links=[],t.idleIndex=-1,t}return n(t,e),t.prototype.use=function(e,t){var r,a,n,p,y,g,x,b=this;return i(this,(function(t){switch(t.label){case 0:for(this.mesh=e.mesh,this.cylinder=new s.BatchMesh(h.SharedSystem.geometry.lowpolyCylinder),this.cylinder.material=new u.SpriteMaterial,this.cylinder.material.program=this.context.get(f.ParticleEffectPass).program,this.cylinder.material.diffuse=h.SharedSystem.textures.wind,this.cylinder.transform=this.context.get(l.TransformSystem).create([0,.5,-1.3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.cylinder),this.wave=new s.Sprite,this.wave.billboard=0,this.wave.material=new u.SpriteMaterial,this.wave.material.program=this.context.get(f.ParticleEffectPass).program,this.wave.material.diffuse=h.SharedSystem.textures.ring,this.wave.transform=this.context.get(l.TransformSystem).create([0,4,-1.3],s.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.wave),this.core=new s.BatchMesh(h.SharedSystem.geometry.lowpolySphere),this.core.material=h.SharedSystem.materials.energyPurpleMaterial,this.core.transform=this.context.get(l.TransformSystem).create([0,4.5,-1.3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.core),this.glow=new s.Sprite,this.glow.billboard=2,this.glow.material=new u.SpriteMaterial,this.glow.material.program=this.context.get(f.ParticleEffectPass).program,this.glow.material.diffuse=h.SharedSystem.textures.glow,this.glow.transform=this.context.get(l.TransformSystem).create([0,4.5,-1.3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.glow),this.pillar=new s.Sprite,this.pillar.billboard=3,o.vec2.set(0,.5,this.pillar.origin),this.pillar.material=new u.SpriteMaterial,this.pillar.material.program=this.context.get(f.ParticleEffectPass).program,this.pillar.material.diffuse=h.SharedSystem.textures.raysBeam,this.pillar.transform=this.context.get(l.TransformSystem).create([0,2,-1.3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.pillar),this.circle=new s.Sprite,this.circle.billboard=0,this.circle.material=h.SharedSystem.materials.flashYellowMaterial,this.circle.transform=this.context.get(l.TransformSystem).create([0,4.5,-1.3],s.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.circle),this.bulge=new s.Sprite,this.bulge.billboard=2,this.bulge.material=new u.SpriteMaterial,this.bulge.material.blendMode=null,this.bulge.material.program=h.SharedSystem.materials.distortion,this.bulge.material.diffuse=h.SharedSystem.textures.bulge,this.bulge.transform=this.context.get(l.TransformSystem).create([0,4.5,-1.3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.PostEffectPass).add(this.bulge),r=this.context.get(d.AISystem).query(e.tile,0),a=0;a<r.length;a++)(n=new v.EnergyLinkEffect(this.context)).parent=e,n.target=r[a],this.links.push(n);p=c.AnimationTimeline(this,{"mesh.armature":m.modelAnimations[this.mesh.armature.key].activate,"cylinder.transform.scale":c.PropertyAnimation([{frame:0,value:[3,1,3]},{frame:.8,value:[1,5,1],ease:c.ease.quadOut}],o.vec3.lerp),"cylinder.transform.rotation":c.PropertyAnimation([{frame:0,value:o.quat.IDENTITY},{frame:.8,value:[0,-1,0,0],ease:c.ease.sineOut}],o.quat.slerp),"cylinder.color":c.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:.3,value:[.4,.6,1,.6],ease:c.ease.quadOut},{frame:.8,value:o.vec4.ZERO,ease:c.ease.quadIn}],o.vec4.lerp),"wave.transform.scale":c.PropertyAnimation([{frame:.6,value:o.vec3.ZERO},{frame:1.2,value:[4,4,4],ease:c.ease.cubicOut}],o.vec3.lerp),"wave.color":c.PropertyAnimation([{frame:.6,value:[.8,.4,1,.4]},{frame:1.2,value:o.vec4.ZERO,ease:c.ease.sineIn}],o.vec4.lerp),"core.transform.scale":c.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.8,value:[1.4,1.4,1.4],ease:c.ease.elasticOut(1,.6)}],o.vec3.lerp),"core.color":c.PropertyAnimation([{frame:0,value:[.4,.4,1,.8]}],o.vec4.lerp),"core.transform.position":c.PropertyAnimation([{frame:.6,value:[0,5.5,-1.3]},{frame:1,value:[0,4.5,-1.3],ease:c.ease.sineInOut}],o.vec3.lerp),"glow.transform.scale":c.PropertyAnimation([{frame:.6,value:o.vec3.ZERO},{frame:1.2,value:[4,4,4],ease:c.ease.quadOut}],o.vec3.lerp),"glow.color":c.PropertyAnimation([{frame:.6,value:o.vec4.ONE},{frame:1.2,value:[.6,.4,1,0],ease:c.ease.sineIn}],o.vec4.lerp),"glow.transform.position":c.PropertyAnimation([{frame:.6,value:[0,5.5,-1.3]},{frame:1,value:[0,4.5,-1.3],ease:c.ease.sineInOut}],o.vec3.lerp),"pillar.transform.scale":c.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.6,value:[4,6,4],ease:c.ease.quartOut}],o.vec3.lerp),"pillar.color":c.PropertyAnimation([{frame:0,value:[1,.5,1,0]},{frame:.6,value:o.vec4.ZERO,ease:c.ease.quadIn}],o.vec4.lerp),"circle.transform.scale":c.PropertyAnimation([{frame:.7,value:o.vec3.ZERO},{frame:1.8,value:[5,5,5],ease:c.ease.cubicOut}],o.vec3.lerp),"circle.color":c.PropertyAnimation([{frame:.7,value:[.4,.2,1,1]},{frame:1.8,value:[0,0,1,0],ease:c.ease.quadIn}],o.vec4.lerp),"bulge.transform.scale":c.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[6,6,6],ease:c.ease.quadOut}],o.vec3.lerp),"bulge.color":c.PropertyAnimation([{frame:.8,value:o.vec4.ONE},{frame:1.4,value:o.vec4.ZERO,ease:c.ease.cubicIn}],o.vec4.lerp),links:c.EventTrigger(this.links.map((function(e,t){return{frame:.5,value:t}})),(function(e,t){-1==e[t].idleIndex&&(e[t].idleIndex=b.context.get(c.AnimationSystem).start(e[t].activate(),!0))}))}),y=1.8,g=this.context.currentTime,t.label=1;case 1:return x=this.context.currentTime-g,p(x,this.context.deltaTime),x>y?[3,4]:[4,c.ActionSignal.WaitNextFrame];case 2:t.sent(),t.label=3;case 3:return[3,1];case 4:return this.context.get(l.TransformSystem).delete(this.cylinder.transform),this.context.get(l.TransformSystem).delete(this.wave.transform),this.context.get(l.TransformSystem).delete(this.pillar.transform),this.context.get(l.TransformSystem).delete(this.circle.transform),this.context.get(l.TransformSystem).delete(this.bulge.transform),this.context.get(f.PostEffectPass).remove(this.bulge),this.context.get(f.ParticleEffectPass).remove(this.cylinder),this.context.get(f.ParticleEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.pillar),this.context.get(f.ParticleEffectPass).remove(this.circle),this.idleIndex=this.context.get(c.AnimationSystem).start(this.idle(),!0),this.idleIndex=-1,[2]}}))},t.prototype.idle=function(){var e,t,r,a,n,s,u;return i(this,(function(i){switch(i.label){case 0:t=-.5*Math.PI/.6,s=this.context.currentTime,i.label=1;case 1:return u=this.context.currentTime-s,e=(u*t-.5*Math.PI)%(2*Math.PI),o.quat.axisAngle(o.vec3.AXIS_Y,e,this.mesh.armature.nodes[2].rotation),this.mesh.armature.frame=0,-1!=this.idleIndex?[3,2]:[3,5];case 2:return[4,c.ActionSignal.WaitNextFrame];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:for(r=c.AnimationTimeline(this,{"mesh.armature.nodes.2.rotation":c.PropertyAnimation([{frame:0,value:o.quat.axisAngle(o.vec3.AXIS_Y,e,o.quat())},{frame:.5,value:o.quat.IDENTITY,ease:c.ease.quadOut}],o.quat.slerp),"mesh.armature":m.modelAnimations[this.mesh.armature.key].deactivate,"core.color":c.PropertyAnimation([{frame:0,value:[.4,.4,1,.8]},{frame:.6,value:o.vec4.ZERO,ease:c.ease.quadOut}],o.vec4.lerp),"glow.color":c.PropertyAnimation([{frame:0,value:[.6,.4,1,0]},{frame:.4,value:o.vec4.ZERO,ease:c.ease.sineIn}],o.vec4.lerp)}),a=0;a<this.links.length;a++)this.links[a].idleIndex=-1;n=1,s=this.context.currentTime,i.label=6;case 6:return u=this.context.currentTime-s,r(u,this.context.deltaTime),u>n?[3,10]:[3,7];case 7:return[4,c.ActionSignal.WaitNextFrame];case 8:i.sent(),i.label=9;case 9:return[3,6];case 10:return this.context.get(l.TransformSystem).delete(this.core.transform),this.context.get(l.TransformSystem).delete(this.glow.transform),this.context.get(f.ParticleEffectPass).remove(this.core),this.context.get(f.ParticleEffectPass).remove(this.glow),[2]}}))},t}(d.AIUnitSkill);t.ShieldLinkSkill=p},7271:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Monolith=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(6256),u=r(9519),f=r(1160),m=r(9258),h=r(7940),d=r(7207),v=r(4080),p=r(3066),y=r(6489),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=o.vec2(3,3),t.skills=[new p.TurretSkill(t.context),new y.SpawnerSkill(t.context),new v.ShockwaveSkill(t.context)],t.strategy=new h.AIStrategy(t.context),t.deathEffect=new d.DeathEffect(t.context),t.movementDuration=1,t}return n(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("monolith"),this.mesh.transform=this.context.get(l.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),f.modelAnimations[this.mesh.armature.key].activate(0,this.mesh.armature),this.markTiles(!0)},t.prototype.delete=function(){this.context.get(l.TransformSystem).delete(this.mesh.transform),this.context.get(s.MeshSystem).delete(this.mesh)},t.prototype.damage=function(e){return i(this,(function(e){return[2]}))},t.prototype.death=function(){return this.deathEffect.use(this)},t.prototype.move=function(e,t){var r,a,n;return i(this,(function(i){switch(i.label){case 0:this.glow=new s.BatchMesh(m.SharedSystem.geometry.openBox),this.glow.material=m.SharedSystem.materials.gradientMaterial,this.glow.transform=this.context.get(l.TransformSystem).create(),this.glow.transform.parent=this.mesh.transform,this.context.get(c.ParticleEffectPass).add(this.glow),this.light=this.context.get(c.PointLightPass).create(),this.light.transform=this.context.get(l.TransformSystem).create(),this.light.transform.parent=this.mesh.transform,o.vec3.set(0,2,0,this.light.transform.position),r=u.AnimationTimeline(this,{"glow.transform.scale":u.PropertyAnimation([{frame:0,value:[6,0,6]},{frame:1,value:[6,3,6],ease:u.ease.quadOut}],o.vec3.lerp),"glow.color":u.PropertyAnimation([{frame:0,value:[1,0,.5,1]},{frame:.5,value:[.5,.7,1,.2],ease:u.ease.sineIn}],o.vec4.lerp),"light.color":u.PropertyAnimation([{frame:0,value:[1,0,.5]},{frame:.5,value:[.5,.7,1],ease:u.ease.sineIn}],o.vec3.lerp),"light.radius":u.PropertyAnimation([{frame:0,value:0},{frame:1,value:6,ease:u.ease.cubicOut}],o.lerp),"light.intensity":u.PropertyAnimation([{frame:0,value:0},{frame:1,value:8,ease:u.ease.sineOut}],o.lerp),"mesh.transform.position":u.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.2,0],ease:u.ease.sineInOut}],u.BlendTween.vec3)}),a=this.moveAlongPath(e,t,!1),i.label=1;case 1:return n=a.next(),r(this.movementFloat,this.context.deltaTime),n.done?[3,5]:[3,2];case 2:return[4,n.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return this.context.get(c.PointLightPass).delete(this.light),this.context.get(c.ParticleEffectPass).remove(this.glow),[2]}}))},t}(h.AIUnit);t.Monolith=g},4080:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShockwaveSkill=void 0;var o=r(7594),s=r(556),l=r(391),c=r(3335),u=r(6256),f=r(43),m=r(6240),h=r(8211),d=r(9519),v=r(1160),p=r(9258),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=5,t.cardinal=!1,t.damage=10,t}return n(t,e),t.prototype.use=function(e,t){var a,n,y,g,x;return i(this,(function(e){switch(e.label){case 0:this.pulse=new l.Mesh,this.pulse.order=1,this.pulse.buffer=p.SharedSystem.geometry.sphereMesh,(a=new f.ShaderMaterial).cullFace=0,a.depthTest=0,a.depthWrite=!1,a.blendMode=f.ShaderMaterial.Premultiply,a.program=s.ShaderProgram(this.context.gl,h.shaders.geometry_vert,r(9447),{}),this.pulse.material=a,this.pulse.transform=this.context.get(c.TransformSystem).create([0,6,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.PostEffectPass).add(this.pulse),this.ring=new l.Sprite,this.ring.billboard=0,this.ring.material=new f.SpriteMaterial,this.ring.material.program=this.context.get(u.ParticleEffectPass).program,this.ring.material.diffuse=p.SharedSystem.textures.swirl,this.ring.transform=this.context.get(c.TransformSystem).create([0,4,0],l.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.ring),this.cylinder=new l.BatchMesh(p.SharedSystem.geometry.lowpolyCylinder),this.cylinder.material=p.SharedSystem.materials.energyHalfPurpleMaterial,this.cylinder.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.cylinder),this.speedlines=p.SharedSystem.particles.energy.add({uLifespan:[.6,1,-.2,0],uOrigin:o.mat4.transform([0,0,0],this.mesh.transform.matrix,o.vec3()),uRotation:o.vec2.ZERO,uGravity:[0,8,0],uSize:[.2,.6],uRadius:[3,5],uForce:o.vec2.ZERO,uTarget:o.mat4.transform([0,5,0],this.mesh.transform.matrix,o.vec3())}),this.cone=new l.BatchMesh(m.doubleSided(p.SharedSystem.geometry.hemisphere)),this.cone.material=p.SharedSystem.materials.absorbTealMaterial,this.cone.transform=this.context.get(c.TransformSystem).create([0,2.5,0],l.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.cone),this.flash=new l.Sprite,this.flash.billboard=2,this.flash.material=new f.SpriteMaterial,this.flash.material.program=this.context.get(u.ParticleEffectPass).program,this.flash.material.diffuse=p.SharedSystem.textures.raysRing,this.flash.transform=this.context.get(c.TransformSystem).create([0,5,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.flash),this.core=new l.BatchMesh(m.doubleSided(p.SharedSystem.geometry.lowpolySphere)),this.core.material=p.SharedSystem.materials.energyPurpleMaterial,this.core.transform=this.context.get(c.TransformSystem).create([0,4,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.core),this.sparkle=new l.Sprite,this.sparkle.billboard=2,this.sparkle.material=new f.SpriteMaterial,this.sparkle.material.program=this.context.get(u.ParticleEffectPass).program,this.sparkle.material.diffuse=p.SharedSystem.textures.sparkle,this.sparkle.transform=this.context.get(c.TransformSystem).create([0,5.4,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.sparkle),n=d.AnimationTimeline(this,{"mesh.armature":v.modelAnimations[this.mesh.armature.key].activate,"mesh.color":d.PropertyAnimation([{frame:1,value:o.vec4.ONE},{frame:1.4,value:[.8,0,.6,1],ease:d.ease.cubicOut},{frame:2,value:o.vec4.ONE,ease:d.ease.sineIn}],o.vec4.lerp),"pulse.transform.scale":d.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:2,value:[16,16,16],ease:d.ease.quadOut}],o.vec3.lerp),"pulse.color":d.PropertyAnimation([{frame:1.4,value:o.vec4.ONE},{frame:2,value:o.vec4.ZERO,ease:d.ease.quadIn}],o.vec4.lerp),"core.transform.scale":d.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.3,value:[2.6,2.6,2.6],ease:d.ease.cubicOut}],o.vec3.lerp),"core.color":d.PropertyAnimation([{frame:.8,value:[.4,1,.8,1]},{frame:1.3,value:o.vec4.ZERO,ease:d.ease.sineIn}],o.vec4.lerp),"sparkle.transform.scale":d.PropertyAnimation([{frame:.7,value:o.vec3.ZERO},{frame:.9,value:[6,2,2],ease:d.ease.cubicOut}],o.vec3.lerp),"sparkle.color":d.PropertyAnimation([{frame:.7,value:[.6,1,1,0]},{frame:.9,value:o.vec4.ZERO,ease:d.ease.quadIn}],o.vec4.lerp),"ring.transform.scale":d.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[8,8,8],ease:d.ease.cubicOut}],o.vec3.lerp),"ring.color":d.PropertyAnimation([{frame:.8,value:[.5,1,1,.4]},{frame:1.4,value:o.vec4.ZERO,ease:d.ease.sineIn}],o.vec4.lerp),"cylinder.transform.scale":d.PropertyAnimation([{frame:.4,value:[0,8,0]},{frame:1.2,value:[2.4,5,2.4],ease:d.ease.quadOut}],o.vec3.lerp),"cylinder.color":d.PropertyAnimation([{frame:.4,value:[.4,.8,1,1]},{frame:1.2,value:o.vec4.ZERO,ease:d.ease.quadIn}],o.vec4.lerp),speedlines:d.EventTrigger([{frame:0,value:32}],d.EventTrigger.emit),"cone.transform.scale":d.PropertyAnimation([{frame:.4,value:[0,0,10]},{frame:1.6,value:[3,3,4],ease:d.ease.cubicOut}],o.vec3.lerp),"cone.color":d.PropertyAnimation([{frame:.4,value:[.2,.8,1,0]},{frame:1.6,value:o.vec4.ZERO,ease:d.ease.quadIn}],o.vec4.lerp),"flash.transform.scale":d.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[5,5,5],ease:d.ease.quartOut}],o.vec3.lerp),"flash.color":d.PropertyAnimation([{frame:.8,value:[1,.8,1,.6]},{frame:1.4,value:o.vec4.ZERO,ease:d.ease.sineIn}],o.vec4.lerp)}),e.label=1;case 1:y=2.4,g=this.context.currentTime,e.label=2;case 2:return x=this.context.currentTime-g,n(x,this.context.deltaTime),x>y?[3,5]:[4,d.ActionSignal.WaitNextFrame];case 3:e.sent(),e.label=4;case 4:return[3,2];case 5:return[3,1];case 6:return this.context.get(c.TransformSystem).delete(this.core.transform),this.context.get(c.TransformSystem).delete(this.sparkle.transform),this.context.get(c.TransformSystem).delete(this.flash.transform),this.context.get(c.TransformSystem).delete(this.cone.transform),this.context.get(c.TransformSystem).delete(this.cylinder.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.pulse.transform),p.SharedSystem.particles.energy.remove(this.speedlines),this.context.get(u.ParticleEffectPass).remove(this.core),this.context.get(u.ParticleEffectPass).remove(this.sparkle),this.context.get(u.ParticleEffectPass).remove(this.flash),this.context.get(u.ParticleEffectPass).remove(this.cylinder),this.context.get(u.ParticleEffectPass).remove(this.cone),this.context.get(u.ParticleEffectPass).remove(this.ring),this.context.get(u.PostEffectPass).remove(this.pulse),[2]}}))},t}(r(7940).AIUnitSkill);t.ShockwaveSkill=y},6489:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SpawnerSkill=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(6256),u=r(43),f=r(9519),m=r(1160),h=r(9258),d=r(7940),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=0,t.cardinal=!0,t.damage=0,t.spawners=[{key:"spawner6",index:6,parent:null,tile:o.vec2(3,1)},{key:"spawner7",index:7,parent:null,tile:o.vec2(1,-1)},{key:"spawner8",index:8,parent:null,tile:o.vec2(1,3)},{key:"spawner9",index:9,parent:null,tile:o.vec2(-1,1)}],t}return n(t,e),t.prototype.use=function(e,t){var r=this;return this.mesh=e.mesh,this.spawners.forEach((function(t){return t.parent=e})),f.AnimationSystem.zip(this.spawners.map((function(t){return r.activateSpawner(t,e)})))},t.prototype.activateSpawner=function(e,t){var r,a,n,v,p,y,g;return i(this,(function(i){switch(i.label){case 0:r=this.mesh.armature.nodes[e.index].position,a=this.mesh.armature.nodes[e.index].rotation,(n=this.context.get(l.TransformSystem).create(r,a,o.vec3.ONE,this.mesh.transform)).recalculate(this.context.frame),e.glow=new s.BatchMesh(h.SharedSystem.geometry.openBox),e.glow.material=h.SharedSystem.materials.gradientMaterial,e.glow.transform=this.context.get(l.TransformSystem).create(o.vec3.ZERO,o.quat.axisAngle(o.vec3.AXIS_Y,.5*Math.PI,o.quat()),o.vec3.ONE,n),this.context.get(c.ParticleEffectPass).add(e.glow),e.beam=new s.Sprite,e.beam.billboard=3,o.vec2.set(0,.5,e.beam.origin),e.beam.material=new u.SpriteMaterial,e.beam.material.program=this.context.get(c.ParticleEffectPass).program,e.beam.material.diffuse=h.SharedSystem.textures.raysBeam,e.beam.transform=this.context.get(l.TransformSystem).create(o.vec3.ZERO,o.quat.axisAngle(o.vec3.AXIS_Y,.5*Math.PI,o.quat()),o.vec3.ONE,n),this.context.get(c.ParticleEffectPass).add(e.beam),e.smoke=h.SharedSystem.particles.smoke.add({uLifespan:[.8,1.2,-.4,0],uOrigin:o.mat4.transform([0,.5,-1],n.matrix,o.vec3()),uGravity:[0,8,0],uRotation:[0,2*Math.PI],uSize:[1,4],uFieldDomain:o.vec4.ONE,uFieldStrength:[4,0]}),e.ring=new s.Sprite,e.ring.billboard=0,e.ring.material=new u.SpriteMaterial,e.ring.material.program=this.context.get(c.ParticleEffectPass).program,e.ring.material.diffuse=h.SharedSystem.textures.swirl,e.ring.transform=this.context.get(l.TransformSystem).create([0,1,0],s.Sprite.FlatUp,o.vec3.ONE,n),this.context.get(c.ParticleEffectPass).add(e.ring),e.light=this.context.get(c.PointLightPass).create([1,.6,.7]),e.light.transform=n,e.scarab=this.context.get(d.AISystem).create(t.tile[0]+e.tile[0],t.tile[1]+e.tile[1],0),v=f.AnimationTimeline(e,{"scarab.mesh.color":f.PropertyAnimation([{frame:.4,value:[16,0,0,.2]},{frame:1.6,value:o.vec4.ONE,ease:f.ease.quadIn}],o.vec4.lerp),"scarab.mesh.transform.rotation":f.PropertyAnimation([{frame:0,value:o.quat.axisAngle(o.vec3.AXIS_Y,Math.atan2(r[0],r[2]),o.quat())}],o.quat.slerp),"scarab.mesh.transform.position":f.PropertyAnimation([{frame:.4,value:o.mat4.transform([0,-.5,-1],n.matrix,o.vec3())},{frame:1.6,value:o.vec3.copy(e.scarab.mesh.transform.position,o.vec3()),ease:f.ease.quartOut}],o.vec3.lerp),"light.radius":f.PropertyAnimation([{frame:.2,value:0},{frame:1.2,value:4,ease:f.ease.quadOut}],o.lerp),"light.intensity":f.PropertyAnimation([{frame:.2,value:6},{frame:1.2,value:0,ease:f.ease.sineIn}],o.lerp),"parent.mesh.armature":m.modelAnimations[e.parent.mesh.armature.key][e.key],"glow.transform.scale":f.PropertyAnimation([{frame:.2,value:[1,0,1]},{frame:1.1,value:[1,4,1],ease:f.ease.cubicOut}],o.vec3.lerp),"glow.color":f.PropertyAnimation([{frame:.2,value:[1,.4,.6,0]},{frame:1.1,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"beam.transform.scale":f.PropertyAnimation([{frame:.4,value:[4,0,4]},{frame:.8,value:[2,4,2],ease:f.ease.quartOut}],o.vec3.lerp),"beam.color":f.PropertyAnimation([{frame:.4,value:[.8,.7,1,0]},{frame:.8,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),smoke:f.EventTrigger([{frame:0,value:24}],f.EventTrigger.emit),"ring.transform.scale":f.PropertyAnimation([{frame:.4,value:o.vec3.ZERO},{frame:1,value:[6,6,6],ease:f.ease.cubicOut}],o.vec3.lerp),"ring.color":f.PropertyAnimation([{frame:.4,value:[1,.7,.8,.4]},{frame:1,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp)}),p=1.6,y=this.context.currentTime,i.label=1;case 1:return g=this.context.currentTime-y,v(g,this.context.deltaTime),g>p?[3,5]:[3,2];case 2:return[4,f.ActionSignal.WaitNextFrame];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return this.context.get(l.TransformSystem).delete(e.light.transform),this.context.get(l.TransformSystem).delete(e.ring.transform),this.context.get(l.TransformSystem).delete(e.glow.transform),this.context.get(l.TransformSystem).delete(e.beam.transform),this.context.get(c.ParticleEffectPass).remove(e.ring),this.context.get(c.ParticleEffectPass).remove(e.glow),this.context.get(c.ParticleEffectPass).remove(e.beam),h.SharedSystem.particles.smoke.remove(e.smoke),this.context.get(c.PointLightPass).delete(e.light),[2]}}))},t}(d.AIUnitSkill);t.SpawnerSkill=v},3066:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.TurretSkill=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(6256),u=r(43),f=r(9519),m=r(2392),h=r(1160),d=r(9258),v=r(7940),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=4,t.cardinal=!1,t.damage=2,t.turrets=[{key:"turret11",index:10,parent:null,context:t.context,damage:t.damage},{key:"turret01",index:12,parent:null,context:t.context,damage:t.damage},{key:"turret00",index:14,parent:null,context:t.context,damage:t.damage},{key:"turret10",index:16,parent:null,context:t.context,damage:t.damage}],t}return n(t,e),t.prototype.validate=function(e,t){var r=t[0]-e[0]-1,a=t[1]-e[1]-1;return r*r+a*a<=this.radius*this.radius},t.prototype.use=function(e,t){var r=this;return this.mesh=e.mesh,this.turrets.forEach((function(t){return t.parent=e})),f.AnimationSystem.zip(this.turrets.map((function(e){return r.activateTurret(e,t)})))},t.prototype.activateTurret=function(e,t){var r,a,n,p,y,g,x,b,S,P,w,T,O,M,A,E,_,I,q;return i(this,(function(i){switch(i.label){case 0:if(r=o.mat4.transform(o.vec3.ZERO,this.mesh.armature.nodes[e.index].globalTransform,o.vec3()),a=Math.atan2(r[0],r[2]),o.vec3.add(this.mesh.transform.position,r,r),n=this.context.get(m.TerrainSystem).tilePosition(t[0],t[1],o.vec3()),p=o.vec3.subtract(n,r,o.vec3()),y=Math.atan2(p[0],p[2]),Math.abs(o.shortestAngle(y,a))>.25*Math.PI)return[2];g=o.quat.axisAngle(o.vec3.AXIS_Y,a,o.quat()),x=o.quat.fromNormal(o.vec3.normalize(p,o.vec3()),o.vec3.AXIS_Y,o.quat()),e.dust=new s.Sprite,e.dust.billboard=3,o.vec2.set(0,.5,e.dust.origin),e.dust.material=new u.SpriteMaterial,e.dust.material.program=this.context.get(c.ParticleEffectPass).program,e.dust.material.diffuse=d.SharedSystem.textures.groundDust,e.dust.transform=this.context.get(l.TransformSystem).create(n),this.context.get(c.ParticleEffectPass).add(e.dust),(b=new u.SpriteMaterial).program=this.context.get(c.ParticleEffectPass).program,b.diffuse=d.SharedSystem.gradients.tealLine,e.trailLeft=new s.Line(2),e.trailLeft.width=.3,e.trailLeft.ease=f.ease.reverse(f.ease.quadIn),e.trailLeft.addColorFade(e.trailLeft.ease),e.trailLeft.material=b,this.context.get(c.ParticleEffectPass).add(e.trailLeft),e.trailRight=new s.Line(2),e.trailRight.width=.3,e.trailRight.ease=f.ease.reverse(f.ease.quadIn),e.trailRight.addColorFade(e.trailRight.ease),e.trailRight.material=b,this.context.get(c.ParticleEffectPass).add(e.trailRight),S=o.mat4.fromRotationTranslationScale(x,r,o.vec3.ONE,o.mat4()),P=o.mat4.transform([.25,0,1],S,o.vec3()),w=o.mat4.transform([-.25,0,1],S,o.vec3()),T=o.vec3.add(P,p,o.vec3()),O=o.vec3.add(w,p,o.vec3()),(M=new u.SpriteMaterial).program=this.context.get(c.ParticleEffectPass).program,M.diffuse=d.SharedSystem.textures.rays,e.flashLeft=new s.Sprite,e.flashLeft.billboard=2,e.flashLeft.material=M,e.flashRight=new s.Sprite,e.flashRight.billboard=2,e.flashRight.material=e.flashLeft.material,e.flashLeft.transform=this.context.get(l.TransformSystem).create(o.mat4.transform([.25,0,1.5],S,o.vec3())),e.flashRight.transform=this.context.get(l.TransformSystem).create(o.mat4.transform([-.25,0,1.5],S,o.vec3())),this.context.get(c.ParticleEffectPass).add(e.flashLeft),this.context.get(c.ParticleEffectPass).add(e.flashRight),e.sparks=d.SharedSystem.particles.sparks.add({uLifespan:[.4,.8,0,0],uOrigin:n,uTarget:o.vec3.add([0,-.2,0],n,o.vec3()),uLength:[.1,.2],uSize:[.2,.4],uForce:[4,12],uRadius:[.2,.2],uGravity:[0,-24,0]}),e.ring=new s.Sprite,e.ring.billboard=0,e.ring.material=new u.SpriteMaterial,e.ring.material.program=this.context.get(c.ParticleEffectPass).program,e.ring.material.diffuse=d.SharedSystem.textures.ring,e.ring.transform=this.context.get(l.TransformSystem).create(o.vec3.add(n,[0,.2,0],o.vec3()),s.Sprite.FlatUp),this.context.get(c.ParticleEffectPass).add(e.ring),e.wave=new s.BatchMesh(d.SharedSystem.geometry.lowpolyCylinder),e.wave.material=d.SharedSystem.materials.ringDustMaterial,e.wave.transform=this.context.get(l.TransformSystem).create(n,o.quat.IDENTITY),this.context.get(c.ParticleEffectPass).add(e.wave),e.light=this.context.get(c.PointLightPass).create([.4,1,.9]),e.light.transform=this.context.get(l.TransformSystem).create(o.vec3.add([0,1,0],n,o.vec3())),A=f.AnimationTimeline(e,((q={"parent.mesh.armature":h.modelAnimations[e.parent.mesh.armature.key][e.key]})["parent.mesh.armature.nodes."+e.index+".rotation"]=f.PropertyAnimation([{frame:0,value:g},{frame:.4,value:x,ease:f.ease.cubicOut},{frame:.8,value:x,ease:f.ease.linear},{frame:1.4,value:g,ease:f.ease.quadInOut}],o.quat.slerp),q["dust.transform.scale"]=f.PropertyAnimation([{frame:.7,value:o.vec3.ZERO},{frame:1.2,value:[1.6,4,1.6],ease:f.ease.quartOut}],o.vec3.lerp),q["dust.color"]=f.PropertyAnimation([{frame:.7,value:[0,.1,.1,1]},{frame:1.2,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),q.trailLeft=f.FollowPath.Line(f.PropertyAnimation([{frame:.4,value:P},{frame:.6,value:T,ease:f.ease.linear}],o.vec3.lerp),{length:.24}),q.trailRight=f.FollowPath.Line(f.PropertyAnimation([{frame:.4,value:w},{frame:.6,value:O,ease:f.ease.linear}],o.vec3.lerp),{length:.24}),q["flashLeft.transform.scale"]=f.PropertyAnimation([{frame:.3,value:o.vec3.ZERO},{frame:.5,value:[3,3,3],ease:f.ease.cubicOut}],o.vec3.lerp),q["flashLeft.color"]=f.PropertyAnimation([{frame:.3,value:[.6,1,1,0]},{frame:.5,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),q["flashRight.transform.scale"]=f.PropertyAnimation([{frame:.3,value:o.vec3.ZERO},{frame:.5,value:[3,3,3],ease:f.ease.cubicOut}],o.vec3.lerp),q["flashRight.color"]=f.PropertyAnimation([{frame:.3,value:[.6,1,1,0]},{frame:.5,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),q.sparks=f.EventTrigger([{frame:.5,value:24}],f.EventTrigger.emit),q["ring.transform.scale"]=f.PropertyAnimation([{frame:.6,value:o.vec3.ZERO},{frame:1,value:[4,4,4],ease:f.ease.cubicOut}],o.vec3.lerp),q["ring.color"]=f.PropertyAnimation([{frame:.6,value:[.4,1,.9,.4]},{frame:1,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),q["light.radius"]=f.PropertyAnimation([{frame:.6,value:0},{frame:1,value:4,ease:f.ease.cubicOut}],o.lerp),q["light.intensity"]=f.PropertyAnimation([{frame:.6,value:4},{frame:1,value:0,ease:f.ease.sineIn}],o.lerp),q["wave.transform.scale"]=f.PropertyAnimation([{frame:.7,value:[0,2,0]},{frame:1.2,value:[4,1,4],ease:f.ease.quartOut}],o.vec3.lerp),q["wave.color"]=f.PropertyAnimation([{frame:.7,value:[.2,1,.8,1]},{frame:1.2,value:o.vec4.ZERO,ease:f.ease.sineOut}],o.vec4.lerp),q.damage=f.EventTrigger([{frame:.6,value:t}],v.AIUnitSkill.damage),q)),E=1.4,_=this.context.currentTime,i.label=1;case 1:return I=this.context.currentTime-_,A(I,this.context.deltaTime),I>E?[3,5]:[3,2];case 2:return[4,f.ActionSignal.WaitNextFrame];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return d.SharedSystem.particles.sparks.remove(e.sparks),this.context.get(l.TransformSystem).delete(e.wave.transform),this.context.get(l.TransformSystem).delete(e.dust.transform),this.context.get(l.TransformSystem).delete(e.flashLeft.transform),this.context.get(l.TransformSystem).delete(e.flashRight.transform),this.context.get(l.TransformSystem).delete(e.light.transform),this.context.get(l.TransformSystem).delete(e.ring.transform),this.context.get(c.PointLightPass).delete(e.light),this.context.get(c.ParticleEffectPass).remove(e.wave),this.context.get(c.ParticleEffectPass).remove(e.dust),this.context.get(c.ParticleEffectPass).remove(e.flashLeft),this.context.get(c.ParticleEffectPass).remove(e.flashRight),this.context.get(c.ParticleEffectPass).remove(e.ring),[2]}}))},t}(v.AIUnitSkill);t.TurretSkill=p},121:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BeamSkill=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(43),u=r(6256),f=r(9519),m=r(1160),h=r(9258),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=8,t.cardinal=!0,t.damage=1,t.beams=[],t.active=!1,t}return n(t,e),t.prototype.use=function(e,t){return this.mesh=e.mesh,this.active?this.deactivate():this.activate()},t.prototype.activate=function(){var e,t,r,a,n,d,v,p=this;return i(this,(function(i){switch(i.label){case 0:this.active=!0,this.beams[0]=new s.Line(2),this.beams[1]=new s.Line(2),this.beams[2]=new s.Line(2),this.beams[3]=new s.Line(2),(e=new c.SpriteMaterial).program=h.SharedSystem.materials.beamLinearProgram,o.vec2.set(4,8,e.uvTransform),e.diffuse=h.SharedSystem.gradients.redPurple,this.beams[0].material=e,this.beams[1].material=e,this.beams[2].material=e,this.beams[3].material=e,this.context.get(u.ParticleEffectPass).add(this.beams[0]),this.context.get(u.ParticleEffectPass).add(this.beams[1]),this.context.get(u.ParticleEffectPass).add(this.beams[2]),this.context.get(u.ParticleEffectPass).add(this.beams[3]),t=[o.vec3(0,.8,.5),o.vec3(.5,.8,0),o.vec3(0,.8,-.5),o.vec3(-.5,.8,0)].map((function(e){return o.mat4.transform(e,p.mesh.transform.matrix,o.vec3())})),r=[o.vec3(0,.8,20),o.vec3(20,.8,0),o.vec3(0,.8,-20),o.vec3(-20,.8,0)].map((function(e){return o.mat4.transform(e,p.mesh.transform.matrix,o.vec3())})),o.vec3.copy(t[0],this.beams[0].path[0]),o.vec3.copy(t[1],this.beams[1].path[0]),o.vec3.copy(t[2],this.beams[2].path[0]),o.vec3.copy(t[3],this.beams[3].path[0]),this.center=new s.Sprite,this.center.billboard=0,this.center.material=new c.SpriteMaterial,this.center.material.program=h.SharedSystem.materials.beamRadialProgram,o.vec2.set(8,-16,this.center.material.uvTransform),this.center.material.diffuse=h.SharedSystem.gradients.redPurple,this.center.transform=this.context.get(l.TransformSystem).create([0,1,0],s.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.center),this.beam=new s.Sprite,this.beam.billboard=3,this.beam.material=new c.SpriteMaterial,this.beam.material.program=this.context.get(u.ParticleEffectPass).program,this.beam.material.diffuse=h.SharedSystem.textures.raysBeam,o.vec2.set(0,.5,this.beam.origin),this.beam.transform=this.context.get(l.TransformSystem).create([0,2,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.beam),this.ring=new s.Sprite,this.ring.billboard=0,this.ring.material=new c.SpriteMaterial,this.ring.material.program=this.context.get(u.ParticleEffectPass).program,this.ring.material.diffuse=h.SharedSystem.textures.swirl,this.ring.transform=this.context.get(l.TransformSystem).create([0,2,0],s.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.ring),this.tubeX=new s.BatchMesh(h.SharedSystem.geometry.cylinder),this.tubeZ=new s.BatchMesh(h.SharedSystem.geometry.cylinder),this.tubeX.transform=this.context.get(l.TransformSystem).create([0,.8,0],o.quat.axisAngle(o.vec3.AXIS_X,.5*Math.PI,o.quat()),o.vec3.ONE,this.mesh.transform),this.tubeZ.transform=this.context.get(l.TransformSystem).create([0,.8,0],o.quat.axisAngle(o.vec3.AXIS_Z,.5*Math.PI,o.quat()),o.vec3.ONE,this.mesh.transform),this.tubeX.material=this.tubeZ.material=h.SharedSystem.materials.stripesBlockyMaterial,this.context.get(u.ParticleEffectPass).add(this.tubeX),this.context.get(u.ParticleEffectPass).add(this.tubeZ),this.cylinder=new s.BatchMesh(h.SharedSystem.geometry.lowpolyCylinder),this.cylinder.transform=this.context.get(l.TransformSystem).create([0,0,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.cylinder.material=new c.SpriteMaterial,this.cylinder.material.program=this.context.get(u.ParticleEffectPass).program,this.cylinder.material.diffuse=h.SharedSystem.textures.wind,this.context.get(u.ParticleEffectPass).add(this.cylinder),this.light=this.context.get(u.PointLightPass).create(),this.light.transform=this.context.get(l.TransformSystem).create([0,2,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),a=f.AnimationTimeline(this,{"mesh.armature":m.modelAnimations[this.mesh.armature.key].activate,"mesh.color":f.PropertyAnimation([{frame:.8,value:o.vec4.ONE},{frame:1.2,value:[10,.5,.8,1],ease:f.ease.quadOut},{frame:1.6,value:o.vec4.ONE,ease:f.ease.sineIn}],o.vec4.lerp),"light.radius":f.PropertyAnimation([{frame:.4,value:0},{frame:1.4,value:5,ease:f.ease.quadOut}],o.lerp),"light.intensity":f.PropertyAnimation([{frame:.4,value:4},{frame:1.4,value:0,ease:f.ease.sineIn}],o.lerp),"light.color":f.PropertyAnimation([{frame:0,value:[1,.5,.8]}],o.vec3.lerp),"center.transform.scale":f.PropertyAnimation([{frame:.6,value:o.vec3.ZERO},{frame:1.8,value:[6,6,6],ease:f.ease.quartOut}],o.vec3.lerp),"center.color":f.PropertyAnimation([{frame:.6,value:o.vec4.ONE},{frame:1.8,value:o.vec4.ZERO,ease:f.ease.cubicIn}],o.vec4.lerp),"cylinder.transform.scale":f.PropertyAnimation([{frame:.4,value:[4,0,-4]},{frame:1,value:[.8,3,-.8],ease:f.ease.cubicOut}],o.vec3.lerp),"cylinder.transform.rotation":f.PropertyAnimation([{frame:.4,value:o.quat.IDENTITY},{frame:1,value:o.quat.axisAngle(o.vec3.AXIS_Y,Math.PI,o.quat()),ease:f.ease.sineIn}],o.quat.slerp),"cylinder.color":f.PropertyAnimation([{frame:.4,value:[.4,1,.8,.2]},{frame:1,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"tubeX.transform.scale":f.PropertyAnimation([{frame:.6,value:[1,0,1]},{frame:1.2,value:[1,8,1],ease:f.ease.quadOut}],o.vec3.lerp),"tubeZ.transform.scale":f.PropertyAnimation([{frame:.6,value:[1,0,1]},{frame:1.2,value:[1,8,1],ease:f.ease.quadOut}],o.vec3.lerp),"tubeX.color":f.PropertyAnimation([{frame:.6,value:[1,1,1,0]},{frame:1.2,value:[.6,1,1,1],ease:f.ease.sineOut}],o.vec4.lerp),"tubeZ.color":f.PropertyAnimation([{frame:.6,value:[1,1,1,0]},{frame:1.2,value:[.6,1,1,1],ease:f.ease.sineOut}],o.vec4.lerp),"beam.transform.scale":f.PropertyAnimation([{frame:.4,value:o.vec3.ZERO},{frame:1,value:[1,4,1],ease:f.ease.cubicOut}],o.vec3.lerp),"beam.color":f.PropertyAnimation([{frame:.4,value:[1,.2,.5,.2]},{frame:1,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"ring.transform.rotation":f.PropertyAnimation([{frame:.5,value:s.Sprite.FlatUp},{frame:1,value:o.quat.multiply(o.quat.axisAngle(o.vec3.AXIS_Y,-Math.PI,o.quat()),s.Sprite.FlatUp,o.quat()),ease:f.ease.quadOut}],o.quat.slerp),"ring.transform.scale":f.PropertyAnimation([{frame:.5,value:o.vec3.ZERO},{frame:1,value:[6,6,6],ease:f.ease.cubicOut}],o.vec3.lerp),"ring.color":f.PropertyAnimation([{frame:.5,value:[.6,1,.9,.4]},{frame:1,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"beams.0.width":f.PropertyAnimation([{frame:.7,value:0},{frame:1.4,value:1,ease:f.ease.quadOut}],o.lerp),"beams.1.width":f.PropertyAnimation([{frame:.7,value:0},{frame:1.4,value:1,ease:f.ease.quadOut}],o.lerp),"beams.2.width":f.PropertyAnimation([{frame:.7,value:0},{frame:1.4,value:1,ease:f.ease.quadOut}],o.lerp),"beams.3.width":f.PropertyAnimation([{frame:.7,value:0},{frame:1.4,value:1,ease:f.ease.quadOut}],o.lerp),"beams.0.path.1":f.PropertyAnimation([{frame:.7,value:t[0]},{frame:1.2,value:r[0],ease:f.ease.cubicOut}],o.vec3.lerp),"beams.1.path.1":f.PropertyAnimation([{frame:.7,value:t[1]},{frame:1.2,value:r[1],ease:f.ease.cubicOut}],o.vec3.lerp),"beams.2.path.1":f.PropertyAnimation([{frame:.7,value:t[2]},{frame:1.2,value:r[2],ease:f.ease.cubicOut}],o.vec3.lerp),"beams.3.path.1":f.PropertyAnimation([{frame:.7,value:t[3]},{frame:1.2,value:r[3],ease:f.ease.cubicOut}],o.vec3.lerp)}),n=2,d=this.context.currentTime,i.label=1;case 1:return v=this.context.currentTime-d,a(v,this.context.deltaTime),v>n?[3,4]:[4,f.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(l.TransformSystem).delete(this.beam.transform),this.context.get(l.TransformSystem).delete(this.center.transform),this.context.get(l.TransformSystem).delete(this.cylinder.transform),this.context.get(u.PointLightPass).delete(this.light),this.context.get(u.ParticleEffectPass).remove(this.ring),this.context.get(u.ParticleEffectPass).remove(this.beam),this.context.get(u.ParticleEffectPass).remove(this.center),this.context.get(u.ParticleEffectPass).remove(this.cylinder),[2]}}))},t.prototype.deactivate=function(){var e,t,r,a;return i(this,(function(n){switch(n.label){case 0:this.active=!1,e=f.AnimationTimeline(this,{"mesh.armature":m.modelAnimations[this.mesh.armature.key].deactivate,"tubeX.color":f.PropertyAnimation([{frame:0,value:[.6,1,1,1]},{frame:.6,value:[1,0,1,0],ease:f.ease.quadIn}],o.vec4.lerp),"tubeZ.color":f.PropertyAnimation([{frame:0,value:[.6,1,1,1]},{frame:.6,value:[1,0,1,0],ease:f.ease.quadIn}],o.vec4.lerp),"beams.0.color":f.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.5,value:[0,.4,.3,.8],ease:f.ease.quadOut}],o.vec4.lerp),"beams.1.color":f.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.5,value:[0,.4,.3,.8],ease:f.ease.quadOut}],o.vec4.lerp),"beams.2.color":f.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.5,value:[0,.4,.3,.8],ease:f.ease.quadOut}],o.vec4.lerp),"beams.3.color":f.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.5,value:[0,.4,.3,.8],ease:f.ease.quadOut}],o.vec4.lerp),"beams.0.width":f.PropertyAnimation([{frame:0,value:1},{frame:.5,value:0,ease:f.ease.sineIn}],o.lerp),"beams.1.width":f.PropertyAnimation([{frame:0,value:1},{frame:.5,value:0,ease:f.ease.sineIn}],o.lerp),"beams.2.width":f.PropertyAnimation([{frame:0,value:1},{frame:.5,value:0,ease:f.ease.sineIn}],o.lerp),"beams.3.width":f.PropertyAnimation([{frame:0,value:1},{frame:.5,value:0,ease:f.ease.sineIn}],o.lerp)}),t=1,r=this.context.currentTime,n.label=1;case 1:return a=this.context.currentTime-r,e(a,this.context.deltaTime),a>t?[3,4]:[4,f.ActionSignal.WaitNextFrame];case 2:n.sent(),n.label=3;case 3:return[3,1];case 4:return this.context.get(l.TransformSystem).delete(this.tubeX.transform),this.context.get(l.TransformSystem).delete(this.tubeZ.transform),this.context.get(u.ParticleEffectPass).remove(this.tubeX),this.context.get(u.ParticleEffectPass).remove(this.tubeZ),this.context.get(u.ParticleEffectPass).remove(this.beams[0]),this.context.get(u.ParticleEffectPass).remove(this.beams[1]),this.context.get(u.ParticleEffectPass).remove(this.beams[2]),this.context.get(u.ParticleEffectPass).remove(this.beams[3]),[2]}}))},t}(r(7940).AIUnitSkill);t.BeamSkill=d},5681:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Obelisk=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(9519),u=r(1160),f=r(7940),m=r(7207),h=r(121),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new h.BeamSkill(t.context)],t.strategy=new f.AIStrategy(t.context),t.deathEffect=new m.DeathEffect(t.context),t.movementDuration=.8,t}return n(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("obelisk"),this.mesh.transform=this.context.get(l.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),u.modelAnimations[this.mesh.armature.key].activate(0,this.mesh.armature),this.markTiles(!0)},t.prototype.delete=function(){this.context.get(l.TransformSystem).delete(this.mesh.transform),this.context.get(s.MeshSystem).delete(this.mesh)},t.prototype.damage=function(e){return i(this,(function(e){return[2]}))},t.prototype.death=function(){return this.deathEffect.use(this)},t.prototype.move=function(e,t){var r,a,n;return i(this,(function(i){switch(i.label){case 0:if(!this.skills[0].active)return[3,5];a=this.skills[0].deactivate(),i.label=1;case 1:return(n=a.next()).done?[3,5]:[3,2];case 2:return[4,n.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:r=c.AnimationTimeline(this,{"mesh.transform.position":c.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.5,0],ease:c.ease.sineOut}],c.BlendTween.vec3)}),a=this.moveAlongPath(e,t,!1),i.label=6;case 6:return n=a.next(),r(this.movementFloat,this.context.deltaTime),n.done?[3,10]:[3,7];case 7:return[4,n.value];case 8:i.sent(),i.label=9;case 9:return[3,6];case 10:return[2]}}))},t}(f.AIUnit);t.Obelisk=d},8636:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Scarab=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(9519),u=r(1160),f=r(7940),m=r(7207),h=r(9986),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new h.StrikeSkill(t.context)],t.strategy=new f.AIStrategy(t.context),t.gainMovementPoints=3,t.gainActionPoints=1,t.movementDuration=.4,t.deathEffect=new m.DeathEffect(t.context),t}return n(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("scarab"),this.mesh.transform=this.context.get(l.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),u.modelAnimations[this.mesh.armature.key].activate(0,this.mesh.armature),this.markTiles(!0)},t.prototype.delete=function(){this.context.get(l.TransformSystem).delete(this.mesh.transform),this.context.get(s.MeshSystem).delete(this.mesh)},t.prototype.damage=function(e){return i(this,(function(e){return[2]}))},t.prototype.death=function(){return this.deathEffect.use(this)},t.prototype.move=function(e,t){var r,a,n;return i(this,(function(i){switch(i.label){case 0:r=c.AnimationTimeline(this,{"mesh.transform.position":c.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.2,0],ease:c.ease.quadIn}],c.BlendTween.vec3),"mesh.transform.rotation":c.PropertyAnimation([{frame:0,value:o.quat.IDENTITY},{frame:1,value:o.quat.axisAngle(o.vec3.AXIS_X,.04*Math.PI,o.quat()),ease:c.ease.sineIn}],c.BlendTween.quat)}),a=this.moveAlongPath(e,t,!0),i.label=1;case 1:return n=a.next(),r(this.movementFloat,this.context.deltaTime),n.done?[3,5]:[3,2];case 2:return[4,n.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return[2]}}))},t}(f.AIUnit);t.Scarab=d},9986:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.StrikeSkill=void 0;var s=r(7594),l=r(391),c=r(3335),u=r(6256),f=r(43),m=r(9519),h=r(1160),d=r(9258),v=r(7940),p={"beam.transform.scale":m.PropertyAnimation([{frame:.4,value:s.vec3.ZERO},{frame:1,value:[2,6,2],ease:m.ease.quartOut}],s.vec3.lerp),"beam.color":m.PropertyAnimation([{frame:.4,value:[.9,.7,1,.2]},{frame:1,value:s.vec4.ZERO,ease:m.ease.sineIn}],s.vec4.lerp),"cone.transform.position":m.PropertyAnimation([{frame:.2,value:[0,1,1]},{frame:.8,value:[0,1,2],ease:m.ease.quartOut}],s.vec3.lerp),"cone.transform.scale":m.PropertyAnimation([{frame:.2,value:[0,0,0]},{frame:.8,value:[2,2,6],ease:m.ease.cubicOut}],s.vec3.lerp),"cone.color":m.PropertyAnimation([{frame:.2,value:[.9,.6,1,.4]},{frame:.8,value:s.vec4.ZERO,ease:m.ease.sineIn}],s.vec4.lerp),sparks:m.EventTrigger([{frame:.2,value:36}],m.EventTrigger.emit),"ring.transform.scale":m.PropertyAnimation([{frame:.3,value:s.vec3.ZERO},{frame:.8,value:[8,8,8],ease:m.ease.cubicOut}],s.vec3.lerp),"ring.transform.position":m.PropertyAnimation([{frame:.3,value:[0,1,1.5]},{frame:.8,value:[0,1,.5],ease:m.ease.quadOut}],s.vec3.lerp),"ring.transform.rotation":m.PropertyAnimation([{frame:.3,value:s.quat.IDENTITY},{frame:.8,value:s.quat.axisAngle(s.vec3.AXIS_Z,-Math.PI,s.quat()),ease:m.ease.sineOut}],s.quat.slerp),"ring.color":m.PropertyAnimation([{frame:.3,value:[.8,.7,.8,.6]},{frame:.8,value:s.vec4.ZERO,ease:m.ease.sineIn}],s.vec4.lerp),"rays.transform.scale":m.PropertyAnimation([{frame:.2,value:s.vec3.ZERO},{frame:.6,value:[5,5,5],ease:m.ease.quartOut}],s.vec3.lerp),"rays.color":m.PropertyAnimation([{frame:.4,value:[.6,.7,.8,.2]},{frame:.6,value:s.vec4.ZERO,ease:m.ease.quadIn}],s.vec4.lerp)},y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=Math.SQRT2,t.cardinal=!1,t.damage=1,t}return n(t,e),t.prototype.use=function(e,t){var r,a,n,y,g,x;return o(this,(function(o){switch(o.label){case 0:r=e.rotate(t),o.label=1;case 1:return(a=r.next()).done?[3,5]:[3,2];case 2:return[4,a.value];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:this.mesh=e.mesh,this.cone=new l.BatchMesh(d.SharedSystem.geometry.hemisphere),this.cone.material=d.SharedSystem.materials.coneTealMaterial,this.cone.transform=this.context.get(c.TransformSystem).create(),this.cone.transform.parent=this.mesh.transform,this.context.get(u.ParticleEffectPass).add(this.cone),this.ring=new l.Sprite,this.ring.billboard=0,this.ring.material=new f.SpriteMaterial,this.ring.material.program=this.context.get(u.ParticleEffectPass).program,this.ring.material.diffuse=d.SharedSystem.textures.swirl,this.ring.transform=this.context.get(c.TransformSystem).create(),this.ring.transform.parent=this.mesh.transform,this.context.get(u.ParticleEffectPass).add(this.ring),this.rays=new l.Sprite,this.rays.billboard=0,this.rays.material=new f.SpriteMaterial,this.rays.material.program=this.context.get(u.ParticleEffectPass).program,this.rays.material.diffuse=d.SharedSystem.textures.rays,this.rays.transform=this.context.get(c.TransformSystem).create(),this.rays.transform.parent=this.mesh.transform,s.vec3.set(0,1,.96,this.rays.transform.position),s.quat.axisAngle(s.vec3.AXIS_Z,s.randomFloat(0,2*Math.PI,s.random),this.rays.transform.rotation),this.context.get(u.ParticleEffectPass).add(this.rays),this.beam=new l.Sprite,this.beam.billboard=3,this.beam.material=new f.SpriteMaterial,this.beam.material.program=this.context.get(u.ParticleEffectPass).program,this.beam.material.diffuse=d.SharedSystem.textures.raysBeam,this.beam.transform=this.context.get(c.TransformSystem).create(),this.beam.transform.parent=this.mesh.transform,s.quat.axisAngle(s.vec3.AXIS_X,.5*Math.PI,this.beam.transform.rotation),s.vec3.set(0,1,0,this.beam.transform.position),s.vec2.set(0,.5,this.beam.origin),this.context.get(u.ParticleEffectPass).add(this.beam),this.sparks=d.SharedSystem.particles.sparks.add({uLifespan:[.3,.6,-.2,0],uOrigin:s.mat4.transform(s.vec3(0,1,1),this.mesh.transform.matrix,s.vec3()),uGravity:s.vec3.ZERO,uLength:[.1,.2],uSize:[.1,.2],uForce:[4,8],uRadius:[0,.5],uTarget:s.mat4.transform(s.vec3(0,1,1),this.mesh.transform.matrix,s.vec3())}),n=m.AnimationTimeline(this,i(i({},p),{"mesh.armature":h.modelAnimations[this.mesh.armature.key].activate,damage:m.EventTrigger([{frame:.2,value:t}],v.AIUnitSkill.damage)})),y=1,g=this.context.currentTime,o.label=6;case 6:return x=this.context.currentTime-g,n(x,this.context.deltaTime),x>y?[3,9]:[4,m.ActionSignal.WaitNextFrame];case 7:o.sent(),o.label=8;case 8:return[3,6];case 9:return d.SharedSystem.particles.sparks.remove(this.sparks),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.rays.transform),this.context.get(c.TransformSystem).delete(this.beam.transform),this.context.get(c.TransformSystem).delete(this.cone.transform),this.context.get(u.ParticleEffectPass).remove(this.ring),this.context.get(u.ParticleEffectPass).remove(this.rays),this.context.get(u.ParticleEffectPass).remove(this.beam),this.context.get(u.ParticleEffectPass).remove(this.cone),[2]}}))},t}(v.AIUnitSkill);t.StrikeSkill=y},1392:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LungeSkill=void 0;var s=r(7594),l=r(391),c=r(3335),u=r(9519),f=r(6256),m=r(43),h=r(1160),d=r(9258),v=r(7940),p={"cone.transform.position":u.PropertyAnimation([{frame:.7,value:[0,1.5,.5]},{frame:1.1,value:[0,1.3,3.5],ease:u.ease.quintOut}],s.vec3.lerp),"cone.transform.scale":u.PropertyAnimation([{frame:.8,value:[1.5,6,1.5]},{frame:1.1,value:[1,.8,1],ease:u.ease.quadOut}],s.vec3.lerp),"cone.color":u.PropertyAnimation([{frame:.7,value:s.vec4.ZERO},{frame:.8,value:[.6,.7,.9,.4],ease:u.ease.quartOut},{frame:1.1,value:s.vec4.ZERO,ease:u.ease.sineIn}],s.vec4.lerp),spikesLeft:u.EventTrigger([{frame:.16,value:24}],u.EventTrigger.emit),spikesRight:u.EventTrigger([{frame:.16,value:24}],u.EventTrigger.emit),sparksLeft:u.EventTrigger([{frame:.8,value:36}],u.EventTrigger.emit),sparksRight:u.EventTrigger([{frame:.8,value:36}],u.EventTrigger.emit),"wave.transform.scale":u.PropertyAnimation([{frame:1,value:[1,0,0]},{frame:1.7,value:[2,2,1.5],ease:u.ease.sineOut}],s.vec3.lerp),"wave.color":u.PropertyAnimation([{frame:1,value:[.4,.2,1,1]},{frame:1.7,value:s.vec4.ZERO,ease:u.ease.sineInOut}],s.vec4.lerp),"tubeLeft.transform.scale":u.PropertyAnimation([{frame:.8,value:[2.4,0,2.4]},{frame:1,value:[.6,2,.6],ease:u.ease.quadOut},{frame:1.6,value:[0,2,0],ease:u.ease.sineIn}],s.vec3.lerp),"tubeRight.transform.scale":u.PropertyAnimation([{frame:.8,value:[2.4,0,2.4]},{frame:1,value:[.6,2,.6],ease:u.ease.quadOut},{frame:1.6,value:[0,2,0],ease:u.ease.sineIn}],s.vec3.lerp),"tubeLeft.color":u.PropertyAnimation([{frame:1,value:s.vec4.ONE},{frame:1.6,value:[.4,0,.6,1],ease:u.ease.quadIn}],s.vec4.lerp),"tubeRight.color":u.PropertyAnimation([{frame:1,value:s.vec4.ONE},{frame:1.6,value:[.4,0,.6,1],ease:u.ease.quadIn}],s.vec4.lerp),"beamLeft.transform.scale":u.PropertyAnimation([{frame:.8,value:s.vec3.ZERO},{frame:1.2,value:[1.6,4.8,1.6],ease:u.ease.expoOut}],s.vec3.lerp),"beamRight.transform.scale":u.PropertyAnimation([{frame:.8,value:s.vec3.ZERO},{frame:1.2,value:[1.6,4.8,1.6],ease:u.ease.expoOut}],s.vec3.lerp),"beamLeft.color":u.PropertyAnimation([{frame:.8,value:[.7,.9,1,0]},{frame:1.2,value:s.vec4.ZERO,ease:u.ease.cubicIn}],s.vec4.lerp),"beamRight.color":u.PropertyAnimation([{frame:.8,value:[.7,.9,1,0]},{frame:1.2,value:s.vec4.ZERO,ease:u.ease.cubicIn}],s.vec4.lerp),"ringLeft.transform.scale":u.PropertyAnimation([{frame:.9,value:s.vec3.ZERO},{frame:1.3,value:[2,2,2],ease:u.ease.quartOut}],s.vec3.lerp),"ringRight.transform.scale":u.PropertyAnimation([{frame:.9,value:s.vec3.ZERO},{frame:1.3,value:[2,2,2],ease:u.ease.quartOut}],s.vec3.lerp),"ringLeft.color":u.PropertyAnimation([{frame:.9,value:[.4,.6,1,.2]},{frame:1.3,value:s.vec4.ZERO,ease:u.ease.sineIn}],s.vec4.lerp),"ringRight.color":u.PropertyAnimation([{frame:.9,value:[.4,.6,1,.2]},{frame:1.3,value:s.vec4.ZERO,ease:u.ease.sineIn}],s.vec4.lerp)},y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=2,t.cardinal=!1,t.damage=4,t}return n(t,e),t.prototype.use=function(e,t){var r,a,n,y,g,x,b,S;return o(this,(function(o){switch(o.label){case 0:r=e.rotate(t),o.label=1;case 1:return(a=r.next()).done?[3,5]:[3,2];case 2:return[4,a.value];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:this.mesh=e.mesh,this.spikesLeft=d.SharedSystem.particles.energy.add({uLifespan:[.8,1.2,0,0],uOrigin:s.mat4.transform(s.vec3(.5,1.5,-.5),this.mesh.transform.matrix,s.vec3()),uRotation:s.vec2.ZERO,uGravity:s.vec3.ZERO,uSize:[.4,1.2],uRadius:[.5,1.5],uForce:[6,8],uTarget:s.mat4.transform(s.vec3(.5,1,3),this.mesh.transform.matrix,s.vec3())}),this.spikesRight=d.SharedSystem.particles.energy.add({uLifespan:[.8,1.2,0,0],uOrigin:s.mat4.transform(s.vec3(-.5,1.5,-.5),this.mesh.transform.matrix,s.vec3()),uRotation:s.vec2.ZERO,uGravity:s.vec3.ZERO,uSize:[.4,1.2],uRadius:[.5,1.5],uForce:[6,8],uTarget:s.mat4.transform(s.vec3(-.5,1,3),this.mesh.transform.matrix,s.vec3())}),this.tubeLeft=new l.BatchMesh(d.SharedSystem.geometry.lowpolyCylinder),this.tubeRight=new l.BatchMesh(d.SharedSystem.geometry.lowpolyCylinder),this.tubeLeft.material=d.SharedSystem.materials.absorbTealMaterial,this.tubeRight.material=d.SharedSystem.materials.absorbTealMaterial,this.tubeLeft.transform=this.context.get(c.TransformSystem).create(),this.tubeLeft.transform.parent=this.mesh.transform,s.vec3.set(.5,1.3,1.2,this.tubeLeft.transform.position),s.quat.axisAngle(s.vec3.AXIS_X,.5*Math.PI,this.tubeLeft.transform.rotation),this.tubeRight.transform=this.context.get(c.TransformSystem).create(),this.tubeRight.transform.parent=this.mesh.transform,s.vec3.set(-.5,1.3,1.2,this.tubeRight.transform.position),s.quat.axisAngle(s.vec3.AXIS_X,.5*Math.PI,this.tubeRight.transform.rotation),this.context.get(f.ParticleEffectPass).add(this.tubeLeft),this.context.get(f.ParticleEffectPass).add(this.tubeRight),(n=new m.SpriteMaterial).program=this.context.get(f.ParticleEffectPass).program,n.diffuse=d.SharedSystem.textures.sparkle,this.beamLeft=new l.Sprite,this.beamRight=new l.Sprite,this.beamLeft.billboard=3,this.beamRight.billboard=3,this.beamLeft.material=n,this.beamRight.material=n,this.beamLeft.transform=this.context.get(c.TransformSystem).create(),this.beamRight.transform=this.context.get(c.TransformSystem).create(),this.beamLeft.transform.parent=this.mesh.transform,this.beamRight.transform.parent=this.mesh.transform,this.beamRight.order=4,this.beamLeft.order=4,s.quat.axisAngle(s.vec3.AXIS_X,.5*Math.PI,this.beamLeft.transform.rotation),s.vec3.set(-.5,1.3,3,this.beamLeft.transform.position),s.quat.axisAngle(s.vec3.AXIS_X,.5*Math.PI,this.beamRight.transform.rotation),s.vec3.set(.5,1.3,3,this.beamRight.transform.position),this.context.get(f.ParticleEffectPass).add(this.beamLeft),this.context.get(f.ParticleEffectPass).add(this.beamRight),this.ringLeft=new l.Sprite,this.ringRight=new l.Sprite,this.ringLeft.billboard=2,this.ringRight.billboard=2,(y=new m.SpriteMaterial).program=this.context.get(f.ParticleEffectPass).program,y.diffuse=d.SharedSystem.textures.raysInner,this.ringLeft.material=y,this.ringRight.material=y,this.ringLeft.transform=this.context.get(c.TransformSystem).create(s.vec3(-.5,1.3,3),s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.ringRight.transform=this.context.get(c.TransformSystem).create(s.vec3(.5,1.3,3),s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.ringLeft),this.context.get(f.ParticleEffectPass).add(this.ringRight),this.ringRight.order=4,this.ringLeft.order=4,this.sparksLeft=d.SharedSystem.particles.sparks.add({uLifespan:[.4,.6,-.15,0],uOrigin:s.mat4.transform(s.vec3(-.5,1.3,3),this.mesh.transform.matrix,s.vec3()),uGravity:[0,-4,0],uLength:[.2,.3],uSize:[.2,.4],uForce:[2,5],uRadius:[0,.1],uTarget:s.mat4.transform(s.vec3(-.5,1.3,3),this.mesh.transform.matrix,s.vec3())}),this.sparksRight=d.SharedSystem.particles.sparks.add({uLifespan:[.4,.6,-.15,0],uOrigin:s.mat4.transform(s.vec3(.5,1.3,3),this.mesh.transform.matrix,s.vec3()),uGravity:[0,-4,0],uLength:[.2,.3],uSize:[.2,.4],uForce:[2,5],uRadius:[0,.1],uTarget:s.mat4.transform(s.vec3(.5,1.3,3),this.mesh.transform.matrix,s.vec3())}),this.wave=new l.BatchMesh(d.SharedSystem.geometry.lowpolyCylinder),this.wave.material=d.SharedSystem.materials.stripesMaterial,this.wave.transform=this.context.get(c.TransformSystem).create(s.vec3(0,1.3,3),s.quat.axisAngle(s.vec3.AXIS_X,-.5*Math.PI,s.quat()),s.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.wave),this.cone=new l.BatchMesh(d.SharedSystem.geometry.cone),this.cone.transform=this.context.get(c.TransformSystem).create(s.vec3.ZERO,l.Sprite.FlatUp,s.vec3.ONE,this.mesh.transform),this.cone.material=new m.SpriteMaterial,this.cone.material.diffuse=d.SharedSystem.textures.raysWrap,this.cone.material.program=this.context.get(f.ParticleEffectPass).program,this.context.get(f.ParticleEffectPass).add(this.cone),g=u.AnimationTimeline(this,i(i({},p),{"mesh.armature":h.modelAnimations[this.mesh.armature.key].activate,damage:u.EventTrigger([{frame:.5,value:t}],v.AIUnitSkill.damage)})),x=2,b=this.context.currentTime,o.label=6;case 6:return S=this.context.currentTime-b,g(S,this.context.deltaTime),S>x?[3,9]:[4,u.ActionSignal.WaitNextFrame];case 7:o.sent(),o.label=8;case 8:return[3,6];case 9:return d.SharedSystem.particles.energy.remove(this.spikesLeft),d.SharedSystem.particles.energy.remove(this.spikesRight),d.SharedSystem.particles.sparks.remove(this.sparksLeft),d.SharedSystem.particles.sparks.remove(this.sparksRight),this.context.get(c.TransformSystem).delete(this.ringLeft.transform),this.context.get(c.TransformSystem).delete(this.ringRight.transform),this.context.get(c.TransformSystem).delete(this.tubeLeft.transform),this.context.get(c.TransformSystem).delete(this.tubeRight.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.beamLeft.transform),this.context.get(c.TransformSystem).delete(this.beamRight.transform),this.context.get(c.TransformSystem).delete(this.cone.transform),this.context.get(f.ParticleEffectPass).remove(this.ringLeft),this.context.get(f.ParticleEffectPass).remove(this.ringRight),this.context.get(f.ParticleEffectPass).remove(this.tubeLeft),this.context.get(f.ParticleEffectPass).remove(this.tubeRight),this.context.get(f.ParticleEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.beamLeft),this.context.get(f.ParticleEffectPass).remove(this.beamRight),this.context.get(f.ParticleEffectPass).remove(this.cone),[2]}}))},t}(v.AIUnitSkill);t.LungeSkill=y},6679:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SnakeRig=void 0;var i=r(7594),o=r(391),s=function(e){function t(t){var r=e.call(this)||this;return r.context=t,r.inverseModelMatrix=i.mat4(),r.worldTransform=i.mat4(),r.rotation=i.quat(),r.deltaMove=i.vec3(),r.prevJoints=[],r.friction=.96,r.frequency=Math.PI,r.amplitude=.6,r.distanceTravelled=0,r.constraint=new o.SwingTwistConstraint,r.constraint.swingAngle=.4*Math.PI,r.constraint.twistAngle=0*Math.PI,r.mode=1,r}return n(t,e),t.prototype.attachTail=function(e){var t=i.vec3(),r=i.quat(),a=i.quat();i.mat4.multiply(this.mesh.transform.matrix,e[0].globalTransform,this.worldTransform),i.mat4.decompose(this.worldTransform,t,r,r);var n=this.add(t);n.target=null,n.parent=new o.IKBone,n.parent.set(i.vec3.ZERO,n.origin),n.parent.index=this.mesh.armature.nodes.indexOf(e[0]);for(var s=0;s<e.length;s++){var l=e[s],c=e[s+1];i.quat.copy(r,a),c?(i.mat4.multiply(this.mesh.transform.matrix,c.globalTransform,this.worldTransform),i.mat4.decompose(this.worldTransform,t,r,r)):i.mat4.transform(i.vec3.AXIS_Y,this.worldTransform,t);var u=n.add(t);u.joint=this.constraint,u.index=this.mesh.armature.nodes.indexOf(l),i.quat.multiply(i.quat.conjugate(u.rotation,u.inverseBind),a,u.inverseBind),this.prevJoints.push(i.vec3.copy(u.end,i.vec3()))}},t.prototype.build=function(e){this.mesh=e,e.armature.update(this.context),e.transform.recalculate(this.context.frame),this.attachTail([e.armature.nodes[2],e.armature.nodes[3],e.armature.nodes[4],e.armature.nodes[5]]),this.distanceTravelled=0},t.prototype.update=function(){this.verletIntegration(),e.prototype.update.call(this),this.updateArmature()},t.prototype.verletIntegration=function(){if(this.enabled)for(var e=0;e<this.chains.length;e++){i.vec3.copy(i.vec3.ONE,this.chains[e].lastOrigin);var t=this.chains[e].parent,r=this.mesh.armature.nodes[t.index],a=this.mesh.armature.nodes[r.parent];i.mat4.fromRotationTranslationScale(r.rotation,r.position,r.scale,this.worldTransform),i.mat4.multiply(a.globalTransform,this.worldTransform,this.worldTransform),i.mat4.multiply(this.mesh.transform.matrix,this.worldTransform,this.worldTransform),i.mat4.transform(i.vec3.ZERO,this.worldTransform,t.start),this.distanceTravelled+=i.vec3.distance(t.end,t.start),i.vec3.copy(t.start,t.end),i.mat4.transform([0,-1,0],this.worldTransform,t.start),t.set(t.start,t.end);for(var n=0;n<this.chains[e].bones.length;n++){var o=this.chains[e].bones[n],s=this.prevJoints[n];if(i.vec3.subtract(o.end,s,this.deltaMove),i.vec3.scale(this.deltaMove,this.friction,this.deltaMove),i.vec3.copy(o.end,s),i.vec3.add(this.deltaMove,o.end,o.end),0==n){var l=2*this.distanceTravelled+this.context.currentTime,c=this.amplitude*Math.cos(l*this.frequency);i.vec3.set(0,o.length,c,this.deltaMove),i.mat4.transform(this.deltaMove,this.worldTransform,this.deltaMove),i.vec3.lerp(o.end,this.deltaMove,.6,o.end)}}}},t.prototype.updateArmature=function(){i.mat4.invert(this.mesh.transform.matrix,this.inverseModelMatrix);for(var e=this.chains.length-1;e>=0;e--)for(var t=0;t<this.chains[e].bones.length;t++){var r=this.chains[e].bones[t],a=this.mesh.armature.nodes[r.index];i.quat.multiply(r.rotation,r.inverseBind,this.rotation),i.mat4.fromRotationTranslationScale(this.rotation,r.start,i.vec3.ONE,a.globalTransform),i.mat4.multiply(this.inverseModelMatrix,a.globalTransform,a.globalTransform),this.mesh.armature.updateBone(r.index)}},t}(o.IKRig);t.SnakeRig=s},3065:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stingray=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(9519),u=r(1160),f=r(7940),m=r(7207),h=r(1392),d=r(6679);function v(e,t){var r=e.amplitude,a=e.frequency,n=o.vec3();return function(e,i){return n[0]=r[0]*Math.cos(this.context.currentTime*a[0])*e,n[1]=r[1]*Math.cos(this.context.currentTime*a[1])*e,n[2]=r[2]*Math.cos(this.context.currentTime*a[2])*e,t(n,i,i)}}var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new h.LungeSkill(t.context)],t.strategy=new f.AIStrategy(t.context),t.deathEffect=new m.DeathEffect(t.context),t.gainMovementPoints=2,t.movementDuration=.4,t}return n(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("stingray"),this.mesh.transform=this.context.get(l.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),u.modelAnimations[this.mesh.armature.key].activate(0,this.mesh.armature),this.markTiles(!0);var r=new d.SnakeRig(this.context);r.build(this.mesh),this.mesh.armature.ik=r},t.prototype.delete=function(){this.context.get(l.TransformSystem).delete(this.mesh.transform),this.context.get(s.MeshSystem).delete(this.mesh)},t.prototype.damage=function(e){return i(this,(function(e){return[2]}))},t.prototype.death=function(){return this.mesh.armature.ik.enabled=!1,this.deathEffect.use(this)},t.prototype.move=function(e,t){var r,a,n;return i(this,(function(i){switch(i.label){case 0:r=c.AnimationTimeline(this,{"mesh.transform.position":v({amplitude:[0,.1,0],frequency:[0,7.1,0]},o.vec3.add),"mesh.transform.rotation":(s=v({amplitude:[.2,.2,0],frequency:[6.3,7.1,0]},o.vec3.copy),l=o.vec3(),u=o.quat(),function(e,t){return s.call(this,e,l),l[2]+=2,o.vec3.normalize(l,l),o.quat.unitRotation(o.vec3.AXIS_Z,l,u),o.quat.multiply(t,u,t)})}),a=this.moveAlongPath(e,t,!0),i.label=1;case 1:return n=a.next(),r(this.movementFloat,this.context.deltaTime),n.done?[3,5]:[3,2];case 2:return[4,n.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return[2]}var s,l,u}))},t}(f.AIUnit);t.Stingray=p},6634:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectileSkill=void 0;var o=r(7594),s=r(391),l=r(43),c=r(3335),u=r(6240),f=r(6256),m=r(9519),h=r(2392),d=r(1160),v=r(9258),p=r(7940),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=6,t.cardinal=!0,t.damage=2,t}return n(t,e),t.prototype.use=function(e,t){var r,a,n,y,g,x,b,S;return i(this,(function(i){switch(i.label){case 0:this.mesh=e.mesh,r=o.quat.axisAngle(o.vec3.AXIS_Y,Math.atan2(t[0]-e.tile[0],t[1]-e.tile[1]),o.quat()),a=this.context.get(c.TransformSystem).create(o.vec3.ZERO,r,o.vec3.ONE,this.mesh.transform),this.pillar=new s.BatchMesh(v.SharedSystem.geometry.lowpolyCylinder),this.pillar.material=v.SharedSystem.materials.stripesRedMaterial,this.pillar.transform=this.context.get(c.TransformSystem).create([0,1.8,0],s.Sprite.FlatUp,o.vec3.ONE,a),this.context.get(f.ParticleEffectPass).add(this.pillar),this.muzzle=new s.BatchMesh(v.SharedSystem.geometry.cone),this.muzzle.material=new l.SpriteMaterial,this.muzzle.material.program=this.context.get(f.ParticleEffectPass).program,this.muzzle.material.diffuse=v.SharedSystem.textures.raysWrap,this.muzzle.transform=this.context.get(c.TransformSystem).create([0,1.8,1.2],s.Sprite.FlatUp,o.vec3.ONE,a),this.context.get(f.ParticleEffectPass).add(this.muzzle),this.flash=new s.Sprite,this.flash.billboard=0,this.flash.material=v.SharedSystem.materials.flashYellowMaterial,this.flash.transform=this.context.get(c.TransformSystem).create([0,1.8,1.8],o.quat.IDENTITY,o.vec3.ONE,a),this.context.get(f.ParticleEffectPass).add(this.flash),this.ring=new s.Sprite,this.ring.billboard=0,this.ring.material=new l.SpriteMaterial,this.ring.material.program=this.context.get(f.ParticleEffectPass).program,this.ring.material.diffuse=v.SharedSystem.textures.swirl,this.ring.transform=this.context.get(c.TransformSystem).create([0,1.8,2],o.quat.IDENTITY,o.vec3.ONE,a),this.context.get(f.ParticleEffectPass).add(this.ring),this.trail=new s.Line(8),this.trail.width=.8,this.trail.ease=m.ease.reverse(m.ease.quadIn),this.trail.addColorFade(this.trail.ease),this.trail.material=new l.SpriteMaterial,this.trail.material.program=this.context.get(f.ParticleEffectPass).program,this.trail.material.diffuse=v.SharedSystem.gradients.tealLine,this.context.get(f.ParticleEffectPass).add(this.trail),n=o.mat4.transform([0,1.8,0],this.mesh.transform.matrix,o.vec3()),y=this.context.get(h.TerrainSystem).tilePosition(t[0],t[1],o.vec3()),this.light=this.context.get(f.PointLightPass).create([.4,1,.9]),this.light.transform=this.context.get(c.TransformSystem).create(o.vec3.add([0,1,0],y,o.vec3())),this.fire=v.SharedSystem.particles.fire.add({uLifespan:o.vec4(.4,.8,-.2,0),uOrigin:o.vec3.add([0,.5,0],y,o.vec3()),uRotation:o.vec2.ZERO,uGravity:o.vec3.ZERO,uSize:o.vec2(1,3),uRadius:o.vec2(.8,1.4)}),this.wave=new s.Sprite,this.wave.billboard=2,this.wave.material=new l.SpriteMaterial,this.wave.material.blendMode=null,this.wave.material.program=v.SharedSystem.materials.distortion,this.wave.material.diffuse=v.SharedSystem.textures.bulge,this.wave.transform=this.context.get(c.TransformSystem).create(o.vec3.add([0,0,0],y,o.vec3()),s.Sprite.FlatUp),this.context.get(f.PostEffectPass).add(this.wave),this.core=new s.BatchMesh(u.doubleSided(v.SharedSystem.geometry.lowpolySphere)),this.core.material=v.SharedSystem.materials.energyPurpleMaterial,this.core.transform=this.context.get(c.TransformSystem).create(y),this.context.get(f.ParticleEffectPass).add(this.core),this.circle=new s.Sprite,this.circle.billboard=0,this.circle.material=new l.SpriteMaterial,this.circle.material.program=this.context.get(f.ParticleEffectPass).program,this.circle.material.diffuse=v.SharedSystem.textures.raysInner,this.circle.transform=this.context.get(c.TransformSystem).create(o.vec3.add([0,.5,0],y,o.vec3()),s.Sprite.FlatUp),this.context.get(f.ParticleEffectPass).add(this.circle),g=m.AnimationTimeline(this,{"mesh.armature.nodes.0.rotation":m.PropertyAnimation([{frame:0,value:o.quat.copy(this.mesh.armature.nodes[0].rotation,o.quat())},{frame:.5,value:o.quat.multiply(o.quat.axisAngle(o.vec3.AXIS_Y,-.5*Math.PI,o.quat()),r,o.quat()),ease:m.ease.quadInOut}],o.quat.slerp),"mesh.armature":d.modelAnimations[this.mesh.armature.key].activateVariant,trail:m.FollowPath.Line(m.FollowPath.separate(m.PropertyAnimation([{frame:.6,value:n[0]},{frame:1,value:y[0],ease:m.ease.linear}],o.lerp),m.PropertyAnimation([{frame:.6,value:n[1]},{frame:1,value:y[1],ease:m.ease.cubicIn}],o.lerp),m.PropertyAnimation([{frame:.6,value:n[2]},{frame:1,value:y[2],ease:m.ease.linear}],o.lerp)),{length:.06}),"light.radius":m.PropertyAnimation([{frame:1.1,value:0},{frame:1.7,value:6,ease:m.ease.quadOut}],o.lerp),"light.intensity":m.PropertyAnimation([{frame:1.1,value:8},{frame:1.7,value:0,ease:m.ease.sineIn}],o.lerp),fire:m.EventTrigger([{frame:1,value:48}],m.EventTrigger.emit),"wave.transform.scale":m.PropertyAnimation([{frame:1.2,value:o.vec3.ZERO},{frame:1.6,value:[8,8,8],ease:m.ease.cubicOut}],o.vec3.lerp),"wave.color":m.PropertyAnimation([{frame:1.2,value:o.vec4.ONE},{frame:1.6,value:o.vec4.ZERO,ease:m.ease.quadIn}],o.vec4.lerp),"core.transform.scale":m.PropertyAnimation([{frame:1,value:o.vec3.ZERO},{frame:1.6,value:[3,3,3],ease:m.ease.cubicOut}],o.vec3.lerp),"core.color":m.PropertyAnimation([{frame:1,value:[.2,1,.6,1]},{frame:1.6,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),"circle.transform.scale":m.PropertyAnimation([{frame:1,value:o.vec3.ZERO},{frame:1.4,value:[6,6,6],ease:m.ease.quartOut}],o.vec3.lerp),"circle.color":m.PropertyAnimation([{frame:1,value:[.6,1,1,0]},{frame:1.4,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),"pillar.transform.scale":m.PropertyAnimation([{frame:0,value:[2,0,2]},{frame:.5,value:[1,3,1],ease:m.ease.quadOut},{frame:.8,value:[0,4,0],ease:m.ease.quadIn}],o.vec3.lerp),"pillar.color":m.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:.5,value:[.4,1,.8,1],ease:m.ease.cubicOut}],o.vec4.lerp),"muzzle.transform.scale":m.PropertyAnimation([{frame:.7,value:[0,-1,0]},{frame:1.1,value:[.6,-2.8,.6],ease:m.ease.cubicOut}],o.vec3.lerp),"muzzle.color":m.PropertyAnimation([{frame:.7,value:[.4,1,.8,0]},{frame:1.1,value:o.vec4.ZERO,ease:m.ease.quadIn}],o.vec4.lerp),"flash.transform.scale":m.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[3,3,3],ease:m.ease.cubicOut}],o.vec3.lerp),"flash.color":m.PropertyAnimation([{frame:.8,value:[.4,1,.9,1]},{frame:1.4,value:[0,1,.5,.2],ease:m.ease.quadIn}],o.vec4.lerp),"ring.transform.scale":m.PropertyAnimation([{frame:.7,value:o.vec3.ZERO},{frame:1,value:[4,4,4],ease:m.ease.quadOut}],o.vec3.lerp),"ring.color":m.PropertyAnimation([{frame:.7,value:[.6,1,1,0]},{frame:1,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),damage:m.EventTrigger([{frame:1,value:t}],p.AIUnitSkill.damage)}),x=2,b=this.context.currentTime,i.label=1;case 1:return S=this.context.currentTime-b,g(S,this.context.deltaTime),S>x?[3,4]:[4,m.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return this.context.get(c.TransformSystem).delete(a),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.flash.transform),this.context.get(c.TransformSystem).delete(this.muzzle.transform),this.context.get(c.TransformSystem).delete(this.pillar.transform),this.context.get(c.TransformSystem).delete(this.circle.transform),this.context.get(c.TransformSystem).delete(this.core.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.light.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),v.SharedSystem.particles.fire.remove(this.fire),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.PostEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.trail),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.ParticleEffectPass).remove(this.flash),this.context.get(f.ParticleEffectPass).remove(this.muzzle),this.context.get(f.ParticleEffectPass).remove(this.pillar),this.context.get(f.ParticleEffectPass).remove(this.circle),this.context.get(f.ParticleEffectPass).remove(this.core),[2]}}))},t}(p.AIUnitSkill);t.ProjectileSkill=y},7669:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Spider4Rig=void 0;var o=r(7594),s=r(391),l=r(9519),c=r(2392),u=function(e){function t(t){var r=e.call(this)||this;return r.context=t,r.ballJoint=new s.BallJointConstraint,r.hingeJoint=new s.LocalHingeConstraint,r.inverseModelMatrix=o.mat4(),r.worldOrientation=o.quat(),r.targets=[],r.hingeJoint.min=0,r.hingeJoint.max=Math.PI,r.ballJoint.rotor=2/3*Math.PI,r}return n(t,e),t.prototype.attachLimb=function(e,t){var r=o.vec3(),a=o.vec3(),n=o.vec3(),i=o.quat(),l=o.quat();o.mat4.decompose(e.globalTransform,r,n,i),o.mat4.decompose(t.globalTransform,a,n,l),o.mat4.transform(o.vec3.AXIS_Y,t.globalTransform,n);var c=this.add(r);c.parent=new s.IKBone,c.parent.set(o.vec3.ZERO,r),c.parent.index=e.parent;var u=c.add(a),f=c.add(n);return u.index=this.mesh.armature.nodes.indexOf(e),f.index=this.mesh.armature.nodes.indexOf(t),u.joint=this.ballJoint,f.joint=this.hingeJoint,o.quat.multiply(o.quat.conjugate(u.rotation,u.inverseBind),i,u.inverseBind),o.quat.multiply(o.quat.conjugate(f.rotation,f.inverseBind),l,f.inverseBind),o.vec3.copy(n,c.target),this.targets.push({world:o.mat4.transform(c.target,this.mesh.transform.matrix,o.vec3()),local:c.target,center:o.vec3.copy(c.target,o.vec3()),delta:o.vec3(),radius:.2,moving:!1}),c},t.prototype.build=function(e){this.mesh=e,e.armature.update(this.context),e.transform.recalculate(this.context.frame),this.attachLimb(e.armature.nodes[1],e.armature.nodes[2]),this.attachLimb(e.armature.nodes[3],e.armature.nodes[4]),this.attachLimb(e.armature.nodes[5],e.armature.nodes[6]),this.attachLimb(e.armature.nodes[7],e.armature.nodes[8])},t.prototype.moveTarget=function(e,t){var r,a,n,s,c,u;return i(this,(function(i){switch(i.label){case 0:e.moving=!0,r=o.vec3.copy(e.world,o.vec3()),a=.5,n=.1,s=this.context.currentTime,i.label=1;case 1:return c=this.context.currentTime-s,u=Math.min(1,c/n),e.world[0]=o.lerp(r[0],t[0],l.ease.sineInOut(u)),e.world[1]=o.lerp(r[1],t[1],l.ease.slowInOut(u))+a*l.ease.fadeInOut(u),e.world[2]=o.lerp(r[2],t[2],l.ease.sineInOut(u)),c>n?[3,4]:[4,l.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return e.moving=!1,[2]}}))},t.prototype.update=function(){o.mat4.invert(this.mesh.transform.matrix,this.inverseModelMatrix);for(var t=0,r=-1,a=0,n=this.targets.length-1;n>=0;n--){var i=this.targets[n];if(o.mat4.transform(i.world,this.inverseModelMatrix,i.local),a+=+i.moving,!i.moving){o.vec3.subtract(i.local,i.center,i.delta),o.vec3.projectPlane(i.delta,o.vec3.AXIS_Y,i.delta);var s=o.vec3.magnitudeSquared(i.delta);s<=i.radius*i.radius||t>=s||(t=s,r=n)}}if(-1!=r&&0==a){t=Math.sqrt(t),i=this.targets[r],o.vec3.scale(i.delta,-Math.min(i.radius,t-i.radius)/t,i.delta);var u=o.vec3.add(i.center,i.delta,o.vec3());o.mat4.transform(u,this.mesh.transform.matrix,u),this.context.get(c.TerrainSystem).snapToGround(u),this.context.get(l.AnimationSystem).start(this.moveTarget(i,u),!0)}for(e.prototype.update.call(this),n=this.chains.length-1;n>=0;n--)for(var f=0;f<this.chains[n].bones.length;f++){var m=this.chains[n].bones[f];if(-1!=m.index){var h=this.mesh.armature.nodes[m.index];o.quat.multiply(m.rotation,m.inverseBind,this.worldOrientation),o.mat4.fromRotationTranslationScale(this.worldOrientation,m.start,o.vec3.ONE,h.globalTransform),this.mesh.armature.updateBone(m.index)}}},t}(s.IKRig);t.Spider4Rig=u},5009:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.TarantulaVariant=t.Tarantula=void 0;var o=r(7594),s=r(391),l=r(3335),c=r(9519),u=r(1160),f=r(7940),m=r(7207),h=r(7669),d=r(5087),v=r(6634),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new d.WaveSkill(t.context)],t.strategy=new f.AIStrategy(t.context),t.deathEffect=new m.DeathEffect(t.context),t.movementDuration=.8,t}return n(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("tarantula"),this.mesh.transform=this.context.get(l.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),u.modelAnimations[this.mesh.armature.key].activate(0,this.mesh.armature);var r=new h.Spider4Rig(this.context);r.build(this.mesh),this.mesh.armature.ik=r},t.prototype.delete=function(){this.context.get(l.TransformSystem).delete(this.mesh.transform),this.context.get(s.MeshSystem).delete(this.mesh)},t.prototype.damage=function(e){return i(this,(function(e){return[2]}))},t.prototype.death=function(){return this.deathEffect.use(this)},t.prototype.move=function(e,t){var r,a,n;return i(this,(function(i){switch(i.label){case 0:r=c.AnimationTimeline(this,{"mesh.transform.position":c.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.5,0],ease:c.ease.sineOut}],c.BlendTween.vec3)}),a=this.moveAlongPath(e,t,!1),i.label=1;case 1:return n=a.next(),r(this.movementFloat,this.context.deltaTime),n.done?[3,5]:[3,2];case 2:return[4,n.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return[2]}}))},t}(f.AIUnit);t.Tarantula=p;var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new v.ProjectileSkill(t.context)],t.strategy=new f.AIStrategy(t.context),t.deathEffect=new m.DeathEffect(t.context),t.movementDuration=.8,t}return n(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("tarantula"),this.mesh.transform=this.context.get(l.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),u.modelAnimations[this.mesh.armature.key].activateVariant(0,this.mesh.armature),this.markTiles(!0);var r=new h.Spider4Rig(this.context);r.build(this.mesh),this.mesh.armature.ik=r},t.prototype.delete=function(){this.context.get(l.TransformSystem).delete(this.mesh.transform),this.context.get(s.MeshSystem).delete(this.mesh)},t.prototype.damage=function(e){return i(this,(function(e){return[2]}))},t.prototype.death=function(){return this.deathEffect.use(this)},t.prototype.move=function(e,t){var r,a,n;return i(this,(function(i){switch(i.label){case 0:r=c.AnimationTimeline(this,{"mesh.transform.position":c.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.5,0],ease:c.ease.sineOut}],c.BlendTween.vec3)}),a=this.moveAlongPath(e,t,!1),i.label=1;case 1:return n=a.next(),r(this.movementFloat,this.context.deltaTime),n.done?[3,5]:[3,2];case 2:return[4,n.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return[2]}}))},t}(f.AIUnit);t.TarantulaVariant=y},5087:function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__generator||function(e,t){var r,a,n,i,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.WaveSkill=void 0;var o=r(7594),s=r(391),l=r(43),c=r(3335),u=r(6240),f=r(6256),m=r(9519),h=r(1160),d=r(9258),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.radius=3,t.cardinal=!1,t.damage=4,t}return n(t,e),t.prototype.use=function(e,t){var r,a,n,v;return i(this,(function(t){switch(t.label){case 0:this.mesh=e.mesh,this.beam=new s.Sprite,this.beam.billboard=3,o.vec2.set(0,.5,this.beam.origin),this.beam.material=new l.SpriteMaterial,this.beam.material.program=this.context.get(f.ParticleEffectPass).program,this.beam.material.diffuse=d.SharedSystem.textures.raysBeam,this.beam.transform=this.context.get(c.TransformSystem).create([0,0,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.beam),this.cracks=this.context.get(f.DecalPass).create(4),this.cracks.material=new l.DecalMaterial,this.cracks.material.program=this.context.get(f.DecalPass).program,this.cracks.material.diffuse=d.SharedSystem.textures.cracks,this.cracks.material.normal=d.SharedSystem.textures.cracksNormal,this.cracks.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.wave=new s.Sprite,this.wave.billboard=0,this.wave.material=new l.SpriteMaterial,this.wave.material.blendMode=null,this.wave.material.program=d.SharedSystem.materials.distortion,this.wave.material.diffuse=d.SharedSystem.textures.ring,this.wave.transform=this.context.get(c.TransformSystem).create([0,1,0],s.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(f.PostEffectPass).add(this.wave),this.ring=new s.Sprite,this.ring.billboard=0,this.ring.material=new l.SpriteMaterial,this.ring.material.program=this.context.get(f.ParticleEffectPass).program,this.ring.material.diffuse=d.SharedSystem.textures.swirl,this.ring.transform=this.context.get(c.TransformSystem).create([0,.5,0],s.Sprite.FlatUp,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.ring),this.cylinder=new s.BatchMesh(d.SharedSystem.geometry.lowpolyCylinder),this.cylinder.material=d.SharedSystem.materials.stripesMaterial,this.cylinder.transform=this.context.get(c.TransformSystem).create([0,2,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.cylinder),this.pillar=new s.BatchMesh(d.SharedSystem.geometry.lopolyCylinderFlip),this.pillar.material=new l.SpriteMaterial,this.pillar.material.program=this.context.get(f.ParticleEffectPass).program,this.pillar.material.diffuse=d.SharedSystem.textures.raysWrap,this.pillar.transform=this.context.get(c.TransformSystem).create([0,0,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.pillar),this.bolts=d.SharedSystem.particles.bolts.add({uOrigin:o.vec3.add([0,1,0],this.mesh.transform.position,o.vec3()),uRadius:[2,4],uLifespan:[.2,.8,-.4,0],uGravity:o.vec3.ZERO,uRotation:[0,2*Math.PI],uOrientation:o.quat.IDENTITY,uSize:[.4,1.6],uFrame:[16,4]}),this.light=this.context.get(f.PointLightPass).create([.7,.6,1]),this.light.transform=this.context.get(c.TransformSystem).create([0,4,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.core=new s.BatchMesh(u.doubleSided(d.SharedSystem.geometry.lowpolySphere)),this.core.material=d.SharedSystem.materials.energyPurpleMaterial,this.core.transform=this.context.get(c.TransformSystem).create([0,1,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.core),r=m.AnimationTimeline(this,{"mesh.armature":h.modelAnimations[this.mesh.armature.key].activate,"core.transform.scale":m.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.5,value:[4,-4,4],ease:m.ease.quadOut}],o.vec3.lerp),"core.color":m.PropertyAnimation([{frame:.8,value:[.6,.8,1,.4]},{frame:1.5,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),"light.radius":m.PropertyAnimation([{frame:.6,value:0},{frame:1.4,value:8,ease:m.ease.cubicOut}],o.lerp),"light.intensity":m.PropertyAnimation([{frame:.6,value:8},{frame:1.4,value:0,ease:m.ease.quadIn}],o.lerp),bolts:m.EventTrigger([{frame:.8,value:48}],m.EventTrigger.emit),"beam.transform.scale":m.PropertyAnimation([{frame:.7,value:o.vec3.ZERO},{frame:1.2,value:[3,8,3],ease:m.ease.cubicOut}],o.vec3.lerp),"beam.color":m.PropertyAnimation([{frame:.7,value:[.6,.6,1,.4]},{frame:1.2,value:o.vec4.ZERO,ease:m.ease.quadIn}],o.vec4.lerp),"cracks.transform.rotation":m.EventTrigger([{frame:0,value:null}],(function(e){return o.quat.axisAngle(o.vec3.AXIS_Y,2*Math.PI*o.random(),e)})),"cracks.transform.scale":m.PropertyAnimation([{frame:.8,value:[12,4,12]}],o.vec3.lerp),"cracks.color":m.PropertyAnimation([{frame:.8,value:[.6,.6,1,1]}],o.vec4.lerp),"cracks.threshold":m.PropertyAnimation([{frame:.8,value:-3},{frame:1,value:0,ease:m.ease.quadOut},{frame:2,value:3,ease:m.ease.quartIn}],o.lerp),"wave.transform.scale":m.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[10,10,10],ease:m.ease.cubicOut}],o.vec3.lerp),"wave.color":m.PropertyAnimation([{frame:.8,value:o.vec4.ONE},{frame:1.4,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),"ring.transform.scale":m.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[10,10,10],ease:m.ease.quartOut}],o.vec3.lerp),"ring.color":m.PropertyAnimation([{frame:.8,value:[.6,.4,1,0]},{frame:1.4,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp),"cylinder.transform.scale":m.PropertyAnimation([{frame:.4,value:[4,1,4]},{frame:1,value:[0,6,0],ease:m.ease.sineOut}],o.vec3.lerp),"cylinder.color":m.PropertyAnimation([{frame:.4,value:o.vec4.ZERO},{frame:1,value:[.4,.2,1,1],ease:m.ease.cubicOut}],o.vec4.lerp),"pillar.transform.scale":m.PropertyAnimation([{frame:.8,value:[0,-8,0]},{frame:1.4,value:[5,-2,5],ease:m.ease.cubicOut}],o.vec3.lerp),"pillar.color":m.PropertyAnimation([{frame:.8,value:[.8,.6,1,.4]},{frame:1.4,value:o.vec4.ZERO,ease:m.ease.sineIn}],o.vec4.lerp)}),a=2,n=this.context.currentTime,t.label=1;case 1:return v=this.context.currentTime-n,r(v,this.context.deltaTime),v>a?[3,4]:[4,m.ActionSignal.WaitNextFrame];case 2:t.sent(),t.label=3;case 3:return[3,1];case 4:return this.context.get(c.TransformSystem).delete(this.beam.transform),this.context.get(c.TransformSystem).delete(this.pillar.transform),this.context.get(c.TransformSystem).delete(this.cylinder.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.cracks.transform),this.context.get(c.TransformSystem).delete(this.light.transform),this.context.get(c.TransformSystem).delete(this.core.transform),d.SharedSystem.particles.bolts.remove(this.bolts),this.context.get(f.DecalPass).delete(this.cracks),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.PostEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.beam),this.context.get(f.ParticleEffectPass).remove(this.pillar),this.context.get(f.ParticleEffectPass).remove(this.cylinder),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.ParticleEffectPass).remove(this.core),[2]}}))},t}(r(7940).AIUnitSkill);t.WaveSkill=v},252:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nuniform sampler2D uAlbedoBuffer;\r\nuniform sampler2D uNormalBuffer;\r\nuniform sampler2D uPositionBuffer;\r\n\r\nin vec2 vUV;\r\n\r\nlayout(location=0) out vec4 fragColor;\r\n\r\nuniform LightUniforms {\r\n    vec3 uLightDirection;\r\n    vec3 uSkyColor;\r\n    vec3 uGroundColor;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform float uWeight;\r\nuniform samplerCube uEnvironmentMap;\r\nuniform sampler2D uBRDFLUT;\r\n\r\nvec3 fresnelSchlickRoughness(float cosTheta, vec3 F0, float roughness){\r\n    return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\r\n}\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    vec4 normal = texelFetch(uNormalBuffer, fragCoord, 0);\r\n    vec4 albedo = texelFetch(uAlbedoBuffer, fragCoord, 0);\r\n\r\n    float emission = max(0.,2.*albedo.a-1.);\r\n    float roughness = clamp(2.*albedo.a,0.04,1.0);\r\n    float metallic = normal.a;\r\n\r\n    vec3 N = normalize(normal.xyz);\r\n    vec3 V = normalize(position.xyz - uEyePosition);\r\n\r\n    vec3 F0 = mix(vec3(0.04), albedo.rgb, metallic);\r\n    float NdotV = max(dot(N, V), 0.0);\r\n\r\n    vec3 F = fresnelSchlickRoughness(NdotV, F0, roughness);\r\n    vec3 kD = (1.0 - F) * (1.0 - metallic);\r\n\r\n#ifdef IRRADIANCE_MAP\r\n    vec3 irradiance = texture(uIrradianceMap, N).rgb;\r\n#else\r\n    float blend = length(normal.xyz);\r\n    vec3 light = mix(uGroundColor, uSkyColor, clamp(0.5 + 0.5 * dot(N, uLightDirection),0.,1.));\r\n    light = mix(light, vec3(1), max(emission,1.-blend));\r\n    vec3 irradiance = light;\r\n#endif\r\n    vec3 indirectDiffuse = irradiance * albedo.rgb;\r\n#ifdef REFLECTION_MAP\r\n    vec3 prefilteredColor = textureLod(uEnvironmentMap, reflect(V, N),  roughness * 8.0).rgb;   \r\n    vec2 envBRDF  = texture(uBRDFLUT, vec2(NdotV, roughness)).rg;\r\n    vec3 indirectSpecular = prefilteredColor * (F * envBRDF.x + envBRDF.y);\r\n#else\r\n    vec3 indirectSpecular = vec3(0);\r\n#endif\r\n    vec3 ambient = (kD * indirectDiffuse + indirectSpecular);\r\n    \r\n    ambient = mix(albedo.rgb, ambient, step(0.5, position.w));\r\n    fragColor = uWeight * vec4(ambient, emission);\r\n}"},2652:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec4 vColor;\r\nin vec4 vMaterial;\r\n\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSamplers[MAX_TEXTURE_UNITS];\r\n\r\nvoid main(){\r\n    int tex = int(vMaterial.a);\r\n    vec4 color = vec4(0);\r\n    switch(tex){\r\n#FOR        case #i:color=texture(uSamplers[#i],vUV);break;\r\n    }\r\n    fragColor = vColor * color;\r\n}"},3582:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec2 aPosition;\r\nlayout(location=1) in vec2 aUV;\r\nlayout(location=2) in vec4 aColor;\r\nlayout(location=3) in vec4 aMaterial;\r\n\r\nuniform mat3 uProjectionMatrix;\r\n\r\nout vec2 vUV;\r\nout vec4 vColor;\r\nout vec4 vMaterial;\r\n\r\nvoid main(){\r\n    gl_Position = vec4((uProjectionMatrix * vec3(aPosition,1.)).xy,0.,1.);\r\n    vUV = aUV;\r\n    vColor = aColor;\r\n    vMaterial = aMaterial + vec4(0,0,0,.5);\r\n}"},3949:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec3 vPosition;\r\nin vec4 vColor;\r\nin vec3 vNormal;\r\nin float vMaterial;\r\n\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSamplers[MAX_TEXTURE_UNITS];\r\n\r\nvoid main(){\r\n    int tex = int(vMaterial);\r\n    vec2 uv = vUV;\r\n    vec4 color = vec4(0);\r\n    switch(tex){\r\n#FOR        case #i:color=texture(uSamplers[#i],uv);break;\r\n    }\r\n    fragColor = color * vColor;\r\n}"},5610:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\nlayout(location=1) in vec2 aUV;\r\nlayout(location=2) in vec4 aColor;\r\nlayout(location=3) in vec3 aNormal;\r\nlayout(location=4) in float aMaterial;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nout vec2 vUV;\r\nout vec3 vPosition;\r\nout vec4 vColor;\r\nout vec3 vNormal;\r\nout float vMaterial;\r\n\r\nvoid main(){\r\n    vUV = aUV;\r\n    vPosition = aPosition;\r\n    vColor = aColor;\r\n    vMaterial = aMaterial + .5;\r\n    vNormal = aNormal;\r\n    gl_Position = uViewProjectionMatrix * vec4(aPosition, 1.0);\r\n}"},1628:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\n#ifndef POINT\r\nin vec2 vUV;\r\nin vec4 vUVClamp;\r\n#endif\r\nin vec2 vLife;\r\nin vec3 vPosition;\r\n\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\nuniform sampler2D uGradient;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\n#ifdef SOFT\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform sampler2D uPositionBuffer;\r\n#endif\r\n\r\nvoid main(void){\r\n#ifdef POINT\r\n    vec2 uv = gl_PointCoord;\r\n    const vec4 vUVClamp = vec4(0,0,1,1);\r\n#else\r\n    vec2 uv = vUV;\r\n#endif\r\n\r\n#ifdef UV_OFFSET\r\n    float offsetScale = UV_OFFSET;\r\n    vec4 color = texture(uSampler, uv - offsetScale * uTime.x + vLife.y);\r\n    color *= 4.0 * texture(uSampler, 2.0 * uv + 2.0 * offsetScale * uTime.x + vLife.y);\r\n#else\r\n    vec4 color = texture(uSampler, uv);\r\n#endif\r\n\r\n#if defined(GRADIENT)\r\n    color = texture(uGradient, vec2(vLife.x, color.a));\r\n#elif defined(SWIPE)\r\n    vec2 uv0 = (uv - vUVClamp.xy) / (vUVClamp.zw - vUVClamp.xy);\r\n    color *= smoothstep(0.5+SWIPE,0.5,abs(uv0.x-.5 + mix(-1.0,1.0,vLife.x)));\r\n#else\r\n    color *= 4.*vLife.x*(1.-vLife.x);\r\n#endif\r\n#ifdef MASK\r\n    color *= smoothstep(1.0,0.5,length(2.*uv-1.));\r\n#endif\r\n\r\n#ifdef SOFT\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    float difference = length(position.xyz - uEyePosition) - length(vPosition - uEyePosition);\r\n    color.a *= smoothstep(0.0, 0.5, difference);\r\n#endif\r\n    fragColor = color;\r\n}"},8719:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec4 aLifetime;\r\nlayout(location=1) in vec4 aSize;\r\nlayout(location=2) in vec4 aTransform;\r\nlayout(location=3) in vec4 aVelocity;\r\nlayout(location=4) in vec4 aAcceleration;\r\n#ifndef POINT\r\nlayout(location=5) in vec3 aPosition;\r\nlayout(location=6) in vec2 aUV;\r\nout vec2 vUV;\r\nout vec4 vUVClamp;\r\n#endif\r\n\r\nout vec2 vLife;\r\nout vec3 vPosition;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nmat2 rotate(in float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\r\n\r\nvoid main(){\r\n    vLife = vec2(clamp(aLifetime.x * aLifetime.y, 0.0, 1.0), aLifetime.z);\r\n    float size = aSize.y * step(0.,aLifetime.x)*step(aLifetime.x*aLifetime.y,1.);\r\n\r\n#ifdef POINT\r\n    gl_PointSize = size;\r\n    vPosition = aTransform.xyz;\r\n#else\r\n    vec3 position = vec3(rotate(aTransform.w) * aPosition.xy, aPosition.z);\r\n#ifdef VIEWPLANE\r\n    vec3 forward = -vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    vec3 right = vec3(uViewMatrix[0][0], uViewMatrix[1][0], uViewMatrix[2][0]);\r\n#else\r\n    vec3 forward = normalize(aTransform.xyz - uEyePosition);\r\n#endif\r\n\r\n#if defined(ALIGNED)\r\n    vec3 right = normalize(aVelocity.xyz);\r\n    vec3 up = cross(forward, right);\r\n    forward = cross(right, up);\r\n    mat3 matrix = mat3(right, up, forward);\r\n    position = size * matrix * position;\r\n#ifdef STRETCH\r\n    position += dot(position, aVelocity.xyz) * aVelocity.xyz * STRETCH;\r\n#endif\r\n\r\n#elif defined(CYLINDRICAL)\r\n    vec3 up = vec3(0,1,0);\r\n    vec3 right = cross(forward, up);\r\n    position = size * (right * position.x + up * position.y);\r\n#elif defined(SPHERICAL)\r\n    vec3 right = vec3(uViewMatrix[0][0], uViewMatrix[1][0], uViewMatrix[2][0]);\r\n    vec3 up = vec3(uViewMatrix[0][1], uViewMatrix[1][1], uViewMatrix[2][1]);\r\n    position = size * (right * position.x + up * position.y);\r\n#ifdef STRETCH\r\n    vec3 viewVelocity = (uViewMatrix * vec4(aVelocity.xyz,0.0)).xyz;\r\n    position += dot(position, aVelocity.xyz) * aVelocity.xyz * STRETCH;\r\n#endif\r\n\r\n#else\r\n    position = size * position.xzy * vec3(1,1,-1);\r\n#endif\r\n    vPosition = position + aTransform.xyz;\r\n#ifdef FRAMES\r\n    float uvSize = 1.0/aSize.w; float uvFrame = mod(floor(aSize.z),aSize.w*aSize.w);\r\n    vec2 uvTile = vec2(mod(uvFrame, aSize.w), floor(uvFrame * uvSize)) * uvSize;\r\n    vUVClamp = vec4(uvTile, uvTile + uvSize);\r\n    vUV = uvTile + uvSize * aUV;\r\n#else\r\n    vUV = aUV;\r\n    vUVClamp = vec4(0,0,1,1);\r\n#endif\r\n#endif\r\n    gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\r\n}"},4640:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define PI 3.141592653589793\r\n\r\nfloat RadicalInverse_VdC(uint bits){\r\n    bits = (bits << 16u) | (bits >> 16u);\r\n    bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\r\n    bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\r\n    bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\r\n    bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\r\n    return float(bits) * 2.3283064365386963e-10; // / 0x100000000\r\n}\r\nvec2 Hammersley(uint i, uint N){\r\n    return vec2(float(i)/float(N), RadicalInverse_VdC(i));\r\n}  \r\n\r\nvec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness){\r\n    float a = roughness*roughness;\r\n\t\r\n    float phi = 2.0 * PI * Xi.x;\r\n    float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a*a - 1.0) * Xi.y));\r\n    float sinTheta = sqrt(1.0 - cosTheta*cosTheta);\r\n\t\r\n    // from spherical coordinates to cartesian coordinates\r\n    vec3 H;\r\n    H.x = cos(phi) * sinTheta;\r\n    H.y = sin(phi) * sinTheta;\r\n    H.z = cosTheta;\r\n\t\r\n    // from tangent-space vector to world-space sample vector\r\n    vec3 up        = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\r\n    vec3 tangent   = normalize(cross(up, N));\r\n    vec3 bitangent = cross(N, tangent);\r\n\t\r\n    vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\r\n    return normalize(sampleVec);\r\n}\r\n\r\nfloat GeometrySchlickGGX(float NdotV, float roughness){\r\n    float a = roughness;\r\n    float k = (a * a) / 2.0;\r\n\r\n    float nom   = NdotV;\r\n    float denom = NdotV * (1.0 - k) + k;\r\n\r\n    return nom / denom;\r\n}\r\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness){\r\n    float NdotV = max(dot(N, V), 0.0);\r\n    float NdotL = max(dot(N, L), 0.0);\r\n    float ggx2 = GeometrySchlickGGX(NdotV, roughness);\r\n    float ggx1 = GeometrySchlickGGX(NdotL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n}\r\n\r\nvec2 integrateBRDF(float NdotV, float roughness){\r\n    vec3 V = vec3(\r\n        sqrt(1.0 - NdotV*NdotV),\r\n        0.0,\r\n        NdotV\r\n    );\r\n    float A = 0.0;\r\n    float B = 0.0;\r\n\r\n    vec3 N = vec3(0.0, 0.0, 1.0);\r\n\r\n    const uint SAMPLE_COUNT = 1024u;\r\n    for(uint i = 0u; i < SAMPLE_COUNT; ++i){\r\n        vec2 Xi = Hammersley(i, SAMPLE_COUNT);\r\n        vec3 H  = ImportanceSampleGGX(Xi, N, roughness);\r\n        vec3 L  = normalize(2.0 * dot(V, H) * H - V);\r\n\r\n        float NdotL = max(L.z, 0.0);\r\n        float NdotH = max(H.z, 0.0);\r\n        float VdotH = max(dot(V, H), 0.0);\r\n\r\n        if(NdotL > 0.0){\r\n            float G = GeometrySmith(N, V, L, roughness);\r\n            float G_Vis = (G * VdotH) / (NdotH * NdotV);\r\n            float Fc = pow(1.0 - VdotH, 5.0);\r\n\r\n            A += (1.0 - Fc) * G_Vis;\r\n            B += Fc * G_Vis;\r\n        }\r\n    }\r\n    A /= float(SAMPLE_COUNT);\r\n    B /= float(SAMPLE_COUNT);\r\n    return vec2(A, B);\r\n}\r\n\r\nvoid main(){\r\n    vec2 integratedBRDF = integrateBRDF(vUV.x, vUV.y);\r\n    fragColor = vec4(integratedBRDF,0,0);\r\n}"},9868:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\nuniform vec2 uScreenSize;\r\nuniform float uScale;\r\n\r\nvoid main(){\r\n    float alpha = texture(uSampler, vUV).b;\r\n    float height = alpha / uScale;\r\n    //vec2 screenSize = vec2(textureSize(uSampler));\r\n    float dhdx = dFdx(height) * uScreenSize.x;\r\n    float dhdy = dFdy(height) * uScreenSize.y;\r\n    vec3 normal = normalize(vec3(-dhdx, -dhdy, 1));\r\n#ifdef PREMULTIPLY\r\n    normal.rgb *= smoothstep(0.0,0.8,alpha);\r\n#endif\r\n    fragColor = vec4(0.5+0.5*normal, alpha);\r\n}"},3653:(e,t,r)=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\nlayout(location=1) in vec3 aNormal;\r\nlayout(location=2) in vec2 aUV;\r\nlayout(location=3) in vec4 aColor;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform ModelUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uLayer;\r\n    float uStartTime;\r\n};\r\n\r\nout vec3 vPosition;\r\nout vec3 vNormal;\r\nout vec2 vUV;\r\nout vec4 vColor;\r\n\r\nuniform float uArrayMapLayers;\r\nuniform vec3 uVelocityMin;\r\nuniform vec3 uVelocityMax;\r\nuniform vec2 uAngularVelocity;\r\nuniform vec3 uGravity;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(uint n){\r\n\tn = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float(n & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\n"+r(5126)+"\r\nfloat solveQuadratic(float a, float b, float c){\r\n    float d = b*b - 4.*a*c;\r\n    if(d < 0.) return -1.;\r\n    float t = -0.5 * (b + sign(b) * sqrt(d));\r\n    return max(t / a, c / t);\r\n}\r\n\r\nvoid main(){\r\n    vec3 position = aPosition; vec3 normal = aNormal;\r\n\r\n    float elapsedTime = max(0.,uTime.x - uStartTime);\r\n    uint seed = floatBitsToUint(uStartTime) ^ floatBitsToUint(aColor.b);\r\n    vec3 velocity = vec3(\r\n        mix(uVelocityMin.x, uVelocityMax.x, hash11(seed+=1U)),\r\n        mix(uVelocityMin.y, uVelocityMax.y, hash11(seed+=1U)),\r\n        mix(uVelocityMin.z, uVelocityMax.z, hash11(seed+=1U))\r\n    );\r\n    vec3 acceleration = uGravity;\r\n    vec3 rotationAxis = normalize(cross(velocity, vec3(0,1,0)));\r\n    float angularVelocity = mix(uAngularVelocity.x, uAngularVelocity.y, hash11(seed+=1U));\r\n    float angularTime = 2.0;\r\n    float angularDeceleration = -angularVelocity/angularTime;\r\n    float at0 = min(angularTime, elapsedTime);\r\n    \r\n    float angle = at0 * angularVelocity + angularDeceleration*0.5*at0*at0;\r\n    vec4 quaternion = quat(rotationAxis, angle);\r\n#ifdef RANDOM_ROTATION\r\n    quaternion = qmul(qrandom(hash11(seed+=1U), hash11(seed+=1U), hash11(seed+=1U)), quaternion);\r\n#endif\r\n    position = qrotate(quaternion, position);\r\n    normal = qrotate(quaternion, normal);\r\n\r\n    float timeToGround = solveQuadratic(acceleration.y, 2.*velocity.y, 2.*uModelMatrix[3][1]);\r\n    float t0 = max(0., min(elapsedTime, timeToGround));\r\n    float t1 = max(0., elapsedTime - timeToGround);\r\n    vec3 velocity1 = vec3(.8*velocity.x, -.5 * (velocity.y + acceleration.y * t0), .8*velocity.z);\r\n    position += velocity * t0 + .5*acceleration * t0*t0;\r\n    position += velocity1 * t1 + .5*acceleration * t1*t1;\r\n\r\n    vColor.rgb = vec3(1);\r\n    vColor.a = mix(1.0, uArrayMapLayers, hash11(seed+=1U)) / uArrayMapLayers;\r\n\r\n    vPosition = (uModelMatrix * vec4(position, 1.0)).xyz;\r\n    vNormal = (uModelMatrix * vec4(normal, 0.0)).xyz;\r\n    vUV = aUV;\r\n    gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\r\n}"},1014:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nin vec3 vPosition;\r\n#ifdef INSTANCED\r\nin mat4 vInvModel;\r\nin vec4 vUV;\r\nin vec4 vColor;\r\nin float vThreshold;\r\n#else\r\nuniform ModelUniforms {\r\n    //mat4 uModelMatrix;\r\n    //vec4 uColor;\r\n    //float uLayer;\r\n    //uniform mat4 uInvModelMatrix;\r\n};\r\n#endif\r\n\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\n\r\nuniform float uLayer;\r\nuniform float uDissolveEdge;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform sampler2D uDiffuseMap;\r\nuniform sampler2D uNormalMap;\r\nuniform sampler2D uPositionBuffer;\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec3 viewRay = vPosition.xyz - uEyePosition;\r\n    vec4 worldPosition = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    if(worldPosition.a > uLayer) discard;\r\n    vec4 objectPosition = vInvModel * vec4(worldPosition.xyz, 1.0);\r\n    if(0.5 < abs(objectPosition.x) || 0.5 < abs(objectPosition.y) || 0.5 < abs(objectPosition.z)) discard;\r\n    vec2 uv = mix(vUV.xy, vUV.zw, objectPosition.xz + 0.5);\r\n    vec4 color = vColor * texture(uDiffuseMap, uv);\r\n#ifdef ALPHA_CUTOFF\r\n    if(color.a < ALPHA_CUTOFF) discard;\r\n#endif\r\n    fragAlbedo = color;\r\n#ifdef NORMAL_MAPPING\r\n    vec3 dpdx = dFdx(worldPosition.xyz);\r\n    vec3 dpdy = dFdy(worldPosition.xyz);\r\n    vec3 normal = normalize(cross(dpdx, dpdy));\r\n    vec3 binormal = normalize(dpdx);\r\n    vec3 tangent = normalize(dpdy);\r\n    mat3 TBN = mat3(tangent, binormal, normal);\r\n\r\n    vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\r\n    float blend = dot(mappedNormal, mappedNormal);\r\n    mappedNormal = normalize(TBN * mappedNormal);\r\n    fragNormal = blend * vec4(mappedNormal, 1.0);\r\n\r\n#ifdef ALPHA_CUTOFF\r\n    fragNormal.a=0.0;\r\n#endif\r\n\r\n#else\r\n    fragNormal = vec4(0);\r\n#endif\r\n\r\n#ifdef MASK\r\n    float alpha = texture(uNormalMap, uv).a;\r\n    float threshold = smoothstep(1.0+uDissolveEdge,1.0,abs(alpha*2.-1.+vThreshold));\r\n#ifdef ALPHA_CUTOFF\r\n    if(color.a * threshold < ALPHA_CUTOFF) discard;\r\n#endif\r\n    fragAlbedo *= threshold;\r\n    fragNormal *= threshold;\r\n#endif\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//In any case, here are the shader snippets for when I construct the tangent space based on the depth buffer:\r\n\r\n// These ones are hard-edges, but orientated to the scene geometry.\r\n//float3 pixelNormal = normalize(cross(ddy(worldPosition), ddx(worldPosition)));\r\n//float3x3 tbn = cotangent_frame(pixelNormal, worldPosition, decalTexCoord);\r\n\r\n// So now we can sample from the normal map, and turn it into a world normal, which we then encode.\r\n//float3 normal = mul(normalMap.xyz, tbn);\r\n//normal = normalize(normal); // this is the worldspace normal\r\n\r\n//and then:\r\n\r\n// N is the vertex normal.\r\n// uv is the texcoord for the decal.\r\n// p is the worldspace position.\r\n//float3x3 cotangent_frame(float3 N, float3 p, float2 uv)\r\n//{\r\n// get edge vectors of the pixel triangle\r\n//float3 dp1 = ddx(p);\r\n//float3 dp2 = ddy(p);\r\n//float2 duv1 = ddx(uv);\r\n//float2 duv2 = ddy(uv);\r\n\r\n// solve the linear system\r\n//float3 dp2perp = cross(dp2, N);\r\n//float3 dp1perp = cross(N, dp1);\r\n//float3 T = dp2perp * duv1.x + dp1perp * duv2.x;\r\n//float3 B = dp2perp * duv1.y + dp1perp * duv2.y;\r\n\r\n// construct a scale-invariant frame\r\n//float invmax = rsqrt(max(dot(T,T), dot(B,B)));\r\n//return float3x3(T * invmax, B * invmax, N);\r\n//}"},2098:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\n#ifdef INSTANCED\r\nlayout(location=1) in mat4 aModelMatrix;\r\nlayout(location=5) in vec4 aUV;\r\nlayout(location=6) in vec4 aColor;\r\n\r\nout vec3 vPosition;\r\n#ifdef WORLD\r\nout mat4 vModel;\r\n#else\r\nout mat4 vInvModel;\r\n#endif\r\nout vec4 vUV;\r\nout vec4 vColor;\r\nout float vThreshold;\r\n#else\r\nuniform ModelUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uLayer;\r\n};\r\n#endif\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nvoid main(){\r\n    mat4 modelMatrix = aModelMatrix;\r\n    modelMatrix[0][3]=0.0;modelMatrix[1][3]=0.0;modelMatrix[2][3]=0.0;modelMatrix[3][3]=1.0;\r\n    vPosition = (modelMatrix * vec4(aPosition, 1.0)).xyz;\r\n#ifdef WORLD\r\n    vModel = modelMatrix;\r\n#else\r\n    vInvModel = inverse(modelMatrix);\r\n#endif\r\n    vThreshold = aModelMatrix[0][3];\r\n    vUV = aUV;\r\n    vColor = aColor;\r\n    gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\r\n}"},2289:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec3 vPosition;\r\nin vec3 vNormal;\r\n#ifndef MESH\r\nin vec4 vColor;\r\nin float vMaterial;\r\n#endif\r\n\r\nout vec4 fragColor;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nuniform sampler2D uAlbedoBuffer;\r\nuniform sampler2D uSampler;\r\n\r\nuniform float uDistortionStrength;\r\n#ifdef PANNING\r\nuniform vec4 uUVTransform;\r\nuniform vec2 uUVPanning;\r\n#endif\r\n#ifdef VERTICAL_MASK\r\nuniform vec4 uVerticalMask;\r\n#endif\r\n#ifdef HORIZONTAL_MASK\r\nuniform vec4 uHorizontalMask;\r\n#endif\r\n\r\nvoid main(){\r\n#ifdef PANNING\r\n    vec2 uv0 = uUVTransform.xy + uUVTransform.zw * vUV;\r\n    vec4 color = texture(uSampler,uv0 + uTime.x * uUVPanning);\r\n#else\r\n    vec4 color = texture(uSampler,vUV);\r\n#endif\r\n\r\n#ifdef VERTICAL_MASK\r\n    color *= smoothstep(uVerticalMask.x,uVerticalMask.y,vUV.y);\r\n    color *= smoothstep(uVerticalMask.w,uVerticalMask.z,vUV.y);\r\n#endif\r\n#ifdef HORIZONTAL_MASK\r\n    color *= smoothstep(uHorizontalMask.x,uHorizontalMask.y,vUV.x);\r\n    color *= smoothstep(uHorizontalMask.w,uHorizontalMask.z,vUV.x);\r\n#endif\r\n\r\n#ifdef MESH\r\n    vec3 normal = normalize(vNormal);\r\n    vec3 view = normalize(uEyePosition - vPosition);\r\n    float NdV = dot(normal, view);\r\n    vec3 viewNormal = (uViewMatrix * vec4(normal, 0.0)).xyz;\r\n    vec2 distortion = NdV * 0.1 * viewNormal.rg;\r\n#else\r\n    color *= vColor;\r\n    float height = color.r;\r\n    vec2 duvdx = dFdx(vUV);\r\n    vec2 duvdy = dFdy(vUV);\r\n    float dhdx = dFdx(height) / length(duvdx);\r\n    float dhdy = dFdy(height) / length(duvdy);\r\n    vec2 distortion = uDistortionStrength * color.a * vec2(dhdx, dhdy);\r\n#endif\r\n    vec2 uv = vec2(gl_FragCoord.xy) / vec2(textureSize(uAlbedoBuffer, 0));\r\n    uv += distortion;\r\n#ifdef CHROMATIC_ABERRATION\r\n    float red = texture(uAlbedoBuffer, uv - vec2(.01*color.b,0)).r;\r\n    vec4 diffuse = texture(uAlbedoBuffer, uv);\r\n    float blue = texture(uAlbedoBuffer, uv + vec2(.01*color.b,0)).b;\r\n    fragColor = vec4(red, diffuse.g, blue, diffuse.a);\r\n#else\r\n    fragColor = texture(uAlbedoBuffer, uv);\r\n#endif\r\n}"},6633:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define LOG2 1.4426950408889634\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nuniform sampler2D uSampler;\r\nuniform sampler2D uPositionBuffer;\r\n#ifdef BLOOM\r\nuniform sampler2D uBloomMap;\r\nuniform vec4 uBloomMask;\r\n#endif\r\n\r\n#if defined(LINEAR_FOG)\r\nuniform vec4 uFogColor;\r\nuniform vec2 uFogRange;\r\n#elif defined(EXPONENTIAL_FOG)\r\nuniform vec4 uFogColor;\r\nuniform float uFogDensity;\r\n#endif\r\n\r\n#ifdef HALFSPACE\r\nuniform vec2 uFogHeight;\r\nfloat halfspace(vec3 origin, vec3 position, vec3 ray, float fogHeight, float fogDensity){\r\n    float fdc = origin.y-fogHeight;\r\n    float fdp = position.y-fogHeight;\r\n    float fdv = position.y-origin.y;\r\n    float k = step(fdc,0.);\r\n    float c1 = k * (fdp + fdc);\r\n    float c2 = (1.-2.*k) * fdp;\r\n    float g = min(c2, 0.0);\r\n    g = -length(.5*fogDensity * ray) * (c1 - g * g / abs(fdv+1.0e-5f));\r\n    return g;\r\n}\r\n#endif\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec4 color = texelFetch(uSampler, fragCoord, 0);\r\n\r\n    vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    vec3 viewRay = position.xyz - uEyePosition;\r\n    float distance = length(viewRay) * step(.5,position.a);\r\n\r\n#ifdef HALFSPACE\r\n    distance += halfspace(uEyePosition, position.xyz, viewRay, uFogHeight.x, uFogHeight.y);\r\n#endif\r\n\r\n#if defined(LINEAR_FOG)\r\n    float fogAmount = 1.-smoothstep(uFogRange.x, uFogRange.y, distance);\r\n    color = mix(uFogColor, color, fogAmount);\r\n#elif defined(EXP_FOG)\r\n    float fogAmount = clamp(exp2(-uFogDensity * distance * LOG2)),0.,1.);\r\n    //float fogAmount = (a/b) * exp(-uEyePosition.y*uFogDensity) * (1.0-exp( -distance*viewRay.y*uFogDensity ))/viewRay.y;\r\n    color = mix(uFogColor, color, fogAmount);\r\n#elif defined(EXP2_FOG)\r\n    float fogAmount = clamp(exp2(-uFogDensity*uFogDensity * distance*distance * LOG2)),0.,1.);\r\n    color = mix(uFogColor, color, fogAmount);\r\n#endif\r\n\r\n#ifdef BLOOM\r\n    vec4 bloom = uBloomMask * texture(uBloomMap, vUV);\r\n    color += bloom;\r\n#endif\r\n    fragColor = color;\r\n}"},5434:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#ifdef CUBEMAP\r\nuniform samplerCube uSampler;\r\n#else\r\nuniform sampler2D uSampler;\r\n#endif\r\nuniform vec4 uMask;\r\n\r\n#define TAU 6.283185307179586\r\n\r\nvoid main(){\r\n#ifdef CUBEMAP\r\n    vec2 uv = vUV * vec2(TAU,.5*TAU);\r\n    vec3 ray = vec3(\r\n       -sin(uv.x) * sin(uv.y),\r\n       -cos(uv.y),\r\n       -cos(uv.x) * sin(uv.y)\r\n    );\r\n    fragColor = texture(uSampler, ray);\r\n#else\r\n#ifdef NEAREST\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    fragColor = uMask * texelFetch(uSampler, fragCoord, 0);\r\n#else\r\n    fragColor = uMask * texture(uSampler, vUV);\r\n#endif\r\n#endif\r\n}"},9679:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\n\r\nout vec2 vUV;\r\n\r\n#ifdef RAYCAST\r\nout vec3 vOrigin;\r\nout vec3 vRay;\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n#endif\r\n\r\nvoid main(){\r\n    gl_Position = vec4(aPosition.xzy, 1.0);\r\n    vUV = 0.5 + 0.5 * aPosition.xz;\r\n#ifdef RAYCAST\r\n    mat4 invProjectionView = inverse(uProjectionMatrix * uViewMatrix);\r\n    float near = uProjectionMatrix[2][3] / (uProjectionMatrix[2][2] - 1.0);\r\n    float far = uProjectionMatrix[2][3] / (uProjectionMatrix[2][2] + 1.0);\r\n    vOrigin = (invProjectionView * vec4(aPosition.xz, -1.0, 1.0) * near).xyz;\r\n    vRay = (invProjectionView * vec4(aPosition.xz * (far - near), far + near, far - near)).xyz;\r\n#endif\r\n}"},1241:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\nuniform vec2 uSize;\r\n\r\nvoid main(){\r\n    vec4 color = vec4(0);\r\n    vec2 offset = uSize / vec2(textureSize(uSampler, 0));\r\n\r\n#if KERNEL_SIZE == 13\r\n    vec2 off1 = vec2(1.411764705882353) * offset;\r\n    vec2 off2 = vec2(3.2941176470588234) * offset;\r\n    vec2 off3 = vec2(5.176470588235294) * offset;\r\n    color += texture(uSampler, vUV) * 0.1964825501511404;\r\n    color += texture(uSampler, vUV + off1) * 0.2969069646728344;\r\n    color += texture(uSampler, vUV - off1) * 0.2969069646728344;\r\n    color += texture(uSampler, vUV + off2) * 0.09447039785044732;\r\n    color += texture(uSampler, vUV - off2) * 0.09447039785044732;\r\n    color += texture(uSampler, vUV + off3) * 0.010381362401148057;\r\n    color += texture(uSampler, vUV - off3) * 0.010381362401148057;\r\n#elif KERNEL_SIZE == 9\r\n    vec2 off1 = vec2(1.3846153846) * offset;\r\n    vec2 off2 = vec2(3.2307692308) * offset;\r\n    color += texture(uSampler, vUV) * 0.2270270270;\r\n    color += texture(uSampler, vUV + off1) * 0.3162162162;\r\n    color += texture(uSampler, vUV - off1) * 0.3162162162;\r\n    color += texture(uSampler, vUV + off2) * 0.0702702703;\r\n    color += texture(uSampler, vUV - off2) * 0.0702702703;\r\n#elif KERNEL_SIZE == 5\r\n    vec2 off1 = vec2(1.3333333333333333) * offset;\r\n    color += texture(uSampler, vUV) * 0.29411764705882354;\r\n    color += texture(uSampler, vUV + off1) * 0.35294117647058826;\r\n    color += texture(uSampler, vUV - off1) * 0.35294117647058826;\r\n#endif\r\n\r\n    fragColor = color;\r\n}"},4350:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\nprecision highp sampler2DArray;\r\n\r\n#define MAP_SCALE 10.0\r\n\r\nin vec3 vPosition;\r\nin vec3 vNormal; \r\nin vec2 vUV;\r\n#ifdef VERTEX_COLOR\r\nin vec4 vColor;\r\n#endif\r\n\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\nlayout(location=2) out vec4 fragPosition;\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform ModelUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uLayer;\r\n    float uStartTime;\r\n};\r\nuniform sampler2D uDiffuseMap;\r\nuniform sampler2D uNormalMap;\r\n\r\n#ifdef COLOR_INDEX\r\n    uniform sampler2DArray uArrayMap;\r\n    uniform float uArrayMapLayers;\r\n#endif\r\n\r\nvec2 hash22(in vec2 uv){\r\n    uvec2 q = floatBitsToUint(uv);\r\n\tq *= uvec2(1597334673U, 3812015801U);\r\n\tq = (q.x ^ q.y) * uvec2(1597334673U, 3812015801U);\r\n\treturn vec2(q) * (1.0 / float(0xffffffffU));\r\n}\r\nfloat simplex2D(in vec2 uv){\r\n    const float K1 = (sqrt(3.)-1.)/2.;\r\n    const float K2 = (3.-sqrt(3.))/6.;\r\n\r\n\tvec2 i = floor(uv + (uv.x+uv.y)*K1);\r\n    vec2 a = uv - i + (i.x+i.y)*K2;\r\n    float m = step(a.y,a.x); \r\n    vec2 o = vec2(m,1.0-m);\r\n    vec2 b = a - o + K2;\r\n\tvec2 c = a - 1.0 + 2.0*K2;\r\n    vec3 h = max(0.5-vec3(dot(a,a), dot(b,b), dot(c,c)), 0.0);\r\n    vec2 rx = 1.-2.*hash22(i+0.0);\r\n    vec2 ry = 1.-2.*hash22(i+o);\r\n    vec2 rz = 1.-2.*hash22(i+1.0);\r\n\tvec3 n = h*h*h*h*vec3(dot(a,rx), dot(b,ry), dot(c,rz));\r\n    return 0.5 + 0.5*dot(n, vec3(70.0));\r\n}\r\n#ifdef DISSOLVE\r\n    uniform vec3 uDissolveDirection;\r\n    uniform float uDissolveThreshold;\r\n    uniform vec4 uDissolveColor;\r\n    uniform vec3 uDissolveUVScale;\r\n#endif\r\n\r\nvec2 parallaxMapping(in vec2 uv, in vec3 viewDirection, in float heightScale){\r\n#ifndef PARALLAX_LAYERS\r\n    float depth = texture(uNormalMap, uv).w;\r\n    return uv - viewDirection.xy * heightScale * depth / viewDirection.z;\r\n#else\r\n    float numLayers = float(PARALLAX_LAYERS) - float(PARALLAX_LAYERS-1) * abs(dot(vec3(0,0,1), viewDirection));\r\n    float layerDepth = 1.0 / numLayers;\r\n    vec2 deltaUV = heightScale * viewDirection.xy / (viewDirection.z * numLayers);\r\n    float depth = 0.0, value = texture(uNormalMap, uv).w;\r\n    for(int i=0;i<PARALLAX_LAYERS;i++){\r\n        if(value < depth) break;\r\n        uv -= deltaUV;\r\n        value = texture(uNormalMap, uv).w;\r\n        depth += layerDepth;\r\n    }\r\n    vec2 prevUV = uv + deltaUV;\r\n    float depthAfter = value - depth;\r\n    float depthBefore = texture(uNormalMap, prevUV).w - depth + layerDepth;\r\n    float weight = depthAfter / (depthAfter - depthBefore);\r\n    return mix(uv, prevUV, weight);\r\n#endif\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n    vec3 position = vPosition;\r\n//#ifdef SKINNING\r\n//    vec3 normal = normalize(cross(dFdx(position),dFdy(position)));\r\n//#else\r\n    vec3 normal = normalize(vNormal);\r\n//#endif\r\n\r\n#ifdef NORMAL_MAPPING\r\n    vec3 dpdx = dFdx(position);\r\n    vec3 dpdy = dFdy(position);\r\n    vec2 duvdx = dFdx(uv);\r\n    vec2 duvdy = dFdy(uv);\r\n    vec3 r1 = cross(dpdy, normal);\r\n    vec3 r2 = cross(normal, dpdx);\r\n#ifdef BUMP_MAPPING\r\n    vec3 tangent = r1 * duvdx.x + r2 * duvdy.x;\r\n    vec3 binormal = r1 * duvdx.y + r2 * duvdy.y;\r\n    float invMax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\r\n    mat3 TBN = mat3(tangent * invMax, binormal * invMax, normal);\r\n\r\n    mat3 invTBN = mat3(vec3(TBN[0].x,TBN[1].x,TBN[2].x),vec3(TBN[0].y,TBN[1].y,TBN[2].y),vec3(TBN[0].z,TBN[1].z,TBN[2].z));\r\n    vec3 viewDirection = invTBN * normalize(position - uEyePosition);\r\n    uv = parallaxMapping(uv, viewDirection, 0.1);\r\n\r\n    vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\r\n    normal = normalize(TBN * mappedNormal);\r\n#else\r\n    vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\r\n    vec2 heightGradient = MAP_SCALE * 2.0 * mappedNormal.xy / -mappedNormal.z;\r\n    \r\n    float dhdx = dot(heightGradient, duvdx);\r\n    float dhdy = dot(heightGradient, duvdy);\r\n\r\n    vec3 surfaceGradient = (r1 * dhdx + r2 * dhdy) / dot(dpdx, r1);\r\n    normal = normalize(normal - surfaceGradient);\r\n#endif\r\n#endif\r\n    vec4 diffuse = texture(uDiffuseMap, uv);\r\n\r\n#ifdef COLOR_INDEX\r\n#ifdef VERTEX_COLOR\r\n    diffuse = texture(uArrayMap, vec3(4.*uv, uArrayMapLayers * vColor.a));\r\n    diffuse.rgb *= vColor.rgb;\r\n#else\r\n    vec2 size = vec2(textureSize(uDiffuseMap, 0));\r\n    float colorIndex = texelFetch(uDiffuseMap, ivec2(uv * size), 0).r;\r\n    float ao = diffuse.g;\r\n    diffuse = texture(uArrayMap, vec3(4.*uv, uArrayMapLayers * colorIndex));\r\n    diffuse.rgb *= ao;\r\n#endif\r\n#endif\r\n\r\n#ifdef DISSOLVE\r\n    diffuse = mix(uColor.rrrg, diffuse, uColor.b);\r\n    float threshold = dot(position, uDissolveDirection) + uDissolveUVScale.z * simplex2D(uv * uDissolveUVScale.xy);\r\n    if(threshold < uColor.a) discard;\r\n    diffuse = mix(diffuse, uDissolveColor, smoothstep(-uDissolveThreshold,0.,uColor.a - threshold));\r\n#else\r\n    diffuse.rgb *= uColor.rgb;\r\n    diffuse.a = mix(0.5, diffuse.a, uColor.a);\r\n#endif\r\n    float metallic = 2.0 * 0.5 * smoothstep(0.25, 0.0, diffuse.a);\r\n\r\n    fragPosition = vec4(position, uLayer);\r\n    fragNormal = vec4(normal, metallic);\r\n    fragAlbedo = diffuse;\r\n}"},1964:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\nlayout(location=1) in vec3 aNormal;\r\nlayout(location=2) in vec2 aUV;\r\n#ifdef SKINNING\r\nlayout(location=3) in vec4 aJoint;\r\nlayout(location=4) in vec4 aWeight;\r\n\r\nuniform vec4 uBoneMatrix[64];\r\n\r\nmat4 boneMatrix(uint joint){\r\n    vec4 col0 = uBoneMatrix[joint*3U+0U];\r\n    vec4 col1 = uBoneMatrix[joint*3U+1U];\r\n    vec4 col2 = uBoneMatrix[joint*3U+2U];\r\n    return mat4(col0[0], col1[0], col2[0], 0.0,\r\n        col0[1], col1[1], col2[1], 0.0,\r\n        col0[2], col1[2], col2[2], 0.0,\r\n        col0[3], col1[3], col2[3], 1.0);\r\n}\r\n#endif\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform ModelUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uLayer;\r\n    float uStartTime;\r\n};\r\n\r\nout vec3 vPosition;\r\nout vec3 vNormal;\r\nout vec2 vUV;\r\n\r\nvoid main(){\r\n#ifdef SKINNING\r\n    mat4 skinMatrix =\r\n        aWeight.x * boneMatrix(uint(aJoint.x)) +\r\n        aWeight.y * boneMatrix(uint(aJoint.y)) +\r\n        aWeight.z * boneMatrix(uint(aJoint.z)) +\r\n        aWeight.w * boneMatrix(uint(aJoint.w));\r\n    mat4 modelTransform = uModelMatrix * skinMatrix;\r\n#else\r\n    mat4 modelTransform = uModelMatrix;\r\n#endif\r\n    vPosition = (modelTransform * vec4(aPosition, 1.0)).xyz;\r\n    vNormal = (modelTransform * vec4(aNormal, 0.0)).xyz;\r\n    vUV = aUV;\r\n    gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\r\n}"},5197:e=>{e.exports="#version 300 es\r\n\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform LightUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uRadius;\r\n    float uIntensity;\r\n};\r\n\r\nvoid main(){\r\n    gl_Position = uViewProjectionMatrix * uModelMatrix * vec4(aPosition * uRadius, 1.0);\r\n}"},7966:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(in float u){\r\n    uint n = floatBitsToUint(u);\r\n    n = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & 0x7fffffffU)/float(0x7fffffff);\r\n}\r\nfloat hash21(in vec2 uv){\r\n    uvec2 q = floatBitsToUint(uv);\r\n    q = 1103515245u * ((q >> 1u) ^ q.yx);\r\n    uint n = 1103515245u * (q.x ^ (q.y >> 3u));\r\n    return float(n) * (1.0 / float(0xffffffffu));\r\n}\r\nvec2 hash22(in vec2 uv){\r\n    uvec4 q = floatBitsToUint(uv).xyyx;\r\n    q = 1103515245u * ((q >> 1u) ^ q.yxwz);\r\n    uvec2 n = 1103515245u * (q.xz ^ (q.yw >> 3u));\r\n    return vec2(n) * (1.0 / float(0xffffffffu));\r\n}\r\nfloat noise11(in float u, in float period, float seed){\r\n    u *= period;\r\n    vec2 i = mod(floor(vec2(u,u+1.0)),vec2(period))+seed;\r\n    float f = fract(u);\r\n    return mix(hash11(i.x),hash11(i.y),f);\r\n}\r\nfloat noise21(in vec2 uv, in vec2 period, float seed){\r\n    uv *= period;\r\n    vec4 i = mod(floor(uv).xyxy+vec2(0,1).xxyy,period.xyxy)+seed;\r\n    vec2 f = fract(uv); f = f*f*f*(f*(f*6.0-15.0)+10.0);\r\n    return mix(mix(hash21(i.xy), \r\n                   hash21(i.zy), f.x),\r\n               mix(hash21(i.xw), \r\n                   hash21(i.zw), f.x), f.y);\r\n}\r\nvec3 noise21d(in vec2 uv, in vec2 period, float seed){\r\n    uv *= period;\r\n    vec4 i = mod(floor(uv).xyxy+vec2(0,1).xxyy,period.xyxy)+seed;\r\n    vec2 u = fract(uv);\r\n    vec2 du = 30.0 * u * u * (u * (u - 2.0) + 1.0);\r\n    u = u*u*u*(u*(u*6.0-15.0)+10.0);\r\n    float a = hash21(i.xy);\r\n    float b = hash21(i.zy);\r\n    float c = hash21(i.xw);\r\n    float d = hash21(i.zw);\r\n    float abcd = a - b - c + d;\r\n    float value = a + (b - a) * u.x + (c - a) * u.y + abcd * u.x * u.y;\r\n    vec2 derivative = du.xy * (u.yx * abcd + vec2(b, c) - a);\r\n    return vec3(value * 2.0 - 1.0, derivative);\r\n}\r\n\r\nfloat perlin2D(vec2 uv, vec2 period, float seed){\r\n    uv *= period;\r\n    vec4 i = floor(uv).xyxy + vec2(0,1).xxyy;\r\n    vec4 f = uv.xyxy - i.xyxy - vec2(0,1).xxyy;\r\n    i = mod(i, period.xyxy) + seed;\r\n    vec2 a = hash22(i.xy);\r\n    vec2 b = hash22(i.zy);\r\n    vec2 c = hash22(i.xw);\r\n    vec2 d = hash22(i.zw);\r\n    vec4 gradientX = vec4(a.x,b.x,c.x,d.x)-.5;\r\n    vec4 gradientY = vec4(a.y,b.y,c.y,d.y)-.5;\r\n    vec4 gradients = inversesqrt(gradientX * gradientX + gradientY * gradientY) * (gradientX * f.xzxz + gradientY * f.yyww);\r\n    gradients *= 2.3703703703703703703703703703704;\r\n    vec4 lengthSq = f * f;\r\n    lengthSq = lengthSq.xzxz + lengthSq.yyww;\r\n    vec4 xSq = 1.0 - min(vec4(1.0), lengthSq); \r\n    xSq = xSq * xSq * xSq;\r\n    return .5+.5*dot(xSq, gradients);\r\n}\r\n\r\nfloat fbm(vec2 uv, vec2 frequency, int octaves, float shift, float gain, float lacunarity, float factor, float seed){\r\n    uv *= frequency;\r\n    vec2 offset = vec2(shift,0);\r\n    float value = 0.0, amplitude = gain;\r\n    vec2 sc = vec2(sin(shift), cos(shift)); mat2 rotate = mat2(sc.y,sc.x,-sc.x,sc.y);\r\n    for(int i=0;i<octaves;i++){\r\n        value += amplitude * (noise21(uv / frequency, frequency, seed)*2.-1.);\r\n        uv = uv * lacunarity + offset * float(i+1);\r\n        frequency *= lacunarity;\r\n        amplitude = pow(amplitude * gain, factor);\r\n        offset *= rotate;\r\n    }\r\n    return .5+.5*value;\r\n}\r\nvec3 fbmd(vec2 uv, vec2 frequency, int octaves, vec2 shift, float gain, vec2 lacunarity, float slopeness, float factor, float seed){\r\n    uv *= frequency;\r\n    vec3 value = vec3(0); vec2 derivative = vec2(0); float amplitude = gain;\r\n    vec2 sc = vec2(sin(shift.x),cos(shift.y)); mat2 rotate = mat2(sc.y,sc.x,-sc.x,sc.y);\r\n    for(int i=0;i<octaves;i++){\r\n        vec3 n = noise21d(uv / frequency, frequency, seed).xyz;\r\n        derivative += n.yz;\r\n\r\n        n *= amplitude;\r\n        n.x /= (1.0 + mix(0.0, dot(derivative, derivative), slopeness));\r\n        value += n; \r\n        \r\n        uv = (uv + shift) * lacunarity;\r\n        frequency *= lacunarity;\r\n        amplitude = pow(amplitude * gain, factor);\r\n        shift *= rotate;\r\n    }\r\n    value.x = value.x * 0.5 + 0.5;\r\n    return value;\r\n}\r\nvec4 voronoi(in vec2 uv, in vec2 period, in float jitter, in float width, in float seed){\r\n    uv *= period;\r\n    vec2 i = floor(uv); vec2 f = uv - i;\r\n    vec2 minPos, tilePos;\r\n    float md = 1e+5;\r\n    for(int y=-1;y<=1;y++)\r\n    for(int x=-1;x<=1;x++){\r\n        vec2 n = vec2(x,y);\r\n        vec2 cPos = jitter * hash22(mod(i + n, period) + seed);\r\n        vec2 rPos = n + cPos - f;\r\n        float d = dot(rPos, rPos);\r\n        if(d >= md) continue;\r\n        md = d;\r\n        minPos = rPos;\r\n        tilePos = cPos;\r\n    }\r\n    float md0 = 1e+5, md1 = 1e+5;\r\n    for(int y=-2;y<=2;y++)\r\n    for(int x=-2;x<=2;x++){\r\n        vec2 n = vec2(x,y);\r\n        vec2 cPos = jitter * hash22(mod(i + n, period) + seed);\r\n        vec2 rPos = n + cPos - f;\r\n        vec2 v = minPos - rPos;\r\n        if(dot(v, v) <= 1e-5) continue;\r\n        float d = dot(0.5 * (minPos + rPos), normalize(rPos - minPos));\r\n        if(d < md0){\r\n            md1 = md0; md0 = d;\r\n        }else if(d < md1){\r\n            md1 = d;\r\n        }\r\n    }\r\n    md0 += (md1 - md0) * width;\r\n    return vec4(md0, md, tilePos);\r\n}\r\n\r\nvec4 rectangularNoise(in vec2 uv, in vec2 period){\r\n    uv *= period;\r\n    vec2 i = floor(uv);\r\n    vec2 f = uv - i;\r\n    vec2 c = vec2(0);\r\n    int o = int(i.x+i.y) & 1;\r\n    int u = o ^ 1;\r\n    bool s = f[o]>hash21(mod(i,period));\r\n    if(s) c[o] = 1.;\r\n    vec2 n = i;\r\n    n[o] += s ? 1. : -1.;\r\n    if(f[u]>hash21(mod(n,period))) c[u] = 1.;\r\n    c = i+c;\r\n\r\n    vec4 d = vec4(\r\n        hash21(mod(c + vec2(-1,-1), period)), \r\n        hash21(mod(c + vec2( 0,-1), period)), \r\n        hash21(mod(c + vec2( 0, 0), period)), \r\n    \thash21(mod(c + vec2(-1, 0), period))\r\n    );\r\n    o = int(c.x+c.y) & 1;\r\n    if(o==1) d = d.wxyz;\r\n    d = d + vec4(c-1.,c);\r\n    vec2 mi = d.xy;\r\n    vec2 ma = d.zw;\r\n    return vec4(uv-mi, uv-ma);\r\n}\r\n\r\nfloat sineNoise(vec2 uv, int layers, float shift){\r\n    vec2 p = vec2(uv); float v = 0.0;\r\n\tfor(int i=0;i<layers;i++){\r\n\t\tfloat t = shift * (.75+.25*sin(float(i+1)*43758.5453));\r\n        uv.y -= t;\r\n\t\tp = uv + vec2(cos(t - p.x) + sin(t + p.y), sin(t - p.y) + cos(t + p.x));\r\n        v += 1.0/length(1.0/vec2(sin(p.x+t), cos(p.y+t)));\r\n\t}\r\n    v = smoothstep(1.0,0.0,v / float(layers));\r\n    return pow(v,1.4);\r\n}\r\n\r\nuniform vec4 uColor;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n#ifdef SKEW\r\n    uv = vec2(uv.x+uv.y,uv.x-uv.y);\r\n#endif\r\n#if defined(CELLULAR)\r\n    vec4 w = voronoi(uv, vec2(8), 1.0, 0.0, 0.0);\r\n    float alpha = 1.0-(1.0-1.5*w.y);\r\n    vec4 color = vec4(alpha);\r\n#elif defined(VORONOI)\r\n    vec4 w = voronoi(uv, vec2(8), 1.0, 0.0, 0.0);\r\n    float alpha = smoothstep(0.8,-0.2,w.x);\r\n    vec4 color = vec4(alpha);\r\n#elif defined(PERLIN)\r\n    float nx = perlin2D(uv, vec2(8.0), 0.0);\r\n    float ny = perlin2D(uv + vec2(0.3), vec2(8.0), 0.0);\r\n    float nz = perlin2D(uv + vec2(0.7), vec2(8.0), 0.0);\r\n    vec4 color = vec4(nx,ny,nz,1);\r\n#elif defined(RECTANGULAR)\r\n    vec4 minmax = rectangularNoise(uv, vec2(8));\r\n    float alpha = min(min(abs(minmax.x), abs(minmax.y)), min(abs(minmax.z),abs(minmax.w)));\r\n    vec4 color = vec4(alpha);\r\n#elif defined(SINE)\r\n    float alpha = sineNoise(uv*TAU, 8, 411.37);\r\n    alpha = smoothstep(0.2,1.0,alpha);\r\n    vec4 color = vec4(alpha);\r\n#elif defined(WARP)\r\n    const float gain = 0.5, slopeness = 0.5, factor = 0.94, seed = 0.0;\r\n    const vec2 lacunarity = vec2(2), frequency = vec2(8.0);\r\n\r\n    float f0 = fbmd(uv, frequency, 7, vec2(123), gain, lacunarity, slopeness, factor, seed).x;\r\n    float f1 = fbmd(uv, frequency, 7, vec2(235), gain, lacunarity, slopeness, factor, seed).x;\r\n    uv = uv + 0.2 * vec2(f0, f1);\r\n    float alpha = fbmd(uv, frequency, 7, vec2(0.0), gain, lacunarity, slopeness, factor, seed).x;\r\n    vec4 color = vec4(alpha);\r\n#else\r\n    float f0 = fbm(uv, vec2(8.0), 7, 23.0, 0.5, 2.0, 0.95, 0.0);\r\n    float alpha = smoothstep(0.2, 1.0, f0);\r\n    vec4 color = vec4(alpha);\r\n#endif\r\n\tfragColor = uColor * color;\r\n}"},7745:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec4 aLifetime;\r\nlayout(location=1) in vec4 aSize;\r\nlayout(location=2) in vec4 aTransform;\r\nlayout(location=3) in vec4 aVelocity;\r\nlayout(location=4) in vec4 aAcceleration;\r\n\r\nlayout(xfb_offset=0) out vec4 vLifetime;\r\nlayout(xfb_offset=0) out vec4 vSize;\r\nlayout(xfb_offset=0) out vec4 vTransform;\r\nlayout(xfb_offset=0) out vec4 vVelocity;\r\nlayout(xfb_offset=0) out vec4 vAcceleration;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform EmitterUniforms {\r\n    vec4 uLifespan;\r\n    vec3 uOrigin;\r\n    vec2 uSize;\r\n    vec3 uGravity;\r\n#if defined(SPHERE)\r\n    vec2 uRadius;\r\n#elif defined(CIRCLE)\r\n    vec2 uRadius;\r\n    vec4 uOrientation;\r\n#elif defined(BOX)\r\n    vec3 uExtents;\r\n#endif\r\n#ifdef TARGETED\r\n    vec2 uForce;\r\n    vec3 uTarget;\r\n#endif\r\n#ifdef VECTOR_FIELD\r\n\tvec4 uFieldDomain;\r\n\tvec2 uFieldStrength;\r\n#endif\r\n#ifdef TRAIL\r\n    vec2 uLength;\r\n#else\r\n    vec2 uRotation;\r\n#endif\r\n#ifdef ANGULAR\r\n    vec4 uAngular;\r\n#endif\r\n#ifdef FRAMES\r\n    vec2 uFrame;\r\n#endif\r\n    int uLastID;\r\n};\r\n\r\n#ifdef LUT\r\nuniform sampler2D uAttributes;\r\nvec4 lerpLUT(sampler2D texture, float u, int v){\r\n    float width = float(textureSize(texture,0).x);\r\n    ivec2 uv = ivec2(u * width, v);\r\n    vec4 a = texelFetchOffset(texture,uv,0,ivec2(0,0));\r\n    vec4 b = texelFetchOffset(texture,uv,0,ivec2(1,0));\r\n    float f = fract(u * width);\r\n    return mix(a, b, f);\r\n}\r\n#endif\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(uint n){\r\n\tn = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float(n & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\nfloat hash31(vec3 uv){\r\n\tconst uvec3 u = uvec3(1597334673U, 3812015801U, 2798796415U);\r\n\tuvec3 q = floatBitsToUint(uv);\r\n\tq *= u;\r\n\tuint n = (q.x ^ q.y ^ q.z) * 1597334673U;\r\n\treturn -1.0 + 2.0 * float(n) * (1.0 / float(0xffffffffU));\r\n}\r\nvec3 hash33(vec3 uv){\r\n\tconst uvec3 u = uvec3(1597334673U, 3812015801U, 2798796415U);\r\n\tuvec3 q = floatBitsToUint(uv);\r\n\tq *= u;\r\n\tq = (q.x ^ q.y ^ q.z)*u;\r\n\treturn -1.0 + 2.0 * vec3(q) * (1.0 / float(0xffffffffU));\r\n}\r\n\r\nfloat noise3D(vec3 p, float seed){\r\n    vec3 pi = floor(p);\r\n    vec3 pf = p - pi; pi += seed;\r\n    vec3 w = pf * pf * (3.0 - 2.0 * pf);\r\n    return mix(mix(mix(hash31(pi + vec3(0, 0, 0)), hash31(pi + vec3(1, 0, 0)), w.x),\r\n        \t   mix(hash31(pi + vec3(0, 0, 1)), hash31(pi + vec3(1, 0, 1)), w.x), w.z),\r\n               mix(mix(hash31(pi + vec3(0, 1, 0)), hash31(pi + vec3(1, 1, 0)), w.x),\r\n                   mix(hash31(pi + vec3(0, 1, 1)), hash31(pi + vec3(1, 1, 1)), w.x), w.z), w.y);\r\n}\r\nfloat perlin3D(vec3 p, float seed){\r\n    vec3 pi = floor(p);\r\n    vec3 pf = p - pi; pi += seed;\r\n    vec3 w = pf * pf * (3.0 - 2.0 * pf);\r\n    return mix(mix(mix(dot(pf - vec3(0, 0, 0), hash33(pi + vec3(0, 0, 0))), \r\n                       dot(pf - vec3(1, 0, 0), hash33(pi + vec3(1, 0, 0))), w.x),\r\n                   mix(dot(pf - vec3(0, 0, 1), hash33(pi + vec3(0, 0, 1))), \r\n                       dot(pf - vec3(1, 0, 1), hash33(pi + vec3(1, 0, 1))), w.x), w.z),\r\n               mix(mix(dot(pf - vec3(0, 1, 0), hash33(pi + vec3(0, 1, 0))), \r\n                       dot(pf - vec3(1, 1, 0), hash33(pi + vec3(1, 1, 0))), w.x),\r\n                   mix(dot(pf - vec3(0, 1, 1), hash33(pi + vec3(0, 1, 1))), \r\n                       dot(pf - vec3(1, 1, 1), hash33(pi + vec3(1, 1, 1))), w.x), w.z), w.y);\r\n}\r\nfloat simplex3D(vec3 p){\r\n    const float K1 = 0.333333333;\r\n    const float K2 = 0.166666667;\r\n    vec3 i = floor(p + (p.x + p.y + p.z) * K1);\r\n    vec3 d0 = p - (i - (i.x + i.y + i.z) * K2);\r\n    vec3 e = step(vec3(0.0), d0 - d0.yzx);\r\n\tvec3 i1 = e * (1.0 - e.zxy);\r\n\tvec3 i2 = 1.0 - e.zxy * (1.0 - e);\r\n    vec3 d1 = d0 - (i1 - 1.0 * K2);\r\n    vec3 d2 = d0 - (i2 - 2.0 * K2);\r\n    vec3 d3 = d0 - (1.0 - 3.0 * K2);\r\n    vec4 h = max(0.6 - vec4(dot(d0, d0), dot(d1, d1), dot(d2, d2), dot(d3, d3)), 0.0);\r\n    vec4 n = h * h * h * h * vec4(dot(d0, hash33(i)), dot(d1, hash33(i + i1)), dot(d2, hash33(i + i2)), dot(d3, hash33(i + 1.0)));\r\n    return dot(vec4(31.316), n);\r\n}\r\n\r\nvec4 quat(in vec3 axis, in float angle){return vec4(axis*sin(.5*angle),cos(.5*angle));}\r\nvec3 qrotate(in vec4 q, in vec3 v){return v + 2.0*cross(q.xyz, cross(q.xyz,v) + q.w*v);}\r\nvec4 qmul(vec4 a, vec4 b){return vec4(cross(a.xyz,b.xyz) + a.xyz*b.w + b.xyz*a.w, a.w*b.w - dot(a.xyz,b.xyz));}\r\n\r\nvoid main(){\r\n    if(gl_VertexID >= uLastID){\r\n        uint seed = uint(gl_VertexID) ^ floatBitsToUint(uTime.z);\r\n        vLifetime.z = hash11(seed+=1U);\r\n#ifdef STATIC\r\n        vLifetime.x = uTime.x - mix(uLifespan.z, uLifespan.w, hash11(seed+=1U));\r\n        vLifetime.y = mix(uLifespan.x, uLifespan.y, hash11(seed+=1U));\r\n#else\r\n        vLifetime.x = mix(uLifespan.z, uLifespan.w, hash11(seed+=1U));\r\n        vLifetime.y = 1.0 / mix(uLifespan.x, uLifespan.y, hash11(seed+=1U));\r\n#endif\r\n#if defined(SPHERE)\r\n        float theta = TAU * hash11(seed+=1U);\r\n        float phi = acos(2. * hash11(seed+=1U) - 1.);\r\n        float radius = mix(uRadius.x, uRadius.y, hash11(seed+=1U));\r\n        vec3 normal = vec3(sin(phi) * cos(theta), sin(phi) * sin(theta), cos(phi));\r\n        vTransform.xyz = uOrigin + radius * normal;\r\n#elif defined(CIRCLE)\r\n        float theta = TAU * hash11(seed+=1U);\r\n        float radius = mix(uRadius.x, uRadius.y, hash11(seed+=1U));\r\n        vec3 normal = qrotate(uOrientation,vec3(cos(theta), 0, sin(theta)));\r\n        vTransform.xyz = uOrigin + radius * normal;\r\n#elif defined(BOX)\r\n        vTransform.xyz = uOrigin + uExtents * (vec3(hash11(seed+=1U), hash11(seed+=1U), hash11(seed+=1U))-.5);\r\n#else\r\n        vTransform.xyz = uOrigin;\r\n#endif\r\n#ifdef TRAIL\r\n        vTransform.w = mix(uLength.x, uLength.y, hash11(seed+=1U));\r\n#else\r\n        vTransform.w = mix(uRotation.x, uRotation.y, hash11(seed+=1U));\r\n#endif\r\n\r\n#if defined(TARGETED)\r\n        vec3 direction = normalize(vTransform.xyz - uTarget);\r\n        vVelocity.xyz = direction * mix(uForce.x, uForce.y, hash11(seed+=1U));\r\n#elif defined(RELATIVE)\r\n        vVelocity.xyz = normal;\r\n#endif\r\n        vAcceleration.xyz = uGravity;\r\n#ifdef ANGULAR\r\n        vVelocity.w = mix(uAngular.x,uAngular.y,hash11(seed+=1U));\r\n        vAcceleration.w = mix(uAngular.z,uAngular.w,hash11(seed+=1U));\r\n#else\r\n        vVelocity.w = 0.0;\r\n        vAcceleration.w = 0.0;\r\n#endif\r\n\r\n        vSize.x = mix(uSize.x, uSize.y, hash11(seed+=1U));\r\n        vSize.y = 0.0;\r\n#ifdef FRAMES\r\n        vSize.zw = vec2(floor(uFrame.y * uFrame.y *  hash11(seed+=1U)), uFrame.y);\r\n#else\r\n        vSize.zw = vec2(0,1);\r\n#endif\r\n    }else{\r\n#ifdef STATIC\r\n        vLifetime = aLifetime;\r\n        vTransform = aTransform;\r\n        vVelocity = aVelocity;\r\n        vAcceleration = aAcceleration;\r\n        vSize = aSize;\r\n#else\r\n        vLifetime = aLifetime + vec4(uTime.y,0,0,0);\r\n        float life = clamp(vLifetime.x * vLifetime.y, 0.0, 1.0);\r\n        float deltaTime = max(0.0,vLifetime.x) - max(0.0,aLifetime.x);\r\n\r\n#ifdef LUT\r\n        float f = hash11(floatBitsToUint(vLifetime.z));\r\n        vec4 s0 = lerpLUT(uAttributes, life, 0);\r\n        vec4 s1 = lerpLUT(uAttributes, life, 1);\r\n        float mSize = mix(s0.x, s0.y, f);\r\n        vec2 mVelocity = vec2(mix(s0.z,s0.w,f),mix(s1.x,s1.y,f));\r\n        float mRadial = mix(s1.z,s1.w,f);\r\n\t\tmVelocity = 1.0 / (1.0 + (1.0-mVelocity) * deltaTime * 60.);\r\n#else\r\n        const float mSize = 1.0;\r\n        const vec2 mVelocity = vec2(1.0);\r\n        const float mRadial = 1.0;\r\n#endif\r\n\r\n        vAcceleration = aAcceleration;\r\n        vVelocity = aVelocity + vAcceleration * deltaTime;\r\n#ifdef VECTOR_FIELD\r\n\t\tvec3 fieldPosition = aTransform.xyz*uFieldDomain.xyz + vec3(3972.8371)*vLifetime.z;\r\n\t\tvec3 fieldForce = vec3(\r\n\t\t\tsimplex3D(fieldPosition),\r\n\t\t\tsimplex3D(fieldPosition+vec3(189.234)),\r\n\t\t\tsimplex3D(fieldPosition+vec3(411.321))\r\n\t\t);\r\n\t\tvVelocity.xyz += fieldForce * deltaTime * uFieldStrength.x;\r\n#endif\r\n#ifdef RADIAL\r\n        vec3 radial = uTarget - aTransform.xyz;\r\n        vec3 attractor = mRadial * normalize(radial);\r\n        vVelocity.xyz += attractor;\r\n#endif\r\n        vVelocity *= mVelocity.xxxy;\r\n        vTransform = aTransform + deltaTime * vVelocity;\r\n        vSize = vec4(aSize.x, mSize * aSize.x, aSize.z, aSize.w);\r\n#ifdef FRAMES\r\n        vSize.z = mod(aSize.z + deltaTime * uFrame.x, vSize.w * vSize.w);\r\n#endif\r\n#endif\r\n    }\r\n}"},632:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n#define PI 3.141592653589793\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n#ifdef OMNILIGHT\r\nuniform LightUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uRadius;\r\n    float uIntensity;\r\n};\r\n#endif\r\n\r\nuniform sampler2D uAlbedoBuffer;\r\nuniform sampler2D uNormalBuffer;\r\nuniform sampler2D uPositionBuffer;\r\n\r\nlayout(location=0) out vec4 fragColor;\r\n\r\n//Normal Distribution Functions\r\nfloat ndfBlinnPhong(in float NdH, in float alpha){\r\n    float n = 2.0 / (alpha * alpha) - 2.0;\r\n    return pow(NdH, n) * (n + 2.0) / (2.0 * PI);\r\n}\r\nfloat ndfPhong(in vec3 L, in vec3 N, in vec3 V, in float alpha){\r\n    vec3 R = reflect(-L, N);\r\n    float VdR = max(0.0, dot(V, R));\r\n    float n = 2.0 / (alpha * alpha) - 2.0;\r\n    return pow(VdR, n) * (n + 2.0) / (2.0 * PI);\r\n}\r\nfloat ndfBeckmann(in float NdH, in float alpha){\r\n    float a2 = alpha*alpha;\r\n    float NdH2 = NdH*NdH;\r\n    return exp((NdH2 - 1.0) / (a2 * NdH2)) / (PI * a2 * NdH2 * NdH2);\r\n}\r\nfloat ndfGGX(in float NdH, in float alpha){\r\n    float a2 = alpha*alpha;\r\n    float denom = (NdH*NdH) * (a2 - 1.0) + 1.0;\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\n//Geometric Shadowing Functions\r\nfloat gsfImplicit(in float NdL, in float NdV){return NdL*NdV;}\r\nfloat gsfKalemen(in float NdV, in float NdL, in float alpha){\r\n    const float c = sqrt(2./PI);\r\n    float k = alpha * alpha * c;\r\n    float gH = NdV * k +(1.-k);\r\n\treturn gH * gH * NdL;\r\n}\r\nfloat gsfCookTorrence(in float NdL, in float NdV, in float VdH, in float NdH){\r\n    return min(1., min(2.*NdH*NdV / VdH, 2.*NdH*NdL / VdH));\r\n}\r\nfloat gsfWalter(in float NdL, in float NdV, in float alpha){\r\n    float a2 = alpha*alpha;\r\n    float L = (2.*NdL)/(NdL + sqrt(a2 + (1.-a2) * NdL*NdL));\r\n    float V = (2.*NdV)/(NdV + sqrt(a2 + (1.-a2) * NdV*NdV));\r\n    return L * V;\r\n}\r\nfloat gsfSchlick(in float NdL, in float NdV, in float alpha){\r\n#if defined(BECKMANN)\r\n    float a2 = alpha * alpha;\r\n    float k = a2 * 0.797884560802865;\r\n#elif defined(GGX)\r\n    float k = alpha * 0.5;\r\n#else\r\n    float k = alpha * alpha;\r\n#endif\r\n    float V = NdV / (NdV * (1.0 - k) + k);\r\n    float L = NdL / (NdL * (1.0 - k) + k);\r\n    return V * L;\r\n}\r\n\r\nvec3 fresnelSchlick(vec3 F0, float cosTheta){\r\n    return mix(F0, vec3(1.0), pow(1.0 - cosTheta, 5.0));\r\n}\r\nvec3 fresnelSchlick(vec3 F0, float cosTheta, float roughness){\r\n    return mix(F0, max(vec3(1.0-roughness), F0), pow(1.0 - cosTheta, 5.0));\r\n}\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec3 position = texelFetch(uPositionBuffer, fragCoord, 0).xyz;\r\n    vec4 normal = texelFetch(uNormalBuffer, fragCoord, 0);\r\n    vec4 albedo = texelFetch(uAlbedoBuffer, fragCoord, 0);\r\n    float emission = max(0.,2.*albedo.a-1.);\r\n    float roughness = clamp(2.*albedo.a,0.04,1.0);\r\n    float metalness = normal.a;\r\n\r\n#ifdef OMNILIGHT\r\n    vec3 lightPosition = vec3(uModelMatrix[3]);\r\n    float attenuation = smoothstep(-uRadius, 0.0, -length(lightPosition - position));\r\n    vec3 light = attenuation * uIntensity * uColor.rgb;\r\n    light = mix(light,vec3(0),emission);\r\n#endif\r\n\r\n    vec3 N = normalize(normal.xyz);\r\n    vec3 V = normalize(uEyePosition - position);\r\n    vec3 L = normalize(lightPosition - position);\r\n    vec3 H = normalize(L + V);\r\n\r\n    float NdL = max(0.001, dot(N, L));\r\n    float NdV = max(0.001, dot(N, V));\r\n    float NdH = max(0.001, dot(N, H));\r\n    float HdV = max(0.001, dot(H, V));\r\n\r\n    vec3 F0 = mix(vec3(0.04), albedo.rgb, metalness);\r\n    float alpha = roughness*roughness;\r\n\r\n#ifdef PHONG\r\n    vec3 F = fresnelSchlick(F0, NdV);\r\n#else\r\n    vec3 F = fresnelSchlick(F0, HdV);\r\n#endif\r\n#if defined(BLINN)\r\n    float D = ndfBlinnPhong(NdH, alpha);\r\n#elif defined(PHONG)\r\n    float D = ndfPhong(N, L, V, alpha);\r\n#elif defined(BECKMANN)\r\n    float D = ndfBeckmann(NdH, alpha);\r\n#elif defined(GGX)\r\n    float D = ndfGGX(NdH, alpha);\r\n#endif\r\n\r\n#if defined(SCHLICK)\r\n    float G = gsfSchlick(NdL, NdV, alpha);\r\n#elif defined(KALEMEN)\r\n    float G = gsfKalemen(NdV, NdL, alpha);\r\n#elif defined(WALTER)\r\n    float G = gsfWalter(NdL, NdV, alpha);\r\n#else\r\n    float G = gsfImplicit(NdL, NdV);\r\n#endif\r\n    vec3 specular = (F * D * G) / (4.0 * NdL * NdV);\r\n    vec3 diffuse = albedo.rgb * mix(vec3(1.0) - F, vec3(0.0), metalness);\r\n\r\n    fragColor = vec4(NdL*light*(diffuse+specular),0.);\r\n}"},5126:e=>{e.exports="vec4 quat(in vec3 axis, in float angle){return vec4(axis*sin(.5*angle),cos(.5*angle));}\r\nvec3 qrotate(in vec4 q, in vec3 v){return v + 2.0*cross(q.xyz, cross(q.xyz,v) + q.w*v);}\r\nvec4 qmul(vec4 a, vec4 b){return vec4(cross(a.xyz,b.xyz) + a.xyz*b.w + b.xyz*a.w, a.w*b.w - dot(a.xyz,b.xyz));}\r\nvec4 qrandom(float u1, float u2, float u3){\r\n    float is1 = sqrt(1.-u1); float s1 = sqrt(u1);\r\n    return vec4(is1 * sin(TAU * u2),\r\n        is1 * cos(TAU * u2),\r\n        s1 * sin(TAU * u3),\r\n        s1 * cos(TAU * u3));\r\n}"},9890:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nin vec3 vOrigin;\r\nin vec3 vRay;\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\nlayout(location=2) out vec4 fragPosition;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform float uLayer;\r\nuniform vec4 uFogColor;\r\nuniform vec3 uSkyColor;\r\n\r\nfloat hash31(vec3 uv){\r\n    uvec3 q = floatBitsToUint(uv);\r\n\tq *= uvec3(1597334673U, 3812015801U, 2798796415U);\r\n\tuint n = (q.x ^ q.y ^ q.z) * 1597334673U;\r\n\treturn float(n) * (1.0 / float(0xffffffffU));\r\n}\r\n\r\nfloat noise3D(in vec3 x){\r\n    vec3 i = floor(x);\r\n    vec3 f = fract(x);\r\n    f = f*f*(3.0-2.0*f);\r\n    return mix(mix(mix(hash31(i+vec3(0,0,0)), \r\n                    hash31(i+vec3(1,0,0)),f.x),\r\n            mix(hash31(i+vec3(0,1,0)), \r\n                    hash31(i+vec3(1,1,0)),f.x),f.y),\r\n            mix(mix(hash31(i+vec3(0,0,1)), \r\n                    hash31(i+vec3(1,0,1)),f.x),\r\n                mix(hash31(i+vec3(0,1,1)), \r\n                    hash31(i+vec3(1,1,1)),f.x),f.y),f.z);\r\n}\r\nfloat fbm(vec3 p, int octaves, float scale, float offset){\r\n    const mat3 m = mat3( 0.00,  0.80,  0.60,\r\n              -0.80,  0.36, -0.48,\r\n              -0.60, -0.48,  0.64 );\r\n    float f = 0.0, a = 0.5, s = 0.0;\r\n    for(int i = 0; i < octaves; ++i){\r\n        s += a;\r\n        f += a*abs(noise3D(p)*scale-offset);\r\n        p = m*p*2.02;\r\n        a *= 0.5;\r\n    }\r\n    return f/s;\r\n}\r\n\r\nvec3 sky(in vec3 ray){\r\n    const vec3 sun = normalize(vec3(0,1,0.5));\r\n\r\n    ray.y = max(ray.y, 0.);\r\n\r\n    vec3 color = vec3(0);\r\n    color += vec3(.4,.1,.3) * dot(ray,vec3(0,1,0));\r\n    \r\n    float f0 = fbm(ray * 10.0 + vec3(0,0,1)*uTime.x*0.1, 4,2.,1.);\r\n    float f1 = fbm(ray * 8.0 + f0, 2,1.,0.);\r\n    \r\n    color += vec3(1.0,0.8,0.8) * (f1 * f1 - 0.2 * f0) * ray.y;\r\n    color += vec3(1.4,1.2,1.0) * pow(max(0.,dot(ray, sun)),16.);\r\n    return color * color;\r\n}\r\n\r\nvoid main(){\r\n    vec3 position = vOrigin + vRay;\r\n    vec3 ray = normalize(vRay);\r\n    gl_FragDepth = gl_DepthRange.far;\r\n    fragPosition = vec4(position,uLayer);\r\n    fragNormal = vec4(-ray*0.0,0);\r\n\r\n    float rayDotUp = max(0.0,dot(vec3(0,1,0),ray));\r\n    vec3 color = mix(uFogColor.rgb, sky(ray), rayDotUp);\r\n    fragAlbedo = vec4(color,0.5);\r\n}"},4570:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec4 aLifetime;\r\nlayout(location=1) in vec4 aSize;\r\nlayout(location=2) in vec4 aTransform;\r\nlayout(location=3) in vec4 aVelocity;\r\nlayout(location=4) in vec4 aAcceleration;\r\n\r\nlayout(location=5) in vec3 aPosition;\r\nlayout(location=6) in vec2 aUV;\r\n\r\nout vec2 vUV;\r\nout vec2 vLife;\r\nout vec3 vPosition;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nvoid main(){\r\n    float time = uTime.x - aLifetime.x + aPosition.y * aTransform.w;\r\n    time = (time - aTransform.w) * (aLifetime.y + aTransform.w) / aLifetime.y;\r\n    time = clamp(time, 0.0, aLifetime.y);\r\n    vLife = vec2(time / aLifetime.y, aLifetime.z);\r\n\r\n    float size = mix(aSize.x, aSize.y, vLife.x);\r\n\r\n    vec3 position = aTransform.xyz + time * aVelocity.xyz + 0.5 * time * time * aAcceleration.xyz;\r\n    vec3 direction = normalize(aVelocity.xyz + time * aAcceleration.xyz);\r\n    vec3 front = -vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    position = position + size * cross(front, direction) * aPosition.x;\r\n\r\n    vUV = aUV;\r\n    vPosition = position;\r\n    gl_Position = uViewProjectionMatrix * vec4(position, 1.0);\r\n}"},4948:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\n\r\nvoid main(){\r\n    vec4 color = texture(uSampler, vUV);\r\n#ifdef BRIGHTNESS\r\n    float brightness = dot(color.rgb, vec3(0.2126, 0.7152, 0.0722));\r\n    color *= step(0.5, brightness);\r\n#endif\r\n#ifdef MASK\r\n    color *= color.a;\r\n#endif\r\n    fragColor = vec4(color.rgb,1);\r\n}"},2720:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec4 aLifetime;\r\nlayout(location=1) in vec4 aSize;\r\nlayout(location=2) in vec4 aTransform;\r\nlayout(location=3) in vec4 aVelocity;\r\nlayout(location=4) in vec4 aAcceleration;\r\n\r\nlayout(location=5) in vec3 aPosition;\r\nlayout(location=6) in vec2 aUV;\r\n\r\nout vec3 vPosition;\r\nout vec2 vLife;\r\nout vec2 vUV;\r\nout vec4 vUVClamp;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\n#ifdef LUT\r\nuniform sampler2D uAttributes;\r\nvec4 lerpLUT(sampler2D texture, float u, int v){\r\n    float width = float(textureSize(texture,0).x);\r\n    ivec2 uv = ivec2(u * width, v);\r\n    vec4 a = texelFetchOffset(texture,uv,0,ivec2(0,0));\r\n    vec4 b = texelFetchOffset(texture,uv,0,ivec2(1,0));\r\n    float f = fract(u * width);\r\n    return mix(a, b, f);\r\n}\r\n#endif\r\nuniform sampler2D uDisplacementMap;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(uint n){\r\n\tn = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float(n & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\nmat2 rotate(in float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\r\n\r\nvoid main(){\r\n    float time = max(0.,uTime.x - aLifetime.x);\r\n    float duration = aLifetime.w > 0. ? aLifetime.w : time+1.;\r\n    float seed = aLifetime.z + 0.1 * floor(time / duration);\r\n    time = min(mod(time, duration), aLifetime.y);\r\n    vLife = vec2(time / aLifetime.y, seed);\r\n\r\n    float size = mix(aSize.x, aSize.y, vLife.x);\r\n#ifdef LUT\r\n    float f = hash11(floatBitsToUint(seed));\r\n    vec4 s0 = lerpLUT(uAttributes, vLife.x, 0);\r\n    size *= mix(s0.x, s0.y, f);\r\n#endif\r\n    vec4 transform = aTransform + time * aVelocity + 0.5 * time * time * aAcceleration;\r\n#ifdef VECTOR_FIELD\r\n    transform.xyz += mix(s0.z,s0.w,f)*(-1.+2.*texture(uDisplacementMap, vec2(seed, vLife.x * 0.4)).rgb);\r\n#endif\r\n    vec3 position = vec3(rotate(transform.w) * aPosition.xy, aPosition.z);\r\n    \r\n#ifdef VIEWPLANE\r\n    vec3 forward = -vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n#else\r\n    vec3 forward = normalize(transform.xyz - uEyePosition);\r\n#endif\r\n\r\n#if defined(SPHERICAL)\r\n    vec3 right = vec3(uViewMatrix[0][0], uViewMatrix[1][0], uViewMatrix[2][0]);\r\n    vec3 up = vec3(uViewMatrix[0][1], uViewMatrix[1][1], uViewMatrix[2][1]);\r\n    position = size * (right * position.x + up * position.y);\r\n#elif defined(ALIGNED)\r\n    vec3 velocity = aVelocity.xyz + time * aAcceleration.xyz;\r\n\r\n    vec3 direction = -normalize(velocity);\r\n    vec3 up = cross(forward, direction);\r\n    vec3 right = cross(forward, up);\r\n    forward = cross(right, up);\r\n    mat3 matrix = mat3(right, up, forward);\r\n    position = size * matrix * position;\r\n#endif\r\n    vPosition = position + transform.xyz;\r\n\r\n    vUVClamp = vec4(0,0,1,1);\r\n    vUV = aUV;\r\n    gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\r\n}"},3932:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec3 vPosition;\r\nin vec3 vNormal;\r\nin vec4 vColor;\r\nin float vMaterial;\r\nout vec4 fragColor;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nuniform sampler2D uDiffuseMap;\r\nuniform sampler2D uGradientMap;\r\nuniform sampler2D uDisplacementMap;\r\n\r\nuniform EffectUniforms {\r\n    uniform vec4 uUVTransform;\r\n    uniform vec3 uColorAdjustment;\r\n#ifdef VERTICAL_MASK\r\n    uniform vec4 uVerticalMask;\r\n#endif\r\n#ifdef HORIZONTAL_MASK\r\n    uniform vec4 uHorizontalMask;\r\n#endif\r\n#ifdef FRESNEL\r\n    uniform vec2 uFresnelMask;\r\n#endif\r\n#ifdef PANNING\r\n    uniform vec2 uUVPanning;\r\n#endif\r\n#ifdef GREYSCALE\r\n    uniform vec4 uUV2Transform;\r\n#ifdef PANNING\r\n    uniform vec2 uUV2Panning;\r\n#endif\r\n#endif\r\n#ifdef DISPLACEMENT\r\n    uniform vec4 uUV3Transform;\r\n    uniform vec2 uUV3Panning;\r\n    uniform float uDisplacementAmount;\r\n#endif\r\n#ifdef DISSOLVE\r\n    uniform vec4 uDissolveColor;\r\n    uniform vec3 uDissolveThreshold;\r\n#endif\r\n};\r\n\r\n#define TAU 6.283185307179586\r\nfloat linearizeDepth(){\r\n    float z_ndc = gl_FragCoord.z * 2.0 - 1.0;\r\n    //float linearDepth = (2.0 * near * far) / (far + near - z_ndc * (far - near));\r\n    float linearDepth = uProjectionMatrix[2][3] / (uProjectionMatrix[2][2] + z_ndc);\r\n    return linearDepth;\r\n}\r\nfloat projectDepth(in float z){\r\n    float z_ndc = uProjectionMatrix[2][3] / z - uProjectionMatrix[2][2];\r\n    return .5+.5*z_ndc;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n#ifdef HALF\r\n    uv.y = abs(uv.y*2.-1.);\r\n#endif\r\n#ifdef POLAR\r\n    uv=uv*2.-1.;uv=vec2(atan(uv.y,uv.x)/TAU+.5,length(uv));\r\n#endif\r\n    vec2 uv0 = uUVTransform.xy + uv * uUVTransform.zw;\r\n#ifdef PANNING\r\n    uv0 += uTime.x * uUVPanning.xy;\r\n#endif\r\n\r\n#ifdef DISPLACEMENT\r\n    vec2 uv3 = uUV3Transform.xy + uv * uUV3Transform.zw;\r\n    uv3 += uTime.x * uUV3Panning.xy;\r\n    vec2 displacement = uDisplacementAmount*(texture(uDisplacementMap, uv3).xy*2.-1.);\r\n    uv0 += displacement;\r\n#endif\r\n\r\n#ifdef GREYSCALE\r\n    float grey = texture(uDiffuseMap, uv0).r;\r\n    grey = pow(clamp(mix(1.-grey,grey,uColorAdjustment.y),0.,1.), uColorAdjustment.x)+uColorAdjustment.z;\r\n\r\n    vec2 uv2 = uUV2Transform.xy + uv * uUV2Transform.zw;\r\n#ifdef PANNING\r\n    uv2 += uTime.x * uUV2Panning.xy;\r\n#endif\r\n    float grey2 = texture(uDiffuseMap, uv2).g;\r\n    grey2 = pow(clamp(mix(1.-grey2,grey2,uColorAdjustment.y),0.,1.), uColorAdjustment.x)+uColorAdjustment.z;\r\n    grey *= 2.0 * grey2;\r\n\r\n    vec4 color = vec4(min(1.,grey));\r\n#else\r\n    vec4 color = texture(uDiffuseMap, uv0);\r\n#endif\r\n\r\n#ifdef DISSOLVE\r\n    color += max(0.,-uDissolveThreshold.x);\r\n#endif\r\n\r\n#ifdef VERTICAL_MASK\r\n    color *= smoothstep(uVerticalMask.x,uVerticalMask.y,uv.y);\r\n    color *= smoothstep(uVerticalMask.w,uVerticalMask.z,uv.y);\r\n#endif\r\n#ifdef HORIZONTAL_MASK\r\n    color *= smoothstep(uHorizontalMask.x,uHorizontalMask.y,uv.x);\r\n    color *= smoothstep(uHorizontalMask.w,uHorizontalMask.z,uv.x);\r\n#endif\r\n\r\n#ifdef FRESNEL\r\n    vec3 position = vPosition;\r\n    vec3 normal = normalize(vNormal);\r\n    vec3 view = normalize(uEyePosition - position);\r\n    float NdV = abs(dot(normal, view));\r\n    color *= smoothstep(uFresnelMask.x,uFresnelMask.y,NdV);\r\n#endif\r\n\r\n    float value = color.a;\r\n#ifdef GRADIENT\r\n#ifdef DISSOLVE\r\n    color = texture(uGradientMap, vec2(1.-value,vColor.a));\r\n#else\r\n    color = texture(uGradientMap, vec2(1.-value,uv.y));\r\n#endif\r\n#endif\r\n\r\n#ifdef DISSOLVE\r\n    float cutoff = uDissolveThreshold.x + 1. - vColor.a;\r\n    color = mix(color, uDissolveColor, smoothstep(-uDissolveThreshold.z,0.,cutoff-value));\r\n    color.rgb *= vColor.rgb;\r\n    color *= smoothstep(0.,uDissolveThreshold.y,value-cutoff);\r\n#else\r\n    color *= vColor;\r\n#endif\r\n    fragColor = color;\r\n\r\n#ifdef DEPTH_OFFSET\r\n    gl_FragDepth = projectDepth(linearizeDepth() - DEPTH_OFFSET);\r\n#endif\r\n}"},4265:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec4 vColor;\r\nin vec4 vMaterial;\r\n\r\nlayout(location=0) out vec4 fragColor;\r\nlayout(location=1) out vec4 fragNormal;\r\n\r\nuniform sampler2D uSampler;\r\nuniform vec2 uScreenSize;\r\nuniform float uScale;\r\n\r\nvec3 calculateNormal(in float height){\r\n    float dhdx = dFdx(height) * uScreenSize.x;\r\n    float dhdy = dFdy(height) * uScreenSize.y;\r\n    vec3 normal = normalize(vec3(-dhdx, -dhdy, 1));\r\n    return 0.5+0.5*normal;\r\n}\r\n\r\nvoid main(){\r\n    fragColor = texture(uSampler, vUV);\r\n\r\n    float height = fragColor.b;\r\n    fragNormal = vec4(calculateNormal(height / uScale), height);\r\n}"},9627:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nin vec3 vPosition;\r\nin vec4 vColor;\r\nin vec3 vNormal;\r\nin float vMaterial;\r\nout vec4 fragColor;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform vec4 uUVTransform;\r\nuniform sampler2D uSampler;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash13(in vec3 src) {\r\n    const uint M = 0x5bd1e995u;\r\n    uint h = 1190494759u;\r\n    uvec3 v = floatBitsToUint(src);\r\n    v *= M; v ^= v>>24u; v *= M;\r\n    h *= M; h ^= v.x; h *= M; h ^= v.y; h *= M; h ^= v.z;\r\n    h ^= h>>13u; h *= M; h ^= h>>15u;\r\n    return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\r\n}\r\nfloat noise3D(in vec3 x){\r\n    vec3 i = floor(x);\r\n    vec3 f = fract(x);\r\n    f = f*f*(3.0-2.0*f);\r\n    return mix(mix(mix( hash13(i+vec3(0,0,0)), \r\n                        hash13(i+vec3(1,0,0)),f.x),\r\n                   mix( hash13(i+vec3(0,1,0)), \r\n                        hash13(i+vec3(1,1,0)),f.x),f.y),\r\n               mix(mix( hash13(i+vec3(0,0,1)), \r\n                        hash13(i+vec3(1,0,1)),f.x),\r\n                   mix( hash13(i+vec3(0,1,1)), \r\n                        hash13(i+vec3(1,1,1)),f.x),f.y),f.z);\r\n}\r\nfloat noise3D(in vec3 uv, in vec3 period){\r\n    vec3 i0 = floor(mod(uv, period));\r\n    vec3 i1 = floor(mod(uv+vec3(1), period));\r\n    vec3 f = fract(uv); f = f*f*(3.0-2.0*f);\r\n    return mix(mix(mix( hash13(vec3(i0.x,i0.y,i0.z)), \r\n                        hash13(vec3(i1.x,i0.y,i0.z)),f.x),\r\n                   mix( hash13(vec3(i0.x,i1.y,i0.z)), \r\n                        hash13(vec3(i1.x,i1.y,i0.z)),f.x),f.y),\r\n               mix(mix( hash13(vec3(i0.x,i0.y,i1.z)), \r\n                        hash13(vec3(i1.x,i0.y,i1.z)),f.x),\r\n                   mix( hash13(vec3(i0.x,i1.y,i1.z)), \r\n                        hash13(vec3(i1.x,i1.y,i1.z)),f.x),f.y),f.z);\r\n}\r\nfloat fbm(in vec3 uv, in int octaves){\r\n    float total = 0.0, amplitude = 1.0;\r\n    const mat2 r = mat2(1.6, 1.2, -1.2, 1.6);\r\n    for(int i = 0; i < octaves; i++){\r\n        total += .5*amplitude*noise3D(uv);\r\n        uv.xy = r * uv.xy + 100.0;\r\n        amplitude *= 0.5;\r\n    }\r\n    return total;\r\n}\r\nfloat fbm(in vec3 uv, in int octaves, in vec3 period){\r\n    float total = 0.0, amplitude = 1.0;\r\n    for(int i = 0; i < octaves; i++){\r\n        total += .5*amplitude*noise3D(uv, period);\r\n        uv = 2.0 * uv + 100.0;\r\n        period *= 2.0;\r\n        amplitude *= 0.5;\r\n    }\r\n    return total;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = 2.*vUV-1.;\r\n    float time = 4.0*uTime.x;\r\n#ifndef RADIAL\r\n    uv = uv.yx;\r\n    float fade = smoothstep(1.0, 0.8, abs(uv.x));\r\n    float f0 = 1.-2.*fbm(vec3(uUVTransform.xy * uv + vec2(time,0), -.5*time), 4);\r\n    f0 *= 1.-2.*noise3D(vec3(uUVTransform.xy * uv,f0)*vec3(2,0.25,3)+vec3(time,0,time));\r\n    float d0 = abs(uv.y+0.5*f0);\r\n#else\r\n    float fade = 1.0;\r\n    uv = vec2(atan(uv.y,uv.x)/TAU+.5, length(uv));\r\n    float f0 = 1.-2.*fbm(vec3(uUVTransform.xy * uv.xy + vec2(0,-time),-.5*time), 4, vec3(uUVTransform.xy,10));\r\n    float d0 = abs(uv.y+0.5*f0)-0.5*smoothstep(0.1,.0,uv.y);\r\n#endif\r\n\r\n    vec4 color = texture(uSampler, vec2(smoothstep(-0.25,1.0,d0), 0.0));\r\n    fragColor = vColor * color * fade;\r\n}"},2792:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nin vec3 vPosition;\r\nin mat4 vInvModel;\r\nin vec4 vUV;\r\nin vec4 vColor;\r\nin float vThreshold;\r\n\r\nuniform float uLayer;\r\nuniform float uDissolveEdge;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform sampler2D uDiffuseMap;\r\nuniform sampler2D uNormalMap;\r\nuniform sampler2D uPositionBuffer;\r\n\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\n\r\nfloat hash21(in vec2 src) {\r\n    const uint M = 0x5bd1e995u;\r\n    uint h = 1190494759u;\r\n    uvec2 v = floatBitsToUint(src);    \r\n    v *= M; v ^= v>>24u; v *= M;\r\n    h *= M; h ^= v.x; h *= M; h ^= v.y;\r\n    h ^= h>>13u; h *= M; h ^= h>>15u;\r\n    return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\r\n}\r\n\r\nfloat sdfBox(in vec2 p, in vec2 size){\r\n    vec2 d = abs(p)-size;\r\n    return length(max(d,0.0)) + min(max(d.x,d.y),0.0);\r\n}\r\n\r\nfloat glow(in float distance){return pow(max(0.,0.02/abs(distance)-0.1),0.8);}\r\n\r\n#define TAU 6.283185307179586\r\nvec4 calcColor(in vec2 uv){\r\n#ifdef POLAR\r\n    uv = uv*2.-1.;\r\n    uv = vec2(.5+atan(uv.y,uv.x)/TAU,length(uv));\r\n    uv = vec2(uv.x + 0.06*uTime.x, uv.y);\r\n#endif\r\n    vec2 uv0 = uv*2.-1.;\r\n    vec2 uv1 = vec2(round(uv0.x*4.)/4.,0);\r\n    vec2 uv2 = round(uv0*8.)/8.;\r\n#ifdef POLAR\r\n    float t0 = smoothstep(1.0+uDissolveEdge, 1.0, abs(uv0.y-vThreshold));\r\n    float t1 = smoothstep(1.0+uDissolveEdge, 1.0, abs(uv0.y-vThreshold));\r\n    float t2 = smoothstep(1.0+uDissolveEdge, 1.0, abs(uv0.y-vThreshold));\r\n#else\r\n    float t0 = smoothstep(1.0+uDissolveEdge, 1.0, abs(abs(uv0.x)*2.-1.-vThreshold));\r\n    float t1 = smoothstep(1.0+uDissolveEdge, 1.0, abs(abs(uv1.x)*2.-1.-vThreshold));\r\n    float t2 = smoothstep(1.0+uDissolveEdge, 1.0, abs(abs(uv2.x)*2.-1.-vThreshold));\r\n#endif\r\n\r\n    uv0.y -= 0.4*(1.0-t2)*(1.-2.*hash21(round(uv0 * 8.0)));\r\n\r\n    float d0 = sdfBox(uv1-uv0, vec2(0.3/4.,0.4)*t1);\r\n    float d1 = abs(uv0.y)-0.6;\r\n    float d2 = sdfBox(uv1-uv0, vec2(0.1/4.,0.2) * t1);\r\n\r\n    vec4 color = vec4(0);\r\n    color.rgb += vec3(0.4,0.1,0.16) * t0 * glow(d0);\r\n    color.rgb += vec3(0.4,0.1,0.16) * t0 * glow(d1);\r\n    color.rgb += vec3(0.4,0.1,0.16) * t0 * glow(d2);\r\n    color.a = smoothstep(0.0,1.0,color.r);\r\n    color.rgb = mix(color.rgb,color.gbr*2.,1.-t0);\r\n#ifndef POLAR\r\n    color *= smoothstep(1.,1.-0.25,abs(uv0.x));\r\n#endif\r\n    return min(color,vec4(1));\r\n}\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec3 viewRay = vPosition.xyz - uEyePosition;\r\n    vec4 worldPosition = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    if(worldPosition.a > uLayer) discard;\r\n    vec4 objectPosition = vInvModel * vec4(worldPosition.xyz, 1.0);\r\n    if(0.5 < abs(objectPosition.x) || 0.5 < abs(objectPosition.y) || 0.5 < abs(objectPosition.z)) discard;\r\n    vec2 uv = mix(vUV.xy, vUV.zw, objectPosition.xz + 0.5);\r\n\r\n    vec4 color = vColor * calcColor(uv);\r\n    fragAlbedo = color;\r\n    fragNormal = vec4(0,0,0,smoothstep(0.75,1.0,color.a));\r\n}"},7330:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define RESOLUTION 1.0\r\n#define TAU 6.283185307179586\r\n#define PI 3.141592653589793\r\n\r\nuvec2 wrap2(in vec2 v, float period){return uvec2(v-period*floor(v/period));}\r\nuvec3 wrap2(in vec3 v, float period){return uvec3(v-period*floor(v/period));}\r\nuint hash(uint x){\r\n    x = (x^(x>>16))*0x7feb352dU;\r\n    x = (x^(x>>15))*0x846ca68bU;\r\n    return (x^(x>>16));\r\n}\r\nvec2 hash22(uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n    n = hash(n);\r\n    return vec2(n*uvec2(0x1U,0x3fffU))*(1.0/float(0xffffffffU));\r\n}\r\nfloat hash21(uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n    n = hash(n);\r\n    return float(n)*(1.0/float(0xffffffffU));\r\n}\r\nfloat hash31(uvec3 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U^v.z*3299493293U;\r\n    n = hash(n);\r\n    return float(n)*(1.0/float(0xffffffffU));\r\n}\r\n\r\nvec3 voronoi3(in vec2 uv, in float period, out vec4 center){\r\n    vec2 n = floor(uv);\r\n    vec2 f = fract(uv);\r\n    vec4 mc = vec4(0.0);\r\n    vec3 md = vec3(8.0);\r\n\r\n    for(int j=-1;j<=1;j++)\r\n    for(int i=-1;i<=1;i++){\r\n        vec2 g = vec2(i, j);\r\n        vec2 r = g - f + hash22(wrap2(n + g, period)) * 0.8;\r\n        float d = abs(r.x)+abs(r.y);\r\n        if(d < md.x){\r\n            md.z = md.y;\r\n            md.y = md.x;\r\n            md.x = d;\r\n            mc.zw = mc.xy;\r\n            mc.xy = n + g;\r\n        }else if(d < md.y){\r\n            md.z = md.y;\r\n            md.y = d;\r\n            mc.zw = n + g;\r\n        }else if(d < md.z){\r\n            md.z = d;\r\n        }\r\n    }\r\n    center = mc;\r\n    return md;\r\n}\r\n\r\nfloat cubicPulse(float c, float w, float x){\r\n    x = abs(x-c)/w;return step(x,1.0)*(1.0-x*x*(3.0-2.0*x));\r\n}\r\n\r\nuniform vec2 uScreenSize;\r\nuniform float uTime;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV * RESOLUTION;\r\n    float t = .5+.5*cos(TAU * (uv.x - uTime));\r\n    uv = vec2(uv.x+uv.y,uv.x-uv.y);\r\n    float width = 0.6, scale = 8.0;\r\n\r\n    vec4 cellCenters;\r\n    vec3 vr = voronoi3(uv * scale, scale * RESOLUTION, cellCenters);\r\n    float d = max(width + vr.y - vr.z, vr.y - vr.x);\r\n    \r\n    float h0 = hash21(wrap2(cellCenters.xy, scale * RESOLUTION));\r\n    float h1 = hash21(wrap2(cellCenters.zw, scale * RESOLUTION));\r\n    \r\n\tfloat wire = cubicPulse(width, 0.06, d);\r\n    wire += step(0.0, h0 - h1) * cubicPulse(width-0.1, 0.06, d);\r\n    wire += step(0.5, h0 - h1) * cubicPulse(width-0.2, 0.06, d);\r\n    \r\n    vec3 color = vec3(0.12,0.28,0.36) +\r\n    wire * vec3(0.1,0.5,0.4) +\r\n    vr.x * vec3(0,0.42,0.38) +\r\n    t*(h0*h1) * vec3(0.0,0.4,0.3) +\r\n    t*t*(wire+0.2*vr.y*vr.z+0.4*vr.x) * vec3(0.5,0.6,0.5);\r\n\r\n    fragColor = vec4(color,.5+.5*color.b);\r\n}"},2888:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nin vec3 vPosition;\r\nin mat4 vInvModel;\r\nin vec4 vUV;\r\nin vec4 vColor;\r\nin float vThreshold;\r\n\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nuniform float uLayer;\r\nuniform sampler2D uDiffuseMap;\r\nuniform sampler2D uNormalMap;\r\nuniform sampler2D uPositionBuffer;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash31(vec3 uv){\r\n    uvec3 q = floatBitsToUint(uv);\r\n\tq *= uvec3(1597334673U, 3812015801U, 2798796415U);\r\n\tuint n = (q.x ^ q.y ^ q.z) * 1597334673U;\r\n\treturn float(n) * (1.0 / float(0xffffffffU));\r\n}\r\nfloat noise3D(in vec3 x){\r\n    vec3 i = floor(x);\r\n    vec3 f = fract(x);\r\n    f = f*f*(3.0-2.0*f);\r\n    return mix(mix(mix(hash31(i+vec3(0,0,0)), \r\n                    hash31(i+vec3(1,0,0)),f.x),\r\n            mix(hash31(i+vec3(0,1,0)), \r\n                    hash31(i+vec3(1,1,0)),f.x),f.y),\r\n            mix(mix(hash31(i+vec3(0,0,1)), \r\n                    hash31(i+vec3(1,0,1)),f.x),\r\n                mix(hash31(i+vec3(0,1,1)), \r\n                    hash31(i+vec3(1,1,1)),f.x),f.y),f.z);\r\n}\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec3 viewRay = vPosition.xyz - uEyePosition;\r\n    vec4 worldPosition = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    if(worldPosition.a > uLayer) discard;\r\n    vec4 objectPosition = vInvModel * vec4(worldPosition.xyz, 1.0);\r\n    if(0.5 < abs(objectPosition.x) || 0.5 < abs(objectPosition.y) || 0.5 < abs(objectPosition.z)) discard;\r\n    vec2 uv = mix(vUV.xy, vUV.zw, objectPosition.xz + 0.5);\r\n    ///vec4 color = vColor * texture(uDiffuseMap, uv);\r\n\r\n    float f0 = noise3D(worldPosition.xyz-uTime.x*vec3(0,2,0));\r\n    float f1 = noise3D(worldPosition.xyz * 1.6 + (f0*2.-1.) - uTime.x*vec3(0,1,0));\r\n\r\n    vec4 color = vec4(0.1,0,0.1,0.8);\r\n    color += vec4(0.4,0.8,0.6,0.8) * smoothstep(0.0,1.0,f0);\r\n    color += vec4(0.5,1.0,1.0,1.0) * smoothstep(0.5,1.0,f1);\r\n    color *= smoothstep(0.5,0.2,length(objectPosition.xyz));\r\n    color.rgb = mix(color.grb, color.rgb, vColor.r);\r\n    color *= vColor.a;\r\n\r\n\r\n#ifdef ALPHA_CUTOFF\r\n    if(color.a < ALPHA_CUTOFF) discard;\r\n#endif\r\n    fragAlbedo = color;\r\n    fragNormal = vec4(0,0,0, smoothstep(0.5,1.0,color.a));\r\n}"},7457:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash13(in vec3 src) {\r\n    const uint M = 0x5bd1e995u;\r\n    uint h = 1190494759u;\r\n    uvec3 v = floatBitsToUint(src);\r\n    v *= M; v ^= v>>24u; v *= M;\r\n    h *= M; h ^= v.x; h *= M; h ^= v.y; h *= M; h ^= v.z;\r\n    h ^= h>>13u; h *= M; h ^= h>>15u;\r\n    return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\r\n}\r\nfloat noise3D(in vec3 uv, in vec3 period){\r\n    vec3 i0 = floor(mod(uv, period));\r\n    vec3 i1 = floor(mod(uv+vec3(1), period));\r\n    vec3 f = fract(uv); f = f*f*(3.0-2.0*f);\r\n    return mix(mix(mix( hash13(vec3(i0.x,i0.y,i0.z)), \r\n                        hash13(vec3(i1.x,i0.y,i0.z)),f.x),\r\n                   mix( hash13(vec3(i0.x,i1.y,i0.z)), \r\n                        hash13(vec3(i1.x,i1.y,i0.z)),f.x),f.y),\r\n               mix(mix( hash13(vec3(i0.x,i0.y,i1.z)), \r\n                        hash13(vec3(i1.x,i0.y,i1.z)),f.x),\r\n                   mix( hash13(vec3(i0.x,i1.y,i1.z)), \r\n                        hash13(vec3(i1.x,i1.y,i1.z)),f.x),f.y),f.z);\r\n}\r\nfloat fbm(in vec3 uv, in int octaves, in vec3 period){\r\n    float total = 0.0, amplitude = 1.0;\r\n    for(int i = 0; i < octaves; i++){\r\n        total += .5*amplitude*noise3D(uv, period);\r\n        uv = uv*2.0 + 100.0 + uv.x;\r\n        period *= 2.0;\r\n        amplitude *= 0.5;\r\n    }\r\n    return total;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n    vec3 scale = vec3(16.0, 4.0, 36.0);\r\n    float f2 = fbm(uv.xyx*scale, 6, scale);\r\n    scale = vec3(12.0, 8.0, 24.0);\r\n    float f1 = fbm(uv.xyx*scale, 7, scale);\r\n\r\n    float f0 = smoothstep(0.0,0.9,uv.y)*smoothstep(1.0,0.9,uv.y);\r\n\r\n\tfragColor = vec4(f1,f2,f0,f2);\r\n}"},8063:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform vec2 uScreenSize;\r\n\r\n#define TAU 6.283185307179586\r\n#define RESOLUTION 1.0\r\n#define MAP_SCALE 10.0\r\n\r\nvec2 hash22(ivec2 iv, float period){\r\n    vec2 p = mod(vec2(iv), period * RESOLUTION);\r\n    return fract(vec2(2097152, 262144)*sin(dot(p, vec2(113, 1))))*2.-1.;\r\n}\r\nmat2 rotate(in float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\r\nfloat gradN2D(in vec2 value, float period){ \r\n    const ivec2 ie = ivec2(0, 1);\r\n    const vec2 fe = vec2(0, 1);\r\n    ivec2 p = ivec2(floor(value));\r\n    vec2 f = fract(value);\r\n    vec2 w = f*f*(3. - 2.*f); \r\n    float c = mix(mix(dot(hash22(p + ie.xx,period), f - fe.xx), dot(hash22(p + ie.yx,period), f - fe.yx), w.x),\r\n                  mix(dot(hash22(p + ie.xy,period), f - fe.xy), dot(hash22(p + ie.yy,period), f - fe.yy), w.x), w.y);\r\n    return c*.5 + .5;\r\n}\r\nfloat stripes(float x, float offset){\r\n    x = 2.*abs(fract(x/6.283185307179586+offset-.25)-.5);\r\n    float x2 = clamp(x*x*(2.*x-1.),0.,1.);\r\n    return mix(smoothstep(0.,1.,x),x2,0.15);\r\n}\r\nfloat sandLayer(vec2 p, float lines){\r\n    vec2 q = rotate(atan(1.0/lines,1.0))*p;\r\n    q.y += (gradN2D(p*18.,18.0) - .5)*.05;\r\n    float grad1 = stripes(q.y*lines*TAU, 0.);\r\n   \r\n    q = rotate(-atan(1.0/lines,1.0))*p;\r\n    q.y += (gradN2D(p*12.,12.0) - .5)*.05;\r\n    float grad2 = stripes(q.y*lines*TAU, .5);\r\n      \r\n    q = vec2(p.x+p.y,-p.x+p.y);\r\n    \r\n    float a2 = dot(sin(q*2.*TAU - cos(q.yx*2.*TAU)), vec2(.25)) + .5;\r\n    float a1 = 1. - a2;\r\n    \r\n    float c = 1. - (1. - grad1*a1)*(1. - grad2*a2);\r\n    return c;\r\n}\r\n\r\nvec3 calculateNormal(in float height){\r\n    float dhdx = dFdx(height) * uScreenSize.x;\r\n    float dhdy = dFdy(height) * uScreenSize.y;\r\n    vec3 normal = normalize(vec3(-dhdx, -dhdy, 1));\r\n    return 0.5+0.5*normal;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV * RESOLUTION;\r\n    float layer0 = sandLayer(uv, 10.);\r\n    float layer1 = sandLayer(uv + gradN2D(uv*7.,7.)*.2, 7.);\r\n    float height = mix(layer0, layer1, smoothstep(.1,.9, gradN2D(uv*2.0+128.0,2.0)));\r\n\r\n    float fbm0 = gradN2D(uv.yx*16.,16.)*.5+gradN2D(uv.yx*32.,32.)*.3+gradN2D(uv.yx*64.,64.)*.2;\r\n    height += 0.1*(fbm0*2.-1.);\r\n    height *= 0.16;\r\n\r\n    fragColor = vec4(calculateNormal(height / MAP_SCALE), height);\r\n}"},9237:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nin vec2 vUV;\r\nin vec4 vUVClamp;\r\nin vec2 vLife;\r\nin vec3 vPosition;\r\n\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\nuniform sampler2D uGradient;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\n\r\nvoid main(void){\r\n    vec2 uv = vUV.yx;\r\n    float time = -uTime.x * 1.6 + 1891.87 * vLife.y;\r\n    uv.x = mix(.5+2.0*(uv.x-.5), uv.x, smoothstep(0.0,0.5,uv.y));\r\n    float n0 = texture(uSampler, 0.2*(uv+0.7*vLife.y) + vec2(0,0.05*time)).r;\r\n    float n1 = texture(uSampler, 0.5*(uv+0.9*vLife.y) + vec2(0,0.2*time + 0.2*n0)).r;\r\n    float n2 = texture(uSampler, 1.0*(uv+0.5*vLife.y)*mix(0.8,1.0,n1) + vec2(0,0.5*time - 0.4*n0)).r;\r\n    \r\n    uv=vUV*2.-1.;\r\n    float fade = pow(4.*vLife.x*(1.-vLife.x)-1.,2.);\r\n    float n = pow(max(0.,length(uv) + n2 + fade),4.0);\r\n    n = max(0.,smoothstep(0.6,0.0,n)-n);\r\n    vec4 color = vec4(1.5*n,1.5*n*n,n*n*n,0.2*n).brga;\r\n\r\n    fragColor = color;\r\n}"},4267:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nin vec3 vPosition;\r\n#ifdef INSTANCED\r\nin mat4 vModel;\r\nin vec4 vUV;\r\nin vec4 vColor;\r\nin float vThreshold;\r\n#else\r\n#endif\r\n\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\n\r\nuniform sampler2D uPositionBuffer;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform float uGridSize;\r\n\r\n#define TAU 6.283185307179586\r\nfloat grid(in vec2 uv, in float tiles, in float width){\r\n    uv = cos(TAU*(uv*tiles));\r\n    return smoothstep(1.0-width,1.0,max(uv.x,uv.y));\r\n}\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    if(position.a > 1.0) discard;\r\n    vec3 center = vec3(vModel[3]);\r\n    vec2 uv = (position.xz - center.xz) * uGridSize;\r\n\r\n    float fade = max(abs(uv.x), abs(uv.y));\r\n    float grid1 = max(0.0,cos(TAU * (fade - 0.4 * uTime.x)));\r\n    float grid0 = grid(position.xz,0.5,mix(0.01,0.1,grid1)) * smoothstep(1.0,0.8,fade);\r\n    vec3 color = mix(vec3(0.6,0.9,0.8),vec3(0.8,1.0,1.0), grid1);\r\n\r\n    fragAlbedo = vec4(color,grid0);\r\n    fragNormal = vec4(0);\r\n}"},1857:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\n\r\nuvec2 wrap2(in vec2 v, in vec2 period){return uvec2(v-period*floor(v/period));}\r\nfloat hash21(in uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n\tn = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\nfloat noise2D(in vec2 p, in vec2 period){\r\n    const vec2 e = vec2(0,1);\r\n    vec2 f = fract(p);\r\n    p = floor(p);\r\n    f = f*f*(3.0-2.0*f);\r\n    return mix(mix(hash21(wrap2(p+e.xx, period)),\r\n\t\t\t\t    hash21(wrap2(p+e.yx, period)), f.x),\r\n\t\t\t\tmix(hash21(wrap2(p+e.xy, period)),\r\n\t\t\t\t\thash21(wrap2(p+e.yy, period)), f.x), f.y);\r\n}\r\nfloat hatch(in vec2 uv, in float period, in int strength){\r\n    float rz=1.,st=float(strength)*0.1;\r\n    const vec2 s = vec2(1,20);\r\n    for(int i=0;i<=strength;i++){\r\n        uv.x += uv.y;\r\n        float g = noise2D(s*uv,s*period);\r\n        g = smoothstep(0.5,1.0,g);\r\n        rz = rz+g; //min(1.-g,rz);\r\n        uv.xy = uv.yx;\r\n        uv += 128.767;\r\n    }\r\n    return rz;\r\n}\r\n\r\nuniform vec3 uColor;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV.yx;\r\n\r\n    float scale = 4.0;\r\n    float h = hatch(uv*scale,scale,3);\r\n    vec3 color = vec3(0.6,0.62,0.66);\r\n    color += vec3(0.16,0.18,0.20) * smoothstep(0.0,3.0,h);\r\n    color += vec3(0.1) * smoothstep(1.0,3.0,h);\r\n    color += vec3(0.2) * smoothstep(2.0,3.0,h);\r\n    \r\n    color += 0.1*(cos(2.0*TAU*uv.y));\r\n    color *= uColor;\r\n    \t\r\n    float roughness = mix(0.2,0.8,color.b);\r\n\tfragColor = vec4(color,.5*roughness);\r\n}"},2811:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(in float u){\r\n    uint n = floatBitsToUint(u);\r\n    n = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & 0x7fffffffU)/float(0x7fffffff);\r\n}\r\nfloat noise11(in float u, in float period, float seed){\r\n    u *= period;\r\n    vec2 i = mod(floor(u) + vec2(0,1),vec2(period))+seed;\r\n    float f = fract(u); f = f*f*(3.0-2.0*f);\r\n    return mix(hash11(i.x),hash11(i.y),f);\r\n}\r\nfloat lightning(in vec2 uv, in float width, in float seed){\r\n    float b = \r\n    (noise11(uv.x, 4.0, seed)-.5)*0.25+\r\n    (noise11(uv.x, 8.0, seed)-.5)*0.1+\r\n    (noise11(uv.x, 24.0, seed)-.5)*0.05;\r\n    \r\n    width *= smoothstep(0.5, 0.4, abs(uv.x));\r\n\r\n    float l = .000025+(uv.x+.5)*.00001;\r\n    float m = .0005/smoothstep(0., l*25e3 * width, abs(b-uv.y) + pow(0.4 * abs(uv.x), 2.4));\r\n\r\n    return m;\r\n}\r\n\r\nuniform float uTiles;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n    float seed = floor(uv * uTiles).x + floor(uv * uTiles).y * uTiles;\r\n    uv = fract(uv * uTiles) - 0.5;\r\n    \r\n    float weight = lightning(uv, 2.0, seed);\r\n    vec3 color = vec3(0.2,0.2,0.4) * min(4.8,weight);\r\n    float alpha = mix(color.b, 0.0, smoothstep(1.0,2.0,color.b));\r\n    fragColor = vec4(color,alpha);\r\n}"},8683:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aTransform;\r\n\r\nout vec2 vLife;\r\nout vec3 vPosition;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform vec3 uArea;\r\nuniform float uSize;\r\nuniform vec3 uCenter;\r\n\r\nfloat hash11(uint n){\r\n    n = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\nvec3 hash13(uint n){\r\n\tn = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    uvec3 k = n * uvec3(n,n*16807U,n*48271U);\r\n    return vec3( k & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\nfloat noise1D(in float p){\r\n    uint  i = uint(floor(p));\r\n    float f = fract(p);\r\n\tfloat u = f*f*(3.0-2.0*f);\r\n    float g0 = hash11(i+0u)*2.0-1.0;\r\n    float g1 = hash11(i+1u)*2.0-1.0;\r\n    return 2.4*mix( g0*(f-0.0), g1*(f-1.0), u);\r\n}\r\n\r\nvoid main(){\r\n    vec3 random = hash13(uint(gl_VertexID));\r\n\r\n    vec3 relative = aTransform.xyz - uCenter + 0.5*uArea;\r\n    relative.xz = mod(relative.xz, uArea.xz);\r\n    vec3 position = uCenter - 0.5*uArea + relative;\r\n\r\n    float t = 0.1 * uTime.x;\r\n    position += 0.1 * uArea * vec3(\r\n        noise1D(random.x + t + abs(aTransform.x)),\r\n        noise1D(random.y + t + abs(aTransform.y)),\r\n        noise1D(random.z + t + abs(aTransform.z))\r\n    );\r\n\r\n    vLife = vec2(fract(t + random.x), 0.0);\r\n    vPosition = position;\r\n    gl_Position = uViewProjectionMatrix * vec4(position, 1.0);\r\n    gl_PointSize = max(1.0, uSize / gl_Position.w);\r\n}"},5870:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec3 vPosition;\r\nin vec3 vNormal;\r\n#ifdef TRANSPARENT\r\nin vec4 vColor;\r\nin float vMaterial;\r\nlayout(location=0) out vec4 fragColor;\r\n#else\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\nlayout(location=2) out vec4 fragPosition;\r\n#endif\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n#ifndef TRANSPARENT\r\nuniform ModelUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uLayer;\r\n    float uStartTime;\r\n};\r\n#endif\r\n\r\n#define TAU 6.283185307179586\r\nvec3 hash(vec3 p){\r\n\tp = vec3( dot(p,vec3(127.1,311.7, 74.7)),\r\n\t\t\t  dot(p,vec3(269.5,183.3,246.1)),\r\n\t\t\t  dot(p,vec3(113.5,271.9,124.6)));\r\n\treturn -1.0 + 2.0*fract(sin(p)*43758.5453123);\r\n}\r\nfloat noise3D(in vec3 p){\r\n    vec3 i = floor( p );\r\n    vec3 f = fract( p );\r\n\tvec3 u = f*f*(3.0-2.0*f);\r\n    return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0) ), f - vec3(0.0,0.0,0.0) ), \r\n                          dot( hash( i + vec3(1.0,0.0,0.0) ), f - vec3(1.0,0.0,0.0) ), u.x),\r\n                     mix( dot( hash( i + vec3(0.0,1.0,0.0) ), f - vec3(0.0,1.0,0.0) ), \r\n                          dot( hash( i + vec3(1.0,1.0,0.0) ), f - vec3(1.0,1.0,0.0) ), u.x), u.y),\r\n                mix( mix( dot( hash( i + vec3(0.0,0.0,1.0) ), f - vec3(0.0,0.0,1.0) ), \r\n                          dot( hash( i + vec3(1.0,0.0,1.0) ), f - vec3(1.0,0.0,1.0) ), u.x),\r\n                     mix( dot( hash( i + vec3(0.0,1.0,1.0) ), f - vec3(0.0,1.0,1.0) ), \r\n                          dot( hash( i + vec3(1.0,1.0,1.0) ), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );\r\n}\r\nfloat fbm(in vec3 uv, in float period, in int layers){\r\n    float f = 0.0, scale = 1.0;\r\n    for(int i=0;i<layers;i++){\r\n        f += scale * abs(noise3D(uv * period));\r\n        scale *= 0.5;\r\n        period *= 2.0;\r\n        uv += f;\r\n    }\r\n    return f;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n    vec3 normal = normalize(vNormal);\r\n    vec3 view = normalize(uEyePosition - vPosition);\r\n    float NdV = dot(normal, view);\r\n\r\n    float n0 = fbm(vPosition + vec3(0,uTime.x,0), 1.6, 2);\r\n    float n1 = fbm(vPosition - normal*n0*2.0 - 0.2*vec3(0,uTime.x,0), 2.6, 3);\r\n    n0 = 2.0 * n0 * n0;\r\n    n0 *= smoothstep(0.0,1.6,abs(NdV));\r\n    n1 *= smoothstep(0.2,0.8,abs(NdV));\r\n\r\n    vec4 color = vec4(0.01,0,0.02,0);\r\n    color = mix(color, vec4(0.6,0.4,0.8,0.0), n1 * n1);\r\n    color = mix(color, vec4(0.4,0.8,0.8,0.0), 2.0 * (1.0-n1) * n0);\r\n    color = mix(color, vec4(0.08,0.32,0.22,0.2), min(8.0,0.04/n0-1.0));\r\n    color.rgb = mix(color.grb, color.rgb, uColor.r);\r\n\r\n    color *= 0.2+0.8*max(0.,dot(vec3(0,1,0),normal));\r\n\r\n#ifdef TRANSPARENT\r\n    fragColor = color * vColor;\r\n#else\r\n    float alpha = n1;\r\n    const float uThresholdEdge = 0.25;\r\n    float threshold = mix(1.0,-uThresholdEdge,uColor.a);\r\n    color.rgb = mix(color.rgb, vec3(0.3,0.1,0.5), smoothstep(-uThresholdEdge,0.0,threshold - alpha));\r\n    if(alpha <= threshold) discard; \r\n    const float metallic = 0.0;\r\n    fragPosition = vec4(vPosition, uLayer);\r\n    fragNormal = vec4(0,0,0, metallic);\r\n    fragAlbedo = vec4(color.rgb,.5+.5*color.a);\r\n#endif\r\n}"},9447:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec3 vPosition;\r\nin vec3 vNormal; \r\nin vec2 vUV;\r\n\r\nlayout(location=0) out vec4 fragColor;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform ModelUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uLayer;\r\n    float uStartTime;\r\n};\r\nuniform sampler2D uPositionBuffer;\r\nuniform sampler2D uAlbedoBuffer;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash13(in vec3 uv){\r\n    uvec3 q = floatBitsToUint(uv);\r\n\tq *= uvec3(1597334673U, 3812015801U, 2798796415U);\r\n\tuint n = (q.x ^ q.y ^ q.z) * 1597334673U;\r\n\treturn float(n) * (1.0 / float(0xffffffffU));\r\n}\r\nfloat noise3D(in vec3 x){\r\n    vec3 i = floor(x);\r\n    vec3 f = fract(x);\r\n    f = f*f*(3.0-2.0*f);\r\n    return mix(mix(mix(hash13(i+vec3(0,0,0)), \r\n                       hash13(i+vec3(1,0,0)),f.x),\r\n                   mix(hash13(i+vec3(0,1,0)), \r\n                       hash13(i+vec3(1,1,0)),f.x),f.y),\r\n               mix(mix(hash13(i+vec3(0,0,1)), \r\n                       hash13(i+vec3(1,0,1)),f.x),\r\n                   mix(hash13(i+vec3(0,1,1)), \r\n                       hash13(i+vec3(1,1,1)),f.x),f.y),f.z);\r\n}\r\nfloat fbm(in vec3 p, in int layers){\r\n    float f = 0.0, scale = 0.5;\r\n    for(int i=0;i<layers;i++){\r\n        float n = noise3D(p);\r\n        f += scale * abs(n*2.-1.);\r\n        scale *= 0.5;\r\n        p = p * 1.6;\r\n    }\r\n    return f;\r\n}\r\n\r\nvec3 saturation(vec3 rgb, float adjustment){\r\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\r\n    vec3 intensity = vec3(dot(rgb, W));\r\n    return mix(intensity, rgb, adjustment);\r\n}\r\nfloat sine(in float x){return .5-.5*cos(x*TAU);}\r\n\r\nvoid main(){\r\n    vec3 normal = normalize(vNormal);\r\n    vec3 view = normalize(uEyePosition - vPosition);\r\n    float NdV = dot(normal, view);\r\n\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec2 uv = vec2(gl_FragCoord.xy) / vec2(textureSize(uAlbedoBuffer, 0));\r\n    vec4 fragPosition = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    vec3 viewNormal = (uViewMatrix * vec4(normal, 0.0)).xyz;\r\n\r\n    vec3 center = uModelMatrix[3].xyz;\r\n    float radius = length(vPosition - center);\r\n    vec3 relativePosition = fragPosition.xyz - center;\r\n    float distance = radius - length(relativePosition);\r\n    if(distance <= 0.0) discard;\r\n\r\n    vec2 uvOffset = viewNormal.rg * 0.24 * sine(min(1.0,distance*0.4));\r\n    uvOffset *= min(1.0, 4.0 / length(relativePosition));\r\n    vec4 dstColor = texture(uAlbedoBuffer, uv + uvOffset);\r\n\r\n    vec3 color = saturation(dstColor.rgb, smoothstep(1.0,0.0,distance*0.4));\r\n\r\n    float alpha = 1.0;\r\n    fragColor = uColor * vec4(alpha * color, alpha);\r\n}"},796:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash21(in vec2 src) {\r\n    const uint M = 0x5bd1e995u;\r\n    uint h = 1190494759u;\r\n    uvec2 v = floatBitsToUint(src);    \r\n    v *= M; v ^= v>>24u; v *= M;\r\n    h *= M; h ^= v.x; h *= M; h ^= v.y;\r\n    h ^= h>>13u; h *= M; h ^= h>>15u;\r\n    return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\r\n}\r\nfloat noise21(in vec2 uv, in vec2 period, float seed){\r\n    //uv *= period;\r\n    vec4 i = mod(floor(uv).xyxy+vec2(0,1).xxyy,period.xyxy)+seed;\r\n    vec2 f = fract(uv); f = f*f*(3.0-2.0*f);\r\n    return mix(mix(hash21(i.xy), \r\n                   hash21(i.zy), f.x),\r\n               mix(hash21(i.xw), \r\n                   hash21(i.zw), f.x), f.y);\r\n}\r\nfloat fbm(in vec2 x, in int octaves, in vec2 period, float seed) {\r\n\tfloat v = 0.0, a = 1.0;\r\n\tvec2 shift = vec2(100);\r\n    const mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\r\n\tfor(int i = 0; i < octaves; ++i){\r\n\t\tv += 0.5 * a * noise21(x * period, period,seed);\r\n        x += shift;\r\n        shift = rot * shift;\r\n\t\ta *= 0.5;\r\n        period *= 2.0;\r\n\t}\r\n\treturn v;\r\n}\r\nfloat fbmRidge(in vec2 p, in vec2 period, int octaves, float seed){\t\r\n\tfloat z=.5;\r\n\tfloat rz= 0.;\r\n\tfor(int i=1;i<octaves;i++){\r\n\t\trz += z * abs(noise21(p * period, period,seed)*2.-1.);\r\n\t\tz*=.5;\r\n        period*=2.;\r\n\t}\r\n\treturn rz;\r\n}\r\nvec2 polar(in vec2 uv){return vec2(atan(uv.y,uv.x)/TAU+0.5,length(uv));}\r\nvec2 cartesian(in vec2 uv){float a=(uv.x-0.5)*TAU;return vec2(cos(a),sin(a))*uv.y;}\r\nmat2 rotate(in float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\r\n\r\nuniform vec2 uTiles;\r\n\r\nvoid main(){\r\n#ifdef TILED\r\n    float seed = floor(vUV.x * uTiles.x) + floor(vUV.y * uTiles.y) * uTiles.x;\r\n    vec2 uv = fract(vUV * uTiles)*2.-1.;\r\n#else\r\n    float seed = 0.0;\r\n    vec2 uv = 2.*vUV-1.;\r\n#endif\r\n    \r\n#if defined(RING)\r\n    vec2 polar = vec2(length(uv), 0.5 + atan(uv.y, uv.x) / TAU);\r\n    float f0 = fbm(vec2(0.0, polar.y), 4, vec2(1e3,36), seed);\r\n    float y0 = mix(0.5,0.75,f0);\r\n    float alpha = smoothstep(1.0-y0,0.0,abs(polar.x-y0)) * f0 * 1.5;\r\n#elif defined(INNER)\r\n    vec2 polar = vec2(length(uv), 0.5 + atan(uv.y, uv.x) / TAU);\r\n    float f0 = 3.0 * fbm(vec2(0.0, polar.y), 4, vec2(1e3,48), seed);\r\n    f0 = max(0.,mix(polar.x - f0*f0, 1.2, polar.x));\r\n    float alpha = smoothstep(1.0,0.9,polar.x) * f0;\r\n    alpha = pow(alpha, 1.6);\r\n#elif defined(BEAM)\r\n    float f0 = fbm(vec2(0.0, uv.y), 8, vec2(4.0), seed);\r\n    float f1 = fbm(vec2(0.0, uv.y), 4, vec2(16.0), seed);\r\n    float alpha = smoothstep(1.0,mix(0.9,-2.0,f0),uv.x - 0.2*f1 + 2.0*pow(abs(uv.y),2.0)) * pow(1.0-abs(uv.y),2.0);\r\n#elif defined(CONE)\r\n    float angle = abs(atan(uv.y,uv.x+1.0)/TAU);\r\n    alpha += 0.5 * smoothstep(0.3,0.2,angle) * smoothstep(1.0,0.0,uv.x+2.0*abs(uv.y));\r\n#elif defined(SWIRL)\r\n    vec2 uvp = polar(uv);\r\n    \r\n    float r0 = fbmRidge(uvp,vec2(1,2),4,seed);\r\n    uvp.x += 1.0 * r0;\r\n    uv = cartesian(uvp);\r\n\r\n    vec2 basis = vec2(fbmRidge(uv-0.1,vec2(2),4,seed), fbmRidge(uv+0.1,vec2(2),4,seed));\r\n    uv += (basis-.5);\r\n    float f0 = fbmRidge(uv*rotate(basis.x - basis.y), vec2(2),4,seed);\r\n    \r\n    f0 *= abs(uvp.y-0.5)*2.;\r\n    f0 = mix(0.01 / f0, 0.1 / f0, f0);\r\n    f0 *= smoothstep(1.0,0.5,uvp.y);\r\n    float alpha = f0;\r\n#elif defined(CRACKS)\r\n    vec2 polar = vec2(length(uv), 0.5 + atan(uv.y, uv.x) / TAU);\r\n    polar.y += 0.08*(1.-2.*noise21(polar*vec2(4,8)+12.4, vec2(4,8),seed));\r\n    float width = pow(mix(1.2,0.0,polar.x),4.0);\r\n    float f0 = smoothstep(1.0-width,1.0,.5+.5*cos(polar.y*TAU*12.0));\r\n    f0 = max(1.2*f0, 1.4*fbm(vec2(64.0, polar.y), 4, vec2(1e3,48),seed));\r\n    float alpha = smoothstep(0.0, 1.0, f0 - polar.x);\r\n#elif defined(GROUND)\r\n    float f0 = fbm(uv,8,vec2(3,6),seed);\r\n    float f1 = fbm(uv + 0.3*f0,4,vec2(4,8),seed);\r\n    float alpha = smoothstep(1.0,mix(0.0,-4.0,f1),uv.x -f0 + 2.0*pow(abs(uv.y),2.0));\r\n    float angle = abs(atan(uv.y,uv.x+1.5)/TAU);\r\n    alpha *= smoothstep(0.2,0.0,angle) * smoothstep(-1.0,-0.5,uv.x);\r\n#elif defined(SPIKE)\r\n    uv.x = pow(.5+.5*uv.x,0.5)*2.-1.; uv.y *= 0.8;\r\n    float f0 = fbm(uv,4,vec2(2,4),seed);\r\n    float f1 = fbm(uv + 0.5*f0,2,vec2(2,6),seed);\r\n    float alpha = smoothstep(0.0,-4.*f1,1.2*uv.x+f0-2.0*(1.0-abs(uv.y)));\r\n    alpha *= smoothstep(1.6,0.8,-uv.x + f1 + 2.0*abs(uv.y));\r\n#elif defined(WRAP)\r\n    float f0 = smoothstep(0.2,1.0,fbm(vec2(0.0, uv.x), 4, vec2(1e3,12),seed));\r\n    float f1 = smoothstep(0.2,1.0,fbm(vec2(0.1, uv.x), 4, vec2(1e3,8),seed));\r\n    float alpha = 0.5 * smoothstep(0.0, 1.0, 1.5*f0 + uv.y);\r\n    alpha += 0.5 * smoothstep(0.0, 1.0,f1*f1 + uv.y);\r\n#else\r\n    vec2 polar = vec2(length(uv), 0.5 + atan(uv.y, uv.x) / TAU);\r\n    float f0 = 2.0*fbm(vec2(0.0, polar.y), 4, vec2(1e3,36),seed);\r\n    f0 += smoothstep(1.0, -1.0, polar.x - max(0.0,0.5-f0));\r\n    float alpha = smoothstep(0.0, 1.0, f0 - 1.5*polar.x);\r\n#endif\r\n    \r\n    fragColor = vec4(1) * alpha;\r\n}"},4290:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nin vec3 vPosition;\r\nin mat4 vInvModel;\r\nin vec4 vUV;\r\nin vec4 vColor;\r\nin float vThreshold;\r\n\r\nuniform float uLayer;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform sampler2D uDiffuseMap;\r\nuniform sampler2D uNormalMap;\r\nuniform sampler2D uPositionBuffer;\r\n\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\n\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(in float u){\r\n    uint n = floatBitsToUint(u);\r\n    n = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & 0x7fffffffU)/float(0x7fffffff);\r\n}\r\nvec4 calcColor(in vec2 uv){\r\n    uv = uv*2.-1.;\r\n    const float rings = 6.0;\r\n    vec2 polar = vec2(atan(uv.y,uv.x)/TAU+.5,length(uv));\r\n    polar.y = pow(polar.y,0.8);\r\n    \r\n    float radius = floor(polar.y * rings)/rings;\r\n    float r0 = hash11(floor(polar.y * rings));\r\n    polar.x = fract(polar.x + uTime.x * mix(-0.2,0.2,r0));\r\n    float r1 = hash11(floor(polar.x * (2.+8.*r0*radius)));\r\n    polar.x = fract(polar.x - uTime.x * mix(-0.1,0.1,r1));\r\n    float r2 = hash11(floor(polar.x * (2.+32.*r1*radius)));\r\n    \r\n    float l = fract(polar.y * rings);\r\n    \r\n    float alpha = smoothstep(1.0,0.8,l+.6*r1);\r\n    alpha *= smoothstep(0.0,0.2,l-.2*r2);\r\n    alpha *= step(1.0 / rings, radius) * step(polar.y,1.0);\r\n    alpha *= step(.5+.5*sin(polar.x*TAU*(2.0+r1*8.0)),0.9);\r\n    alpha = alpha + 4.0 * alpha * (1.0-alpha);\r\n    \r\n    vec3 color = alpha * mix(vec3(0.4,0.2,1), vec3(1,0.2,0.4), r0);\r\n    return vec4(color, alpha);\r\n}\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec3 viewRay = vPosition.xyz - uEyePosition;\r\n    vec4 worldPosition = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    if(worldPosition.a > uLayer) discard;\r\n    vec4 objectPosition = vInvModel * vec4(worldPosition.xyz, 1.0);\r\n    if(0.5 < abs(objectPosition.x) || 0.5 < abs(objectPosition.y) || 0.5 < abs(objectPosition.z)) discard;\r\n    vec2 uv = mix(vUV.xy, vUV.zw, objectPosition.xz + 0.5);\r\n\r\n    vec4 color = vColor * calcColor(uv);\r\n    fragAlbedo = color;\r\n    fragNormal = vec4(0,0,0,smoothstep(0.8,1.6,color.a));\r\n}"},1069:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash21(in vec2 uv){\r\n    uvec2 q = floatBitsToUint(uv);\r\n    q = 1103515245u * ((q >> 1u) ^ q.yx);\r\n    uint n = 1103515245u * (q.x ^ (q.y >> 3u));\r\n    return float(n) * (1.0 / float(0xffffffffu));\r\n}\r\nfloat noise21(in vec2 uv, in vec2 period, float seed){\r\n    uv *= period;\r\n    vec4 i = mod(floor(uv).xyxy+vec2(0,1).xxyy,period.xyxy)+seed;\r\n    vec2 f = fract(uv); f = f*f*f*(f*(f*6.0-15.0)+10.0);\r\n    return mix(mix(hash21(i.xy), \r\n                   hash21(i.zy), f.x),\r\n               mix(hash21(i.xw), \r\n                   hash21(i.zw), f.x), f.y);\r\n}\r\nfloat fbm(vec2 uv, vec2 frequency, int octaves, float shift, float gain, float lacunarity, float factor, float seed){\r\n    uv *= frequency;\r\n    vec2 offset = vec2(shift,0);\r\n    float value = 0.0, amplitude = gain;\r\n    vec2 sc = vec2(sin(shift), cos(shift)); mat2 rotate = mat2(sc.y,sc.x,-sc.x,sc.y);\r\n    for(int i=0;i<octaves;i++){\r\n        value += amplitude * (noise21(uv / frequency, frequency, seed)*2.-1.);\r\n        uv = uv * lacunarity + offset * float(i+1);\r\n        frequency *= lacunarity;\r\n        amplitude = pow(amplitude * gain, factor);\r\n        offset *= rotate;\r\n    }\r\n    return .5+.5*value;\r\n}\r\nfloat rfbm(vec2 uv, vec2 frequency, int octaves, float seed){\r\n    uv *= frequency;\r\n    float value = 0.0, amplitude = 0.5;\r\n    for(int i=0;i<octaves;i++){\r\n        float r = noise21(uv / frequency, frequency, seed)*2.-1.;\r\n        value += amplitude * abs(r);\r\n        uv += r;\r\n        uv = uv * 2.0 + vec2(100) * float(i+1);\r\n        frequency *= 2.0;\r\n        amplitude *= 0.5;\r\n    }\r\n    return value;\r\n}\r\n\r\nuvec2 wrap2(in vec2 v, float period){return uvec2(v-period*floor(v/period));}\r\nfloat hash21(in uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n\tn = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\nfloat noise2D(in vec2 p, in float period){\r\n    const vec2 e = vec2(0,1);\r\n    vec2 f = fract(p);\r\n    p = floor(p);\r\n    f = f*f*(3.0-2.0*f);\r\n    return mix(mix(hash21(wrap2(p+e.xx, period)),\r\n\t\t\t\t    hash21(wrap2(p+e.yx, period)), f.x),\r\n\t\t\t\tmix(hash21(wrap2(p+e.xy, period)),\r\n\t\t\t\t\thash21(wrap2(p+e.yy, period)), f.x), f.y);\r\n}\r\nfloat fbm(in vec2 uv, in float period, in int octaves){\r\n    float value=0.0,amplitude=0.5;\r\n    for(int i=0;i<octaves;i++){\r\n        value += noise2D(uv, period) * amplitude;\r\n        amplitude*=0.5;\r\n        period*=2.0;\r\n        uv*=2.0;\r\n    }\r\n    return value;\r\n}\r\nvec3 saturation(vec3 rgb, float adjustment){\r\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\r\n    vec3 intensity = vec3(dot(rgb, W));\r\n    return mix(intensity, rgb, adjustment);\r\n}\r\n\r\nvoid main(){\r\n#if defined(RUST)\r\n    vec2 uv = vUV.yx;\r\n    float scale = 1.0;\r\n\tfloat f0 = fbm(uv*8.0*scale, 8.0*scale, 4);\r\n    uv.x -= f0*0.5;\r\n    float f1 = fbm(uv*16.0*scale + 128.0, 16.0*scale, 2);\r\n    uv -= f0*f1;\r\n    float f2 = fbm(uv*12.*scale + 256.0, 12.*scale, 4);\r\n    \r\n    vec3 color = vec3(0.4,0.3,0.3);\r\n    color = mix(color, vec3(0.8,0.3,0.3), f0);\r\n    color = mix(color, vec3(0.4,0.5,0.4), f1);\r\n    color = mix(color, vec3(0.2,0.1,0.2), smoothstep(0.2,1.,f2));\r\n\t\r\n    float roughness = 1.0-f1*f2;\r\n\tfragColor = vec4(color,.5*roughness);\r\n#elif defined(PIPE)\r\n    vec2 uv = vUV;\r\n\r\n    float f0 = 1.-2.*fbm(uv, vec2(8,12), 2, 0.0, 0.5, 2.0, 0.9, 0.);\r\n    float f1 = .4+.6*rfbm(uv.yx + .6*f0, vec2(8,16), 6, 0.5);\r\n    \r\n    vec3 color = vec3(f1*f1*f1,f1*f1*(f1+0.5),f1*(f1+0.5));\r\n    color -= vec3(f1*abs(f0));\r\n    float roughness = mix(0.8, 0.4, color.r);\r\n    color = mix((vec3(1.0,0.85,0.95)-color.bgr)*0.5, color.ggb, color.b*color.g);\r\n\r\n    fragColor = vec4(color,.5*roughness);\r\n#else\r\n    vec2 uv = vUV;\r\n\r\n    float f0 = fbm(uv, vec2(4,8), 6, 0., 0.5, 2.0, 0.8, 0.);\r\n    uv += vec2(1,0.2) * f0;\r\n    float f1 = fbm(uv, vec2(4), 2, 100., 0.3, 1.4, 0.8, 0.);\r\n    \r\n    vec3 color = vec3(0.06,0,0.08);\r\n    color += vec3(0.8*f1*f1,f1*f1,0.7*f1);\r\n    color += 0.8 * vec3(f0*f0,f0*f1*f0,f0*f1);\r\n\t\r\n    float roughness = mix(0.8, 0.4, smoothstep(0.2,0.5,f1*f0));\r\n\tfragColor = vec4(color,.5*roughness);\r\n#endif\r\n}"},8450:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\n#define RESOLUTION 1\r\nuniform vec2 uScreenSize;\r\n\r\nfloat hash(ivec2 v, int period){\r\n    period *= RESOLUTION;\r\n    uvec2 x = uvec2(v - period * (v / period));\r\n    uvec2 q = 1103515245U * ((x>>1U) ^ (x.yx   ));\r\n    uint  n = 1103515245U * ((q.x  ) ^ (q.y>>3U));\r\n    return float(n) * (1.0/float(0xffffffffU));\r\n}\r\nfloat noise(in vec2 p, int period){\r\n    const ivec2 k = ivec2(0,1);\r\n    ivec2 i = ivec2(floor(p));\r\n    vec2 f = fract(p);\r\n\tvec2 u = f*f*(3.0-2.0*f);\r\n    return mix(mix(hash(i + k.xx, period), \r\n                hash(i + k.yx, period), u.x),\r\n            mix(hash(i + k.xy, period), \r\n                hash(i + k.yy, period), u.x), u.y);\r\n}\r\n\r\nfloat grid(in vec2 uv, in float tiles, in float width){\r\n    uv = cos(TAU*(uv*tiles));\r\n    return smoothstep(1.0-width,1.0,max(uv.x,uv.y));\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV * float(RESOLUTION);\r\n\r\n    float l3 = noise(512.0 * uv, 512);\r\n    float l2 = noise(128.0 * uv, 128);\r\n    float l1 = noise(32.0 * uv, 32);\r\n    uv += 0.4*noise(16.0*uv.yx - l1 + 128.0,16);\r\n    float l0 = noise(8.0*uv,8);\r\n    \r\n    vec3 color = vec3(0.04,0.04,0.12)\r\n    + vec3(0.63,0.55,0.42) * l0\r\n    + vec3(0.2,0.1,0.1) * (1.0-l0*l1)\r\n    + vec3(0.42,0.42,0.44) * l1\r\n    + vec3(0.16,0.30,0.27) * l2\r\n    + vec3(0.12,0.16,0.22) * (l3-1.0);\r\n    color = 0.25 + 0.5 * color;\r\n\r\n#ifdef GRID\r\n    color = vec3(grid(vUV, 10.0, 0.1),0.0,0.0);\r\n    color.gb += step(0.48, max(abs(0.5-vUV.x),abs(0.5-vUV.y)));\r\n#endif\r\n\r\n    float roughness = mix(0.8,1.0,color.g);\r\n    fragColor = vec4(color,.5*roughness);\r\n}"},3135:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform vec4 uColor;\r\nuniform float uBlur;\r\n#ifdef TRIANGLE\r\nuniform vec2 uSize;\r\n#endif\r\n#ifdef ROUNDED_BOX\r\nuniform float uSize;\r\nuniform float uRadius;\r\n#endif\r\n\r\n#define TAU 6.283185307179586\r\nfloat triangle(in vec2 p, in vec2 p0, in vec2 p1, in vec2 p2){\r\n\tvec2 e0 = p1 - p0; vec2 e1 = p2 - p1; vec2 e2 = p0 - p2;\r\n\tvec2 v0 = p - p0; vec2 v1 = p - p1; vec2 v2 = p - p2;\r\n\r\n\tvec2 pq0 = v0 - e0*clamp( dot(v0,e0)/dot(e0,e0), 0.0, 1.0 );\r\n\tvec2 pq1 = v1 - e1*clamp( dot(v1,e1)/dot(e1,e1), 0.0, 1.0 );\r\n\tvec2 pq2 = v2 - e2*clamp( dot(v2,e2)/dot(e2,e2), 0.0, 1.0 );\r\n    \r\n    float s = e0.x*e2.y - e0.y*e2.x;\r\n    vec2 d = min( min( vec2( dot( pq0, pq0 ), s*(v0.x*e0.y-v0.y*e0.x) ),\r\n                       vec2( dot( pq1, pq1 ), s*(v1.x*e1.y-v1.y*e1.x) )),\r\n                       vec2( dot( pq2, pq2 ), s*(v2.x*e2.y-v2.y*e2.x) ));\r\n\treturn -sqrt(d.x)*sign(d.y);\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = 2.*vUV-1.;\r\n#if defined(CIRCLE)\r\n    float distance = max(0.0, 1.0-length(uv));\r\n    float alpha = distance*distance;\r\n#elif defined(BULGE)\r\n    float alpha = 1.0-pow(length(uv),4.0);\r\n#elif defined(CRESCENT)\r\n    float alpha = smoothstep(1.0,0.85,length(uv));\r\n    alpha -= smoothstep(1.0,0.75,length(uv+vec2(0,0.2)));\r\n    alpha *= (.5+.5*uv.y) * pow(length(uv),4.0) * 2.0;\r\n#elif defined(GLOW)\r\n    float alpha = 0.5*(1.0/length(uv)-1.0);\r\n#elif defined(WAVE)\r\n    uv = vec2(atan(uv.y,uv.x)/TAU,length(uv));\r\n    float alpha = .5-.5*cos(smoothstep(0.2,1.0,uv.y)*TAU);\r\n    alpha = alpha * alpha;\r\n#elif defined(RING)\r\n    uv = vec2(atan(uv.y,uv.x)/TAU,length(uv));\r\n    float distance = max(0.0, 1.0-uv.y);\r\n    //distance -= smoothstep(1.0,0.0,uv.y) * smoothstep(0.0,1.0,abs(fract(uv.x * 9.0)-0.5));\r\n    float alpha = smoothstep(0.0,0.1,distance) * smoothstep(0.5,0.0,distance);\r\n    alpha = pow(alpha, 1.4);\r\n#elif defined(RETICLE)\r\n    const float edge = 0.02;\r\n    vec2 polar = vec2(.5+atan(uv.y,uv.x)/TAU,length(uv));\r\n    polar.y *= max(abs(uv.x),abs(uv.y)) * 1.2;\r\n    float outer = smoothstep(.9,.9-edge,polar.y)*smoothstep(.7-edge,.7,polar.y);\r\n    outer *= smoothstep(.7,.7-edge,abs(fract(polar.x*4.)*2.-1.));\r\n    float plus = smoothstep(.04+edge,.04,min(abs(uv.x),abs(uv.y)));\r\n    plus = max(0., plus - smoothstep(.04,.04-edge,polar.y));\r\n    float inner = smoothstep(.3,.3-edge,polar.y)*smoothstep(.2-edge,.2,polar.y);\r\n    inner = max(0., inner - smoothstep(.1+edge,.1,min(abs(uv.x),abs(uv.y))));\r\n    float alpha = plus + outer + inner;\r\n#elif defined(ROUNDED_BOX)\r\n    float distance = length(max(abs(uv)-uSize+uRadius,0.0))-uRadius;\r\n    float alpha = 1.0-smoothstep(0.0, 1.0 - uSize, distance);\r\n#elif defined(TRIANGLE)\r\n    //TODO NOT USED\r\n    float distance = triangle(uv, vec2(-uSize.x,uSize.y), vec2(-uSize.x,-uSize.y), vec2(uSize.x,0.0));\r\n    float alpha = smoothstep(uBlur, 0.0, distance);\r\n#elif defined(SPARKLE)\r\n    uv = abs(uv);\r\n    uv += mix(0.0,-0.16*(1.0-max(uv.x,uv.y)),max(uv.x,uv.y));\r\n    float sparkle = max(0.0, 1.0 - (16.0*uv.x*uv.y + 0.8*(uv.x+uv.y)));\r\n    sparkle = pow(1.0/(1.0-sparkle),0.2) - 1.0;\r\n    float alpha = sparkle * 2.0;\r\n#elif defined(BLINK)\r\n    uv = abs(uv);\r\n    float x0 = 1.0-uv.x*uv.x;\r\n    float x1 = 1.0-uv.x;\r\n    float y0 = mix(pow(1.0-uv.y,8.0), pow(1.0-uv.y,2.0), x1*x1);\r\n    float alpha = smoothstep(0.0, 1.0, x0*y0);\r\n#elif defined(STRIPE)\r\n    uv = .5+.5*uv;\r\n    float line = .5+.5*cos(TAU*(4.0*uv.y+0.5));\r\n    float l0 = 1.0/pow(1.0-line,0.2);\r\n    float alpha = 0.4 * line * l0;\r\n#endif\r\n    fragColor = uColor * alpha;\r\n}"},6246:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(in float u){\r\n    uint n = floatBitsToUint(u);\r\n    n = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & 0x7fffffffU)/float(0x7fffffff);\r\n}\r\nvec2 hash22(in vec2 uv){\r\n    uvec4 q = floatBitsToUint(uv).xyyx;\r\n    q = 1103515245u * ((q >> 1u) ^ q.yxwz);\r\n    uvec2 n = 1103515245u * (q.xz ^ (q.yw >> 3u));\r\n    return vec2(n) * (1.0 / float(0xffffffffu));\r\n}\r\nfloat noise11(in float u, in float period, float seed){\r\n    u *= period;\r\n    vec2 i = mod(floor(vec2(u,u+1.0)),vec2(period))+seed;\r\n    float f = fract(u);\r\n    return mix(hash11(i.x),hash11(i.y),f);\r\n}\r\nvec3 voronoi(in vec2 uv, in vec2 period, in float jitter, in float width, in float seed){\r\n    uv *= period;\r\n    vec2 i = floor(uv); vec2 f = uv - i;\r\n    vec2 minPos, tilePos;\r\n    float md = 1e+5;\r\n    for(int y=-1;y<=1;y++)\r\n    for(int x=-1;x<=1;x++){\r\n        vec2 n = vec2(x,y);\r\n        vec2 cPos = jitter * hash22(mod(i + n, period) + seed);\r\n        vec2 rPos = n + cPos - f;\r\n        float d = dot(rPos, rPos);\r\n        if(d >= md) continue;\r\n        md = d;\r\n        minPos = rPos;\r\n        tilePos = cPos;\r\n    }\r\n    float md0 = 1e+5; md = 1e+5;\r\n    for(int y=-2;y<=2;y++)\r\n    for(int x=-2;x<=2;x++){\r\n        vec2 n = vec2(x,y);\r\n        vec2 cPos = jitter * hash22(mod(i + n, period) + seed);\r\n        vec2 rPos = n + cPos - f;\r\n        vec2 v = minPos - rPos;\r\n        if(dot(v, v) <= 1e-5) continue;\r\n        float d = dot(0.5 * (minPos + rPos), normalize(rPos - minPos));\r\n        if(d < md){\r\n            md0 = md; md = d;\r\n        }else if(d < md0){\r\n            md0 = d;\r\n        }\r\n    }\r\n    md += (md0 - md) * width;\r\n    return vec3(md, tilePos);\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = 2.*vUV-1.;\r\n    vec2 polar = vec2(atan(uv.y,uv.x)/TAU+0.5,length(uv));\r\n    vec2 frequency = vec2(24,16);\r\n\r\n    vec2 uv0 = vec2(max(0.5,pow(polar.y,0.1)), polar.x);\r\n    uv0.x += 0.01 * abs(noise11(polar.x, 40.0, 0.0));\r\n    vec3 w = voronoi(uv0, frequency, 0.6, 0.1, 0.0);\r\n    float e0 = mix(.1, .0, pow(polar.y, .1));\r\n    float edge = smoothstep(e0+0.18, e0, w.x) * smoothstep(1.0,0.8,polar.y);\r\n#ifdef MASK\r\n    float alpha = smoothstep(-0.5,2.0,2.0*polar.y-edge*noise11(polar.x, 32.0, 0.0));\r\n    float height = 1.0 - pow(edge, 4.0);\r\n    float dhdx = dFdx(height);\r\n    float dhdy = dFdy(height);\r\n    vec3 normal = smoothstep(0.0,0.5,edge) * normalize(vec3(-dhdx, -dhdy, 1));\r\n    fragColor = vec4(0.5+0.5*normal, alpha);\r\n#else\r\n    vec3 color = vec3(0.0);\r\n    color = mix(color, vec3(0.15,0.10,0.20), edge);\r\n    color = mix(color, vec3(0.30,0.20,0.40), smoothstep(0.7,1.0,edge));\r\n    color = mix(color, vec3(1.00,0.20,0.50), smoothstep(0.9,1.0,edge));\r\n    color = mix(color, vec3(1.20,0.80,1.00), smoothstep(0.99,1.0,edge));\r\n\r\n    float alpha = mix(edge * edge, 0.0, smoothstep(0.95,1.0,edge));\r\n\r\n    fragColor = vec4(color, alpha);\r\n#endif\r\n}"},6075:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec3 vPosition;\r\nin vec3 vNormal; \r\nin vec2 vUV;\r\n\r\nlayout(location=0) out vec4 fragColor;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform ModelUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uLayer;\r\n    float uStartTime;\r\n};\r\nuniform sampler2D uPositionBuffer;\r\n#ifdef DISPLACEMENT\r\nuniform sampler2D uAlbedoBuffer;\r\n#endif\r\n\r\n#define TAU 6.283185307179586\r\nvec3 hash33(vec3 p){\r\n\tp = vec3( dot(p,vec3(127.1,311.7, 74.7)),\r\n\t\t\t  dot(p,vec3(269.5,183.3,246.1)),\r\n\t\t\t  dot(p,vec3(113.5,271.9,124.6)));\r\n\treturn -1.0 + 2.0*fract(sin(p)*43758.5453123);\r\n}\r\nfloat noise3D(in vec3 p){\r\n    vec3 i = floor( p );\r\n    vec3 f = fract( p );\r\n\tvec3 u = f*f*(3.0-2.0*f);\r\n    return mix( mix( mix( dot( hash33( i + vec3(0.0,0.0,0.0) ), f - vec3(0.0,0.0,0.0) ), \r\n                          dot( hash33( i + vec3(1.0,0.0,0.0) ), f - vec3(1.0,0.0,0.0) ), u.x),\r\n                     mix( dot( hash33( i + vec3(0.0,1.0,0.0) ), f - vec3(0.0,1.0,0.0) ), \r\n                          dot( hash33( i + vec3(1.0,1.0,0.0) ), f - vec3(1.0,1.0,0.0) ), u.x), u.y),\r\n                mix( mix( dot( hash33( i + vec3(0.0,0.0,1.0) ), f - vec3(0.0,0.0,1.0) ), \r\n                          dot( hash33( i + vec3(1.0,0.0,1.0) ), f - vec3(1.0,0.0,1.0) ), u.x),\r\n                     mix( dot( hash33( i + vec3(0.0,1.0,1.0) ), f - vec3(0.0,1.0,1.0) ), \r\n                          dot( hash33( i + vec3(1.0,1.0,1.0) ), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );\r\n}\r\nfloat fbm(in vec3 p, in int layers){\r\n    float f = 0.0, scale = 1.0;\r\n    for(int i=0;i<layers;i++){\r\n        f += scale * abs(noise3D(p));\r\n        scale *= 0.5;\r\n        p *= 1.8;\r\n    }\r\n    return f;\r\n}\r\n\r\nvoid main(){\r\n    vec3 position = vPosition;\r\n    vec3 normal = normalize(vNormal);\r\n    vec3 view = normalize(uEyePosition - position);\r\n    float NdV = dot(normal, view);\r\n\r\n    float n = fbm(position + vec3(0,2.*uTime.x,0), 4);\r\n\r\n#ifdef DISPLACEMENT\r\n    vec3 viewNormal = (uViewMatrix * vec4(normal, 0.0)).xyz;\r\n    float fresnel = smoothstep(0.4,1.0,NdV*NdV);\r\n    vec2 distortion = fresnel * 0.1 * viewNormal.rg;\r\n    distortion *= 20.0 * uColor.a * n;\r\n\r\n    vec2 uv = vec2(gl_FragCoord.xy) / vec2(textureSize(uAlbedoBuffer, 0));\r\n    uv += distortion;\r\n    fragColor = texture(uAlbedoBuffer, uv);\r\n    fragColor.rgb *= mix(vec3(1),uColor.rgb,fresnel);\r\n#else\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec4 fragPosition = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    float distance = length(fragPosition.xyz - position);\r\n\r\n    float edge = smoothstep(1.0,0.0,NdV)*smoothstep(-0.5,0.0,NdV);\r\n    edge += smoothstep(0.5,0.0,distance);\r\n\r\n    vec3 color = vec3(0.0,0.1,0.1);\r\n    color = mix(color, vec3(0.4,0.6,0.6), smoothstep(0.5,0.0,n));\r\n    color = mix(color, vec3(0.6,0.8,0.8), smoothstep(0.2,0.0,n));\r\n    float wave = smoothstep(0.6,1.0,sin(TAU * (0.2*position.y + 0.5*n) + 2.*uTime.x));\r\n    color *= mix(edge,1.0,wave);\r\n\r\n    fragColor = uColor * vec4(color,0.1*edge);\r\n#endif\r\n}"},1220:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nin vec2 vLife;\r\nin vec3 vPosition;\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\nuniform sampler2D uGradient;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\n\r\n#define TAU 6.283185307179586\r\nfloat sineNoise(vec2 uv, int layers, float shift){\r\n    vec2 p = vec2(uv); float v = 0.0;\r\n\tfor(int i=0;i<layers;i++){\r\n\t\tfloat t = shift * (.75+.25*sin(float(i+1)*43758.5453));\r\n        uv.y -= t;\r\n\t\tp = uv + vec2(cos(t - p.x) + sin(t + p.y), sin(t - p.y) + cos(t + p.x));\r\n        v += 1.0/length(1.0/vec2(sin(p.x+t), cos(p.y+t)));\r\n\t}\r\n    v = smoothstep(1.0,0.0,v / float(layers));\r\n    return pow(v,1.4);\r\n}\r\n\r\nvoid main(void){\r\n    vec2 uv = vUV;\r\n\r\n    float alpha = sineNoise(uv*TAU, 4, 411.37+uTime.x+0.2*vPosition.y);\r\n    vec4 color = vec4(mix(smoothstep(0.0,0.8,alpha), smoothstep(0.2,1.0,alpha), vLife.x));\r\n\r\n#ifdef GRADIENT\r\n    color = texture(uGradient, vec2(vLife.x, color.a));\r\n#else\r\n    color *= 4.*vLife.x*(1.-vLife.x);\r\n#endif\r\n#ifdef MASK\r\n    color *= smoothstep(1.0,0.5,length(2.*uv-1.));\r\n#endif\r\n    fragColor = color;\r\n}"},5325:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform vec4 uColor;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n    fragColor = uColor;\r\n}"},5433:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nin vec3 vPosition;\r\nin mat4 vInvModel;\r\nin vec4 vUV;\r\nin vec4 vColor;\r\nin float vThreshold;\r\n\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nuniform float uLayer;\r\nuniform sampler2D uDiffuseMap;\r\nuniform sampler2D uNormalMap;\r\nuniform sampler2D uPositionBuffer;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(float u){\r\n    uint q = floatBitsToUint(u);\r\n\tuvec2 n = q * uvec2(1597334673U, 3812015801U);\r\n\tq = (n.x ^ n.y) * 1597334673U;\r\n\treturn float(q) * (1.0 / float(0xffffffffU));\r\n}\r\nvec2 hash22(in vec2 uv){\r\n    uvec4 q = floatBitsToUint(uv).xyyx;\r\n    q = 1103515245u * ((q >> 1u) ^ q.yxwz);\r\n    uvec2 n = 1103515245u * (q.xz ^ (q.yw >> 3u));\r\n    return vec2(n) * (1.0 / float(0xffffffffu));\r\n}\r\nfloat hash12(in vec2 src) {\r\n    const uint M = 0x5bd1e995u;\r\n    uint h = 1190494759u;\r\n    uvec2 v = floatBitsToUint(src);    \r\n    v *= M; v ^= v>>24u; v *= M;\r\n    h *= M; h ^= v.x; h *= M; h ^= v.y;\r\n    h ^= h>>13u; h *= M; h ^= h>>15u;\r\n    return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\r\n}\r\nfloat noise1D(in float p, in float period){\r\n    float i = floor(p);\r\n    float f = fract(p); f = f*f*(3.0-2.0*f);\r\n    return mix(hash11(mod(i,period)), hash11(mod(i+1.,period)), f);\r\n}\r\nfloat noise2D(in vec2 p, in vec2 period){\r\n    vec4 i = floor(p).xyxy + vec4(0,0,1,1);\r\n    vec2 f = fract(p); f = f*f*(3.0-2.0*f);\r\n    i = mod(i, period.xyxy);\r\n    return mix( mix( hash12(i.xy), \r\n                     hash12(i.zy), f.x),\r\n                mix( hash12(i.xw), \r\n                     hash12(i.zw), f.x), f.y);\r\n}\r\n\r\nvec3 voronoi(in vec2 x, in vec2 period, float seed){\r\n    x *= period;\r\n    vec2 n = floor( x );\r\n    vec2 f = fract( x );\r\n\r\n\tvec3 m = vec3( 8.0 );\r\n    for( int j=-1; j<=1; j++ )\r\n    for( int i=-1; i<=1; i++ ){\r\n        vec2  g = vec2( float(i), float(j) );\r\n        vec2  o = hash22(mod(n + g, period));\r\n        vec2  r = g - f + o;\r\n\t\tfloat d = dot( r, r );\r\n        d += d*mix(-0.5,2.0,noise2D(o*period+0.5+seed, period));\r\n        if( d<m.x ) m = vec3( d, o );\r\n    }\r\n\r\n    return vec3( sqrt(m.x),m.y,m.z);\r\n}\r\n\r\nfloat fbm(in vec2 x, in int octaves, in vec2 period) {\r\n\tfloat v = 0.0, a = 0.5, m = 0.0;\r\n\tvec2 shift = vec2(100);\r\n    const mat2 rot = mat2(cos(0.4), sin(0.4), -sin(0.4), cos(0.4));\r\n\tfor(int i = 0; i < octaves; ++i){\r\n        m += a;\r\n\t\tv += a * noise2D(x * period, period);\r\n        x += shift;\r\n        shift = rot * shift;\r\n\t\ta *= 0.5;\r\n        period *= 2.0;\r\n\t}\r\n\treturn v/m;\r\n}\r\nvec3 saturation(vec3 rgb, float adjustment){\r\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\r\n    vec3 intensity = vec3(dot(rgb, W));\r\n    return mix(intensity, rgb, adjustment);\r\n}\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec3 viewRay = vPosition.xyz - uEyePosition;\r\n    vec4 worldPosition = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    if(worldPosition.a > uLayer) discard;\r\n    vec4 objectPosition = vInvModel * vec4(worldPosition.xyz, 1.0);\r\n    if(0.5 < abs(objectPosition.x) || 0.5 < abs(objectPosition.y) || 0.5 < abs(objectPosition.z)) discard;\r\n    vec2 uv = mix(vUV.xy, vUV.zw, objectPosition.xz + 0.5);\r\n    ///vec4 color = vColor * texture(uDiffuseMap, uv);\r\n\r\n    uv = uv*2.-1.;\r\n    uv = vec2(atan(uv.y,uv.x)/TAU+.5,length(uv));\r\n    \r\n    float f0 = fbm(uv - .01*vec2(uTime.x,uTime.x), 2, vec2(10,4));\r\n    f0 += smoothstep(0.4,.0,uv.y);\r\n    f0 -= vThreshold;\r\n    float f1 = fbm(uv + 0.5*f0 - vec2(uv.y - .1*uTime.x,0), 2, vec2(8,4));\r\n    float f2 = fbm(uv + vec2(f1,f0), 2, vec2(12,6));\r\n    f2 += smoothstep(0.4,.0,uv.y) + max(0.,f1-f0);\r\n    \r\n    f2 *= smoothstep(1.0,0.8,uv.y*(0.6+f1));\r\n\r\n    vec4 color = vec4(0);\r\n    color.rgb = mix(vec3(1.3,1.2,1.6), color.rgb, pow(smoothstep(.0,.9,f2),2.0));\r\n    color.rgb += vec3(0.42,0.4,0.36) * pow(smoothstep(0., 1., f0*f2+f1*f0),2.0);\r\n    color.rgb = mix(color.rgb, vec3(0.6,0,0.2)*f0, vThreshold);\r\n    color.rgb *= pow(f1*f2*f0+f2, 2.0);    \r\n    color.a = smoothstep(0.0,0.2,color.r);\r\n    color *= smoothstep(1.0,0.5,uv.y);\r\n\r\n#ifdef ALPHA_CUTOFF\r\n    if(color.a < ALPHA_CUTOFF) discard;\r\n#endif\r\n    fragAlbedo = color;\r\n    fragNormal = vec4(0,0,0, smoothstep(0.2,0.8,f2*f0));\r\n}"},1550:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nvec3 fractal(in vec2 z, in float c, in float width, float radius, int layers){\r\n    float minit=0.;\r\n\tfloat o,ot2,ot=ot2=1000.;\r\n\tfor (int i=0; i<layers; i++) {\r\n\t\tz=abs(z)/clamp(dot(z,z),.1,.5)-c;\r\n        float l=length(z);\r\n        o=min(max(abs(min(z.x,z.y)),-l+radius),abs(l-radius));\r\n\t\tot=min(ot,o);\r\n\t\tot2=min(l*.1,ot2);\r\n\t\tminit=max(minit,float(i)*(1.-abs(sign(ot-o))));\r\n\t}\r\n    float w=width*minit*2.;\r\n    return vec3(minit/float(layers),(w-ot2)/w,1.*(w-ot)/w);\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV*2.-1.;\r\n    vec2 uv0 = uv * 0.5 * 0.16;\r\n    \r\n    vec2 f0 = fractal(uv0, 1.2, .01, 0.2, 4).gb;\r\n    float f1 = fractal(uv0, 1.2, 1.0, 0.0, 6).r;\r\n    float f2 = fractal(uv0, 0.8, 1.0, 0.4, 3).r;\r\n    float f3 = fractal(uv0, 1.0, 1.0, 0.1, 5).r;\r\n\r\n    vec3 color = vec3(0);\r\n    color += 0.6 * vec3(0.2,0.3,0.5) * smoothstep(0.2,1.0,f2/f1);\r\n    color += 0.6 * vec3(0.9,0.5,0.6) * smoothstep(2.0,4.0,f2/f3);\r\n    color = mix(color, vec3(0.2,0.6,0.7), smoothstep(0.2,1.0,f0.y));\r\n    color = mix(color, vec3(1.0,0.6,0.7), smoothstep(0.2,1.0,f0.x));\r\n\r\n    float edge = smoothstep(1.0,0.8,max(abs(uv.x),abs(uv.y))+min(f1,f2));\r\n\r\n#ifdef NORMAL_MAP\r\n    float alpha = 0.5*max(abs(uv.x),abs(uv.y))+0.5*smoothstep(-4.0,4.0,f0.y + f0.x);\r\n    float height = (1.0-.4*max(-1e3,f0.y))*smoothstep(0.5,0.0,f0.x);\r\n    float dhdx = dFdx(height);\r\n    float dhdy = dFdy(height);\r\n    vec3 normal = edge * normalize(vec3(-dhdx, -dhdy, 1));\r\n    fragColor = vec4(0.5+0.5*normal, alpha);\r\n#else\r\n    color *= edge;\r\n    float alpha = .8*smoothstep(0.75, 1.0, length(color))+.2*smoothstep(0.0,0.5,length(color));\r\n    color = vec3(1.,0.6,0.5)*mix(color*2., color*color*4.0, smoothstep(0.5,1.0,f0.x));\r\n    fragColor = vec4(color, alpha);\r\n#endif\r\n}"},8193:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash12(in vec2 src) {\r\n    const uint M = 0x5bd1e995u;\r\n    uint h = 1190494759u;\r\n    uvec2 v = floatBitsToUint(src);    \r\n    v *= M; v ^= v>>24u; v *= M;\r\n    h *= M; h ^= v.x; h *= M; h ^= v.y;\r\n    h ^= h>>13u; h *= M; h ^= h>>15u;\r\n    return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\r\n}\r\nfloat noise2D(in vec2 p, in vec2 period){\r\n    vec4 i = floor(p).xyxy + vec4(0,0,1,1);\r\n    vec2 f = fract(p);\r\n\tvec2 u = f*f*(3.0-2.0*f);\r\n    i = mod(i, period.xyxy);\r\n    return mix( mix( hash12(i.xy), \r\n                     hash12(i.zy), u.x),\r\n                mix( hash12(i.xw), \r\n                     hash12(i.zw), u.x), u.y);\r\n}\r\nfloat fbm(in vec2 x, in int octaves, in vec2 period) {\r\n\tfloat v = 0.0, a = 1.0;\r\n\tvec2 shift = vec2(100);\r\n    const mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\r\n\tfor(int i = 0; i < octaves; ++i){\r\n\t\tv += 0.5 * a * noise2D(x / a, period * a);\r\n        x += shift;\r\n        shift = rot * shift;\r\n\t\ta *= 0.5;\r\n\t}\r\n\treturn v;\r\n}\r\n\r\nvec4 rectangularNoise(in vec2 uv, in vec2 period){\r\n    uv *= period;\r\n    vec2 i = floor(uv);\r\n    vec2 f = uv - i;\r\n    vec2 c = vec2(0);\r\n    int o = int(i.x+i.y) & 1;\r\n    int u = o ^ 1;\r\n    bool s = f[o]>hash12(mod(i,period));\r\n    if(s) c[o] = 1.;\r\n    vec2 n = i;\r\n    n[o] += s ? 1. : -1.;\r\n    if(f[u]>hash12(mod(n,period))) c[u] = 1.;\r\n    c = i+c;\r\n\r\n    vec4 d = vec4(\r\n        hash12(mod(c + vec2(-1,-1), period)), \r\n        hash12(mod(c + vec2( 0,-1), period)), \r\n        hash12(mod(c + vec2( 0, 0), period)), \r\n    \thash12(mod(c + vec2(-1, 0), period))\r\n    );\r\n    o = int(c.x+c.y) & 1;\r\n    if(o==1) d = d.wxyz;\r\n    d = d + vec4(c-1.,c);\r\n    return d;\r\n}\r\n\r\nvoid main(){\r\n#ifdef BOX_STRIPE\r\n    vec2 uv = vUV;\r\n    float alpha = 0.0; float alpha2 = 0.0;\r\n    float scale = 24.0;\r\n    uv.y += 0.2;\r\n    int iterations = 4;\r\n    for(int i = 0; i < iterations; i++){\r\n        vec4 v = rectangularNoise(uv, vec2(scale));\r\n        float y = floor(0.5+uv.y*scale/8.0)*8.0;\r\n    \r\n        alpha += smoothstep(0.5,0.0,min(abs(y-v.y),abs(v.w-y)));\r\n        alpha2 += smoothstep(0.0,0.5,min(y-v.y,v.w-y));\r\n        uv.y += 1.0 / scale;\r\n        uv.x += sin(y + float(i+1));\r\n    }\r\n    alpha*=1.5/float(iterations);\r\n    alpha2*=2.0/float(iterations);\r\n    fragColor = vec4(alpha,alpha2,alpha,alpha);\r\n#else\r\n    vec2 uv = vUV;\r\n\r\n    float fade = smoothstep(1.0,0.5,abs(uv.y*2.-1.));\r\n    vec2 uv0 = vec2(uv.x+uv.y,uv.x-uv.y);\r\n\r\n    uv0 += 0.2*(1.-2.*fbm(uv * vec2(4.0,2.0), 4, vec2(4.0,2.0)));\r\n    uv.x += 0.6*(1.-2.*fbm(uv0 * vec2(4.0,16.0), 4, vec2(4.0,16.0)));\r\n    \r\n    float offset = sin(uv.x*TAU);\r\n    offset -= sin(uv0.y * TAU * 2.0);\r\n    offset += cos(uv0.x * TAU * 1.0);\r\n    float l = .5+.5*cos(uv0.y*TAU*4.0 + offset);\r\n    l = mix(l, pow(l, 8.0), smoothstep(0.5,1.0,abs(uv.y*2.-1.)));\r\n\r\n    vec3 color = smoothstep(0.1,1.0,l) * fade * vec3(0.14,0.08,0.2) / (.08+1.0-l);\r\n    color *= color.r;\r\n    float alpha = color.r;\r\n\r\n    fragColor = vec4(color,alpha);\r\n#endif\r\n}"},5427:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define RESOLUTION 1.0\r\n#define TAU 6.283185307179586\r\n\r\nuvec2 wrap2(in vec2 v, float period){return uvec2(v-period*floor(v/period));}\r\nuint hash(uint x){\r\n    x = (x^(x>>16))*0x7feb352dU;\r\n    x = (x^(x>>15))*0x846ca68bU;\r\n    return (x^(x>>16));\r\n}\r\nvec2 hash22(uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n    n = hash(n);\r\n    return vec2(n*uvec2(0x1U,0x3fffU))*(1.0/float(0xffffffffU));\r\n}\r\nfloat hash21(uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n    n = hash(n);\r\n    return float(n)*(1.0/float(0xffffffffU));\r\n}\r\nfloat gradN2D(in vec2 value, float period){ \r\n    const vec2 ie = vec2(0, 1);\r\n    vec2 p = floor(value);\r\n    vec2 f = fract(value);\r\n    vec2 w = f*f*(3. - 2.*f); \r\n    return .5+.5*mix(mix(\r\n    dot(hash22(wrap2(p + ie.xx,period)), f-ie.xx),\r\n    dot(hash22(wrap2(p + ie.yx,period)), f-ie.yx), w.x),\r\n    mix(dot(hash22(wrap2(p + ie.xy,period)), f-ie.xy),\r\n    dot(hash22(wrap2(p + ie.yy,period)), f-ie.yy), w.x), w.y);\r\n}\r\n\r\nfloat fbm(in vec2 uv, in float period, in int octaves){\r\n    float value = 0.0, scale = 1.0, weight = 0.0;\r\n    for(int i=0;i<octaves;i++){\r\n        float n = gradN2D(uv,period/scale);\r\n        value += abs(1.-2.*n)*scale;\r\n        weight += scale;\r\n        scale *= 0.5;\r\n        uv *= 2.0;\r\n    }\r\n    return value/weight;\r\n}\r\n\r\nfloat tile0(vec2 uv){\r\n    return max(abs(uv.x),-uv.y);\r\n}\r\nfloat tile1(vec2 uv){\r\n    return abs(min(uv.x, uv.y));\r\n}\r\nfloat tile2(vec2 uv){\r\n    return abs(uv.x);\r\n}\r\nfloat tile3(vec2 uv){\r\n    return min(abs(uv.x), max(-uv.x, abs(uv.y)));\r\n}\r\nfloat tile4(vec2 uv){\r\n    return min(abs(uv.x), abs(uv.y));\r\n}\r\nfloat tileMap(in vec2 uv, in float period){\r\n    int tile = 0;\r\n    vec2 id = floor(uv);\r\n    uv = fract(uv)-.5;\r\n    if(hash21(wrap2(id, period)) >= .5)\r\n        tile += 1;\r\n    if(hash21(wrap2(-id, period)) >= .5)\r\n        tile += 8;\r\n    if(hash21(wrap2(id-vec2(0,1), period)) >= .5)\r\n        tile += 4;\r\n    if(hash21(wrap2(-id-vec2(1,0), period)) >= .5)\r\n        tile += 2;\r\n    switch(tile){\r\n        case 0: return 0.5;\r\n        case 1: return tile0(uv);\r\n        case 2: return tile0(uv.yx);\r\n        case 3: return tile1(uv);\r\n        case 4: return tile0(vec2(uv.x,-uv.y));\r\n        case 5: return tile2(uv);\r\n        case 6: return tile1(vec2(uv.x,-uv.y));\r\n        case 7: return tile3(uv);\r\n        case 8: return tile0(vec2(uv.y,-uv.x));\r\n        case 9: return tile1(vec2(-uv.x,uv.y));\r\n        case 10: return tile2(uv.yx);\r\n        case 11: return tile3(uv.yx);\r\n        case 12: return tile1(vec2(-uv.x,-uv.y));\r\n        case 13: return tile3(vec2(-uv.x, uv.y));\r\n        case 14: return tile3(vec2(-uv.y, uv.x));\r\n        case 15: return tile4(uv);\r\n    }\r\n}\r\n\r\nuniform vec2 uScreenSize;\r\nuniform float uTime;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV * RESOLUTION;\r\n    float scale = 8.0;\r\n    \r\n    float n = fbm(uv*scale, scale, 2);\r\n    n *= .5+.5*cos(TAU * (n + uv.y - 0.5*uTime));\r\n    \r\n    float v = tileMap(uv*scale*2.0,scale*2.0);\r\n    v += 0.25*(1.-2.*smoothstep(0.,0.3,n));\r\n    \r\n    vec3 color = vec3(0.1,0.3,0.2);\r\n    color += smoothstep(0.,0.4, 0.4-v) * vec3(0.3,0.4,0.4);\r\n    color += smoothstep(0.,0.8, 0.8-v) * vec3(0.3,0.5,0.4);\r\n    color += smoothstep(0.05,.1, .1-abs(v-0.1)) * vec3(0.2,0.5,0.4);\r\n    color += smoothstep(0.,.2, .1-abs(v-0.3)) * vec3(0.3,0.6,0.7);\r\n    color += smoothstep(0.,0.1,n) * vec3(0.1,0.1,0.2);\r\n\r\n    fragColor = vec4(color,.5+.5*smoothstep(0.5,1.0,color.b));\r\n}"}},t={};!function r(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,r),i.exports}(439)})();