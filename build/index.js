(()=>{var e={9791:e=>{"use strict";e.exports=JSON.parse('{"format":[[{"name":"index","size":1,"type":5123},{"name":"position","size":3,"type":5126,"normalized":false,"stride":24,"offset":0},{"name":"normal","size":3,"type":5122,"normalized":true,"stride":24,"offset":12},{"name":"uv","size":2,"type":5123,"normalized":true,"stride":24,"offset":20}],[{"name":"index","size":1,"type":5123},{"name":"position","size":3,"type":5126,"normalized":false,"stride":32,"offset":0},{"name":"normal","size":3,"type":5122,"normalized":true,"stride":32,"offset":12},{"name":"uv","size":2,"type":5123,"normalized":true,"stride":32,"offset":20},{"name":"joint","size":4,"type":5121,"normalized":false,"stride":32,"offset":24},{"name":"weight","size":4,"type":5121,"normalized":true,"stride":32,"offset":28}]],"buffer":["assets/models.bin"],"texture":["assets/dock.png","assets/cube_0.png","assets/cube_1.png","assets/cube_2.png","assets/cube_3.png","assets/cube_x.png","assets/cube_4.png","assets/cube_5.png","assets/cube_6.png","assets/cube_7.png","assets/cube_8.png","assets/scarab.png","assets/tarantula.png","assets/obelisk.png","assets/monolith.png","assets/stingray.png","assets/locust.png","assets/decapod.png","assets/isopod.png","assets/_0.png"],"model":[{"name":"dock","format":1,"texture":0,"vertices":{"byteOffset":24700,"byteLength":192800},"indices":{"byteOffset":2,"byteLength":24696},"inverseBindPose":{"byteOffset":217504,"byteLength":384},"armature":[{"name":"base","parent":-1},{"name":"frame","position":[0,1,0],"parent":0},{"name":"rod","rotation":[0,0,0,1],"position":[0,1,0],"parent":0},{"name":"lamp","position":[0,1,0],"parent":0},{"name":"handle","position":[0,2,0],"parent":0},{"name":"pump","position":[0,1,0],"parent":0}]},{"name":"cube_0","format":1,"texture":1,"vertices":{"byteOffset":223916,"byteLength":58240},"indices":{"byteOffset":217890,"byteLength":6024},"inverseBindPose":{"byteOffset":282160,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"gun","position":[0,1,0],"parent":0},{"name":"magazine","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-0.1,0.7,0],"parent":1},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.4,0.7,0],"parent":1},{"name":"cover_11","rotation":[1,0,0,0],"position":[0.6,2,-0.6],"parent":0},{"name":"cover_10","rotation":[1,0,0,0],"position":[0.6,2,0.6],"parent":0},{"name":"cover_00","rotation":[1,0,0,0],"position":[-0.6,2,0.6],"parent":0},{"name":"cover_01","rotation":[1,0,0,0],"position":[-0.6,2,-0.6],"parent":0}]},{"name":"cube_1","format":1,"texture":2,"vertices":{"byteOffset":290128,"byteLength":65952},"indices":{"byteOffset":282674,"byteLength":7452},"inverseBindPose":{"byteOffset":356084,"byteLength":576},"armature":[{"name":"base","parent":-1},{"name":"cover_left","position":[0,0.8,-1.3],"parent":0},{"name":"lamp_left","position":[-0.5,1.2,-0.2],"parent":1},{"name":"cover_right","position":[0,0.8,1.3],"parent":0},{"name":"lamp_right","position":[-0.5,1.2,0.2],"parent":3},{"name":"gun","position":[-0.4,0.7,0],"parent":0},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.7,0.7,0],"parent":5},{"name":"bridge","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.3,0.8,0],"parent":5},{"name":"slide","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,1,0],"parent":5}]},{"name":"cube_2","format":1,"texture":3,"vertices":{"byteOffset":371604,"byteLength":149728},"indices":{"byteOffset":356662,"byteLength":14940},"inverseBindPose":{"byteOffset":521336,"byteLength":448},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,1,-1],"parent":0},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,1,1],"parent":0},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[1,1,0],"parent":0},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-1,1,0],"parent":0},{"name":"top","position":[0,2,0],"parent":0},{"name":"lamp","position":[0,2,0],"parent":0}]},{"name":"cube_3","format":1,"texture":4,"vertices":{"byteOffset":533536,"byteLength":95904},"indices":{"byteOffset":521786,"byteLength":11748},"inverseBindPose":{"byteOffset":629444,"byteLength":384},"armature":[{"name":"base","parent":-1},{"name":"top","position":[0,1,0],"parent":0},{"name":"cap","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[0.7,4.4,0],"parent":1},{"name":"lamp_bottom","position":[0,1,0],"parent":1},{"name":"lamp_top","position":[0,2,0],"parent":1},{"name":"rod","position":[0,3,0],"parent":1}]},{"name":"death","format":1,"texture":5,"vertices":{"byteOffset":635880,"byteLength":66848},"indices":{"byteOffset":629830,"byteLength":6048},"inverseBindPose":{"byteOffset":702732,"byteLength":512},"armature":[{"name":"part_100","position":[1.6,-0.6,1.6],"parent":-1},{"name":"part_110","position":[1.6,-0.6,-1.6],"parent":-1},{"name":"part_101","position":[1.6,2.6,1.6],"parent":-1},{"name":"part_111","rotation":[0,0,0,1],"position":[1.6,2.6,-1.6],"parent":-1},{"name":"part_000","position":[-1.6,-0.6,1.6],"parent":-1},{"name":"part_010","position":[-1.6,-0.6,-1.6],"parent":-1},{"name":"part_001","position":[-1.6,2.6,1.6],"parent":-1},{"name":"part_011","rotation":[0,0,0,1],"position":[-1.6,2.6,-1.6],"parent":-1}]},{"name":"cube_open","format":1,"texture":5,"vertices":{"byteOffset":719592,"byteLength":135648},"indices":{"byteOffset":703246,"byteLength":16344},"inverseBindPose":{"byteOffset":855244,"byteLength":320},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,2,-1],"parent":0},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"scale":[1,1,1],"position":[0,2,1],"parent":0},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"position":[1,2,0],"parent":0},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"position":[-1,2,0],"parent":0}]},{"name":"cube_4","format":1,"texture":6,"vertices":{"byteOffset":868284,"byteLength":100128},"indices":{"byteOffset":855566,"byteLength":12714},"inverseBindPose":{"byteOffset":968416,"byteLength":448},"armature":[{"name":"base","parent":-1},{"name":"gun","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,1,0],"parent":0},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.6,1,0],"parent":0},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,1,-1],"parent":0},{"name":"lamp_left","rotation":[0.707107,0,0,0.707107],"position":[0.5,0.5,1],"parent":3},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,1,1],"parent":0},{"name":"lamp_right","rotation":[0,0.707107,0.707107,0],"position":[-0.5,0.5,1],"parent":5}]},{"name":"mine","format":0,"texture":7,"vertices":{"byteOffset":969996,"byteLength":6528},"indices":{"byteOffset":968866,"byteLength":1128}},{"name":"cube_5","format":1,"texture":7,"vertices":{"byteOffset":990712,"byteLength":136384},"indices":{"byteOffset":976526,"byteLength":14184},"inverseBindPose":{"byteOffset":1127100,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"side_01","position":[-1,0.5,-1],"parent":0},{"name":"side_00","position":[-1,0.5,1],"parent":0},{"name":"side_11","position":[1,0.5,-1],"parent":0},{"name":"side_10","position":[1,0.5,1],"parent":0},{"name":"cage","position":[0,1,0],"parent":0},{"name":"rod","position":[0,2,0],"parent":5},{"name":"top","position":[0,-1,0],"parent":0}]},{"name":"cube_6","format":1,"texture":8,"vertices":{"byteOffset":1151628,"byteLength":217248},"indices":{"byteOffset":1127614,"byteLength":24012},"inverseBindPose":{"byteOffset":1368880,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0,-1],"parent":0},{"name":"side_right","rotation":[0.707107,0,0,0.707107],"scale":[1,1,1],"position":[0,0,1],"parent":0},{"name":"top","position":[0,2,0],"parent":0},{"name":"cap","position":[0,1,0],"parent":3},{"name":"rod","position":[0,1,0],"parent":4},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[1,0,0],"parent":0},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-1,0,0],"parent":0}]},{"name":"cube_7","format":1,"texture":9,"vertices":{"byteOffset":1401724,"byteLength":288480},"indices":{"byteOffset":1369394,"byteLength":32328},"inverseBindPose":{"byteOffset":1690208,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"top","position":[0,2.8,0],"parent":0},{"name":"cage","position":[0,-1.2,0],"parent":1},{"name":"cap","position":[0,2.2,0],"parent":1},{"name":"side_11","rotation":[1,0,0,0],"position":[0.7,2.2,-0.7],"parent":0},{"name":"side_10","rotation":[1,0,0,0],"position":[0.7,2.2,0.7],"parent":0},{"name":"side_01","rotation":[1,0,0,0],"position":[-0.7,2.2,-0.7],"parent":0},{"name":"side_00","rotation":[1,0,0,0],"position":[-0.7,2.2,0.7],"parent":0}]},{"name":"cube_8","format":1,"texture":10,"vertices":{"byteOffset":1708700,"byteLength":149920},"indices":{"byteOffset":1690722,"byteLength":17976},"inverseBindPose":{"byteOffset":1858624,"byteLength":448},"armature":[{"name":"base","parent":-1},{"name":"top","position":[0,2.8,0],"parent":0},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0,-1.2],"parent":1},{"name":"gun_left","rotation":[0.707107,0,0,0.707107],"position":[0,1.1,1],"parent":2},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,0,1.2],"parent":1},{"name":"gun_right","rotation":[0,0.707107,0.707107,0],"position":[0,1.1,1],"parent":4},{"name":"cap","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,0,0],"parent":1}]},{"name":"scarab","format":1,"texture":11,"vertices":{"byteOffset":1863360,"byteLength":38304},"indices":{"byteOffset":1859074,"byteLength":4284},"inverseBindPose":{"byteOffset":1901668,"byteLength":256},"armature":[{"name":"base","parent":-1},{"name":"jaw","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,0.5,0],"parent":0},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0.5,-0.2],"parent":0},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,0.5,0.2],"parent":0}]},{"name":"tarantula","format":1,"texture":12,"vertices":{"byteOffset":1928856,"byteLength":243168},"indices":{"byteOffset":1901926,"byteLength":26928},"inverseBindPose":{"byteOffset":2172028,"byteLength":832},"armature":[{"name":"base","parent":-1},{"name":"leg_01","rotation":[-0.325914,0.20498,0.20498,0.899859],"position":[-0.3,0.2,-0.3],"parent":0},{"name":"foot_01","rotation":[-0.746041,0.239051,-0.022346,0.62111],"scale":[1,1,1],"position":[0,0.994987,0],"parent":1},{"name":"leg_11","rotation":[-0.325914,-0.20498,-0.20498,0.899859],"position":[0.3,0.2,-0.3],"parent":0},{"name":"foot_11","rotation":[-0.746041,-0.239051,0.022346,0.62111],"scale":[1,1,1],"position":[0,0.994987,0],"parent":3},{"name":"leg_00","rotation":[0.146064,0.356233,0.356233,0.851388],"position":[-0.3,0.2,0.3],"parent":0},{"name":"foot_00","rotation":[0.743794,-0.663601,0.062032,0.050561],"scale":[1,1,1],"position":[0,0.994988,0],"parent":5},{"name":"leg_10","rotation":[0.146064,-0.356233,-0.356233,0.851388],"position":[0.3,0.2,0.3],"parent":0},{"name":"foot_10","rotation":[0.743794,0.663601,-0.062032,0.050561],"scale":[1,1,1],"position":[0,0.994988,0],"parent":7},{"name":"gun","position":[0,2.1,0],"parent":0},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.2,0.7,-0.1],"parent":9},{"name":"cage","position":[0,4.1,0],"parent":0},{"name":"rod","position":[0,1.2,0],"parent":11}]},{"name":"obelisk","format":1,"texture":13,"vertices":{"byteOffset":2189736,"byteLength":151392},"indices":{"byteOffset":2172862,"byteLength":16872},"inverseBindPose":{"byteOffset":2341132,"byteLength":320},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0.4,-1],"parent":-1},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,0.4,1],"parent":-1},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"position":[1,0.4,0],"parent":-1},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"position":[-1,0.4,0],"parent":-1}]},{"name":"mono_turret","format":0,"texture":14,"vertices":{"byteOffset":2345176,"byteLength":22200},"indices":{"byteOffset":2341454,"byteLength":3720}},{"name":"mono_spawner","format":0,"texture":14,"vertices":{"byteOffset":2372012,"byteLength":30048},"indices":{"byteOffset":2367378,"byteLength":4632}},{"name":"monolith","format":1,"texture":14,"vertices":{"byteOffset":2420996,"byteLength":173024},"indices":{"byteOffset":2402062,"byteLength":18930},"inverseBindPose":{"byteOffset":2594024,"byteLength":384},"armature":[{"name":"base","parent":-1},{"name":"cover_left","rotation":[-0.707107,0,0,0.707107],"position":[0,2.7,-1],"parent":0},{"name":"cover_right","rotation":[0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[0,2.7,1],"parent":0},{"name":"cover_back","rotation":[-0.5,0.5,0.5,0.5],"position":[-1,2.7,0],"parent":0},{"name":"cover_front","rotation":[0.707107,0.707107,0,0],"position":[1,2.7,0],"parent":0},{"name":"rod","position":[0,3.5,0],"parent":0}]},{"name":"stingray","format":1,"texture":15,"vertices":{"byteOffset":2603940,"byteLength":73856},"indices":{"byteOffset":2594410,"byteLength":9528},"inverseBindPose":{"byteOffset":2677800,"byteLength":448},"armature":[{"name":"base","rotation":[-0.5,-0.5,-0.5,0.5],"position":[0,1.3,0],"parent":-1},{"name":"jaw_left","position":[-0.5,1.8,0],"parent":0},{"name":"tail0","rotation":[0,0,1,0],"position":[0,-0.3,0],"parent":0},{"name":"tail1","position":[0,0.825,0],"parent":2},{"name":"tail2","rotation":[0,0,0,1],"position":[0,0.725,0],"parent":3},{"name":"tail3","rotation":[0,0,0,1],"position":[0,0.725,0],"parent":4},{"name":"jaw_right","position":[0.5,1.8,0],"parent":0}]},{"name":"locust","format":1,"texture":16,"vertices":{"byteOffset":2704940,"byteLength":200800},"indices":{"byteOffset":2678250,"byteLength":26688},"inverseBindPose":{"byteOffset":2905744,"byteLength":384},"armature":[{"name":"base","parent":-1},{"name":"cage","position":[-1.3,0.7,0],"parent":0},{"name":"rod","position":[0,1,0],"parent":1},{"name":"gun","rotation":[-0.5,-0.5,-0.5,0.5],"position":[2.5,1.4,0],"parent":0},{"name":"cover_right","position":[0.6,0.3,0.2],"parent":0},{"name":"cover_left","position":[0.6,0.3,-0.2],"parent":0}]},{"name":"decapod","format":1,"texture":17,"vertices":{"byteOffset":2921324,"byteLength":114688},"indices":{"byteOffset":2906130,"byteLength":15192},"inverseBindPose":{"byteOffset":3036016,"byteLength":320},"armature":[{"name":"base","parent":-1},{"name":"side_left","position":[0,0.7,-0.5],"parent":0},{"name":"side_right","position":[0,0.7,0.5],"parent":0},{"name":"gun","position":[0,1.8,0],"parent":0},{"name":"barrel","position":[0,1,0],"parent":3}]},{"name":"isopod","format":1,"texture":18,"vertices":{"byteOffset":3048424,"byteLength":92896},"indices":{"byteOffset":3036338,"byteLength":12084},"inverseBindPose":{"byteOffset":3141324,"byteLength":256},"armature":[{"name":"base","parent":-1},{"name":"cover","rotation":[-0.146447,0.353553,0.353553,0.853554],"scale":[1,1,1],"position":[0.4,1.1,0],"parent":0},{"name":"gun","rotation":[-0.5,-0.5,-0.5,0.5],"position":[0.5,0.7,0],"parent":0},{"name":"barrel","rotation":[0,0,0,1],"position":[0,0.7,0],"parent":2}]}],"decals":[{"x":0,"y":0,"width":128,"height":128,"name":"burn_01"}]}')},7082:e=>{"use strict";e.exports=JSON.parse('{"dock":{"open":[{"frame":0,"index":1,"position":[0,0,0]},{"frame":1,"index":1,"position":[0,2,0],"ease":"quadInOut"},{"frame":0,"index":2,"position":[0,1,0]},{"frame":1,"index":2,"position":[0,0.1,0],"ease":"quadOut"},{"frame":0,"index":3,"position":[0,-0.5,0]},{"frame":1,"index":3,"position":[0,1,0],"ease":"quadInOut"},{"frame":0,"index":4,"position":[0,0,0]},{"frame":0,"index":5,"position":[0,0,0]},{"frame":1,"index":5,"position":[0,-1,0],"ease":"quadOut"}],"lift":[{"frame":0,"index":1,"position":[0,2,0]},{"frame":0.5,"index":1,"position":[0,0,0],"ease":"quadIn"},{"frame":0.25,"index":2,"position":[0,0.1,0]},{"frame":1,"index":2,"position":[0,1,0],"ease":"sineOut"},{"frame":0,"index":3,"position":[0,1,0]},{"frame":0.75,"index":3,"position":[0,0.5,0],"ease":"quadOut"},{"frame":0,"index":4,"position":[0,0,0]},{"frame":1,"index":4,"position":[0,2,0],"ease":"quadIn"},{"frame":0.25,"index":5,"position":[0,-1,0]},{"frame":1,"index":5,"position":[0,1,0],"ease":"sineOut"}]},"cube_open":{"close":[{"frame":0,"index":1,"rotation":[-1,0,0,0]},{"frame":0,"index":2,"rotation":[0,0,1,0]},{"frame":0,"index":3,"rotation":[-0.707107,0,-0.707107,0]},{"frame":0,"index":4,"rotation":[-0.707107,0,0.707107,0]}],"open":[{"frame":0,"index":1,"rotation":[-1,0,0,0]},{"frame":1,"index":1,"rotation":[-0.707107,0,0,0.707107]},{"frame":0,"index":2,"rotation":[0,0,1,0]},{"frame":1,"index":2,"rotation":[0,0.707107,0.707107,0]},{"frame":0,"index":3,"rotation":[-0.707107,0,-0.707107,0]},{"frame":1,"index":3,"rotation":[-0.5,-0.5,-0.5,0.5]},{"frame":0,"index":4,"rotation":[-0.707107,0,0.707107,0]},{"frame":1,"index":4,"rotation":[-0.5,0.5,0.5,0.5]}]},"death":{"open":[]},"cube_0":{"close":[{"frame":0,"index":1,"position":[-0.2,0.2,0]},{"frame":0,"index":2,"position":[0.3,0.7,0]},{"frame":0,"index":3,"position":[-0.2,0.7,0]},{"frame":0,"index":4,"position":[0.1,2,-0.1]},{"frame":0,"index":5,"position":[0.1,2,0.1]},{"frame":0,"index":6,"position":[-0.1,2,0.1]},{"frame":0,"index":7,"position":[-0.1,2,-0.1]}],"open":[{"frame":0,"index":1,"position":[-0.2,0,0]},{"frame":1,"index":1,"position":[0,1,0],"ease":"quadOut"},{"frame":0.5,"index":2,"position":[0.3,0.7,0]},{"frame":1,"index":2,"position":[-0.1,0.7,0],"ease":"quadIn"},{"frame":0.5,"index":3,"position":[-0.2,0.7,0]},{"frame":1,"index":3,"position":[0.4,0.7,0],"ease":"quadIn"},{"frame":0,"index":4,"position":[0.1,2,-0.1]},{"frame":0.5,"index":4,"position":[0.6,2,-0.6],"ease":"sineOut"},{"frame":1,"index":4,"position":[0.6,1.5,-0.6],"ease":"quadIn"},{"frame":0,"index":5,"position":[0.1,2,0.1]},{"frame":0.5,"index":5,"position":[0.6,2,0.6],"ease":"sineOut"},{"frame":1,"index":5,"position":[0.6,1.5,0.6],"ease":"quadIn"},{"frame":0,"index":6,"position":[-0.1,2,0.1]},{"frame":0.5,"index":6,"position":[-0.6,2,0.6],"ease":"sineOut"},{"frame":1,"index":6,"position":[-0.6,1.5,0.6],"ease":"quadIn"},{"frame":0,"index":7,"position":[-0.1,2,-0.1]},{"frame":0.5,"index":7,"position":[-0.6,2,-0.6],"ease":"sineOut"},{"frame":1,"index":7,"position":[-0.6,1.5,-0.6],"ease":"quadIn"}]},"cube_1":{"close":[{"frame":0,"index":1,"position":[0,0.8,-0.3],"rotation":[0,0,0,1]},{"frame":0,"index":2,"position":[-0.5,0.6,-0.2]},{"frame":0,"index":3,"position":[0,0.8,0.3],"rotation":[0,0,0,1]},{"frame":0,"index":4,"position":[-0.5,0.6,0.2]},{"frame":0,"index":5,"position":[0.2,0.7,0]},{"frame":0,"index":6,"position":[-0.5,0.7,0]},{"frame":0,"index":7,"position":[-0.5,0.7,0]},{"frame":0,"index":8,"position":[0,1,0]}],"open":[{"frame":0,"index":1,"position":[0,0.8,-0.3],"rotation":[0,0,0,1]},{"frame":1,"index":1,"position":[0,1,-0.7],"rotation":[-0.382683,0,0,0.92388],"ease":"quadOut"},{"frame":0.5,"index":2,"position":[-0.5,0.6,-0.2]},{"frame":1,"index":2,"position":[-0.5,1.2,-0.2],"ease":"quadOut"},{"frame":0,"index":3,"position":[0,0.8,0.3],"rotation":[0,0,0,1]},{"frame":1,"index":3,"position":[0,1,0.7],"rotation":[0.382683,0,0,0.92388],"ease":"quadOut"},{"frame":0.5,"index":4,"position":[-0.5,0.6,0.2]},{"frame":1,"index":4,"position":[-0.5,1.2,0.2],"ease":"quadOut"},{"frame":0,"index":5,"position":[0.2,-0.5,0]},{"frame":0.5,"index":5,"position":[0.2,0.7,0],"ease":"sineIn"},{"frame":1,"index":5,"position":[-0.4,0.7,0],"ease":"sineOut"},{"frame":0.5,"index":6,"position":[-0.5,0.7,0]},{"frame":1,"index":6,"position":[0.7,0.7,0],"ease":"quadOut"},{"frame":0.5,"index":7,"position":[-0.5,0.7,0]},{"frame":1,"index":7,"position":[0.3,0.7,0],"ease":"quadOut"},{"frame":0,"index":8,"position":[0,1,0]}],"activate":[{"frame":1.2,"index":2,"position":[-0.5,1.2,-0.2]},{"frame":1.6,"index":2,"position":[-0.5,0.8,-0.2],"ease":"cubicOut"},{"frame":3,"index":2,"position":[-0.5,1.2,-0.2],"ease":"sineIn"},{"frame":1.2,"index":4,"position":[-0.5,1.2,0.2]},{"frame":1.6,"index":4,"position":[-0.5,0.8,0.2],"ease":"cubicOut"},{"frame":3,"index":4,"position":[-0.5,1.2,0.2],"ease":"sineIn"},{"frame":0,"index":5,"position":[-0.4,0.7,0]},{"frame":1,"index":5,"position":[-0.6,0.7,0],"ease":"cubicOut"},{"frame":1.4,"index":5,"position":[0,0.7,0],"ease":"quadInOut"},{"frame":3,"index":5,"position":[-0.4,0.7,0],"ease":"sineIn"},{"frame":0,"index":6,"position":[0.7,0.7,0]},{"frame":1.2,"index":6,"position":[1,0.7,0],"ease":"cubicOut"},{"frame":1.6,"index":6,"position":[0.4,0.7,0],"ease":"quadInOut"},{"frame":3,"index":6,"position":[0.7,0.7,0],"ease":"sineIn"},{"frame":1,"index":7,"position":[0.3,0.7,0]},{"frame":1.6,"index":7,"position":[-0.2,0.7,0],"ease":"quadOut"},{"frame":3,"index":7,"position":[0.3,0.7,0],"ease":"quadIn"},{"frame":0.8,"index":8,"position":[0,1,0]},{"frame":1.4,"index":8,"position":[-0.6,1,0],"ease":"quadOut"},{"frame":2,"index":8,"position":[0,1,0],"ease":"quadIn"}]},"cube_2":{"close":[{"frame":0,"index":1,"position":[0,1,1]},{"frame":0,"index":2,"position":[0,1,-1]},{"frame":0,"index":3,"position":[-1,1,0]},{"frame":0,"index":4,"position":[1,1,0]},{"frame":0,"index":5,"position":[0,1,0]},{"frame":0,"index":6,"position":[0,0.8,0]}],"open":[{"frame":0,"index":1,"position":[0,1,1]},{"frame":1,"index":1,"position":[0,1,-1],"ease":"quadInOut"},{"frame":0,"index":2,"position":[0,1,-1]},{"frame":1,"index":2,"position":[0,1,1],"ease":"quadInOut"},{"frame":0,"index":3,"position":[-1,1,0]},{"frame":1,"index":3,"position":[1,1,0],"ease":"quadInOut"},{"frame":0,"index":4,"position":[1,1,0]},{"frame":1,"index":4,"position":[-1,1,0],"ease":"quadInOut"},{"frame":0,"index":5,"position":[0,1,0]},{"frame":0.5,"index":5,"position":[0,2,0],"ease":"quadOut"},{"frame":0,"index":6,"position":[0,0.8,0]},{"frame":1,"index":6,"position":[0,2,0],"ease":"sineIn"}]},"cube_3":{"close":[{"frame":0,"index":1,"position":[0,-2,0]},{"frame":0,"index":2,"position":[0.7,3.9,0],"rotation":[0.5,-0.5,0.5,0.5]},{"frame":0,"index":3,"position":[0,2,0],"rotation":[0,0.382683,0,0.92388]},{"frame":0,"index":4,"position":[0,3,0],"rotation":[0,-0.382683,0,0.92388]},{"frame":0,"index":5,"position":[0,4.5,0]}],"open":[{"frame":0,"index":1,"position":[0,-2,0]},{"frame":1,"index":1,"position":[0,0,0],"ease":"quadOut"},{"frame":0,"index":2,"position":[0.7,3.9,0],"rotation":[0.5,-0.5,0.5,0.5]},{"frame":1,"index":2,"position":[0.7,3.9,0],"rotation":[-0.5,0.5,0.5,0.5],"ease":"sineInOut"},{"frame":0.2,"index":3,"position":[0,1.5,0],"rotation":[0,0.382683,0,0.92388]},{"frame":1,"index":3,"position":[0,1,0],"rotation":[0,0,0,1],"ease":"sineIn"},{"frame":0.2,"index":4,"position":[0,2.5,0],"rotation":[0,-0.382683,0,0.92388]},{"frame":1,"index":4,"position":[0,2,0],"rotation":[0,0,0,1],"ease":"sineIn"},{"frame":0,"index":5,"position":[0,3,0]}],"activate":[{"index":1,"frame":0,"position":[0,0,0]},{"index":1,"frame":0.4,"position":[0,1,0],"ease":"quadInOut"},{"index":1,"frame":0.8,"position":[0,-1,0],"ease":"cubicIn"},{"index":1,"frame":1.8,"position":[0,0,0],"ease":"quadInOut"},{"index":2,"frame":0.6,"position":[0.7,3.9,0]},{"index":2,"frame":0.8,"position":[0.7,3.3,0],"ease":"quartIn"},{"index":2,"frame":1.6,"position":[0.7,3.9,0],"ease":"sineOut"},{"index":3,"frame":0,"position":[0,1,0],"rotation":[0,0,0,1]},{"index":3,"frame":0.5,"rotation":[0,1,0,0],"ease":"sineIn"},{"index":3,"frame":0.8,"rotation":[0,0.382683,0,-0.92388],"ease":"sineOut"},{"index":3,"frame":1.8,"position":[0,1,0],"rotation":[0,0,0,1],"ease":"quadInOut"},{"index":3,"frame":0.4,"position":[0,0,0],"ease":"quadInOut"},{"index":3,"frame":0.8,"position":[0,2,0],"ease":"cubicIn"},{"index":4,"frame":0,"position":[0,2,0],"rotation":[0,0,0,1]},{"index":4,"frame":0.5,"rotation":[0,-1,0,0],"ease":"sineIn"},{"index":4,"frame":0.8,"rotation":[0,-0.382683,0,-0.92388],"ease":"sineOut"},{"index":4,"frame":1.8,"position":[0,2,0],"rotation":[0,0,0,1],"ease":"quadInOut"},{"index":4,"frame":0.4,"position":[0,2,0],"ease":"quadInOut"},{"index":4,"frame":0.8,"position":[0,2.5,0],"ease":"cubicIn"}]},"cube_4":{"close":[{"frame":0,"index":1,"position":[-0.5,1,0],"rotation":[0.5,0.5,-0.5,0.5]},{"frame":0,"index":2,"position":[-0.5,1,0],"rotation":[-0.5,-0.5,0.5,-0.5]},{"frame":0,"index":3,"rotation":[-0.5,-0.5,-0.5,0.5]},{"frame":0,"index":4,"position":[0.5,0.5,0]},{"frame":0,"index":5,"rotation":[-0.5,-0.5,-0.5,0.5]},{"frame":0,"index":6,"position":[-0.5,0.5,0]}],"open":[{"frame":0,"index":1,"position":[-0.7,1,0],"rotation":[0.5,0.5,-0.5,0.5]},{"frame":1,"index":1,"position":[0,1,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"sineIn"},{"frame":0,"index":2,"position":[-0.9,1,0],"rotation":[-0.5,-0.5,0.5,-0.5]},{"frame":1,"index":2,"position":[0.6,1,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"sineIn"},{"frame":0,"index":3,"rotation":[-0.5,-0.5,-0.5,0.5]},{"frame":1,"index":3,"rotation":[-0.707107,0,0,0.707107],"ease":"quadInOut"},{"frame":0.5,"index":4,"position":[0.5,0.5,0]},{"frame":1,"index":4,"position":[0.5,0.5,1],"ease":"quadOut"},{"frame":0,"index":5,"rotation":[-0.5,-0.5,-0.5,0.5]},{"frame":1,"index":5,"rotation":[0,0.707107,0.707107,0],"ease":"quadInOut"},{"frame":0.5,"index":6,"position":[-0.5,0.5,0]},{"frame":1,"index":6,"position":[-0.5,0.5,1],"ease":"quadOut"}]},"cube_5":{"close":[{"frame":0,"index":1,"position":[-0.5,0.5,-0.5]},{"frame":0,"index":2,"position":[-0.5,0.5,0.5]},{"frame":0,"index":3,"position":[0.5,0.5,-0.5]},{"frame":0,"index":4,"position":[0.5,0.5,0.5]},{"frame":0,"index":5,"position":[0,0,0]},{"frame":0,"index":6,"position":[0,-0.02,0]},{"frame":0,"index":7,"position":[0,0,0]}],"open":[{"frame":0,"index":1,"position":[-0.5,0.5,-0.5]},{"frame":0.5,"index":1,"position":[-1,1,-1],"ease":"quadOut"},{"frame":1,"index":1,"position":[-1,0.5,-1],"ease":"quadIn"},{"frame":0,"index":2,"position":[-0.5,0.5,0.5]},{"frame":0.5,"index":2,"position":[-1,1,1],"ease":"quadOut"},{"frame":1,"index":2,"position":[-1,0.5,1],"ease":"quadIn"},{"frame":0,"index":3,"position":[0.5,0.5,-0.5]},{"frame":0.5,"index":3,"position":[1,1,-1],"ease":"quadOut"},{"frame":1,"index":3,"position":[1,0.5,-1],"ease":"quadIn"},{"frame":0,"index":4,"position":[0.5,0.5,0.5]},{"frame":0.5,"index":4,"position":[1,1,1],"ease":"quadOut"},{"frame":1,"index":4,"position":[1,0.5,1],"ease":"quadIn"},{"frame":0.5,"index":5,"position":[0,-0.2,0]},{"frame":1,"index":5,"position":[0,1,0],"ease":"sineOut"},{"frame":0.5,"index":6,"position":[0,-0.5,0]},{"frame":1,"index":6,"position":[0,1,0],"ease":"quadIn"},{"frame":0,"index":7,"position":[0,0,0]},{"frame":0.5,"index":7,"position":[0,-1,0],"ease":"quadIn"}]},"cube_6":{"close":[{"frame":0,"index":1,"rotation":[0,0,0,1]},{"frame":0,"index":2,"rotation":[0,0,0,1]},{"frame":0,"index":6,"rotation":[0,-0.707107,0,0.707107]},{"frame":0,"index":7,"rotation":[0,0.707107,0,0.707107]},{"frame":0,"index":3,"position":[0,0,0]},{"frame":0,"index":4,"position":[0,0,0]},{"frame":0,"index":5,"position":[0,0,0],"scale":[0.5,0.5,0.5]}],"open":[{"frame":0,"index":1,"rotation":[0,0,0,1]},{"frame":1,"index":1,"rotation":[-0.707107,0,0,0.707107],"ease":"quadIn"},{"frame":0,"index":2,"rotation":[0,0,0,1]},{"frame":1,"index":2,"rotation":[0.707107,0,0,0.707107],"ease":"quadIn"},{"frame":0,"index":6,"rotation":[0,-0.707107,0,0.707107]},{"frame":1,"index":6,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quadIn"},{"frame":0,"index":7,"rotation":[0,0.707107,0,0.707107]},{"frame":1,"index":7,"rotation":[-0.5,0.5,0.5,0.5],"ease":"quadIn"},{"frame":0,"index":3,"position":[0,0,0]},{"frame":1,"index":3,"position":[0,2,0],"ease":"sineIn"},{"frame":0,"index":4,"position":[0,0,0]},{"frame":0.5,"index":4,"position":[0,1,0],"ease":"quadOut"},{"frame":0.5,"index":5,"position":[0,-2,0],"scale":[1,1,1]},{"frame":1,"index":5,"position":[0,0.5,0],"ease":"sineIn"}]},"cube_7":{"close":[{"frame":0,"index":1,"position":[0,0.8,0],"scale":[1,0.5,1]},{"frame":0,"index":2,"position":[0,0,0],"rotation":[0,1,0,0]},{"frame":0,"index":3,"position":[0,1,0]},{"frame":0,"index":4,"position":[-0.8,1.5,0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]},{"frame":0,"index":5,"position":[-0.8,1.5,-0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]},{"frame":0,"index":6,"position":[0.8,1.5,0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]},{"frame":0,"index":7,"position":[0.8,1.5,-0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]}],"open":[{"frame":0,"index":1,"position":[0,-0.4,0],"scale":[1,1,1]},{"frame":0.5,"index":1,"position":[0,2.8,0],"ease":"quadOut"},{"frame":1,"index":1,"position":[0,2,0],"ease":"quadIn"},{"frame":0,"index":2,"position":[0,0,0],"rotation":[0,1,0,0]},{"frame":1,"index":2,"position":[0,-1.2,0],"rotation":[0,0,0,1]},{"frame":0,"index":3,"position":[0,1,0]},{"frame":0.5,"index":3,"position":[0,2,0],"ease":"quadOut"},{"frame":0,"index":4,"position":[0.8,-0.25,-0.8],"rotation":[0,0.707107,0,-0.707107],"scale":[1,1,1]},{"frame":0.5,"index":4,"position":[0.4,2.4,-0.4],"ease":"quadOut"},{"frame":0.75,"index":4,"rotation":[1,0,0,0],"ease":"quadInOut"},{"frame":1,"index":4,"position":[0.6,2.2,-0.6],"ease":"quadIn"},{"frame":0,"index":5,"position":[0.8,-0.25,0.8],"rotation":[0,0.707107,0,0.707107],"scale":[1,1,1]},{"frame":0.5,"index":5,"position":[0.4,2.4,0.4],"ease":"quadOut"},{"frame":0.75,"index":5,"rotation":[1,0,0,0],"ease":"quadInOut"},{"frame":1,"index":5,"position":[0.6,2.2,0.6],"ease":"quadIn"},{"frame":0,"index":6,"position":[-0.8,-0.25,-0.8],"rotation":[0,-0.707107,0,-0.707107],"scale":[1,1,1]},{"frame":0.5,"index":6,"position":[-0.4,2.4,-0.4],"ease":"quadOut"},{"frame":0.75,"index":6,"rotation":[1,0,0,0],"ease":"quadInOut"},{"frame":1,"index":6,"position":[-0.6,2.2,-0.6],"ease":"quadIn"},{"frame":0,"index":7,"position":[-0.8,-0.25,0.8],"rotation":[0,-0.707107,0,0.707107],"scale":[1,1,1]},{"frame":0.5,"index":7,"position":[-0.4,2.4,0.4],"ease":"quadOut"},{"frame":0.75,"index":7,"rotation":[1,0,0,0],"ease":"quadInOut"},{"frame":1,"index":7,"position":[-0.6,2.2,0.6],"ease":"quadIn"}],"activate":[{"frame":0,"index":1,"position":[0,2,0],"rotation":[0,0,0,1]},{"frame":0.5,"index":1,"position":[0,1.8,0],"rotation":[0,1,0,0],"ease":"linear"},{"frame":1,"index":1,"position":[0,2,0],"rotation":[0,0,0,-1],"ease":"linear"},{"frame":0,"index":3,"position":[0,2,0],"rotation":[0,0,0,1]},{"frame":0.5,"index":3,"position":[0,2.3,0],"rotation":[0,-1,0,0],"ease":"linear"},{"frame":1,"index":3,"position":[0,2,0],"rotation":[0,0,0,-1],"ease":"linear"}]},"cube_8":{"close":[{"frame":0,"index":1,"position":[0,1,0]},{"frame":0,"index":2,"position":[0,0,0.8],"rotation":[-0.707107,0,0,0.707107]},{"frame":0,"index":3,"position":[0,1.1,-0.3]},{"frame":0,"index":4,"position":[0,0,-0.8],"rotation":[0,0.707107,0.707107,0]},{"frame":0,"index":5,"position":[0,1.1,-0.3]},{"frame":0,"index":6,"position":[0,0.5,0],"rotation":[-0.707107,0,-0.707107,0]}],"open":[{"frame":0,"index":1,"position":[0,1,0]},{"frame":1,"index":1,"position":[0,2.8,0],"ease":"cubicOut"},{"frame":0,"index":2,"position":[0,0,0.8],"rotation":[-0.707107,0,0,0.707107]},{"frame":0.5,"index":2,"position":[0,0,-1],"rotation":[-0.707107,0,0,0.707107],"ease":"quadOut"},{"frame":1,"index":2,"rotation":[-0.5,0.5,-0.5,0.5],"ease":"sineInOut"},{"frame":0.5,"index":3,"position":[0,1.1,-0.3]},{"frame":1,"index":3,"position":[0,1.1,1],"ease":"quadIn"},{"frame":0,"index":4,"position":[0,0,-0.8],"rotation":[0,0.707107,0.707107,0]},{"frame":0.5,"index":4,"position":[0,0,1],"rotation":[0,0.707107,0.707107,0],"ease":"quadOut"},{"frame":1,"index":4,"rotation":[0.5,0.5,0.5,0.5],"ease":"sineInOut"},{"frame":0.5,"index":5,"position":[0,1.1,-0.3]},{"frame":1,"index":5,"position":[0,1.1,1],"ease":"quadIn"},{"frame":0.5,"index":6,"position":[0,0,0],"rotation":[-0.707107,0,-0.707107,0]},{"frame":1,"index":6,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quadIn"}]}}')},2807:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nuniform sampler2D uAlbedoBuffer;\r\nuniform sampler2D uNormalBuffer;\r\nuniform sampler2D uPositionBuffer;\r\n\r\nin vec2 vUV;\r\n\r\nlayout(location=0) out vec4 fragColor;\r\n\r\nuniform LightUniforms {\r\n    vec3 uLightDirection;\r\n    vec3 uSkyColor;\r\n    vec3 uGroundColor;\r\n};\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec3 normal = normalize(texelFetch(uNormalBuffer, fragCoord, 0).xyz);\r\n    vec4 albedo = texelFetch(uAlbedoBuffer, fragCoord, 0);\r\n    float emission = max(0.,2.*albedo.a-1.);\r\n\r\n    vec3 light = mix(uGroundColor, uSkyColor, 0.5 + 0.5 * dot(normal, uLightDirection));\r\n    light = mix(light, vec3(1), emission);\r\n\r\n    fragColor = vec4(light * albedo.rgb, emission);\r\n}"},7847:e=>{e.exports="#version 300 es\r\n\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\n\r\nout vec2 vUV;\r\n\r\nvoid main(){\r\n    gl_Position = vec4(aPosition.xzy, 1.0);\r\n    vUV = 0.5 + 0.5 * aPosition.xz;\r\n}"},7947:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\nprecision highp sampler2DArray;\r\n\r\n#define MAP_SCALE 10.0\r\n\r\nin vec3 vPosition;\r\nin vec3 vNormal; \r\nin vec2 vUV;\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform float uLayer;\r\nuniform sampler2D uDiffuseMap;\r\nuniform sampler2D uNormalMap;\r\n\r\n#ifdef COLOR_INDEX\r\n    uniform sampler2DArray uArrayMap;\r\n    uniform float uArrayMapLayers;\r\n#endif\r\n\r\nlayout(location=0) out vec4 fragPosition;\r\nlayout(location=1) out vec4 fragNormal;\r\nlayout(location=2) out vec4 fragAlbedo;\r\n\r\nvec2 parallaxMapping(in vec2 uv, in vec3 viewDirection, in float heightScale){\r\n#ifndef PARALLAX_LAYERS\r\n    float depth = texture(uNormalMap, uv).w;\r\n    return uv - viewDirection.xy * heightScale * depth / viewDirection.z;\r\n#else\r\n    float numLayers = float(PARALLAX_LAYERS) - float(PARALLAX_LAYERS-1) * abs(dot(vec3(0,0,1), viewDirection));\r\n    float layerDepth = 1.0 / numLayers;\r\n    vec2 deltaUV = heightScale * viewDirection.xy / (viewDirection.z * numLayers);\r\n    float depth = 0.0, value = texture(uNormalMap, uv).w;\r\n    for(int i=0;i<PARALLAX_LAYERS;i++){\r\n        if(value < depth) break;\r\n        uv -= deltaUV;\r\n        value = texture(uNormalMap, uv).w;\r\n        depth += layerDepth;\r\n    }\r\n    vec2 prevUV = uv + deltaUV;\r\n    float depthAfter = value - depth;\r\n    float depthBefore = texture(uNormalMap, prevUV).w - depth + layerDepth;\r\n    float weight = depthAfter / (depthAfter - depthBefore);\r\n    return mix(uv, prevUV, weight);\r\n#endif\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n    vec3 position = vPosition;\r\n    vec3 normal = normalize(vNormal);\r\n\r\n#ifdef NORMAL_MAPPING\r\n    vec3 dpdx = dFdx(position);\r\n    vec3 dpdy = dFdy(position);\r\n    vec2 duvdx = dFdx(uv);\r\n    vec2 duvdy = dFdy(uv);\r\n    vec3 r1 = cross(dpdy, normal);\r\n    vec3 r2 = cross(normal, dpdx);\r\n#ifdef BUMP_MAPPING\r\n    vec3 tangent = r1 * duvdx.x + r2 * duvdy.x;\r\n    vec3 binormal = r1 * duvdx.y + r2 * duvdy.y;\r\n    float invMax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\r\n    mat3 TBN = mat3(tangent * invMax, binormal * invMax, normal);\r\n\r\n    mat3 invTBN = mat3(vec3(TBN[0].x,TBN[1].x,TBN[2].x),vec3(TBN[0].y,TBN[1].y,TBN[2].y),vec3(TBN[0].z,TBN[1].z,TBN[2].z));\r\n    vec3 viewDirection = invTBN * normalize(position - uEyePosition);\r\n    uv = parallaxMapping(uv, viewDirection, 0.1);\r\n\r\n    vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\r\n    normal = normalize(TBN * mappedNormal);\r\n#else\r\n    vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\r\n    vec2 heightGradient = MAP_SCALE * 2.0 * mappedNormal.xy / -mappedNormal.z;\r\n    \r\n    float dhdx = dot(heightGradient, duvdx);\r\n    float dhdy = dot(heightGradient, duvdy);\r\n\r\n    vec3 surfaceGradient = (r1 * dhdx + r2 * dhdy) / dot(dpdx, r1);\r\n    normal = normalize(normal - surfaceGradient);\r\n#endif\r\n#endif\r\n    vec4 diffuse = texture(uDiffuseMap, uv);\r\n    float metallic = 0.5 * smoothstep(0.25, 0.0, diffuse.a);\r\n\r\n#ifdef COLOR_INDEX\r\n    vec2 size = vec2(textureSize(uDiffuseMap, 0));\r\n    float colorIndex = texelFetch(uDiffuseMap, ivec2(uv * size), 0).r;\r\n    float ao = diffuse.g;\r\n    diffuse = texture(uArrayMap, vec3(4.*uv, uArrayMapLayers * colorIndex));\r\n    diffuse.rgb *= ao;\r\n#endif\r\n\r\n    fragPosition = vec4(position, uLayer);\r\n    fragNormal = vec4(normal, metallic);\r\n    fragAlbedo = diffuse;\r\n}"},2119:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n#define PI 3.141592653589793\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n#ifdef OMNILIGHT\r\nuniform LightUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uRadius;\r\n    float uIntensity;\r\n};\r\n#endif\r\n\r\nuniform sampler2D uAlbedoBuffer;\r\nuniform sampler2D uNormalBuffer;\r\nuniform sampler2D uPositionBuffer;\r\n\r\nlayout(location=0) out vec4 fragColor;\r\n\r\n//Normal Distribution Functions\r\nfloat ndfBlinnPhong(in float NdH, in float alpha){\r\n    float n = 2.0 / (alpha * alpha) - 2.0;\r\n    return pow(NdH, n) * (n + 2.0) / (2.0 * PI);\r\n}\r\nfloat ndfPhong(in vec3 L, in vec3 N, in vec3 V, in float alpha){\r\n    vec3 R = reflect(-L, N);\r\n    float VdR = max(0.0, dot(V, R));\r\n    float n = 2.0 / (alpha * alpha) - 2.0;\r\n    return pow(VdR, n) * (n + 2.0) / (2.0 * PI);\r\n}\r\nfloat ndfBeckmann(in float NdH, in float alpha){\r\n    float a2 = alpha*alpha;\r\n    float NdH2 = NdH*NdH;\r\n    return exp((NdH2 - 1.0) / (a2 * NdH2)) / (PI * a2 * NdH2 * NdH2);\r\n}\r\nfloat ndfGGX(in float NdH, in float alpha){\r\n    float a2 = alpha*alpha;\r\n    float denom = (NdH*NdH) * (a2 - 1.0) + 1.0;\r\n    return a2 / (PI * denom * denom);\r\n}\r\n\r\n//Geometric Shadowing Functions\r\nfloat gsfImplicit(in float NdL, in float NdV){return NdL*NdV;}\r\nfloat gsfKalemen(in float NdV, in float NdL, in float alpha){\r\n    const float c = sqrt(2./PI);\r\n    float k = alpha * alpha * c;\r\n    float gH = NdV * k +(1.-k);\r\n\treturn gH * gH * NdL;\r\n}\r\nfloat gsfCookTorrence(in float NdL, in float NdV, in float VdH, in float NdH){\r\n    return min(1., min(2.*NdH*NdV / VdH, 2.*NdH*NdL / VdH));\r\n}\r\nfloat gsfWalter(in float NdL, in float NdV, in float alpha){\r\n    float a2 = alpha*alpha;\r\n    float L = (2.*NdL)/(NdL + sqrt(a2 + (1.-a2) * NdL*NdL));\r\n    float V = (2.*NdV)/(NdV + sqrt(a2 + (1.-a2) * NdV*NdV));\r\n    return L * V;\r\n}\r\nfloat gsfSchlick(in float NdL, in float NdV, in float alpha){\r\n#if defined(BECKMANN)\r\n    float a2 = alpha * alpha;\r\n    float k = a2 * 0.797884560802865;\r\n#elif defined(GGX)\r\n    float k = alpha * 0.5;\r\n#else\r\n    float k = alpha * alpha;\r\n#endif\r\n    float V = NdV / (NdV * (1.0 - k) + k);\r\n    float L = NdL / (NdL * (1.0 - k) + k);\r\n    return V * L;\r\n}\r\n\r\nvec3 fresnelSchlick(vec3 F0, float cosTheta){\r\n    return mix(F0, vec3(1.0), pow(1.0 - cosTheta, 5.0));\r\n}\r\nvec3 fresnelSchlick(vec3 F0, float cosTheta, float roughness){\r\n    return mix(F0, max(vec3(1.0-roughness), F0), pow(1.0 - cosTheta, 5.0));\r\n}\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec3 position = texelFetch(uPositionBuffer, fragCoord, 0).xyz;\r\n    vec4 normal = texelFetch(uNormalBuffer, fragCoord, 0);\r\n    vec4 albedo = texelFetch(uAlbedoBuffer, fragCoord, 0);\r\n    float emission = max(0.,2.*albedo.a-1.);\r\n    float roughness = clamp(2.*albedo.a,0.04,1.0);\r\n    float metalness = normal.a;\r\n\r\n#ifdef OMNILIGHT\r\n    vec3 lightPosition = vec3(uModelMatrix[3]);\r\n    float attenuation = smoothstep(-uRadius, 0.0, -length(lightPosition - position));\r\n    vec3 light = attenuation * uIntensity * uColor.rgb;\r\n    light = mix(light,vec3(0),emission);\r\n#endif\r\n\r\n    vec3 N = normalize(normal.xyz);\r\n    vec3 V = normalize(uEyePosition - position);\r\n    vec3 L = normalize(lightPosition - position);\r\n    vec3 H = normalize(L + V);\r\n\r\n    float NdL = max(0.001, dot(N, L));\r\n    float NdV = max(0.001, dot(N, V));\r\n    float NdH = max(0.001, dot(N, H));\r\n    float HdV = max(0.001, dot(H, V));\r\n\r\n    vec3 F0 = mix(vec3(0.04), albedo.rgb, metalness);\r\n    float alpha = roughness*roughness;\r\n\r\n#ifdef PHONG\r\n    vec3 F = fresnelSchlick(F0, NdV);\r\n#else\r\n    vec3 F = fresnelSchlick(F0, HdV);\r\n#endif\r\n#if defined(BLINN)\r\n    float D = ndfBlinnPhong(NdH, alpha);\r\n#elif defined(PHONG)\r\n    float D = ndfPhong(N, L, V, alpha);\r\n#elif defined(BECKMANN)\r\n    float D = ndfBeckmann(NdH, alpha);\r\n#elif defined(GGX)\r\n    float D = ndfGGX(NdH, alpha);\r\n#endif\r\n\r\n#if defined(SCHLICK)\r\n    float G = gsfSchlick(NdL, NdV, alpha);\r\n#elif defined(KALEMEN)\r\n    float G = gsfKalemen(NdV, NdL, alpha);\r\n#elif defined(WALTER)\r\n    float G = gsfWalter(NdL, NdV, alpha);\r\n#else\r\n    float G = gsfImplicit(NdL, NdV);\r\n#endif\r\n    vec3 specular = (F * D * G) / (4.0 * NdL * NdV);\r\n    vec3 diffuse = albedo.rgb * mix(vec3(1.0) - F, vec3(0.0), metalness);\r\n\r\n    fragColor = vec4(NdL*light*(diffuse+specular),0.);\r\n}"},3801:e=>{e.exports="#version 300 es\r\n\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform LightUniforms {\r\n    mat4 uModelMatrix;\r\n    vec4 uColor;\r\n    float uRadius;\r\n    float uIntensity;\r\n};\r\n\r\nvoid main(){\r\n    gl_Position = uViewProjectionMatrix * uModelMatrix * vec4(aPosition * uRadius, 1.0);\r\n}"},7064:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec4 vColor;\r\nin vec4 vMaterial;\r\n\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSamplers[MAX_TEXTURE_UNITS];\r\n\r\nvoid main(){\r\n    int tex = int(vMaterial.a);\r\n    vec4 color = vec4(0);\r\n    switch(tex){\r\n#FOR        case #i:color=texture(uSamplers[#i],vUV);break;\r\n    }\r\n    fragColor = vColor * color;\r\n}"},7023:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec2 aPosition;\r\nlayout(location=1) in vec2 aUV;\r\nlayout(location=2) in vec4 aColor;\r\nlayout(location=3) in vec4 aMaterial;\r\n\r\nuniform mat3 uProjectionMatrix;\r\n\r\nout vec2 vUV;\r\nout vec4 vColor;\r\nout vec4 vMaterial;\r\n\r\nvoid main(){\r\n    gl_Position = vec4((uProjectionMatrix * vec3(aPosition,1.)).xy,0.,1.);\r\n    vUV = aUV;\r\n    vColor = aColor;\r\n    vMaterial = aMaterial + vec4(0,0,0,.5);\r\n}"},7676:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec3 vPosition;\r\nin vec4 vColor;\r\nin vec3 vDomain;\r\nin float vMaterial;\r\n\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSamplers[MAX_TEXTURE_UNITS];\r\n\r\nvoid main(){\r\n    int tex = int(vMaterial);\r\n    vec4 color = vec4(0);\r\n    switch(tex){\r\n#FOR        case #i:color=texture(uSamplers[#i],vUV);break;\r\n    }\r\n    fragColor = color * vColor;\r\n}"},898:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\nlayout(location=1) in vec2 aUV;\r\nlayout(location=2) in vec4 aColor;\r\nlayout(location=3) in vec3 aDomain;\r\nlayout(location=4) in float aMaterial;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nout vec2 vUV;\r\nout vec3 vPosition;\r\nout vec4 vColor;\r\nout vec3 vDomain;\r\nout float vMaterial;\r\n\r\nvoid main(){\r\n    vUV = aUV;\r\n    vPosition = aPosition;\r\n    vColor = aColor;\r\n    vDomain = aDomain;\r\n    vMaterial = aMaterial + .5;\r\n    gl_Position = uViewProjectionMatrix * vec4(aPosition, 1.0);\r\n}"},452:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\n#ifndef POINT\r\nin vec2 vUV;\r\nin vec4 vUVClamp;\r\n#endif\r\nin vec2 vLife;\r\nin vec3 vPosition;\r\n\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\nuniform sampler2D uGradient;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\n#ifdef SOFT\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform sampler2D uPositionBuffer;\r\n#endif\r\n\r\nvoid main(void){\r\n#ifdef POINT\r\n    vec2 uv = gl_PointCoord;\r\n    const vec4 vUVClamp = vec4(0,0,1,1);\r\n#else\r\n    vec2 uv = vUV;\r\n#endif\r\n\r\n#ifdef UV_OFFSET\r\n    float offsetScale = UV_OFFSET;\r\n    vec4 color = texture(uSampler, uv - offsetScale * uTime.x + vLife.y);\r\n    color *= 4.0 * texture(uSampler, 2.0 * uv + 2.0 * offsetScale * uTime.x + vLife.y);\r\n#else\r\n    vec4 color = texture(uSampler, uv);\r\n#endif\r\n\r\n#if defined(GRADIENT)\r\n    color = texture(uGradient, vec2(vLife.x, color.a));\r\n#elif defined(SWIPE)\r\n    vec2 uv0 = (uv - vUVClamp.xy) / (vUVClamp.zw - vUVClamp.xy);\r\n    color *= smoothstep(0.5+SWIPE,0.5,abs(uv0.x-.5 + mix(-1.0,1.0,vLife.x)));\r\n#else\r\n    color *= 4.*vLife.x*(1.-vLife.x);\r\n#endif\r\n#ifdef MASK\r\n    color *= smoothstep(1.0,0.5,length(2.*uv-1.));\r\n#endif\r\n\r\n#ifdef SOFT\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    float difference = length(position.xyz - uEyePosition) - length(vPosition - uEyePosition);\r\n    color.a *= smoothstep(0.0, 0.5, difference);\r\n#endif\r\n    fragColor = color;\r\n}"},125:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec4 aLifetime;\r\nlayout(location=1) in vec4 aSize;\r\nlayout(location=2) in vec4 aTransform;\r\nlayout(location=3) in vec4 aVelocity;\r\nlayout(location=4) in vec4 aAcceleration;\r\n#ifndef POINT\r\nlayout(location=5) in vec3 aPosition;\r\nlayout(location=6) in vec2 aUV;\r\nout vec2 vUV;\r\nout vec4 vUVClamp;\r\n#endif\r\n\r\nout vec2 vLife;\r\nout vec3 vPosition;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nmat2 rotate(in float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\r\n\r\nvoid main(){\r\n    vLife = vec2(clamp(aLifetime.x * aLifetime.y, 0.0, 1.0), aLifetime.z);\r\n    float size = aSize.y * step(0.,aLifetime.x)*step(aLifetime.x*aLifetime.y,1.);\r\n\r\n#ifdef POINT\r\n    gl_PointSize = size;\r\n    vPosition = aTransform.xyz;\r\n#else\r\n    vec3 position = vec3(rotate(aTransform.w) * aPosition.xy, aPosition.z);\r\n#if defined(ALIGNED)\r\n    vec3 view = normalize(aTransform.xyz - uEyePosition);\r\n    vec3 direction = -normalize(aVelocity.xyz);\r\n    vec3 up = cross(view, direction);\r\n    vec3 right = cross(view, up);\r\n    view = cross(right, up);\r\n    mat3 matrix = mat3(right, up, view);\r\n    position = size * matrix * position;\r\n#ifdef STRETCH\r\n    position += dot(position, aVelocity.xyz) * aVelocity.xyz * STRETCH;\r\n#endif\r\n\r\n#elif defined(CYLINDRICAL)\r\n    vec3 right = vec3(uViewMatrix[0][0], uViewMatrix[1][0], uViewMatrix[2][0]);\r\n    vec3 up = vec3(0,1,0);\r\n    position = size * (right * position.x + up * position.y);\r\n#elif defined(SPHERICAL)\r\n    vec3 right = vec3(uViewMatrix[0][0], uViewMatrix[1][0], uViewMatrix[2][0]);\r\n    vec3 up = vec3(uViewMatrix[0][1], uViewMatrix[1][1], uViewMatrix[2][1]);\r\n    position = size * (right * position.x + up * position.y);\r\n#ifdef STRETCH\r\n    vec3 viewVelocity = (uViewMatrix * vec4(aVelocity.xyz,0.0)).xyz;\r\n    position += dot(position, aVelocity.xyz) * aVelocity.xyz * STRETCH;\r\n#endif\r\n\r\n#else\r\n    position = size * position.xzy * vec3(1,1,-1);\r\n#endif\r\n    vPosition = position + aTransform.xyz;\r\n#ifdef FRAMES\r\n    float uvSize = 1.0/aSize.w; float uvFrame = mod(floor(aSize.z),aSize.w*aSize.w);\r\n    vec2 uvTile = vec2(mod(uvFrame, aSize.w), floor(uvFrame * uvSize)) * uvSize;\r\n    vUVClamp = vec4(uvTile, uvTile + uvSize);\r\n    vUV = uvTile + uvSize * aUV;\r\n#else\r\n    vUV = aUV;\r\n    vUVClamp = vec4(0,0,1,1);\r\n#endif\r\n#endif\r\n    gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\r\n}"},9533:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nin vec3 vPosition;\r\n#ifdef INSTANCED\r\nin mat4 vInvModel;\r\nin vec4 vUV;\r\nin vec4 vColor;\r\nin float vThreshold;\r\n#else\r\nuniform vec4 uColor;\r\nuniform mat4 uModelMatrix;\r\nuniform mat4 uInvModelMatrix;\r\n#endif\r\n\r\nuniform float uDissolveEdge;\r\nuniform float uLayer;\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform sampler2D uDiffuseMap;\r\nuniform sampler2D uNormalMap;\r\nuniform sampler2D uPositionBuffer;\r\n\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec3 viewRay = vPosition.xyz - uEyePosition;\r\n    vec4 worldPosition = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    if(worldPosition.a > uLayer) discard;\r\n    vec4 objectPosition = vInvModel * vec4(worldPosition.xyz, 1.0);\r\n    if(0.5 < abs(objectPosition.x) || 0.5 < abs(objectPosition.y) || 0.5 < abs(objectPosition.z)) discard;\r\n    vec2 uv = mix(vUV.xy, vUV.zw, objectPosition.xz + 0.5);\r\n    vec4 color = texture(uDiffuseMap, uv);\r\n    fragAlbedo = vColor * color;\r\n#ifdef NORMAL_MAPPING\r\n    vec3 dpdx = dFdx(worldPosition.xyz);\r\n    vec3 dpdy = dFdy(worldPosition.xyz);\r\n    vec3 normal = normalize(cross(dpdx, dpdy));\r\n    vec3 binormal = normalize(dpdx);\r\n    vec3 tangent = normalize(dpdy);\r\n    mat3 TBN = mat3(tangent, binormal, normal);\r\n\r\n    vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\r\n    float blend = dot(mappedNormal, mappedNormal);\r\n    mappedNormal = normalize(TBN * mappedNormal);\r\n    fragNormal = blend * vec4(mappedNormal, 1.0);\r\n#else\r\n    fragNormal = vec4(0);\r\n#endif\r\n\r\n#ifdef MASK\r\n    float alpha = texture(uNormalMap, uv).a;\r\n    float threshold = smoothstep(1.0+uDissolveEdge,1.0,abs(alpha*2.-1.+vThreshold));\r\n    fragAlbedo *= threshold;\r\n    fragNormal *= threshold;\r\n#endif\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//In any case, here are the shader snippets for when I construct the tangent space based on the depth buffer:\r\n\r\n// These ones are hard-edges, but orientated to the scene geometry.\r\n//float3 pixelNormal = normalize(cross(ddy(worldPosition), ddx(worldPosition)));\r\n//float3x3 tbn = cotangent_frame(pixelNormal, worldPosition, decalTexCoord);\r\n\r\n// So now we can sample from the normal map, and turn it into a world normal, which we then encode.\r\n//float3 normal = mul(normalMap.xyz, tbn);\r\n//normal = normalize(normal); // this is the worldspace normal\r\n\r\n//and then:\r\n\r\n// N is the vertex normal.\r\n// uv is the texcoord for the decal.\r\n// p is the worldspace position.\r\n//float3x3 cotangent_frame(float3 N, float3 p, float2 uv)\r\n//{\r\n// get edge vectors of the pixel triangle\r\n//float3 dp1 = ddx(p);\r\n//float3 dp2 = ddy(p);\r\n//float2 duv1 = ddx(uv);\r\n//float2 duv2 = ddy(uv);\r\n\r\n// solve the linear system\r\n//float3 dp2perp = cross(dp2, N);\r\n//float3 dp1perp = cross(N, dp1);\r\n//float3 T = dp2perp * duv1.x + dp1perp * duv2.x;\r\n//float3 B = dp2perp * duv1.y + dp1perp * duv2.y;\r\n\r\n// construct a scale-invariant frame\r\n//float invmax = rsqrt(max(dot(T,T), dot(B,B)));\r\n//return float3x3(T * invmax, B * invmax, N);\r\n//}"},903:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\n#ifdef INSTANCED\r\nlayout(location=1) in mat4 aModelMatrix;\r\nlayout(location=5) in vec4 aUV;\r\nlayout(location=6) in vec4 aColor;\r\n\r\nout vec3 vPosition;\r\nout mat4 vInvModel;\r\nout vec4 vUV;\r\nout vec4 vColor;\r\nout float vThreshold;\r\n#else\r\nuniform mat4 uModelMatrix;\r\n#endif\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nvoid main(){\r\n    mat4 modelMatrix = aModelMatrix;\r\n    modelMatrix[0][3]=0.0;modelMatrix[1][3]=0.0;modelMatrix[2][3]=0.0;modelMatrix[3][3]=1.0;\r\n    vPosition = (modelMatrix * vec4(aPosition, 1.0)).xyz;\r\n    vInvModel = inverse(modelMatrix);\r\n    vThreshold = aModelMatrix[0][3];\r\n    vUV = aUV;\r\n    vColor = aColor;\r\n    gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\r\n}"},400:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec3 vPosition;\r\nin vec4 vColor;\r\nin vec3 vDomain;\r\nin float vMaterial;\r\n\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uAlbedoBuffer;\r\nuniform sampler2D uSampler;\r\n\r\nvoid main(){\r\n    vec4 color = vColor * texture(uSampler,vUV);\r\n    float height = color.r;\r\n    vec2 duvdx = dFdx(vUV);\r\n    vec2 duvdy = dFdy(vUV);\r\n    float dhdx = dFdx(height) / length(duvdx);\r\n    float dhdy = dFdy(height) / length(duvdy);\r\n    vec2 distortion = 0.01 * color.a * vec2(dhdx, dhdy);\r\n\r\n    vec2 uv = vec2(gl_FragCoord.xy) / vec2(textureSize(uAlbedoBuffer, 0));\r\n    uv += distortion;\r\n    fragColor = texture(uAlbedoBuffer, uv);\r\n}"},594:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define LOG2 1.4426950408889634\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nuniform sampler2D uSampler;\r\nuniform sampler2D uPositionBuffer;\r\n#ifdef BLOOM\r\nuniform sampler2D uBloomMap;\r\nuniform vec4 uBloomMask;\r\n#endif\r\n\r\n#if defined(LINEAR_FOG)\r\nuniform vec4 uFogColor;\r\nuniform vec2 uFogRange;\r\n#elif defined(EXPONENTIAL_FOG)\r\nuniform vec4 uFogColor;\r\nuniform float uFogDensity;\r\n#endif\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec4 color = texelFetch(uSampler, fragCoord, 0);\r\n\r\n    vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    color = mix(color, uFogColor, step(position.a,.5));\r\n    float distance = length(position.xyz - uEyePosition);\r\n#if defined(LINEAR_FOG)\r\n    float fogAmount = smoothstep(uFogRange.x, uFogRange.y, distance);\r\n    color = mix(color, uFogColor, fogAmount);\r\n#elif defined(EXPONENTIAL_FOG)\r\n    float fogAmount = clamp(1. - exp2(-uFogDensity*uFogDensity * distance*distance * LOG2)),0.,1.);\r\n    color = mix(color, uFogColor, fogAmount);\r\n#endif\r\n\r\n#ifdef BLOOM\r\n    vec4 bloom = uBloomMask * texture(uBloomMap, vUV);\r\n    color += bloom;\r\n#endif\r\n    fragColor = color;\r\n}"},6332:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\nuniform vec4 uMask;\r\n\r\nvoid main(){\r\n#ifdef NEAREST\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    fragColor = uMask * texelFetch(uSampler, fragCoord, 0);\r\n#else\r\n    fragColor = uMask * texture(uSampler, vUV);\r\n#endif\r\n}"},5316:e=>{e.exports="#version 300 es\r\n\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\n\r\nout vec2 vUV;\r\n\r\nvoid main(){\r\n    gl_Position = vec4(aPosition.xzy, 1.0);\r\n    vUV = 0.5 + 0.5 * aPosition.xz;\r\n}"},8706:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\nuniform vec2 uSize;\r\n\r\nvoid main(){\r\n    vec4 color = vec4(0);\r\n    vec2 offset = uSize / vec2(textureSize(uSampler, 0));\r\n\r\n#if KERNEL_SIZE == 13\r\n    vec2 off1 = vec2(1.411764705882353) * offset;\r\n    vec2 off2 = vec2(3.2941176470588234) * offset;\r\n    vec2 off3 = vec2(5.176470588235294) * offset;\r\n    color += texture(uSampler, vUV) * 0.1964825501511404;\r\n    color += texture(uSampler, vUV + off1) * 0.2969069646728344;\r\n    color += texture(uSampler, vUV - off1) * 0.2969069646728344;\r\n    color += texture(uSampler, vUV + off2) * 0.09447039785044732;\r\n    color += texture(uSampler, vUV - off2) * 0.09447039785044732;\r\n    color += texture(uSampler, vUV + off3) * 0.010381362401148057;\r\n    color += texture(uSampler, vUV - off3) * 0.010381362401148057;\r\n#elif KERNEL_SIZE == 9\r\n    vec2 off1 = vec2(1.3846153846) * offset;\r\n    vec2 off2 = vec2(3.2307692308) * offset;\r\n    color += texture(uSampler, vUV) * 0.2270270270;\r\n    color += texture(uSampler, vUV + off1) * 0.3162162162;\r\n    color += texture(uSampler, vUV - off1) * 0.3162162162;\r\n    color += texture(uSampler, vUV + off2) * 0.0702702703;\r\n    color += texture(uSampler, vUV - off2) * 0.0702702703;\r\n#elif KERNEL_SIZE == 5\r\n    vec2 off1 = vec2(1.3333333333333333) * offset;\r\n    color += texture(uSampler, vUV) * 0.29411764705882354;\r\n    color += texture(uSampler, vUV + off1) * 0.35294117647058826;\r\n    color += texture(uSampler, vUV - off1) * 0.35294117647058826;\r\n#endif\r\n\r\n    fragColor = color;\r\n}"},6148:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\nprecision highp sampler2DArray;\r\n\r\n#define MAP_SCALE 10.0\r\n\r\nin vec3 vPosition;\r\nin vec3 vNormal; \r\nin vec2 vUV;\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform float uLayer;\r\nuniform sampler2D uDiffuseMap;\r\nuniform sampler2D uNormalMap;\r\n\r\n#ifdef COLOR_INDEX\r\n    uniform sampler2DArray uArrayMap;\r\n    uniform float uArrayMapLayers;\r\n#endif\r\n\r\nlayout(location=0) out vec4 fragPosition;\r\nlayout(location=1) out vec4 fragNormal;\r\nlayout(location=2) out vec4 fragAlbedo;\r\n\r\nvec2 parallaxMapping(in vec2 uv, in vec3 viewDirection, in float heightScale){\r\n#ifndef PARALLAX_LAYERS\r\n    float depth = texture(uNormalMap, uv).w;\r\n    return uv - viewDirection.xy * heightScale * depth / viewDirection.z;\r\n#else\r\n    float numLayers = float(PARALLAX_LAYERS) - float(PARALLAX_LAYERS-1) * abs(dot(vec3(0,0,1), viewDirection));\r\n    float layerDepth = 1.0 / numLayers;\r\n    vec2 deltaUV = heightScale * viewDirection.xy / (viewDirection.z * numLayers);\r\n    float depth = 0.0, value = texture(uNormalMap, uv).w;\r\n    for(int i=0;i<PARALLAX_LAYERS;i++){\r\n        if(value < depth) break;\r\n        uv -= deltaUV;\r\n        value = texture(uNormalMap, uv).w;\r\n        depth += layerDepth;\r\n    }\r\n    vec2 prevUV = uv + deltaUV;\r\n    float depthAfter = value - depth;\r\n    float depthBefore = texture(uNormalMap, prevUV).w - depth + layerDepth;\r\n    float weight = depthAfter / (depthAfter - depthBefore);\r\n    return mix(uv, prevUV, weight);\r\n#endif\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n    vec3 position = vPosition;\r\n    vec3 normal = normalize(vNormal);\r\n\r\n#ifdef NORMAL_MAPPING\r\n    vec3 dpdx = dFdx(position);\r\n    vec3 dpdy = dFdy(position);\r\n    vec2 duvdx = dFdx(uv);\r\n    vec2 duvdy = dFdy(uv);\r\n    vec3 r1 = cross(dpdy, normal);\r\n    vec3 r2 = cross(normal, dpdx);\r\n#ifdef BUMP_MAPPING\r\n    vec3 tangent = r1 * duvdx.x + r2 * duvdy.x;\r\n    vec3 binormal = r1 * duvdx.y + r2 * duvdy.y;\r\n    float invMax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\r\n    mat3 TBN = mat3(tangent * invMax, binormal * invMax, normal);\r\n\r\n    mat3 invTBN = mat3(vec3(TBN[0].x,TBN[1].x,TBN[2].x),vec3(TBN[0].y,TBN[1].y,TBN[2].y),vec3(TBN[0].z,TBN[1].z,TBN[2].z));\r\n    vec3 viewDirection = invTBN * normalize(position - uEyePosition);\r\n    uv = parallaxMapping(uv, viewDirection, 0.1);\r\n\r\n    vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\r\n    normal = normalize(TBN * mappedNormal);\r\n#else\r\n    vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\r\n    vec2 heightGradient = MAP_SCALE * 2.0 * mappedNormal.xy / -mappedNormal.z;\r\n    \r\n    float dhdx = dot(heightGradient, duvdx);\r\n    float dhdy = dot(heightGradient, duvdy);\r\n\r\n    vec3 surfaceGradient = (r1 * dhdx + r2 * dhdy) / dot(dpdx, r1);\r\n    normal = normalize(normal - surfaceGradient);\r\n#endif\r\n#endif\r\n    vec4 diffuse = texture(uDiffuseMap, uv);\r\n    float metallic = 0.5 * smoothstep(0.25, 0.0, diffuse.a);\r\n\r\n#ifdef COLOR_INDEX\r\n    vec2 size = vec2(textureSize(uDiffuseMap, 0));\r\n    float colorIndex = texelFetch(uDiffuseMap, ivec2(uv * size), 0).r;\r\n    float ao = diffuse.g;\r\n    diffuse = texture(uArrayMap, vec3(4.*uv, uArrayMapLayers * colorIndex));\r\n    diffuse.rgb *= ao;\r\n#endif\r\n\r\n    fragPosition = vec4(position, uLayer);\r\n    fragNormal = vec4(normal, metallic);\r\n    fragAlbedo = diffuse;\r\n}"},373:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\nlayout(location=1) in vec3 aNormal;\r\nlayout(location=2) in vec2 aUV;\r\n#ifdef SKINNING\r\nlayout(location=3) in vec4 aJoint;\r\nlayout(location=4) in vec4 aWeight;\r\n\r\nuniform vec4 uBoneMatrix[64];\r\n\r\nmat4 boneMatrix(uint joint){\r\n    vec4 col0 = uBoneMatrix[joint*3U+0U];\r\n    vec4 col1 = uBoneMatrix[joint*3U+1U];\r\n    vec4 col2 = uBoneMatrix[joint*3U+2U];\r\n    return mat4(col0[0], col1[0], col2[0], 0.0,\r\n        col0[1], col1[1], col2[1], 0.0,\r\n        col0[2], col1[2], col2[2], 0.0,\r\n        col0[3], col1[3], col2[3], 1.0);\r\n}\r\n#endif\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform mat4 uModelMatrix;\r\n\r\nout vec3 vPosition;\r\nout vec3 vNormal;\r\nout vec2 vUV;\r\n\r\nvoid main(){\r\n#ifdef SKINNING\r\n    mat4 skinMatrix =\r\n        aWeight.x * boneMatrix(uint(aJoint.x)) +\r\n        aWeight.y * boneMatrix(uint(aJoint.y)) +\r\n        aWeight.z * boneMatrix(uint(aJoint.z)) +\r\n        aWeight.w * boneMatrix(uint(aJoint.w));\r\n    mat4 modelTransform = uModelMatrix * skinMatrix;\r\n#else\r\n    mat4 modelTransform = uModelMatrix;\r\n#endif\r\n    vPosition = (modelTransform * vec4(aPosition, 1.0)).xyz;\r\n    vNormal = (modelTransform * vec4(aNormal, 0.0)).xyz;\r\n    vUV = aUV;\r\n    gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\r\n}"},8208:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\n\r\nfloat hash11(in float u){\r\n    uint n = floatBitsToUint(u);\r\n    n = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & 0x7fffffffU)/float(0x7fffffff);\r\n}\r\nfloat hash21(in vec2 uv){\r\n    uvec2 q = floatBitsToUint(uv);\r\n    q = 1103515245u * ((q >> 1u) ^ q.yx);\r\n    uint n = 1103515245u * (q.x ^ (q.y >> 3u));\r\n    return float(n) * (1.0 / float(0xffffffffu));\r\n}\r\nvec2 hash22(in vec2 uv){\r\n    uvec4 q = floatBitsToUint(uv).xyyx;\r\n    q = 1103515245u * ((q >> 1u) ^ q.yxwz);\r\n    uvec2 n = 1103515245u * (q.xz ^ (q.yw >> 3u));\r\n    return vec2(n) * (1.0 / float(0xffffffffu));\r\n}\r\nfloat noise11(in float u, in float period, float seed){\r\n    u *= period;\r\n    vec2 i = mod(floor(vec2(u,u+1.0)),vec2(period))+seed;\r\n    float f = fract(u);\r\n    return mix(hash11(i.x),hash11(i.y),f);\r\n}\r\nfloat noise21(in vec2 uv, in vec2 period, float seed){\r\n    uv *= period;\r\n    vec4 i = mod(floor(uv).xyxy+vec2(0,1).xxyy,period.xyxy)+seed;\r\n    vec2 f = fract(uv); f = f*f*f*(f*(f*6.0-15.0)+10.0);\r\n    return mix(mix(hash21(i.xy), \r\n                   hash21(i.zy), f.x),\r\n               mix(hash21(i.xw), \r\n                   hash21(i.zw), f.x), f.y);\r\n}\r\nvec3 noise21d(in vec2 uv, in vec2 period, float seed){\r\n    uv *= period;\r\n    vec4 i = mod(floor(uv).xyxy+vec2(0,1).xxyy,period.xyxy)+seed;\r\n    vec2 u = fract(uv);\r\n    vec2 du = 30.0 * u * u * (u * (u - 2.0) + 1.0);\r\n    u = u*u*u*(u*(u*6.0-15.0)+10.0);\r\n    float a = hash21(i.xy);\r\n    float b = hash21(i.zy);\r\n    float c = hash21(i.xw);\r\n    float d = hash21(i.zw);\r\n    float abcd = a - b - c + d;\r\n    float value = a + (b - a) * u.x + (c - a) * u.y + abcd * u.x * u.y;\r\n    vec2 derivative = du.xy * (u.yx * abcd + vec2(b, c) - a);\r\n    return vec3(value * 2.0 - 1.0, derivative);\r\n}\r\n\r\nfloat fbm(vec2 uv, vec2 frequency, int octaves, float shift, float gain, float lacunarity, float factor, float seed){\r\n    uv *= frequency;\r\n    vec2 offset = vec2(shift,0);\r\n    float value = 0.0, amplitude = gain;\r\n    vec2 sc = vec2(sin(shift), cos(shift)); mat2 rotate = mat2(sc.y,sc.x,-sc.x,sc.y);\r\n    for(int i=0;i<octaves;i++){\r\n        value += amplitude * (noise21(uv / frequency, frequency, seed)*2.-1.);\r\n        uv = uv * lacunarity + offset * float(i+1);\r\n        frequency *= lacunarity;\r\n        amplitude = pow(amplitude * gain, factor);\r\n        offset *= rotate;\r\n    }\r\n    return .5+.5*value;\r\n}\r\nvec3 fbmd(vec2 uv, vec2 frequency, int octaves, vec2 shift, float gain, vec2 lacunarity, float slopeness, float factor, float seed){\r\n    uv *= frequency;\r\n    vec3 value = vec3(0); vec2 derivative = vec2(0); float amplitude = gain;\r\n    vec2 sc = vec2(sin(shift.x),cos(shift.y)); mat2 rotate = mat2(sc.y,sc.x,-sc.x,sc.y);\r\n    for(int i=0;i<octaves;i++){\r\n        vec3 n = noise21d(uv / frequency, frequency, seed).xyz;\r\n        derivative += n.yz;\r\n\r\n        n *= amplitude;\r\n        n.x /= (1.0 + mix(0.0, dot(derivative, derivative), slopeness));\r\n        value += n; \r\n        \r\n        uv = (uv + shift) * lacunarity;\r\n        frequency *= lacunarity;\r\n        amplitude = pow(amplitude * gain, factor);\r\n        shift *= rotate;\r\n    }\r\n    value.x = value.x * 0.5 + 0.5;\r\n    return value;\r\n}\r\nvec3 voronoi(in vec2 uv, in vec2 period, in float jitter, in float width, in float seed){\r\n    uv *= period;\r\n    vec2 i = floor(uv); vec2 f = uv - i;\r\n    vec2 minPos, tilePos;\r\n    float md = 1e+5;\r\n    for(int y=-1;y<=1;y++)\r\n    for(int x=-1;x<=1;x++){\r\n        vec2 n = vec2(x,y);\r\n        vec2 cPos = jitter * hash22(mod(i + n, period) + seed);\r\n        vec2 rPos = n + cPos - f;\r\n        float d = dot(rPos, rPos);\r\n        if(d >= md) continue;\r\n        md = d;\r\n        minPos = rPos;\r\n        tilePos = cPos;\r\n    }\r\n    float md0 = 1e+5; md = 1e+5;\r\n    for(int y=-2;y<=2;y++)\r\n    for(int x=-2;x<=2;x++){\r\n        vec2 n = vec2(x,y);\r\n        vec2 cPos = jitter * hash22(mod(i + n, period) + seed);\r\n        vec2 rPos = n + cPos - f;\r\n        vec2 v = minPos - rPos;\r\n        if(dot(v, v) <= 1e-5) continue;\r\n        float d = dot(0.5 * (minPos + rPos), normalize(rPos - minPos));\r\n        if(d < md){\r\n            md0 = md; md = d;\r\n        }else if(d < md0){\r\n            md0 = d;\r\n        }\r\n    }\r\n    md += (md0 - md) * width;\r\n    return vec3(md, tilePos);\r\n}\r\n\r\n\r\n\r\nfloat sineNoise(vec2 uv, int layers, float shift){\r\n    vec2 p = vec2(uv); float v = 0.0;\r\n\tfor(int i=0;i<layers;i++){\r\n\t\tfloat t = shift * (.75+.25*sin(float(i+1)*43758.5453));\r\n        uv.y -= t;\r\n\t\tp = uv + vec2(cos(t - p.x) + sin(t + p.y), sin(t - p.y) + cos(t + p.x));\r\n        v += 1.0/length(1.0/vec2(sin(p.x+t), cos(p.y+t)));\r\n\t}\r\n    v = smoothstep(1.0,0.0,v / float(layers));\r\n    return pow(v,1.4);\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n\r\n#if defined(SINE)\r\n    float alpha = sineNoise(uv*TAU, 8, 411.37);\r\n    alpha = smoothstep(0.2,1.0,alpha);\r\n#elif defined(WARP)\r\n    const float gain = 0.5, slopeness = 0.5, factor = 0.94, seed = 0.0;\r\n    const vec2 lacunarity = vec2(2), frequency = vec2(8.0);\r\n\r\n    float f0 = fbmd(uv, frequency, 7, vec2(123), gain, lacunarity, slopeness, factor, seed).x;\r\n    float f1 = fbmd(uv, frequency, 7, vec2(235), gain, lacunarity, slopeness, factor, seed).x;\r\n    uv = uv + 0.2 * vec2(f0, f1);\r\n    float alpha = fbmd(uv, frequency, 7, vec2(0.0), gain, lacunarity, slopeness, factor, seed).x;\r\n#else\r\n    float f0 = fbm(uv, vec2(4.0), 7, 23.0, 0.5, 2.0, 0.95, 0.0);\r\n    float alpha = smoothstep(0.2, 1.0, f0);\r\n#endif\r\n\tfragColor = vec4(alpha);\r\n}"},6054:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\nuniform vec2 uScreenSize;\r\nuniform float uScale;\r\n\r\nvec3 calculateNormal(in float height){\r\n    float dhdx = dFdx(height) * uScreenSize.x;\r\n    float dhdy = dFdy(height) * uScreenSize.y;\r\n    vec3 normal = normalize(vec3(-dhdx, -dhdy, 1));\r\n    return 0.5+0.5*normal;\r\n}\r\n\r\nvoid main(){\r\n    float height = texture(uSampler, vUV).b;\r\n    fragColor = vec4(calculateNormal(height / uScale), height);\r\n}"},98:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec4 aLifetime;\r\nlayout(location=1) in vec4 aSize;\r\nlayout(location=2) in vec4 aTransform;\r\nlayout(location=3) in vec4 aVelocity;\r\nlayout(location=4) in vec4 aAcceleration;\r\n\r\nlayout(xfb_offset=0) out vec4 vLifetime;\r\nlayout(xfb_offset=0) out vec4 vSize;\r\nlayout(xfb_offset=0) out vec4 vTransform;\r\nlayout(xfb_offset=0) out vec4 vVelocity;\r\nlayout(xfb_offset=0) out vec4 vAcceleration;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform EmitterUniforms {\r\n    vec4 uLifespan;\r\n    vec3 uOrigin;\r\n    vec2 uSize;\r\n    vec3 uGravity;\r\n#if defined(SPHERE) || defined(CIRCLE)\r\n    vec2 uRadius;\r\n#elif defined(BOX)\r\n    vec3 uExtents;\r\n#endif\r\n#ifdef TARGETED\r\n    vec2 uForce;\r\n    vec3 uTarget;\r\n#endif\r\n#ifdef TRAIL\r\n    vec2 uLength;\r\n#else\r\n    vec2 uRotation;\r\n#endif\r\n#ifdef ANGULAR\r\n    vec4 uAngular;\r\n#endif\r\n#ifdef FRAMES\r\n    vec2 uFrame;\r\n#endif\r\n    int uLastID;\r\n};\r\n\r\n#ifdef LUT\r\nuniform sampler2D uAttributes;\r\nvec4 lerpLUT(sampler2D texture, float u, int v){\r\n    float width = float(textureSize(texture,0).x);\r\n    ivec2 uv = ivec2(u * width, v);\r\n    vec4 a = texelFetchOffset(texture,uv,0,ivec2(0,0));\r\n    vec4 b = texelFetchOffset(texture,uv,0,ivec2(1,0));\r\n    float f = fract(u * width);\r\n    return mix(a, b, f);\r\n}\r\n#endif\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(uint n){\r\n\tn = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\n\r\nvoid main(){\r\n    if(gl_VertexID >= uLastID){\r\n        uint seed = uint(gl_VertexID) ^ floatBitsToUint(uTime.z);\r\n        vLifetime.z = uintBitsToFloat(seed);\r\n#ifdef STATIC\r\n        vLifetime.x = uTime.x - mix(uLifespan.z, uLifespan.w, hash11(seed+=1U));\r\n        vLifetime.y = mix(uLifespan.x, uLifespan.y, hash11(seed+=1U));\r\n#else\r\n        vLifetime.x = mix(uLifespan.z, uLifespan.w, hash11(seed+=1U));\r\n        vLifetime.y = 1.0 / mix(uLifespan.x, uLifespan.y, hash11(seed+=1U));\r\n#endif\r\n#if defined(SPHERE)\r\n        float theta = TAU * hash11(seed+=1U);\r\n        float phi = acos(2. * hash11(seed+=1U) - 1.);\r\n        float radius = mix(uRadius.x, uRadius.y, hash11(seed+=1U));\r\n        vec3 normal = vec3(sin(phi) * cos(theta), sin(phi) * sin(theta), cos(phi));\r\n        vTransform.xyz = uOrigin + radius * normal;\r\n#elif defined(CIRCLE)\r\n        float theta = TAU * hash11(seed+=1U);\r\n        float radius = mix(uRadius.x, uRadius.y, hash11(seed+=1U));\r\n        vec3 normal = vec3(cos(theta), 0, sin(theta));\r\n        vTransform.xyz = uOrigin + radius * normal;\r\n#elif defined(BOX)\r\n        vTransform.xyz = uOrigin + uExtents * (vec3(hash11(seed+=1U), hash11(seed+=1U), hash11(seed+=1U))-.5);\r\n#else\r\n        vTransform.xyz = uOrigin;\r\n#endif\r\n#ifdef TRAIL\r\n        vTransform.w = mix(uLength.x, uLength.y, hash11(seed+=1U));\r\n#else\r\n        vTransform.w = mix(uRotation.x, uRotation.y, hash11(seed+=1U));\r\n#endif\r\n\r\n#if defined(TARGETED)\r\n        vec3 direction = normalize(vTransform.xyz - uTarget);\r\n        vVelocity.xyz = normal * mix(uForce.x, uForce.y, hash11(seed+=1U));\r\n#endif\r\n        vAcceleration.xyz = uGravity;\r\n#ifdef ANGULAR\r\n        vVelocity.w = mix(uAngular.x,uAngular.y,hash11(seed+=1U));\r\n        vAcceleration.w = mix(uAngular.z,uAngular.w,hash11(seed+=1U));\r\n#else\r\n        vVelocity.w = 0.0;\r\n        vAcceleration.w = 0.0;\r\n#endif\r\n\r\n        vSize.x = mix(uSize.x, uSize.y, hash11(seed+=1U));\r\n        vSize.y = 0.0;\r\n#ifdef FRAMES\r\n        vSize.zw = vec2(floor(uFrame.y * uFrame.y *  hash11(seed+=1U)), uFrame.y);\r\n#else\r\n        vSize.zw = vec2(0,1);\r\n#endif\r\n    }else{\r\n#ifdef STATIC\r\n        vLifetime = aLifetime;\r\n        vTransform = aTransform;\r\n        vVelocity = aVelocity;\r\n        vAcceleration = aAcceleration;\r\n        vSize = aSize;\r\n#else\r\n        vLifetime = aLifetime + vec4(uTime.y,0,0,0);\r\n        float life = clamp(vLifetime.x * vLifetime.y, 0.0, 1.0);\r\n        float deltaTime = max(0.0,vLifetime.x) - max(0.0,aLifetime.x);\r\n\r\n#ifdef LUT\r\n        float f = hash11(floatBitsToUint(vLifetime.z));\r\n        vec4 s0 = lerpLUT(uAttributes, life, 0);\r\n        vec4 s1 = lerpLUT(uAttributes, life, 1);\r\n        float mSize = mix(s0.x, s0.y, f);\r\n        vec2 mVelocity = vec2(mix(s0.z,s0.w,f),mix(s1.x,s1.y,f));\r\n        float mRadial = mix(s1.z,s1.w,f);\r\n#else\r\n        const float mSize = 1.0;\r\n        const vec2 mVelocity = vec2(1.0);\r\n        const float mRadial = 1.0;\r\n#endif\r\n\r\n        vAcceleration = aAcceleration;\r\n        vVelocity = aVelocity + vAcceleration * deltaTime;\r\n#ifdef RADIAL\r\n        vec3 radial = uTarget - aTransform.xyz;\r\n        vec3 attractor = mRadial * normalize(radial);\r\n        vVelocity.xyz += attractor;\r\n#endif\r\n        vVelocity *= mVelocity.xxxy;\r\n        vTransform = aTransform + deltaTime * vVelocity;\r\n        vSize = vec4(aSize.x, mSize * aSize.x, aSize.z, aSize.w);\r\n#ifdef FRAMES\r\n        vSize.z = mod(aSize.z + deltaTime * uFrame.x, vSize.w * vSize.w);\r\n#endif\r\n#endif\r\n    }\r\n}"},5816:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec4 aLifetime;\r\nlayout(location=1) in vec4 aSize;\r\nlayout(location=2) in vec4 aTransform;\r\nlayout(location=3) in vec4 aVelocity;\r\nlayout(location=4) in vec4 aAcceleration;\r\n\r\nlayout(location=5) in vec3 aPosition;\r\nlayout(location=6) in vec2 aUV;\r\n\r\nout vec2 vUV;\r\nout vec2 vLife;\r\nout vec3 vPosition;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nvoid main(){\r\n    float time = uTime.x - aLifetime.x + aPosition.y * aTransform.w;\r\n    time = (time - aTransform.w) * (aLifetime.y + aTransform.w) / aLifetime.y;\r\n    time = clamp(time, 0.0, aLifetime.y);\r\n    vLife = vec2(time / aLifetime.y, aLifetime.z);\r\n\r\n    float size = mix(aSize.x, aSize.y, vLife.x);\r\n\r\n    vec3 position = aTransform.xyz + time * aVelocity.xyz + 0.5 * time * time * aAcceleration.xyz;\r\n    vec3 direction = normalize(aVelocity.xyz + time * aAcceleration.xyz);\r\n    vec3 front = -vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\r\n    position = position + size * cross(front, direction) * aPosition.x;\r\n\r\n    vUV = aUV;\r\n    vPosition = position;\r\n    gl_Position = uViewProjectionMatrix * vec4(position, 1.0);\r\n}"},7104:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\n\r\nvoid main(){\r\n    vec4 color = texture(uSampler, vUV);\r\n#ifdef BRIGHTNESS\r\n    float brightness = dot(color.rgb, vec3(0.2126, 0.7152, 0.0722));\r\n    color *= step(0.5, brightness);\r\n#endif\r\n#ifdef MASK\r\n    color *= color.a;\r\n#endif\r\n    fragColor = vec4(color.rgb,1);\r\n}"},4423:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aPosition;\r\n\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\n\r\nuniform mat4 uModelMatrix;\r\n\r\nvoid main(){\r\n    gl_Position = uViewProjectionMatrix * uModelMatrix * vec4(aPosition, 1.0);\r\n}"},8058:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec4 vColor;\r\nin vec4 vMaterial;\r\n\r\nlayout(location=0) out vec4 fragColor;\r\nlayout(location=1) out vec4 fragNormal;\r\n\r\nuniform sampler2D uSampler;\r\nuniform vec2 uScreenSize;\r\nuniform float uScale;\r\n\r\nvec3 calculateNormal(in float height){\r\n    float dhdx = dFdx(height) * uScreenSize.x;\r\n    float dhdy = dFdy(height) * uScreenSize.y;\r\n    vec3 normal = normalize(vec3(-dhdx, -dhdy, 1));\r\n    return 0.5+0.5*normal;\r\n}\r\n\r\nvoid main(){\r\n    fragColor = texture(uSampler, vUV);\r\n\r\n    float height = fragColor.b;\r\n    fragNormal = vec4(calculateNormal(height / uScale), height);\r\n}"},843:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nin vec3 vPosition;\r\nin vec4 vColor;\r\nin vec3 vDomain;\r\nin float vMaterial;\r\nout vec4 fragColor;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform sampler2D uSampler;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash13(in vec3 src) {\r\n    const uint M = 0x5bd1e995u;\r\n    uint h = 1190494759u;\r\n    uvec3 v = floatBitsToUint(src);\r\n    v *= M; v ^= v>>24u; v *= M;\r\n    h *= M; h ^= v.x; h *= M; h ^= v.y; h *= M; h ^= v.z;\r\n    h ^= h>>13u; h *= M; h ^= h>>15u;\r\n    return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\r\n}\r\nfloat noise3D(in vec3 x){\r\n    vec3 i = floor(x);\r\n    vec3 f = fract(x);\r\n    f = f*f*(3.0-2.0*f);\r\n    return mix(mix(mix( hash13(i+vec3(0,0,0)), \r\n                        hash13(i+vec3(1,0,0)),f.x),\r\n                   mix( hash13(i+vec3(0,1,0)), \r\n                        hash13(i+vec3(1,1,0)),f.x),f.y),\r\n               mix(mix( hash13(i+vec3(0,0,1)), \r\n                        hash13(i+vec3(1,0,1)),f.x),\r\n                   mix( hash13(i+vec3(0,1,1)), \r\n                        hash13(i+vec3(1,1,1)),f.x),f.y),f.z);\r\n}\r\nfloat noise3D(in vec3 uv, in vec3 period){\r\n    vec3 i0 = floor(mod(uv, period));\r\n    vec3 i1 = floor(mod(uv+vec3(1), period));\r\n    vec3 f = fract(uv); f = f*f*(3.0-2.0*f);\r\n    return mix(mix(mix( hash13(vec3(i0.x,i0.y,i0.z)), \r\n                        hash13(vec3(i1.x,i0.y,i0.z)),f.x),\r\n                   mix( hash13(vec3(i0.x,i1.y,i0.z)), \r\n                        hash13(vec3(i1.x,i1.y,i0.z)),f.x),f.y),\r\n               mix(mix( hash13(vec3(i0.x,i0.y,i1.z)), \r\n                        hash13(vec3(i1.x,i0.y,i1.z)),f.x),\r\n                   mix( hash13(vec3(i0.x,i1.y,i1.z)), \r\n                        hash13(vec3(i1.x,i1.y,i1.z)),f.x),f.y),f.z);\r\n}\r\nfloat fbm(in vec3 uv, in int octaves){\r\n    float total = 0.0, amplitude = 1.0;\r\n    const mat2 r = mat2(1.6, 1.2, -1.2, 1.6);\r\n    for(int i = 0; i < octaves; i++){\r\n        total += .5*amplitude*noise3D(uv);\r\n        uv.xy = r * uv.xy + 100.0;\r\n        amplitude *= 0.5;\r\n    }\r\n    return total;\r\n}\r\nfloat fbm(in vec3 uv, in int octaves, in vec3 period){\r\n    float total = 0.0, amplitude = 1.0;\r\n    for(int i = 0; i < octaves; i++){\r\n        total += .5*amplitude*noise3D(uv, period);\r\n        uv = 2.0 * uv + 100.0;\r\n        period *= 2.0;\r\n        amplitude *= 0.5;\r\n    }\r\n    return total;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = 2.*vUV-1.;\r\n    float time = 4.0*uTime.x;\r\n#ifndef RADIAL\r\n    float fade = smoothstep(1.0, 0.8, abs(uv.x));\r\n    float f0 = 1.-2.*fbm(vec3(vDomain.xy * uv + vec2(time,0), -.5*time), 4);\r\n    f0 *= 1.-2.*noise3D(vec3(vDomain.xy * uv,f0)*vec3(2,0.25,3)+vec3(time,0,time));\r\n    float d0 = abs(uv.y+0.5*f0);\r\n#else\r\n    float fade = 1.0;\r\n    uv = vec2(atan(uv.y,uv.x)/TAU+.5, length(uv));\r\n    float f0 = 1.-2.*fbm(vec3(vDomain.xy * uv.xy + vec2(0,-time),-.5*time), 4, vec3(vDomain.xy,10));\r\n    float d0 = abs(uv.y+0.5*f0)-0.5*smoothstep(0.1,.0,uv.y);\r\n#endif\r\n\r\n    vec4 color = texture(uSampler, vec2(smoothstep(1.0,-0.25,d0), 0.0));\r\n    fragColor = vColor * color * fade;\r\n}"},1675:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define RESOLUTION 1.0\r\n#define TAU 6.283185307179586\r\n#define PI 3.141592653589793\r\n\r\nuvec2 wrap2(in vec2 v, float period){return uvec2(v-period*floor(v/period));}\r\nuvec3 wrap2(in vec3 v, float period){return uvec3(v-period*floor(v/period));}\r\nuint hash(uint x){\r\n    x = (x^(x>>16))*0x7feb352dU;\r\n    x = (x^(x>>15))*0x846ca68bU;\r\n    return (x^(x>>16));\r\n}\r\nvec2 hash22(uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n    n = hash(n);\r\n    return vec2(n*uvec2(0x1U,0x3fffU))*(1.0/float(0xffffffffU));\r\n}\r\nfloat hash21(uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n    n = hash(n);\r\n    return float(n)*(1.0/float(0xffffffffU));\r\n}\r\nfloat hash31(uvec3 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U^v.z*3299493293U;\r\n    n = hash(n);\r\n    return float(n)*(1.0/float(0xffffffffU));\r\n}\r\n\r\nvec3 voronoi3(in vec2 uv, in float period, out vec4 center){\r\n    vec2 n = floor(uv);\r\n    vec2 f = fract(uv);\r\n    vec4 mc = vec4(0.0);\r\n    vec3 md = vec3(8.0);\r\n\r\n    for(int j=-1;j<=1;j++)\r\n    for(int i=-1;i<=1;i++){\r\n        vec2 g = vec2(i, j);\r\n        vec2 r = g - f + hash22(wrap2(n + g, period)) * 0.8;\r\n        float d = abs(r.x)+abs(r.y);\r\n        if(d < md.x){\r\n            md.z = md.y;\r\n            md.y = md.x;\r\n            md.x = d;\r\n            mc.zw = mc.xy;\r\n            mc.xy = n + g;\r\n        }else if(d < md.y){\r\n            md.z = md.y;\r\n            md.y = d;\r\n            mc.zw = n + g;\r\n        }else if(d < md.z){\r\n            md.z = d;\r\n        }\r\n    }\r\n    center = mc;\r\n    return md;\r\n}\r\n\r\nfloat cubicPulse(float c, float w, float x){\r\n    x = abs(x-c)/w;return step(x,1.0)*(1.0-x*x*(3.0-2.0*x));\r\n}\r\n\r\nuniform vec2 uScreenSize;\r\nuniform float uTime;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV * RESOLUTION;\r\n    float t = .5+.5*cos(TAU * (uv.x - uTime));\r\n    uv = vec2(uv.x+uv.y,uv.x-uv.y);\r\n    float width = 0.6, scale = 8.0;\r\n\r\n    vec4 cellCenters;\r\n    vec3 vr = voronoi3(uv * scale, scale * RESOLUTION, cellCenters);\r\n    float d = max(width + vr.y - vr.z, vr.y - vr.x);\r\n    \r\n    float h0 = hash21(wrap2(cellCenters.xy, scale * RESOLUTION));\r\n    float h1 = hash21(wrap2(cellCenters.zw, scale * RESOLUTION));\r\n    \r\n\tfloat wire = cubicPulse(width, 0.06, d);\r\n    wire += step(0.0, h0 - h1) * cubicPulse(width-0.1, 0.06, d);\r\n    wire += step(0.5, h0 - h1) * cubicPulse(width-0.2, 0.06, d);\r\n    \r\n    vec3 color = vec3(0.12,0.28,0.36) +\r\n    wire * vec3(0.1,0.5,0.4) +\r\n    vr.x * vec3(0,0.42,0.38) +\r\n    t*(h0*h1) * vec3(0.0,0.4,0.3) +\r\n    t*t*(wire+0.2*vr.y*vr.z+0.4*vr.x) * vec3(0.5,0.6,0.5);\r\n\r\n    fragColor = vec4(color,.5+.5*color.b);\r\n}"},5013:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec2 vUV;\r\nin vec3 vPosition;\r\nin vec4 vColor;\r\nin vec3 vDomain;\r\nin float vMaterial;\r\n\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\n\r\nvoid main(){\r\n    float time = 1.6 * uTime.x + vDomain.x * 0.036;\r\n    vec2 uv = vUV;\r\n    float c0 = texture(uSampler, uv).r;\r\n    float c1 = texture(uSampler, uv + vec2(0,-0.2*time)).g;\r\n    float c2 = texture(uSampler, uv + vec2(0,-0.4*time)).b;\r\n    float c = c1*c2;\r\n    c = mix(smoothstep(0.2,0.8,c), c, c0*c0 * 0.8) * c0;\r\n    vec4 color = mix(vec4(0), vec4(0.1,0.3,0.3,0.5), c*8.0);\r\n    color = mix(color, vec4(0.4,0.6,0.7,0.2), smoothstep(0.0625,0.5,c));\r\n    color = mix(color, vec4(1.0,1.0,1.0,0.0), smoothstep(0.125,0.75,c));\r\n    \r\n    fragColor = color * vColor;\r\n}"},9057:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash13(in vec3 src) {\r\n    const uint M = 0x5bd1e995u;\r\n    uint h = 1190494759u;\r\n    uvec3 v = floatBitsToUint(src);\r\n    v *= M; v ^= v>>24u; v *= M;\r\n    h *= M; h ^= v.x; h *= M; h ^= v.y; h *= M; h ^= v.z;\r\n    h ^= h>>13u; h *= M; h ^= h>>15u;\r\n    return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\r\n}\r\nfloat noise3D(in vec3 uv, in vec3 period){\r\n    vec3 i0 = floor(mod(uv, period));\r\n    vec3 i1 = floor(mod(uv+vec3(1), period));\r\n    vec3 f = fract(uv); f = f*f*(3.0-2.0*f);\r\n    return mix(mix(mix( hash13(vec3(i0.x,i0.y,i0.z)), \r\n                        hash13(vec3(i1.x,i0.y,i0.z)),f.x),\r\n                   mix( hash13(vec3(i0.x,i1.y,i0.z)), \r\n                        hash13(vec3(i1.x,i1.y,i0.z)),f.x),f.y),\r\n               mix(mix( hash13(vec3(i0.x,i0.y,i1.z)), \r\n                        hash13(vec3(i1.x,i0.y,i1.z)),f.x),\r\n                   mix( hash13(vec3(i0.x,i1.y,i1.z)), \r\n                        hash13(vec3(i1.x,i1.y,i1.z)),f.x),f.y),f.z);\r\n}\r\nfloat fbm(in vec3 uv, in int octaves, in vec3 period){\r\n    float total = 0.0, amplitude = 1.0;\r\n    for(int i = 0; i < octaves; i++){\r\n        total += .5*amplitude*noise3D(uv, period);\r\n        uv = uv*2.0 + 100.0 + uv.x;\r\n        period *= 2.0;\r\n        amplitude *= 0.5;\r\n    }\r\n    return total;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n    vec3 scale = vec3(16.0, 4.0, 36.0);\r\n    float f2 = fbm(uv.xyx*scale, 6, scale);\r\n    scale = vec3(12.0, 8.0, 24.0);\r\n    float f1 = fbm(uv.xyx*scale, 7, scale);\r\n\r\n    float f0 = smoothstep(0.0,0.9,uv.y)*smoothstep(1.0,0.9,uv.y);\r\n\r\n\tfragColor = vec4(f0,f1,f2,1);\r\n}"},8220:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform vec2 uScreenSize;\r\n\r\n#define TAU 6.283185307179586\r\n#define RESOLUTION 1.0\r\n#define MAP_SCALE 10.0\r\n\r\nvec2 hash22(ivec2 iv, float period){\r\n    vec2 p = mod(vec2(iv), period * RESOLUTION);\r\n    return fract(vec2(2097152, 262144)*sin(dot(p, vec2(113, 1))))*2.-1.;\r\n}\r\nmat2 rotate(in float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\r\nfloat gradN2D(in vec2 value, float period){ \r\n    const ivec2 ie = ivec2(0, 1);\r\n    const vec2 fe = vec2(0, 1);\r\n    ivec2 p = ivec2(floor(value));\r\n    vec2 f = fract(value);\r\n    vec2 w = f*f*(3. - 2.*f); \r\n    float c = mix(mix(dot(hash22(p + ie.xx,period), f - fe.xx), dot(hash22(p + ie.yx,period), f - fe.yx), w.x),\r\n                  mix(dot(hash22(p + ie.xy,period), f - fe.xy), dot(hash22(p + ie.yy,period), f - fe.yy), w.x), w.y);\r\n    return c*.5 + .5;\r\n}\r\nfloat stripes(float x, float offset){\r\n    x = 2.*abs(fract(x/6.283185307179586+offset-.25)-.5);\r\n    float x2 = clamp(x*x*(2.*x-1.),0.,1.);\r\n    return mix(smoothstep(0.,1.,x),x2,0.15);\r\n}\r\nfloat sandLayer(vec2 p, float lines){\r\n    vec2 q = rotate(atan(1.0/lines,1.0))*p;\r\n    q.y += (gradN2D(p*18.,18.0) - .5)*.05;\r\n    float grad1 = stripes(q.y*lines*TAU, 0.);\r\n   \r\n    q = rotate(-atan(1.0/lines,1.0))*p;\r\n    q.y += (gradN2D(p*12.,12.0) - .5)*.05;\r\n    float grad2 = stripes(q.y*lines*TAU, .5);\r\n      \r\n    q = vec2(p.x+p.y,-p.x+p.y);\r\n    \r\n    float a2 = dot(sin(q*2.*TAU - cos(q.yx*2.*TAU)), vec2(.25)) + .5;\r\n    float a1 = 1. - a2;\r\n    \r\n    float c = 1. - (1. - grad1*a1)*(1. - grad2*a2);\r\n    return c;\r\n}\r\n\r\nvec3 calculateNormal(in float height){\r\n    float dhdx = dFdx(height) * uScreenSize.x;\r\n    float dhdy = dFdy(height) * uScreenSize.y;\r\n    vec3 normal = normalize(vec3(-dhdx, -dhdy, 1));\r\n    return 0.5+0.5*normal;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV * RESOLUTION;\r\n    float layer0 = sandLayer(uv, 10.);\r\n    float layer1 = sandLayer(uv + gradN2D(uv*7.,7.)*.2, 7.);\r\n    float height = mix(layer0, layer1, smoothstep(.1,.9, gradN2D(uv*2.0+128.0,2.0)));\r\n\r\n    float fbm0 = gradN2D(uv.yx*16.,16.)*.5+gradN2D(uv.yx*32.,32.)*.3+gradN2D(uv.yx*64.,64.)*.2;\r\n    height += 0.1*(fbm0*2.-1.);\r\n    height *= 0.16;\r\n\r\n    fragColor = vec4(calculateNormal(height / MAP_SCALE), height);\r\n}"},1653:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\n\r\nlayout(location=0) out vec4 fragAlbedo;\r\nlayout(location=1) out vec4 fragNormal;\r\n\r\nuniform sampler2D uPositionBuffer;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform float uGridSize;\r\nuniform mat4 uModelMatrix;\r\n\r\n#define TAU 6.283185307179586\r\n\r\nfloat grid(in vec2 uv, in float tiles, in float width){\r\n    uv = cos(TAU*(uv*tiles));\r\n    return smoothstep(1.0-width,1.0,max(uv.x,uv.y));\r\n}\r\n\r\nvoid main(){\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    if(position.a > 1.0) discard;\r\n    vec3 center = vec3(uModelMatrix[3]);\r\n    vec2 uv = (position.xz - center.xz) * uGridSize;\r\n\r\n    float fade = max(abs(uv.x), abs(uv.y));\r\n    float grid1 = max(0.0,cos(TAU * (fade - 0.4 * uTime.x)));\r\n    float grid0 = grid(position.xz,0.5,mix(0.01,0.1,grid1)) * smoothstep(1.0,0.8,fade);\r\n    vec3 color = mix(vec3(0.6,0.9,0.8),vec3(0.8,1.0,1.0), grid1);\r\n\r\n    fragAlbedo = vec4(color,grid0);\r\n    fragNormal = vec4(0);\r\n}"},7983:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\n\r\nuvec2 wrap2(in vec2 v, in vec2 period){return uvec2(v-period*floor(v/period));}\r\nfloat hash21(in uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n\tn = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\nfloat noise2D(in vec2 p, in vec2 period){\r\n    const vec2 e = vec2(0,1);\r\n    vec2 f = fract(p);\r\n    p = floor(p);\r\n    f = f*f*(3.0-2.0*f);\r\n    return mix(mix(hash21(wrap2(p+e.xx, period)),\r\n\t\t\t\t    hash21(wrap2(p+e.yx, period)), f.x),\r\n\t\t\t\tmix(hash21(wrap2(p+e.xy, period)),\r\n\t\t\t\t\thash21(wrap2(p+e.yy, period)), f.x), f.y);\r\n}\r\nfloat hatch(in vec2 uv, in float period, in int strength){\r\n    float rz=1.,st=float(strength)*0.1;\r\n    const vec2 s = vec2(1,20);\r\n    for(int i=0;i<=strength;i++){\r\n        uv.x += uv.y;\r\n        float g = noise2D(s*uv,s*period);\r\n        g = smoothstep(0.5,1.0,g);\r\n        rz = rz+g; //min(1.-g,rz);\r\n        uv.xy = uv.yx;\r\n        uv += 128.767;\r\n    }\r\n    return rz;\r\n}\r\n\r\nuniform vec3 uColor;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV.yx;\r\n\r\n    float scale = 4.0;\r\n    float h = hatch(uv*scale,scale,3);\r\n    vec3 color = vec3(0.6,0.62,0.66);\r\n    color += vec3(0.16,0.18,0.20) * smoothstep(0.0,3.0,h);\r\n    color += vec3(0.1) * smoothstep(1.0,3.0,h);\r\n    color += vec3(0.2) * smoothstep(2.0,3.0,h);\r\n    \r\n    color += 0.1*(cos(2.0*TAU*uv.y));\r\n    color *= uColor;\r\n    \t\r\n    float roughness = mix(0.5,0.2,color.b);\r\n\tfragColor = vec4(color,.5*roughness);\r\n}"},5628:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(in float u){\r\n    uint n = floatBitsToUint(u);\r\n    n = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & 0x7fffffffU)/float(0x7fffffff);\r\n}\r\nfloat noise11(in float u, in float period, float seed){\r\n    u *= period;\r\n    vec2 i = mod(floor(u) + vec2(0,1),vec2(period))+seed;\r\n    float f = fract(u); f = f*f*(3.0-2.0*f);\r\n    return mix(hash11(i.x),hash11(i.y),f);\r\n}\r\nfloat lightning(in vec2 uv, in float width, in float seed){\r\n    float b = \r\n    (noise11(uv.x, 4.0, seed)-.5)*0.25+\r\n    (noise11(uv.x, 8.0, seed)-.5)*0.1+\r\n    (noise11(uv.x, 24.0, seed)-.5)*0.05;\r\n    \r\n    width *= smoothstep(0.5, 0.4, abs(uv.x));\r\n\r\n    float l = .000025+(uv.x+.5)*.00001;\r\n    float m = .0005/smoothstep(0., l*25e3 * width, abs(b-uv.y) + pow(0.4 * abs(uv.x), 2.4));\r\n\r\n    return m;\r\n}\r\n\r\nuniform float uTiles;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n    float seed = floor(uv * uTiles).x + floor(uv * uTiles).y * uTiles;\r\n    uv = fract(uv * uTiles) - 0.5;\r\n    \r\n    float weight = lightning(uv, 2.0, seed);\r\n    vec3 color = vec3(0.2,0.2,0.4) * min(4.8,weight);\r\n    float alpha = mix(color.b, 0.0, smoothstep(1.0,2.0,color.b));\r\n    fragColor = vec4(color,alpha);\r\n}"},323:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nlayout(std140, column_major) uniform;\r\n\r\nlayout(location=0) in vec3 aTransform;\r\n\r\nout vec2 vLife;\r\nout vec3 vPosition;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform vec3 uArea;\r\nuniform float uSize;\r\nuniform vec3 uCenter;\r\n\r\nfloat hash11(uint n){\r\n    n = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\nvec3 hash13(uint n){\r\n\tn = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    uvec3 k = n * uvec3(n,n*16807U,n*48271U);\r\n    return vec3( k & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\nfloat noise1D(in float p){\r\n    uint  i = uint(floor(p));\r\n    float f = fract(p);\r\n\tfloat u = f*f*(3.0-2.0*f);\r\n    float g0 = hash11(i+0u)*2.0-1.0;\r\n    float g1 = hash11(i+1u)*2.0-1.0;\r\n    return 2.4*mix( g0*(f-0.0), g1*(f-1.0), u);\r\n}\r\n\r\nvoid main(){\r\n    vec3 random = hash13(uint(gl_VertexID));\r\n\r\n    vec3 relative = aTransform.xyz - uCenter + 0.5*uArea;\r\n    relative.xz = mod(relative.xz, uArea.xz);\r\n    vec3 position = uCenter - 0.5*uArea + relative;\r\n\r\n    float t = 0.1 * uTime.x;\r\n    position += 0.1 * uArea * vec3(\r\n        noise1D(random.x + t + abs(aTransform.x)),\r\n        noise1D(random.y + t + abs(aTransform.y)),\r\n        noise1D(random.z + t + abs(aTransform.z))\r\n    );\r\n\r\n    vLife = vec2(fract(t + random.x), 0.0);\r\n    vPosition = position;\r\n    gl_Position = uViewProjectionMatrix * vec4(position, 1.0);\r\n    gl_PointSize = max(1.0, uSize / gl_Position.w);\r\n}"},5338:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash12(in vec2 src) {\r\n    const uint M = 0x5bd1e995u;\r\n    uint h = 1190494759u;\r\n    uvec2 v = floatBitsToUint(src);    \r\n    v *= M; v ^= v>>24u; v *= M;\r\n    h *= M; h ^= v.x; h *= M; h ^= v.y;\r\n    h ^= h>>13u; h *= M; h ^= h>>15u;\r\n    return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\r\n}\r\nfloat noise2D(in vec2 p, in vec2 period){\r\n    vec4 i = floor(p).xyxy + vec4(0,0,1,1);\r\n    vec2 f = fract(p);\r\n\tvec2 u = f*f*(3.0-2.0*f);\r\n    i = mod(i, period.xyxy);\r\n    return mix( mix( hash12(i.xy), \r\n                     hash12(i.zy), u.x),\r\n                mix( hash12(i.xw), \r\n                     hash12(i.zw), u.x), u.y);\r\n}\r\nfloat fbm(in vec2 x, in int octaves, in vec2 period) {\r\n\tfloat v = 0.0, a = 1.0;\r\n\tvec2 shift = vec2(100);\r\n    const mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\r\n\tfor(int i = 0; i < octaves; ++i){\r\n\t\tv += 0.5 * a * noise2D(x / a, period * a);\r\n        x += shift;\r\n        shift = rot * shift;\r\n\t\ta *= 0.5;\r\n\t}\r\n\treturn v;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = 2.*vUV-1.;\r\n\r\n    vec2 polar = vec2(length(uv), 0.5 + atan(uv.y, uv.x) / TAU);\r\n    vec2 period = vec2(1000,36);\r\n    \r\n#if defined(RING)\r\n    float f0 = fbm(vec2(0.0, period.y*polar.y), 4, period);\r\n    float y0 = mix(0.5,0.75,f0);\r\n    float alpha = smoothstep(1.0-y0,0.0,abs(polar.x-y0)) * f0 * 1.5;\r\n#elif defined(BEAM)\r\n    float f0 = fbm(vec2(0.0, uv.y*4.0), 8, vec2(4.0));\r\n    float f1 = fbm(vec2(0.0, uv.y*16.0), 4, vec2(32.0));\r\n    float alpha = smoothstep(1.0,mix(0.9,-2.0,f0),uv.x - 0.2*f1 + 2.0*pow(abs(uv.y),2.0)) * pow(1.0-abs(uv.y),2.0);\r\n#elif defined(CONE)\r\n    float angle = abs(atan(uv.y,uv.x+1.0)/TAU);\r\n    alpha += 0.5 * smoothstep(0.3,0.2,angle) * smoothstep(1.0,0.0,uv.x+2.0*abs(uv.y));\r\n#else\r\n    float f0 = 2.0*fbm(vec2(0.0, period.y*polar.y), 4, period);\r\n    f0 += smoothstep(1.0, -1.0, polar.x - max(0.0,0.5-f0));\r\n    float alpha = smoothstep(0.0, 1.0, f0 - 1.5*polar.x);\r\n#endif\r\n    \r\n    fragColor = vec4(1) * alpha;\r\n}"},1632:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuvec2 wrap2(in vec2 v, float period){return uvec2(v-period*floor(v/period));}\r\nfloat hash21(in uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n\tn = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & uvec3(0x7fffffffU))/float(0x7fffffff);\r\n}\r\nfloat noise2D(in vec2 p, in float period){\r\n    const vec2 e = vec2(0,1);\r\n    vec2 f = fract(p);\r\n    p = floor(p);\r\n    f = f*f*(3.0-2.0*f);\r\n    return mix(mix(hash21(wrap2(p+e.xx, period)),\r\n\t\t\t\t    hash21(wrap2(p+e.yx, period)), f.x),\r\n\t\t\t\tmix(hash21(wrap2(p+e.xy, period)),\r\n\t\t\t\t\thash21(wrap2(p+e.yy, period)), f.x), f.y);\r\n}\r\nfloat fbm(in vec2 uv, in float period, in int octaves){\r\n    float value=0.0,amplitude=0.5;\r\n    for(int i=0;i<octaves;i++){\r\n        value += noise2D(uv, period) * amplitude;\r\n        amplitude*=0.5;\r\n        period*=2.0;\r\n        uv*=2.0;\r\n    }\r\n    return value;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV.yx;\r\n    float scale = 1.0;\r\n\r\n\tfloat f0 = fbm(uv*8.0*scale, 8.0*scale, 4);\r\n    uv.x -= f0*0.5;\r\n    float f1 = fbm(uv*16.0*scale + 128.0, 16.0*scale, 2);\r\n    uv -= f0*f1;\r\n    float f2 = fbm(uv*12.*scale + 256.0, 12.*scale, 4);\r\n    \r\n    vec3 color = vec3(0.4,0.3,0.3);\r\n    color = mix(color, vec3(0.8,0.3,0.3), f0);\r\n    color = mix(color, vec3(0.4,0.5,0.4), f1);\r\n    color = mix(color, vec3(0.2,0.1,0.2), smoothstep(0.2,1.,f2));\r\n\t\r\n    float roughness = 1.0-f1*f2;\r\n\tfragColor = vec4(color,.5*roughness);\r\n}"},5590:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\n#define RESOLUTION 1\r\nuniform vec2 uScreenSize;\r\n\r\nfloat hash(ivec2 v, int period){\r\n    period *= RESOLUTION;\r\n    uvec2 x = uvec2(v - period * (v / period));\r\n    uvec2 q = 1103515245U * ((x>>1U) ^ (x.yx   ));\r\n    uint  n = 1103515245U * ((q.x  ) ^ (q.y>>3U));\r\n    return float(n) * (1.0/float(0xffffffffU));\r\n}\r\nfloat noise(in vec2 p, int period){\r\n    const ivec2 k = ivec2(0,1);\r\n    ivec2 i = ivec2(floor(p));\r\n    vec2 f = fract(p);\r\n\tvec2 u = f*f*(3.0-2.0*f);\r\n    return mix(mix(hash(i + k.xx, period), \r\n                hash(i + k.yx, period), u.x),\r\n            mix(hash(i + k.xy, period), \r\n                hash(i + k.yy, period), u.x), u.y);\r\n}\r\n\r\nfloat grid(in vec2 uv, in float tiles, in float width){\r\n    uv = cos(TAU*(uv*tiles));\r\n    return smoothstep(1.0-width,1.0,max(uv.x,uv.y));\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV * float(RESOLUTION);\r\n\r\n    float l3 = noise(512.0 * uv, 512);\r\n    float l2 = noise(128.0 * uv, 128);\r\n    float l1 = noise(32.0 * uv, 32);\r\n    uv += 0.4*noise(16.0*uv.yx - l1 + 128.0,16);\r\n    float l0 = noise(8.0*uv,8);\r\n    \r\n    vec3 color = vec3(0.04,0.04,0.12)\r\n    + vec3(0.63,0.55,0.42) * l0\r\n    + vec3(0.2,0.1,0.1) * (1.0-l0*l1)\r\n    + vec3(0.42,0.42,0.44) * l1\r\n    + vec3(0.16,0.30,0.27) * l2\r\n    + vec3(0.12,0.16,0.22) * (l3-1.0);\r\n    color = 0.25 + 0.5 * color;\r\n\r\n#ifdef GRID\r\n    color = vec3(grid(vUV, 10.0, 0.1),0.0,0.0);\r\n    color.gb += step(0.48, max(abs(0.5-vUV.x),abs(0.5-vUV.y)));\r\n#endif\r\n\r\n    float roughness = mix(0.5,1.0,color.g);\r\n    fragColor = vec4(color,.5*roughness);\r\n}"},7787:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform vec4 uColor;\r\nuniform float uBlur;\r\n#ifdef TRIANGLE\r\nuniform vec2 uSize;\r\n#endif\r\n#ifdef ROUNDED_BOX\r\nuniform float uSize;\r\nuniform float uRadius;\r\n#endif\r\n\r\n#define TAU 6.283185307179586\r\nfloat triangle(in vec2 p, in vec2 p0, in vec2 p1, in vec2 p2){\r\n\tvec2 e0 = p1 - p0; vec2 e1 = p2 - p1; vec2 e2 = p0 - p2;\r\n\tvec2 v0 = p - p0; vec2 v1 = p - p1; vec2 v2 = p - p2;\r\n\r\n\tvec2 pq0 = v0 - e0*clamp( dot(v0,e0)/dot(e0,e0), 0.0, 1.0 );\r\n\tvec2 pq1 = v1 - e1*clamp( dot(v1,e1)/dot(e1,e1), 0.0, 1.0 );\r\n\tvec2 pq2 = v2 - e2*clamp( dot(v2,e2)/dot(e2,e2), 0.0, 1.0 );\r\n    \r\n    float s = e0.x*e2.y - e0.y*e2.x;\r\n    vec2 d = min( min( vec2( dot( pq0, pq0 ), s*(v0.x*e0.y-v0.y*e0.x) ),\r\n                       vec2( dot( pq1, pq1 ), s*(v1.x*e1.y-v1.y*e1.x) )),\r\n                       vec2( dot( pq2, pq2 ), s*(v2.x*e2.y-v2.y*e2.x) ));\r\n\treturn -sqrt(d.x)*sign(d.y);\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = 2.*vUV-1.;\r\n#if defined(CIRCLE)\r\n    float distance = max(0.0, 1.0-length(uv));\r\n    float alpha = distance*distance;\r\n#elif defined(WAVE)\r\n    uv = vec2(atan(uv.y,uv.x)/TAU,length(uv));\r\n    float alpha = .5-.5*cos(smoothstep(0.2,1.0,uv.y)*TAU);\r\n    alpha = alpha * alpha;\r\n#elif defined(RING)\r\n    uv = vec2(atan(uv.y,uv.x)/TAU,length(uv));\r\n    float distance = max(0.0, 1.0-uv.y);\r\n    //distance -= smoothstep(1.0,0.0,uv.y) * smoothstep(0.0,1.0,abs(fract(uv.x * 9.0)-0.5));\r\n    float alpha = smoothstep(0.0,0.1,distance) * smoothstep(0.5,0.0,distance);\r\n    alpha = pow(alpha, 1.4);\r\n#elif defined(ROUNDED_BOX)\r\n    float distance = length(max(abs(uv)-uSize+uRadius,0.0))-uRadius;\r\n    float alpha = 1.0-smoothstep(0.0, 1.0 - uSize, distance);\r\n#elif defined(TRIANGLE)\r\n    float distance = triangle(uv, vec2(-uSize.x,uSize.y), vec2(-uSize.x,-uSize.y), vec2(uSize.x,0.0));\r\n    float alpha = smoothstep(uBlur, 0.0, distance);\r\n#elif defined(BLINK)\r\n    uv = abs(uv);\r\n    float x0 = 1.0-uv.x*uv.x;\r\n    float x1 = 1.0-uv.x;\r\n    float y0 = mix(pow(1.0-uv.y,8.0), pow(1.0-uv.y,2.0), x1*x1);\r\n    float alpha = smoothstep(0.0, 1.0, x0*y0);\r\n#endif\r\n    fragColor = uColor * alpha;\r\n}"},5961:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash11(in float u){\r\n    uint n = floatBitsToUint(u);\r\n    n = (n << 13U) ^ n;\r\n    n = n * (n * n * 15731U + 789221U) + 1376312589U;\r\n    return float( n & 0x7fffffffU)/float(0x7fffffff);\r\n}\r\nvec2 hash22(in vec2 uv){\r\n    uvec4 q = floatBitsToUint(uv).xyyx;\r\n    q = 1103515245u * ((q >> 1u) ^ q.yxwz);\r\n    uvec2 n = 1103515245u * (q.xz ^ (q.yw >> 3u));\r\n    return vec2(n) * (1.0 / float(0xffffffffu));\r\n}\r\nfloat noise11(in float u, in float period, float seed){\r\n    u *= period;\r\n    vec2 i = mod(floor(vec2(u,u+1.0)),vec2(period))+seed;\r\n    float f = fract(u);\r\n    return mix(hash11(i.x),hash11(i.y),f);\r\n}\r\nvec3 voronoi(in vec2 uv, in vec2 period, in float jitter, in float width, in float seed){\r\n    uv *= period;\r\n    vec2 i = floor(uv); vec2 f = uv - i;\r\n    vec2 minPos, tilePos;\r\n    float md = 1e+5;\r\n    for(int y=-1;y<=1;y++)\r\n    for(int x=-1;x<=1;x++){\r\n        vec2 n = vec2(x,y);\r\n        vec2 cPos = jitter * hash22(mod(i + n, period) + seed);\r\n        vec2 rPos = n + cPos - f;\r\n        float d = dot(rPos, rPos);\r\n        if(d >= md) continue;\r\n        md = d;\r\n        minPos = rPos;\r\n        tilePos = cPos;\r\n    }\r\n    float md0 = 1e+5; md = 1e+5;\r\n    for(int y=-2;y<=2;y++)\r\n    for(int x=-2;x<=2;x++){\r\n        vec2 n = vec2(x,y);\r\n        vec2 cPos = jitter * hash22(mod(i + n, period) + seed);\r\n        vec2 rPos = n + cPos - f;\r\n        vec2 v = minPos - rPos;\r\n        if(dot(v, v) <= 1e-5) continue;\r\n        float d = dot(0.5 * (minPos + rPos), normalize(rPos - minPos));\r\n        if(d < md){\r\n            md0 = md; md = d;\r\n        }else if(d < md0){\r\n            md0 = d;\r\n        }\r\n    }\r\n    md += (md0 - md) * width;\r\n    return vec3(md, tilePos);\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = 2.*vUV-1.;\r\n    vec2 polar = vec2(atan(uv.y,uv.x)/TAU+0.5,length(uv));\r\n    vec2 frequency = vec2(24,16);\r\n\r\n    vec2 uv0 = vec2(max(0.5,pow(polar.y,0.1)), polar.x);\r\n    uv0.x += 0.01 * abs(noise11(polar.x, 40.0, 0.0));\r\n    vec3 w = voronoi(uv0, frequency, 0.6, 0.1, 0.0);\r\n    float e0 = mix(.1, .0, pow(polar.y, .1));\r\n    float edge = smoothstep(e0+0.18, e0, w.x) * smoothstep(1.0,0.8,polar.y);\r\n#ifdef MASK\r\n    float alpha = smoothstep(-0.5,2.0,2.0*polar.y-edge*noise11(polar.x, 32.0, 0.0));\r\n    float height = 1.0 - pow(edge, 4.0);\r\n    float dhdx = dFdx(height);\r\n    float dhdy = dFdy(height);\r\n    vec3 normal = smoothstep(0.0,0.5,edge) * normalize(vec3(-dhdx, -dhdy, 1));\r\n    fragColor = vec4(0.5+0.5*normal, alpha);\r\n#else\r\n    vec3 color = vec3(0.0);\r\n    color = mix(color, vec3(0.15,0.10,0.20), edge);\r\n    color = mix(color, vec3(0.30,0.20,0.40), smoothstep(0.7,1.0,edge));\r\n    color = mix(color, vec3(1.00,0.20,0.50), smoothstep(0.9,1.0,edge));\r\n    color = mix(color, vec3(1.20,0.80,1.00), smoothstep(0.99,1.0,edge));\r\n\r\n    float alpha = mix(edge * edge, 0.0, smoothstep(0.95,1.0,edge));\r\n\r\n    fragColor = vec4(color, alpha);\r\n#endif\r\n}"},7460:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nin vec3 vPosition;\r\nin vec3 vNormal; \r\nin vec2 vUV;\r\n\r\nlayout(location=0) out vec4 fragColor;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\nuniform CameraUniforms {\r\n    mat4 uViewProjectionMatrix;\r\n    mat4 uViewMatrix;\r\n    vec3 uEyePosition;\r\n};\r\nuniform mat4 uModelMatrix;\r\nuniform sampler2D uPositionBuffer;\r\n\r\n#define TAU 6.283185307179586\r\n\r\nvec3 hash(vec3 p){\r\n\tp = vec3( dot(p,vec3(127.1,311.7, 74.7)),\r\n\t\t\t  dot(p,vec3(269.5,183.3,246.1)),\r\n\t\t\t  dot(p,vec3(113.5,271.9,124.6)));\r\n\treturn -1.0 + 2.0*fract(sin(p)*43758.5453123);\r\n}\r\n\r\nfloat noise3D(in vec3 p){\r\n    vec3 i = floor( p );\r\n    vec3 f = fract( p );\r\n\tvec3 u = f*f*(3.0-2.0*f);\r\n    return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0) ), f - vec3(0.0,0.0,0.0) ), \r\n                          dot( hash( i + vec3(1.0,0.0,0.0) ), f - vec3(1.0,0.0,0.0) ), u.x),\r\n                     mix( dot( hash( i + vec3(0.0,1.0,0.0) ), f - vec3(0.0,1.0,0.0) ), \r\n                          dot( hash( i + vec3(1.0,1.0,0.0) ), f - vec3(1.0,1.0,0.0) ), u.x), u.y),\r\n                mix( mix( dot( hash( i + vec3(0.0,0.0,1.0) ), f - vec3(0.0,0.0,1.0) ), \r\n                          dot( hash( i + vec3(1.0,0.0,1.0) ), f - vec3(1.0,0.0,1.0) ), u.x),\r\n                     mix( dot( hash( i + vec3(0.0,1.0,1.0) ), f - vec3(0.0,1.0,1.0) ), \r\n                          dot( hash( i + vec3(1.0,1.0,1.0) ), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );\r\n}\r\nfloat fbm(in vec3 p, in int layers){\r\n    float f = 0.0, scale = 1.0;\r\n    for(int i=0;i<layers;i++){\r\n        f += scale * abs(noise3D(p));\r\n        scale *= 0.5;\r\n        p *= 1.8;\r\n    }\r\n    return f;\r\n}\r\n\r\nvoid main(){\r\n    vec3 position = vPosition;\r\n    vec3 normal = normalize(vNormal);\r\n    vec3 view = normalize(uEyePosition - position);\r\n    float NdV = dot(normal, view);\r\n\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec4 fragPosition = texelFetch(uPositionBuffer, fragCoord, 0);\r\n    float distance = length(fragPosition.xyz - position);\r\n\r\n    float edge = smoothstep(1.0,0.0,NdV)*smoothstep(-0.5,0.0,NdV);\r\n    edge += smoothstep(0.5,0.0,distance);\r\n\r\n    float n = fbm(position + vec3(0,2.*uTime.x,0), 4);\r\n    vec3 color = vec3(0.0,0.1,0.1);\r\n    color = mix(color, vec3(0.4,0.6,0.6), smoothstep(0.5,0.0,n));\r\n    color = mix(color, vec3(0.6,0.8,0.8), smoothstep(0.2,0.0,n));\r\n    float wave = smoothstep(0.6,1.0,sin(TAU * (0.2*position.y + 0.5*n) + 2.*uTime.x));\r\n    color *= mix(edge,1.0,wave);\r\n\r\n    fragColor = vec4(color,0.1*edge);\r\n}"},2595:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nin vec2 vLife;\r\nin vec3 vPosition;\r\nout vec4 fragColor;\r\n\r\nuniform sampler2D uSampler;\r\nuniform sampler2D uGradient;\r\n\r\nuniform GlobalUniforms {\r\n    vec4 uTime;\r\n};\r\n\r\n#define TAU 6.283185307179586\r\nfloat sineNoise(vec2 uv, int layers, float shift){\r\n    vec2 p = vec2(uv); float v = 0.0;\r\n\tfor(int i=0;i<layers;i++){\r\n\t\tfloat t = shift * (.75+.25*sin(float(i+1)*43758.5453));\r\n        uv.y -= t;\r\n\t\tp = uv + vec2(cos(t - p.x) + sin(t + p.y), sin(t - p.y) + cos(t + p.x));\r\n        v += 1.0/length(1.0/vec2(sin(p.x+t), cos(p.y+t)));\r\n\t}\r\n    v = smoothstep(1.0,0.0,v / float(layers));\r\n    return pow(v,1.4);\r\n}\r\n\r\nvoid main(void){\r\n    vec2 uv = vUV;\r\n\r\n    float alpha = sineNoise(uv*TAU, 4, 411.37+uTime.x+0.2*vPosition.y);\r\n    vec4 color = vec4(mix(smoothstep(0.0,0.8,alpha), smoothstep(0.2,1.0,alpha), vLife.x));\r\n\r\n#ifdef GRADIENT\r\n    color = texture(uGradient, vec2(vLife.x, color.a));\r\n#else\r\n    color *= 4.*vLife.x*(1.-vLife.x);\r\n#endif\r\n#ifdef MASK\r\n    color *= smoothstep(1.0,0.5,length(2.*uv-1.));\r\n#endif\r\n    fragColor = color;\r\n}"},9451:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\nuniform vec4 uColor;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n    fragColor = uColor;\r\n}"},454:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define TAU 6.283185307179586\r\nfloat hash12(in vec2 src) {\r\n    const uint M = 0x5bd1e995u;\r\n    uint h = 1190494759u;\r\n    uvec2 v = floatBitsToUint(src);    \r\n    v *= M; v ^= v>>24u; v *= M;\r\n    h *= M; h ^= v.x; h *= M; h ^= v.y;\r\n    h ^= h>>13u; h *= M; h ^= h>>15u;\r\n    return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\r\n}\r\nfloat noise2D(in vec2 p, in vec2 period){\r\n    vec4 i = floor(p).xyxy + vec4(0,0,1,1);\r\n    vec2 f = fract(p);\r\n\tvec2 u = f*f*(3.0-2.0*f);\r\n    i = mod(i, period.xyxy);\r\n    return mix( mix( hash12(i.xy), \r\n                     hash12(i.zy), u.x),\r\n                mix( hash12(i.xw), \r\n                     hash12(i.zw), u.x), u.y);\r\n}\r\nfloat fbm(in vec2 x, in int octaves, in vec2 period) {\r\n\tfloat v = 0.0, a = 1.0;\r\n\tvec2 shift = vec2(100);\r\n    const mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\r\n\tfor(int i = 0; i < octaves; ++i){\r\n\t\tv += 0.5 * a * noise2D(x / a, period * a);\r\n        x += shift;\r\n        shift = rot * shift;\r\n\t\ta *= 0.5;\r\n\t}\r\n\treturn v;\r\n}\r\n\r\nvoid main(){\r\n    vec2 uv = vUV;\r\n\r\n    float fade = smoothstep(1.0,0.5,abs(uv.y*2.-1.));\r\n    vec2 uv0 = vec2(uv.x+uv.y,uv.x-uv.y);\r\n\r\n    uv0 += 0.2*(1.-2.*fbm(uv * vec2(4.0,2.0), 4, vec2(4.0,2.0)));\r\n    uv.x += 0.6*(1.-2.*fbm(uv0 * vec2(4.0,16.0), 4, vec2(4.0,16.0)));\r\n    \r\n    float offset = sin(uv.x*TAU);\r\n    offset -= sin(uv0.y * TAU * 2.0);\r\n    offset += cos(uv0.x * TAU * 1.0);\r\n    float l = .5+.5*cos(uv0.y*TAU*4.0 + offset);\r\n    l = mix(l, pow(l, 8.0), smoothstep(0.5,1.0,abs(uv.y*2.-1.)));\r\n\r\n    vec3 color = smoothstep(0.1,1.0,l) * fade * vec3(0.14,0.08,0.2) / (.08+1.0-l);\r\n    color *= color.r;\r\n    float alpha = color.r;\r\n\r\n    fragColor = vec4(color,alpha);\r\n}"},1865:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nin vec2 vUV;\r\nout vec4 fragColor;\r\n\r\n#define RESOLUTION 1.0\r\n#define TAU 6.283185307179586\r\n\r\nuvec2 wrap2(in vec2 v, float period){return uvec2(v-period*floor(v/period));}\r\nuint hash(uint x){\r\n    x = (x^(x>>16))*0x7feb352dU;\r\n    x = (x^(x>>15))*0x846ca68bU;\r\n    return (x^(x>>16));\r\n}\r\nvec2 hash22(uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n    n = hash(n);\r\n    return vec2(n*uvec2(0x1U,0x3fffU))*(1.0/float(0xffffffffU));\r\n}\r\nfloat hash21(uvec2 v){\r\n    uint n = v.x*1597334677U^v.y*3812015801U;\r\n    n = hash(n);\r\n    return float(n)*(1.0/float(0xffffffffU));\r\n}\r\nfloat gradN2D(in vec2 value, float period){ \r\n    const vec2 ie = vec2(0, 1);\r\n    vec2 p = floor(value);\r\n    vec2 f = fract(value);\r\n    vec2 w = f*f*(3. - 2.*f); \r\n    return .5+.5*mix(mix(\r\n    dot(hash22(wrap2(p + ie.xx,period)), f-ie.xx),\r\n    dot(hash22(wrap2(p + ie.yx,period)), f-ie.yx), w.x),\r\n    mix(dot(hash22(wrap2(p + ie.xy,period)), f-ie.xy),\r\n    dot(hash22(wrap2(p + ie.yy,period)), f-ie.yy), w.x), w.y);\r\n}\r\n\r\nfloat fbm(in vec2 uv, in float period, in int octaves){\r\n    float value = 0.0, scale = 1.0, weight = 0.0;\r\n    for(int i=0;i<octaves;i++){\r\n        float n = gradN2D(uv,period/scale);\r\n        value += abs(1.-2.*n)*scale;\r\n        weight += scale;\r\n        scale *= 0.5;\r\n        uv *= 2.0;\r\n    }\r\n    return value/weight;\r\n}\r\n\r\nfloat tile0(vec2 uv){\r\n    return max(abs(uv.x),-uv.y);\r\n}\r\nfloat tile1(vec2 uv){\r\n    return abs(min(uv.x, uv.y));\r\n}\r\nfloat tile2(vec2 uv){\r\n    return abs(uv.x);\r\n}\r\nfloat tile3(vec2 uv){\r\n    return min(abs(uv.x), max(-uv.x, abs(uv.y)));\r\n}\r\nfloat tile4(vec2 uv){\r\n    return min(abs(uv.x), abs(uv.y));\r\n}\r\nfloat tileMap(in vec2 uv, in float period){\r\n    int tile = 0;\r\n    vec2 id = floor(uv);\r\n    uv = fract(uv)-.5;\r\n    if(hash21(wrap2(id, period)) >= .5)\r\n        tile += 1;\r\n    if(hash21(wrap2(-id, period)) >= .5)\r\n        tile += 8;\r\n    if(hash21(wrap2(id-vec2(0,1), period)) >= .5)\r\n        tile += 4;\r\n    if(hash21(wrap2(-id-vec2(1,0), period)) >= .5)\r\n        tile += 2;\r\n    switch(tile){\r\n        case 0: return 0.5;\r\n        case 1: return tile0(uv);\r\n        case 2: return tile0(uv.yx);\r\n        case 3: return tile1(uv);\r\n        case 4: return tile0(vec2(uv.x,-uv.y));\r\n        case 5: return tile2(uv);\r\n        case 6: return tile1(vec2(uv.x,-uv.y));\r\n        case 7: return tile3(uv);\r\n        case 8: return tile0(vec2(uv.y,-uv.x));\r\n        case 9: return tile1(vec2(-uv.x,uv.y));\r\n        case 10: return tile2(uv.yx);\r\n        case 11: return tile3(uv.yx);\r\n        case 12: return tile1(vec2(-uv.x,-uv.y));\r\n        case 13: return tile3(vec2(-uv.x, uv.y));\r\n        case 14: return tile3(vec2(-uv.y, uv.x));\r\n        case 15: return tile4(uv);\r\n    }\r\n}\r\n\r\nuniform vec2 uScreenSize;\r\nuniform float uTime;\r\n\r\nvoid main(){\r\n    vec2 uv = vUV * RESOLUTION;\r\n    float scale = 8.0;\r\n    \r\n    float n = fbm(uv*scale, scale, 2);\r\n    n *= .5+.5*cos(TAU * (n + uv.y - 0.5*uTime));\r\n    \r\n    float v = tileMap(uv*scale*2.0,scale*2.0);\r\n    v += 0.25*(1.-2.*smoothstep(0.,0.3,n));\r\n    \r\n    vec3 color = vec3(0.1,0.3,0.2);\r\n    color += smoothstep(0.,0.4, 0.4-v) * vec3(0.3,0.4,0.4);\r\n    color += smoothstep(0.,0.8, 0.8-v) * vec3(0.3,0.5,0.4);\r\n    color += smoothstep(0.05,.1, .1-abs(v-0.1)) * vec3(0.2,0.5,0.4);\r\n    color += smoothstep(0.,.2, .1-abs(v-0.3)) * vec3(0.3,0.6,0.7);\r\n    color += smoothstep(0.,0.1,n) * vec3(0.1,0.1,0.2);\r\n\r\n    fragColor = vec4(color,.5+.5*smoothstep(0.5,1.0,color.b));\r\n}"},9740:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseEase=t.AnimationTimeline=t.EmitterTrigger=t.PropertyAnimation=void 0;var n=r(7594);t.PropertyAnimation=function(e,t,r){void 0===r&&(r=1),e.sort((function(e,t){return e.frame-t.frame}));var i=e.length-1,a=0;return function(o,s){for(o*=r;;)if(a>0&&e[a].frame>o)a--;else{if(!(a<i&&e[a+1].frame<o))break;a++}if(0==a&&e[0].frame>o)return t(s,e[0].value,1,s);if(a==i)return t(s,e[i].value,1,s);var f=e[a],u=e[a+1],c=n.clamp((o-f.frame)/(u.frame-f.frame),0,1);return t(f.value,u.value,(u.ease||n.ease.linear)(c),s)}},t.EmitterTrigger=function(e){return function(t,r,i){var a=t-r;t>=e.frame&&a<e.frame&&(e.origin&&n.vec3.copy(e.origin,i.uniform.uniforms.uOrigin),e.target&&n.vec3.copy(e.target,i.uniform.uniforms.uTarget),i.count+=e.value,i.uniform.frame=0)}},t.AnimationTimeline=function(e,t){var r=Object.keys(t).map((function(r){for(var n=r.split(".").reverse(),i=e,a=n.length-1;a>0;a--)i=i[n[a]];return{sampler:t[r],property:n[0],target:i}}));return function(e,t){for(var n=r.length-1;n>=0;n--){var i=r[n],a=i.sampler,o=i.property,s=i.target;3===a.length?a(e,t,s[o]):s[o]=a(e,s[o]),isNaN(s.frame)||(s.frame=0)}}},t.parseEase=function(e){if(e){var t=e.split(","),r=t[0],i=t.slice(1);return i.length?n.ease[r].apply(n.ease,i.map(Number)):n.ease[r]}}},642:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardSystem=void 0;var r=function(){function e(e){var t=this;this.context=e,this.keys=Object.create(null),addEventListener("keydown",(function(e){t.keys[e.code]>0||(t.keys[e.code]=t.context.frame+1)})),addEventListener("keyup",(function(e){t.keys[e.code]=-t.context.frame-1}))}return e.prototype.update=function(){},e.prototype.down=function(e){return this.keys[e]>0},e.prototype.trigger=function(e){return this.keys[e]===this.context.frame},e.prototype.release=function(e){return this.keys[e]===-this.context.frame},e}();t.KeyboardSystem=r},5164:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialSystem=t.Material=void 0;var i=r(556),a=r(8716),o=r(2982),s=function(){};t.Material=s;var f=function(){function e(e){this.context=e,this.white=new s,this.materials=Object.create(null),this.materialLoad=new a.Signal,this.enabled=!0,this.renderQueue=[],this.white.diffuse=i.createTexture(this.context.gl,{width:1,height:1,data:new Uint8Array([127,127,127,0])}),this.white.normal=i.createTexture(this.context.gl,{width:1,height:1,data:new Uint8Array([127,127,255,0])})}return e.prototype.create=function(){return new s},e.prototype.fullscreenShader=function(e){return i.ShaderProgram(this.context.gl,r(7847),e)},e.prototype.createRenderTexture=function(e,t,r,a){void 0===r&&(r=1);var o=this.context.gl,s=r>1?35866:3553,f=!(r>1),u=i.createTexture(o,{width:e,height:t,depth:r},n({flipY:!1,mipmaps:f?0:9728,type:s,filter:9729,wrap:10497},a)),c=Array(r);if(1===r)c[0]=o.createFramebuffer(),o.bindFramebuffer(36160,c[0]),o.framebufferTexture2D(36160,36064,3553,u,0);else for(var l=0;l<r;l++)c[l]=o.createFramebuffer(),o.bindFramebuffer(36160,c[l]),o.framebufferTextureLayer(36160,36064,u,0,l);return{width:e,height:t,layers:r,target:u,mipmaps:f,type:s,fbo:c}},e.prototype.renderTexture=function(e,t,r,n){var i=this.context.gl;i.bindFramebuffer(36160,e.fbo[t]),i.disable(3042),i.viewport(0,0,e.width,e.height),i.useProgram(r.target),r.uniforms.uTime=this.context.currentTime;var a=1;for(var s in n)n[s]instanceof WebGLTexture?(i.activeTexture(33984+a),i.bindTexture(3553,n[s]),r.uniforms[s]=a++):r.uniforms[s]=n[s];var f=this.context.get(o.PostEffectPass).plane;i.bindVertexArray(f.vao),i.drawElements(4,f.indexCount,5123,f.indexOffset),e.mipmaps&&(i.activeTexture(33984),i.bindTexture(e.type,e.target),i.generateMipmap(3553))},e.prototype.addRenderTexture=function(e,t,r,n,i){var a=this.context.gl;return n.uScreenSize=[e.width,e.height],i<1?(this.renderTexture(e,t,r,n),a.deleteFramebuffer(e.fbo[t]),a.deleteProgram(r.target),e.fbo[t]=null,r.target=null):this.renderQueue.push({rate:i,texture:e,layer:t,program:r,uniforms:n}),e},e.prototype.update=function(){if(this.enabled){this.context.gl;for(var e=this.renderQueue.length-1;e>=0;e--){var t=this.renderQueue[e],r=t.rate,n=t.texture,i=t.layer,a=t.program,o=t.uniforms;this.context.frame%r==0&&this.renderTexture(n,i,a,o)}}},e.prototype.load=function(t,n){var a=this,o=t.texture.length;function f(n,i,a){if(t.model.find((function(e){return e.texture===n.index}))){var o=this.addRenderTexture(this.createRenderTexture(i,a,1),0,this.fullscreenShader(r(6054)),{uSampler:n.diffuse,uScale:e.heightmapScale,uScreenSize:[i,a]},0).target;n.normal=o}}n(o);for(var u=function(e){var r=c.materials[e]=new s;r.index=e;var u=new Image;u.crossOrigin="anonymous",u.onerror=function(r){return n(-1,new Error(""+t.texture[e]))},u.onload=function(e){var t=u.naturalWidth,s=u.naturalHeight,c=i.createTexture(a.context.gl,{width:t,height:s,data:u});r.diffuse=c,f.call(a,r,t,s),a.materialLoad.dispatch(r),n(--o)},u.src=t.texture[e]},c=this,l=o-1;l>=0;l--)u(l)},e.pack2x4=function(e,t){return(Math.floor(15*e)+16*Math.floor(15*t))/255},e.unpack2x4=function(e){return[17*e%1,1.0625*e%1]},e.textureSize=256,e.heightmapScale=10,e}();t.MaterialSystem=f},4132:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.MeshSystem=t.Mesh=t.Armature=void 0;var a=r(7594),o=r(8716),s=r(5164),f=r(3453),u=function(e,t){var r=this;this.inverseBindPose=e,this.frame=0,this.boneMatrix=new Float32Array(12*t.length),this.nodes=t.map((function(e,t){var n=e.position,i=e.rotation,o=e.scale;return{parent:e.parent,position:a.vec3.copy(n||a.vec3.ZERO,a.vec3()),rotation:a.quat.copy(i||a.quat.IDENTITY,a.quat()),scale:a.vec3.copy(o||a.vec3.ONE,a.vec3()),globalTransform:a.mat4(),transform:new Float32Array(r.boneMatrix.buffer,12*t*Float32Array.BYTES_PER_ELEMENT,12)}}))};t.Armature=u;var c=function(){this.index=-1,this.frame=0,this.program=0,this.layer=0,this.bounds=new f.BoundingVolume};t.Mesh=c;var l=function(e){function t(t){var r=e.call(this,c)||this;return r.context=t,r.models=Object.create(null),r}return i(t,e),t.prototype.delete=function(t){e.prototype.delete.call(this,t),t.frame=t.program=t.layer=0,t.armature=t.material=t.buffer=t.transform=null},t.prototype.unloadVertexData=function(e){this.context.gl.deleteBuffer(e.vbo),this.context.gl.deleteBuffer(e.ibo),this.context.gl.deleteVertexArray(e.vao)},t.prototype.updateVertexData=function(e,t){var r=this.context.gl;e.frame=this.context.frame,r.bindBuffer(34962,e.vbo),r.bufferSubData(34962,0,t,0,t.length),a.aabb3.calculate(t,e.format[1].stride,e.format[1].offset,e.aabb),e.radius=f.calculateBoundingRadius(t,e.format[1].stride,e.format[1].offset)},t.prototype.uploadVertexData=function(e,t,r,n){var i=this.context.gl,o=i.createVertexArray();i.bindVertexArray(o);var s=i.createBuffer();i.bindBuffer(34962,s),i.bufferData(34962,e,n?35048:35044);for(var u=1;u<r.length;u++){var c=r[u],l=c.size,d=c.type,h=c.normalized,m=c.stride,v=c.offset;i.enableVertexAttribArray(u-1),i.vertexAttribPointer(u-1,l,d,h,m,v),r[u].divisor&&i.vertexAttribDivisor(u-1,r[u].divisor)}var p=i.createBuffer();return i.bindBuffer(34963,p),i.bufferData(34963,t,35044),i.bindVertexArray(null),{vbo:s,ibo:p,frame:this.context.frame,vao:o,indexCount:t.length,indexOffset:0,format:r,drawMode:4,aabb:a.aabb3.calculate(e,r[1].stride,r[1].offset,a.aabb3()),radius:f.calculateBoundingRadius(e,r[1].stride,r[1].offset)}},t.prototype.update=function(){for(var e=this.list.length-1;e>=0;e--)if(-1!=this.list[e].program){if(e>0&&this.list[e-1].program>this.list[e].program){var t=this.list[e];this.list[e]=this.list[e-1],this.list[e-1]=t,this.list[e].index=e,this.list[e-1].index=e-1}var r=this.list[e];r.frame&&r.frame>=r.transform.frame||(r.bounds.update(r.transform,r.buffer.radius),r.frame=this.context.frame),!r.armature||r.armature.frame>0||this.updateArmature(r.armature)}},t.prototype.updateArmature=function(e){e.frame=this.context.frame;for(var r=0;r<e.nodes.length;r++){var n=e.nodes[r];a.quat.normalize(n.rotation,n.rotation),a.mat4.fromRotationTranslationScale(n.rotation,n.position,n.scale,n.globalTransform),-1!=n.parent&&a.mat4.multiply(e.nodes[n.parent].globalTransform,n.globalTransform,n.globalTransform),a.mat4.multiply(n.globalTransform,e.inverseBindPose[r],t.tempMat4),a.mat4.transpose(t.tempMat4,n.transform)}},t.prototype.load=function(e,t){var r=this;o.loadFile(e.buffer[0],"arraybuffer",(function(n,i){if(-1==n)return t(n,i);if(0!=n)return t(n);for(var a=i,o=function(t){var n=e.model[t],i=new Float32Array(a,n.vertices.byteOffset,n.vertices.byteLength/Float32Array.BYTES_PER_ELEMENT),o=new Uint16Array(a,n.indices.byteOffset,n.indices.byteLength/Uint16Array.BYTES_PER_ELEMENT),s=e.format[n.format],f=r.uploadVertexData(i,o,s);r.models[n.name]={buffer:f,model:n},n.inverseBindPose&&(r.models[n.name].inverseBindPose=n.armature.map((function(e,t){return new Float32Array(a,n.inverseBindPose.byteOffset+16*t*Float32Array.BYTES_PER_ELEMENT,16)})))},s=0;s<e.model.length;s++)o(s);t(n)}))},t.prototype.loadModel=function(e){var t=this.models[e],r=t.model,n=t.inverseBindPose,i=t.buffer,a=new u(n,r.armature),o=this.create();return o.program=o.layer=1,o.buffer=i,o.armature=a,o.material=this.context.get(s.MaterialSystem).materials[r.texture],o},t.tempMat4=a.mat4(),t}(o.Factory);t.MeshSystem=l},200:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteSystem=t.Sprite2D=t.SpriteMaterial=void 0;var a=r(7594),o=r(8716),s=function(){function e(){this.size=a.vec2(1,1),this.uvMatrix=a.mat3x2(),this.domain=a.vec3(0,0,0)}return e.calculateUVMatrix=function(e,t,r){return r[0]=(e[2]-e[0]-1)/t[0],r[1]=0,r[2]=0,r[3]=(e[3]-e[1]-1)/t[1],r[4]=(e[0]+.5)/t[0],r[5]=(e[1]+.5)/t[1],r},e}();t.SpriteMaterial=s;var f=function(){function e(){this.index=-1,this.frame=0,this.order=0,this.vertices=new Float32Array(8),this.uvs=new Float32Array(8),this.indices=e.quadIndices,this.color=a.vec4(1,1,1,1),this.origin=a.vec2(0,0)}return e.prototype.recalculate=function(t){if(this.material&&(0==this.frame&&this.applyTransform(e.quadUVs,this.material.uvMatrix,this.uvs,0),!(this.frame>0&&this.frame>=this.transform.frame))){var r=this.transform.matrix,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],f=r[5],u=this.material.size[0],c=this.material.size[1],l=-this.origin[0]*u,d=l+u,h=-this.origin[1]*c,m=h+c;this.vertices[0]=n*l+a*h+s,this.vertices[1]=o*h+i*l+f,this.vertices[2]=n*d+a*h+s,this.vertices[3]=o*h+i*d+f,this.vertices[4]=n*d+a*m+s,this.vertices[5]=o*m+i*d+f,this.vertices[6]=n*l+a*m+s,this.vertices[7]=o*m+i*l+f,this.frame=t}},e.prototype.applyTransform=function(e,t,r,n){void 0===n&&(n=0);for(var i=t[0],a=t[1],o=t[2],s=t[3],f=t[4],u=t[5],c=e.length-1;c>0;c-=2){var l=e[c-1],d=e[c];r[n+c-1]=i*l+o*d+f,r[n+c]=a*l+s*d+u}},e.quadIndices=new Uint16Array([0,1,2,0,2,3]),e.quadUVs=new Float32Array([0,0,1,0,1,1,0,1]),e}();t.Sprite2D=f;var u=function(e){function t(t){var r=e.call(this,f)||this;return r.context=t,r}return i(t,e),t.prototype.delete=function(t){e.prototype.delete.call(this,t),t.frame=0},t.prototype.update=function(){for(var e=this.list.length-1;e>=0;e--);},t.prototype.createMaterial=function(e,t,r){var n=new s;return s.calculateUVMatrix(t,r,n.uvMatrix),a.vec2.set(t[2]-t[0],t[3]-t[1],n.size),n.diffuse=e,n},t}(o.Factory);t.SpriteSystem=u},8164:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Batch2D=void 0;var a=r(556),o=r(7176),s=r(978),f=function(e){function t(t,r,n,i){var o=e.call(this,t,a.VertexDataFormat.Batched2D,r,n,i)||this;return o.textures=[],o.maxTextures=t.getParameter(34930),o}return i(t,e),t.prototype.render=function(e){var t=e.vertices,r=e.uvs,n=e.indices,i=e.colors,a=e.material,o=n.length,f=t.length>>>1;0==this.indexOffset&&(this.textures.length=0);var u=this.textures.indexOf(a.diffuse);if(-1==u&&this.textures.length>=this.maxTextures||this.indexOffset+o>this.maxIndices||this.vertexOffset+f>this.maxVertices)return!1;-1==u&&(u=this.textures.push(a.diffuse)-1);var c=s.uintNorm4x8(e.color[0],e.color[1],e.color[2],e.color[3]),l=u<<24;if(!this.fixedIndices)for(var d=0;d<o;d++)this.indexArray[this.indexOffset+d]=n[d]+this.vertexOffset;this.indexOffset+=o;for(var h=this.format[1].stride>>>2,m=(d=0,this.vertexOffset*h);d<f;d++,m+=h)this.float32View[m+0]=t[2*d+0],this.float32View[m+1]=t[2*d+1],this.uint32View[m+2]=s.uintNorm2x16(r[2*d],r[2*d+1]),this.uint32View[m+3]=i?i[d]:c,this.uint32View[m+4]=l;return this.vertexOffset+=f,!0},t.prototype.bind=function(){e.prototype.bind.call(this),this.bindTextures(this.textures)},t.prototype.bindTextures=function(e){for(var t=this.gl,r=0;r<e.length;r++)t.activeTexture(33984+r),t.bindTexture(3553,e[r])},t.quadIndices=[0,1,2,0,2,3],t}(o.VertexDataBatch);t.Batch2D=f},8932:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BatchMesh=void 0;var n=r(7594),i=r(3453),a=function(){function e(e,t){if(this.index=-1,this.frame=0,this.order=0,this.color=n.vec4(1,1,1,1),this.bounds=new i.BoundingVolume,t){this.indices=new Uint16Array(2*e.indexArray.length);for(var r=e.indexArray.length/3-1;r>=0;r--)this.indices[3*r+0]=e.indexArray[3*r+2],this.indices[3*r+1]=e.indexArray[3*r+1],this.indices[3*r+2]=e.indexArray[3*r+0];this.indices.set(e.indexArray,e.indexArray.length)}else this.indices=e.indexArray;this._vertices=e.vertexArray;var a=e.vertexArray.byteLength/e.format[1].stride;this.vertices=new Float32Array(3*a),this.uvs=new Float32Array(2*a),this.boundingRadius=i.calculateBoundingRadius(e.vertexArray,e.format[1].stride/Float32Array.BYTES_PER_ELEMENT,e.format[1].offset/Float32Array.BYTES_PER_ELEMENT)}return e.prototype.recalculate=function(e,t){if(!(this.frame>0&&this.frame>=this.transform.frame)){this.frame=e;for(var r=this.vertices.length/3,n=this.transform.matrix,i=r-1;i>=0;i--){var a=this._vertices[8*i+0],o=this._vertices[8*i+1],s=this._vertices[8*i+2];this.vertices[3*i+0]=n[0]*a+n[4]*o+n[8]*s+n[12],this.vertices[3*i+1]=n[1]*a+n[5]*o+n[9]*s+n[13],this.vertices[3*i+2]=n[2]*a+n[6]*o+n[10]*s+n[14],this.uvs[2*i+0]=this._vertices[8*i+6],this.uvs[2*i+1]=this._vertices[8*i+7]}this.bounds.update(this.transform,this.boundingRadius)}},e}();t.BatchMesh=a},8761:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DecalBatch=void 0;var n=r(7594),i=r(556),a=r(978),o=function(){function e(t,r){this.gl=t,this.batchSize=r,this.format=i.VertexDataFormat.Decal,this.instanceOffset=0,this.vao=t.createVertexArray(),t.bindVertexArray(this.vao),this.indexBuffer=t.createBuffer(),t.bindBuffer(34963,this.indexBuffer),t.bufferData(34963,e.unitCubeIndices,35044),this.vertexBuffer=t.createBuffer(),t.bindBuffer(34962,this.vertexBuffer),t.bufferData(34962,e.unitCubeVertices,35044),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,5126,!1,0,0),this.stride=this.format[0].stride/Float32Array.BYTES_PER_ELEMENT,this.float32View=new Float32Array(this.stride*r),this.uint32View=new Uint32Array(this.float32View.buffer),this.instanceBuffer=t.createBuffer(),t.bindBuffer(34962,this.instanceBuffer),t.bufferData(34962,this.float32View.byteLength,35048);for(var n=0,a=0;a<this.format.length;a++)for(var o=this.format[a],s=o.size,f=o.type,u=o.normalized,c=o.stride,l=o.offset,d=s;d>0;d-=4)t.enableVertexAttribArray(++n),t.vertexAttribPointer(n,Math.min(4,d),f,u,c,l),t.vertexAttribDivisor(n,1),l+=Math.min(4,d)*i.GLSLDataType[f].BYTES_PER_ELEMENT;t.bindVertexArray(null)}return e.prototype.render=function(e){var t,r;if(this.instanceOffset+1>=this.batchSize)return!1;var i=a.uintNorm4x8(e.color[0],e.color[1],e.color[2],e.color[3]);if(!i)return!0;var o=(null===(t=e.transform)||void 0===t?void 0:t.matrix)||n.mat4.IDENTITY,s=(null===(r=e.material)||void 0===r?void 0:r.uvMatrix)||n.mat3x2.IDENTITY,f=this.instanceOffset*this.stride;return this.float32View.set(o,f),this.float32View[f+3]=e.threshold,this.float32View[f+7]=0,this.float32View[f+11]=0,this.float32View[f+15]=1,this.uint32View[f+16]=a.uintNorm2x16(s[4],s[5]),this.uint32View[f+17]=a.uintNorm2x16(s[0]+s[2]+s[4],s[1]+s[3]+s[5]),this.uint32View[f+18]=i,this.instanceOffset++,!0},e.prototype.bind=function(){var e=this.gl;e.bindVertexArray(this.vao),this.instanceOffset&&(e.bindBuffer(34962,this.instanceBuffer),e.bufferSubData(34962,0,this.float32View.subarray(0,this.instanceOffset*this.stride)),this.instanceOffset=0)},e.prototype.delete=function(){this.gl.deleteBuffer(this.indexBuffer),this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.instanceBuffer),this.gl.deleteVertexArray(this.vao)},e.unitCubeVertices=new Float32Array([-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5]),e.unitCubeIndices=new Uint16Array([1,5,7,1,7,3,0,2,6,0,6,4,2,3,7,2,7,6,0,4,5,0,5,1,4,6,7,4,7,5,0,1,3,0,3,2]),e}();t.DecalBatch=o},978:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryBatch=t.uintNorm2x16=t.uintNorm4x8=t.uint16x2=t.uint8x4=void 0;var a=r(556),o=r(7176);t.uint8x4=function(e,t,r,n){return 255&e|65280&t<<8|16711680&r<<16|4278190080&n<<24},t.uint16x2=function(e,t){return 4294901760&t<<16|65535&e},t.uintNorm4x8=function(e,t,r,n){return 255*e|255*t<<8|255*r<<16|255*n<<24},t.uintNorm2x16=function(e,t){return 65535*t<<16|65535&(65535*e|0)};var s=function(e){function r(t,r,n,i){var o=e.call(this,t,a.VertexDataFormat.Batched,r,n,i)||this;return o.textures=[],o.maxTextures=t.getParameter(34930),o}return i(r,e),r.prototype.render=function(e){var r=e.vertices,n=e.uvs,i=e.indices,a=e.colors,o=e.material,s=i.length,f=r.length>>>1;0==this.indexOffset&&(this.textures.length=0);var u=this.textures.indexOf(o.diffuse);if(-1==u&&this.textures.length>=this.maxTextures||this.indexOffset+s>this.maxIndices||this.vertexOffset+f>this.maxVertices)return!1;var c=t.uintNorm4x8(e.color[0],e.color[1],e.color[2],e.color[3]);if(!c)return!0;-1==u&&(u=this.textures.push(o.diffuse)-1);var l=t.uint8x4(o.domain[0],o.domain[1],o.domain[2],u);if(!this.fixedIndices)for(var d=0;d<s;d++)this.indexArray[this.indexOffset+d]=i[d]+this.vertexOffset;this.indexOffset+=s;for(var h=this.format[1].stride>>>2,m=(d=0,this.vertexOffset*h);d<f;d++,m+=h)this.float32View[m+0]=r[3*d+0],this.float32View[m+1]=r[3*d+1],this.float32View[m+2]=r[3*d+2],this.uint32View[m+3]=t.uintNorm2x16(n[2*d],n[2*d+1]),this.uint32View[m+4]=a?a[d]:c,this.uint32View[m+5]=l;return this.vertexOffset+=f,!0},r.prototype.bind=function(){e.prototype.bind.call(this),this.bindTextures(this.textures)},r.prototype.bindTextures=function(e){for(var t=this.gl,r=0;r<e.length;r++)t.activeTexture(33984+r),t.bindTexture(3553,e[r])},r.quadIndices=[0,1,2,0,2,3],r}(o.VertexDataBatch);t.GeometryBatch=s},349:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Line=void 0;var n=r(7594),i=r(3453),a=function(){function e(){this.frame=0,this.vertices=new Float32Array(0),this.uvs=new Float32Array(0),this.indices=new Uint16Array(0),this.color=n.vec4(1,1,1,1),this.bounds=new i.BoundingVolume,this.width=1,this.height=0}return e.prototype.recalculate=function(t,r){if(!(this.frame>0&&this.frame>=r.frame)){this.frame=t;var i=this.path.length;this.vertices&&this.vertices.length==6*i||this.resize(i);var a=e.forward,o=e.normal,s=e.tangent;n.vec3.copy(n.vec3.ZERO,s),n.vec3.set(-r.viewMatrix[2],-r.viewMatrix[6],-r.viewMatrix[10],a);for(var f=0,u=0;u<i;u++){var c=this.path[u],l=this.path[u+1]||c;n.vec3.subtract(l,c,o),n.vec3.normalize(o,o),n.vec3.add(s,o,s),n.vec3.cross(a,s,s),n.vec3.normalize(s,s),n.vec3.scale(s,.5*this.width,s),this.vertices[6*u+0]=c[0]-s[0],this.vertices[6*u+1]=c[1]-s[1],this.vertices[6*u+2]=c[2]-s[2],this.vertices[6*u+3]=c[0]+s[0],this.vertices[6*u+4]=c[1]+s[1],this.vertices[6*u+5]=c[2]+s[2],n.vec3.copy(o,s),f+=n.vec3.distanceSquared(c,l)}this.height=Math.sqrt(f)/this.width,this.bounds.fromVertices(this.vertices,3,0,t)}},e.prototype.resize=function(e){this.vertices=new Float32Array(2*e*3),this.uvs=new Float32Array(2*e*2),this.indices=new Uint16Array(6*(e-1));for(var t=e-2;t>=0;t--)this.indices[6*t+0]=2*t+0,this.indices[6*t+1]=2*t+1,this.indices[6*t+2]=2*t+2,this.indices[6*t+3]=2*t+2,this.indices[6*t+4]=2*t+1,this.indices[6*t+5]=2*t+3;for(t=e-1;t>=0;t--)this.uvs[4*t+0]=this.uvs[4*t+2]=1-t/(e-1),this.uvs[4*t+1]=0,this.uvs[4*t+3]=1},e.forward=n.vec3(),e.normal=n.vec3(),e.tangent=n.vec3(),e}();t.Line=a},7554:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite=void 0;var n=r(7594),i=r(3453),a=function(){function e(){this.billboard=0,this.index=-1,this.frame=0,this.order=0,this.vertices=new Float32Array(12),this.uvs=new Float32Array(e.quadUVs),this.indices=e.quadIndices,this.color=n.vec4(1,1,1,1),this.bounds=new i.BoundingVolume,this.origin=n.vec2(.5,.5)}return e.prototype.recalculate=function(t,r){if(0==this.frame&&this.material&&this.applyTransform2D(e.quadUVs,this.material.uvMatrix,this.uvs,0),!(this.frame>0&&this.frame>=r.frame&&this.frame>=this.transform.frame)){var i=this.material.size[0],a=this.material.size[1],o=-this.origin[0]*i,s=o+i,f=-this.origin[1]*a,u=f+a;(!this.frame||this.frame<this.transform.frame)&&this.bounds.update(this.transform,Math.max(i,a));var c=this.transform.matrix,l=e.normal,d=e.tangent;switch(this.billboard){case 0:n.vec3.set(c[0],c[1],c[2],l),n.vec3.set(c[4],c[5],c[6],d);break;case 2:n.vec3.set(r.viewMatrix[0],r.viewMatrix[4],r.viewMatrix[8],l),n.vec3.set(r.viewMatrix[1],r.viewMatrix[5],r.viewMatrix[9],d),n.mat4.transformNormal(l,c,l),n.mat4.transformNormal(d,c,d);break;case 3:n.vec3.set(c[4],c[5],c[6],l);var h=n.vec3.set(c[12],c[13],c[14],e.forward);n.vec3.subtract(r.position,h,h),n.vec3.cross(h,l,d),n.vec3.normalize(d,d),n.vec3.scale(d,Math.hypot(c[0],c[1],c[2]),d)}this.vertices[0]=l[0]*o+d[0]*f+c[12],this.vertices[1]=l[1]*o+d[1]*f+c[13],this.vertices[2]=l[2]*o+d[2]*f+c[14],this.vertices[3]=l[0]*s+d[0]*f+c[12],this.vertices[4]=l[1]*s+d[1]*f+c[13],this.vertices[5]=l[2]*s+d[2]*f+c[14],this.vertices[6]=l[0]*s+d[0]*u+c[12],this.vertices[7]=l[1]*s+d[1]*u+c[13],this.vertices[8]=l[2]*s+d[2]*u+c[14],this.vertices[9]=l[0]*o+d[0]*u+c[12],this.vertices[10]=l[1]*o+d[1]*u+c[13],this.vertices[11]=l[2]*o+d[2]*u+c[14],this.frame=t}},e.prototype.applyTransform2D=function(e,t,r,n){void 0===n&&(n=0);for(var i=t[0],a=t[1],o=t[2],s=t[3],f=t[4],u=t[5],c=e.length-1;c>0;c-=2){var l=e[c-1],d=e[c];r[n+c-1]=i*l+o*d+f,r[n+c]=a*l+s*d+u}},e.quadIndices=new Uint16Array([0,1,2,0,2,3]),e.quadUVs=new Float32Array([0,0,1,0,1,1,0,1]),e.normal=n.vec3(),e.tangent=n.vec3(),e.forward=n.vec3(),e}();t.Sprite=a},7176:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexDataBatch=void 0;var r=function(){function e(e,t,r,n,i){if(this.gl=e,this.format=t,this.maxVertices=r,this.maxIndices=n,this.fixedIndices=i,this.indexOffset=0,this.vertexOffset=0,this.indexArray=new Uint16Array(n),i)for(var a=0;a<this.indexArray.length;a++)this.indexArray[a]=i[a%i.length]+4*Math.floor(a/i.length);var o=new ArrayBuffer(r*t[1].stride);this.float32View=new Float32Array(o),this.uint32View=new Uint32Array(o),this.vao=e.createVertexArray(),e.bindVertexArray(this.vao),this.indexBuffer=e.createBuffer(),e.bindBuffer(34963,this.indexBuffer),e.bufferData(34963,this.indexArray,i?35044:35048),this.vertexBuffer=e.createBuffer(),e.bindBuffer(34962,this.vertexBuffer),e.bufferData(34962,o.byteLength,35048);for(var s=1;s<t.length;s++){var f=t[s],u=f.size,c=f.type,l=f.normalized,d=f.stride,h=f.offset;e.enableVertexAttribArray(s-1),e.vertexAttribPointer(s-1,u,c,l,d,h)}e.bindVertexArray(null)}return e.prototype.bind=function(){var e=this.gl;e.bindVertexArray(this.vao),this.indexOffset&&(this.fixedIndices||(e.bindBuffer(34963,this.indexBuffer),e.bufferSubData(34963,0,this.indexArray.subarray(0,this.indexOffset))),e.bindBuffer(34962,this.vertexBuffer),e.bufferSubData(34962,0,this.float32View.subarray(0,this.vertexOffset*(this.format[1].stride>>>2))),this.indexOffset=0,this.vertexOffset=0)},e.prototype.delete=function(){this.gl.deleteBuffer(this.indexBuffer),this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteVertexArray(this.vao)},e}();t.VertexDataBatch=r},7908:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7176),t),i(r(8164),t),i(r(978),t),i(r(8761),t),i(r(349),t),i(r(7554),t),i(r(8932),t)},7953:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebugSystem=void 0;var n=r(7594),i=r(556),a=r(8211),o=r(2982),s=function(){function e(e){var t=this;this.options=e,this.dom=document.createElement("div"),this.label=document.createElement("div"),this.canvas=document.createElement("canvas"),this.prevTimestamp=0,this.timeElapsed=0,this.values=[],this.update=function(e){var r=e-t.prevTimestamp;t.prevTimestamp=e,t.timeElapsed+=r,t.options.update&&t.options.update.call(t,r),t.timeElapsed>=t.options.refreshRate&&(t.timeElapsed=0,t.render()),requestAnimationFrame(t.update)},Object.assign(this.dom.style,{display:"inline-block",padding:"0.2em",backgroundColor:"rgba(0,0,0,1)",color:e.color}),this.dom.appendChild(this.label),Object.assign(this.canvas.style,{boxSizing:"border-box",border:"1px solid "+e.color}),this.dom.appendChild(this.canvas),Object.assign(this.canvas,{width:72,height:36}),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.ctx.imageSmoothingEnabled=!1,this.update(0)}return e.prototype.render=function(){var e=this,t=e.ctx,r=e.canvas,n=e.values,i=e.options,a=i.range,o=i.color;t.globalCompositeOperation="copy",t.drawImage(r,0,0,r.width,r.height,1,0,r.width,r.height),t.globalCompositeOperation="source-over";var s=n.reduce((function(e,t){return e+t}),0)/n.length;n.length=0;var f=(s-a[0])/(a[1]-a[0])*r.height|0;t.fillStyle=o,t.fillRect(0,r.height-f,1,f),this.label.innerText=this.options.label+": "+s.toFixed(2)},e}(),f=function(){function e(e){this.context=e,window.app=e,this.program=i.ShaderProgram(this.context.gl,a.shaders.fullscreen_vert,a.shaders.fullscreen_frag),this.program.uniforms.uMask=n.vec4.ONE,this.attachDebugPanel()}return e.prototype.attachDebugPanel=function(){var e=document.createElement("div");Object.assign(e.style,{position:"fixed",top:0,left:0,zIndex:128,fontSize:"0.8em"});var t=new s({refreshRate:100,color:"#83e82a",label:"FPS",range:[0,60],update:function(e){this.values.push(1e3/e)}}),r={drawElements:0,drawArrays:0,drawArraysInstanced:0,drawElementsInstanced:0,blitFramebuffer:0},n=function(e){var t;i.context.gl[e]=(t=i.context.gl[e],function(){return r[e]++,t.apply(this,arguments)})},i=this;for(var a in r)n(a);var o=new s({refreshRate:100,color:"#e8632a",label:"DC",range:[0,40],update:function(e){this.values.push(r.drawArrays+r.drawElements+r.drawArraysInstanced+r.drawElementsInstanced+r.blitFramebuffer),r.drawArrays=r.drawElements=r.drawArraysInstanced=r.drawElementsInstanced=r.blitFramebuffer=0}});e.appendChild(t.dom),e.appendChild(o.dom),document.body.appendChild(e)},e.prototype.update=function(){this.texture&&this.renderDebugTexture(this.texture)},e.prototype.renderDebugTexture=function(e){var t=this.context.gl,r=this.context.get(o.PostEffectPass).plane;t.bindFramebuffer(36160,null),t.bindVertexArray(r.vao),t.useProgram(this.program.target),t.activeTexture(33984+i.UniformSamplerBindings.uSampler),t.bindTexture(3553,e),t.drawElements(4,r.indexCount,5123,r.indexOffset)},e}();t.DebugSystem=f},8895:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AmbientLightPass=t.HemisphereLight=void 0;var n=r(7594),i=r(556),a=r(6479),o=r(2982),s=r(8211),f=function(){function e(){this.frame=0,this.axis=n.vec3(0,1,0),this.color0=n.vec3(.15,.16,.18),this.color1=n.vec3(.05,.04,.03)}return e.prototype.update=function(e){this.frame||(this.frame=e.frame,this.uniform||(this.uniform=new i.UniformBlock(e.gl,{byteSize:48},i.UniformBlockBindings.LightUniforms)),this.uniform.data.set(this.axis,0),this.uniform.data.set(this.color0,4),this.uniform.data.set(this.color1,8))},e}();t.HemisphereLight=f;var u=function(){function e(e){this.context=e,this.environment=new f,this.program=i.ShaderProgram(this.context.gl,s.shaders.fullscreen_vert,r(2807))}return e.prototype.update=function(){var e=this.context.gl;this.context.get(o.PostEffectPass).swapRenderTarget(!1,!1),e.depthMask(!1),e.enable(3042),e.disable(2929),e.cullFace(1028),e.blendFunc(1,1),e.clear(16384),this.context.get(a.DeferredGeometryPass).bindReadBuffer(),this.environment.update(this.context);var t=this.context.get(o.PostEffectPass).plane;e.useProgram(this.program.target),e.bindVertexArray(t.vao),this.environment.uniform.bind(e,i.UniformBlockBindings.LightUniforms),e.drawElements(4,t.indexCount,5123,t.indexOffset)},e}();t.AmbientLightPass=u},2284:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BloomEffect=void 0;var n=r(7594),i=r(556),a=function(){function e(t){this.context=t,this.enabled=!0,this.fbo=[],this.renderTarget=[],this.iterations=2,this.mask=n.vec4(2,2,2,2);var a=t.gl;this.brightness=i.ShaderProgram(a,r(7847),r(7104),{MASK:!0,BRIGHTNESS:!1}),this.blur=i.ShaderProgram(a,r(7847),r(8706),{KERNEL_SIZE:9}),this.width=a.drawingBufferWidth/e.downscale,this.height=a.drawingBufferHeight/e.downscale;for(var o=0;o<2;o++)this.renderTarget[o]=i.createTexture(a,{width:this.width,height:this.height},{flipY:!1,wrap:33071,format:32856,mipmaps:0,filter:9729}),this.fbo[o]=a.createFramebuffer(),a.bindFramebuffer(36160,this.fbo[o]),a.framebufferTexture2D(36160,36064,3553,this.renderTarget[o],0);a.bindFramebuffer(36160,null)}return e.prototype.apply=function(t){if(this.enabled){var r=this.context.gl;r.activeTexture(33984+i.UniformSamplerBindings.uSampler),r.bindTexture(3553,t.renderTarget[t.index]),r.useProgram(this.brightness.target),r.bindFramebuffer(36160,this.fbo[0]),r.viewport(0,0,this.width,this.height),this.context.gl.drawElements(4,t.plane.indexCount,5123,t.plane.indexOffset),r.useProgram(this.blur.target);for(var n=0,a=0;a<this.iterations;a++)r.bindTexture(3553,this.renderTarget[n]),n^=1,this.blur.uniforms.uSize=n?e.horizontal:e.vertical,r.bindFramebuffer(36160,this.fbo[n]),this.context.gl.drawElements(4,t.plane.indexCount,5123,t.plane.indexOffset)}},Object.defineProperty(e.prototype,"active",{get:function(){return this.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.enabled?this.renderTarget[1&this.iterations]:null},enumerable:!1,configurable:!0}),e.downscale=4,e.horizontal=n.vec2(1,0),e.vertical=n.vec2(0,1),e}();t.BloomEffect=a},5448:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DecalPass=t.Decal=void 0;var n=r(7594),i=r(1974),a=r(6479),o=r(3453),s=r(556),f=r(7908),u=r(8211),c=function(){function e(){this.frame=0,this.order=0,this.color=n.vec4(1,1,1,1),this.threshold=0,this.bounds=new o.BoundingVolume}return e.prototype.update=function(e,t){this.frame&&this.frame>=this.transform.frame||(this.frame=e,this.bounds.update(this.transform,1))},e}();t.Decal=c;var l=function(){function e(e){this.context=e,this.pool=[],this.list=[],this.effects=[];var t=this.context.gl;this.batch=new f.DecalBatch(t,128),this.program=s.ShaderProgram(t,u.shaders.decal_vert,u.shaders.decal_frag,{INSTANCED:!0,NORMAL_MAPPING:!0,MASK:!0}),this.program.uniforms.uLayer=1,this.program.uniforms.uDissolveEdge=.1,this.defaultNormalMap=s.createTexture(t,{width:1,height:1,data:new Uint8Array([127,127,127,0])});var r=this.context.get(a.DeferredGeometryPass);this.fbo=t.createFramebuffer(),t.bindFramebuffer(36160,this.fbo),t.framebufferRenderbuffer(36160,36096,36161,r.depth),t.framebufferTexture2D(36160,36064,3553,r.albedo,0),t.framebufferTexture2D(36160,36065,3553,r.normal,0),t.drawBuffers([36064,36065]),t.bindFramebuffer(36160,null)}return e.prototype.create=function(t){var r=this.pool.pop()||new c;r.order=t;var i=n.binarySearch(this.list,r,e.orderSort,!0);return this.list.splice(i,0,r),r},e.prototype.delete=function(e){var t=this.list.indexOf(e);-1!=t&&(this.list.splice(t,1),this.pool.push(e),n.vec4.copy(n.vec4.ONE,e.color),e.frame=e.threshold=0,e.transform=e.material=null)},e.prototype.update=function(){var e=this.context.gl;e.enable(2929),e.depthFunc(518),e.depthMask(!1),e.cullFace(1028),e.enable(3042),e.blendFuncSeparate(1,771,0,1),e.bindFramebuffer(36160,this.fbo),e.activeTexture(33984+s.UniformSamplerBindings.uPositionBuffer),e.bindTexture(3553,this.context.get(a.DeferredGeometryPass).position);for(var t=this.context.get(i.CameraSystem).camera,r=null,n=this.list.length-1;n>=0;n--){var o=this.list[n];if(o.update(this.context.frame,this.context),t.culling.cull(o.bounds)){if(r||(r=o.material),o.material.diffuse!==r.diffuse||o.material.program!==r.program)n++;else if(this.batch.render(o)){if(n)continue}else n++;var u=r.diffuse,c=r.normal,l=void 0===c?this.defaultNormalMap:c,d=r.program,h=void 0===d?this.program:d;r=null;var m=this.batch.instanceOffset;m&&(this.batch.bind(),e.useProgram(h.target),e.activeTexture(33984+s.UniformSamplerBindings.uDiffuseMap),e.bindTexture(3553,u),e.activeTexture(33984+s.UniformSamplerBindings.uNormalMap),e.bindTexture(3553,l),e.drawElementsInstanced(4,f.DecalBatch.unitCubeIndices.length,5123,0,m))}}for(n=this.effects.length-1;n>=0;n--)this.effects[n].apply()},e.orderSort=function(e,t){return e.order-t.order},e}();t.DecalPass=l},1321:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DistortionEffect=void 0;var n=r(556),i=r(7304),a=r(1974),o=r(8211),s=function(){function e(e){this.context=e,this.list=[],this.enabled=!0;var t=this.context.gl;this.program=n.ShaderProgram(t,o.shaders.batch_vert,o.shaders.distortion_frag,{}),this.batch=this.context.get(i.ParticleEffectPass).batch}return e.prototype.add=function(e){this.list.push(e)},e.prototype.remove=function(e){var t=this.list.indexOf(e);-1!=t&&this.list.splice(t,1)},Object.defineProperty(e.prototype,"active",{get:function(){return this.list.length&&this.enabled},enumerable:!1,configurable:!0}),e.prototype.apply=function(e,t){var r=this.context.gl;r.activeTexture(33984+n.UniformSamplerBindings.uAlbedoBuffer),r.bindTexture(3553,e.renderTarget[e.index]),e.swapRenderTarget(t,!0),r.depthFunc(515),r.enable(2929);for(var i=this.context.get(a.CameraSystem).camera,o=null,s=this.list.length-1;s>=0;s--){var f=this.list[s];if(f.recalculate(this.context.frame,i),i.culling.cull(f.bounds)){if(o||(o=f.material),o.diffuse!==f.material.diffuse||o.program!==f.material.program)s++;else if(this.batch.render(f)){if(s)continue}else s++;o.diffuse;var u=o.program,c=void 0===u?this.program:u;o=null;var l=this.batch.indexOffset;l&&(this.batch.bind(),r.useProgram(c.target),r.drawElements(4,l,5123,0))}}},e}();t.DistortionEffect=s},6479:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeferredGeometryPass=void 0;var n=r(7594),i=r(1974),a=r(4132),o=r(556),s=function(){function e(e){this.context=e,this.effects=[];var t=e.gl;this.allocateGeometryBuffer(t,t.drawingBufferWidth,t.drawingBufferHeight),this.programs=[o.ShaderProgram(t,r(373),r(7947),{NORMAL_MAPPING:!0}),o.ShaderProgram(t,r(373),r(7947),{SKINNING:!0,NORMAL_MAPPING:!0,COLOR_INDEX:!0})],t.clearDepth(1)}return e.prototype.bindReadBuffer=function(){var e=this.context.gl;e.activeTexture(33984+o.UniformSamplerBindings.uPositionBuffer),e.bindTexture(3553,this.position),e.activeTexture(33984+o.UniformSamplerBindings.uNormalBuffer),e.bindTexture(3553,this.normal),e.activeTexture(33984+o.UniformSamplerBindings.uAlbedoBuffer),e.bindTexture(3553,this.albedo)},e.prototype.update=function(){var e,t=this.context.gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.bindFramebuffer(36160,this.gbuffer),t.enable(2884),t.depthFunc(515),t.enable(2929),t.cullFace(1029),t.clearColor(0,0,0,0),t.depthMask(!0),t.disable(3042),t.clear(16640);var r=this.context.get(i.CameraSystem).camera;r.uniform.bind(t,o.UniformBlockBindings.CameraUniforms),this.context.get(i.CameraSystem).uniform.bind(t,o.UniformBlockBindings.GlobalUniforms);for(var s=this.context.get(a.MeshSystem).list,f=-1,u=s.length-1;u>=0;u--){var c=s[u];-1!=c.program&&(f!=c.program&&t.useProgram(this.programs[f=c.program].target),r.culling.cull(c.bounds)&&(this.programs[f].uniforms.uLayer=c.layer+1,this.programs[f].uniforms.uModelMatrix=(null===(e=c.transform)||void 0===e?void 0:e.matrix)||n.mat4.IDENTITY,c.armature&&(this.programs[f].uniforms.uBoneMatrix=c.armature.boneMatrix),t.activeTexture(33984+o.UniformSamplerBindings.uDiffuseMap),t.bindTexture(3553,c.material.diffuse),t.activeTexture(33984+o.UniformSamplerBindings.uNormalMap),t.bindTexture(3553,c.material.normal),c.material.array&&(t.activeTexture(33984+o.UniformSamplerBindings.uArrayMap),t.bindTexture(35866,c.material.array),this.programs[f].uniforms.uArrayMapLayers=c.material.arrayLayers-1),t.bindVertexArray(c.buffer.vao),t.drawElements(4,c.buffer.indexCount,5123,c.buffer.indexOffset)))}for(u=this.effects.length-1;u>=0;u--)this.effects[u].apply()},e.prototype.allocateGeometryBuffer=function(e,t,r){if(!e.getExtension("EXT_color_buffer_float"))throw new Error("FLOAT color buffer not available");if(this.position=o.createTexture(e,{width:t,height:r},{format:34842,filter:9728,wrap:33071,mipmaps:0}),this.normal=o.createTexture(e,{width:t,height:r},{format:34842,filter:9728,wrap:33071,mipmaps:0}),this.albedo=o.createTexture(e,{width:t,height:r},{format:32856,filter:9728,wrap:33071,mipmaps:0}),this.depth=e.createRenderbuffer(),e.bindRenderbuffer(36161,this.depth),e.renderbufferStorage(36161,33189,t,r),this.gbuffer=e.createFramebuffer(),e.bindFramebuffer(36160,this.gbuffer),e.framebufferRenderbuffer(36160,36096,36161,this.depth),e.framebufferTexture2D(36160,36064,3553,this.position,0),e.framebufferTexture2D(36160,36065,3553,this.normal,0),e.framebufferTexture2D(36160,36066,3553,this.albedo,0),e.drawBuffers([36064,36065,36066]),36053!=e.checkFramebufferStatus(36160))throw new Error("Framebuffer incomplete!");e.bindFramebuffer(36160,null)},e}();t.DeferredGeometryPass=s},8425:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OverlayPass=void 0;var n=r(7594),i=r(556),a=r(7908),o=function(){function e(e){this.context=e;var t=e.gl,o=t.getParameter(34930),s=r(7064);s=s.replace(/^#FOR(.*)$/gm,(function(e,t){return n.range(o).map((function(e){return t.replace(/#i/g,e)})).join("\n")})),this.program=i.ShaderProgram(t,r(7023),s,{MAX_TEXTURE_UNITS:o}),this.program.uniforms.uSamplers=n.range(o),this.batch=new a.Batch2D(this.context.gl,4096,6144,null)}return e.prototype.update=function(){},e}();t.OverlayPass=o},7304:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleEffectPass=void 0;var n=r(7594),i=r(556),a=r(7908),o=r(1974),s=r(4132),f=r(6479),u=function(){function e(t){this.context=t,this.effects=[],this.list=[];var o=t.gl,s=o.getParameter(34930);this.batch=new a.GeometryBatch(o,4*e.batchSize,6*e.batchSize),this.program=i.ShaderProgram(o,r(898),r(7676).replace(/^#FOR(.*)$/gm,(function(e,t){return n.range(s).map((function(e){return t.replace(/#i/g,e)})).join("\n")})),{MAX_TEXTURE_UNITS:s}),this.program.uniforms.uSamplers=n.range(s)}return e.prototype.add=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=this.list).push.apply(e,t)},e.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=e.length-1;r>=0;r--){var n=e[r],i=this.list.indexOf(n);-1!=i&&(this.list[i]=this.list[this.list.length-1],this.list.length--)}},e.prototype.sort=function(e,t){for(var r=e.length,n=void 0,i=0;i<r;i++){var a=e[i];for(n=i-1;n>=0&&a.order>e[n].order;n--)e[n+1]=e[n];e[n+1]=a}},e.prototype.update=function(){var e,t,r=this.context.gl;r.cullFace(1029),r.enable(2884),r.depthFunc(515),r.enable(2929),r.enable(3042),r.blendFuncSeparate(1,771,0,1);for(var n=this.context.get(o.CameraSystem).camera,i=(null===(e=this.list[this.list.length-1])||void 0===e?void 0:e.material.program)||this.program,a=this.list.length-1;a>=0;a--){var u=this.list[a];if(null===(t=u.recalculate)||void 0===t||t.call(u,this.context.frame,n),n.culling.cull(u.bounds)){var c=u.material.program||this.program,l=c===i&&u.vertices&&this.batch.render(u);if(!l||!a){if(this.batch.indexOffset){r.useProgram(i.target);var d=this.batch.indexOffset;this.batch.bind(),r.drawElements(4,d,5123,0)}u instanceof s.Mesh?this.renderMesh(u):(l||a++,i=c)}}}for(this.context.get(f.DeferredGeometryPass).bindReadBuffer(),a=this.effects.length-1;a>=0;a--)this.effects[a].apply()},e.prototype.renderMesh=function(e){var t,r=this.context.gl;r.bindVertexArray(e.buffer.vao),r.useProgram(e.material.program.target),r.activeTexture(33984+i.UniformSamplerBindings.uDiffuseMap),r.bindTexture(3553,e.material.diffuse),e.material.program.uniforms.uModelMatrix=(null===(t=e.transform)||void 0===t?void 0:t.matrix)||n.mat4.IDENTITY,r.drawElements(e.buffer.drawMode,e.buffer.indexCount,5123,e.buffer.indexOffset)},e.batchSize=1024,e}();t.ParticleEffectPass=u},5060:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.PointLightPass=t.PointLight=void 0;var a=r(7594),o=r(6240),s=r(8716),f=r(4132),u=r(1974),c=r(3453),l=r(556),d=function(){function e(){this.index=-1,this.frame=0,this.color=a.vec3(1,1,1),this.intensity=1,this.radius=1,this.bounds=new c.BoundingVolume}return e.prototype.update=function(e){var t;this.frame&&this.frame>=this.transform.frame||(this.frame=e.frame,this.uniform||(this.uniform=new l.UniformBlock(e.gl,{byteSize:88},l.UniformBlockBindings.LightUniforms)),this.bounds.update(this.transform,this.radius),this.uniform.data.set((null===(t=this.transform)||void 0===t?void 0:t.matrix)||a.mat4.IDENTITY,0),this.uniform.data.set(this.color,16),this.uniform.data[20]=this.radius,this.uniform.data[21]=this.intensity)},e}();t.PointLight=d;var h=function(e){function t(t){var n=e.call(this,d)||this;n.context=t;var i=t.gl;n.program=l.ShaderProgram(i,r(3801),r(2119),{OMNILIGHT:!0,GGX:!0,SCHLICK:!0});var a=o.createSphere({longitude:32,latitude:32,radius:1});return n.sphere=n.context.get(f.MeshSystem).uploadVertexData(a.vertexArray,a.indexArray,a.format),n}return i(t,e),t.prototype.delete=function(t){e.prototype.delete.call(this,t),t.frame=0},t.prototype.update=function(){var e=this.context.gl,t=this.context.get(u.CameraSystem).camera,r=this.list;e.useProgram(this.program.target),e.bindVertexArray(this.sphere.vao);for(var n=r.length-1;n>=0;n--){var i=r[n];i.update(this.context),t.culling.cull(i.bounds)&&(i.uniform.bind(e,l.UniformBlockBindings.LightUniforms),e.drawElements(4,this.sphere.indexCount,5123,this.sphere.indexOffset))}},t}(s.Factory);t.PointLightPass=h},2982:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PostEffectPass=void 0;var n=r(7594),i=r(6240),a=r(4132),o=r(556),s=r(2284),f=r(1321),u=r(6479),c=r(8211),l=function(){function e(e){this.context=e,this.enabled=!0,this.color=n.vec4(.2,.2,.2,0),this.range=n.vec2(5,30),this.program=o.ShaderProgram(this.context.gl,c.shaders.fullscreen_vert,c.shaders.fog_frag,{LINEAR_FOG:!0,BLOOM:!0}),this.program.uniforms.uBloomMap=o.UniformSamplerBindings.uNormalMap}return Object.defineProperty(e.prototype,"active",{get:function(){return this.enabled},enumerable:!1,configurable:!0}),e.prototype.apply=function(e,t){var r=this.context.gl;e.swapRenderTarget(t,!1),r.useProgram(this.program.target),this.program.uniforms.uFogColor=this.color,this.program.uniforms.uFogRange=this.range,r.activeTexture(33984+o.UniformSamplerBindings.uNormalMap),r.bindTexture(3553,e.bloom.texture),this.program.uniforms.uBloomMask=e.bloom.mask,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.drawElements(4,e.plane.indexCount,5123,e.plane.indexOffset)},e}(),d=function(){function e(e){this.context=e,this.fbo=[],this.renderTarget=[],this.index=0,this.effects=[];var t=e.gl,r=i.createPlane({width:2,height:2,columns:1,rows:1});this.plane=this.context.get(a.MeshSystem).uploadVertexData(r.vertexArray,r.indexArray,r.format);for(var n=0;n<2;n++)this.fbo[n]=t.createFramebuffer(),this.renderTarget[n]=o.createTexture(t,{width:t.drawingBufferWidth,height:t.drawingBufferHeight},{flipY:!1,wrap:33071,format:32856,mipmaps:0,filter:9729}),t.bindFramebuffer(36160,this.fbo[n]),t.framebufferRenderbuffer(36160,36096,36161,this.context.get(u.DeferredGeometryPass).depth),t.framebufferTexture2D(36160,36064,3553,this.renderTarget[n],0);this.effects.push(this.distortion=new f.DistortionEffect(this.context),this.fog=new l(this.context),this.bloom=new s.BloomEffect(this.context))}return e.prototype.swapRenderTarget=function(e,t){var r=this.context.gl;r.activeTexture(33984+o.UniformSamplerBindings.uSampler),r.bindTexture(3553,this.renderTarget[this.index]),e?r.bindFramebuffer(36160,null):r.bindFramebuffer(36160,this.fbo[this.index^=1]),t?(r.bindFramebuffer(36009,e?null:this.fbo[this.index]),r.bindFramebuffer(36008,this.fbo[e?this.index:1^this.index]),r.blitFramebuffer(0,0,r.drawingBufferWidth,r.drawingBufferHeight,0,0,r.drawingBufferWidth,r.drawingBufferHeight,16384,9728)):e||(r.clearColor(0,0,0,0),r.clear(16384))},e.prototype.update=function(){var e=this.context.gl;e.disable(2929),e.disable(3042),e.disable(2884),e.bindVertexArray(this.plane.vao);for(var t=0;t<this.effects.length&&!this.effects[t].active;)t++;for(var r=this.effects.length-1;r>=0;r--)this.effects[r].active&&this.effects[r].apply(this,!1);this.swapRenderTarget(!0,!0)},e}();t.PostEffectPass=d},2434:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Application=void 0;var n=r(2234),i=r(556),a=function(){function e(t){var r=this;this.canvas=document.createElement("canvas"),this.systems=[],this.previousTimestamp=0,this.timeScale=1,this.frame=0,this.currentTime=0,this.update=function(t){r.deltaTime=.001*r.timeScale*Math.min(e.timestep,t-r.previousTimestamp),r.previousTimestamp=t,r.currentTime+=r.deltaTime,r.frame++;for(var n=0;n<r.systems.length;n++)r.systems[n].update();requestAnimationFrame(r.update)},this.canvas.width=600,this.canvas.height=400,this.gl=new i.WebGLState(this.canvas.getContext("webgl2",{alpha:!1,antialias:!1,depth:!0,stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}));for(var a=0;a<t.length;a++)null==t[a].index&&(t[a].index=a),this.systems[t[a].index]=new t[a](this);n.ready((function(){return document.body.appendChild(r.canvas)}))}return e.prototype.get=function(e){return this.systems[e.index]},e.prototype.load=function(e){for(var t=n.ProgressHandler(this.update.bind(this,0)),r=0,i=function(n){if(!a.systems[n].load)return"continue";var i=0;a.systems[n].load(e,(function(e,n){if(-1==e)return t(e,n);r+=e-i,i=e,t(r)}))},a=this,o=0;o<this.systems.length;o++)i(o)},e.timestep=2e3/60,e}();t.Application=a},294:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;var r=function(){function e(e){this.Factory=e,this.pool=[],this.list=[]}return e.prototype.create=function(){var e=this.pool.pop()||new this.Factory;return e.index=this.list.push(e)-1,e},e.prototype.delete=function(e){-1!=e.index&&(this.list[e.index]=this.list[this.list.length-1],this.list[e.index].index=e.index,this.list.length--,e.index=-1,this.pool.push(e))},e}();t.Factory=r},2234:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadFile=t.ProgressHandler=t.ready=void 0,t.ready=function(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)},t.ProgressHandler=function(e){var t=document.querySelector(".progress_bar div"),r=-1,n=0,i=document.querySelector(".overlay");return i.addEventListener("pointerup",(function t(){r<0||n<100||(i.removeEventListener("pointerup",t),i.style.opacity="0",e())})),function(e,i){if(-1==e)return console.error(i);r=Math.max(r,e),n=Math.max(n,Math.round(100*(1-e/r))),t.style.width=n+"%"}},t.loadFile=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",encodeURI(e),!0),n.responseType=t||"text",n.onprogress=function(e){return e.lengthComputable&&r(1-e.loaded/e.total)},n.onreadystatechange=function(e){return n.readyState===XMLHttpRequest.DONE&&(200===n.status?r(0,n.response):r(-1,new Error(n.statusText)))},r(1),n.send()}},3975:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Signal=void 0;var r=function(){function e(){this.listeners=[],this.iterator=-1}return e.prototype.dispatch=function(e){if(-1!=this.iterator)throw new Error(this.iterator+"!=-1");for(this.iterator=this.listeners.length-1;this.iterator>=0;this.iterator--)this.listeners[this.iterator](e)},e.prototype.addListener=function(e){-1==this.listeners.indexOf(e)&&this.listeners.push(e)},e.prototype.removeListener=function(e){var t=this.listeners.indexOf(e);-1!=t&&(this.listeners.splice(t,1),t<this.iterator&&this.iterator--)},e}();t.Signal=r},4758:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.One=t.Zero=void 0,t.Zero=function(){return 0},t.One=function(){return 1}},8716:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4758),t),i(r(3975),t),i(r(294),t),i(r(2234),t),i(r(2434),t)},4773:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBoxFrame=t.createBox=void 0;var n=r(8999);t.createBox=function(e){var t=.5*e.width,r=.5*e.height,i=.5*e.depth;return{format:n.VertexDataFormat.Static,vertexArray:new Float32Array([-t,-r,i,0,0,1,0,0,t,-r,i,0,0,1,1,0,t,r,i,0,0,1,1,1,-t,r,i,0,0,1,0,1,-t,-r,-i,0,0,-1,1,0,-t,r,-i,0,0,-1,1,1,t,r,-i,0,0,-1,0,1,t,-r,-i,0,0,-1,0,0,-t,r,-i,0,1,0,0,1,-t,r,i,0,1,0,0,0,t,r,i,0,1,0,1,0,t,r,-i,0,1,0,1,1,-t,-r,-i,0,-1,0,1,1,t,-r,-i,0,-1,0,0,1,t,-r,i,0,-1,0,0,0,-t,-r,i,0,-1,0,1,0,t,-r,-i,1,0,0,1,0,t,r,-i,1,0,0,1,1,t,r,i,1,0,0,0,1,t,-r,i,1,0,0,0,0,-t,-r,-i,-1,0,0,0,0,-t,-r,i,-1,0,0,1,0,-t,r,i,-1,0,0,1,1,-t,r,-i,-1,0,0,0,1]),indexArray:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23])}},t.createBoxFrame=function(e){var t=.5*e.outerWidth,r=.5*e.outerHeight,n=.5*e.outerDepth;return e.innerWidth,e.innerHeight,e.innerDepth,{vertexArray:new Float32Array([-t,-r,+n,0,0,1,0,0,+t,-r,+n,0,0,1,1,0,+t,+r,+n,0,0,1,1,1,-t,+r,+n,0,0,1,0,1,-t,-r,-n,0,0,-1,1,0,-t,+r,-n,0,0,-1,1,1,+t,+r,-n,0,0,-1,0,1,+t,-r,-n,0,0,-1,0,0,-t,+r,-n,0,1,0,0,1,-t,+r,+n,0,1,0,0,0,+t,+r,+n,0,1,0,1,0,+t,+r,-n,0,1,0,1,1,-t,-r,-n,0,-1,0,1,1,+t,-r,-n,0,-1,0,0,1,+t,-r,+n,0,-1,0,0,0,-t,-r,+n,0,-1,0,1,0,+t,-r,-n,1,0,0,1,0,+t,+r,-n,1,0,0,1,1,+t,+r,+n,1,0,0,0,1,+t,-r,+n,1,0,0,0,0,-t,-r,-n,-1,0,0,0,0,-t,-r,+n,-1,0,0,1,0,-t,+r,+n,-1,0,0,1,1,-t,+r,-n,-1,0,0,0,1]),indexArray:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23])}}},3935:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyTransform=void 0,t.applyTransform=function(e,t){for(var r=e.vertexArray.byteLength/e.format[1].stride,n=e.format.find((function(e){return"position"===e.name})),i=n.stride/Float32Array.BYTES_PER_ELEMENT,a=n.offset/Float32Array.BYTES_PER_ELEMENT,o=r-1;o>=0;o--){var s=o*i+a,f=e.vertexArray[s+0],u=e.vertexArray[s+1],c=e.vertexArray[s+2];e.vertexArray[s+0]=t[0]*f+t[4]*u+t[8]*c+t[12],e.vertexArray[s+1]=t[1]*f+t[5]*u+t[9]*c+t[13],e.vertexArray[s+2]=t[2]*f+t[6]*u+t[10]*c+t[14]}return e}},341:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCylinder=void 0;var n=r(8999);t.createCylinder=function(e){for(var t=e.radiusTop,r=void 0===t?1:t,i=e.radiusBottom,a=void 0===i?1:i,o=e.height,s=void 0===o?1:o,f=e.radial,u=void 0===f?8:f,c=e.horizontal,l=void 0===c?1:c,d=(e.cap,e.angleStart),h=void 0===d?0:d,m=e.angleLength,v=void 0===m?2*Math.PI:m,p=u+1,x=new Float32Array((l+1)*p*8),y=new Uint16Array(u*l*6),g=(a-r)/s,b=0;b<=l;b++)for(var S=b/l,P=r+S*(a-r),w=0;w<=u;w++){var M=w/u,T=h+M*v,_=Math.sin(T),O=Math.cos(T);x[0+(z=8*(w+b*p))]=P*_,x[z+1]=-S*s+.5*s,x[z+2]=P*O;var A=_*_+g*g+O*O;A=A&&1/Math.sqrt(A),x[z+3]=A*_,x[z+4]=A*g,x[z+5]=A*O,x[z+6]=M,x[z+7]=1-S}for(w=0;w<u;w++)for(b=0;b<l;b++){var z;y[0+(z=6*(w*l+b))]=b*p+w,y[z+1]=y[z+3]=(b+1)*p+w,y[z+4]=(b+1)*p+(w+1),y[z+2]=y[z+5]=b*p+(w+1)}return{format:n.VertexDataFormat.Static,vertexArray:x,indexArray:y}}},6240:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(3935),t),i(r(8356),t),i(r(4523),t),i(r(4773),t),i(r(341),t)},4523:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPlane=void 0;var n=r(8999);t.createPlane=function(e){for(var t=e.width,r=e.height,i=e.columns,a=void 0===i?1:i,o=e.rows,s=void 0===o?1:o,f=a+1,u=s+1,c=new Float32Array(f*u*8),l=new Uint16Array(a*s*6),d=0;d<f;d++)for(var h=0;h<u;h++)c[0+(m=8*(d*u+h))]=t*d/a-.5*t,c[m+1]=0,c[m+2]=r*h/s-.5*r,c[m+3]=0,c[m+4]=1,c[m+5]=0,c[m+6]=d/a,c[m+7]=1-h/s;for(d=0;d<a;d++)for(h=0;h<s;h++){var m;l[0+(m=6*(d*s+h))]=h+u*d,l[m+1]=h+1+u*d,l[m+2]=h+u*(d+1),l[m+3]=h+u*(d+1),l[m+4]=h+1+u*d,l[m+5]=h+1+u*(d+1)}return{format:n.VertexDataFormat.Static,vertexArray:c,indexArray:l}}},8356:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSphere=void 0;var n=r(8999);t.createSphere=function(e){for(var t=e.longitude,r=void 0===t?32:t,i=e.latitude,a=void 0===i?32:i,o=e.radius,s=void 0===o?1:o,f=new Float32Array(r*a*4*8),u=new Uint16Array(r*a*6),c=0,l=0,d=0;d<a;d++)for(var h=d/a,m=(d+1)/a,v=Math.PI*h,p=Math.PI*m,x=Math.sin(v),y=Math.sin(p),g=Math.cos(v),b=Math.cos(p),S=0;S<r;S++){var P=S/r,w=(S+1)/r,M=2*Math.PI*P,T=2*Math.PI*w,_=Math.sin(M),O=Math.sin(T),A=Math.cos(M),z=Math.cos(T),U=8*c;f[U+0]=x*A*s,f[U+1]=g*s,f[U+2]=x*_*s,f[U+8]=x*z*s,f[U+9]=g*s,f[U+10]=x*O*s,f[U+16]=y*A*s,f[U+17]=b*s,f[U+18]=y*_*s,f[U+24]=y*z*s,f[U+25]=b*s,f[U+26]=y*O*s,f[U+3]=x*A,f[U+4]=g,f[U+5]=x*_,f[U+11]=x*z,f[U+12]=g,f[U+13]=x*O,f[U+19]=y*A,f[U+20]=b,f[U+21]=y*_,f[U+27]=y*z,f[U+28]=b,f[U+29]=y*O,f[U+6]=f[U+22]=1-P,f[U+7]=f[U+15]=1-h,f[U+14]=f[U+30]=1-w,f[U+23]=f[U+31]=1-m,u[l+0]=c+0,u[l+1]=c+1,u[l+2]=c+2,u[l+3]=c+2,u[l+4]=c+1,u[l+5]=c+3,c+=4,l+=6}return{format:n.VertexDataFormat.Static,vertexArray:f,indexArray:u}}},9552:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aabb2=void 0,t.aabb2=function(e,r,n,i){return void 0===e&&(e=1/0),void 0===r&&(r=1/0),void 0===n&&(n=-1/0),void 0===i&&(i=-1/0),t.aabb2.set(e,r,n,i,new Float32Array(4))},t.aabb2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.aabb2.set=function(e,t,r,n,i){return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},t.aabb2.overlap=function(e,t){return e[0]<=t[2]&&e[1]<=t[3]&&e[2]>=t[0]&&e[3]>=t[1]},t.aabb2.contains=function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[2]&&e[3]>=t[3]},t.aabb2.add=function(e,t,r){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r},t.aabb2.intersect=function(e,t,r){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.min(e[3],t[3]),r},t.aabb2.pad=function(e,t,r){return r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]+t,r[3]=e[3]+t,r}},7432:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aabb3=void 0,t.aabb3=function(e,r,n,i,a,o){return void 0===e&&(e=1/0),void 0===r&&(r=1/0),void 0===n&&(n=1/0),void 0===i&&(i=-1/0),void 0===a&&(a=-1/0),void 0===o&&(o=1/0),t.aabb3.set(e,r,n,i,a,o,new Float32Array(6))},t.aabb3.set=function(e,t,r,n,i,a,o){return o[0]=e,o[1]=t,o[2]=r,o[3]=n,o[4]=i,o[5]=a,o},t.aabb3.overlap=function(e,t){return e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]&&e[3]>=t[0]&&e[4]>=t[1]&&e[5]>=t[2]},t.aabb3.contains=function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]<=t[2]&&e[3]>=t[3]&&e[4]>=t[4]&&e[5]>=t[5]},t.aabb3.add=function(e,t,r){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r[4]=Math.max(e[4],t[4]),r[5]=Math.max(e[5],t[5]),r},t.aabb3.calculate=function(e,r,n,i){t.aabb3.set(1/0,1/0,1/0,-1/0,-1/0,-1/0,i);for(var a=0;a<e.length;a+=r)i[0]=Math.min(i[0],e[a+n+0]),i[1]=Math.min(i[1],e[a+n+1]),i[2]=Math.min(i[2],e[a+n+2]),i[3]=Math.max(i[3],e[a+n+0]),i[4]=Math.max(i[4],e[a+n+1]),i[5]=Math.max(i[5],e[a+n+2]);return i}},3850:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.insertionSort=t.binarySearch=t.hashString=t.int32pow2Floor=t.int32pow2Ceil=t.int32pow2=t.shuffle=t.range=t.smoothstep=t.lerpAngle=t.shortestAngle=t.randomInt=t.randomFloat=t.mod=t.clamp=t.lerp=void 0,t.lerp=function(e,t,r){return e+(t-e)*r},t.clamp=function(e,t,r){return Math.min(r,Math.max(t,e))},t.mod=function(e,t){return(e%t+t)%t},t.randomFloat=function(e,t,r){return r()*(t-e)+e},t.randomInt=function(e,t,r){return Math.floor(r()*(t-e+1))+e},t.shortestAngle=function(e,t){var r=(t-e)%(2*Math.PI);return 2*r%(2*Math.PI)-r},t.lerpAngle=function(e,r,n){return e+t.shortestAngle(e,r)*n},t.smoothstep=function(e,r,n){return e===r?n<e?0:1:(n=t.clamp((n-e)/(r-e),0,1))*n*(3-2*n)},t.range=function(e,t,r){void 0===r&&(r=[]),null==t&&(t=e,e=0);for(var n=e,i=0;n<t;n++,i++)r[i]=n;return r},t.shuffle=function(e,t){for(var r=e.length-1;r>0;r--){var n=t()*(r+1)|0,i=e[r];e[r]=e[n],e[n]=i}return e},t.int32pow2=function(e){return!(e&e-1||!e)},t.int32pow2Ceil=function(e){return e+=+(0===e),--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)},t.int32pow2Floor=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.hashString=function(e){for(var t=0,r=e.length,n=0;n<r;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t},t.binarySearch=function(e,t,r,n){for(var i=0,a=e.length;i<a;){var o=i+a>>>1;(n?r(e[o],t)<=0:r(e[o],t)<0)?i=o+1:a=o}return n?a:i},t.insertionSort=function(e,t){for(var r=e.length,n=void 0,i=0;i<r;i++){var a=e[i];for(n=i-1;n>=0&&t(a,e[n])>0;n--)e[n+1]=e[n];e[n+1]=a}}},6518:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dualquat=void 0,t.dualquat=function(){return t.dualquat.set(0,0,0,1,0,0,0,0,new Float32Array(8))},t.dualquat.set=function(e,t,r,n,i,a,o,s,f){return f[0]=e,f[1]=t,f[2]=r,f[3]=n,f[4]=i,f[5]=a,f[6]=o,f[7]=s,f},t.dualquat.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},t.dualquat.slerp=function(e,t,r,n){var i=e[0],a=e[1],o=e[2],s=e[3],f=t[0],u=t[1],c=t[2],l=t[3],d=e[4],h=e[5],m=e[6],v=e[7];return i*f+a*u+o*c+s*l<0?(n[0]=r*(f+i)-i,n[1]=r*(u+a)-a,n[2]=r*(c+o)-o,n[3]=r*(l+s)-s,n[4]=-d+r*(t[4]+d),n[5]=-h+r*(t[5]+h),n[6]=-m+r*(t[6]+m),n[7]=-v+r*(t[7]+v)):(n[0]=i+r*(f-i),n[1]=a+r*(u-a),n[2]=o+r*(c-o),n[3]=s+r*(l-s),n[4]=d+r*(t[4]-d),n[5]=h+r*(t[5]-h),n[6]=m+r*(t[6]-m),n[7]=v+r*(t[7]-v)),n},t.dualquat.fromRotationTranslation=function(e,t,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=.5*t[0],f=.5*t[1],u=.5*t[2];return r[0]=n,r[1]=i,r[2]=a,r[3]=o,r[4]=+s*o+f*a-u*i,r[5]=-s*a+f*o+u*n,r[6]=+s*i-f*n+u*o,r[7]=-s*n-f*i-u*a,r},t.dualquat.multiply=function(e,t,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=t[4],f=t[5],u=t[6],c=t[7],l=e[4],d=e[5],h=e[6],m=e[7],v=t[0],p=t[1],x=t[2],y=t[3];return r[0]=n*y+o*v+i*x-a*p,r[1]=i*y+o*p+a*v-n*x,r[2]=a*y+o*x+n*p-i*v,r[3]=o*y-n*v-i*p-a*x,r[4]=n*c+o*s+i*u-a*f+l*y+m*v+d*x-h*p,r[5]=i*c+o*f+a*s-n*u+d*y+m*p+h*v-l*x,r[6]=a*c+o*u+n*f-i*s+h*y+m*x+l*p-d*v,r[7]=o*c-n*s-i*f-a*u+m*y-l*v-d*p-h*x,r}},9563:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spline=t.expoInOut=t.expoOut=t.expoIn=t.circInOut=t.circOut=t.circIn=t.sineInOut=t.sineIn=t.sineOut=t.quintInOut=t.quartInOut=t.cubicInOut=t.quadInOut=t.quintOut=t.quartOut=t.cubicOut=t.quadOut=t.quintIn=t.quartIn=t.cubicIn=t.quadIn=t.elasticOut=t.bounceIn=t.linear=t.stepped=t.CubicBezier=void 0;var n=r(3850),i=function(e,t,r){return function(n){return n<e?e*t(n/e):e+(1-e)*r((n-e)/(1-e))}},a=function(e){return function(t){return 1-e(1-t)}};t.CubicBezier=function(e,t,r,n,i){void 0===i&&(i=1e-5);var a=3*e,o=3*(r-e)-a,s=1-a-o,f=3*t,u=3*(n-t)-f,c=1-f-u,l=function(e){return((s*e+o)*e+a)*e},d=function(e){return(3*s*e+2*o)*e+a};return function(e){return t=function(e){if(e<0)return 0;if(e>1)return 1;for(var t=e,r=0;r<8;r++){var n=l(t)-e;if(Math.abs(n)<i)return t;var a=d(t);if(Math.abs(a)<i)break;t-=n/a}for(var o=0,s=1;o<s;){if(n=l(t),Math.abs(n-e)<i)return t;e>n?o=t:s=t,t=.5*(o+s)}return t}(e),((c*t+u)*t+f)*t;var t}},t.stepped=function(e){return e>=1?1:0},t.linear=function(e){return e},t.bounceIn=function(e,t){var r=1/(t*t),n=1/(1-t);return function(i){return i>=1?1:i<t?r*i*i:1-e*(1-Math.pow(n*(2*i-1-t),2))}},t.elasticOut=function(e,t){t/=Math.min(1,e),e=Math.max(1,e);var r=t/(2*Math.PI)*Math.asin(1/e)||0,n=2*Math.PI/t;return function(t){return e*Math.pow(2,-10*t)*Math.sin((t-r)*n)+1}},t.quadIn=function(e){return e*e},t.cubicIn=function(e){return e*e*e},t.quartIn=function(e){return e*e*e*e},t.quintIn=function(e){return e*e*e*e*e},t.quadOut=a(t.quadIn),t.cubicOut=a(t.cubicIn),t.quartOut=a(t.quartIn),t.quintOut=a(t.quintIn),t.quadInOut=i(.5,t.quadIn,t.quadOut),t.cubicInOut=i(.5,t.cubicIn,t.cubicOut),t.quartInOut=i(.5,t.quartIn,t.quartOut),t.quintInOut=i(.5,t.quintIn,t.quintOut),t.sineOut=function(e){return Math.sin(.5*e*Math.PI)},t.sineIn=a(t.sineOut),t.sineInOut=i(.5,t.sineIn,t.sineOut),t.circIn=function(e){return 1-Math.sqrt(1-e*e)},t.circOut=a(t.circIn),t.circInOut=i(.5,t.circIn,t.circOut),t.expoIn=function(e){return 0==e?0:Math.pow(1024,e-1)},t.expoOut=a(t.expoIn),t.expoInOut=i(.5,t.expoIn,t.expoOut),t.Spline=function(e,t,r,i){void 0===i&&(i=.5);var a=function(e,t){return e-t},o=e.length-1;t=t||e.map((function(e,t){return t/o}));var s=1/0,f=-1/0,u=0,c=0,l=0,d=0,h=0;return function(m){if(m<=t[0])return e[0];if(m>=t[o])return e[o];if(m<s||m>=f){var v=n.binarySearch(t,m,a)-1;s=t[v],f=t[v+1],u=s===f?0:1/(f-s),c=e[v],l=e[v+1];var p=0===v?2*t[0]-t[1]:t[v-1],x=v===o-1?2*t[v+1]-t[v]:t[v+2],y=0===v?2*e[0]-e[1]:e[v-1],g=v===o-1?2*e[v+1]-e[v]:e[v+2];d=i*(f===p?0:2*(f-s)/(f-p))*(l-y),h=i*(x===s?0:2*(f-s)/(x-s))*(g-c)}var b=u*(m-s);if(0===r)return c;if(1===r)return c+b*(l-c);if(2===r)return c+b*b*(3-2*b)*(l-c);var S=b*b,P=b+b,w=1-b,M=w*w;return c*((1+P)*M)+d*(b*M)+l*(S*(3-P))+h*(S*(b-1))}}},7594:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ease=void 0,a(r(3850),t),a(r(9243),t),a(r(2820),t),a(r(4809),t),a(r(8422),t),a(r(643),t),a(r(6163),t),a(r(9369),t),a(r(1247),t),a(r(6518),t),a(r(9552),t),a(r(7432),t),a(r(7144),t),t.ease=o(r(9563))},8422:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat2=void 0,t.mat2=function(){return t.mat2.identity(new Float32Array(4))},t.mat2.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.mat2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.mat2.transpose=function(e,t){var r=e[1];return t[1]=e[2],t[2]=r,t===e||(t[0]=e[0],t[3]=e[3]),t},t.mat2.invert=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*a-i*n;return o=o?1/o:0,t[0]=a*o,t[1]=-n*o,t[2]=-i*o,t[3]=r*o,t},t.mat2.multiply=function(e,t,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=t[0],f=t[1],u=t[2],c=t[3];return r[0]=n*s+a*f,r[1]=i*s+o*f,r[2]=n*u+a*c,r[3]=i*u+o*c,r},t.mat2.transform=function(e,t,r){var n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r}},6163:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=void 0,t.mat3=function(){return t.mat3.identity(new Float32Array(9))},t.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.mat3.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.mat3.transpose=function(e,t){var r=e[1];return t[1]=e[3],t[3]=r,r=e[2],t[2]=e[6],t[6]=r,r=e[5],t[5]=e[7],t[7]=r,t===e||(t[0]=e[0],t[4]=e[4],t[8]=e[8]),t},t.mat3.invert=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],f=e[6],u=e[7],c=e[8],l=c*o-s*u,d=-c*a+s*f,h=u*a-o*f,m=r*l+n*d+i*h;return m=m?1/m:0,t[0]=l*m,t[1]=(-c*n+i*u)*m,t[2]=(s*n-i*o)*m,t[3]=d*m,t[4]=(c*r-i*f)*m,t[5]=(-s*r+i*a)*m,t[6]=h*m,t[7]=(-u*r+n*f)*m,t[8]=(o*r-n*a)*m,t},t.mat3.multiply=function(e,t,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],f=e[5],u=e[6],c=e[7],l=e[8],d=t[0],h=t[1],m=t[2];return r[0]=d*n+h*o+m*u,r[1]=d*i+h*s+m*c,r[2]=d*a+h*f+m*l,d=t[3],h=t[4],m=t[5],r[3]=d*n+h*o+m*u,r[4]=d*i+h*s+m*c,r[5]=d*a+h*f+m*l,d=t[6],h=t[7],m=t[8],r[6]=d*n+h*o+m*u,r[7]=d*i+h*s+m*c,r[8]=d*a+h*f+m*l,r},t.mat3.fromMat3x2=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},t.mat3.fromQuat=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=2*r,s=2*n,f=2*i,u=r*o,c=n*s,l=i*f,d=r*s,h=r*f,m=n*f,v=a*o,p=a*s,x=a*f;return t[0]=1-c-l,t[1]=d+x,t[2]=h-p,t[3]=d-x,t[4]=1-u-l,t[5]=m+v,t[6]=h+p,t[7]=m-v,t[8]=1-u-c,t},t.mat3.transform=function(e,t,r){var n=e[0],i=e[1],a=e[2];return r[0]=t[0]*n+t[3]*i+t[6]*a,r[1]=t[1]*n+t[4]*i+t[7]*a,r[2]=t[2]*n+t[5]*i+t[8]*a,r}},643:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3x2=void 0,t.mat3x2=function(){return t.mat3x2.identity(new Float32Array(6))},t.mat3x2.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.mat3x2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.mat3x2.invert=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],f=r*a-n*i,u=f&&1/f;return t[0]=a*u,t[1]=-n*u,t[2]=-i*u,t[3]=r*u,t[4]=(i*s-a*o)*u,t[5]=(n*o-r*s)*u,t},t.mat3x2.multiply=function(e,t,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=t[0],f=t[1],u=t[2],c=t[3],l=t[4],d=t[5];return r[0]=n*s+a*f,r[1]=i*s+o*f,r[2]=n*u+a*c,r[3]=i*u+o*c,r[4]=n*l+a*d+e[4],r[5]=i*l+o*d+e[5],r},t.mat3x2.orthogonal=function(e,t,r,n,i){var a=1/(e-t),o=1/(r-n);return i[0]=-2*a,i[1]=0,i[2]=0,i[3]=-2*o,i[4]=(e+t)*a,i[5]=(n+r)*o,i},t.mat3x2.transform=function(e,t,r){var n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i+t[4],r[1]=t[1]*n+t[3]*i+t[5],r},t.mat3x2.fromTransform=function(e,t,r,n,i,a,o,s,f,u){return u[0]=Math.cos(o+f)*i,u[1]=Math.sin(o+f)*i,u[2]=-Math.sin(o-s)*a,u[3]=Math.cos(o-s)*a,u[4]=e-r*u[0]-n*u[2],u[5]=t-r*u[1]-n*u[3],u},t.mat3x2.IDENTITY=t.mat3x2()},9369:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat4=void 0,t.mat4=function(){return t.mat4.identity(new Float32Array(16))},t.mat4.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.mat4.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.mat4.transpose=function(e,t){var r=e[1];return t[1]=e[4],t[4]=r,r=e[2],t[2]=e[8],t[8]=r,r=e[3],t[3]=e[12],t[12]=r,r=e[6],t[6]=e[9],t[9]=r,r=e[7],t[7]=e[13],t[13]=r,r=e[11],t[11]=e[14],t[14]=r,t===e||(t[0]=e[0],t[5]=e[5],t[10]=e[10],t[15]=e[15]),t},t.mat4.invert=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],f=e[6],u=e[7],c=e[8],l=e[9],d=e[10],h=e[11],m=e[12],v=e[13],p=e[14],x=e[15],y=r*s-n*o,g=r*f-i*o,b=r*u-a*o,S=n*f-i*s,P=n*u-a*s,w=i*u-a*f,M=c*v-l*m,T=c*p-d*m,_=c*x-h*m,O=l*p-d*v,A=l*x-h*v,z=d*x-h*p,U=y*z-g*A+b*O+S*_-P*T+w*M;return U=U?1/U:0,t[0]=(s*z-f*A+u*O)*U,t[1]=(i*A-n*z-a*O)*U,t[2]=(v*w-p*P+x*S)*U,t[3]=(d*P-l*w-h*S)*U,t[4]=(f*_-o*z-u*T)*U,t[5]=(r*z-i*_+a*T)*U,t[6]=(p*b-m*w-x*g)*U,t[7]=(c*w-d*b+h*g)*U,t[8]=(o*A-s*_+u*M)*U,t[9]=(n*_-r*A-a*M)*U,t[10]=(m*P-v*b+x*y)*U,t[11]=(l*b-c*P-h*y)*U,t[12]=(s*T-o*O-f*M)*U,t[13]=(r*O-n*T+i*M)*U,t[14]=(v*g-m*S-p*y)*U,t[15]=(c*S-l*g+d*y)*U,t},t.mat4.multiply=function(e,t,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],f=e[5],u=e[6],c=e[7],l=e[8],d=e[9],h=e[10],m=e[11],v=e[12],p=e[13],x=e[14],y=e[15],g=t[0],b=t[1],S=t[2],P=t[3];return r[0]=g*n+b*s+S*l+P*v,r[1]=g*i+b*f+S*d+P*p,r[2]=g*a+b*u+S*h+P*x,r[3]=g*o+b*c+S*m+P*y,g=t[4],b=t[5],S=t[6],P=t[7],r[4]=g*n+b*s+S*l+P*v,r[5]=g*i+b*f+S*d+P*p,r[6]=g*a+b*u+S*h+P*x,r[7]=g*o+b*c+S*m+P*y,g=t[8],b=t[9],S=t[10],P=t[11],r[8]=g*n+b*s+S*l+P*v,r[9]=g*i+b*f+S*d+P*p,r[10]=g*a+b*u+S*h+P*x,r[11]=g*o+b*c+S*m+P*y,g=t[12],b=t[13],S=t[14],P=t[15],r[12]=g*n+b*s+S*l+P*v,r[13]=g*i+b*f+S*d+P*p,r[14]=g*a+b*u+S*h+P*x,r[15]=g*o+b*c+S*m+P*y,r},t.mat4.fromEulerRotation=function(e,t,r,n){var i=Math.sin(e),a=Math.sin(t),o=Math.sin(r),s=Math.cos(e),f=Math.cos(t),u=Math.cos(r);return n[0]=f*u,n[1]=f*o,n[2]=-a,n[3]=0,n[4]=i*a*u-s*o,n[5]=i*a*o+s*u,n[6]=i*f,n[7]=0,n[8]=s*a*u+i*o,n[9]=s*a*o-i*u,n[10]=s*f,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},t.mat4.perspective=function(e,t,r,n,i){var a=1/Math.tan(e/2),o=1/(r-n);return i[0]=a/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(n+r)*o,i[11]=-1,i[12]=0,i[13]=0,i[14]=2*n*r*o,i[15]=0,i},t.mat4.transform=function(e,t,r){var n=e[0],i=e[1],a=e[2],o=null==e[3]?1:e[3];return r[0]=t[0]*n+t[4]*i+t[8]*a+t[12]*o,r[1]=t[1]*n+t[5]*i+t[9]*a+t[13]*o,r[2]=t[2]*n+t[6]*i+t[10]*a+t[14]*o,r[3]=t[3]*n+t[7]*i+t[11]*a+t[15]*o,r},t.mat4.transformNormal=function(e,t,r){var n=e[0],i=e[1],a=e[2];return r[0]=t[0]*n+t[4]*i+t[8]*a,r[1]=t[1]*n+t[5]*i+t[9]*a,r[2]=t[2]*n+t[6]*i+t[10]*a,r},t.mat4.orthogonal=function(e,t,r,n,i,a,o){var s=1/(e-t),f=1/(r-n),u=1/(i-a);return o[0]=-2*s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*f,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*u,o[11]=0,o[12]=(e+t)*s,o[13]=(n+r)*f,o[14]=(a+i)*u,o[15]=1,o},t.mat4.translate=function(e,t,r){var n=t[0],i=t[1],a=t[2];return r[12]=e[0]*n+e[4]*i+e[8]*a+e[12],r[13]=e[1]*n+e[5]*i+e[9]*a+e[13],r[14]=e[2]*n+e[6]*i+e[10]*a+e[14],r[15]=e[3]*n+e[7]*i+e[11]*a+e[15],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11]),r},t.mat4.scale=function(e,t,r){var n=t[0],i=t[1],a=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*a,r[9]=e[9]*a,r[10]=e[10]*a,r[11]=e[11]*a,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},t.mat4.rotate=function(e,t,r,n){var i=r[0],a=r[1],o=r[2],s=Math.sin(t),f=Math.cos(t),u=1-f,c=e[0],l=e[1],d=e[2],h=e[3],m=e[4],v=e[5],p=e[6],x=e[7],y=e[8],g=e[9],b=e[10],S=e[11],P=i*i*u+f,w=a*i*u+o*s,M=o*i*u-a*s,T=i*a*u-o*s,_=a*a*u+f,O=o*a*u+i*s,A=i*o*u+a*s,z=a*o*u-i*s,U=o*o*u+f;return n[0]=c*P+m*w+y*M,n[1]=l*P+v*w+g*M,n[2]=d*P+p*w+b*M,n[3]=h*P+x*w+S*M,n[4]=c*T+m*_+y*O,n[5]=l*T+v*_+g*O,n[6]=d*T+p*_+b*O,n[7]=h*T+x*_+S*O,n[8]=c*A+m*z+y*U,n[9]=l*A+v*z+g*U,n[10]=d*A+p*z+b*U,n[11]=h*A+x*z+S*U,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},t.mat4.fromRotationTranslationScale=function(e,t,r,n){var i=e[0],a=e[1],o=e[2],s=e[3],f=i+i,u=a+a,c=o+o,l=i*f,d=i*u,h=i*c,m=a*u,v=a*c,p=o*c,x=s*f,y=s*u,g=s*c,b=r[0],S=r[1],P=r[2];return n[0]=(1-(m+p))*b,n[1]=(d+g)*b,n[2]=(h-y)*b,n[3]=0,n[4]=(d-g)*S,n[5]=(1-(l+p))*S,n[6]=(v+x)*S,n[7]=0,n[8]=(h+y)*P,n[9]=(v-x)*P,n[10]=(1-(l+m))*P,n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},t.mat4.lookAt=function(e,t,r,n){var i=e[0],a=e[1],o=e[2],s=t[0],f=t[1],u=t[2],c=r[0],l=r[1],d=r[2],h=i-s,m=a-f,v=o-u,p=Math.sqrt(h*h+m*m+v*v),x=p?1/p:0,y=l*(v*=x)-d*(m*=x),g=d*(h*=x)-c*v,b=c*m-l*h,S=m*(b*=x=(p=Math.sqrt(y*y+g*g+b*b))?1/p:0)-v*(g*=x),P=v*(y*=x)-h*b,w=h*g-m*y;return S*=x=(p=Math.sqrt(S*S+P*P+w*w))?1/p:0,P*=x,w*=x,n[0]=y,n[1]=S,n[2]=h,n[3]=0,n[4]=g,n[5]=P,n[6]=m,n[7]=0,n[8]=b,n[9]=w,n[10]=v,n[11]=0,n[12]=-(y*i+g*a+b*o),n[13]=-(S*i+P*a+w*o),n[14]=-(h*i+m*a+v*o),n[15]=1,n},t.mat4.targetTo=function(e,t,r,n){var i=e[0],a=e[1],o=e[2],s=r[0],f=r[1],u=r[2],c=i-t[0],l=a-t[1],d=o-t[2],h=Math.sqrt(c*c+l*l+d*d),m=h?1/h:1,v=f*(d*=m)-u*(l*=m),p=u*(c*=m)-s*d,x=s*l-f*c;return v*=m=(h=Math.sqrt(v*v+p*p+x*x))?1/h:1,p*=m,x*=m,n[0]=v,n[1]=p,n[2]=x,n[3]=0,n[4]=l*x-d*p,n[5]=d*v-c*x,n[6]=c*p-l*v,n[7]=0,n[8]=c,n[9]=l,n[10]=d,n[11]=0,n[12]=i,n[13]=a,n[14]=o,n[15]=1,n},t.mat4.fromDualquat=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],f=e[6],u=e[7],c=2*r*r,l=2*n*n,d=2*i*i,h=2*r*n,m=2*r*i,v=2*r*a,p=2*n*i,x=2*n*a,y=2*i*a;return t[0]=1-l-d,t[1]=h+y,t[2]=m-x,t[3]=0,t[4]=h-y,t[5]=1-c-d,t[6]=p+v,t[7]=0,t[8]=m+x,t[9]=p-v,t[10]=1-c-l,t[11]=0,t[12]=2*(-u*r+o*a-s*i+f*n),t[13]=2*(-u*n+o*i+s*a-f*r),t[14]=2*(-u*i-o*n+s*r+f*a),t[15]=1,t},t.mat4.IDENTITY=t.mat4()},7144:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noise3D=t.noise2D=t.noise1D=void 0;var r=198491317;function n(e,t){return e*=3039394381,e+=t,e^=e>>8,e+=1759714724,e^=e>>8,e*=458671337,(e^=e>>8)/2147483647}t.noise1D=n,t.noise2D=function(e,t,i){return n(e+r*t,i)},t.noise3D=function(e,t,i,a){return n(e+r*t+6542989*i,a)}},1247:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quat=void 0;var n=r(2820),i=r(4809);t.quat=function(){return i.vec4(0,0,0,1)},t.quat.copy=i.vec4.copy,t.quat.normalize=i.vec4.normalize,t.quat.multiply=function(e,t,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=t[0],f=t[1],u=t[2],c=t[3];return r[0]=n*c+o*s+i*u-a*f,r[1]=i*c+o*f+a*s-n*u,r[2]=a*c+o*u+n*f-i*s,r[3]=o*c-n*s-i*f-a*u,r},t.quat.conjugate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.quat.transform=function(e,t,r){var n=e[0],i=e[1],a=e[2],o=t[0],s=t[1],f=t[2],u=t[3],c=u*n+s*a-f*i,l=u*i+f*n-o*a,d=u*a+o*i-s*n,h=-o*n-s*i-f*a;return r[0]=c*u+h*-o+l*-f-d*-s,r[1]=l*u+h*-s+d*-o-c*-f,r[2]=d*u+h*-f+c*-s-l*-o,r[3]=null==e[3]?1:e[3],r},t.quat.slerp=function(e,t,r,n){var i=e[0],a=e[1],o=e[2],s=e[3],f=t[0],u=t[1],c=t[2],l=t[3],d=i*f+a*u+o*c+s*l,h=Math.abs(d),m=1-r,v=r;if(1-h>1e-6){var p=Math.acos(h),x=Math.sin(p);m=Math.sin(m*p)/x,v=Math.sin(v*p)/x}return d<0&&(v*=-1),n[0]=m*i+v*f,n[1]=m*a+v*u,n[2]=m*o+v*c,n[3]=m*s+v*l,n},t.quat.axisAngle=function(e,t,r){var n=Math.sin(t*=.5);return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=Math.cos(t),r};var a={xyz:[1,-1,1,-1],xzy:[-1,-1,1,1],yxz:[1,-1,-1,1],yzx:[1,1,-1,-1],zxy:[-1,1,1,-1],zyx:[-1,1,-1,1]};t.quat.euler=function(e,t,r,n,i){var o=Math.sin(e*=.5),s=Math.cos(e),f=Math.sin(t*=.5),u=Math.cos(t),c=Math.sin(r*=.5),l=Math.cos(r),d=a[n];return i[0]=o*u*l+d[0]*s*f*c,i[1]=s*f*l+d[1]*o*u*c,i[2]=s*u*c+d[2]*o*f*l,i[3]=s*u*l+d[3]*o*f*c,i},t.quat.rotationTo=function(e,r,i){var a=n.vec3.dot(e,r),o=Math.sqrt(n.vec3.magnitudeSquared(e)*n.vec3.magnitudeSquared(r)),s=a/o;if(s>=1)return t.quat.copy(t.quat.IDENTITY,i);if(s<=-1){var f=Math.abs(e[0]),u=Math.abs(e[1]),c=Math.abs(e[2]),l=f<u?f<c?n.vec3.AXIS_X:n.vec3.AXIS_Z:u<c?n.vec3.AXIS_Y:n.vec3.AXIS_Z;return n.vec3.cross(e,l,i),n.vec3.normalize(i,i),i[3]=0,i}return n.vec3.cross(e,r,i),i[3]=o+a,t.quat.normalize(i,i)},t.quat.IDENTITY=t.quat()},9243:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec2=void 0,t.vec2=function(e,r){return void 0===e&&(e=0),void 0===r&&(r=e),t.vec2.set(e,r,new Float32Array(2))},t.vec2.set=function(e,t,r){return r[0]=e,r[1]=t,r},t.vec2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t},t.vec2.cross=function(e,t){return e[0]*t[1]-e[1]*t[0]},t.vec2.rotate=function(e,t,r){var n=Math.cos(t),i=Math.sin(t),a=e[0],o=e[1];return r[0]=n*a-i*o,r[1]=i*a+n*o,r},t.vec2.rotate90cw=function(e,t){var r=-e[0];return t[0]=e[1],t[1]=r,t},t.vec2.rotate90ccw=function(e,t){var r=-e[1];return t[1]=e[0],t[0]=r,t},t.vec2.add=function(e,t,r){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r},t.vec2.subtract=function(e,t,r){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r},t.vec2.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r},t.vec2.divide=function(e,t,r){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r},t.vec2.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r},t.vec2.distanceSquared=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},t.vec2.distance=function(e,r){return Math.sqrt(t.vec2.distanceSquared(e,r))},t.vec2.magnitudeSquared=function(e){return e[0]*e[0]+e[1]*e[1]},t.vec2.magnitude=function(e){return Math.sqrt(t.vec2.magnitudeSquared(e))},t.vec2.normalize=function(e,t){var r=e[0],n=e[1],i=r*r+n*n,a=i&&1/Math.sqrt(i);return t[0]=r*a,t[1]=n*a,t},t.vec2.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.vec2.lerp=function(e,t,r,n){return n[0]=e[0]+r*(t[0]-e[0]),n[1]=e[1]+r*(t[1]-e[1]),n},t.vec2.reflect=function(e,t,r){var n=e[0]*t[0]+e[1]*t[1];return r[0]=e[0]-2*t[0]*n,r[1]=e[1]-2*t[1]*n,r},t.vec2.angle=function(e,r){return Math.acos(t.vec2.dot(e,r))},t.vec2.rotation=function(e){return Math.atan2(e[1],e[0])},t.vec2.ZERO=t.vec2(0,0),t.vec2.ONE=t.vec2(1,1),t.vec2.AXIS_Y=t.vec2(0,1),t.vec2.AXIS_X=t.vec2(1,0)},2820:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=void 0,t.vec3=function(e,r,n){return void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=0),t.vec3.set(e,r,n,new Float32Array(3))},t.vec3.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.vec3.set=function(e,t,r,n){return n[0]=e,n[1]=t,n[2]=r,n},t.vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},t.vec3.subtract=function(e,t,r){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r},t.vec3.add=function(e,t,r){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r},t.vec3.cross=function(e,t,r){var n=e[0],i=e[1],a=e[2],o=t[0],s=t[1],f=t[2];return r[0]=i*f-a*s,r[1]=a*o-n*f,r[2]=n*s-i*o,r},t.vec3.magnitudeSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},t.vec3.magnitude=function(e){return Math.sqrt(t.vec3.magnitudeSquared(e))},t.vec3.distanceSquared=function(e,t){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i},t.vec3.normalize=function(e,t){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i,o=a&&1/Math.sqrt(a);return t[0]=r*o,t[1]=n*o,t[2]=i*o,t},t.vec3.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r},t.vec3.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r},t.vec3.lerp=function(e,t,r,n){return n[0]=e[0]+r*(t[0]-e[0]),n[1]=e[1]+r*(t[1]-e[1]),n[2]=e[2]+r*(t[2]-e[2]),n},t.vec3.ZERO=t.vec3(0,0,0),t.vec3.ONE=t.vec3(1,1,1),t.vec3.AXIS_X=t.vec3(1,0,0),t.vec3.AXIS_Y=t.vec3(0,1,0),t.vec3.AXIS_Z=t.vec3(0,0,1)},4809:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=void 0,t.vec4=function(e,r,n,i){return void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=1),t.vec4.set(e,r,n,i,new Float32Array(4))},t.vec4.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.vec4.set=function(e,t,r,n,i){return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},t.vec4.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.vec4.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r},t.vec4.normalize=function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a,s=o&&1/Math.sqrt(o);return t[0]=r*s,t[1]=n*s,t[2]=i*s,t[3]=a*s,t},t.vec4.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r},t.vec4.lerp=function(e,t,r,n){return n[0]=e[0]+r*(t[0]-e[0]),n[1]=e[1]+r*(t[1]-e[1]),n[2]=e[2]+r*(t[2]-e[2]),n[3]=e[3]+r*(t[3]-e[3]),n},t.vec4.ZERO=t.vec4(0,0,0,0),t.vec4.ONE=t.vec4(1,1,1,1)},7557:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleEmitter=void 0;var n=r(7594),i=r(556),a=function(){function e(e,t){this.range=n.vec2(),this.offset=0,this.count=0,this.rate=0,this.amount=1,this.elapsed=0,this.queue=[],this.uniform=new i.UniformBlock(e,t.uniforms.EmitterUniforms,i.UniformBlockBindings.EmitterUniforms)}return e.prototype.update=function(e,t,r){var n=e.currentTime,i=e.deltaTime;if(this.uniform.uniforms.uLastID[0]=this.offset+this.range[1],this.rate)for(this.elapsed+=i;this.elapsed>this.rate;this.elapsed-=this.rate)this.count+=this.amount;else this.elapsed=0;for(;this.queue.length&&this.queue[0]<n;){this.queue.shift();var a=this.queue.shift();this.offset+=a,this.count-=a,this.range[1]-=a}var o=Math.min(r.limit-this.offset,0|this.count),s=o-this.range[1],f=this.uniform.uniforms.uLifespan[1]-this.uniform.uniforms.uLifespan[2];return s>0&&this.queue.push(n+f,s),this.range[0]=this.offset,this.range[1]=o,this.offset=t,o},e}();t.ParticleEmitter=a},7219:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleGeometry=t.AttributeCurveSampler=t.GradientRamp=void 0;var n=r(556);t.GradientRamp=function(e,t,r){void 0===r&&(r=1);for(var i=new Uint8Array(4*t.length),a=0;a<t.length;a++)i[4*a+0]=t[a]>>>24&255,i[4*a+1]=t[a]>>>16&255,i[4*a+2]=t[a]>>>8&255,i[4*a+3]=t[a]>>>0&255;return n.createTexture(e,{width:t.length/r,height:r,data:i},{flipY:!0,mipmaps:0,filter:9729,wrap:33071,type:3553,format:32856})},t.AttributeCurveSampler=function(e,t,r){for(var i,a,o,s,f=Math.ceil(r.length/4),u=new Float32Array(t*f*4),c=1/(t-1),l=0;l<f;l++)for(var d=0;d<t;d++){var h=d+l*t,m=d*c;u[4*h+0]=(null===(i=r[4*l+0])||void 0===i?void 0:i.call(r,m))||0,u[4*h+1]=(null===(a=r[4*l+1])||void 0===a?void 0:a.call(r,m))||0,u[4*h+2]=(null===(o=r[4*l+2])||void 0===o?void 0:o.call(r,m))||0,u[4*h+3]=(null===(s=r[4*l+3])||void 0===s?void 0:s.call(r,m))||0}return n.createTexture(e,{width:t,height:f,data:u},{format:34842,filter:9728,wrap:33071,flipY:!1,mipmaps:0,type:3553})};var i=function(){function e(){}return e.quad=function(e){var t=e.createBuffer();return e.bindBuffer(34962,t),e.bufferData(34962,new Float32Array([-.5,.5,0,0,0,-.5,-.5,0,0,1,.5,-.5,0,1,1,.5,.5,0,1,0]),35044),{drawMode:6,vbo:t,frame:0,indexOffset:0,indexCount:4,vao:null,aabb:null,radius:.5,format:[{name:"aPosition",size:3,type:5126,stride:20,offset:0},{name:"aUV",size:2,type:5126,stride:20,offset:12}]}},e.stripe=function(e,t,r){var n=e.createBuffer();e.bindBuffer(34962,n);for(var i=new Float32Array(2*t*5),a=0;a<t;a++){var o=a/(t-1);i[2*a*5+0]=-.5*r(o),i[2*a*5+1]=o,i[2*a*5+2]=0,i[2*a*5+3]=0,i[2*a*5+4]=o,i[2*a*5+5]=.5*r(o),i[2*a*5+6]=o,i[2*a*5+7]=0,i[2*a*5+8]=1,i[2*a*5+9]=o}return e.bufferData(34962,i,35044),{drawMode:5,vbo:n,frame:0,indexOffset:0,indexCount:2*t,vao:null,aabb:null,radius:0,format:[{name:"aPosition",size:3,type:5126,stride:20,offset:0},{name:"aUV",size:2,type:5126,stride:20,offset:12}]}},e}();t.ParticleGeometry=i},422:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleSystem=void 0;var n=r(556),i=r(7557),a=function(){function e(e,t,r,n,i){this.context=e,this.options=t,this.mesh=r,this.program=n,this.transform=i,this.pool=[],this.enabled=!0,this.index=0,this.instances=0,this.tfbWrite=[],this.tfbRead=[],this.vao=[],this.buffer=[],this.emitters=[];for(var a=this.context.gl,o=0;o<2;o++){if(this.buffer[o]=a.createBuffer(),a.bindBuffer(34962,this.buffer[o]),a.bufferData(34962,t.limit*t.format[0].stride,i?35042:35048),i&&(this.tfbWrite[o]=a.createTransformFeedback(),a.bindTransformFeedback(36386,this.tfbWrite[o]),a.bindBufferBase(35982,0,this.buffer[o]),a.bindTransformFeedback(36386,null)),i&&r){this.tfbRead[o]=a.createVertexArray(),a.bindVertexArray(this.tfbRead[o]),a.bindBuffer(34962,this.buffer[o]);for(var s=0;s<t.format.length;s++){var f=t.format[s],u=f.size,c=f.type,l=f.normalized,d=f.stride,h=f.offset;a.enableVertexAttribArray(s),a.vertexAttribPointer(s,u,c,l,d,h)}a.bindVertexArray(null)}if(this.program){var m=0;this.vao[o]=a.createVertexArray(),a.bindVertexArray(this.vao[o]),a.bindBuffer(34962,this.buffer[o]);for(var v=0;v<t.format.length;v++,m++){var p=t.format[v];u=p.size,c=p.type,l=p.normalized,d=p.stride,h=p.offset,a.enableVertexAttribArray(m),a.vertexAttribPointer(m,u,c,l,d,h),this.mesh&&a.vertexAttribDivisor(m,1)}if(this.mesh){this.mesh.ibo&&a.bindBuffer(34963,this.mesh.ibo),a.bindBuffer(34962,this.mesh.vbo);for(var x=this.mesh.ibo?1:0;x<this.mesh.format.length;x++,m++){var y=this.mesh.format[x];u=y.size,c=y.type,l=y.normalized,d=y.stride,h=y.offset,a.enableVertexAttribArray(m),a.vertexAttribPointer(m,u,c,l,d,h)}}a.bindVertexArray(null)}if(!i)break}}return e.prototype.apply=function(){if(this.enabled){if(this.transform)for(var e=this.instances=0;e<this.emitters.length;e++)this.instances+=this.emitters[e].update(this.context,this.instances,this.options);if(this.instances){var t=this.context.gl;if(t.enable(3042),1==this.options.blend?t.blendFuncSeparate(770,771,0,1):2==this.options.blend?t.blendFunc(1,1):t.blendFuncSeparate(1,771,0,1),this.options.depthTest?t.enable(2929):t.disable(2929),t.activeTexture(33984+n.UniformSamplerBindings.uSampler),t.bindTexture(3553,this.diffuse),t.activeTexture(33984+n.UniformSamplerBindings.uGradient),t.bindTexture(3553,this.gradientRamp),t.activeTexture(33984+n.UniformSamplerBindings.uAttributes),t.bindTexture(3553,this.curveSampler),this.transform&&this.emitters.length){for(t.useProgram(this.transform.target),t.bindVertexArray(this.tfbRead[this.index]),t.bindTransformFeedback(36386,this.tfbWrite[this.index^=1]),this.mesh&&t.enable(35977),t.beginTransformFeedback(0),e=0;e<this.emitters.length;e++){var r=this.emitters[e];r.range[1]&&(r.uniform.bind(t,n.UniformBlockBindings.EmitterUniforms),t.drawArrays(0,r.range[0],r.range[1]))}t.endTransformFeedback(),this.mesh&&t.disable(35977),t.bindTransformFeedback(36386,null)}this.program&&(t.useProgram(this.program.target),t.bindVertexArray(this.vao[this.index]),this.mesh?this.mesh.ibo?t.drawElementsInstanced(this.mesh.drawMode,this.mesh.indexCount,5123,this.mesh.indexOffset,this.instances):t.drawArraysInstanced(this.mesh.drawMode,this.mesh.indexOffset,this.mesh.indexCount,this.instances):t.drawArrays(0,0,this.instances))}}},e.prototype.add=function(e){var t=this.pool.pop()||new i.ParticleEmitter(this.context.gl,this.transform);for(var r in e)t.uniform.uniforms[r].set(e[r],0);return this.emitters.push(t),t},e.prototype.remove=function(e){var t=this.emitters.indexOf(e);~t&&(this.emitters[t]=this.emitters[this.emitters.length-1],this.emitters.length--,this.pool.push(e))},e}();t.ParticleSystem=a},9217:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7557),t),i(r(422),t),i(r(7219),t)},1974:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSystem=t.PerspectiveCamera=void 0;var n=r(7594),i=r(556),a=r(1513),o=r(3453),s=function(){this.frame=0,this.zNear=.1,this.zFar=100,this.fieldOfView=Math.PI/2,this.aspectRatio=1,this.viewMatrix=n.mat4(),this.projectionMatrix=n.mat4(),this.viewProjectionMatrix=n.mat4(),this.position=n.vec3(),this.culling=new o.FrustumCulling(this)};t.PerspectiveCamera=s;var f=function(){function e(e){this.context=e,this.camera=new s,this.camera.transform=this.context.get(a.TransformSystem).create(),this.uniform=new i.UniformBlock(this.context.gl,{byteSize:16})}return e.prototype.update=function(){this.uniform.data[0]=this.context.currentTime,this.uniform.data[1]=this.context.deltaTime,this.uniform.data[2]=this.context.frame,this.uniform.data[3]=this.context.currentTime%1e3,this.updatePerspectiveCamera(this.camera)},e.prototype.updatePerspectiveCamera=function(e){if(!(e.frame&&e.frame>=e.transform.frame)){e.uniform||(e.uniform=new i.UniformBlock(this.context.gl,{byteSize:144})),e.frame||(e.aspectRatio=this.context.gl.drawingBufferWidth/this.context.gl.drawingBufferHeight,n.mat4.perspective(e.fieldOfView,e.aspectRatio,e.zNear,e.zFar,e.projectionMatrix)),e.culling.update(e);var t=e.transform?e.transform.matrix:n.mat4.IDENTITY;n.mat4.invert(t,e.viewMatrix),n.mat4.multiply(e.projectionMatrix,e.viewMatrix,e.viewProjectionMatrix),e.uniform.data.set(e.viewProjectionMatrix,0),e.uniform.data.set(e.viewMatrix,16),e.uniform.data[32]=e.position[0]=t[12],e.uniform.data[33]=e.position[1]=t[13],e.uniform.data[34]=e.position[2]=t[14],e.frame=this.context.frame}},e}();t.CameraSystem=f},3453:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrustumCulling=t.BoundingVolume=t.calculateBoundingRadius=void 0;var n=r(7594);function i(e,t,r,i){void 0===i&&(i=n.vec3.ZERO);for(var a=0,o=0;o<e.length;o+=t){var s=e[o+r+0]-i[0],f=e[o+r+1]-i[1],u=e[o+r+2]-i[2];a=Math.max(a,s*s+f*f+u*u)}return Math.sqrt(a)}t.calculateBoundingRadius=i;var a=function(){function e(){this.frame=-1,this.position=n.vec3(0,0,0),this.scale=n.vec3(1,1,1),this.radius=0}return e.prototype.update=function(e,t){this.scale[0]=Math.hypot(e.matrix[0],e.matrix[1],e.matrix[2]),this.scale[1]=Math.hypot(e.matrix[4],e.matrix[5],e.matrix[6]),this.scale[2]=Math.hypot(e.matrix[8],e.matrix[9],e.matrix[10]),n.vec3.set(e.matrix[12],e.matrix[13],e.matrix[14],this.position),this.radius=t*Math.max(this.scale[0],this.scale[1],this.scale[2]),this.frame=e.frame},e.prototype.fromVertices=function(e,t,r,a){n.vec3.copy(n.vec3.ZERO,this.position);for(var o=0;o<e.length;o+=t)this.position[0]+=e[o+r+0],this.position[1]+=e[o+r+1],this.position[2]+=e[o+r+2];n.vec3.scale(this.position,t/e.length,this.position),this.radius=i(e,t,r,this.position),this.frame=a},e}();t.BoundingVolume=a;var o=function(){function e(e){this.camera=e,this.AXIS_X=n.vec3(1,0,0),this.AXIS_Y=n.vec3(0,1,0),this.AXIS_Z=n.vec3(0,0,1),this.position=n.vec3(0,0,0)}return e.prototype.update=function(e){var t;this.tangent=Math.tan(this.camera.fieldOfView/2),this.sphereFactorY=1/Math.cos(this.camera.fieldOfView/2),this.sphereFactorX=1/Math.cos(Math.atan(this.tangent*this.camera.aspectRatio));var r=(null===(t=this.camera.transform)||void 0===t?void 0:t.matrix)||n.mat4.IDENTITY;n.vec3.set(r[0],r[1],r[2],this.AXIS_X),n.vec3.set(r[4],r[5],r[6],this.AXIS_Y),n.vec3.set(-r[8],-r[9],-r[10],this.AXIS_Z),n.vec3.set(r[12],r[13],r[14],this.position)},e.prototype.cull=function(e){return this.cullSphere(e.position,e.radius)},e.prototype.cullSphere=function(t,r){var i=n.vec3.subtract(t,this.position,e.temp),a=n.vec3.dot(i,this.AXIS_Z);if(a>this.camera.zFar+r||a<this.camera.zNear-r)return!1;var o=n.vec3.dot(i,this.AXIS_Y),s=a*this.tangent+r*this.sphereFactorY;if(o>s||o<-s)return!1;var f=n.vec3.dot(i,this.AXIS_X),u=a*this.tangent*this.camera.aspectRatio+r*this.sphereFactorX;return!(f>u||f<-u)},e.temp=n.vec3(0,0,0),e}();t.FrustumCulling=o},1513:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TransformSystem=t.Transform=t.Transform2D=void 0;var a=r(7594),o=r(8716),s=function(){function e(){this.index=-1,this.frame=0,this.position=a.vec2(0,0),this.scale=a.vec2(1,1),this.rotation=0,this.matrix=a.mat3x2()}return e.prototype.recalculate=function(e){a.mat3x2.fromTransform(this.position[0],this.position[1],0,0,this.scale[0],this.scale[1],this.rotation,0,0,this.matrix),this.parent&&a.mat3x2.multiply(this.parent.matrix,this.matrix,this.matrix),this.frame=e},e}();t.Transform2D=s;var f=function(){function e(){this.index=-1,this.frame=0,this.position=a.vec3(0,0,0),this.scale=a.vec3(1,1,1),this.rotation=a.quat(),this.matrix=a.mat4()}return e.prototype.recalculate=function(e){a.mat4.fromRotationTranslationScale(this.rotation,this.position,this.scale,this.matrix),this.parent&&a.mat4.multiply(this.parent.matrix,this.matrix,this.matrix),this.frame=e},e}();t.Transform=f;var u=function(e){function t(t){var r=e.call(this,f)||this;return r.context=t,r}return i(t,e),t.prototype.delete=function(t){e.prototype.delete.call(this,t),t.frame=0,t.parent=null,a.vec3.copy(a.vec3.ZERO,t.position),a.vec3.copy(a.vec3.ONE,t.scale),a.quat.copy(a.quat.IDENTITY,t.rotation)},t.prototype.update=function(){for(var e=this.list.length-1;e>=0;e--){var t=this.list[e];t.frame&&(!t.parent||t.frame>=t.parent.frame)||(t.parent&&-1==t.parent.index&&(t.parent=null),t.parent&&t.parent.index<e?(this.list[t.parent.index]=t,this.list[e]=t.parent,t.index=t.parent.index,t.parent.index=e++):t.recalculate(this.context.frame))}},t}(o.Factory);t.TransformSystem=u},3335:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(1513),t),i(r(1974),t),i(r(3453),t)},8211:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shaders=void 0,t.shaders={batch_vert:r(898),batch_frag:r(7676),stripe_vert:r(5816),billboard_vert:r(125),billboard_frag:r(452),decal_vert:r(903),decal_frag:r(9533),particle_vert:r(98),fullscreen_vert:r(5316),fullscreen_frag:r(6332),geometry_vert:r(373),geometry_frag:r(6148),noise_frag:r(8208),distortion_frag:r(400),fog_frag:r(594)}},5360:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},556:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5360),t),i(r(9374),t),i(r(8598),t),i(r(9246),t),i(r(8999),t)},8598:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UniformBlock=t.locateUniforms=t.compileProgram=t.ShaderProgram=void 0;var n=r(8999);function i(e,t,r,n){var i=e.createShader(35633);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,35713))throw new Error(e.getShaderInfoLog(i));var a=e.createShader(35632);if(e.shaderSource(a,r),e.compileShader(a),!e.getShaderParameter(a,35713))throw new Error(e.getShaderInfoLog(a));var o=e.createProgram();if(e.attachShader(o,i),e.attachShader(o,a),n&&e.transformFeedbackVaryings(o,n,35980),e.linkProgram(o),e.deleteShader(i),e.deleteShader(a),!e.getProgramParameter(o,35714))throw new Error(e.getProgramInfoLog(o));return o}function a(e,t){for(var r in e.useProgram(t),n.UniformBlockBindings){var i=e.getUniformBlockIndex(t,r);4294967295!=i&&e.uniformBlockBinding(t,i,n.UniformBlockBindings[r])}for(var a=Object.create(null),o=e.getProgramParameter(t,35382)-1;o>=0;o--){for(var s=e.getActiveUniformBlockParameter(t,o,35392),f=e.getActiveUniformBlockParameter(t,o,35395),u=e.getActiveUniforms(t,f,35387),c=e.getActiveUniformBlockName(t,o),l=(e.getActiveUniforms(t,f,35386),Array(f.length)),d=0;d<f.length;d++)l[d]=e.getActiveUniform(t,f[d]);a[c]={byteSize:s,offsets:u,uniforms:l}}for(o=e.getProgramParameter(t,35718)-1;o>=0;o--){var h=e.getActiveUniform(t,o),m=e.getUniformLocation(t,h.name);if(m){var v=void 0;switch(h.type){case 5124:case 35678:case 36289:v=h.size>1?e.uniform1iv.bind(e,m):e.uniform1i.bind(e,m);break;case 5126:v=h.size>1?e.uniform1fv.bind(e,m):e.uniform1f.bind(e,m);break;case 35664:v=e.uniform2fv.bind(e,m);break;case 35665:v=e.uniform3fv.bind(e,m);break;case 35666:v=e.uniform4fv.bind(e,m);break;case 35674:v=e.uniformMatrix2fv.bind(e,m,!1);break;case 35675:v=e.uniformMatrix3fv.bind(e,m,!1);break;case 35676:v=e.uniformMatrix4fv.bind(e,m,!1)}Object.defineProperty(a,h.name.replace(/\[0\]$/,""),{set:v})}}for(var r in n.UniformSamplerBindings)r in a&&(a[r]=n.UniformSamplerBindings[r]);return a}t.ShaderProgram=function(e,t,r,n){if(n)for(var o in n)if(0!=n[o]){var s="\n#define "+o.toUpperCase()+(1==n[o]?"":" "+n[o])+"\n";t=t.replace(/\n/,s),r=null==r?void 0:r.replace(/\n/,s)}var f=[],u=i(e,t=t.replace(/^layout\([^\)]*\) (out \S+ (\S+);)$/gim,(function(e,t,r){return f.push(r),t})),r||"#version 300 es\nvoid main(){}",f.length?f:null);return{target:u,uniforms:a(e,u)}},t.compileProgram=i,t.locateUniforms=a;var o=function(){function e(e,t,r){var i;void 0===r&&(r=0),this.frame=0,this.uniforms=Object.create(null),this.buffer=e.createBuffer(),this.data=new Float32Array(t.byteSize/Float32Array.BYTES_PER_ELEMENT);for(var a=(null===(i=t.uniforms)||void 0===i?void 0:i.length)-1;a>=0;a--){var o=t.offsets[a],s=t.uniforms[a],f=s.type,u=s.size,c=s.name,l=n.GLSLTypeSize[f]*u,d=new n.GLSLDataType[f](this.data.buffer,o,l);this.uniforms[c]=d}e.bindBufferBase(35345,r,this.buffer),e.bufferData(35345,this.data.byteLength,35048)}return e.prototype.bind=function(e,t){e.bindBufferBase(35345,t,this.buffer),e.bufferSubData(35345,0,this.data)},e}();t.UniformBlock=o},8999:(e,t)=>{"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.GLSLDataType=t.GLSLTypeSize=t.VertexDataFormat=t.UniformSamplerBindings=t.UniformBlockBindings=void 0,t.UniformBlockBindings={CameraUniforms:0,ModelUniforms:1,LightUniforms:2,GlobalUniforms:3,EmitterUniforms:2},t.UniformSamplerBindings={uSampler:0,uGradient:1,uAttributes:6,uDiffuseMap:0,uNormalMap:1,uPositionBuffer:2,uNormalBuffer:3,uAlbedoBuffer:4,uArrayMap:7},t.VertexDataFormat={Skinned:{},Static:[{name:"index",size:1,type:5123},{name:"position",size:3,type:5126,normalized:!1,stride:32,offset:0},{name:"normal",size:3,type:5126,normalized:!1,stride:32,offset:12},{name:"uv",size:2,type:5126,normalized:!1,stride:32,offset:24}],Batched2D:[{name:"index",size:1,type:5123},{name:"position",size:2,type:5126,normalized:!1,stride:20,offset:0},{name:"uv",size:2,type:5123,normalized:!0,stride:20,offset:8},{name:"color",size:4,type:5121,normalized:!0,stride:20,offset:12},{name:"material",size:4,type:5121,normalized:!1,stride:20,offset:16}],Batched:[{name:"index",size:1,type:5123},{name:"position",size:3,type:5126,normalized:!1,stride:24,offset:0},{name:"uv",size:2,type:5123,normalized:!0,stride:24,offset:12},{name:"color",size:4,type:5121,normalized:!0,stride:24,offset:16},{name:"domain",size:3,type:5121,normalized:!1,stride:24,offset:20},{name:"material",size:1,type:5121,normalized:!1,stride:24,offset:23}],Decal:[{name:"aModelMatrix",size:16,type:5126,normalized:!1,stride:76,offset:0},{name:"aUV",size:4,type:5123,normalized:!0,stride:76,offset:64},{name:"aColor",size:4,type:5121,normalized:!0,stride:76,offset:72}],Particle:[{name:"aLifetime",size:4,type:5126,normalized:!1,stride:80,offset:0},{name:"aSize",size:4,type:5126,normalized:!1,stride:80,offset:16},{name:"aTransform",size:4,type:5126,normalized:!1,stride:80,offset:32},{name:"aVelocity",size:4,type:5126,normalized:!1,stride:80,offset:48},{name:"aAcceleration",size:4,type:5126,normalized:!1,stride:80,offset:64}]},t.GLSLTypeSize=((r={})[5124]=1,r[35678]=1,r[36289]=1,r[5126]=1,r[35664]=2,r[35665]=3,r[35666]=4,r[35674]=4,r[35675]=9,r[35676]=16,r),t.GLSLDataType=((n={})[5121]=Uint8Array,n[5123]=Uint16Array,n[5124]=Int32Array,n[35678]=Int32Array,n[36289]=Int32Array,n[5126]=Float32Array,n[35664]=Float32Array,n[35665]=Float32Array,n[35666]=Float32Array,n[35674]=Float32Array,n[35675]=Float32Array,n[35676]=Float32Array,n)},9374:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLState=void 0;var r=function(){function e(e){var t,r;for(var n in this.gl=e,this.extensions={color_buffer_float:this.gl.getExtension("EXT_color_buffer_float"),color_buffer_half_float:this.gl.getExtension("EXT_color_buffer_half_float"),float_blend:this.gl.getExtension("EXT_float_blend"),texture_filter_anisotropic:this.gl.getExtension("EXT_texture_filter_anisotropic"),texture_norm16:this.gl.getExtension("EXT_texture_norm16"),texture_float_linear:this.gl.getExtension("OES_texture_float_linear")},this.cache=((t={})[35661]=this.gl.getParameter(35661),t[35660]=this.gl.getParameter(35660),t[34930]=this.gl.getParameter(34930),t[34921]=this.gl.getParameter(34921),t[36347]=this.gl.getParameter(36347),t[36349]=this.gl.getParameter(36349),t[36348]=this.gl.getParameter(36348),t[3386]=this.gl.getParameter(3386),t[3379]=this.gl.getParameter(3379),t[34024]=this.gl.getParameter(34024),t[34852]=this.gl.getParameter(34852),t[36063]=this.gl.getParameter(36063),t.fragment=this.gl.getShaderPrecisionFormat(35632,36338),t.vertex=this.gl.getShaderPrecisionFormat(35633,36338),t),this.state=((r={})[34229]=null,r[36006]=null,r[36010]=null,r[36007]=null,r[2978]=new Int32Array(4),r[35725]=null,r[34964]=null,r[34016]=33984,r[3553]=Array(this.cache[34930]),r[35866]=Array(this.cache[34930]),r[34067]=Array(this.cache[34930]),r[32879]=Array(this.cache[34930]),r[3106]=new Float32Array(4),r[2931]=1,r[2961]=0,r[2929]=!1,r[2932]=513,r[2928]=[0,1],r[2930]=!0,r[2884]=!1,r[2885]=1029,r[2886]=2305,r[3042]=!1,r[32969]=1,r[32968]=0,r[32971]=1,r[32970]=0,r[32773]=new Float32Array(4),r[32777]=32774,r[34877]=32774,r[3107]=[!0,!0,!0,!0],r[3089]=!1,r[3088]=new Int32Array(4),r),WebGL2RenderingContext.prototype)if(!(n in this)){var i=this.gl[n];"function"==typeof i&&(this[n]=i.bind(this.gl))}}return Object.defineProperty(e.prototype,"canvas",{get:function(){return this.gl.canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.gl.drawingBufferHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawingBufferWidth",{get:function(){return this.gl.drawingBufferWidth},enumerable:!1,configurable:!0}),e.prototype.disable=function(e){this.state[e]&&(this.state[e]=!1,this.gl.disable(e))},e.prototype.enable=function(e){this.state[e]||(this.state[e]=!0,this.gl.enable(e))},e.prototype.viewport=function(e,t,r,n){this.state[2978][0]===e&&this.state[2978][1]===t&&this.state[2978][2]===r&&this.state[2978][3]===n||this.gl.viewport(this.state[2978][0]=e,this.state[2978][1]=t,this.state[2978][2]=r,this.state[2978][3]=n)},e.prototype.blendColor=function(e,t,r,n){this.state[32773][0]===e&&this.state[32773][1]===t&&this.state[32773][2]===r&&this.state[32773][3]===n||this.gl.blendColor(this.state[32773][0]=e,this.state[32773][1]=t,this.state[32773][2]=r,this.state[32773][3]=n)},e.prototype.blendEquation=function(e){this.blendEquationSeparate(e,e)},e.prototype.blendEquationSeparate=function(e,t){this.state[32777]===e&&this.state[34877]===t||this.gl.blendEquationSeparate(this.state[32777]=e,this.state[34877]=t)},e.prototype.blendFunc=function(e,t){this.blendFuncSeparate(e,t,e,t)},e.prototype.blendFuncSeparate=function(e,t,r,n){this.state[32969]===e&&this.state[32968]===t&&this.state[32971]===r&&this.state[32970]===n||this.gl.blendFuncSeparate(this.state[32969]=e,this.state[32968]=t,this.state[32971]=r,this.state[32970]=n)},e.prototype.clearColor=function(e,t,r,n){this.state[3106][0]===e&&this.state[3106][1]===t&&this.state[3106][2]===r&&this.state[3106][3]===n||this.gl.clearColor(this.state[3106][0]=e,this.state[3106][1]=t,this.state[3106][2]=r,this.state[3106][3]=n)},e.prototype.clearDepth=function(e){this.state[2931]!==e&&this.gl.clearDepth(this.state[2931]=e)},e.prototype.colorMask=function(e,t,r,n){this.state[3107][0]===e&&this.state[3107][1]===t&&this.state[3107][2]===r&&this.state[3107][3]===n||this.gl.colorMask(this.state[3107][0]=e,this.state[3107][1]=t,this.state[3107][2]=r,this.state[3107][3]=n)},e.prototype.cullFace=function(e){this.state[2885]!==e&&this.gl.cullFace(this.state[2885]=e)},e.prototype.depthFunc=function(e){this.state[2932]!==e&&this.gl.depthFunc(this.state[2932]=e)},e.prototype.depthMask=function(e){this.state[2930]!==e&&this.gl.depthMask(this.state[2930]=e)},e.prototype.depthRange=function(e,t){this.state[2928][0]===e&&this.state[2928][1]===t||this.gl.depthRange(this.state[2928][0]=e,this.state[2928][1]=t)},e.prototype.frontFace=function(e){this.state[2886]!==e&&this.gl.frontFace(this.state[2886]=e)},e.prototype.scissor=function(e,t,r,n){this.state[3088][0]===e&&this.state[3088][1]===t&&this.state[3088][2]===r&&this.state[3088][3]===n||this.gl.scissor(this.state[3088][0]=e,this.state[3088][1]=t,this.state[3088][2]=r,this.state[3088][3]=n)},e.prototype.bindBuffer=function(e,t){this.gl.bindBuffer(e,t)},e.prototype.bindVertexArray=function(e){this.state[34229]!==e&&this.gl.bindVertexArray(this.state[34229]=e)},e.prototype.activeTexture=function(e){this.state[34016]!==e&&this.gl.activeTexture(this.state[34016]=e)},e.prototype.bindTexture=function(e,t){var r=this.state[34016]-33984;this.state[e][r]!==t&&this.gl.bindTexture(e,this.state[e][r]=t)},e.prototype.useProgram=function(e){this.state[35725]!==e&&this.gl.useProgram(this.state[35725]=e)},e.prototype.blitFramebuffer=function(e,t,r,n,i,a,o,s,f,u){this.gl.blitFramebuffer(e,t,r,n,i,a,o,s,f,u)},e.prototype.drawArraysInstanced=function(e,t,r,n){this.gl.drawArraysInstanced(e,t,r,n)},e.prototype.drawElementsInstanced=function(e,t,r,n,i){this.gl.drawElementsInstanced(e,t,r,n,i)},e.prototype.drawRangeElements=function(e,t,r,n,i,a){this.gl.drawRangeElements(e,t,r,n,i,a)},e.prototype.drawArrays=function(e,t,r){this.gl.drawArrays(e,t,r)},e.prototype.drawElements=function(e,t,r,n){this.gl.drawElements(e,t,r,n)},e.prototype.shaderSource=function(e,t){this.gl.shaderSource(e,t)},e}();t.WebGLState=r},9246:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTexture=void 0;var n=r(3850);t.createTexture=function(e,t,r){var i=void 0===r?{}:r,a=i.flipY,o=i.format,s=void 0===o?32856:o,f=i.mipmaps,u=void 0===f?9728:f,c=i.wrap,l=void 0===c?10497:c,d=i.filter,h=void 0===d?9729:d,m=i.type,v=void 0===m?3553:m,p=e.createTexture();e.activeTexture(33984),e.bindTexture(v,p),e.pixelStorei(37440,a);var x=n.int32pow2(t.width)&&n.int32pow2(t.height);return x&&u?(e.texParameteri(v,10240,h),e.texParameteri(v,10241,9729===h?9729===u?9987:9985:9729===u?9986:9984)):(e.texParameteri(v,10240,h),e.texParameteri(v,10241,h)),e.texParameteri(v,10242,l),e.texParameteri(v,10243,l),3553===v?(e.texStorage2D(v,1,s,t.width,t.height),t.data&&e.texSubImage2D(v,0,0,0,t.width,t.height,6408,t.data instanceof Float32Array?5126:5121,t.data)):35866===v&&(e.texStorage3D(v,1,s,t.width,t.height,t.depth),t.data&&e.texSubImage3D(v,0,0,0,0,t.width,t.height,t.depth,6408,5121,t.data)),t.data&&x&&u&&e.generateMipmap(v),p}},439:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(8716),a=r(3335),o=r(5164),s=r(4132),f=r(200),u=r(642),c=r(6479),l=r(5448),d=r(5060),h=r(8895),m=r(7304),v=r(2982),p=r(8425),x=r(7953),y=r(7455),g=n(r(9791));new i.Application([u.KeyboardSystem,a.TransformSystem,a.CameraSystem,o.MaterialSystem,s.MeshSystem,f.SpriteSystem,c.DeferredGeometryPass,l.DecalPass,h.AmbientLightPass,d.PointLightPass,m.ParticleEffectPass,v.PostEffectPass,p.OverlayPass,y.SharedSystem,y.TurnBasedSystem,y.TerrainSystem,y.PlayerSystem,y.AISystem,x.DebugSystem]).load(g.default)},6334:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AISystem=void 0;var r=function(){function e(e){this.context=e}return e.prototype.update=function(){},e}();t.AISystem=r},6328:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TurnBasedSystem=void 0;var r=function(){function e(e){this.context=e,this.actors=[],this.queue=[],this.index=0,this.turn=0,this.actionIndex=0,this.lastActionIndex=0}return e.prototype.start=function(e,t){return this.queue.push({generator:e,iterator:null,pending:t,index:this.actionIndex++}),this.actionIndex-1},e.prototype.add=function(e){var t;for(t=this.actors.length-1;t>=0&&this.actors[t].order-e.order>0;t--);this.actors.splice(t+1,0,e),t+1<=this.index&&this.index++},e.prototype.remove=function(e){var t=this.actors.indexOf(e);this.actors.splice(t,1),t<=this.index&&this.index--},e.prototype.update=function(){e:if(this.actors.length&&!(this.lastActionIndex<this.actionIndex)){this.index>=this.actors.length&&(this.turn++,this.index=0);for(var e=this.queue[0]?this.queue[0].index:this.actionIndex-1;this.index<this.actors.length;){var t=this.actors[this.index++];if(t.prevAction>=e)break e;var r=t.execute(this.turn);if(r){t.prevAction=this.start(r,!0);break}}}this.lastActionIndex=this.actionIndex;for(var n=0,i=0;i<this.queue.length;i++){var a=this.queue[i],o=i-n;(!a.iterator||0===a.iterator.value||2===a.iterator.value&&this.lastActionIndex>=a.index||1===a.iterator.value&&0===o)&&(a.iterator=a.generator.next()),a.pending&&!a.iterator.done&&(this.lastActionIndex=Math.min(this.lastActionIndex,a.index)),a.iterator.done?n++:this.queue[o]=a}this.queue.length-=n},e}();t.TurnBasedSystem=r},1162:function(e,t,r){"use strict";var n=this&&this.__generator||function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Workshop=void 0;var i=r(7594),a=r(1513),o=r(4132),s=r(642),f=r(2392),u=r(9357),c=r(6328),l=r(9040),d=function(){function e(e){this.context=e,this.order=1,this.tile=i.vec2(),this.opened=!1}return e.prototype.place=function(t,r){i.vec2.set(t,r,this.tile),this.mesh=this.context.get(o.MeshSystem).loadModel("dock"),this.mesh.transform=this.context.get(a.TransformSystem).create();var n=this.mesh.transform.position;this.context.get(f.TerrainSystem).tilePosition(t,r,n);var s=this.context.get(f.TerrainSystem).chunk(t,r),l=[n[0]-3,n[2]-3,n[0]+3,n[2]+3];s.mapRegion(l,l),s.terraform(l,(function(){return n[1]})),this.context.get(f.TerrainSystem).tilePosition(t,r,n),i.quat.axisAngle(i.vec3.AXIS_Y,.5*Math.PI,this.mesh.armature.nodes[0].rotation),u.modelAnimations.dock.open(0,this.mesh.armature);for(var d=0;d<e.area.length;d++)s.set(e.area[d][0]+t,e.area[d][1]+r,this);this.context.get(c.TurnBasedSystem).add(this)},e.prototype.kill=function(){this.mesh&&(this.context.get(c.TurnBasedSystem).remove(this),this.context.get(a.TransformSystem).delete(this.mesh.transform),this.context.get(o.MeshSystem).delete(this.mesh),this.mesh=null)},e.prototype.execute=function(e){var t,r,a,o,c,d,h,m,v,p,x,y,g,b,S,P;return n(this,(function(e){switch(e.label){case 0:for(t=this.mesh.armature,r=null,a=-2;a<=2;a++)if((o=this.context.get(f.TerrainSystem).getTile(this.tile[0],this.tile[1]+a))instanceof l.Cube){r=o;break}if(this.opened)return[3,5];if(!r)return[2];this.opened=!0,b=.64,S=this.context.currentTime,e.label=1;case 1:return P=Math.min(1,(this.context.currentTime-S)/b),u.modelAnimations.dock.open(P,t),P>=1?[3,4]:[4,0];case 2:e.sent(),e.label=3;case 3:return[3,1];case 4:return[3,22];case 5:if(r)return[3,10];this.opened=!1,b=.64,S=this.context.currentTime,e.label=6;case 6:return P=Math.min(1,(this.context.currentTime-S)/b),u.modelAnimations.dock.open(1-P,t),P>=1?[3,9]:[4,0];case 7:e.sent(),e.label=8;case 8:return[3,6];case 9:return[3,22];case 10:return r&&r.state.tile[1]===this.tile[1]?[4,1]:[3,22];case 11:e.sent(),c=r.meshes[r.state.side],d=i.vec3.copy(c.transform.position,i.vec3()),h=i.vec3.add(this.mesh.transform.position,[0,2,0],i.vec3()),m=this.context.get(l.PlayerSystem).cameraOffset,v=i.vec3.copy(m,i.vec3()),p=i.vec3(-2,4,2),x=[2,3,5,6,4,7,8,9,10],b=1,S=this.context.currentTime,e.label=12;case 12:return P=Math.min(1,(this.context.currentTime-S)/b),u.modelAnimations.dock.lift(P,t),i.vec3.lerp(d,h,i.ease.quadIn(P),c.transform.position),i.vec3.lerp(v,p,i.ease.quadInOut(P),m),c.transform.frame=0,P>=1?[3,15]:[4,0];case 13:e.sent(),e.label=14;case 14:return[3,12];case 15:y=this.context.get(s.KeyboardSystem),e.label=16;case 16:return y.down("KeyW")||y.down("KeyS")?[3,18]:(y.trigger("KeyA")?(x.push(x.shift()),console.log("available",x[0])):y.trigger("KeyD")?(x.unshift(x.pop()),console.log("available",x[0])):y.trigger("Space")&&(g=(4-r.state.direction)%4,r.installModule(r.state.side,g,x[0])),[4,0]);case 17:return e.sent(),[3,16];case 18:b=1,S=this.context.currentTime,e.label=19;case 19:return P=Math.min(1,(this.context.currentTime-S)/b),u.modelAnimations.dock.lift(1-P,t),i.vec3.lerp(d,h,i.ease.quadIn(1-P),c.transform.position),i.vec3.lerp(v,p,i.ease.quadInOut(1-P),m),c.transform.frame=0,P>=1?[3,22]:[4,0];case 20:e.sent(),e.label=21;case 21:return[3,19];case 22:return[2]}}))},e.area=[[-1,-1],[1,-1],[-1,0],[1,0],[-1,1],[1,1]],e}();t.Workshop=d},9357:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.modelAnimations=t.ArmatureAnimation=void 0;var i=r(7594),a=r(9740),o=n(r(7082));for(var s in t.ArmatureAnimation=function(e){return function(t,r){for(var n,i,a,o=e.length-1;o>=0;o--){var s=e[o],f=r.nodes[s.index];null===(n=s.position)||void 0===n||n.call(s,t,f.position),null===(i=s.rotation)||void 0===i||i.call(s,t,f.rotation),null===(a=s.scale)||void 0===a||a.call(s,t,f.scale)}return r.frame=0,r}},t.modelAnimations=Object.create(null),o.default)for(var f in o.default[s]){for(var u=o.default[s][f],c=[],l=0;l<u.length;l++){var d=u[l],h=d.frame,m=d.index,v=d.position,p=d.rotation,x=d.scale,y=a.parseEase(u[l].ease);c[m]||(c[m]={index:m,position:[],rotation:[],scale:[]}),v&&c[m].position.push({frame:h,value:v,ease:y}),x&&c[m].scale.push({frame:h,value:x,ease:y}),p&&c[m].rotation.push({frame:h,value:p,ease:y})}var g=t.ArmatureAnimation(c.map((function(e){var t=e.index,r=e.position,n=e.scale,o=e.rotation;return{index:t,position:r.length?a.PropertyAnimation(r,i.vec3.lerp,1):void 0,scale:n.length?a.PropertyAnimation(n,i.vec3.lerp,1):void 0,rotation:o.length?a.PropertyAnimation(o,i.quat.slerp,1):void 0}})).filter(Boolean));t.modelAnimations[s]=t.modelAnimations[s]||Object.create(null),t.modelAnimations[s][f]=g}},1160:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(9357),t)},6537:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridEffect=void 0;var n=r(556),i=r(1513),a=r(5448),o=r(7908),s=r(7594),f=function(){function e(e,t){this.context=e,this.gridSize=t,this.enabled=!1;var o=this.context.gl;this.program=n.ShaderProgram(o,r(4423),r(1653)),this.program.uniforms.uGridSize=1/t,this.vao=o.createVertexArray(),o.bindVertexArray(this.vao),o.bindBuffer(34963,this.context.get(a.DecalPass).batch.indexBuffer),o.bindBuffer(34962,this.context.get(a.DecalPass).batch.vertexBuffer),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,3,5126,!1,0,0),o.bindVertexArray(null),this.transform=this.context.get(i.TransformSystem).create(),s.vec3.set(2*t,10,2*t,this.transform.scale)}return e.prototype.apply=function(){if(this.enabled){var e=this.context.gl;e.useProgram(this.program.target),this.program.uniforms.uModelMatrix=this.transform.matrix,e.bindVertexArray(this.vao),e.enable(3042),e.blendEquation(32774),e.blendFuncSeparate(770,771,0,1),e.drawElements(4,o.DecalBatch.unitCubeIndices.length,5123,0)}},e}();t.GridEffect=f},7615:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.MistEffect=void 0;var a=r(7594),o=r(556),s=r(1974),f=function(e){function t(t,n,i){var s=e.call(this,t,{limit:n,depthTest:515,depthWrite:!1,cull:1029,blend:1,format:[{name:"aTransform",size:3,type:5126,normalized:!1,stride:12,offset:0}]},null,o.ShaderProgram(t.gl,r(323),r(452),{POINT:!0}),null)||this;s.center=a.vec3(0,0,0),s.ray=a.vec3(0,0,0),s.frame=0,s.program.uniforms.uArea=a.vec3(i[3]-i[0],i[4]-i[1],i[5]-i[2]),s.instances=n;for(var f=s.context.gl,u=new Float32Array(3*s.instances),c=0;c<s.instances;c++)u[3*c+0]=a.randomFloat(i[0],i[3],Math.random),u[3*c+1]=a.randomFloat(i[1],i[4],Math.random),u[3*c+2]=a.randomFloat(i[2],i[5],Math.random);return f.bindBuffer(34962,s.buffer[0]),f.bufferSubData(34962,0,u),s}return i(t,e),t.prototype.apply=function(){var t,r,n,i,o,f,u,c,l=this.context.get(s.CameraSystem).camera;this.frame>=l.frame&&this.frame||(this.frame=this.context.frame,a.vec3.set(l.viewMatrix[2],l.viewMatrix[6],l.viewMatrix[10],this.ray),t=l.transform.position,r=this.ray,n=a.vec3.AXIS_Y,i=a.vec3.ZERO,o=this.center,f=-a.vec3.dot(i,n),u=a.vec3.dot(r,n),c=-(a.vec3.dot(t,n)+f)/u,a.vec3.scale(r,c,o),a.vec3.add(o,t,o),this.context.gl.useProgram(this.program.target),this.program.uniforms.uCenter=this.center,this.program.uniforms.uSize=.2*this.context.gl.drawingBufferHeight*.5*l.projectionMatrix[5]),e.prototype.apply.call(this)},t}(r(9217).ParticleSystem);t.MistEffect=f},7226:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ShieldEffect=void 0;var a=r(8716),o=r(6240),s=r(556),f=r(4132),u=function(){},c=function(e){function t(t){var n=e.call(this,u)||this;n.context=t,n.enabled=!0,n.program=s.ShaderProgram(n.context.gl,r(373),r(7460),{});var i=o.createSphere({longitude:32,latitude:32,radius:1});return n.buffer=n.context.get(f.MeshSystem).uploadVertexData(i.vertexArray,i.indexArray,i.format),n}return i(t,e),t.prototype.apply=function(){if(this.enabled&&this.list.length){var e=this.context.gl;e.enable(3042),e.blendFunc(1,1),e.disable(2884),e.bindVertexArray(this.buffer.vao),e.useProgram(this.program.target);for(var t=this.list.length-1;t>=0;t--)this.program.uniforms.uModelMatrix=this.list[t].transform.matrix,e.drawElements(4,this.buffer.indexCount,5123,this.buffer.indexOffset)}},t}(a.Factory);t.ShieldEffect=c},7464:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EffectLibrary=t.GridEffect=t.ShieldEffect=void 0;var n=r(556),i=r(5164),a=r(7304),o=r(8211),s=r(7615),f=r(7226);Object.defineProperty(t,"ShieldEffect",{enumerable:!0,get:function(){return f.ShieldEffect}});var u=r(6537);Object.defineProperty(t,"GridEffect",{enumerable:!0,get:function(){return u.GridEffect}});t.EffectLibrary=function(e){this.context=e;var t=this.context.get(i.MaterialSystem);this.mist=new s.MistEffect(e,256,[-8,0,-8,8,6,8]),this.mist.diffuse=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,o.shaders.fullscreen_vert,r(7787),{CIRCLE:!0}),{uColor:[.5,.5,.5,1]},0).target,this.mist.enabled=!1,this.context.get(a.ParticleEffectPass).effects.push(this.mist)}},7455:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(9258),t),i(r(6328),t),i(r(2392),t),i(r(9040),t),i(r(1162),t),i(r(6334),t)},4268:function(e,t,r){"use strict";var n=this&&this.__generator||function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Cube=void 0;var i=r(7594),a=r(4132),o=r(1513),s=r(642),f=r(5060),u=r(2392),c=r(9357),l=r(9740),d=r(1522),h=r(6328),m=r(6830),v=r(6876),p=r(9258),x=function(){function e(e){this.context=e,this.order=0,this.hash=0,this.meshes=[],this.state={tile:i.vec2(0,0),side:0,direction:0,sides:i.range(6).map((function(e){return{type:0,direction:0,level:0,open:0}})),armor:10},this.transform=this.context.get(o.TransformSystem).create()}return e.prototype.place=function(e,t){i.vec2.set(e,t,this.state.tile),this.context.get(u.TerrainSystem).tilePosition(e,t,this.transform.position),this.transform.frame=0;for(var r=0;r<this.state.sides.length;r++)this.installModule(r,this.state.sides[r].direction,this.state.sides[r].type);this.context.get(u.TerrainSystem).setTile(this.state.tile[0],this.state.tile[1],this),this.context.get(h.TurnBasedSystem).add(this);var n=this.context.get(f.PointLightPass).create();n.transform=this.context.get(o.TransformSystem).create(),n.transform.parent=this.transform,n.transform.position[1]=4,n.radius=12,n.intensity=1,i.vec3.set(1,1,.8,n.color),this.dust=p.SharedSystem.particles.dust.add({uOrigin:[0,0,0],uLifespan:[.8,1.2,-.16,0],uSize:[2,4],uRadius:[.2,.4],uForce:[4,8],uTarget:[0,-.1,0],uGravity:[0,9.8,0],uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]})},e.prototype.installModule=function(e,t,r){this.meshes[e]&&this.context.get(a.MeshSystem).delete(this.meshes[e]);var n=v.cubeModules[r],o=this.meshes[e]=this.context.get(a.MeshSystem).loadModel(n.model);o.transform=this.transform,o.program=this.state.side==e?1:-1,this.state.sides[e].direction=t,this.state.sides[e].type=r;var s=d.DirectionAngle[(this.state.direction+this.state.sides[e].direction)%4];i.quat.copy(s,o.armature.nodes[0].rotation),c.modelAnimations[n.model].close(0,o.armature),this.hash=this.state.sides.reduce((function(e,t){return 4*e*11+11*t.direction+t.type}),0)},e.prototype.kill=function(){},e.prototype.execute=function(e){var t,r,a,f,u,l,p,x,y,g,b,S,P,w,M,T,_;return n(this,(function(e){switch(e.label){case 0:t=this.context.get(s.KeyboardSystem),r=this.state.sides[this.state.side],a=v.cubeModules[r.type],f=this.meshes[this.state.side],e.label=1;case 1:return u=-1,t.down("KeyA")?u=3:t.down("KeyD")?u=1:t.down("KeyW")?u=2:t.down("KeyS")&&(u=0),l=r.open,p=this.context.deltaTime,l>0&&-1!=u?r.open=Math.min(0,p-r.open):0==l&&t.down("Space")?r.open=Math.min(1,p):0!=l&&1!=l&&(r.open=Math.min(l>0?1:0,l+p)),r.open==l?[3,3]:(c.modelAnimations[a.model].open(Math.abs(r.open),f.armature),[4,0]);case 2:return e.sent(),[3,1];case 3:switch(r.type){case 3:case 5:return[3,4];case 9:return[3,9]}return[3,13];case 4:if(1!=r.open)return[3,13];if(!t.down("Space"))return[3,13];x=d.DirectionAngle[(this.state.direction+r.direction)%4],y=this.context.get(m.PlayerSystem).skills[r.type],g=y.activate(this.transform.matrix,x),e.label=5;case 5:return(b=g.next()).done?[2,b.value]:[3,6];case 6:return[4,b.value];case 7:e.sent(),e.label=8;case 8:return[3,5];case 9:if(1!=r.open)return[3,13];(S=this.context.get(m.PlayerSystem).shield.create()).transform=this.context.get(o.TransformSystem).create(),S.transform.parent=this.transform,i.vec3.copy([0,0,0],S.transform.scale),P=i.ease.elasticOut(1,.75),w=1,M=this.context.currentTime,e.label=10;case 10:return T=(this.context.currentTime-M)/w,i.vec3.lerp(i.vec3.ZERO,[3,5,3],P(Math.min(1,T)),S.transform.scale),S.transform.frame=0,c.modelAnimations[a.model].activate(T%1,f.armature),[4,0];case 11:e.sent(),e.label=12;case 12:return[3,10];case 13:return 0==r.open&&-1!=u&&(_=this.moveTransition(u))?(this.prevAction=this.context.get(h.TurnBasedSystem).start(_,!1),[3,15]):[4,0];case 14:return e.sent(),[3,1];case 15:return[2]}}))},e.prototype.moveTransition=function(e){var t=d.CubeOrientation.roll(d.CubeOrientation(this.state.side,this.state.direction),e),r=3&t,a=t>>>2,o=i.vec2.copy(this.state.tile,i.vec2());console.log("F "+this.state.side+"-"+a+" D "+this.state.direction+"-"+r+" > "+e);var s=i.quat(),f=d.DirectionAngle[(r+this.state.sides[a].direction)%4],h=i.vec3();switch(e){case 3:o[0]--,i.quat.axisAngle(i.vec3.AXIS_Z,-.5*Math.PI,s),h[0]=-.5*u.TerrainChunk.tileSize;break;case 1:o[0]++,i.quat.axisAngle(i.vec3.AXIS_Z,.5*Math.PI,s),h[0]=.5*u.TerrainChunk.tileSize;break;case 0:o[1]++,i.quat.axisAngle(i.vec3.AXIS_X,-.5*Math.PI,s),h[2]=.5*u.TerrainChunk.tileSize;break;case 2:o[1]--,i.quat.axisAngle(i.vec3.AXIS_X,.5*Math.PI,s),h[2]=-.5*u.TerrainChunk.tileSize}if(null==this.context.get(u.TerrainSystem).getTile(o[0],o[1])){this.meshes[this.state.side].program=-1,this.meshes[a].program=1,this.state.direction=r,this.state.side=a,this.context.get(u.TerrainSystem).setTile(this.state.tile[0],this.state.tile[1],null),this.context.get(u.TerrainSystem).setTile(o[0],o[1],this),i.vec2.copy(o,this.state.tile);var m=this.meshes[this.state.side],p=v.cubeModules[this.state.sides[this.state.side].type];c.modelAnimations[p.model].close(0,m.armature);var x=m.armature.nodes[0],y=i.vec3.copy(m.transform.position,i.vec3()),g=this.context.get(u.TerrainSystem).tilePosition(this.state.tile[0],this.state.tile[1],i.vec3());i.quat.multiply(s,f,s);var b=i.vec3.subtract(g,h,i.vec3());return i.quat.transform(h,i.quat.conjugate(f,i.quat()),h),function(){var e,t,r,a,o,u;return n(this,(function(n){switch(n.label){case 0:e=l.EmitterTrigger({frame:.36,value:16,origin:g,target:i.vec3.add(g,[0,-.2,0],i.vec3())}),t=i.ease.bounceIn(.064,.8),r=.64,a=this.context.currentTime,n.label=1;case 1:return o=this.context.currentTime-a,u=Math.min(1,o/r),m.transform.frame=0,m.armature.frame=0,i.vec3.lerp(y,g,u,m.transform.position),i.quat.slerp(s,f,t(u),x.rotation),i.quat.normalize(x.rotation,x.rotation),i.quat.transform(h,x.rotation,x.position),i.vec3.subtract(x.position,m.transform.position,x.position),i.vec3.add(b,x.position,x.position),x.position[1]+=m.transform.position[1]-g[1],e(o,this.context.deltaTime,this.dust),u>=1?[3,4]:[4,0];case 2:n.sent(),n.label=3;case 3:return[3,1];case 4:return[2]}}))}.call(this)}},e}();t.Cube=x},6876:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.cubeModules=void 0,t.cubeModules=((r={})[0]={model:"cube_open"},r[1]={model:"death"},r[2]={model:"cube_0"},r[3]={model:"cube_1"},r[4]={model:"cube_2"},r[5]={model:"cube_3"},r[6]={model:"cube_4"},r[7]={model:"cube_5"},r[8]={model:"cube_6"},r[9]={model:"cube_7"},r[10]={model:"cube_8"},r[11]=null,r)},1522:(e,t,r)=>{"use strict";var n,i,a,o,s,f,u,c;Object.defineProperty(t,"__esModule",{value:!0}),t.CubeOrientation=t.DirectionAngle=void 0;var l=r(7594);t.DirectionAngle=((n={})[0]=l.quat.axisAngle(l.vec3.AXIS_Y,.5*Math.PI,l.quat()),n[1]=l.quat.axisAngle(l.vec3.AXIS_Y,1*Math.PI,l.quat()),n[2]=l.quat.axisAngle(l.vec3.AXIS_Y,1.5*Math.PI,l.quat()),n[3]=l.quat.axisAngle(l.vec3.AXIS_Y,2*Math.PI,l.quat()),n),t.CubeOrientation=function(e,t){return e<<2|t},t.CubeOrientation.rotate=function(e,r){var n=e>>>2,i=3&e;return t.CubeOrientation(n,(4+i+r)%4)},t.CubeOrientation.roll=function(e,r){var n=3&e,i=d[28&e][(4+r-n)%4];return t.CubeOrientation.rotate(i,n)};var d=((i={})[0]=((a={})[0]=4,a[1]=21,a[2]=18,a[3]=11,a),i[4]=((o={})[0]=12,o[1]=20,o[2]=0,o[3]=8,o),i[8]=((s={})[0]=15,s[1]=4,s[2]=1,s[3]=16,s),i[20]=((f={})[0]=13,f[1]=16,f[2]=3,f[3]=4,f),i[12]=((u={})[0]=18,u[1]=23,u[2]=4,u[3]=9,u),i[16]=((c={})[0]=14,c[1]=8,c[2]=2,c[3]=20,c),i)},4672:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CubeTileMap=void 0;var n=r(7594),i=r(556),a=r(7908),o=r(8425),s=r(200),f=r(1513),u=r(5164),c=r(1522),l=function(){function e(e){this.context=e,this.batchRanges=[],this.tiles=[],this.materials=[],this.projectionMatrix=n.mat3(),this.side=-1,this.hash=-1,this.batch=new a.Batch2D(this.context.gl,144,216,a.Batch2D.quadIndices),this.program=i.ShaderProgram(this.context.gl,r(7023),r(8058))}return e.prototype.renderTexture=function(e,t,r,n){var i=this.context.gl;i.bindFramebuffer(36160,e.fbo),i.viewport(0,0,e.size[0],e.size[1]),i.useProgram(n.target),n.uniforms.uProjectionMatrix=this.projectionMatrix,n.uniforms.uScale=u.MaterialSystem.heightmapScale,n.uniforms.uScreenSize=e.size,this.batch.bind(),i.drawElements(4,t,5123,2*r)},e.prototype.extractTileMap=function(e,t,r){var i=this.context.gl,a=this.context.get(u.MaterialSystem).createRenderTexture(t*e.length,t,1,{filter:9728,wrap:33071}),c=n.vec2(t*r,t*r),l=new s.Sprite2D;l.transform=new f.Transform2D,l.material=new s.SpriteMaterial,n.vec2.set(t,t,l.material.size),s.SpriteMaterial.calculateUVMatrix(n.aabb2(5*t,0,6*t,t),c,l.material.uvMatrix);for(var d=0;d<e.length;d++){var h=e[d],m=i.createFramebuffer();i.bindFramebuffer(36160,m),i.framebufferTexture2D(36160,36064,3553,h.diffuse,0),i.framebufferTexture2D(36160,36065,3553,h.normal,0),i.drawBuffers([36064,36065]),this.materials[h.index]={size:c,fbo:m},l.material.diffuse=h.diffuse,n.vec2.set(d*t,0,l.transform.position),l.transform.recalculate(0),l.recalculate(0),this.batch.render(l);var v=this.tiles[h.index]=new s.SpriteMaterial;v.diffuse=a.target,n.vec2.set(t,t,v.size),s.SpriteMaterial.calculateUVMatrix(n.aabb2(d*t,0,(d+1)*t,t),n.vec2(t*e.length,t),v.uvMatrix)}var p=this.batch.indexOffset,x=n.mat3x2.orthogonal(0,a.width,0,a.height,n.mat3x2());n.mat3.fromMat3x2(x,this.projectionMatrix),this.renderTexture({fbo:a.fbo[0],size:n.vec2(a.width,a.height)},p,0,this.context.get(o.OverlayPass).program),this.batch.bindTextures(Array(e.length).fill(null)),n.mat3x2.orthogonal(0,t*r,0,t*r,x),n.mat3.fromMat3x2(x,this.projectionMatrix)},e.prototype.precomputeTileFaces=function(e){return n.range(6).map((function(t){var r=c.CubeOrientation(t,(4-e.state.sides[t].direction)%4),n=c.CubeOrientation.roll(r,0),i=c.CubeOrientation.roll(r,2),a=c.CubeOrientation.roll(n,0),o=c.CubeOrientation.roll(r,3),s=c.CubeOrientation.roll(r,1);return[a,n,s=c.CubeOrientation.rotate(s,3),o=c.CubeOrientation.rotate(o,1),i=c.CubeOrientation.rotate(i,2),r]}))},e.prototype.prepareBatch=function(e){this.tileFaces=this.precomputeTileFaces(e);var t=new s.Sprite2D;n.vec2.set(.5,.5,t.origin),t.transform=new f.Transform2D;for(var r=0,i=0;i<6;i++){for(var a=this.tileFaces[i],o=0;o<a.length;o++){var u=a[o]>>>2,c=((3&a[o])+e.state.sides[u].direction)%4,l=e.meshes[u].material.index;t.material=this.tiles[l],t.transform.rotation=.5*-c*Math.PI,n.vec2.set(o*t.material.size[0]+.5*t.material.size[0],.5*t.material.size[0],t.transform.position),t.transform.recalculate(0),t.recalculate(0),this.batch.render(t)}this.batchRanges[i]=[r,this.batch.indexOffset-r],r=this.batch.indexOffset}},e.prototype.renderFaceTiles=function(e){if(this.side!=e.state.side||this.hash!=e.hash){this.hash!=e.hash&&this.prepareBatch(e),this.hash=e.hash,this.side=e.state.side;var t=e.meshes[this.side].material.index,r=this.batchRanges[this.side];this.renderTexture(this.materials[t],r[1],r[0],this.program)}},e}();t.CubeTileMap=l},6830:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerSystem=void 0;var n=r(7594),i=r(1974),a=r(5164),o=r(4268),s=r(4672),f=r(5448),u=r(7304),c=r(7464),l=r(1373),d=function(){function e(e){var t=this;this.context=e,this.cameraTarget=n.vec3(0,0,0),this.cameraOffset=n.vec3(0,8,4),this.cameraPivot=n.vec3(0,0,0),this.cameraYaw=n.quat(),this.cameraPitch=n.quat(),this.cameraSmoothness=.1,this.cube=new o.Cube(this.context),this.tilemap=new s.CubeTileMap(this.context),this.effects=new c.EffectLibrary(this.context),this.skills=l.CubeSkills(this.context,this.cube),this.grid=new c.GridEffect(this.context,10),this.grid.transform.parent=this.cube.transform,this.context.get(f.DecalPass).effects.push(this.grid),this.shield=new c.ShieldEffect(this.context),this.context.get(u.ParticleEffectPass).effects.push(this.shield),window.orbit=function(e){return void 0===e&&(e=.1),setInterval((function(){t.cameraOffset[0]=4*Math.sin(e*performance.now()/1e3),t.cameraOffset[2]=4*Math.cos(e*performance.now()/1e3)}),10)}}return e.prototype.update=function(){1==this.context.frame&&this.cube.place(4,6),1==this.context.frame&&this.cube.installModule(this.cube.state.side,0,9),this.tilemap.renderFaceTiles(this.cube),this.cube.meshes[this.cube.state.side].armature.frame=0,window.a=this.cube.meshes[this.cube.state.side].armature,window.quat=n.quat,n.vec3.copy(this.cube.transform.position,this.cameraTarget),this.adjustCamera(this.cameraTarget)},e.prototype.adjustCamera=function(e){var t=this.context.get(i.CameraSystem).camera;n.vec3.add(this.cameraOffset,e,this.cameraPivot),n.vec3.lerp(t.transform.position,this.cameraPivot,this.cameraSmoothness,t.transform.position);var r=t.transform.position[0]-e[0],a=t.transform.position[1]-e[1],o=t.transform.position[2]-e[2],s=Math.sqrt(r*r+o*o);n.quat.axisAngle(n.vec3.AXIS_Y,Math.atan2(r,o),this.cameraYaw),n.quat.axisAngle(n.vec3.AXIS_X,Math.atan2(-a,s),this.cameraPitch),n.quat.multiply(this.cameraYaw,this.cameraPitch,t.transform.rotation),n.quat.normalize(t.transform.rotation,t.transform.rotation),t.transform.frame=0},e.prototype.load=function(e,t){for(var n=this.context.get(a.MaterialSystem),i=[{shader:r(9451),rate:0,uniforms:{uColor:[0,0,0,.5]}},{shader:r(9451),rate:0,uniforms:{uColor:[.91,.23,.52,1]}},{shader:r(9451),rate:0,uniforms:{uColor:[.69,.71,.73,0]}},{shader:r(1675),rate:2,uniforms:{}},{shader:r(7983),rate:0,uniforms:{uColor:[.8,.9,1]}},{shader:r(9451),rate:0,uniforms:{uColor:[.46,.61,.7,.5]}},{shader:r(1865),rate:2,uniforms:{}},{shader:r(1632),rate:0,uniforms:{}},{shader:r(9451),rate:0,uniforms:{uColor:[.46,.6,.62,.5]}}],o=n.createRenderTexture(a.MaterialSystem.textureSize,a.MaterialSystem.textureSize,i.length),s=0;s<i.length;s++)n.addRenderTexture(o,s,n.fullscreenShader(i[s].shader),i[s].uniforms,i[s].rate);var f=[],u=this.tilemap;for(var c in n.materials)n.materials[c].array=o.target,n.materials[c].arrayLayers=i.length,-1!=e.texture[c].indexOf("cube")&&f.push(n.materials[c]);var l=f.length;n.materialLoad.addListener((function e(t){-1!=f.indexOf(t)&&(--l>0||(n.materialLoad.removeListener(e),u.extractTileMap(f,64,8)))}))},e}();t.PlayerSystem=d},9040:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(1522),t),i(r(6876),t),i(r(4268),t),i(r(6830),t)},2830:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EffectLibrary=void 0,t.EffectLibrary=function(e){return{}}},8147:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryLibrary=void 0;var n=r(6240),i=r(4132);t.GeometryLibrary=function(e){var t=n.createSphere({longitude:32,latitude:32,radius:1});return{sphere:t,sphereMesh:e.get(i.MeshSystem).uploadVertexData(t.vertexArray,t.indexArray,t.format,!1)}}},4632:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleLibrary=void 0;var n=r(8716),i=r(7594),a=r(556),o=r(7304),s=r(8211),f=r(5164),u=r(9217),c=r(9258);t.ParticleLibrary=function(e){var t=e.get(f.MaterialSystem),l=new u.ParticleSystem(e,{limit:512,format:a.VertexDataFormat.Particle,depthTest:515,depthWrite:!1,cull:0,blend:0},u.ParticleGeometry.quad(e.gl),a.ShaderProgram(e.gl,s.shaders.billboard_vert,s.shaders.billboard_frag,{SPHERICAL:!0,SOFT:!1,MASK:!1,GRADIENT:!0,ALIGNED:!0,STRETCH:.04}),a.ShaderProgram(e.gl,s.shaders.particle_vert,null,{SPHERE:!0,TARGETED:!0,LUT:!0,RADIAL:!0}));l.diffuse=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,a.ShaderProgram(e.gl,s.shaders.fullscreen_vert,r(7787),{BLINK:!0}),{uColor:[1,1,1,1]},0).target,l.gradientRamp=u.GradientRamp(e.gl,[0,842543487,642596415,2377692672,0,287052623,491404095,1067030016,0,135399983,220602159,962353951,0,0,0,0],4),l.curveSampler=u.AttributeCurveSampler(e.gl,32,Object.values({size0:function(e){return 1-i.ease.quadIn(e)},size1:function(e){return 1-i.ease.quartIn(e)},linear0:function(e){return 1-.5*i.ease.cubicIn(e)},linear1:function(e){return 1-.5*i.ease.cubicIn(e)},rotational0:n.Zero,rotational1:n.Zero,radial0:function(e){return 4*i.ease.sineIn(e)},radial1:function(e){return 4*i.ease.sineIn(e)}}));var d=new u.ParticleSystem(e,{limit:1024,format:a.VertexDataFormat.Particle,depthTest:515,depthWrite:!1,cull:0,blend:0},u.ParticleGeometry.stripe(e.gl,8,(function(e){return 2*e})),a.ShaderProgram(e.gl,s.shaders.stripe_vert,s.shaders.billboard_frag,{STRIP:!0,SOFT:!1,MASK:!0,GRADIENT:!0}),a.ShaderProgram(e.gl,s.shaders.particle_vert,null,{SPHERE:!0,TARGETED:!0,STATIC:!0,TRAIL:!0}));d.diffuse=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,a.ShaderProgram(e.gl,s.shaders.fullscreen_vert,r(7787),{ROUNDED_BOX:!0}),{uColor:[1,1,1,1],uRadius:.4,uSize:.2},0).target,d.gradientRamp=u.GradientRamp(e.gl,[0,3355242671,2397300351,1132706367,557224960,152130560,0,2178207103,1335140671,660113920,321086208,101462784,0,713197312,541882368,270292736,101264128,0,0,0,0,0,0,0],4);var h=new u.ParticleSystem(e,{limit:1024,format:a.VertexDataFormat.Particle,depthTest:515,depthWrite:!1,cull:0,blend:0},u.ParticleGeometry.quad(e.gl),a.ShaderProgram(e.gl,s.shaders.billboard_vert,s.shaders.billboard_frag,{SPHERICAL:!0,SOFT:!1,MASK:!0,GRADIENT:!0,UV_OFFSET:.2}),a.ShaderProgram(e.gl,s.shaders.particle_vert,null,{CIRCLE:!0,TARGETED:!0,LUT:!0,ANGULAR:!0}));h.diffuse=c.SharedSystem.textures.cloudNoise,h.gradientRamp=u.GradientRamp(e.gl,[3216617215,1886019583,420942431,0,420942463,0,0,0],2),h.curveSampler=u.AttributeCurveSampler(e.gl,32,Object.values({size0:i.ease.cubicOut,size1:i.ease.cubicOut,linear0:function(e){return 1-.2*i.ease.linear(e)},linear1:function(e){return 1-.2*i.ease.linear(e)},rotational0:function(e){return 1-.2*i.ease.linear(e)},rotational1:function(e){return 1-.2*i.ease.linear(e)},radial0:n.Zero,radial1:n.Zero}));var m=new u.ParticleSystem(e,{limit:1024,format:a.VertexDataFormat.Particle,depthTest:515,depthWrite:!1,cull:0,blend:0},u.ParticleGeometry.quad(e.gl),a.ShaderProgram(e.gl,s.shaders.billboard_vert,r(2595),{SPHERICAL:!0,MASK:!0,GRADIENT:!0}),a.ShaderProgram(e.gl,s.shaders.particle_vert,null,{LUT:!0}));m.diffuse=c.SharedSystem.textures.sineNoise,m.gradientRamp=u.GradientRamp(e.gl,[168434351,235802751,437919551,0,0,0,0,0],2),m.curveSampler=u.AttributeCurveSampler(e.gl,32,Object.values({size0:i.ease.linear,size1:i.ease.quadOut,linear0:function(e){return.98},linear1:function(e){return.98},rotational0:n.Zero,rotational1:n.Zero,radial0:n.Zero,radial1:n.Zero}));var v=new u.ParticleSystem(e,{limit:1024,format:a.VertexDataFormat.Particle,depthTest:515,depthWrite:!1,cull:0,blend:0},u.ParticleGeometry.quad(e.gl),a.ShaderProgram(e.gl,s.shaders.billboard_vert,s.shaders.billboard_frag,{FRAMES:!0,SWIPE:.1}),a.ShaderProgram(e.gl,s.shaders.particle_vert,null,{CIRCLE:!0,FRAMES:!0}));return v.diffuse=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,a.ShaderProgram(e.gl,s.shaders.fullscreen_vert,r(5628),{}),{uTiles:4},0).target,e.get(o.ParticleEffectPass).effects.push(h,m,l,d,v),{dust:h,smoke:m,energy:l,sparks:d,bolts:v}}},6663:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureLibrary=void 0;var n=r(556),i=r(5164),a=r(8211);t.TextureLibrary=function(e){var t=e.get(i.MaterialSystem),o=t.addRenderTexture(t.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,a.shaders.fullscreen_vert,r(7787),{CIRCLE:!0}),{uColor:[1,1,1,1]},0).target,s=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,a.shaders.fullscreen_vert,r(7787),{RING:!0}),{uColor:[1,1,1,1]},0).target,f=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,a.shaders.fullscreen_vert,r(7787),{WAVE:!0}),{uColor:[1,1,1,1]},0).target,u=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,a.shaders.fullscreen_vert,r(5338),{}),{},0).target,c=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,a.shaders.fullscreen_vert,r(5338),{RING:!0}),{},0).target,l=t.addRenderTexture(t.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,a.shaders.fullscreen_vert,r(5338),{BEAM:!0}),{},0).target,d=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,a.shaders.fullscreen_vert,r(9057),{}),{},0).target,h=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,a.shaders.fullscreen_vert,a.shaders.noise_frag,{}),{},0).target,m=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,n.ShaderProgram(e.gl,a.shaders.fullscreen_vert,a.shaders.noise_frag,{SINE:!0}),{},0).target;return{particle:o,ring:s,wave:f,rays:u,raysRing:c,raysBeam:l,wind:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,n.ShaderProgram(e.gl,a.shaders.fullscreen_vert,r(454),{}),{uColor:[1,1,1,1]},0).target,directionalNoise:d,cloudNoise:h,sineNoise:m,grey:t.white.diffuse}}},9258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharedSystem=void 0;var n=r(6663),i=r(4632),a=r(8147),o=r(2830),s=function(){function e(t){this.context=t,e.textures=n.TextureLibrary(this.context),e.geometry=a.GeometryLibrary(this.context),e.particles=i.ParticleLibrary(this.context),e.effects=o.EffectLibrary(this.context)}return e.prototype.update=function(){},e}();t.SharedSystem=s},1640:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__generator||function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BeamSkill=void 0;var a=r(6240),o=r(7594),s=r(556),f=r(5060),u=r(8211),c=r(1513),l=r(7304),d=r(200),h=r(9217),m=r(7908),v=r(1160),p=r(9740),x=r(9258),y=r(9040),g={"light.radius":p.PropertyAnimation([{frame:1,value:0},{frame:1.4,value:8,ease:o.ease.quadOut}],o.lerp),"light.intensity":p.PropertyAnimation([{frame:1,value:0},{frame:1.4,value:4,ease:o.ease.quadOut},{frame:3,value:0,ease:o.ease.quadIn}],o.lerp),"center.transform.scale":p.PropertyAnimation([{frame:1.2,value:o.vec3.ZERO},{frame:1.8,value:[8,8,8],ease:o.ease.cubicOut}],o.vec3.lerp),"center.color":p.PropertyAnimation([{frame:2.4,value:o.vec4.ONE},{frame:3,value:o.vec4.ZERO,ease:o.ease.quadIn}],o.vec4.lerp),"cone.transform.scale":p.PropertyAnimation([{frame:0,value:[2,2,0]},{frame:1,value:o.vec3.ONE,ease:o.ease.quadOut},{frame:1.5,value:[0,0,2],ease:o.ease.cubicIn}],o.vec3.lerp),"cone.color":p.PropertyAnimation([{frame:0,value:[0,0,0,0]},{frame:1.2,value:[1,1,1,1],ease:o.ease.quadOut},{frame:1.4,value:[1,1,1,0],ease:o.ease.quadIn}],o.vec4.lerp),"cone.material.domain":p.PropertyAnimation([{frame:.4,value:o.vec3.ZERO},{frame:1.5,value:[255,0,0],ease:o.ease.quartIn}],o.vec3.lerp),"ring.transform.scale":p.PropertyAnimation([{frame:.8,value:[2,2,2]},{frame:1.1,value:[4,4,4],ease:o.ease.sineOut},{frame:1.4,value:[0,0,0],ease:o.ease.cubicIn}],o.vec3.lerp),"ring.color":p.PropertyAnimation([{frame:.8,value:[0,0,0,0]},{frame:1.1,value:[.1,.5,.6,.5],ease:o.ease.quadOut},{frame:1.4,value:[.5,1,1,0],ease:o.ease.sineIn}],o.vec4.lerp),"flash.transform.scale":p.PropertyAnimation([{frame:1.3,value:[0,0,0]},{frame:1.8,value:[5,5,5],ease:o.ease.cubicOut}],o.vec3.lerp),"flash.color":p.PropertyAnimation([{frame:1.3,value:[.7,1,1,0]},{frame:1.8,value:o.vec4.ZERO,ease:o.ease.quadIn}],o.vec4.lerp),"beam.width":p.PropertyAnimation([{frame:1.3,value:0},{frame:1.6,value:2,ease:o.ease.sineIn}],o.lerp),"beam.color":p.PropertyAnimation([{frame:2.4,value:o.vec4.ONE},{frame:3,value:o.vec4.ZERO,ease:o.ease.quadIn}],o.vec4.lerp)},b=function(){function e(e,t){this.context=e,this.cube=t,this.direction=o.vec3();var n=a.createCylinder({radiusTop:0,radiusBottom:6,height:3,horizontal:4,radial:16,cap:!1,angleStart:0,angleLength:2*Math.PI});a.applyTransform(n,o.mat4.fromRotationTranslationScale(o.quat.axisAngle(o.vec3.AXIS_X,.5*Math.PI,o.quat()),o.vec3(0,0,-1.5),o.vec3.ONE,o.mat4())),this.cone=new m.BatchMesh(n,!0),this.cone.material=new d.SpriteMaterial,this.cone.material.program=s.ShaderProgram(this.context.gl,u.shaders.batch_vert,r(5013)),this.cone.material.diffuse=x.SharedSystem.textures.directionalNoise;var i=h.GradientRamp(this.context.gl,[0,252782853,455098378,724850708,1096120094,1501337128,1822338595,2025373465,2816072202,4042979845],1);this.center=new m.Sprite,this.center.billboard=2,this.center.material=new d.SpriteMaterial,this.center.material.program=s.ShaderProgram(this.context.gl,u.shaders.batch_vert,r(843),{RADIAL:!0}),o.vec3.set(8,4,0,this.center.material.domain),this.center.material.diffuse=i,this.beam=new m.Line,this.beam.path=[o.vec3(),o.vec3()],this.beam.material=new d.SpriteMaterial,this.beam.material.program=s.ShaderProgram(this.context.gl,u.shaders.batch_vert,r(843)),o.vec3.set(4,8,0,this.beam.material.domain),this.beam.material.diffuse=i;var f=new d.SpriteMaterial;f.diffuse=x.SharedSystem.textures.ring,o.vec2.set(2,2,f.size);var c=new d.SpriteMaterial;c.diffuse=x.SharedSystem.textures.rays,o.vec2.set(2,2,c.size),this.ring=new m.Sprite,this.ring.billboard=2,this.ring.material=f,this.flash=new m.Sprite,this.flash.billboard=2,this.flash.material=c,this.smoke=x.SharedSystem.particles.smoke.add({uOrigin:o.vec3.ZERO,uLifespan:[1.6,2,-1,0],uRotation:[0,2*Math.PI],uGravity:[0,3.2,0],uSize:[1,3]})}return e.prototype.activate=function(e,t){var r,a,s,u,d,h,m,b,S;return i(this,(function(i){switch(i.label){case 0:r=o.vec3(.6,1.5,0),a=o.vec3(20,1.5,0),o.quat.transform(r,t,r),o.quat.transform(a,t,a),o.mat4.transform(r,e,r),o.mat4.transform(a,e,a),s=this.context.get(l.ParticleEffectPass),o.vec3.subtract(a,r,this.direction),this.cone.transform=this.context.get(c.TransformSystem).create(),o.vec3.copy(r,this.cone.transform.position),o.quat.rotationTo([0,0,-1],this.direction,this.cone.transform.rotation),this.center.transform=this.context.get(c.TransformSystem).create(),o.vec3.copy(r,this.center.transform.position),this.flash.transform=this.context.get(c.TransformSystem).create(),o.vec3.copy(r,this.flash.transform.position),this.ring.transform=this.context.get(c.TransformSystem).create(),o.vec3.copy(r,this.ring.transform.position),o.vec3.copy(r,this.beam.path[0]),this.light=this.context.get(f.PointLightPass).create(),this.light.transform=this.context.get(c.TransformSystem).create(),o.vec3.copy(r,this.light.transform.position),o.vec3.set(.5,1,1,this.light.color),s.add(this.cone,this.ring,this.flash,this.beam,this.center),this.energy=x.SharedSystem.particles.energy.add({uLifespan:[1,1.8,0,0],uOrigin:r,uRotation:o.vec2.ZERO,uGravity:o.vec3.ZERO,uSize:[.4,.8],uRadius:[8,12],uForce:o.vec2.ZERO,uTarget:r}),this.sparks=x.SharedSystem.particles.sparks.add({uLifespan:[.5,1,-.2,0],uOrigin:r,uLength:[.2,.4],uGravity:[0,-9.8,0],uSize:[.1,.4],uRadius:[.2,.5],uForce:[4,10],uTarget:r}),u=this.cube.meshes[this.cube.state.side],d=y.cubeModules[this.cube.state.sides[this.cube.state.side].type],h=p.AnimationTimeline(this,n(n({},g),{"beam.path.1":p.PropertyAnimation([{frame:1.3,value:r},{frame:1.6,value:a,ease:o.ease.cubicOut}],o.vec3.lerp),energy:p.EmitterTrigger({frame:0,value:128,origin:r,target:r}),sparks:p.EmitterTrigger({frame:1.2,value:32,origin:r,target:o.vec3.add(r,[0,-.4,0],o.vec3())}),smoke:p.EmitterTrigger({frame:2.5,value:8,origin:r})})),m=3,b=this.context.currentTime,i.label=1;case 1:return S=this.context.currentTime-b,h(S,this.context.deltaTime),v.modelAnimations[d.model].activate(S,u.armature),S>m?[3,4]:[4,0];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return x.SharedSystem.particles.energy.remove(this.energy),x.SharedSystem.particles.sparks.remove(this.sparks),s.remove(this.cone,this.ring,this.flash,this.beam,this.center),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.flash.transform),this.context.get(c.TransformSystem).delete(this.cone.transform),this.context.get(c.TransformSystem).delete(this.center.transform),this.context.get(c.TransformSystem).delete(this.light.transform),this.context.get(f.PointLightPass).delete(this.light),[2]}}))},e}();t.BeamSkill=b},4464:function(e,t){"use strict";var r=this&&this.__generator||function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShieldSkill=void 0;var n=function(){function e(e,t){this.context=e,this.cube=t}return e.prototype.activate=function(e,t){return r(this,(function(e){return[2]}))},e}();t.ShieldSkill=n},874:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__generator||function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShockwaveSkill=void 0;var a=r(7594),o=r(5448),s=r(1513),f=r(200),u=r(1160),c=r(9740),l=r(9040),d=r(9258),h=r(5164),m=r(556),v=r(8211),p=r(5060),x=r(7908),y=r(2982),g=r(7304),b=r(6240),S={"ring.transform.scale":c.PropertyAnimation([{frame:0,value:[16,2,16]},{frame:.6,value:[0,2,0],ease:a.ease.quadIn}],a.vec3.lerp),"ring.color":c.PropertyAnimation([{frame:0,value:a.vec4.ZERO},{frame:.6,value:[.8,.3,.6,.4],ease:a.ease.quadOut}],a.vec4.lerp),"crack.transform.scale":c.PropertyAnimation([{frame:0,value:[16,2,16]}],a.vec3.lerp),"crack.threshold":c.PropertyAnimation([{frame:.7,value:2.5},{frame:1.2,value:0,ease:a.ease.cubicOut},{frame:2,value:-2.5,ease:a.ease.sineOut}],a.lerp),"crack.color":c.PropertyAnimation([{frame:1,value:a.vec4.ONE},{frame:1.6,value:[0,0,0,1],ease:a.ease.sineOut}],a.vec4.lerp),"bolts.rate":c.PropertyAnimation([{frame:0,value:0},{frame:.8,value:.004,ease:a.ease.stepped},{frame:1.8,value:0,ease:a.ease.stepped}],a.lerp),"bolts.uniform.uniforms.uRadius":c.PropertyAnimation([{frame:.8,value:a.vec2.ONE},{frame:1.8,value:[6,7],ease:a.ease.sineOut}],a.vec2.lerp),"wave.transform.scale":c.PropertyAnimation([{frame:.7,value:[0,0,0]},{frame:1.2,value:[20,20,20],ease:a.ease.cubicOut}],a.vec3.lerp),"wave.color":c.PropertyAnimation([{frame:.8,value:a.vec4.ONE},{frame:1.2,value:a.vec4.ZERO,ease:a.ease.cubicIn}],a.vec4.lerp),"light.radius":c.PropertyAnimation([{frame:.7,value:0},{frame:1.2,value:12,ease:a.ease.cubicOut},{frame:2,value:0,ease:a.ease.cubicIn}],a.lerp),"light.intensity":c.PropertyAnimation([{frame:.6,value:0},{frame:.8,value:4,ease:a.ease.cubicIn},{frame:1.4,value:.5,ease:a.ease.cubicOut},{frame:2,value:0,ease:a.ease.sineIn}],a.lerp),"light.color":c.PropertyAnimation([{frame:.8,value:[.5,.8,1]},{frame:1.4,value:[1,.2,.6],ease:a.ease.cubicOut}],a.vec3.lerp),"flash.transform.scale":c.PropertyAnimation([{frame:.6,value:a.vec3.ZERO},{frame:1,value:[6,6,6],ease:a.ease.quartOut}],a.vec3.lerp),"flash.color":c.PropertyAnimation([{frame:.6,value:[.6,.8,1,0]},{frame:1,value:[0,0,0,0],ease:a.ease.quadIn}],a.vec4.lerp),"beam.transform.scale":c.PropertyAnimation([{frame:.6,value:[0,2,1]},{frame:1.2,value:[1.4,4.8,1],ease:a.ease.cubicOut}],a.vec3.lerp),"beam.color":c.PropertyAnimation([{frame:.6,value:[1,.6,.8,0]},{frame:1.2,value:a.vec4.ZERO,ease:a.ease.quadIn}],a.vec4.lerp),"cylinder.transform.scale":c.PropertyAnimation([{frame:0,value:[8,2,8]},{frame:.5,value:[3,8,3],ease:a.ease.sineOut},{frame:.8,value:[6,1,6],ease:a.ease.cubicIn}],a.vec3.lerp),"cylinder.transform.rotation":c.PropertyAnimation([{frame:0,value:a.quat.IDENTITY},{frame:.5,value:a.quat.axisAngle(a.vec3.AXIS_Y,-1*Math.PI,a.quat()),ease:a.ease.quadIn},{frame:.8,value:a.quat.axisAngle(a.vec3.AXIS_Y,-1.5*Math.PI,a.quat()),ease:a.ease.quadOut}],a.quat.slerp),"cylinder.color":c.PropertyAnimation([{frame:0,value:a.vec4.ZERO},{frame:.5,value:[1,1,1,1],ease:a.ease.quadOut},{frame:.8,value:a.vec4.ZERO,ease:a.ease.quartIn}],a.vec4.lerp)},P=function(){function e(e,t){this.context=e,this.cube=t;var n=e.get(h.MaterialSystem);this.shatterMaterial=new f.SpriteMaterial,this.shatterMaterial.diffuse=n.addRenderTexture(n.createRenderTexture(512,512,1,{wrap:33071,mipmaps:0,format:32856}),0,m.ShaderProgram(e.gl,v.shaders.fullscreen_vert,r(5961),{}),{},0).target,this.shatterMaterial.normal=n.addRenderTexture(n.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,m.ShaderProgram(e.gl,v.shaders.fullscreen_vert,r(5961),{MASK:!0}),{},0).target,this.wave=new x.Sprite,this.wave.billboard=0,this.wave.material=new f.SpriteMaterial,this.wave.material.diffuse=d.SharedSystem.textures.wave,this.flash=new x.Sprite,this.flash.billboard=0,this.flash.material=new f.SpriteMaterial,this.flash.material.diffuse=d.SharedSystem.textures.wave,this.beam=new x.Sprite,this.beam.billboard=3,this.beam.material=new f.SpriteMaterial,this.beam.material.diffuse=d.SharedSystem.textures.raysBeam,a.vec2.set(0,.5,this.beam.origin),this.bolts=d.SharedSystem.particles.bolts.add({uOrigin:[0,0,0],uRadius:[0,0],uLifespan:[.1,.8,0,0],uGravity:[0,0,0],uRotation:[0,2*Math.PI],uSize:[.1,1.2],uFrame:[8,4]});var i=b.createCylinder({radiusTop:.5,radiusBottom:.5,height:1,radial:32,horizontal:1,cap:!1,angleStart:0,angleLength:2*Math.PI});this.cylinder=new x.BatchMesh(i,!0),this.cylinder.material=new f.SpriteMaterial,this.cylinder.material.diffuse=d.SharedSystem.textures.wind}return e.prototype.activate=function(e,t){var r,h,m,v,x,b,P;return i(this,(function(t){switch(t.label){case 0:r=a.mat4.transform([0,0,0],e,a.vec3()),this.ring=this.context.get(o.DecalPass).create(0),this.ring.transform=this.context.get(s.TransformSystem).create(),a.vec3.copy(r,this.ring.transform.position),this.ring.material=new f.SpriteMaterial,this.ring.material.diffuse=d.SharedSystem.textures.raysRing,this.crack=this.context.get(o.DecalPass).create(1),this.crack.transform=this.context.get(s.TransformSystem).create(),a.vec3.copy(r,this.crack.transform.position),this.crack.material=this.shatterMaterial,this.wave.transform=this.context.get(s.TransformSystem).create(),a.quat.axisAngle(a.vec3.AXIS_X,-.5*Math.PI,this.wave.transform.rotation),a.vec3.add(r,[0,1.5,0],this.wave.transform.position),this.context.get(y.PostEffectPass).distortion.add(this.wave),this.flash.transform=this.context.get(s.TransformSystem).create(),a.quat.axisAngle(a.vec3.AXIS_X,-.5*Math.PI,this.flash.transform.rotation),a.vec3.add(r,[0,1.6,0],this.flash.transform.position),this.context.get(g.ParticleEffectPass).add(this.flash),this.beam.transform=this.context.get(s.TransformSystem).create(),a.vec3.add(r,[0,3,0],this.beam.transform.position),this.context.get(g.ParticleEffectPass).add(this.beam),this.cylinder.transform=this.context.get(s.TransformSystem).create(),a.vec3.add(r,[0,1,0],this.cylinder.transform.position),this.context.get(g.ParticleEffectPass).add(this.cylinder),this.light=this.context.get(p.PointLightPass).create(),this.light.transform=this.context.get(s.TransformSystem).create(),a.vec3.add(r,[0,4,0],this.light.transform.position),a.vec3.add(r,[0,2,0],this.bolts.uniform.uniforms.uOrigin),h=this.cube.meshes[this.cube.state.side],m=l.cubeModules[this.cube.state.sides[this.cube.state.side].type],v=c.AnimationTimeline(this,n({},S)),x=2,b=this.context.currentTime,t.label=1;case 1:return P=this.context.currentTime-b,v(P,this.context.deltaTime),u.modelAnimations[m.model].activate(P,h.armature),P>x?[3,4]:[4,0];case 2:t.sent(),t.label=3;case 3:return[3,1];case 4:return this.context.get(s.TransformSystem).delete(this.light.transform),this.context.get(s.TransformSystem).delete(this.crack.transform),this.context.get(s.TransformSystem).delete(this.ring.transform),this.context.get(s.TransformSystem).delete(this.wave.transform),this.context.get(s.TransformSystem).delete(this.flash.transform),this.context.get(s.TransformSystem).delete(this.beam.transform),this.context.get(s.TransformSystem).delete(this.cylinder.transform),this.context.get(p.PointLightPass).delete(this.light),this.context.get(o.DecalPass).delete(this.ring),this.context.get(o.DecalPass).delete(this.crack),this.context.get(y.PostEffectPass).distortion.remove(this.wave),this.context.get(g.ParticleEffectPass).remove(this.flash),this.context.get(g.ParticleEffectPass).remove(this.beam),this.context.get(g.ParticleEffectPass).remove(this.cylinder),[2]}}))},e}();t.ShockwaveSkill=P},1373:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CubeSkills=void 0;var n=r(1640),i=r(874),a=r(4464);t.CubeSkills=function(e,t){var r;return(r={})[3]=new n.BeamSkill(e,t),r[5]=new i.ShockwaveSkill(e,t),r[9]=new a.ShieldSkill(e,t),r}},2435:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LevelGenerator=void 0;var n=r(7594),i=r(7573),a=r(8914),o=r(1162),s=function(){function e(e){this.context=e}return e.prototype.populate=function(t,r,i){var s=this,f=a.TerrainChunk.chunkTiles*r/e.zoneSize|0,u=a.TerrainChunk.chunkTiles*i/e.zoneSize|0,c=f*e.zoneSize-a.TerrainChunk.chunkTiles*r,l=u*e.zoneSize-a.TerrainChunk.chunkTiles*i,d=n.noise2D(f,u,214),h=1,m=function(){return h=n.noise1D(h,d)};t.terraform(n.aabb2.pad(a.TerrainChunk.bounds,1,n.aabb2()),(function(e,t){return 8*s.sampleDunes(.2*e,.2*t,173)}));var v=c+n.randomInt(1,e.zoneSize-2,m),p=l+n.randomInt(1,e.zoneSize-2,m);0==f&&0==u&&(v=c+4,p=l+2),v<0||p<0||v>=a.TerrainChunk.chunkTiles||p>=a.TerrainChunk.chunkTiles||new o.Workshop(this.context).place(v-c,p-l)},e.prototype.sampleDunes=function(e,t,r){return(1*Math.pow(1-2*Math.abs(i.perlin2D(.5*e,.5*t,r)-.5),2)+2*Math.pow(1-2*Math.abs(i.perlin2D(.25*e,.25*t,r)-.5),2)+4*n.smoothstep(0,1,i.perlin2D(.2*e,.2*t,r)))/7},e.zoneSize=64,e}();t.LevelGenerator=s},6433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainSystem=void 0;var n=r(7594),i=r(5164),a=r(9040),o=r(2435),s=r(8914),f=function(){function e(e){this.context=e,this.positionOffset=-.5*s.TerrainChunk.chunkSize+.5*s.TerrainChunk.tileSize,this.gridSize=3,this.gridBounds=n.aabb2(),this.chunks=Array(this.gridSize*this.gridSize),this.levelGenerator=new o.LevelGenerator(this.context);var t=this.context.get(i.MaterialSystem);this.dunesMaterial=t.create(),this.dunesMaterial.diffuse=t.addRenderTexture(t.createRenderTexture(i.MaterialSystem.textureSize,i.MaterialSystem.textureSize),0,t.fullscreenShader(r(5590)),{uScreenSize:[i.MaterialSystem.textureSize,i.MaterialSystem.textureSize]},0).target,this.dunesMaterial.normal=t.addRenderTexture(t.createRenderTexture(i.MaterialSystem.textureSize,i.MaterialSystem.textureSize),0,t.fullscreenShader(r(8220)),{uScreenSize:[i.MaterialSystem.textureSize,i.MaterialSystem.textureSize]},0).target}return e.prototype.update=function(){var t=this.context.get(a.PlayerSystem).cameraTarget,r=Math.floor(t[0]/s.TerrainChunk.chunkSize-.5*this.gridSize+1),i=Math.floor(t[2]/s.TerrainChunk.chunkSize-.5*this.gridSize+1);if(this.gridBounds[0]!=r||this.gridBounds[1]!=i){for(var o=this.chunks.length-1;o>=0;o--)if(l=this.chunks[o]){var f=l.column-r+(l.row-i)*this.gridSize;f!==o&&(l.column<r||l.row<i||l.column>=r+this.gridSize||l.row>=i+this.gridSize?(l.clear(),e.pool.push(l),this.chunks[o]=null):(this.chunks[o]=this.chunks[f],this.chunks[f]=l,o++))}n.aabb2.set(r,i,r+this.gridSize-1,i+this.gridSize-1,this.gridBounds);for(var u=this.gridSize-1;u>=0;u--)for(var c=this.gridSize-1;c>=0;c--)if(!this.chunks[u+c*this.gridSize]){var l,d=u+r,h=c+i;(l=e.pool.pop()||new s.TerrainChunk(this.context)).column=d,l.row=h,l.offsetX=-d*s.TerrainChunk.chunkTiles,l.offsetZ=-h*s.TerrainChunk.chunkTiles,this.chunks[u+c*this.gridSize]=l,this.levelGenerator.populate(l,d,h),l.build(),l.mesh.material=this.dunesMaterial}}},e.prototype.chunk=function(e,t){var r=Math.floor(e/s.TerrainChunk.chunkTiles)-this.gridBounds[0],n=Math.floor(t/s.TerrainChunk.chunkTiles)-this.gridBounds[1];return r<0||n<0||r>=this.gridSize||n>=this.gridSize?null:this.chunks[r+n*this.gridSize]},e.prototype.getTile=function(e,t){var r;return null===(r=this.chunk(e,t))||void 0===r?void 0:r.get(e,t)},e.prototype.setTile=function(e,t,r){var n;null===(n=this.chunk(e,t))||void 0===n||n.set(e,t,r)},e.prototype.tilePosition=function(e,t,r){var n;return r[0]=s.TerrainChunk.tileSize*e+this.positionOffset,r[2]=s.TerrainChunk.tileSize*t+this.positionOffset,r[1]=(null===(n=this.chunk(e,t))||void 0===n?void 0:n.sample(r[0],r[2]))||0,r},e.pool=[],e}();t.TerrainSystem=f},8914:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainChunk=void 0;var n=r(7594),i=r(6240),a=r(4132),o=r(1513),s=function(){function e(t){this.context=t,this.grid=Array(e.chunkTiles*e.chunkTiles).fill(null);var r=e.chunkLOD,n=e.chunkLOD,o=i.createPlane({columns:r,rows:n,width:e.chunkSize,height:e.chunkSize}),s=o.vertexArray,f=o.indexArray,u=o.format;this.heightmap=new Float32Array((r+3)*(n+3)),this.vertexArray=s,this.vertexBuffer=this.context.get(a.MeshSystem).uploadVertexData(s,f,u),this.stride=this.vertexBuffer.format[1].stride>>>2}return e.prototype.sample=function(t,r){var n=e.chunkLOD+1,i=n+2,a=0|(t/e.chunkSize-this.column+.5)*n,o=0|(r/e.chunkSize-this.row+.5)*n;return this.heightmap[(a+1)*i+(o+1)]},e.prototype.mapRegion=function(t,r){var i=e.chunkLOD+1;return r[0]=Math.floor((t[0]/e.chunkSize-this.column+.5)*i),r[1]=Math.floor((t[1]/e.chunkSize-this.row+.5)*i),r[2]=Math.floor((t[2]/e.chunkSize-this.column+.5)*i),r[3]=Math.floor((t[3]/e.chunkSize-this.row+.5)*i),n.aabb2.intersect(e.bounds,r,r)},e.prototype.terraform=function(t,r){for(var n=e.chunkLOD+1+2,i=e.chunkSize/e.chunkLOD,a=-.5*e.chunkSize+this.column*e.chunkSize,o=-.5*e.chunkSize+this.row*e.chunkSize,s=t[0];s<=t[2];s++)for(var f=t[1];f<=t[3];f++){var u=(s+1)*n+(f+1),c=a+s*i,l=o+f*i;this.heightmap[u]=r(c,l)}},e.prototype.get=function(t,r){var n=t+this.offsetX+(r+this.offsetZ)*e.chunkTiles;return this.grid[n]},e.prototype.set=function(t,r,n){var i=t+this.offsetX+(r+this.offsetZ)*e.chunkTiles;this.grid[i]=n},e.prototype.build=function(){for(var t=e.chunkLOD+1,r=t+2,i=0;i<t;i++)for(var s=0;s<t;s++){var f=(i*t+s)*this.stride;this.vertexArray[f+1]=this.heightmap[(i+1)*r+(s+1)];var u=this.heightmap[(i+2)*r+(s+1)],c=this.heightmap[(i+0)*r+(s+1)],l=this.heightmap[(i+1)*r+(s+2)],d=this.heightmap[(i+1)*r+(s+0)],h=this.vertexArray.subarray(f+3,f+6);n.vec3.set(2*(u-c),4,2*(d-l),h),n.vec3.normalize(h,h)}this.mesh=this.context.get(a.MeshSystem).create(),this.context.get(a.MeshSystem).updateVertexData(this.vertexBuffer,this.vertexArray),this.mesh.buffer=this.vertexBuffer,this.mesh.buffer.frame=0,this.mesh.transform=this.context.get(o.TransformSystem).create(),n.vec3.set(this.column*e.chunkSize,0,this.row*e.chunkSize,this.mesh.transform.position)},e.prototype.clear=function(){for(var e=this.grid.length-1;e>=0;e--)this.grid[e]&&this.grid[e].kill();this.grid.fill(null),this.context.get(o.TransformSystem).delete(this.mesh.transform),this.context.get(a.MeshSystem).delete(this.mesh),this.mesh=null},e.chunkLOD=16,e.chunkSize=20,e.tileSize=2,e.chunkTiles=e.chunkSize/e.tileSize,e.bounds=n.aabb2(0,0,e.chunkLOD,e.chunkLOD),e}();t.TerrainChunk=s},2392:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7573),t),i(r(8914),t),i(r(2435),t),i(r(6433),t)},7573:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.perlin2D=void 0;var n=r(3850),i=r(7144),a=function(e){return e*e*e*(e*(6*e-15)+10)};function o(e,t,r,n,a){var o=2*Math.PI*i.noise2D(e,t,a);return r*Math.cos(o)+n*Math.sin(o)}t.perlin2D=function(e,t,r){var i=Math.floor(e),s=Math.floor(t),f=o(i,s,e-=i,t-=s,r),u=o(i+1,s,e-1,t,r),c=o(i,s+1,e,t-1,r),l=o(i+1,s+1,e-1,t-1,r),d=a(e),h=a(t);return n.lerp(n.lerp(f,u,d),n.lerp(c,l,d),h)}}},t={};!function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}(439)})();