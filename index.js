(()=>{var e={387:e=>{"use strict";e.exports=JSON.parse('{"format":[[{"name":"index","size":1,"type":5123},{"name":"position","size":3,"type":5126,"normalized":false,"stride":24,"offset":0},{"name":"normal","size":3,"type":5122,"normalized":true,"stride":24,"offset":12},{"name":"uv","size":2,"type":5123,"normalized":true,"stride":24,"offset":20}],[{"name":"index","size":1,"type":5123},{"name":"position","size":3,"type":5126,"normalized":false,"stride":32,"offset":0},{"name":"normal","size":3,"type":5122,"normalized":true,"stride":32,"offset":12},{"name":"uv","size":2,"type":5123,"normalized":true,"stride":32,"offset":20},{"name":"joint","size":4,"type":5121,"normalized":false,"stride":32,"offset":24},{"name":"weight","size":4,"type":5121,"normalized":true,"stride":32,"offset":28}],[{"name":"index","size":1,"type":5123},{"name":"position","size":3,"type":5126,"normalized":false,"stride":32,"offset":0},{"name":"normal","size":3,"type":5122,"normalized":true,"stride":32,"offset":12},{"name":"uv","size":2,"type":5123,"normalized":true,"stride":32,"offset":20},{"name":"color","size":4,"type":5123,"normalized":true,"stride":32,"offset":24}]],"buffer":["assets/models.bin","assets/audio.bin"],"texture":["assets/dock.png","assets/cube_0.png","assets/cube_1.png","assets/cube_2.png","assets/cube_3.png","assets/cube_x.png","assets/cube_4.png","assets/cube_5.png","assets/cube_6.png","assets/cube_7.png","assets/cube_8.png","assets/scarab.png","assets/tarantula.png","assets/obelisk.png","assets/monolith.png","assets/stingray.png","assets/locust.png","assets/decapod.png","assets/isopod.png"],"model":[{"name":"the_cube","texture":-1,"format":0,"indices":{"byteOffset":2,"byteLength":72},"vertices":{"byteOffset":76,"byteLength":576}},{"name":"dock","texture":0,"format":1,"indices":{"byteOffset":654,"byteLength":24696},"vertices":{"byteOffset":25352,"byteLength":192800},"inverseBindPose":{"byteOffset":218156,"byteLength":384},"armature":[{"name":"base","parent":-1},{"name":"frame","position":[0,1,0],"parent":0},{"name":"rod","rotation":[0,0,0,1],"position":[0,1,0],"parent":0},{"name":"lamp","position":[0,1,0],"parent":0},{"name":"handle","position":[0,2,0],"parent":0},{"name":"pump","position":[0,1,0],"parent":0}]},{"name":"cube_0","texture":1,"format":1,"indices":{"byteOffset":218542,"byteLength":6024},"vertices":{"byteOffset":224568,"byteLength":58240},"inverseBindPose":{"byteOffset":282812,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"gun","position":[0,1,0],"parent":0},{"name":"magazine","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-0.1,0.7,0],"parent":1},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.4,0.7,0],"parent":1},{"name":"cover_11","rotation":[1,0,0,0],"position":[0.6,2,-0.6],"parent":0},{"name":"cover_10","rotation":[1,0,0,0],"position":[0.6,2,0.6],"parent":0},{"name":"cover_00","rotation":[1,0,0,0],"position":[-0.6,2,0.6],"parent":0},{"name":"cover_01","rotation":[1,0,0,0],"position":[-0.6,2,-0.6],"parent":0}]},{"name":"cube_1","texture":2,"format":1,"indices":{"byteOffset":283326,"byteLength":7452},"vertices":{"byteOffset":290780,"byteLength":65952},"inverseBindPose":{"byteOffset":356736,"byteLength":576},"armature":[{"name":"base","parent":-1},{"name":"cover_left","position":[0,0.8,-1.3],"parent":0},{"name":"lamp_left","position":[-0.5,1.2,-0.2],"parent":1},{"name":"cover_right","position":[0,0.8,1.3],"parent":0},{"name":"lamp_right","position":[-0.5,1.2,0.2],"parent":3},{"name":"gun","position":[-0.4,0.7,0],"parent":0},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.7,0.7,0],"parent":5},{"name":"bridge","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.3,0.8,0],"parent":5},{"name":"slide","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,1,0],"parent":5}]},{"name":"cube_2","texture":3,"format":1,"indices":{"byteOffset":357314,"byteLength":14940},"vertices":{"byteOffset":372256,"byteLength":149728},"inverseBindPose":{"byteOffset":521988,"byteLength":448},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,1,-1],"parent":0},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,1,1],"parent":0},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[1,1,0],"parent":0},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-1,1,0],"parent":0},{"name":"top","position":[0,2,0],"parent":0},{"name":"lamp","position":[0,2,0],"parent":0}]},{"name":"cube_3","texture":4,"format":1,"indices":{"byteOffset":522438,"byteLength":11748},"vertices":{"byteOffset":534188,"byteLength":95904},"inverseBindPose":{"byteOffset":630096,"byteLength":384},"armature":[{"name":"base","parent":-1},{"name":"top","position":[0,1,0],"parent":0},{"name":"cap","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[0.7,4.4,0],"parent":1},{"name":"lamp_bottom","position":[0,1,0],"parent":1},{"name":"lamp_top","position":[0,2,0],"parent":1},{"name":"rod","position":[0,3,0],"parent":1}]},{"name":"death","texture":5,"format":1,"indices":{"byteOffset":630482,"byteLength":6048},"vertices":{"byteOffset":636532,"byteLength":66848},"inverseBindPose":{"byteOffset":703384,"byteLength":576},"armature":[{"name":"base","parent":-1},{"name":"part_100","position":[1.6,-0.6,1.6],"parent":0},{"name":"part_110","position":[1.6,-0.6,-1.6],"parent":0},{"name":"part_101","position":[1.6,2.6,1.6],"parent":0},{"name":"part_111","rotation":[0,0,0,1],"position":[1.6,2.6,-1.6],"parent":0},{"name":"part_000","position":[-1.6,-0.6,1.6],"parent":0},{"name":"part_010","position":[-1.6,-0.6,-1.6],"parent":0},{"name":"part_001","position":[-1.6,2.6,1.6],"parent":0},{"name":"part_011","rotation":[0,0,0,1],"position":[-1.6,2.6,-1.6],"parent":0}]},{"name":"cube_debris","texture":-1,"format":2,"indices":{"byteOffset":703962,"byteLength":2856},"vertices":{"byteOffset":706820,"byteLength":44128}},{"name":"cube_open","texture":5,"format":1,"indices":{"byteOffset":750950,"byteLength":16344},"vertices":{"byteOffset":767296,"byteLength":135648},"inverseBindPose":{"byteOffset":902948,"byteLength":320},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,2,-1],"parent":0},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"scale":[1,1,1],"position":[0,2,1],"parent":0},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"position":[1,2,0],"parent":0},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"position":[-1,2,0],"parent":0}]},{"name":"cube_4","texture":6,"format":1,"indices":{"byteOffset":903270,"byteLength":12714},"vertices":{"byteOffset":915988,"byteLength":100128},"inverseBindPose":{"byteOffset":1016120,"byteLength":448},"armature":[{"name":"base","parent":-1},{"name":"gun","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,1,0],"parent":0},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.6,1,0],"parent":0},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,1,-1],"parent":0},{"name":"lamp_left","rotation":[0.707107,0,0,0.707107],"position":[0.5,0.5,1],"parent":3},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,1,1],"parent":0},{"name":"lamp_right","rotation":[0,0.707107,0.707107,0],"position":[-0.5,0.5,1],"parent":5}]},{"name":"mine","texture":7,"format":0,"indices":{"byteOffset":1016570,"byteLength":1128},"vertices":{"byteOffset":1017700,"byteLength":6528}},{"name":"cube_5","texture":7,"format":1,"indices":{"byteOffset":1024230,"byteLength":14184},"vertices":{"byteOffset":1038416,"byteLength":136384},"inverseBindPose":{"byteOffset":1174804,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"side_01","position":[-1,0.5,-1],"parent":0},{"name":"side_00","position":[-1,0.5,1],"parent":0},{"name":"side_11","position":[1,0.5,-1],"parent":0},{"name":"side_10","position":[1,0.5,1],"parent":0},{"name":"cage","position":[0,1,0],"parent":0},{"name":"rod","position":[0,2,0],"parent":5},{"name":"top","position":[0,-1,0],"parent":0}]},{"name":"cube_6","texture":8,"format":1,"indices":{"byteOffset":1175318,"byteLength":24012},"vertices":{"byteOffset":1199332,"byteLength":217248},"inverseBindPose":{"byteOffset":1416584,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0,-1],"parent":0},{"name":"side_right","rotation":[0.707107,0,0,0.707107],"scale":[1,1,1],"position":[0,0,1],"parent":0},{"name":"top","position":[0,2,0],"parent":0},{"name":"cap","position":[0,1,0],"parent":3},{"name":"rod","position":[0,1,0],"parent":4},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[1,0,0],"parent":0},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-1,0,0],"parent":0}]},{"name":"cube_7","texture":9,"format":1,"indices":{"byteOffset":1417098,"byteLength":32328},"vertices":{"byteOffset":1449428,"byteLength":288480},"inverseBindPose":{"byteOffset":1737912,"byteLength":512},"armature":[{"name":"base","parent":-1},{"name":"top","position":[0,2.8,0],"parent":0},{"name":"cage","position":[0,-1.2,0],"parent":1},{"name":"cap","position":[0,2.2,0],"parent":1},{"name":"side_11","rotation":[1,0,0,0],"position":[0.7,2.2,-0.7],"parent":0},{"name":"side_10","rotation":[1,0,0,0],"position":[0.7,2.2,0.7],"parent":0},{"name":"side_01","rotation":[1,0,0,0],"position":[-0.7,2.2,-0.7],"parent":0},{"name":"side_00","rotation":[1,0,0,0],"position":[-0.7,2.2,0.7],"parent":0}]},{"name":"cube_8","texture":10,"format":1,"indices":{"byteOffset":1738426,"byteLength":17976},"vertices":{"byteOffset":1756404,"byteLength":150048},"inverseBindPose":{"byteOffset":1906456,"byteLength":448},"armature":[{"name":"base","parent":-1},{"name":"top","position":[0,2.8,0],"parent":0},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0,-1.2],"parent":1},{"name":"gun_left","rotation":[0.707107,0,0,0.707107],"position":[0,1.1,1],"parent":2},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,0,1.2],"parent":1},{"name":"gun_right","rotation":[0,0.707107,0.707107,0],"position":[0,1.1,1],"parent":4},{"name":"cap","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,0,0],"parent":1}]},{"name":"missile","texture":10,"format":0,"indices":{"byteOffset":1906906,"byteLength":408},"vertices":{"byteOffset":1907316,"byteLength":2544}},{"name":"scarab","texture":11,"format":1,"indices":{"byteOffset":1909862,"byteLength":4284},"vertices":{"byteOffset":1914148,"byteLength":38304},"inverseBindPose":{"byteOffset":1952456,"byteLength":256},"armature":[{"name":"base","parent":-1},{"name":"jaw","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0,0.5,0],"parent":0},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0.5,-0.2],"parent":0},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,0.5,0.2],"parent":0}]},{"name":"tarantula","texture":12,"format":1,"indices":{"byteOffset":1952714,"byteLength":26928},"vertices":{"byteOffset":1979644,"byteLength":242304},"inverseBindPose":{"byteOffset":2221952,"byteLength":832},"armature":[{"name":"base","parent":-1},{"name":"leg_01","rotation":[-0.325914,0.20498,0.20498,0.899859],"position":[-0.3,0.2,-0.3],"parent":0},{"name":"foot_01","rotation":[-0.746041,0.239051,-0.022346,0.62111],"scale":[1,1,1],"position":[0,0.994987,0],"parent":1},{"name":"leg_11","rotation":[-0.325914,-0.20498,-0.20498,0.899859],"position":[0.3,0.2,-0.3],"parent":0},{"name":"foot_11","rotation":[-0.746041,-0.239051,0.022346,0.62111],"scale":[1,1,1],"position":[0,0.994987,0],"parent":3},{"name":"leg_00","rotation":[0.146064,0.356233,0.356233,0.851388],"position":[-0.3,0.2,0.3],"parent":0},{"name":"foot_00","rotation":[0.743794,-0.663601,0.062032,0.050561],"scale":[1,1,1],"position":[0,0.994988,0],"parent":5},{"name":"leg_10","rotation":[0.146064,-0.356233,-0.356233,0.851388],"position":[0.3,0.2,0.3],"parent":0},{"name":"foot_10","rotation":[0.743794,0.663601,-0.062032,0.050561],"scale":[1,1,1],"position":[0,0.994988,0],"parent":7},{"name":"gun","position":[0,1.1,0],"parent":0},{"name":"barrel","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[0.2,0.7,0],"parent":9},{"name":"cage","position":[0,1.1,0],"parent":0},{"name":"rod","position":[0,1.2,0],"parent":11}]},{"name":"obelisk","texture":13,"format":1,"indices":{"byteOffset":2222786,"byteLength":16872},"vertices":{"byteOffset":2239660,"byteLength":151392},"inverseBindPose":{"byteOffset":2391056,"byteLength":320},"armature":[{"name":"base","parent":-1},{"name":"side_left","rotation":[-0.707107,0,0,0.707107],"position":[0,0.4,-1],"parent":-1},{"name":"side_right","rotation":[0,0.707107,0.707107,0],"position":[0,0.4,1],"parent":-1},{"name":"side_front","rotation":[-0.5,-0.5,-0.5,0.5],"position":[1,0.4,0],"parent":-1},{"name":"side_back","rotation":[-0.5,0.5,0.5,0.5],"position":[-1,0.4,0],"parent":-1}]},{"name":"monolith","texture":14,"format":1,"indices":{"byteOffset":2391378,"byteLength":52338},"vertices":{"byteOffset":2443720,"byteLength":444928},"inverseBindPose":{"byteOffset":2888652,"byteLength":1152},"armature":[{"name":"base","parent":-1},{"name":"cover_left","rotation":[-0.707107,0,0,0.707107],"position":[0,2.7,-1],"parent":0},{"name":"cover_right","rotation":[0,0.707107,0.707107,0],"position":[0,2.7,1],"parent":0},{"name":"cover_back","rotation":[-0.5,0.5,0.5,0.5],"position":[-1,2.7,0],"parent":0},{"name":"cover_front","rotation":[-0.5,-0.5,-0.5,0.5],"position":[1,2.7,0],"parent":0},{"name":"rod","position":[0,3.5,0],"parent":0},{"name":"spawner_front","rotation":[-0.5,-0.5,-0.5,0.5],"scale":[1,1,1],"position":[2,1,0],"parent":0},{"name":"spawner_left","rotation":[-0.707107,0,0,0.707107],"position":[0,1,-2],"parent":0},{"name":"spawner_right","rotation":[0,0.707107,0.707107,0],"position":[0,1,2],"parent":0},{"name":"spawner_back","rotation":[-0.5,0.5,0.5,0.5],"scale":[1,1,1],"position":[-2,1,0],"parent":0},{"name":"turret_11","rotation":[0,0.707107,0,0.707107],"scale":[1,1,1],"position":[2,1,-2],"parent":0},{"name":"barrel_11","rotation":[0,0.707107,0.707107,0],"position":[0,0,1],"parent":10},{"name":"turret_01","position":[2,1,2],"parent":0},{"name":"barrel_01","rotation":[0,0.707107,0.707107,0],"position":[0,0,1],"parent":12},{"name":"turret_00","rotation":[0,-0.707107,0,0.707107],"scale":[1,1,1],"position":[-2,1,2],"parent":0},{"name":"barrel_00","rotation":[0,0.707107,0.707107,0],"position":[0,0,1],"parent":14},{"name":"turret_10","rotation":[0,1,0,0],"position":[-2,1,-2],"parent":0},{"name":"barrel_10","rotation":[0,0.707107,0.707107,0],"position":[0,0,1],"parent":16}]},{"name":"stingray","texture":15,"format":1,"indices":{"byteOffset":2889806,"byteLength":9528},"vertices":{"byteOffset":2899336,"byteLength":73856},"inverseBindPose":{"byteOffset":2973196,"byteLength":448},"armature":[{"name":"base","rotation":[-0.5,-0.5,-0.5,0.5],"position":[0,1.3,0],"parent":-1},{"name":"jaw_left","position":[-0.5,1.8,0],"parent":0},{"name":"tail0","rotation":[0,0,1,0],"position":[0,-0.3,0],"parent":0},{"name":"tail1","position":[0,0.825,0],"parent":2},{"name":"tail2","rotation":[0,0,0,1],"position":[0,0.725,0],"parent":3},{"name":"tail3","rotation":[0,0,0,1],"position":[0,0.725,0],"parent":4},{"name":"jaw_right","position":[0.5,1.8,0],"parent":0}]},{"name":"locust","texture":16,"format":1,"indices":{"byteOffset":2973646,"byteLength":26688},"vertices":{"byteOffset":3000336,"byteLength":200800},"inverseBindPose":{"byteOffset":3201140,"byteLength":384},"armature":[{"name":"base","parent":-1},{"name":"cage","position":[-1.3,0.7,0],"parent":0},{"name":"rod","position":[0,1,0],"parent":1},{"name":"gun","rotation":[-0.5,-0.5,-0.5,0.5],"position":[2.5,1.4,0],"parent":0},{"name":"cover_right","position":[0.6,0.3,0.2],"parent":0},{"name":"cover_left","position":[0.6,0.3,-0.2],"parent":0}]},{"name":"decapod","texture":17,"format":1,"indices":{"byteOffset":3201526,"byteLength":15192},"vertices":{"byteOffset":3216720,"byteLength":114688},"inverseBindPose":{"byteOffset":3331412,"byteLength":320},"armature":[{"name":"base","parent":-1},{"name":"side_left","position":[0,0.7,-0.5],"parent":0},{"name":"side_right","position":[0,0.7,0.5],"parent":0},{"name":"gun","position":[0,1.8,0],"parent":0},{"name":"barrel","position":[0,1,0],"parent":3}]},{"name":"isopod","texture":18,"format":1,"indices":{"byteOffset":3331734,"byteLength":12084},"vertices":{"byteOffset":3343820,"byteLength":92896},"inverseBindPose":{"byteOffset":3436720,"byteLength":256},"armature":[{"name":"base","parent":-1},{"name":"cover","rotation":[-0.146447,0.353553,0.353553,0.853554],"scale":[1,1,1],"position":[0.4,1.1,0],"parent":0},{"name":"gun","rotation":[-0.5,-0.5,-0.5,0.5],"position":[0.5,0.7,0],"parent":0},{"name":"barrel","rotation":[0,0,0,1],"position":[0,0.7,0],"parent":2}]},{"name":"wall_X_0","texture":-1,"format":0,"indices":{"byteOffset":3436978,"byteLength":1164},"vertices":{"byteOffset":3438144,"byteLength":5808}},{"name":"wall_I_0","texture":-1,"format":0,"indices":{"byteOffset":3443954,"byteLength":804},"vertices":{"byteOffset":3444760,"byteLength":4512}},{"name":"wall_I_1","texture":-1,"format":0,"indices":{"byteOffset":3449274,"byteLength":684},"vertices":{"byteOffset":3449960,"byteLength":3264}},{"name":"wall_L_0","texture":-1,"format":0,"indices":{"byteOffset":3453226,"byteLength":816},"vertices":{"byteOffset":3454044,"byteLength":3792}},{"name":"wall_L_1","texture":-1,"format":0,"indices":{"byteOffset":3457838,"byteLength":366},"vertices":{"byteOffset":3458208,"byteLength":2424}},{"name":"wall_I_2","texture":-1,"format":0,"indices":{"byteOffset":3460634,"byteLength":588},"vertices":{"byteOffset":3461224,"byteLength":3552}},{"name":"wall_T_0","texture":-1,"format":0,"indices":{"byteOffset":3464778,"byteLength":1116},"vertices":{"byteOffset":3465896,"byteLength":6384}},{"name":"wall_U_0","texture":-1,"format":0,"indices":{"byteOffset":3472282,"byteLength":372},"vertices":{"byteOffset":3472656,"byteLength":2496}},{"name":"wall_O_0","texture":-1,"format":0,"indices":{"byteOffset":3475154,"byteLength":732},"vertices":{"byteOffset":3475888,"byteLength":4032}},{"name":"wall_U_1","texture":-1,"format":0,"indices":{"byteOffset":3479922,"byteLength":456},"vertices":{"byteOffset":3480380,"byteLength":2976}},{"name":"wall_U_2","texture":-1,"format":0,"indices":{"byteOffset":3483358,"byteLength":996},"vertices":{"byteOffset":3484356,"byteLength":4248}},{"name":"wall_O_1","texture":-1,"format":0,"indices":{"byteOffset":3488606,"byteLength":804},"vertices":{"byteOffset":3489412,"byteLength":4608}},{"name":"wall_I_3","texture":-1,"format":0,"indices":{"byteOffset":3494022,"byteLength":396},"vertices":{"byteOffset":3494420,"byteLength":2112}}],"audio":[{"key":"assets/ambient_theme.mp3","byteOffset":1,"byteLength":2218689},{"key":"assets/cannon_hit.mp3","byteOffset":2218691,"byteLength":15626},{"key":"assets/cannon_use.mp3","byteOffset":2234318,"byteLength":15626},{"key":"assets/conflict_theme.mp3","byteOffset":2249945,"byteLength":1365216},{"key":"assets/cube_0_close.mp3","byteOffset":3615162,"byteLength":19806},{"key":"assets/cube_0_open.mp3","byteOffset":3634969,"byteLength":23567},{"key":"assets/cube_0_use.mp3","byteOffset":3658537,"byteLength":27747},{"key":"assets/cube_1_close.mp3","byteOffset":3686285,"byteLength":15626},{"key":"assets/cube_1_open.mp3","byteOffset":3701912,"byteLength":21477},{"key":"assets/cube_1_use.mp3","byteOffset":3723390,"byteLength":55750},{"key":"assets/cube_2_close.mp3","byteOffset":3779141,"byteLength":23567},{"key":"assets/cube_2_open.mp3","byteOffset":3802709,"byteLength":23867},{"key":"assets/cube_2_use.mp3","byteOffset":3826577,"byteLength":27747},{"key":"assets/cube_3_close.mp3","byteOffset":3854325,"byteLength":13954},{"key":"assets/cube_3_open.mp3","byteOffset":3868280,"byteLength":27747},{"key":"assets/cube_3_use.mp3","byteOffset":3896028,"byteLength":43629},{"key":"assets/cube_4_close.mp3","byteOffset":3939658,"byteLength":19806},{"key":"assets/cube_4_open.mp3","byteOffset":3959465,"byteLength":21477},{"key":"assets/cube_4_use.mp3","byteOffset":3980943,"byteLength":31509},{"key":"assets/cube_5_close.mp3","byteOffset":4012453,"byteLength":19806},{"key":"assets/cube_5_explode.mp3","byteOffset":4032260,"byteLength":67453},{"key":"assets/cube_5_open.mp3","byteOffset":4099714,"byteLength":34434},{"key":"assets/cube_5_trigger.mp3","byteOffset":4134149,"byteLength":13954},{"key":"assets/cube_5_use.mp3","byteOffset":4148104,"byteLength":27747},{"key":"assets/cube_6_close.mp3","byteOffset":4175852,"byteLength":17716},{"key":"assets/cube_6_open.mp3","byteOffset":4193569,"byteLength":19806},{"key":"assets/cube_6_use.mp3","byteOffset":4213376,"byteLength":37778},{"key":"assets/cube_7_close.mp3","byteOffset":4251155,"byteLength":21477},{"key":"assets/cube_7_loop.mp3","byteOffset":4272633,"byteLength":63691},{"key":"assets/cube_7_open.mp3","byteOffset":4336325,"byteLength":43629},{"key":"assets/cube_8_close.mp3","byteOffset":4379955,"byteLength":14790},{"key":"assets/cube_8_hit.mp3","byteOffset":4394746,"byteLength":33598},{"key":"assets/cube_8_open.mp3","byteOffset":4428345,"byteLength":26911},{"key":"assets/cube_8_use.mp3","byteOffset":4455257,"byteLength":62020},{"key":"assets/cube_damage.mp3","byteOffset":4517278,"byteLength":37778},{"key":"assets/cube_death.mp3","byteOffset":4555057,"byteLength":47809},{"key":"assets/cube_step.mp3","byteOffset":4602867,"byteLength":20642},{"key":"assets/flamethrower_use.mp3","byteOffset":4623510,"byteLength":33598},{"key":"assets/laser_close.mp3","byteOffset":4657109,"byteLength":27747},{"key":"assets/laser_loop.mp3","byteOffset":4684857,"byteLength":55750},{"key":"assets/laser_use.mp3","byteOffset":4740608,"byteLength":29837},{"key":"assets/lift_down.mp3","byteOffset":4770446,"byteLength":27747},{"key":"assets/lift_up.mp3","byteOffset":4798194,"byteLength":29837},{"key":"assets/link_loop.mp3","byteOffset":4828032,"byteLength":63691},{"key":"assets/link_use.mp3","byteOffset":4891724,"byteLength":44465},{"key":"assets/lunge_use.mp3","byteOffset":4936190,"byteLength":33598},{"key":"assets/menu_install.mp3","byteOffset":4969789,"byteLength":20642},{"key":"assets/menu_select.mp3","byteOffset":4990432,"byteLength":15626},{"key":"assets/menu_theme.mp3","byteOffset":5006059,"byteLength":682271},{"key":"assets/menu_upgrade.mp3","byteOffset":5688331,"byteLength":23567},{"key":"assets/mortar_aim.mp3","byteOffset":5711899,"byteLength":27747},{"key":"assets/mortar_hit.mp3","byteOffset":5739647,"byteLength":37778},{"key":"assets/mortar_use.mp3","byteOffset":5777426,"byteLength":39032},{"key":"assets/orb_use.mp3","byteOffset":5816459,"byteLength":41540},{"key":"assets/shock_use.mp3","byteOffset":5858000,"byteLength":35688},{"key":"assets/spawner_use.mp3","byteOffset":5893689,"byteLength":47809},{"key":"assets/strike_use.mp3","byteOffset":5941499,"byteLength":29837},{"key":"assets/turret_use.mp3","byteOffset":5971337,"byteLength":11446},{"key":"assets/unit_damage.mp3","byteOffset":5982784,"byteLength":41540},{"key":"assets/unit_death.mp3","byteOffset":6024325,"byteLength":55750},{"key":"assets/unit_land.mp3","byteOffset":6080076,"byteLength":17716},{"key":"assets/unit_move.mp3","byteOffset":6097793,"byteLength":63691},{"key":"assets/war_theme.mp3","byteOffset":6161485,"byteLength":853216},{"key":"assets/wave_use.mp3","byteOffset":7014702,"byteLength":47809}]}')},8571:e=>{"use strict";e.exports=JSON.parse('{"dock":{"open":[{"index":1,"frame":0,"position":[0,0,0]},{"index":1,"frame":1,"position":[0,2,0],"ease":"quadInOut"},{"index":2,"frame":0,"position":[0,1,0]},{"index":2,"frame":1,"position":[0,0.1,0],"ease":"quadOut"},{"index":3,"frame":0,"position":[0,-0.5,0]},{"index":3,"frame":1,"position":[0,1,0],"ease":"quadInOut"},{"index":4,"frame":0,"position":[0,0,0]},{"index":5,"frame":0,"position":[0,0,0]},{"index":5,"frame":1,"position":[0,-1,0],"ease":"quadOut"}],"lift":[{"index":1,"frame":0,"position":[0,2,0]},{"index":1,"frame":0.5,"position":[0,0,0],"ease":"quadIn"},{"index":2,"frame":0.25,"position":[0,0.1,0]},{"index":2,"frame":1,"position":[0,1,0],"ease":"sineOut"},{"index":3,"frame":0,"position":[0,1,0]},{"index":3,"frame":0.75,"position":[0,0.5,0],"ease":"quadOut"},{"index":4,"frame":0,"position":[0,0,0]},{"index":4,"frame":1,"position":[0,2,0],"ease":"quadIn"},{"index":5,"frame":0.25,"position":[0,-1,0]},{"index":5,"frame":1,"position":[0,1,0],"ease":"sineOut"}]},"cube_open":{"close":[{"index":1,"frame":0,"rotation":[-1,0,0,0]},{"index":2,"frame":0,"rotation":[0,0,1,0]},{"index":3,"frame":0,"rotation":[-0.707107,0,-0.707107,0]},{"index":4,"frame":0,"rotation":[-0.707107,0,0.707107,0]}],"open":[{"index":1,"frame":0,"rotation":[-1,0,0,0]},{"index":1,"frame":1,"rotation":[-0.707107,0,0,0.707107],"ease":"quadOut"},{"index":2,"frame":0,"rotation":[0,0,1,0]},{"index":2,"frame":1,"rotation":[0,0.707107,0.707107,0],"ease":"quadOut"},{"index":3,"frame":0,"rotation":[-0.707107,0,-0.707107,0]},{"index":3,"frame":1,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quadOut"},{"index":4,"frame":0,"rotation":[-0.707107,0,0.707107,0]},{"index":4,"frame":1,"rotation":[-0.5,0.5,0.5,0.5],"ease":"quadOut"}]},"death":{"close":[{"index":0,"frame":0,"position":[0,0,0]},{"index":1,"frame":0,"position":[0.6,0.4,0.6]},{"index":2,"frame":0,"position":[0.6,0.4,-0.6]},{"index":3,"frame":0,"position":[0.6,1.6,0.6]},{"index":4,"frame":0,"position":[0.6,1.6,-0.6]},{"index":5,"frame":0,"position":[-0.6,0.4,0.6]},{"index":6,"frame":0,"position":[-0.6,0.4,-0.6]},{"index":7,"frame":0,"position":[-0.6,1.6,0.6]},{"index":8,"frame":0,"position":[-0.6,1.6,-0.6]}],"open":[{"index":1,"frame":0.0125,"position":[0.6,0.4,0.6],"rotation":[0,0,0,1]},{"index":2,"frame":0.025,"position":[0.6,0.4,-0.6],"rotation":[0,0,0,1]},{"index":3,"frame":0.0375,"position":[0.6,1.6,0.6],"rotation":[0,0,0,1]},{"index":4,"frame":0.05,"position":[0.6,1.6,-0.6],"rotation":[0,0,0,1]},{"index":5,"frame":0.0625,"position":[-0.6,0.4,0.6],"rotation":[0,0,0,1]},{"index":6,"frame":0.075,"position":[-0.6,0.4,-0.6],"rotation":[0,0,0,1]},{"index":7,"frame":0.0875,"position":[-0.6,1.6,0.6],"rotation":[0,0,0,1]},{"index":8,"frame":0.1,"position":[-0.6,1.6,-0.6],"rotation":[0,0,0,1]},{"index":1,"frame":0.4,"position":[1.6,1.2,1.6],"ease":"cubicOut"},{"index":2,"frame":0.4,"position":[1.6,1.2,-1.6],"ease":"cubicOut"},{"index":3,"frame":0.4,"position":[1.6,2.6,1.6],"ease":"cubicOut"},{"index":4,"frame":0.4,"position":[1.6,2.6,-1.6],"ease":"cubicOut"},{"index":5,"frame":0.4,"position":[-1.6,1.2,1.6],"ease":"cubicOut"},{"index":6,"frame":0.4,"position":[-1.6,1.2,-1.6],"ease":"cubicOut"},{"index":7,"frame":0.4,"position":[-1.6,2.6,1.6],"ease":"cubicOut"},{"index":8,"frame":0.4,"position":[-1.6,2.6,-1.6],"ease":"cubicOut"}]},"cube_0":{"close":[{"index":1,"frame":0,"position":[-0.2,0.4,0],"rotation":[0,0,0,1]},{"index":2,"frame":0,"position":[0.3,0.7,0]},{"index":3,"frame":0,"position":[-0.2,0.7,0]},{"index":4,"frame":0,"position":[0.1,2,-0.1]},{"index":5,"frame":0,"position":[0.1,2,0.1]},{"index":6,"frame":0,"position":[-0.1,2,0.1]},{"index":7,"frame":0,"position":[-0.1,2,-0.1]}],"open":[{"index":1,"frame":0,"position":[-0.2,0,0]},{"index":1,"frame":1,"position":[0,1,0],"ease":"quadOut"},{"index":2,"frame":0.5,"position":[0.3,0.7,0]},{"index":2,"frame":1,"position":[-0.1,0.7,0],"ease":"quadIn"},{"index":3,"frame":0.5,"position":[-0.2,0.7,0]},{"index":3,"frame":1,"position":[0.4,0.7,0],"ease":"quadIn"},{"index":4,"frame":0,"position":[0.1,2,-0.1]},{"index":4,"frame":0.5,"position":[0.6,2,-0.6],"ease":"sineOut"},{"index":4,"frame":1,"position":[0.6,1.5,-0.6],"ease":"quadIn"},{"index":5,"frame":0,"position":[0.1,2,0.1]},{"index":5,"frame":0.5,"position":[0.6,2,0.6],"ease":"sineOut"},{"index":5,"frame":1,"position":[0.6,1.5,0.6],"ease":"quadIn"},{"index":6,"frame":0,"position":[-0.1,2,0.1]},{"index":6,"frame":0.5,"position":[-0.6,2,0.6],"ease":"sineOut"},{"index":6,"frame":1,"position":[-0.6,1.5,0.6],"ease":"quadIn"},{"index":7,"frame":0,"position":[-0.1,2,-0.1]},{"index":7,"frame":0.5,"position":[-0.6,2,-0.6],"ease":"sineOut"},{"index":7,"frame":1,"position":[-0.6,1.5,-0.6],"ease":"quadIn"}],"activate0":[{"index":1,"frame":0.1,"position":[0,1,0],"rotation":[0,1,0,0]},{"index":1,"frame":0.25,"position":[0.2,1,0],"ease":"cubicOut"},{"index":1,"frame":0.45,"position":[0,1,0],"ease":"quadInOut"}],"activate1":[{"index":1,"frame":0.1,"position":[0,1,0],"rotation":[0,0.707107,0,-0.707107]},{"index":1,"frame":0.25,"position":[0,1,-0.2],"ease":"cubicOut"},{"index":1,"frame":0.45,"position":[0,1,0],"ease":"quadInOut"}],"activate2":[{"index":1,"frame":0.1,"position":[0,1,0],"rotation":[0,0,0,1]},{"index":1,"frame":0.25,"position":[-0.2,1,0],"ease":"cubicOut"},{"index":1,"frame":0.45,"position":[0,1,0],"ease":"quadInOut"}],"activate3":[{"index":1,"frame":0.1,"position":[0,1,0],"rotation":[0,0.707107,0,0.707107]},{"index":1,"frame":0.25,"position":[0,1,0.2],"ease":"cubicOut"},{"index":1,"frame":0.45,"position":[0,1,0],"ease":"quadInOut"}],"activate":[{"index":2,"frame":0,"position":[-0.1,0.7,0]},{"index":2,"frame":0.15,"position":[-0.7,0.7,0],"ease":"quartIn"},{"index":2,"frame":0.5,"position":[-0.1,0.7,0],"ease":"CubicBezier,0.34,1.56,0.64,1"},{"index":3,"frame":0,"position":[0.4,0.7,0]},{"index":3,"frame":0.1,"position":[-0.2,0.7,0],"ease":"cubicIn"},{"index":3,"frame":0.5,"position":[0.4,0.7,0],"ease":"cubicOut"}]},"cube_1":{"close":[{"index":1,"frame":0,"position":[0,0.8,-0.3],"rotation":[0,0,0,1]},{"index":2,"frame":0,"position":[-0.5,0.6,-0.2]},{"index":3,"frame":0,"position":[0,0.8,0.3],"rotation":[0,0,0,1]},{"index":4,"frame":0,"position":[-0.5,0.6,0.2]},{"index":5,"frame":0,"position":[0.2,0.7,0]},{"index":6,"frame":0,"position":[-0.5,0.7,0]},{"index":7,"frame":0,"position":[-0.5,0.7,0]},{"index":8,"frame":0,"position":[0,1,0]}],"open":[{"index":1,"frame":0,"position":[0,0.8,-0.3],"rotation":[0,0,0,1]},{"index":1,"frame":1,"position":[0,1,-0.7],"rotation":[-0.382683,0,0,0.92388],"ease":"quadOut"},{"index":2,"frame":0.5,"position":[-0.5,0.6,-0.2]},{"index":2,"frame":1,"position":[-0.5,1.2,-0.2],"ease":"quadOut"},{"index":3,"frame":0,"position":[0,0.8,0.3],"rotation":[0,0,0,1]},{"index":3,"frame":1,"position":[0,1,0.7],"rotation":[0.382683,0,0,0.92388],"ease":"quadOut"},{"index":4,"frame":0.5,"position":[-0.5,0.6,0.2]},{"index":4,"frame":1,"position":[-0.5,1.2,0.2],"ease":"quadOut"},{"index":5,"frame":0,"position":[0.2,-0.5,0]},{"index":5,"frame":0.5,"position":[0.2,0.7,0],"ease":"sineIn"},{"index":5,"frame":1,"position":[-0.4,0.7,0],"ease":"sineOut"},{"index":6,"frame":0.5,"position":[-0.5,0.7,0]},{"index":6,"frame":1,"position":[0.7,0.7,0],"ease":"quadOut"},{"index":7,"frame":0.5,"position":[-0.5,0.7,0]},{"index":7,"frame":1,"position":[0.3,0.7,0],"ease":"quadOut"},{"index":8,"frame":0,"position":[0,1,0]}],"activate":[{"index":2,"frame":1.2,"position":[-0.5,1.2,-0.2]},{"index":2,"frame":1.6,"position":[-0.5,0.8,-0.2],"ease":"cubicOut"},{"index":2,"frame":3,"position":[-0.5,1.2,-0.2],"ease":"sineIn"},{"index":4,"frame":1.2,"position":[-0.5,1.2,0.2]},{"index":4,"frame":1.6,"position":[-0.5,0.8,0.2],"ease":"cubicOut"},{"index":4,"frame":3,"position":[-0.5,1.2,0.2],"ease":"sineIn"},{"index":5,"frame":0,"position":[-0.4,0.7,0]},{"index":5,"frame":1,"position":[-0.6,0.7,0],"ease":"cubicOut"},{"index":5,"frame":1.4,"position":[0,0.7,0],"ease":"quadInOut"},{"index":5,"frame":3,"position":[-0.4,0.7,0],"ease":"sineIn"},{"index":6,"frame":0,"position":[0.7,0.7,0]},{"index":6,"frame":1.2,"position":[1,0.7,0],"ease":"cubicOut"},{"index":6,"frame":1.6,"position":[0.4,0.7,0],"ease":"quadInOut"},{"index":6,"frame":3,"position":[0.7,0.7,0],"ease":"sineIn"},{"index":7,"frame":1,"position":[0.3,0.7,0]},{"index":7,"frame":1.6,"position":[-0.2,0.7,0],"ease":"quadOut"},{"index":7,"frame":3,"position":[0.3,0.7,0],"ease":"quadIn"},{"index":8,"frame":0.8,"position":[0,1,0]},{"index":8,"frame":1.4,"position":[-0.6,1,0],"ease":"quadOut"},{"index":8,"frame":2,"position":[0,1,0],"ease":"quadIn"}]},"cube_2":{"close":[{"index":1,"frame":0,"position":[0,1,1]},{"index":2,"frame":0,"position":[0,1,-1]},{"index":3,"frame":0,"position":[-1,1,0]},{"index":4,"frame":0,"position":[1,1,0]},{"index":5,"frame":0,"position":[0,1,0]},{"index":6,"frame":0,"position":[0,0.8,0]}],"open":[{"index":1,"frame":0,"position":[0,1,1]},{"index":1,"frame":1,"position":[0,1,-1],"ease":"quadInOut"},{"index":2,"frame":0,"position":[0,1,-1]},{"index":2,"frame":1,"position":[0,1,1],"ease":"quadInOut"},{"index":3,"frame":0,"position":[-1,1,0]},{"index":3,"frame":1,"position":[1,1,0],"ease":"quadInOut"},{"index":4,"frame":0,"position":[1,1,0]},{"index":4,"frame":1,"position":[-1,1,0],"ease":"quadInOut"},{"index":5,"frame":0,"position":[0,1,0]},{"index":5,"frame":0.4,"position":[0,2,0],"ease":"quartOut"},{"index":6,"frame":0.4,"position":[0,0.8,0]},{"index":6,"frame":1,"position":[0,2,0],"ease":"quadInOut"}],"activate":[{"index":5,"frame":0,"position":[0,2,0]},{"index":5,"frame":0.2,"position":[0,1,0],"ease":"cubicOut"},{"index":5,"frame":0.5,"position":[0,2,0],"ease":"quartIn"},{"index":6,"frame":0,"position":[0,2,0]},{"index":6,"frame":0.3,"position":[0,1,0],"ease":"sineOut"},{"index":6,"frame":0.6,"position":[0,2,0],"ease":"CubicBezier,1,0,0.5,1.5"}]},"cube_3":{"close":[{"index":1,"frame":0,"position":[0,-2,0]},{"index":2,"frame":0,"position":[0.7,3.9,0],"rotation":[0.5,-0.5,0.5,0.5]},{"index":3,"frame":0,"position":[0,2,0],"rotation":[0,0.382683,0,0.92388]},{"index":4,"frame":0,"position":[0,3,0],"rotation":[0,-0.382683,0,0.92388]},{"index":5,"frame":0,"position":[0,4.5,0]}],"open":[{"index":1,"frame":0,"position":[0,-2,0]},{"index":1,"frame":1,"position":[0,0,0],"ease":"quadOut"},{"index":2,"frame":0,"position":[0.7,3.9,0],"rotation":[0.5,-0.5,0.5,0.5]},{"index":2,"frame":1,"position":[0.7,3.9,0],"rotation":[-0.5,0.5,0.5,0.5],"ease":"sineInOut"},{"index":3,"frame":0.2,"position":[0,1.5,0],"rotation":[0,0.382683,0,0.92388]},{"index":3,"frame":1,"position":[0,1,0],"rotation":[0,0,0,1],"ease":"sineIn"},{"index":4,"frame":0.2,"position":[0,2.5,0],"rotation":[0,-0.382683,0,0.92388]},{"index":4,"frame":1,"position":[0,2,0],"rotation":[0,0,0,1],"ease":"sineIn"},{"index":5,"frame":0,"position":[0,3,0]}],"activate":[{"index":1,"frame":0,"position":[0,0,0]},{"index":1,"frame":0.4,"position":[0,1,0],"ease":"quadInOut"},{"index":1,"frame":0.8,"position":[0,-1,0],"ease":"cubicIn"},{"index":1,"frame":1.8,"position":[0,0,0],"ease":"quadInOut"},{"index":2,"frame":0.6,"position":[0.7,3.9,0]},{"index":2,"frame":0.8,"position":[0.7,3.3,0],"ease":"quartIn"},{"index":2,"frame":1.6,"position":[0.7,3.9,0],"ease":"sineOut"},{"index":3,"frame":0,"position":[0,1,0],"rotation":[0,0,0,1]},{"index":3,"frame":0.5,"rotation":[0,1,0,0],"ease":"sineIn"},{"index":3,"frame":0.8,"rotation":[0,0.382683,0,-0.92388],"ease":"sineOut"},{"index":3,"frame":1.8,"position":[0,1,0],"rotation":[0,0,0,1],"ease":"quadInOut"},{"index":3,"frame":0.4,"position":[0,0,0],"ease":"quadInOut"},{"index":3,"frame":0.8,"position":[0,2,0],"ease":"cubicIn"},{"index":4,"frame":0,"position":[0,2,0],"rotation":[0,0,0,1]},{"index":4,"frame":0.5,"rotation":[0,-1,0,0],"ease":"sineIn"},{"index":4,"frame":0.8,"rotation":[0,-0.382683,0,-0.92388],"ease":"sineOut"},{"index":4,"frame":1.8,"position":[0,2,0],"rotation":[0,0,0,1],"ease":"quadInOut"},{"index":4,"frame":0.4,"position":[0,2,0],"ease":"quadInOut"},{"index":4,"frame":0.8,"position":[0,2.5,0],"ease":"cubicIn"}]},"cube_4":{"close":[{"index":1,"frame":0,"position":[-0.5,1,0],"rotation":[0.5,0.5,-0.5,0.5]},{"index":2,"frame":0,"position":[-0.5,1,0],"rotation":[-0.5,-0.5,0.5,-0.5]},{"index":3,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":4,"frame":0,"position":[0.5,0.5,0]},{"index":5,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":6,"frame":0,"position":[-0.5,0.5,0]}],"open":[{"index":1,"frame":0,"position":[-0.7,1,0],"rotation":[0.5,0.5,-0.5,0.5]},{"index":1,"frame":1,"position":[0,1,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"sineIn"},{"index":2,"frame":0,"position":[-0.9,1,0],"rotation":[-0.5,-0.5,0.5,-0.5]},{"index":2,"frame":1,"position":[0.6,1,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"sineIn"},{"index":3,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":3,"frame":1,"rotation":[-0.707107,0,0,0.707107],"ease":"quadInOut"},{"index":4,"frame":0.4,"position":[0.5,0.5,0.4],"scale":[0,1,0]},{"index":4,"frame":1,"position":[0.5,0.5,1],"scale":[1,1,1],"ease":"quadOut"},{"index":5,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":5,"frame":1,"rotation":[0,0.707107,0.707107,0],"ease":"quadInOut"},{"index":6,"frame":0.4,"position":[-0.5,0.5,0.4],"scale":[0,1,0]},{"index":6,"frame":1,"position":[-0.5,0.5,1],"scale":[1,1,1],"ease":"quadOut"}],"activate":[{"index":1,"frame":0.1,"position":[0,1,0],"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":1,"frame":0.6,"position":[0.5,1,0],"ease":"quadInOut"},{"index":1,"frame":0.8,"position":[-1,1,0],"ease":"quartIn"},{"index":1,"frame":0.6,"rotation":[0.683013,0.683013,-0.183013,0.183013],"ease":"quadIn"},{"index":1,"frame":0.9,"rotation":[0.183013,0.183013,-0.683013,0.683013],"ease":"linear"},{"index":1,"frame":1.4,"position":[0,1,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quadOut"},{"index":2,"frame":0,"position":[0.6,1,0],"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":2,"frame":0.6,"position":[1.4,1,0],"ease":"quadInOut"},{"index":2,"frame":0.8,"position":[-0.5,1,0],"ease":"quadIn"},{"index":2,"frame":0.5,"rotation":[0.183013,0.183013,-0.683013,0.683013],"ease":"quadIn"},{"index":2,"frame":0.8,"rotation":[0.683013,0.683013,-0.183013,0.183013],"ease":"linear"},{"index":2,"frame":1.5,"position":[0.6,1,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"sineOut"},{"index":4,"frame":0.6,"position":[0.5,0.5,1]},{"index":4,"frame":0.8,"position":[0.5,0.5,0.6],"ease":"cubicIn"},{"index":4,"frame":1.2,"position":[0.5,0.5,1],"ease":"cubicOut"},{"index":6,"frame":0.6,"position":[-0.5,0.5,1]},{"index":6,"frame":0.8,"position":[-0.5,0.5,0.6],"ease":"cubicIn"},{"index":6,"frame":1.2,"position":[-0.5,0.5,1],"ease":"cubicOut"}]},"cube_5":{"close":[{"index":1,"frame":0,"position":[-0.5,0.5,-0.5]},{"index":2,"frame":0,"position":[-0.5,0.5,0.5]},{"index":3,"frame":0,"position":[0.5,0.5,-0.5]},{"index":4,"frame":0,"position":[0.5,0.5,0.5]},{"index":5,"frame":0,"position":[0,0,0],"scale":[0,0,0]},{"index":6,"frame":0,"position":[0,-0.02,0]},{"index":7,"frame":0,"position":[0,0,0]}],"open":[{"index":1,"frame":0,"position":[-0.5,0.5,-0.5]},{"index":1,"frame":0.4,"position":[-1,1,-1],"ease":"quadOut"},{"index":1,"frame":1,"position":[-1,0.5,-1],"ease":"cubicIn"},{"index":2,"frame":0,"position":[-0.5,0.5,0.5]},{"index":2,"frame":0.4,"position":[-1,1,1],"ease":"quadOut"},{"index":2,"frame":1,"position":[-1,0.5,1],"ease":"cubicIn"},{"index":3,"frame":0,"position":[0.5,0.5,-0.5]},{"index":3,"frame":0.4,"position":[1,1,-1],"ease":"quadOut"},{"index":3,"frame":1,"position":[1,0.5,-1],"ease":"cubicIn"},{"index":4,"frame":0,"position":[0.5,0.5,0.5]},{"index":4,"frame":0.4,"position":[1,1,1],"ease":"quadOut"},{"index":4,"frame":1,"position":[1,0.5,1],"ease":"cubicIn"},{"index":5,"frame":0.5,"position":[0,-0.2,0],"scale":[1,1,1]},{"index":5,"frame":1,"position":[0,1,0],"ease":"sineOut"},{"index":6,"frame":0.5,"position":[0,-0.5,0]},{"index":6,"frame":1,"position":[0,1,0],"ease":"quadIn"},{"index":7,"frame":0,"position":[0,0,0]},{"index":7,"frame":0.5,"position":[0,-1,0],"ease":"cubicIn"}],"activate":[{"index":5,"frame":0.1,"position":[0,1,0]},{"index":5,"frame":0.7,"position":[0,1.6,0],"ease":"sineInOut"},{"index":5,"frame":1,"position":[0,0,0],"ease":"quartIn"},{"index":5,"frame":2,"position":[0,1,0],"ease":"quadInOut"},{"index":6,"frame":0,"position":[0,1,0],"rotation":[0,0,0,1]},{"index":6,"frame":0.6,"position":[0,1.4,0],"rotation":[0,0.707107,0,0.707107],"ease":"quadInOut"},{"index":6,"frame":1,"position":[0,0,0],"rotation":[0,0.707107,0,0.707107],"ease":"expoIn"},{"index":6,"frame":1.6,"position":[0,1,0],"rotation":[0,0,0,1],"ease":"quadInOut"},{"index":1,"frame":1,"position":[-1,0.5,-1]},{"index":2,"frame":1,"position":[-1,0.5,1]},{"index":3,"frame":1,"position":[1,0.5,-1]},{"index":4,"frame":1,"position":[1,0.5,1]},{"index":1,"frame":1.1,"position":[-1,0.8,-1],"ease":"quadOut"},{"index":2,"frame":1.1,"position":[-1,0.8,1],"ease":"quadOut"},{"index":3,"frame":1.1,"position":[1,0.8,-1],"ease":"quadOut"},{"index":4,"frame":1.1,"position":[1,0.8,1],"ease":"quadOut"},{"index":1,"frame":1.4,"position":[-1,0.5,-1],"ease":"cubicIn"},{"index":2,"frame":1.4,"position":[-1,0.5,1],"ease":"cubicIn"},{"index":3,"frame":1.4,"position":[1,0.5,-1],"ease":"cubicIn"},{"index":4,"frame":1.4,"position":[1,0.5,1],"ease":"cubicIn"}]},"cube_6":{"close":[{"index":1,"frame":0,"rotation":[0,0,0,1]},{"index":2,"frame":0,"rotation":[0,0,0,1]},{"index":6,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":7,"frame":0,"rotation":[0,0.707107,0,0.707107]},{"index":3,"frame":0,"position":[0,0.1,0],"scale":[0,0,0]},{"index":4,"frame":0,"position":[0,0,0]},{"index":5,"frame":0,"position":[0,0,0]}],"open":[{"index":1,"frame":0,"rotation":[0,0,0,1]},{"index":1,"frame":1,"rotation":[-0.707107,0,0,0.707107],"ease":"cubicIn"},{"index":2,"frame":0,"rotation":[0,0,0,1]},{"index":2,"frame":1,"rotation":[0.707107,0,0,0.707107],"ease":"cubicIn"},{"index":6,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":6,"frame":1,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"cubicIn"},{"index":7,"frame":0,"rotation":[0,0.707107,0,0.707107]},{"index":7,"frame":1,"rotation":[-0.5,0.5,0.5,0.5],"ease":"cubicIn"},{"index":3,"frame":0,"position":[0,0,0],"scale":[1,1,1]},{"index":3,"frame":0.4,"position":[0,2,0],"ease":"sineIn"},{"index":4,"frame":0.2,"position":[0,0,0]},{"index":4,"frame":0.8,"position":[0,1,0],"ease":"quadOut"},{"index":5,"frame":0.4,"position":[0,-2,0],"scale":[1,1,1],"rotation":[0,1,0,0]},{"index":5,"frame":1,"position":[0,0,0],"rotation":[0,0,0,1],"ease":"quadOut"}],"loop":[{"index":3,"frame":0,"position":[0,2,0]},{"index":3,"frame":1,"position":[0,1.9,0],"ease":"quartIn"},{"index":3,"frame":1.6,"position":[0,2,0],"ease":"cubicOut"},{"index":4,"frame":0,"position":[0,1,0]},{"index":4,"frame":1,"position":[0,0.7,0],"ease":"quadIn"},{"index":4,"frame":1.2,"position":[0,1,0],"ease":"quadOut"},{"index":5,"frame":0,"position":[0,0,0],"rotation":[0,0,0,1]},{"index":5,"frame":0.8,"position":[0,-1,0],"rotation":[0,1,0,0],"ease":"sineOut"},{"index":5,"frame":1.2,"position":[0,1,0],"rotation":[0,-0.309017,0,0.951057],"ease":"cubicInOut"},{"index":5,"frame":2,"position":[0,0,0],"rotation":[0,0,0,1],"ease":"sineIn"}]},"cube_7":{"close":[{"index":1,"frame":0,"position":[0,0.8,0],"scale":[1,0.5,1]},{"index":2,"frame":0,"position":[0,0,0],"rotation":[0,1,0,0]},{"index":3,"frame":0,"position":[0,1,0]},{"index":4,"frame":0,"position":[-0.8,1.5,0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]},{"index":5,"frame":0,"position":[-0.8,1.5,-0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]},{"index":6,"frame":0,"position":[0.8,1.5,0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]},{"index":7,"frame":0,"position":[0.8,1.5,-0.8],"scale":[1,0.5,1],"rotation":[1,0,0,0]}],"open":[{"index":1,"frame":0,"position":[0,-0.4,0],"scale":[1,1,1]},{"index":1,"frame":0.5,"position":[0,3.2,0],"ease":"quadOut"},{"index":1,"frame":1,"position":[0,2,0],"ease":"cubicIn"},{"index":2,"frame":0,"position":[0,0,0],"rotation":[0,1,0,0]},{"index":2,"frame":1,"position":[0,-1.2,0],"rotation":[0,0,0,1],"ease":"linear"},{"index":3,"frame":0.25,"position":[0,1,0]},{"index":3,"frame":0.75,"position":[0,2,0],"ease":"quadOut"},{"index":4,"frame":0,"position":[0.8,-0.25,-0.8],"rotation":[0,0.707107,0,-0.707107],"scale":[1,1,1]},{"index":4,"frame":0.6,"position":[0.4,3.2,-0.4],"ease":"sineInOut"},{"index":4,"frame":0.8,"rotation":[1,0,0,0],"ease":"quadInOut"},{"index":4,"frame":0.95,"position":[0.6,2.2,-0.6],"ease":"quadIn"},{"index":5,"frame":0,"position":[0.8,-0.25,0.8],"rotation":[0,0.707107,0,0.707107],"scale":[1,1,1]},{"index":5,"frame":0.6,"position":[0.4,3.2,0.4],"ease":"sineInOut"},{"index":5,"frame":0.8,"rotation":[1,0,0,0],"ease":"quadInOut"},{"index":5,"frame":0.95,"position":[0.6,2.2,0.6],"ease":"quadIn"},{"index":6,"frame":0,"position":[-0.8,-0.25,-0.8],"rotation":[0,-0.707107,0,-0.707107],"scale":[1,1,1]},{"index":6,"frame":0.6,"position":[-0.4,3.2,-0.4],"ease":"sineInOut"},{"index":6,"frame":0.8,"rotation":[1,0,0,0],"ease":"quadInOut"},{"index":6,"frame":0.95,"position":[-0.6,2.2,-0.6],"ease":"quadIn"},{"index":7,"frame":0,"position":[-0.8,-0.25,0.8],"rotation":[0,-0.707107,0,0.707107],"scale":[1,1,1]},{"index":7,"frame":0.6,"position":[-0.4,3.2,0.4],"ease":"sineInOut"},{"index":7,"frame":0.8,"rotation":[1,0,0,0],"ease":"quadInOut"},{"index":7,"frame":0.95,"position":[-0.6,2.2,0.6],"ease":"quadIn"}],"loop":[{"index":1,"frame":0,"position":[0,2,0],"rotation":[0,0,0,1]},{"index":1,"frame":0.5,"position":[0,1.8,0],"rotation":[0,1,0,0],"ease":"linear"},{"index":1,"frame":1,"position":[0,2,0],"rotation":[0,0,0,-1],"ease":"linear"},{"index":3,"frame":0,"position":[0,2,0],"rotation":[0,0,0,1]},{"index":3,"frame":0.5,"position":[0,2.3,0],"rotation":[0,-1,0,0],"ease":"linear"},{"index":3,"frame":1,"position":[0,2,0],"rotation":[0,0,0,-1],"ease":"linear"}]},"cube_8":{"close":[{"index":1,"frame":0,"position":[0,1,0],"rotation":[0,0,0,1]},{"index":2,"frame":0,"position":[0,0,0.8],"rotation":[-0.707107,0,0,0.707107]},{"index":3,"frame":0,"position":[0,1,-0.3]},{"index":4,"frame":0,"position":[0,0,-0.8],"rotation":[0,0.707107,0.707107,0]},{"index":5,"frame":0,"position":[0,1,-0.3]},{"index":6,"frame":0,"position":[0,0.5,0],"rotation":[-0.707107,0,-0.707107,0]}],"open":[{"index":1,"frame":0,"position":[0,1,0]},{"index":1,"frame":1,"position":[0,2.8,0],"ease":"cubicOut"},{"index":2,"frame":0,"position":[0,0,0.8],"rotation":[-0.707107,0,0,0.707107]},{"index":2,"frame":0.5,"position":[0,0,-1],"rotation":[-0.707107,0,0,0.707107],"ease":"quadOut"},{"index":2,"frame":1,"position":[0,0,-0.6],"rotation":[-0.5,0.5,-0.5,0.5],"ease":"sineInOut"},{"index":3,"frame":0.5,"position":[0,1.1,-0.3]},{"index":3,"frame":1,"position":[0,1.1,0.6],"ease":"quadIn"},{"index":4,"frame":0,"position":[0,0,-0.8],"rotation":[0,0.707107,0.707107,0]},{"index":4,"frame":0.5,"position":[0,0,1],"rotation":[0,0.707107,0.707107,0],"ease":"quadOut"},{"index":4,"frame":1,"position":[0,0,0.6],"rotation":[0.5,0.5,0.5,0.5],"ease":"sineInOut"},{"index":5,"frame":0.5,"position":[0,1.1,-0.3]},{"index":5,"frame":1,"position":[0,1.1,0.6],"ease":"quadIn"},{"index":6,"frame":0,"position":[0,0,0],"rotation":[-0.707107,0,-0.707107,0]},{"index":6,"frame":1,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quadIn"}],"activate":[{"index":1,"frame":0.8,"position":[0,2.8,0]},{"index":1,"frame":1,"position":[0,2.6,0],"ease":"quadOut"},{"index":1,"frame":1.8,"position":[0,2.8,0],"ease":"sineIn"},{"index":2,"frame":0,"position":[0,0,-0.6],"rotation":[-0.5,0.5,-0.5,0.5]},{"index":2,"frame":0.8,"position":[0,0,-1],"rotation":[-0.653281,0.270598,-0.270598,0.653281],"ease":"cubicInOut"},{"index":2,"frame":1.2,"rotation":[-0.683013,0.183013,-0.183013,0.683013],"ease":"quadOut"},{"index":2,"frame":2,"position":[0,0,-0.6],"rotation":[-0.5,0.5,-0.5,0.5],"ease":"sineInOut"},{"index":3,"frame":0,"position":[0,1.1,0.6]},{"index":3,"frame":0.6,"position":[0,1.1,1.4],"ease":"quadInOut"},{"index":3,"frame":0.8,"position":[0,1.1,0],"ease":"cubicIn"},{"index":3,"frame":1.8,"position":[0,1.1,0.6],"ease":"quadOut"},{"index":4,"frame":0,"position":[0,0,0.6],"rotation":[0.5,0.5,0.5,0.5]},{"index":4,"frame":0.8,"position":[0,0,1],"rotation":[0.270598,0.653281,0.653281,0.270598],"ease":"cubicInOut"},{"index":4,"frame":1.2,"rotation":[0.183013,0.683013,0.683013,0.183013],"ease":"quadOut"},{"index":4,"frame":2,"position":[0,0,0.6],"rotation":[0.5,0.5,0.5,0.5],"ease":"sineInOut"},{"index":5,"frame":0,"position":[0,1.1,0.6]},{"index":5,"frame":0.6,"position":[0,1.1,1.4],"ease":"quadInOut"},{"index":5,"frame":0.8,"position":[0,1.1,0],"ease":"cubicIn"},{"index":5,"frame":1.8,"position":[0,1.1,0.6],"ease":"quadOut"},{"index":6,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":6,"frame":0.8,"rotation":[-0.630037,-0.32102,-0.630037,0.32102],"ease":"quadInOut"},{"index":6,"frame":1.2,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quartOut"}]},"scarab":{"activate":[{"index":0,"frame":0,"position":[0,0.5,0],"rotation":[0,-0.707107,0,0.707107]},{"index":1,"frame":0.1,"scale":[0.8,0.5,0.8]},{"index":1,"frame":0.3,"scale":[1,0.8,1],"position":[-0.6,0.5,0],"rotation":[0,0,-0.707107,0.707107],"ease":"quartOut"},{"index":1,"frame":0.8,"scale":[1,1,1],"position":[0,0.5,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"expoOut"},{"index":1,"frame":1,"scale":[0.8,0.5,0.8],"position":[-0.6,0.5,0],"ease":"quadIn"},{"index":2,"frame":0,"position":[0,0.5,0.1]},{"index":2,"frame":0.4,"position":[0.1,0.5,-0.3],"ease":"cubicInOut"},{"index":2,"frame":0.7,"position":[0,0.5,-0.2],"ease":"quadOut"},{"index":2,"frame":1,"position":[0,0.5,0.1],"ease":"cubicIn"},{"index":3,"frame":0,"position":[0,0.5,-0.1]},{"index":3,"frame":0.4,"position":[0.1,0.5,0.3],"ease":"cubicInOut"},{"index":3,"frame":0.7,"position":[0,0.5,0.2],"ease":"quadOut"},{"index":3,"frame":1,"position":[0,0.5,-0.1],"ease":"cubicIn"}]},"tarantula":{"activate":[{"index":0,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":9,"frame":0,"scale":[0,0,0]},{"index":11,"frame":0,"position":[0,1.1,0],"scale":[1,1,1]},{"index":12,"frame":0,"position":[0,0,0],"rotation":[0,0,0,1]},{"index":11,"frame":0.6,"position":[0,1.4,0],"ease":"quadInOut"},{"index":11,"frame":0.8,"position":[0,0.8,0],"ease":"cubicIn"},{"index":11,"frame":1.6,"position":[0,1.1,0],"ease":"quadOut"},{"index":12,"frame":0.6,"position":[0,1.2,0],"rotation":[0,-1,0,0],"ease":"sineInOut"},{"index":12,"frame":0.8,"position":[0,-0.5,0],"rotation":[0,1,0,0],"ease":"quadIn"},{"index":12,"frame":1.6,"position":[0,0,0],"rotation":[0,0,0,1],"ease":"cubicOut"}],"activateVariant":[{"index":0,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":11,"frame":0,"scale":[0,0,0]},{"index":9,"frame":0,"scale":[1,1,1],"position":[0,1.1,0]},{"index":10,"frame":0,"position":[-0.2,0.7,0]},{"index":9,"frame":0.6,"position":[0.4,1.1,0],"ease":"sineInOut"},{"index":9,"frame":0.9,"position":[-0.2,1.1,0],"ease":"cubicIn"},{"index":9,"frame":1.2,"position":[0,1.1,0],"ease":"quadOut"},{"index":10,"frame":0.6,"position":[0.4,0.7,0],"ease":"quadInOut"},{"index":10,"frame":0.8,"position":[-0.8,0.7,0],"ease":"quadIn"},{"index":10,"frame":1.4,"position":[-0.2,0.7,0],"ease":"cubicOut"}]},"stingray":{"activate":[{"index":0,"frame":0,"rotation":[0,0.707107,0.707107,0],"position":[0,1.3,0]},{"index":0,"frame":0.6,"position":[0,1.7,-0.8],"rotation":[0,0.55557,0.83147,0],"ease":"quadInOut"},{"index":0,"frame":0.8,"position":[0,1.2,0.4],"rotation":[0,0.707107,0.707107,0],"ease":"cubicIn"},{"index":0,"frame":1.6,"position":[0,1.3,0],"ease":"quadOut"},{"index":1,"frame":0.6,"position":[-0.5,-1,0],"rotation":[0,0,0,1]},{"index":6,"frame":0.6,"position":[0.5,-1,0],"rotation":[0,0,0,1]},{"index":1,"frame":0.8,"position":[-0.5,1,0],"rotation":[0,1,0,0],"ease":"quartIn"},{"index":6,"frame":0.8,"position":[0.5,1,0],"rotation":[0,-1,0,0],"ease":"quartIn"},{"index":1,"frame":2,"position":[-0.5,-1,0],"rotation":[0,0,0,1],"ease":"sineOut"},{"index":6,"frame":2,"position":[0.5,-1,0],"rotation":[0,0,0,1],"ease":"sineOut"}]},"locust":{"activate":[{"index":0,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":1,"frame":0.4,"position":[-1.3,0.3,0]},{"index":2,"frame":0,"position":[0,-0.5,0],"rotation":[0,0,0,1]},{"index":3,"frame":0,"position":[-0.5,1.4,0]},{"index":1,"frame":0.8,"position":[-1.3,0.7,0],"ease":"quadOut"},{"index":2,"frame":0.6,"rotation":[0,-1,0,0],"ease":"quadIn"},{"index":2,"frame":1.2,"rotation":[0,0,0,-1],"ease":"CubicBezier,0.25,0.5,0.5,0.75"},{"index":2,"frame":1.8,"rotation":[0,-0.707107,0,0.707107],"ease":"linear"},{"index":2,"frame":0.6,"position":[0,2,0],"ease":"cubicInOut"},{"index":2,"frame":1,"position":[0,1,0],"ease":"sineInOut"}],"deactivate":[{"index":2,"frame":0,"rotation":[0,0,0,1],"position":[0,1,0],"ease":"linear"},{"index":2,"frame":1,"position":[0,-0.5,0],"ease":"quadInOut"},{"index":1,"frame":0,"position":[-1.3,0.7,0]},{"index":1,"frame":0.6,"position":[-1.3,0.3,0],"ease":"quadIn"}],"activateVariant":[{"index":4,"frame":0,"rotation":[0,0,0,1]},{"index":5,"frame":0,"rotation":[0,0,0,1]},{"index":4,"frame":0.8,"rotation":[0,-0.707107,0,0.707107],"ease":"CubicBezier,0.75,0.0,0.25,1.25"},{"index":5,"frame":0.8,"rotation":[0,0.707107,0,0.707107],"ease":"CubicBezier,0.75,0.0,0.25,1.25"},{"index":4,"frame":1.6,"rotation":[0,0,0,1],"ease":"quartIn"},{"index":5,"frame":1.6,"rotation":[0,0,0,1],"ease":"quartIn"},{"index":3,"frame":0.3,"position":[-0.5,1.4,0]},{"index":3,"frame":0.7,"position":[1.5,1.4,0],"ease":"cubicOut"},{"index":3,"frame":1,"position":[1,1.4,0],"ease":"sineInOut"},{"index":3,"frame":1.6,"position":[-0.5,1.4,0],"ease":"cubicIn"}]},"obelisk":{"activate":[{"index":0,"frame":0,"position":[0,0,0]},{"index":1,"frame":0,"position":[0,1,-0.612],"rotation":[0,0,0,1]},{"index":2,"frame":0,"position":[0,1,0.612],"rotation":[0,1,0,0]},{"index":3,"frame":0,"position":[0.612,1,0],"rotation":[0,-0.707107,0,0.707107]},{"index":4,"frame":0,"position":[-0.612,1,0],"rotation":[0,0.707107,0,0.707107]},{"index":0,"frame":0.56,"position":[0,-2,0],"ease":"cubicIn"},{"index":0,"frame":1.2,"position":[0,-1,0],"ease":"cubicOut"},{"index":1,"frame":0.8,"position":[0,0,-0.5],"rotation":[-0.707107,0,0,0.707107],"ease":"bounceIn,0.04,0.7"},{"index":2,"frame":0.8,"position":[0,0,0.5],"rotation":[0,0.707107,0.707107,0],"ease":"bounceIn,0.04,0.7"},{"index":3,"frame":0.8,"position":[0.5,0,0],"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"bounceIn,0.04,0.7"},{"index":4,"frame":0.8,"position":[-0.5,0,0],"rotation":[-0.5,0.5,0.5,0.5],"ease":"bounceIn,0.04,0.7"}],"deactivate":[{"index":0,"frame":0.6,"position":[0,-1,0]},{"index":1,"frame":0.2,"position":[0,0,-0.5],"rotation":[-0.707107,0,0,0.707107]},{"index":2,"frame":0.2,"position":[0,0,0.5],"rotation":[0,0.707107,0.707107,0]},{"index":3,"frame":0.2,"position":[0.5,0,0],"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":4,"frame":0.2,"position":[-0.5,0,0],"rotation":[-0.5,0.5,0.5,0.5]},{"index":0,"frame":1,"position":[0,0,0],"ease":"quartIn"},{"index":1,"frame":1,"position":[0,1,-0.612],"rotation":[0,0,0,1],"ease":"quadIn"},{"index":2,"frame":1,"position":[0,1,0.612],"rotation":[0,1,0,0],"ease":"quadIn"},{"index":3,"frame":1,"position":[0.612,1,0],"rotation":[0,-0.707107,0,0.707107],"ease":"quadIn"},{"index":4,"frame":1,"position":[-0.612,1,0],"rotation":[0,0.707107,0,0.707107],"ease":"quadIn"}]},"monolith":{"activate":[{"index":1,"frame":0,"rotation":[0,0,0,1]},{"index":2,"frame":0,"rotation":[0,1,0,0]},{"index":3,"frame":0,"rotation":[0,0.707107,0,0.707107]},{"index":4,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":5,"frame":0.2,"position":[0,0,0],"rotation":[0,0,0,-1]},{"index":10,"frame":0,"rotation":[0,0.92388,0,0.382683]},{"index":12,"frame":0,"rotation":[0,0.382683,0,0.92388]},{"index":14,"frame":0,"rotation":[0,0.382683,0,-0.92388]},{"index":16,"frame":0,"rotation":[0,0.92388,0,-0.382683]},{"index":11,"frame":0,"position":[0,0,0.5]},{"index":13,"frame":0,"position":[0,0,0.5]},{"index":15,"frame":0,"position":[0,0,0.5]},{"index":17,"frame":0,"position":[0,0,0.5]},{"index":1,"frame":1.4,"rotation":[-0.707107,0,0,0.707107],"ease":"quadInOut"},{"index":2,"frame":1.4,"rotation":[0,0.707107,0.707107,0],"ease":"quadInOut"},{"index":3,"frame":1.4,"rotation":[-0.5,0.5,0.5,0.5],"ease":"quadInOut"},{"index":4,"frame":1.4,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quadInOut"},{"index":5,"frame":1.4,"position":[0,3.5,0],"ease":"CubicBezier,0.25,1.5,0.5,1.0"},{"index":5,"frame":0.8,"rotation":[0,1,0,0],"ease":"cubicIn"},{"index":5,"frame":1.6,"rotation":[0,0,0,1],"ease":"quadOut"},{"index":5,"frame":3,"position":[0,0,0],"rotation":[0,0,0,-1],"ease":"cubicIn"},{"index":1,"frame":3,"rotation":[0,0,0,1],"ease":"quartIn"},{"index":2,"frame":3,"rotation":[0,1,0,0],"ease":"quartIn"},{"index":3,"frame":3,"rotation":[0,0.707107,0,0.707107],"ease":"quartIn"},{"index":4,"frame":3,"rotation":[0,-0.707107,0,0.707107],"ease":"quartIn"}],"turret11":[{"index":11,"frame":0,"position":[0,0,0.5]},{"index":11,"frame":0.3,"position":[0,0,1],"ease":"quadInOut"},{"index":11,"frame":0.4,"position":[0,0,0.4],"ease":"cubicIn"},{"index":11,"frame":0.8,"position":[0,0,0.5],"ease":"quadOut"}],"turret01":[{"index":13,"frame":0,"position":[0,0,0.5]},{"index":13,"frame":0.3,"position":[0,0,1],"ease":"quadInOut"},{"index":13,"frame":0.4,"position":[0,0,0.4],"ease":"cubicIn"},{"index":13,"frame":0.8,"position":[0,0,0.5],"ease":"quadOut"}],"turret00":[{"index":15,"frame":0,"position":[0,0,0.5]},{"index":15,"frame":0.3,"position":[0,0,1],"ease":"quadInOut"},{"index":15,"frame":0.4,"position":[0,0,0.4],"ease":"cubicIn"},{"index":15,"frame":0.8,"position":[0,0,0.5],"ease":"quadOut"}],"turret10":[{"index":17,"frame":0,"position":[0,0,0.5]},{"index":17,"frame":0.3,"position":[0,0,1],"ease":"quadInOut"},{"index":17,"frame":0.4,"position":[0,0,0.4],"ease":"cubicIn"},{"index":17,"frame":0.8,"position":[0,0,0.5],"ease":"quadOut"}],"spawner6":[{"index":6,"frame":0,"rotation":[-0.5,-0.5,-0.5,0.5]},{"index":6,"frame":0.5,"rotation":[0,-0.707107,0,0.707107],"ease":"quadInOut"},{"index":6,"frame":1.4,"rotation":[-0.5,-0.5,-0.5,0.5],"ease":"quintIn"}],"spawner7":[{"index":7,"frame":0,"rotation":[-0.707107,0,0,0.707107]},{"index":7,"frame":0.5,"rotation":[0,0,0,1],"ease":"quadInOut"},{"index":7,"frame":1.4,"rotation":[-0.707107,0,0,0.707107],"ease":"quintIn"}],"spawner8":[{"index":8,"frame":0,"rotation":[0,0.707107,0.707107,0]},{"index":8,"frame":0.5,"rotation":[0,1,0,0],"ease":"quadInOut"},{"index":8,"frame":1.4,"rotation":[0,0.707107,0.707107,0],"ease":"quintIn"}],"spawner9":[{"index":9,"frame":0,"rotation":[-0.5,0.5,0.5,0.5]},{"index":9,"frame":0.5,"rotation":[0,0.707107,0,0.707107],"ease":"quadInOut"},{"index":9,"frame":1.4,"rotation":[-0.5,0.5,0.5,0.5],"ease":"quintIn"}]},"decapod":{"activate":[{"index":0,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":1,"frame":0,"position":[0,0.7,-0.1]},{"index":2,"frame":0,"position":[0,0.7,0.1]},{"index":3,"frame":0,"scale":[1,0,0],"rotation":[0,0,0.707107,0.707107]},{"index":4,"frame":0,"position":[0,-0.2,0]},{"index":1,"frame":0.3,"position":[0,0.7,-0.7],"ease":"quadOut"},{"index":2,"frame":0.3,"position":[0,0.7,0.7],"ease":"quadOut"},{"index":1,"frame":0.6,"position":[0,0.7,-0.5],"ease":"quadIn"},{"index":2,"frame":0.6,"position":[0,0.7,0.5],"ease":"quadIn"},{"index":3,"frame":0.4,"scale":[1,1,1],"rotation":[0,0,0,1],"ease":"cubicOut"},{"index":3,"frame":0.8,"rotation":[0,0,-0.309017,0.951057],"ease":"sineIn"},{"index":4,"frame":0.5,"position":[0,0.5,0],"rotation":[0,1,0,0],"ease":"sineIn"},{"index":4,"frame":1,"position":[0,0,0],"rotation":[0,0,0,1],"ease":"sineOut"}],"deactivate":[{"index":4,"frame":0,"position":[0,0,0],"rotation":[0,0,0,1]},{"index":4,"frame":0.5,"position":[0,1,0],"rotation":[0,-1,0,0],"ease":"sineInOut"},{"index":4,"frame":0.7,"position":[0,-1,0],"rotation":[0,-1,0,0],"ease":"cubicIn"},{"index":4,"frame":1.2,"position":[0,0.2,0],"rotation":[0,0,0,-1],"ease":"quadOut"},{"index":4,"frame":1.6,"position":[0,-0.2,0],"ease":"cubicIn"},{"index":3,"frame":0.7,"rotation":[0,0,-0.309017,0.951057],"position":[0,1.8,0]},{"index":3,"frame":1.2,"rotation":[0,0,-0.156434,0.987688],"scale":[1,1,1],"position":[0,1.6,0],"ease":"cubicOut"},{"index":3,"frame":1.5,"rotation":[0,0,0.707107,0.707107],"ease":"sineIn"},{"index":3,"frame":1.6,"scale":[1,0,0],"position":[0,1.8,0],"ease":"quintIn"},{"index":1,"frame":0.7,"position":[0,0.7,-0.5]},{"index":2,"frame":0.7,"position":[0,0.7,0.5]},{"index":1,"frame":1.2,"position":[0,0.5,-0.7],"ease":"quadOut"},{"index":2,"frame":1.2,"position":[0,0.5,0.7],"ease":"quadOut"},{"index":1,"frame":1.6,"position":[0,0.7,-0.1],"ease":"sineIn"},{"index":2,"frame":1.6,"position":[0,0.7,0.1],"ease":"sineIn"}]},"isopod":{"activate":[{"index":0,"frame":0,"rotation":[0,-0.707107,0,0.707107]},{"index":1,"frame":0,"rotation":[0,0.382683,0,0.92388],"position":[0,0,0]},{"index":2,"frame":0,"position":[0,-0.5,0]},{"index":3,"frame":0.2,"position":[0,-1,0],"rotation":[0,0,0,1]},{"index":1,"frame":0.6,"rotation":[-0.146447,0.353553,0.353553,0.853554],"position":[-0.2,1.1,0],"ease":"quadInOut"},{"index":1,"frame":1.8,"rotation":[0,0.382683,0,0.92388],"position":[0,0,0],"ease":"quartIn"},{"index":2,"frame":0.6,"position":[0.5,0.7,0],"ease":"quadInOut"},{"index":2,"frame":1.2,"position":[-0.2,0.7,0],"ease":"cubicInOut"},{"index":2,"frame":1.6,"position":[0,-0.5,0],"ease":"quadIn"},{"index":3,"frame":0.6,"position":[0,1.4,0],"rotation":[0,-1,0,0],"ease":"sineOut"},{"index":3,"frame":1.2,"position":[0,0.5,0],"rotation":[0,0,0,-1],"ease":"cubicInOut"},{"index":3,"frame":1.6,"position":[0,-1,0],"ease":"sineIn"}]}}')},9026:function(e,t){"use strict";var r=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationSystem=t.ActionSignal=void 0,t.ActionSignal={WaitNextFrame:{continue:!0}};var i=function(){function e(e){this.context=e,this.index=1,this.pending=[],this.queue=[]}return e.zip=function(e){var t,i,a;return r(this,(function(r){switch(r.label){case 0:for(t=null,i=e.length-1;i>=0;i--)(a=e[i].next()).done||(t=a.value);return t?[3,1]:[3,4];case 1:return[4,t];case 2:r.sent(),r.label=3;case 3:return[3,0];case 4:return[2]}}))},e.join=function(e){var t,i,a;return r(this,(function(r){switch(r.label){case 0:t=0,r.label=1;case 1:if(!(t<e.length))return[3,7];i=e[t],r.label=2;case 2:return(a=i.next()).done?[3,6]:[3,3];case 3:return[4,a.value];case 4:r.sent(),r.label=5;case 5:return[3,2];case 6:return t++,[3,1];case 7:return[2]}}))},e.prototype.indexOf=function(e){for(var t=0;t<this.queue.length;t++){if(this.queue[t].index>e)return-1;if(this.queue[t].index===e)return t}return-1},e.prototype.await=function(e){if(null==e||-1==this.indexOf(e))return t.ActionSignal.WaitNextFrame;var r={target:e,continue:!1};return this.pending.push(r),r},e.prototype.stop=function(e,t){var r=this.indexOf(e);if(-1!=r){var i=this.queue[r];if(t)for(;!i.iterator.done;)i.iterator=i.generator.next();else i.iterator=i.generator.return(null)}},e.prototype.dispatch=function(e){for(var t=0,r=0;r<this.pending.length;r++)this.pending[r].target===e?(this.pending[r].continue=!0,t++):this.pending[r-t]=this.pending[r];this.pending.length-=t},e.prototype.update=function(){for(var e=0,r=0;r<this.queue.length;r++){var i=this.queue[r];i.iterator&&(i.iterator.done||i.iterator.value!==t.ActionSignal.WaitNextFrame&&!i.iterator.value.continue)||(i.iterator=i.generator.next()),i.iterator.done&&this.dispatch(i.index),i.iterator.done?e++:this.queue[r-e]=i}this.queue.length-=e},e.prototype.start=function(e,t){var r={generator:e,iterator:null,index:this.index};if(t||!(r.iterator=r.generator.next()).done)return this.queue.push(r),this.index++},e}();t.AnimationSystem=i},6702:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.FollowPath=void 0;var o=r(4454),s=n(r(6215));function c(e){var t=o.vec3(),r=o.vec3();return function(i,a,n){e(i,t),o.vec3.subtract(t,n.position,r);var s=o.vec3.magnitudeSquared(r);s>0&&(o.vec3.scale(r,1/Math.sqrt(s),r),o.quat.fromNormal(r,o.vec3.AXIS_Y,n.rotation),o.quat.normalize(n.rotation,n.rotation)),o.vec3.copy(t,n.position),n.frame=0}}t.FollowPath=c,c.Line=function(e,t){return function(r,i,a){for(var n=a.path.length-1;n>=0;n--)e(r-n*t.length,a.path[n]);a.frame=0}},c.separate=function(e,t,r){return function(i,a){return a[0]=e(i,a[0]),a[1]=t(i,a[1]),a[2]=r(i,a[2]),a}},c.curve=function(e,t){return function(r,i){return r=o.clamp((r-t.frame)/t.duration,0,1),e(t.ease(r),i)}},c.spline=function(e,t,r){var i=t[0],a=t[t.length-1]-i,n=t.map((function(e){return(e-i)/a})),c=s.Spline(e.map((function(e){return e[0]})),n,3,r.tension),l=s.Spline(e.map((function(e){return e[1]})),n,3,r.tension),u=s.Spline(e.map((function(e){return e[2]})),n,3,r.tension);return function(e,t){var n=r.ease(o.clamp((e-i)/a,0,1));return o.vec3.set(c(n),l(n),u(n),t),t}}},9485:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BlendTween=t.parseEase=t.AnimationTimeline=t.EventTrigger=t.PropertyAnimation=void 0;var o=r(4454),s=n(r(6215));t.PropertyAnimation=function(e,t,r){void 0===r&&(r=1),e.sort((function(e,t){return e.frame-t.frame}));var i=e.length-1,a=0;return function(n,c){for(n*=r;;)if(a>0&&e[a].frame>n)a--;else{if(!(a<i&&e[a+1].frame<n))break;a++}var l=e[a];if(0===a&&l.frame>n)return t(c,l.value,1,c);if(a===i)return t(c,l.value,1,c);var u=e[a+1],f=o.clamp((n-l.frame)/(u.frame-l.frame),0,1);return t(l.value,u.value,(u.ease||s.linear)(f),c)}},t.EventTrigger=function(e,t){return function(r,i,a){for(var n=r-i,o=e.length,s=0;s<o&&!(e[s].frame>r);s++)e[s].frame>n&&t.call(this,a,e[s].value)}},t.EventTrigger.emit=function(e,t){return e.count+=t},t.EventTrigger.emitReset=function(e,t){for(var r in t)r in e.uniform.uniforms&&e.uniform.uniforms[r].set(t[r],0);e.count+=t.amount},t.AnimationTimeline=function(e,t){var r=Object.keys(t).map((function(r){for(var i=r.split(".").reverse(),a=e,n=i.length-1;n>0;n--)a=a[i[n]];return{sampler:t[r],property:i[0],target:a}}));return function(t,i){for(var a=r.length-1;a>=0;a--){var n=r[a],o=n.sampler,s=n.property,c=n.target;3===o.length?o.call(e,t,i,c[s]):c[s]=o.call(e,t,c[s]),isNaN(c.frame)||(c.frame=0)}}},t.parseEase=function(e){if(e){var t=e.split(","),r=t[0],i=t.slice(1);return i.length?s[r].apply(s,i.map(Number)):s[r]}},t.BlendTween={temp:o.quat(),vec3:function(e,t,r,i){return i[0]+=e[0]+r*(t[0]-e[0]),i[1]+=e[1]+r*(t[1]-e[1]),i[2]+=e[2]+r*(t[2]-e[2]),i},quat:function(e,r,i,a){return o.quat.slerp(e,r,i,t.BlendTween.temp),o.quat.multiply(a,t.BlendTween.temp,a),a}}},6215:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spline=t.velocity=t.slowInOut=t.expoInOut=t.expoOut=t.expoIn=t.circInOut=t.circOut=t.circIn=t.sineInOut=t.sineIn=t.sineOut=t.quintInOut=t.quartInOut=t.cubicInOut=t.quadInOut=t.quintOut=t.quartOut=t.cubicOut=t.quadOut=t.quintIn=t.quartIn=t.cubicIn=t.quadIn=t.cubicFadeInOut=t.fadeInOut=t.elasticOut=t.bounceIn=t.linear=t.stepped=t.CubicBezier=t.reverse=t.flip=t.join=t.split=void 0;var i=r(3297);function a(e,t,r,i,a){void 0===a&&(a=1e-5);var n=3*e,o=3*(r-e)-n,s=1-n-o,c=3*t,l=3*(i-t)-c,u=1-c-l,f=function(e){return((s*e+o)*e+n)*e},h=function(e){return(3*s*e+2*o)*e+n};return function(e){return t=function(e){if(e<0)return 0;if(e>1)return 1;for(var t=e,r=0;r<8;r++){var i=f(t)-e;if(Math.abs(i)<a)return t;var n=h(t);if(Math.abs(n)<a)break;t-=i/n}for(var o=0,s=1;o<s;){if(i=f(t),Math.abs(i-e)<a)return t;e>i?o=t:s=t,t=.5*(o+s)}return t}(e),((u*t+l)*t+c)*t;var t}}t.split=function(e,t,r){return function(i){return i<e?e*t(i/e):e+(1-e)*r((i-e)/(1-e))}},t.join=function(e,t,r){return function(i){return i<e?t(i/e):r((i-e)/(1-e))}},t.flip=function(e){return function(t){return 1-e(1-t)}},t.reverse=function(e){return function(t){return 1-e(t)}},t.CubicBezier=a,t.stepped=function(e){return e>=1?1:0},t.linear=function(e){return e},t.bounceIn=function(e,t){var r=1/(t*t),i=1/(1-t);return function(a){return a>=1?1:a<t?r*a*a:1-e*(1-Math.pow(i*(2*a-1-t),2))}},t.elasticOut=function(e,t){t/=Math.min(1,e),e=Math.max(1,e);var r=t/(2*Math.PI)*Math.asin(1/e)||0,i=2*Math.PI/t;return function(t){return e*Math.pow(2,-10*t)*Math.sin((t-r)*i)+1}},t.fadeInOut=function(e){return 4*(1-e)*e};var n=1/(Math.pow(1-1/3,2)*(1/3));t.cubicFadeInOut=function(e){return n*Math.pow(1-e,2)*e},t.quadIn=function(e){return e*e},t.cubicIn=function(e){return e*e*e},t.quartIn=function(e){return e*e*e*e},t.quintIn=function(e){return e*e*e*e*e},t.quadOut=t.flip(t.quadIn),t.cubicOut=t.flip(t.cubicIn),t.quartOut=t.flip(t.quartIn),t.quintOut=t.flip(t.quintIn),t.quadInOut=t.split(.5,t.quadIn,t.quadOut),t.cubicInOut=t.split(.5,t.cubicIn,t.cubicOut),t.quartInOut=t.split(.5,t.quartIn,t.quartOut),t.quintInOut=t.split(.5,t.quintIn,t.quintOut),t.sineOut=function(e){return Math.sin(.5*e*Math.PI)},t.sineIn=t.flip(t.sineOut),t.sineInOut=t.split(.5,t.sineIn,t.sineOut),t.circIn=function(e){return 1-Math.sqrt(1-e*e)},t.circOut=t.flip(t.circIn),t.circInOut=t.split(.5,t.circIn,t.circOut),t.expoIn=function(e){return 0==e?0:Math.pow(1024,e-1)},t.expoOut=t.flip(t.expoIn),t.expoInOut=t.split(.5,t.expoIn,t.expoOut),t.slowInOut=a(0,.5,1,.5),t.velocity=function(e,t,r){var i=(t-e)/r,a=r*(e+.5*(t-e));return function(n){return n<=r?e*n+n*n*.5*i:t*n+a}},t.velocity.duration=function(e,t,r){return r/(e+.5*(t-e))},t.Spline=function(e,t,r,a){void 0===a&&(a=.5);var n=function(e,t){return e-t},o=e.length-1;t=t||e.map((function(e,t){return t/o}));var s=1/0,c=-1/0,l=0,u=0,f=0,h=0,m=0;return function(d){if(d<=t[0])return e[0];if(d>=t[o])return e[o];if(d<s||d>=c){var p=i.binarySearch(t,d,n)-1;s=t[p],c=t[p+1],l=s===c?0:1/(c-s),u=e[p],f=e[p+1];var v=0===p?2*t[0]-t[1]:t[p-1],y=p===o-1?2*t[p+1]-t[p]:t[p+2],g=0===p?2*e[0]-e[1]:e[p-1],x=p===o-1?2*e[p+1]-e[p]:e[p+2];h=a*(c===v?0:2*(c-s)/(c-v))*(f-g),m=a*(y===s?0:2*(c-s)/(y-s))*(x-u)}var b=l*(d-s);if(0===r)return u;if(1===r)return u+b*(f-u);if(2===r)return u+b*b*(3-2*b)*(f-u);var S=b*b,P=b+b,O=1-b,T=O*O;return u*((1+P)*T)+h*(b*T)+f*(S*(3-P))+m*(S*(b-1))}}},6725:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t},o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.ease=void 0,t.ease=n(r(6215)),o(r(9026),t),o(r(9485),t),o(r(6702),t)},6815:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioSystem=void 0;var i=r(9336),a=r(2129),n=r(4288),o=r(9177),s=r(901),c=function(){function e(e){var t=this;this.context=e,this.list=[],this.clips=Object.create(null),this.audio=new AudioContext,this.listener=new a.ListenerTransform(this.audio),this.mixer=new o.AudioMixer(this.audio),document.addEventListener("visibilitychange",(function(){return document.hidden?t.audio.suspend():t.audio.resume()}))}return e.prototype.update=function(){1===this.context.frame&&this.audio.resume(),this.listener.update(this.context.get(i.CameraSystem).camera,this.context.frame);for(var e=this.list.length-1;e>=0;e--)this.list[e].update(this.context.frame)},e.prototype.create=function(e,t,r){if(this.clips[e]){var i=n.AudioSource.pool.pop()||new n.AudioSource(this.audio);return i.clip=this.clips[e],r&&(i.transform=a.AudioTransform.pool.pop()||new a.AudioTransform(this.audio,this.list),i.transform.transform=r,this.list.push(i.transform)),i.connect(this.mixer.channel[t].input),i}},e.prototype.load=function(e,t,r){for(var i=this,a=t.buffers[1],n=e.audio.length,o=function(t){var o=e.audio[t],l=a.slice(o.byteOffset,o.byteOffset+o.byteLength);c.audio.decodeAudioData(l,(function(e){var t=/loop\.mp3$/.test(o.key),a=s.trimAudioBuffer(e);i.clips[o.key]={buffer:e,offset:a[0],loop:t?0:-1,duration:a[1]-a[0]},--n<=0&&r()}))},c=this,l=0;l<e.audio.length;l++)o(l);t.buffers[1]=null},e}();t.AudioSystem=c},9177:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioMixer=void 0;var i=r(4454),a=function(){function e(e){this.audio=e,this.gain=this.audio.createGain()}return Object.defineProperty(e.prototype,"input",{get:function(){return this.compressor||this.gain},enumerable:!1,configurable:!0}),e.prototype.createCompressor=function(e){return this.compressor=this.audio.createDynamicsCompressor(),this.compressor.threshold.value=e.threshold,this.compressor.knee.value=e.knee,this.compressor.ratio.value=e.ratio,this.compressor.attack.value=e.attack,this.compressor.release.value=e.release,this},e.prototype.volume=function(e,t){return t=i.clamp(t,this.gain.gain.minValue,this.gain.gain.maxValue),e?this.gain.gain.linearRampToValueAtTime(t,this.audio.currentTime+e):this.gain.gain.setValueAtTime(t,this.audio.currentTime),this},e.prototype.connect=function(e){return this.gain.connect(e),this.compressor?(this.compressor.connect(this.gain),this.compressor):this.gain},e.prototype.delete=function(){this.compressor=void this.compressor.disconnect(),this.gain=void this.gain.disconnect()},e}();t.AudioMixer=function(e){for(var t in this.audio=e,this.channel={music:new a(this.audio).volume(0,.5),sfx:new a(this.audio).volume(0,.5).createCompressor({threshold:-24,knee:30,ratio:12,attack:.003,release:.25})},this.channel)this.channel[t].connect(this.audio.destination)}},4288:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioSource=void 0;var i=r(4454),a=function(){function e(e){var t=this;this.audio=e,this.end=function(e){t.source===e.target&&(t.source=null,t.delete())}}return e.prototype.play=function(e,t){if(void 0===t&&(t=1),this.source)throw new Error("audio.source!=null");this.source=this.audio.createBufferSource(),this.source.buffer=this.clip.buffer,this.source.loop=this.clip.loop>=0,this.source.loopStart=this.clip.offset+this.clip.loop,this.source.loopEnd=this.clip.offset+this.clip.duration,this.source.playbackRate.setValueAtTime(t,this.audio.currentTime),this.source.onended=this.end,this.source.connect(this.gain),this.source.start(this.audio.currentTime+e,this.clip.offset,this.source.loop?void 0:this.clip.duration)},e.prototype.stop=function(e){this.source.stop(this.audio.currentTime+e)},e.prototype.volume=function(e,t){return t=i.clamp(t,this.gain.gain.minValue,this.gain.gain.maxValue),e?this.gain.gain.linearRampToValueAtTime(t,this.audio.currentTime+e):this.gain.gain.setValueAtTime(t,this.audio.currentTime),this},e.prototype.connect=function(e){return this.transform&&(e=this.transform.connect(e)),this.gain=this.audio.createGain(),this.gain.connect(e),this.gain},e.prototype.delete=function(){this.gain.gain.cancelScheduledValues(0),this.transform&&(this.transform=void this.transform.delete()),this.gain=void this.gain.disconnect(),this.source&&(this.source=void this.source.disconnect()),e.pool.push(this)},e.pool=[],e}();t.AudioSource=a},2129:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTransform=t.ListenerTransform=void 0;var i=r(4454),a=function(){function e(e){this.audio=e,this.forward=i.vec3(),this.up=i.vec3(),this.frame=0}return e.prototype.update=function(e,t){if(!(this.frame&&this.frame>=e.frame)){this.frame=t,i.vec3.set(e.viewMatrix[1],e.viewMatrix[5],e.viewMatrix[9],this.up),i.vec3.set(e.viewMatrix[2],e.viewMatrix[6],e.viewMatrix[10],this.forward);var r=this.audio,a=r.currentTime,n=r.listener;n.positionX.setValueAtTime(-e.position[0],a),n.positionY.setValueAtTime(e.position[1],a),n.positionZ.setValueAtTime(e.position[2],a),n.upX.setValueAtTime(this.up[0],a),n.upY.setValueAtTime(this.up[1],a),n.upZ.setValueAtTime(this.up[2],a),n.forwardX.setValueAtTime(this.forward[0],a),n.forwardY.setValueAtTime(this.forward[1],a),n.forwardZ.setValueAtTime(this.forward[2],a)}},e}();t.ListenerTransform=a;var n=function(){function e(e,t){this.audio=e,this.list=t,this.radius=8,this.frame=0,this.position=i.vec3(0,0,0),this.orientation=i.vec3(1,0,0)}return e.prototype.connect=function(e){return this.panner=this.audio.createPanner(),Object.assign(this.panner,{panningModel:"HRTF",distanceModel:"inverse",refDistance:this.radius,maxDistance:1e4,rolloffFactor:1,coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0}),this.panner.connect(e),this.panner},e.prototype.delete=function(){var t=this.list.indexOf(this);t===this.list.length-1?this.list.length--:-1!==t&&(this.list[t]=this.list.pop()),this.panner=void this.panner.disconnect(),this.transform=null,e.pool.push(this)},e.prototype.update=function(e){if(!(this.frame&&this.frame>=this.transform.frame)){this.frame=e;var t=this.panner,r=this.audio.currentTime;i.vec3.set(this.transform.matrix[12],this.transform.matrix[13],this.transform.matrix[14],this.position),t.positionX.setValueAtTime(-this.position[0],r),t.positionY.setValueAtTime(this.position[1],r),t.positionZ.setValueAtTime(this.position[2],r),t.orientationX.setValueAtTime(this.orientation[0],r),t.orientationY.setValueAtTime(this.orientation[1],r),t.orientationZ.setValueAtTime(this.orientation[2],r)}},e.pool=[],e}();t.AudioTransform=n},6365:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(4288),t),a(r(6815),t)},901:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trimAudioBuffer=void 0,t.trimAudioBuffer=function(e){for(var t=e.numberOfChannels,r=e.length,i=e.duration,a=[r,0],n=0;n<t;n++){for(var o=e.getChannelData(n),s=0,c=o.length-1;s<o.length&&0==o[s++];);for(;c>=0&&0==o[c--];);a[0]=Math.min(a[0],s),a[1]=Math.max(a[1],c)}return a[0]*=i/r,a[1]*=i/r,a}},3046:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BatchMesh=void 0;var i=r(4454),a=r(8038),n=function(){function e(e){this.geometry=e,this.index=-1,this.frame=0,this.order=0,this.color=i.vec4(1,1,1,1),this.bounds=new a.BoundingVolume,this.indices=e.indexArray;var t=e.vertexArray.byteLength/e.format[1].stride;this.vertices=new Float32Array(3*t),this.uvs=new Float32Array(2*t),this.normals=new Float32Array(3*t),this.boundingRadius=a.calculateBoundingRadius(e.vertexArray,e.format[1].stride/Float32Array.BYTES_PER_ELEMENT,e.format[1].offset/Float32Array.BYTES_PER_ELEMENT)}return e.create=function(t,r,a){null==t.index&&(t.index=this.pool.push([])-1);var n=this.pool[t.index].pop()||new e(t);return n.order=r||0,i.vec4.copy(a||i.vec4.ONE,n.color),n},e.delete=function(e){this.pool[e.geometry.index].push(e),e.frame=0,e.index=-1,e.material=e.transform=null},e.prototype.update=function(e,t){if(!(this.frame>0&&this.frame>=this.transform.frame)){this.frame=e.frame;for(var r=this.geometry.vertexArray,i=this.vertices.length/3,a=this.transform.matrix,n=this.transform.calculateNormalMatrix(),o=i-1;o>=0;o--){var s=r[8*o+0],c=r[8*o+1],l=r[8*o+2];if(this.vertices[3*o+0]=a[0]*s+a[4]*c+a[8]*l+a[12],this.vertices[3*o+1]=a[1]*s+a[5]*c+a[9]*l+a[13],this.vertices[3*o+2]=a[2]*s+a[6]*c+a[10]*l+a[14],this.uvs[2*o+0]=r[8*o+6],this.uvs[2*o+1]=r[8*o+7],this.normals){var u=r[8*o+3],f=r[8*o+4],h=r[8*o+5];this.normals[3*o+0]=n[0]*u+n[3]*f+n[6]*h,this.normals[3*o+1]=n[1]*u+n[4]*f+n[7]*h,this.normals[3*o+2]=n[2]*u+n[5]*f+n[8]*h;var m=Math.hypot(this.normals[3*o+0],this.normals[3*o+1],this.normals[3*o+2]),d=m&&1/m;this.normals[3*o+0]*=d,this.normals[3*o+1]*=d,this.normals[3*o+2]*=d}}this.bounds.update(this.transform.matrix,this.boundingRadius,this.transform.frame)}},e.pool=[],e}();t.BatchMesh=n},6662:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IKRig=t.IKChain=t.IKBone=t.LocalHingeConstraint=t.BallJointConstraint=t.SwingTwistConstraint=void 0;var i=r(4454),a=function(){function e(){this.localRotation=i.quat(),this.twist=i.quat(),this.swing=i.quat(),this.swingAngle=Math.PI,this.twistAngle=0*Math.PI}return e.prototype.apply=function(e,t,r){i.quat.conjugate((null==t?void 0:t.rotation)||i.quat.IDENTITY,this.localRotation),i.quat.multiply(this.localRotation,r,this.localRotation),i.quat.decompose(this.localRotation,s.FORWARD,this.swing,this.twist),this.limitRotation(this.swing,this.swingAngle),this.limitRotation(this.twist,this.twistAngle),i.quat.multiply(this.swing,this.twist,this.localRotation),i.quat.multiply((null==t?void 0:t.rotation)||i.quat.IDENTITY,this.localRotation,r),i.quat.normalize(r,r)},e.prototype.limitRotation=function(e,t){var r=Math.sin(.5*t),a=r*r;i.vec3.magnitudeSquared(e)<=a||(i.vec3.normalize(e,e),i.vec3.scale(e,r,e),e[3]=Math.sqrt(1-a)*(e[3]<0?-1:1))},e}();t.SwingTwistConstraint=a;var n=function(){function e(){this.localRotation=i.quat(),this.localDirection=i.vec3(),this.rotor=Math.PI,this.axis=i.vec3.copy(s.FORWARD,i.vec3())}return e.prototype.apply=function(e,t,r){i.quat.conjugate((null==t?void 0:t.rotation)||i.quat.IDENTITY,this.localRotation),i.quat.multiply(this.localRotation,r,this.localRotation),i.quat.transform(s.FORWARD,this.localRotation,this.localDirection);var a=i.vec3.angle(this.axis,this.localDirection);if(a<Number.EPSILON)i.quat.copy(i.quat.IDENTITY,this.localRotation);else{var n=i.vec3.cross(s.FORWARD,this.localDirection,this.localDirection);i.vec3.normalize(n,n),i.quat.axisAngle(n,i.clamp(a,0,this.rotor),this.localRotation)}i.quat.multiply((null==t?void 0:t.rotation)||i.quat.IDENTITY,this.localRotation,r),i.quat.normalize(r,r)},e}();t.BallJointConstraint=n;var o=function(){function e(){this.localRotation=i.quat(),this.localDirection=i.vec3(),this.referenceAxis=i.vec3(),this.projectedDirection=i.vec3(),this.min=-Math.PI,this.max=Math.PI,this.axis=i.vec3.copy(s.LEFT,i.vec3())}return e.prototype.apply=function(e,t,r){i.quat.conjugate((null==t?void 0:t.rotation)||i.quat.IDENTITY,this.localRotation),i.quat.multiply(this.localRotation,r,this.localRotation),i.quat.transform(s.FORWARD,this.localRotation,this.localDirection),this.limitAxis(this.axis,this.localDirection,this.min,this.max,this.localRotation),i.quat.multiply((null==t?void 0:t.rotation)||i.quat.IDENTITY,this.localRotation,r),i.quat.normalize(r,r)},e.prototype.limitAxis=function(e,t,r,a,n){var o=i.vec3.projectPlane(t,e,this.projectedDirection);if(i.vec3.dot(o,o)<Number.EPSILON)return i.quat.copy(i.quat.IDENTITY,n);var c=i.vec3.projectPlane(s.FORWARD,e,this.referenceAxis),l=i.vec3.angle(o,c),u=i.vec3.dot(e,i.vec3.cross(c,o,o))<0?-1:1;i.quat.axisAngle(e,i.clamp(l*u,r,a),n)},e}();t.LocalHingeConstraint=o;var s=function(){function e(){this.start=i.vec3(),this.end=i.vec3(),this.direction=i.vec3(),this.rotation=i.quat(),this.inverseBind=i.quat(),this.index=-1,this.length=0}return e.prototype.set=function(t,r){i.vec3.copy(t,this.start),i.vec3.copy(r,this.end),this.length=i.vec3.distance(this.start,this.end),i.vec3.subtract(this.end,this.start,this.direction),i.vec3.normalize(this.direction,this.direction),i.quat.fromNormal(this.direction,e.UP,this.rotation),i.quat.normalize(this.rotation,this.rotation)},e.UP=i.vec3.AXIS_Y,e.FORWARD=i.vec3.AXIS_Z,e.LEFT=i.vec3.AXIS_X,e}();t.IKBone=s;var c=function(){function e(){this.buffer=new Float32Array(0),this.bones=[],this.length=0,this.origin=i.vec3(),this.target=i.vec3(),this.lastOrigin=i.vec3(),this.lastTarget=i.vec3()}return Object.defineProperty(e.prototype,"first",{get:function(){return this.bones[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"last",{get:function(){return this.bones[this.bones.length-1]},enumerable:!1,configurable:!0}),e.prototype.add=function(e){var t=new s;return t.set(this.last?this.last.end:this.origin,e),this.bones.push(t),this.length+=t.length,t},e.prototype.remove=function(e){var t=this.bones.indexOf(e);-1!=t&&(this.length-=e.length,this.bones.splice(t,1))},e.prototype.solveFABRIK=function(){var t=this.target,r=this.parent,a=e.direction,n=e.rotation;if(null!=t)for(var o=t,c=this.bones.length-1;c>=0;c--){var l=this.bones[c];if(i.vec3.copy(o,l.end),i.vec3.subtract(l.end,l.start,a),i.vec3.normalize(a,a),i.quat.unitRotation(l.direction,a,n),i.quat.multiply(n,l.rotation,l.rotation),i.quat.normalize(l.rotation,l.rotation),c<this.bones.length-1){var u=this.bones[c+1];u.joint.apply(u,l,i.quat.copy(u.rotation,n));var f=i.quat.conjugate(n,n);i.quat.multiply(f,u.rotation,f),i.quat.multiply(f,l.rotation,l.rotation),i.quat.normalize(l.rotation,l.rotation)}i.quat.transform(s.FORWARD,l.rotation,l.direction),i.vec3.scale(l.direction,-l.length,l.start),o=i.vec3.add(l.end,l.start,l.start)}for(o=r?r.end:this.first.start,c=0;c<this.bones.length;c++)l=this.bones[c],i.vec3.copy(o,l.start),i.vec3.subtract(l.end,l.start,a),i.vec3.normalize(a,a),i.quat.unitRotation(l.direction,a,n),i.quat.multiply(n,l.rotation,l.rotation),i.quat.normalize(l.rotation,l.rotation),l.joint.apply(l,this.bones[c-1]||r,l.rotation),i.quat.transform(s.FORWARD,l.rotation,l.direction),i.vec3.scale(l.direction,l.length,l.end),o=i.vec3.add(l.start,l.end,l.end);return t?i.vec3.distance(this.last.end,t):0},e.prototype.solveCCD=function(){for(var t=this.target,r=this.parent,a=e.direction,n=e.rotation,o=e.temp,c=this.bones.length-1;c>=0;c--){var l=this.bones[c],u=i.vec3.subtract(this.last.end,l.start,a),f=i.vec3.subtract(t,l.start,l.direction),h=i.vec3.angle(u,f),m=i.vec3.cross(u,f,a);i.vec3.normalize(m,m),i.quat.axisAngle(m,h,n),i.quat.multiply(n,l.rotation,n),i.quat.normalize(n,n),l.joint.apply(l,this.bones[c-1]||r,n),i.quat.multiply(n,i.quat.conjugate(l.rotation,o),n);for(var d=c,p=l.start;d<this.bones.length;d++){var v=this.bones[d];i.vec3.copy(p,v.start),i.quat.multiply(n,v.rotation,v.rotation),i.quat.normalize(v.rotation,v.rotation),i.quat.transform(s.FORWARD,v.rotation,v.direction),i.vec3.scale(v.direction,v.length,v.end),p=i.vec3.add(v.start,v.end,v.end)}}return i.vec3.distance(this.last.end,t)},e.prototype.serialize=function(){this.buffer.length!=4*this.bones.length+4&&(this.buffer=new Float32Array(4*this.bones.length+4)),this.buffer.set(this.first.start,0);for(var e=0;e<this.bones.length;e++)this.buffer.set(this.bones[e].rotation,4+4*e);return this.buffer},e.prototype.deserialize=function(e){for(var t=e,r=0;r<this.bones.length;r++){var a=this.bones[r],n=4+4*r;i.quat.set(e[n+0],e[n+1],e[n+2],e[n+3],a.rotation),i.vec3.copy(t,a.start),i.quat.transform(s.FORWARD,a.rotation,a.direction),i.vec3.scale(a.direction,a.length,a.end),t=i.vec3.add(a.start,a.end,a.end)}},e.direction=i.vec3(),e.rotation=i.quat(),e.temp=i.quat(),e}();t.IKChain=c;var l=function(){function e(){this.chains=[],this.precision=1e-6,this.iterations=16,this.distanceThreshold=.1,this.deltaDistanceThreshold=.001,this.mode=0,this.enabled=!0}return e.prototype.update=function(){if(this.enabled)for(var e=this.chains.length-1;e>=0;e--){var t=this.chains[e],r=t.parent?t.parent.end:t.origin,a=t.target||i.vec3.ZERO;i.vec3.equals(r,t.lastOrigin,this.precision)&&i.vec3.equals(a,t.lastTarget,this.precision)||(i.vec3.copy(r,t.lastOrigin),i.vec3.copy(a,t.lastTarget),t.deserialize(this.solve(t)))}},e.prototype.solve=function(e){for(var t,r=1/0,i=1/0,a=this.iterations;a>0;a--){var n=this.mode?e.solveFABRIK():e.solveCCD();if(n<r){if(r=n,t=e.serialize(),r<=this.distanceThreshold)break}else if(Math.abs(n-i)<this.deltaDistanceThreshold)break;i=n}return t},e.prototype.add=function(e,t){var r=new c;return i.vec3.copy(e,r.origin),r.parent=t,this.chains.push(r),r},e.prototype.remove=function(e){var t=this.chains.indexOf(e);this.chains.splice(t,1)},e}();t.IKRig=l},1909:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Line=void 0;var i=r(4967),a=r(4454),n=r(9336),o=r(9940),s=function(){function e(e){this.order=0,this.frame=0,this.vertices=new Float32Array(0),this.uvs=new Float32Array(0),this.indices=new Uint16Array(0),this.color=a.vec4(1,1,1,1),this.normal=a.vec3(0,1,0),this.bounds=new n.BoundingVolume,this.ease=i.One,this.width=1,this.height=0,e&&(this.path=a.range(e).map((function(e){return a.vec3()})))}return e.create=function(t,r,a,n,o){var s=new e(t);return s.order=r||0,s.width=a||1,s.ease=n||i.One,o&&s.addColorFade(s.ease),s},e.delete=function(e){e.frame=0},e.prototype.update=function(t,r){if(!(this.frame>0&&this.frame>=r.frame)){this.frame=t.frame;var i=this.path.length;this.vertices&&this.vertices.length==6*i||this.resize(i);var n=e.forward,o=e.normal,s=e.tangent;a.vec3.copy(a.vec3.ZERO,s),a.vec3.set(-r.viewMatrix[2],-r.viewMatrix[6],-r.viewMatrix[10],n);for(var c=0,l=0;l<i;l++){var u=this.path[l],f=this.path[l+1]||u;a.vec3.subtract(f,u,o),a.vec3.normalize(o,o),a.vec3.add(s,o,s),a.vec3.cross(n,s,s),a.vec3.normalize(s,s),a.vec3.scale(s,.5*this.ease(l/(i-1))*this.width,s),this.vertices[6*l+0]=u[0]-s[0],this.vertices[6*l+1]=u[1]-s[1],this.vertices[6*l+2]=u[2]-s[2],this.vertices[6*l+3]=u[0]+s[0],this.vertices[6*l+4]=u[1]+s[1],this.vertices[6*l+5]=u[2]+s[2],a.vec3.copy(o,s),c+=a.vec3.distanceSquared(u,f)}this.height=Math.sqrt(c)/this.width,this.bounds.fromVertices(this.vertices,3,0,t.frame)}},e.prototype.resize=function(e){this.vertices=new Float32Array(2*e*3),this.uvs=new Float32Array(2*e*2),this.indices=new Uint16Array(6*(e-1));for(var t=e-2;t>=0;t--)this.indices[6*t+0]=2*t+0,this.indices[6*t+1]=2*t+1,this.indices[6*t+2]=2*t+2,this.indices[6*t+3]=2*t+2,this.indices[6*t+4]=2*t+1,this.indices[6*t+5]=2*t+3;for(t=e-1;t>=0;t--)this.uvs[4*t+1]=this.uvs[4*t+3]=1-t/(e-1),this.uvs[4*t+0]=0,this.uvs[4*t+2]=1},e.prototype.addColorFade=function(e,t){void 0===t&&(t=a.vec3.ONE),this.colors&&this.colors.length==2*this.path.length||(this.colors=new Uint32Array(2*this.path.length));for(var r=0;r<this.colors.length;r++){var i=e(Math.floor(r/2)/(this.path.length-1));this.colors[r]=o.uintNorm4x8(t[0]*i,t[1]*i,t[2]*i,i)}},e.forward=a.vec3(),e.normal=a.vec3(),e.tangent=a.vec3(),e}();t.Line=s},1772:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MeshSystem=t.Mesh=t.Armature=void 0;var i=r(4454),a=r(9479),n=r(9336),o=r(757),s=r(296),c=r(9463),l=function(){function e(e,t,r){var a=this;this.inverseBindPose=e,this.key=t,this.frame=0,this.boneMatrix=new Float32Array(12*r.length),this.nodes=r.map((function(e,t){var r=e.position,n=e.rotation,o=e.scale;return{parent:e.parent,position:i.vec3.copy(r||i.vec3.ZERO,i.vec3()),rotation:i.quat.copy(n||i.quat.IDENTITY,i.quat()),scale:i.vec3.copy(o||i.vec3.ONE,i.vec3()),globalTransform:i.mat4(),transform:new Float32Array(a.boneMatrix.buffer,12*t*Float32Array.BYTES_PER_ELEMENT,12)}}))}return e.prototype.update=function(t){if(!this.frame){this.frame=t.frame;for(var r=0;r<this.nodes.length;r++){var a=this.nodes[r];i.quat.normalize(a.rotation,a.rotation),i.mat4.fromRotationTranslationScale(a.rotation,a.position,a.scale,a.globalTransform),-1!=a.parent&&i.mat4.multiply(this.nodes[a.parent].globalTransform,a.globalTransform,a.globalTransform),i.mat4.multiply(a.globalTransform,this.inverseBindPose[r],e.tempMat4),i.mat4.transpose(e.tempMat4,a.transform)}}},e.prototype.updateBone=function(t){var r=this.nodes[t];i.mat4.multiply(r.globalTransform,this.inverseBindPose[t],e.tempMat4),i.mat4.transpose(e.tempMat4,r.transform)},e.tempMat4=i.mat4(),e}();t.Armature=l;var u=function(){function e(){this.index=-1,this.frame=0,this.order=0,this.layer=0,this.startTime=0,this.bounds=new n.BoundingVolume,this.color=i.vec4(1,1,1,1)}return e.create=function(t,r,i){var a=new e;return a.buffer=t,a.order=r||0,a.layer=i||0,a},e.prototype.update=function(e){this.frame&&this.frame>=this.transform.frame||(this.frame=e.frame,this.uniform||(this.uniform=new a.UniformBlock(e.gl,{byteSize:88},a.UniformBlockBindings.ModelUniforms)),this.bounds.update(this.transform.matrix,this.buffer.radius,this.transform.frame),this.uniform.data.set(this.transform.matrix,0),this.uniform.data.set(this.color,16),this.uniform.data[20]=this.layer,this.uniform.data[21]=this.startTime)},e}();t.Mesh=u;var f=function(){function e(e){this.context=e,this.pool=[],this.list=[],this.models=Object.create(null);var t=c.createPlane({width:2,height:-2,columns:1,rows:1});this.plane=this.uploadVertexData(t.vertexArray,t.indexArray,t.format)}return e.prototype.create=function(e,t,r){var i=this.pool.pop()||new u;return i.index=this.list.push(i)-1,i.buffer=e,i.order=t||0,i.layer=r||0,i},e.prototype.add=function(e){e.index=this.list.push(e)-1},e.prototype.delete=function(e){-1!=e.index&&(this.list[e.index]=this.list[this.list.length-1],this.list[e.index].index=e.index,this.list.length--,e.index=-1,this.pool.push(e),e.frame=e.layer=e.order=0,e.armature=e.material=e.buffer=e.transform=null,i.vec4.copy(i.vec4.ONE,e.color))},e.prototype.unloadVertexData=function(e){this.context.gl.deleteBuffer(e.vbo),this.context.gl.deleteBuffer(e.ibo),this.context.gl.deleteVertexArray(e.vao)},e.prototype.updateVertexData=function(e,t){var r=this.context.gl;e.frame=this.context.frame,r.bindBuffer(34962,e.vbo),r.bufferSubData(34962,0,t,0,t.length),i.aabb3.calculate(t,e.format[1].stride,e.format[1].offset,e.aabb),e.radius=n.calculateBoundingRadius(t,e.format[1].stride,e.format[1].offset)},e.prototype.uploadVertexData=function(e,t,r,a){var o=this.context.gl,s=o.createVertexArray();o.bindVertexArray(s);var c=o.createBuffer();o.bindBuffer(34962,c),o.bufferData(34962,e,a?35048:35044);for(var l=1;l<r.length;l++){var u=r[l],f=u.size,h=u.type,m=u.normalized,d=u.stride,p=u.offset;o.enableVertexAttribArray(l-1),o.vertexAttribPointer(l-1,f,h,m,d,p),r[l].divisor&&o.vertexAttribDivisor(l-1,r[l].divisor)}var v=o.createBuffer();return o.bindBuffer(34963,v),o.bufferData(34963,t,35044),o.bindVertexArray(null),{vbo:c,ibo:v,frame:this.context.frame,vao:s,indexCount:t.length,indexOffset:0,format:r,drawMode:4,aabb:i.aabb3.calculate(e,r[1].stride,r[1].offset,i.aabb3()),radius:n.calculateBoundingRadius(e,r[1].stride,r[1].offset)}},e.prototype.update=function(){for(var e,t,r,i=this.list.length-1;i>=0;i--)if(0!=this.list[i].color[3]){if(i>0&&this.list[i-1].order>this.list[i].order){var a=this.list[i];this.list[i]=this.list[i-1],this.list[i-1]=a,this.list[i].index=i,this.list[i-1].index=i-1}var n=this.list[i];n.update(this.context),null===(e=n.armature)||void 0===e||e.update(this.context),null===(r=null===(t=n.armature)||void 0===t?void 0:t.ik)||void 0===r||r.update()}},e.prototype.load=function(e,t,r){for(var i=t.buffers[0],a=function(t){var r=e.model[t],a=new Float32Array(i,r.vertices.byteOffset,r.vertices.byteLength/Float32Array.BYTES_PER_ELEMENT),c=new Uint16Array(i,r.indices.byteOffset,r.indices.byteLength/Uint16Array.BYTES_PER_ELEMENT),l=e.format[r.format];if(n.models[r.name]={buffer:null,model:r,geometry:{format:l,vertexArray:a,indexArray:c}},r.inverseBindPose&&(n.models[r.name].inverseBindPose=r.armature.map((function(e,t){return new Float32Array(i,r.inverseBindPose.byteOffset+16*t*Float32Array.BYTES_PER_ELEMENT,16)}))),-1!=r.texture){var u=n.models[r.name].material=new o.MeshMaterial;u.program=n.context.get(s.DeferredGeometryPass).programs[r.armature?1:2],u.diffuse=n.context.get(o.MaterialSystem).materials[r.texture].diffuse,u.normal=n.context.get(o.MaterialSystem).materials[r.texture].normal,u.index=n.context.get(o.MaterialSystem).materials[r.texture].index}},n=this,c=0;c<e.model.length;c++)a(c);r()},e.prototype.loadModel=function(e){if(!this.models[e].buffer){var t=this.models[e].geometry;this.models[e].buffer=this.uploadVertexData(t.vertexArray,t.indexArray,t.format)}var r=this.create(),i=this.models[e],a=i.model,n=i.inverseBindPose,o=i.buffer,s=i.material;return r.layer=a.armature?4:2,r.buffer=o,r.material=s,a.armature&&(r.armature=new l(n,a.name,a.armature)),r.order=a.armature?1:2,r},e}();t.MeshSystem=f},1426:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite=void 0;var i=r(4454),a=r(9336),n=r(757),o=function(){function e(){this.billboard=0,this.index=-1,this.frame=0,this.order=0,this.vertices=new Float32Array(12),this.uvs=new Float32Array(8),this.indices=e.quadIndices,this.color=i.vec4(1,1,1,1),this.normal=i.vec3(1,0,0),this.bounds=new a.BoundingVolume,this.origin=i.vec2(.5,.5)}return e.create=function(t,r,a,n){var o=this.pool.pop()||new e;return o.billboard=t||0,o.order=r||0,o.uvs.set(e.quadUVs),i.vec4.copy(a||i.vec4.ONE,o.color),i.vec2.copy(n||i.vec2.HALF,o.origin),o},e.delete=function(e){this.pool.push(e),e.frame=0,e.index=-1,e.material=e.transform=null},e.prototype.update=function(t,r){if(0===this.frame&&this.material instanceof n.SpriteMaterial&&n.SpriteMaterial.applyTransform(e.quadUVs,this.material.uvMatrix,this.uvs,0),!(this.frame>0&&this.frame>=r.frame&&this.frame>=this.transform.frame)){var a=1*-this.origin[0],o=a+1,s=1*-this.origin[1],c=s+1;(!this.frame||this.frame<this.transform.frame)&&this.bounds.update(this.transform.matrix,Math.max(1,1),this.transform.frame);var l=this.transform.matrix,u=e.tangent,f=e.binormal,h=e.forward,m=this.normal;switch(this.billboard){case 0:i.vec3.set(l[0],l[1],l[2],u),i.vec3.set(l[4],l[5],l[6],f),i.vec3.set(l[8],l[9],l[10],m),i.vec3.set(r.viewMatrix[2],r.viewMatrix[6],r.viewMatrix[10],h),i.vec3.scale(u,Math.sign(i.vec3.dot(h,m)),u);break;case 2:i.vec3.set(r.viewMatrix[0],r.viewMatrix[4],r.viewMatrix[8],u),i.vec3.set(r.viewMatrix[1],r.viewMatrix[5],r.viewMatrix[9],f),i.vec3.scale(u,this.transform.scale[0],u),i.vec3.scale(f,this.transform.scale[1],f),i.vec3.cross(u,f,m);break;case 3:i.vec3.set(l[4],l[5],l[6],u),i.vec3.set(l[12],l[13],l[14],h),i.vec3.subtract(r.position,h,h),i.vec3.cross(h,u,f),i.vec3.normalize(f,f),i.vec3.scale(f,Math.hypot(l[0],l[1],l[2]),f),i.vec3.cross(u,f,m)}this.vertices[0]=u[0]*a+f[0]*s+l[12],this.vertices[1]=u[1]*a+f[1]*s+l[13],this.vertices[2]=u[2]*a+f[2]*s+l[14],this.vertices[3]=u[0]*o+f[0]*s+l[12],this.vertices[4]=u[1]*o+f[1]*s+l[13],this.vertices[5]=u[2]*o+f[2]*s+l[14],this.vertices[6]=u[0]*o+f[0]*c+l[12],this.vertices[7]=u[1]*o+f[1]*c+l[13],this.vertices[8]=u[2]*o+f[2]*c+l[14],this.vertices[9]=u[0]*a+f[0]*c+l[12],this.vertices[10]=u[1]*a+f[1]*c+l[13],this.vertices[11]=u[2]*a+f[2]*c+l[14],this.frame=t.frame}},e.pool=[],e.quadIndices=new Uint16Array([0,1,2,0,2,3]),e.quadUVs=new Float32Array([0,0,1,0,1,1,0,1]),e.tangent=i.vec3(),e.binormal=i.vec3(),e.forward=i.vec3(),e}();t.Sprite=o},6514:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite2D=t.Transform2D=void 0;var i=r(4454),a=r(1426),n=r(757),o=function(){function e(){this.frame=0,this.position=i.vec2(0,0),this.scale=i.vec2(1,1),this.rotation=0,this.matrix=i.mat3x2()}return e.create=function(t,r,a,n){var o=this.pool.pop()||new e;return i.vec2.copy(t||i.vec2.ZERO,o.position),i.vec2.copy(r||i.vec2.ONE,o.scale),o.rotation=a||0,o.parent=n,o},e.delete=function(e){this.pool.push(e),e.frame=0,e.parent=null},e.prototype.recalculate=function(e){e&&this.frame===e||(i.mat3x2.fromTransform(this.position[0],this.position[1],0,0,this.scale[0],this.scale[1],this.rotation,0,0,this.matrix),this.parent&&(this.parent.recalculate(e),i.mat3x2.multiply(this.parent.matrix,this.matrix,this.matrix)),this.frame=e)},e.pool=[],e}();t.Transform2D=o;var s=function(){function e(){this.index=-1,this.frame=0,this.order=0,this.vertices=new Float32Array(8),this.uvs=new Float32Array(8),this.indices=a.Sprite.quadIndices,this.color=i.vec4(1,1,1,1),this.origin=i.vec2(0,0)}return e.create=function(t,r){var a=this.pool.pop()||new e;return a.order=t||0,i.vec2.copy(r||i.vec2.ZERO,a.origin),i.vec4.copy(i.vec4.ONE,a.color),a},e.delete=function(e){this.pool.push(e),e.frame=0,e.material=e.transform=null},e.prototype.update=function(e){if(this.material&&(0==this.frame&&n.SpriteMaterial.applyTransform(a.Sprite.quadUVs,this.material.uvMatrix,this.uvs,0),this.transform.recalculate(e),!(this.frame>0&&this.frame>=this.transform.frame))){var t=this.transform.matrix,r=t[0],i=t[1],o=t[2],s=t[3],c=t[4],l=t[5],u=this.material.size[0],f=this.material.size[1],h=-this.origin[0]*u,m=h+u,d=-this.origin[1]*f,p=d+f;this.vertices[0]=r*h+o*d+c,this.vertices[1]=s*d+i*h+l,this.vertices[2]=r*m+o*d+c,this.vertices[3]=s*d+i*m+l,this.vertices[4]=r*m+o*p+c,this.vertices[5]=s*p+i*m+l,this.vertices[6]=r*h+o*p+c,this.vertices[7]=s*p+i*h+l,this.frame=e}},e.pool=[],e}();t.Sprite2D=s},8581:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(1772),t),a(r(1426),t),a(r(1909),t),a(r(3046),t),a(r(6514),t),a(r(6662),t)},9325:function(e,t){"use strict";var r=this&&this.__rest||function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(r[i[a]]=e[i[a]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.DomNode=void 0,t.DomNode=function(e,t,i,a){var n=t.style,o=t.dataset,s=r(t,["style","dataset"]),c=document.createElement(e);if(Object.assign(c,s),Object.assign(c.style,n),Object.assign(c.dataset,o),i&&i.forEach((function(e){return c.appendChild(e)})),a)for(var l in a)c.addEventListener(l,a[l]);return c}},5631:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapHelper=void 0;var i=r(2583),a=r(9325),n=function(){function e(e){this.context=e,this.enabled=!1,this.canvas=document.createElement("canvas"),Object.assign(this.canvas.style,{imageRendering:"pixelated",width:"100%",display:"none"})}return e.prototype.update=function(){if(this.canvas.style.display=this.enabled?"block":"none",this.enabled){var e=this.context.get(i.PlayerSystem).cube.tile,t=this.context.get(i.TerrainSystem).levelGenerator,r=Math.floor(e[0]/t.zoneSize),a=Math.floor(e[1]/t.zoneSize),n=t.generateZone(r,a);this.canvas.width=n.map.width,this.canvas.height=n.map.height;var o=this.canvas.getContext("2d");o.putImageData(n.map,0,0),o.fillStyle="#ff0000",o.fillRect(e[0]-n.offsetX,e[1]-n.offsetY,1,1)}},e.prototype.open=function(){var e=this;return a.DomNode("div",{style:{display:"flex",flexDirection:"column"}},[a.DomNode("div",{innerText:"map",style:{textTransform:"uppercase",display:"flex",borderBottom:"1px solid #efefef"}},[a.DomNode("input",{type:"checkbox",checked:this.enabled,style:{pointerEvents:"all",marginLeft:"auto"}},null,{change:function(t){return e.enabled=t.target.checked}})]),this.canvas])},e}();t.MapHelper=n},2678:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Monitor=void 0;var r=function(){function e(e){var t=this;this.options=e,this.dom=document.createElement("div"),this.label=document.createElement("div"),this.canvas=document.createElement("canvas"),this.prevTimestamp=0,this.timeElapsed=0,this.values=[],this.update=function(e){var r=e-t.prevTimestamp;t.prevTimestamp=e,t.timeElapsed+=r,t.options.update&&t.options.update.call(t,r),t.timeElapsed>=t.options.refreshRate&&(t.timeElapsed=0,t.render()),requestAnimationFrame(t.update)},Object.assign(this.dom.style,{display:"inline-block",padding:"0.2em",backgroundColor:"rgba(0,0,0,1)",color:e.color,zIndex:16}),this.dom.appendChild(this.label),Object.assign(this.canvas.style,{boxSizing:"border-box",border:"1px solid "+e.color}),this.dom.appendChild(this.canvas),Object.assign(this.canvas,{width:72,height:36}),this.ctx=this.canvas.getContext("2d",{alpha:!1}),this.ctx.imageSmoothingEnabled=!1,this.update(0)}return e.prototype.render=function(){var e=this,t=e.ctx,r=e.canvas,i=e.values,a=e.options,n=a.range,o=a.color;t.globalCompositeOperation="copy",t.drawImage(r,0,0,r.width,r.height,1,0,r.width,r.height),t.globalCompositeOperation="source-over";var s=i.reduce((function(e,t){return e+t}),0)/i.length;i.length=0;var c=(s-n[0])/(n[1]-n[0])*r.height|0;t.fillStyle=o,t.fillRect(0,r.height-c,1,c),this.label.innerText=this.options.label+": "+s.toFixed(2)},e}();t.Monitor=r},1910:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsHelper=void 0;var i=r(9325),a=r(7822),n=r(296),o=r(757),s=r(6365),c=function(e,t){return i.DomNode("div",{innerText:e,style:{display:"flex",width:"100%"}},[i.DomNode("input",{type:"checkbox",checked:t.enabled,style:{pointerEvents:"all",marginLeft:"auto"}},null,{change:function(e){return t.enabled=e.target.checked}})])},l=function(e,t){return i.DomNode("div",{innerText:e,style:{display:"flex",width:"100%"}},[i.DomNode("input",{type:"range",min:0,max:100,step:1,value:50,style:{pointerEvents:"all",marginLeft:"auto"}},null,{change:function(e){return t.value=+e.target.value/100}})])},u=function(){function e(e){this.context=e}return e.prototype.update=function(){},e.prototype.open=function(){return i.DomNode("div",{style:{display:"flex",flexDirection:"column"}},[i.DomNode("div",{innerText:"settings",style:{textTransform:"uppercase",display:"flex",borderBottom:"1px solid #efefef"}}),c("sky",this.context.get(a.SharedSystem).sky),c("grid",this.context.get(a.SharedSystem).grid),c("mist",this.context.get(a.SharedSystem).mist),c("fog",this.context.get(n.PostEffectPass).fog),c("bloom",this.context.get(n.PostEffectPass).bloom),c("textures",this.context.get(o.MaterialSystem)),c("reflection",this.context.get(n.AmbientLightPass).reflection),c("ui",this.context.get(n.OverlayPass)),l("music",this.context.get(s.AudioSystem).mixer.channel.music.gain.gain),l("sfx",this.context.get(s.AudioSystem).mixer.channel.sfx.gain.gain)])},e}();t.SettingsHelper=u},2812:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SkeletonHelper=void 0;var o=r(4454),s=r(9479),c=n(r(6534)),l=r(9463),u=r(757),f=r(9336),h=r(8581),m=r(9325),d=function(){function e(e){this.context=e,this.enabled=!1,this.material=new u.MeshMaterial,this.material.program=s.ShaderProgram(this.context.gl,c.geometry_vert,c.geometry_frag,{}),this.material.diffuse=s.createTexture(this.context.gl,{width:1,height:1,data:new Uint8Array([255,255,255,127])});var t=l.applyTransform(l.createBox({width:1,height:1,depth:1,open:!1}),o.mat4.fromRotationTranslationScale(o.quat.IDENTITY,[0,0,.5],[.04,.04,1],o.mat4()));this.buffer=this.context.get(h.MeshSystem).uploadVertexData(t.vertexArray,t.indexArray,t.format,!1),this.uniform=new s.UniformBlock(this.context.gl,{byteSize:88},s.UniformBlockBindings.ModelUniforms),this.modelMatrix=this.uniform.data.subarray(0,16),this.color=this.uniform.data.subarray(16,20)}return e.prototype.update=function(){if(this.enabled){var e=this.context.gl,t=this.context.get(h.MeshSystem).list,r=this.context.get(f.CameraSystem).camera;e.useProgram(this.material.program.target),this.material.bind(e),e.bindVertexArray(this.buffer.vao);for(var i=t.length-1;i>=0;i--){var a=t[i];if(0!==a.color[3]&&a.armature&&r.culling.cull(a.bounds,a.layer)){for(var n=0;n<a.armature.nodes.length;n++){var c=a.armature.nodes[n];o.mat4.multiply(a.transform.matrix,c.globalTransform,this.modelMatrix),o.mat4.rotate(this.modelMatrix,-.5*Math.PI,o.vec3.AXIS_X,this.modelMatrix),o.vec4.set(.8,.7,.2,1,this.color),this.uniform.bind(e,s.UniformBlockBindings.ModelUniforms),e.drawElements(4,this.buffer.indexCount,5123,this.buffer.indexOffset)}if(a.armature.ik)for(var l=a.armature.ik,u=0;u<l.chains.length;u++)for(n=0;n<l.chains[u].bones.length;n++){var m=l.chains[u].bones[n];o.mat4.fromRotationTranslationScale(m.rotation,m.start,[2,2,m.length],this.modelMatrix),l.chains[u].target&&o.mat4.multiply(a.transform.matrix,this.modelMatrix,this.modelMatrix),o.vec4.set(.8,.2,.7,1,this.color),this.uniform.bind(e,s.UniformBlockBindings.ModelUniforms),e.drawElements(4,this.buffer.indexCount,5123,this.buffer.indexOffset)}}}}},e.prototype.open=function(){var e=this;return m.DomNode("div",{style:{display:"flex",flexDirection:"column"}},[m.DomNode("div",{innerText:"rig",style:{textTransform:"uppercase",display:"flex",borderBottom:"1px solid #efefef"}},[m.DomNode("input",{type:"checkbox",checked:this.enabled,style:{pointerEvents:"all",marginLeft:"auto"}},null,{change:function(t){return e.enabled=t.target.checked}})])])},e}();t.SkeletonHelper=d},4766:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.TextureHelper=void 0;var o=r(4454),s=r(9479),c=n(r(6534)),l=r(296),u=r(7822),f=r(296),h=r(9325),m=function(){function e(e){this.context=e,this.textureProgram=s.ShaderProgram(this.context.gl,c.fullscreen_vert,c.fullscreen_frag),this.textureProgram.uniforms.uMask=o.vec4.ONE,this.cubemapProgram=s.ShaderProgram(this.context.gl,c.fullscreen_vert,c.fullscreen_frag,{CUBEMAP:!0}),this.cubemapProgram.uniforms.uMask=o.vec4.ONE}return e.prototype.update=function(){this.texture?this.renderDebugTexture(this.texture,3553):this.cubemap&&this.renderDebugTexture(this.cubemap,34067)},e.prototype.open=function(){var e=this,t=[{texture:null,type:0,key:"none"}];for(var r in u.SharedSystem.textures)t.push({key:r,texture:u.SharedSystem.textures[r],type:3553});for(var i=this.context.get(f.AmbientLightPass).reflection,a=0;a<i.probes.length;a++)t.push({key:"envmap_"+a,texture:i.probes[a].cubemap,type:34067});return t.unshift({texture:this.context.get(l.DeferredGeometryPass).position,type:3553,key:"position_buffer"},{texture:this.context.get(l.DeferredGeometryPass).normal,type:3553,key:"normal_buffer"},{texture:this.context.get(l.DeferredGeometryPass).albedo,type:3553,key:"albedo_buffer"},{texture:this.context.get(l.PostEffectPass).bloom.texture,type:3553,key:"bloom_buffer"}),h.DomNode("div",{style:{display:"flex",flexDirection:"column"}},[h.DomNode("div",{innerText:"texture",style:{textTransform:"uppercase",display:"flex",borderBottom:"1px solid #efefef"}}),h.DomNode("select",{style:{background:"inherit",color:"inherit",pointerEvents:"all"}},t.map((function(e,t){return h.DomNode("option",{value:t,innerText:e.key,style:{background:"inherit",color:"inherit"}})})),{input:function(r){var i=r.target.value;e.texture=e.cubemap=null;var a=t[i],n=a.texture;34067===a.type?e.cubemap=n:e.texture=n}})])},e.prototype.renderDebugTexture=function(e,t){void 0===t&&(t=3553);var r=this.context.gl,i=this.context.get(l.PostEffectPass).plane;switch(r.bindFramebuffer(36160,null),r.bindVertexArray(i.vao),t){case 3553:r.useProgram(this.textureProgram.target);break;case 34067:r.useProgram(this.cubemapProgram.target)}r.activeTexture(33984+s.UniformSamplerBindings.uSampler),r.bindTexture(t,e),r.drawElements(4,i.indexCount,5123,i.indexOffset)},e}();t.TextureHelper=m},2851:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebugSystem=void 0;var i=r(9325),a=r(2678),n=r(5631),o=r(2812),s=r(4766),c=r(1910),l=function(){function e(e){this.context=e,this.enabled=-1!=location.search.indexOf("debug"),this.enabled&&(this.helpers=[new s.TextureHelper(this.context),new o.SkeletonHelper(this.context),new c.SettingsHelper(this.context),new n.MapHelper(this.context)],console.log("%cDebug Mode","color:#ff0000"),window.app=e,this.attachDebugPanel())}return e.prototype.update=function(){if(this.enabled)for(var e=this.helpers.length-1;e>=0;e--)this.helpers[e].update()},e.prototype.load=function(e,t,r){if(!this.enabled)return r();var a=i.DomNode("div",{style:{display:"flex",flexDirection:"column",justifyContent:"start",position:"fixed",left:0,top:"64px",width:"154px"}},[i.DomNode("div",{}),i.DomNode("div",{style:{display:"flex",flexDirection:"column",justifyContent:"start"}},this.helpers.map((function(e){return e.open()})))]);document.body.appendChild(a),r()},e.prototype.attachDebugPanel=function(){var e=document.createElement("div");Object.assign(e.style,{position:"fixed",top:0,left:0,zIndex:128,fontSize:"0.8em"});var t=new a.Monitor({refreshRate:100,color:"#83e82a",label:"FPS",range:[0,60],update:function(e){this.values.push(1e3/e)}}),r={drawElements:0,drawArrays:0,drawArraysInstanced:0,drawElementsInstanced:0,blitFramebuffer:0},i=function(e){var t;n.context.gl[e]=(t=n.context.gl[e],function(){return r[e]++,t.apply(this,arguments)})},n=this;for(var o in r)i(o);var s=new a.Monitor({refreshRate:100,color:"#e8632a",label:"DC",range:[0,60],update:function(e){this.values.push(r.drawArrays+r.drawElements+r.drawArraysInstanced+r.drawElementsInstanced+r.blitFramebuffer),r.drawArrays=r.drawElements=r.drawArraysInstanced=r.drawElementsInstanced=r.blitFramebuffer=0}});e.appendChild(t.dom),e.appendChild(s.dom),document.body.appendChild(e)},e}();t.DebugSystem=l},1340:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardSystem=void 0;var r=function(){function e(e){var t=this;this.context=e,this.keys=Object.create(null),addEventListener("keydown",(function(e){t.keys[e.code]>0||(t.keys[e.code]=t.context.frame+1)})),addEventListener("keyup",(function(e){t.keys[e.code]=-t.context.frame-1}))}return e.prototype.update=function(){},e.prototype.down=function(e){return this.keys[e]>0},e.prototype.trigger=function(e){return this.keys[e]===this.context.frame},e.prototype.release=function(e){return this.keys[e]===-this.context.frame},e}();t.KeyboardSystem=r},2867:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(1340),t)},3632:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Application=void 0;var i=r(2297),a=r(9479),n=function(){function e(t,r){var n=this;this.canvas=document.createElement("canvas"),this.loader=new i.Loader,this.systems=[],this.previousTimestamp=0,this.timeScale=1,this.frame=0,this.currentTime=0,this.update=function(t){n.deltaTime=.001*n.timeScale*Math.min(e.timestep,t-n.previousTimestamp),n.previousTimestamp=t,n.currentTime+=n.deltaTime,n.frame++;for(var r=0;r<n.systems.length;r++)n.systems[r].update();requestAnimationFrame(n.update)},this.resolution=r.resolution,this.canvas.width=r.width*r.resolution,this.canvas.height=r.height*r.resolution,this.gl=new a.WebGLState(this.canvas.getContext("webgl2",{alpha:!1,antialias:!1,depth:!0,stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}));for(var o=0;o<t.length;o++)null==t[o].index&&(t[o].index=o),this.systems[t[o].index]=new t[o](this);i.Loader.awaitDocumentLoad((function(){return document.body.prepend(n.canvas)}))}return e.prototype.get=function(e){return this.systems[e.index]},e.prototype.load=function(e){this.loader.load(e,function t(r,a){var n=this;r===this.systems.length?i.Loader.awaitUserGesture((function(){return n.update(0)})):this.systems[r].load?this.systems[r].load(e,a,t.bind(this,r+1,a)):t.call(this,r+1,a)}.bind(this,0))},e.timestep=2e3/60,e}();t.Application=n},4788:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryHeap=void 0;var r=function(){function e(e){this.comparator=e,this.list=[]}return e.prototype.moveUp=function(e,t,r,i){for(void 0===t&&(t=e.length-1),void 0===r&&(r=e[t]);;){var a=t-1>>1;if(a<0||i(r,e[a])>=0)break;e[t]=e[t=a]}e[t]=r},e.prototype.moveDown=function(e,t,r,i){if(void 0===t&&(t=0),void 0===r&&(r=e[t]),!(t>=e.length)){for(;;){var a=2*t+1;if(a+1<e.length&&i(e[a],e[a+1])>0&&a++,a>=e.length||i(r,e[a])<=0)break;e[t]=e[t=a]}e[t]=r}},Object.defineProperty(e.prototype,"length",{get:function(){return this.list.length},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this.moveUp(this.list,this.list.length,e,this.comparator)},e.prototype.get=function(e){return this.list[e]},e.prototype.shift=function(){var e=this.list[0],t=this.list.pop();return this.list.length&&this.moveDown(this.list,0,t,this.comparator),e},e.prototype.remove=function(e){var t=this.list.indexOf(e),r=this.list.pop();t!==this.list.length-1&&(this.comparator(r,e)<0?this.moveUp(this.list,t,r,this.comparator):this.moveDown(this.list,t,r,this.comparator))},e.prototype.update=function(e){this.moveUp(this.list,this.list.indexOf(e),void 0,this.comparator)},e.prototype.clear=function(){this.list.length=0},e}();t.BinaryHeap=r},2297:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Loader=void 0;var r=function(){function e(){this.progressBarElement=document.querySelector(".progress_bar div")}return e.prototype.load=function(e,t){for(var r=this,i=[],a=[],n=e.texture.length+e.buffer.length,o=0,s=n,c=function(e,c){var l=0;return function(u,f){if(-1==u)return console.error(f);0==u&&f&&(s--,c[e]=f),o+=u-l,l=u,r.progressBarElement.style.width=Math.round(100*(1-o/n))+"%",0==s&&t({textures:i,buffers:a})}},l=0;l<e.texture.length;l++)this.loadImage(e.texture[l],c(l,i));for(l=0;l<e.buffer.length;l++)this.loadFile(e.buffer[l],"arraybuffer",c(l,a))},e.prototype.loadFile=function(e,t,r){var i=new XMLHttpRequest;i.open("GET",encodeURI(e),!0),i.responseType=t||"text",i.onprogress=function(e){return e.lengthComputable&&r(1-e.loaded/e.total)},i.onreadystatechange=function(e){return i.readyState===XMLHttpRequest.DONE&&(200===i.status?r(0,i.response):r(-1,new Error(i.statusText)))},i.send()},e.prototype.loadImage=function(e,t){var r=new Image;r.crossOrigin="anonymous",r.onerror=function(r){return t(-1,new Error(""+e))},r.onload=function(e){return t(0,r)},r.src=e},e.awaitUserGesture=function(e){var t=document.querySelector(".overlay");t.classList.remove("loading");var r=["touchend","mousedown","keydown"];function i(){for(var a=0,n=r;a<n.length;a++){var o=n[a];document.removeEventListener(o,i)}e(),t.classList.add("hide")}for(var a=0,n=r;a<n.length;a++){var o=n[a];document.addEventListener(o,i)}},e.awaitDocumentLoad=function(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)},e}();t.Loader=r},8594:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Signal=void 0;var r=function(){function e(){this.subscribers=[],this.iterator=[]}return e.prototype.broadcast=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.iterator,i=r.length;for(r[i]=this.subscribers.length-1;r[i]>=0;r[i]--)this.subscribers[r[i]].apply(this,arguments);r.length--},e.prototype.add=function(e){-1==this.subscribers.indexOf(e)&&this.subscribers.push(e)},e.prototype.remove=function(e){var t=this.subscribers.indexOf(e);if(-1!=t){this.subscribers.splice(t,1);for(var r=this.iterator.length-1;r>=0;r--)t<this.iterator[r]&&this.iterator[r]--}},e}();t.Signal=r},7819:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.One=t.Zero=void 0,t.Zero=function(){return 0},t.One=function(){return 1}},4967:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(7819),t),a(r(4788),t),a(r(8594),t),a(r(2297),t),a(r(3632),t)},2179:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBox=void 0;var i=r(6518);t.createBox=function(e){var t=.5*e.width,r=.5*e.height,a=.5*e.depth;return e.open?{format:i.VertexDataFormat.Static,vertexArray:new Float32Array([-t,-r,a,0,0,1,.75,0,t,-r,a,0,0,1,.5,0,t,r,a,0,0,1,.5,1,-t,r,a,0,0,1,.75,1,-t,-r,-a,0,0,-1,0,0,-t,r,-a,0,0,-1,0,1,t,r,-a,0,0,-1,.25,1,t,-r,-a,0,0,-1,.25,0,t,-r,-a,1,0,0,.25,0,t,r,-a,1,0,0,.25,1,t,r,a,1,0,0,.5,1,t,-r,a,1,0,0,.5,0,-t,-r,-a,-1,0,0,1,0,-t,-r,a,-1,0,0,.75,0,-t,r,a,-1,0,0,.75,1,-t,r,-a,-1,0,0,1,1]),indexArray:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15])}:{format:i.VertexDataFormat.Static,vertexArray:new Float32Array([-t,-r,a,0,0,1,0,0,t,-r,a,0,0,1,1,0,t,r,a,0,0,1,1,1,-t,r,a,0,0,1,0,1,-t,-r,-a,0,0,-1,1,0,-t,r,-a,0,0,-1,1,1,t,r,-a,0,0,-1,0,1,t,-r,-a,0,0,-1,0,0,-t,r,-a,0,1,0,0,1,-t,r,a,0,1,0,0,0,t,r,a,0,1,0,1,0,t,r,-a,0,1,0,1,1,-t,-r,-a,0,-1,0,1,1,t,-r,-a,0,-1,0,0,1,t,-r,a,0,-1,0,0,0,-t,-r,a,0,-1,0,1,0,t,-r,-a,1,0,0,1,0,t,r,-a,1,0,0,1,1,t,r,a,1,0,0,0,1,t,-r,a,1,0,0,0,0,-t,-r,-a,-1,0,0,0,0,-t,-r,a,-1,0,0,1,0,-t,r,a,-1,0,0,1,1,-t,r,-a,-1,0,0,0,1]),indexArray:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23])}}},1059:function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.extrudePolygon=t.doubleSided=t.modifyGeometry=t.applyTransform=void 0;var a=r(4454),n=r(9479);t.applyTransform=function(e,t){for(var r=e.vertexArray,i=e.format,n=r.byteLength/i[1].stride,o=i[1].stride/Float32Array.BYTES_PER_ELEMENT,s=n-1;s>=0;s--){var c=r[0+(h=s*o)],l=r[h+1],u=r[h+2];r[h+0]=t[0]*c+t[4]*l+t[8]*u+t[12],r[h+1]=t[1]*c+t[5]*l+t[9]*u+t[13],r[h+2]=t[2]*c+t[6]*l+t[10]*u+t[14]}var f=a.mat3.fromMat4(t,a.mat3());for(a.mat3.invert(f,f),a.mat3.transpose(f,f),s=n-1;s>=0;s--){var h;c=r[3+(h=s*o)],l=r[h+4],u=r[h+5],r[h+3]=f[0]*c+f[3]*l+f[6]*u,r[h+4]=f[1]*c+f[4]*l+f[7]*u,r[h+5]=f[2]*c+f[5]*l+f[8]*u}return e},t.modifyGeometry=function(e,t){for(var r=e.vertexArray,i=e.format,n=r.byteLength/i[1].stride,o=i[1].stride/Float32Array.BYTES_PER_ELEMENT,s=a.vec3(),c=a.vec3(),l=(a.quat(),n-1);l>=0;l--)s[0]=r[l*o+0],s[1]=r[l*o+1],s[2]=r[l*o+2],c[0]=r[l*o+3],c[1]=r[l*o+4],c[2]=r[l*o+5],t(s,c),r.set(s,l*o+0),r.set(c,l*o+3);return e},t.doubleSided=function(e){for(var t=new Uint16Array(2*e.indexArray.length),r=e.indexArray.length/3-1;r>=0;r--)t[3*r+0]=e.indexArray[3*r+2],t[3*r+1]=e.indexArray[3*r+1],t[3*r+2]=e.indexArray[3*r+0];return t.set(e.indexArray,e.indexArray.length),i(i({},e),{indexArray:t})},t.extrudePolygon=function(e,t){for(var r=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);for(var i=0,a=t,n=r-1;a<r;n=a++)i+=(e[n][0]-e[a][0])*(e[n][1]+e[a][1]);return-.5*i}(e)<0,i=new Float32Array(4*e.length*8),o=new Uint16Array(6*e.length),s=a.vec2(),c=e.length-1,l=0;c>=0;l=c,c--){var u=e[c],f=e[l];a.vec2.subtract(f,u,s),r?a.vec2.rotate90cw(s,s):a.vec2.rotate90ccw(s,s),a.vec2.normalize(s,s);var h=8*(4*c+0),m=8*(4*c+1),d=8*(4*c+2),p=8*(4*c+3);i[h+0]=i[p+0]=u[0],i[m+0]=i[d+0]=f[0],i[h+2]=i[p+2]=u[1],i[m+2]=i[d+2]=f[1],i[h+1]=i[m+1]=0,i[d+1]=i[p+1]=t,i[h+3]=i[m+3]=i[d+3]=i[p+3]=s[0],i[h+5]=i[m+5]=i[d+5]=i[p+5]=s[1],i[h+6]=i[p+6]=c/(e.length-1),i[m+6]=i[d+6]=l/(e.length-1),i[h+7]=i[m+7]=0,i[p+7]=i[d+7]=1,o[6*c+0]=4*c,o[6*c+1]=4*c+1,o[6*c+2]=4*c+2,o[6*c+3]=4*c+2,o[6*c+4]=4*c+3,o[6*c+5]=4*c}return{format:n.VertexDataFormat.Static,vertexArray:i,indexArray:o}}},2434:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCylinder=void 0;var i=r(6518);t.createCylinder=function(e){for(var t=e.radiusTop,r=void 0===t?1:t,a=e.radiusBottom,n=void 0===a?1:a,o=e.height,s=void 0===o?1:o,c=e.radial,l=void 0===c?8:c,u=e.horizontal,f=void 0===u?1:u,h=(e.cap,e.angleStart),m=void 0===h?0:h,d=e.angleLength,p=void 0===d?2*Math.PI:d,v=l+1,y=new Float32Array((f+1)*v*8),g=new Uint16Array(l*f*6),x=(n-r)/s,b=0;b<=f;b++)for(var S=b/f,P=r+S*(n-r),O=0;O<=l;O++){var T=O/l,w=m+T*p,_=Math.sin(w),A=Math.cos(w);y[0+(M=8*(O+b*v))]=P*_,y[M+1]=-S*s+.5*s,y[M+2]=P*A;var E=_*_+x*x+A*A;E=E&&1/Math.sqrt(E),y[M+3]=E*_,y[M+4]=E*x,y[M+5]=E*A,y[M+6]=T,y[M+7]=1-S}for(O=0;O<l;O++)for(b=0;b<f;b++){var M;g[0+(M=6*(O*f+b))]=b*v+O,g[M+1]=g[M+3]=(b+1)*v+O,g[M+4]=(b+1)*v+(O+1),g[M+2]=g[M+5]=b*v+(O+1)}return{format:i.VertexDataFormat.Static,vertexArray:y,indexArray:g}}},9463:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(1059),t),a(r(1242),t),a(r(7077),t),a(r(2179),t),a(r(2434),t)},7077:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPlane=void 0;var i=r(6518);t.createPlane=function(e){for(var t=e.width,r=e.height,a=e.columns,n=void 0===a?1:a,o=e.rows,s=void 0===o?1:o,c=n+1,l=s+1,u=new Float32Array(c*l*8),f=new Uint16Array(n*s*6),h=0;h<c;h++)for(var m=0;m<l;m++)u[0+(d=8*(h*l+m))]=t*h/n-.5*t,u[d+1]=0,u[d+2]=r*m/s-.5*r,u[d+3]=0,u[d+4]=1,u[d+5]=0,u[d+6]=h/n,u[d+7]=1-m/s;for(h=0;h<n;h++)for(m=0;m<s;m++){var d;f[0+(d=6*(h*s+m))]=m+l*h,f[d+1]=m+1+l*h,f[d+2]=m+l*(h+1),f[d+3]=m+l*(h+1),f[d+4]=m+1+l*h,f[d+5]=m+1+l*(h+1)}return{format:i.VertexDataFormat.Static,vertexArray:u,indexArray:f}}},1242:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSphere=void 0;var i=r(6518);t.createSphere=function(e){for(var t=e.longitude,r=void 0===t?32:t,a=e.latitude,n=void 0===a?32:a,o=e.radius,s=void 0===o?1:o,c=e.thetaStart,l=void 0===c?0:c,u=e.thetaLength,f=void 0===u?Math.PI:u,h=e.phiStart,m=void 0===h?0:h,d=e.phiLength,p=void 0===d?2*Math.PI:d,v=new Float32Array(r*n*4*8),y=new Uint16Array(r*n*6),g=0,x=0,b=0;b<n;b++)for(var S=b/n,P=(b+1)/n,O=l+f*S,T=l+f*P,w=Math.sin(O),_=Math.sin(T),A=Math.cos(O),E=Math.cos(T),M=0;M<r;M++){var I=M/r,k=(M+1)/r,q=m+p*I,R=m+p*k,N=Math.sin(q),L=Math.sin(R),z=Math.cos(q),D=Math.cos(R),U=8*g;v[U+0]=w*z*s,v[U+1]=A*s,v[U+2]=w*N*s,v[U+8]=w*D*s,v[U+9]=A*s,v[U+10]=w*L*s,v[U+16]=_*z*s,v[U+17]=E*s,v[U+18]=_*N*s,v[U+24]=_*D*s,v[U+25]=E*s,v[U+26]=_*L*s,v[U+3]=w*z,v[U+4]=A,v[U+5]=w*N,v[U+11]=w*D,v[U+12]=A,v[U+13]=w*L,v[U+19]=_*z,v[U+20]=E,v[U+21]=_*N,v[U+27]=_*D,v[U+28]=E,v[U+29]=_*L,v[U+6]=v[U+22]=1-I,v[U+7]=v[U+15]=1-S,v[U+14]=v[U+30]=1-k,v[U+23]=v[U+31]=1-P,y[x+0]=g+0,y[x+1]=g+1,y[x+2]=g+2,y[x+3]=g+2,y[x+4]=g+1,y[x+5]=g+3,g+=4,x+=6}return{format:i.VertexDataFormat.Static,vertexArray:v,indexArray:y}}},8321:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.DecalMaterial=void 0;var n=r(4454),o=r(4386),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uvTransform=n.vec4(0,0,1,1),t.depthTest=518,t.cullFace=1028,t.depthWrite=!1,t.blendMode=o.ShaderMaterial.Premultiply,t.layer=1,t}return a(t,e),t.create=function(e,r){var i=new t;return i.program=e,i.diffuse=r,i},t.prototype.bind=function(t){e.prototype.bind.call(this,t)},t.prototype.merge=function(t){return e.prototype.merge.call(this,t)&&this.diffuse===t.diffuse},t}(o.ShaderMaterial);t.DecalMaterial=s},3643:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.EffectMaterial=void 0;var c=r(9479),l=s(r(6534)),u=r(4386),f=function(e){function t(t,r,i){var a=e.call(this)||this;for(var n in a.depthTest=515,a.blendMode=u.ShaderMaterial.Premultiply,a.program=c.ShaderProgram(t,l.batch_vert,l.vfx_frag,r),a.uniform=new c.UniformBlock(t,a.program.uniforms.EffectUniforms,c.UniformBlockBindings.EffectUniforms),i)a.uniform.uniforms[n].set(i[n],0);return a}return a(t,e),t.prototype.bind=function(t){e.prototype.bind.call(this,t),this.uniform.bind(t,c.UniformBlockBindings.EffectUniforms),t.activeTexture(33984+c.UniformSamplerBindings.uDiffuseMap),t.bindTexture(3553,this.diffuse),t.activeTexture(33984+c.UniformSamplerBindings.uGradientMap),t.bindTexture(3553,this.gradient),t.activeTexture(33984+c.UniformSamplerBindings.uDisplacementMap),t.bindTexture(3553,this.displacement)},t.prototype.merge=function(t){return e.prototype.merge.call(this,t)&&t===this},t}(u.ShaderMaterial);t.EffectMaterial=f},4148:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.EmitterMaterial=void 0;var n=r(9479),o=r(4386),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.depthTest=515,t.cullFace=0,t.depthWrite=!1,t.blendMode=o.ShaderMaterial.Premultiply,t}return a(t,e),t.prototype.bind=function(t){e.prototype.bind.call(this,t),t.activeTexture(33984+n.UniformSamplerBindings.uSampler),t.bindTexture(3553,this.diffuse),this.gradientRamp&&(t.activeTexture(33984+n.UniformSamplerBindings.uGradient),t.bindTexture(3553,this.gradientRamp)),this.curveSampler&&(t.activeTexture(33984+n.UniformSamplerBindings.uAttributes),t.bindTexture(3553,this.curveSampler)),this.displacementMap&&(t.activeTexture(33984+n.UniformSamplerBindings.uDisplacementMap),t.bindTexture(3553,this.displacementMap))},t}(o.ShaderMaterial);t.EmitterMaterial=s},3248:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GradientRamp=void 0;var i=r(9479);t.GradientRamp=function(e,t,r){void 0===r&&(r=1);for(var a=new Uint8Array(4*t.length),n=0;n<t.length;n++)a[4*n+0]=t[n]>>>24&255,a[4*n+1]=t[n]>>>16&255,a[4*n+2]=t[n]>>>8&255,a[4*n+3]=t[n]>>>0&255;return i.createTexture(e,{width:t.length/r,height:r,data:a},{flipY:!0,mipmaps:0,filter:9729,wrap:33071,type:3553,format:32856})}},720:function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialSystem=void 0;var s=r(9479),c=r(296),l=o(r(6534)),u=r(1158),f=r(8581),h=function(){function e(e){this.context=e,this.white=new u.MeshMaterial,this.materials=Object.create(null),this.staticMaterials=Object.create(null),this.enabled=!0,this.renderQueue=[],this.white.diffuse=s.createTexture(this.context.gl,{width:1,height:1,data:new Uint8Array([127,127,127,0])}),this.white.normal=s.createTexture(this.context.gl,{width:1,height:1,data:new Uint8Array([127,127,255,0])})}return e.prototype.create=function(){var e=new u.MeshMaterial;return e.program=this.context.get(c.DeferredGeometryPass).programs[0],e},e.prototype.createRenderTexture=function(e,t,r,a){void 0===r&&(r=1);var n=this.context.gl,o=r>1?35866:3553,c=!(r>1),l=s.createTexture(n,{width:e,height:t,depth:r},i({flipY:!1,mipmaps:c?0:9728,type:o,filter:9729,wrap:10497},a)),u=Array(r);if(1===r)u[0]=n.createFramebuffer(),n.bindFramebuffer(36160,u[0]),n.framebufferTexture2D(36160,36064,3553,l,0);else for(var f=0;f<r;f++)u[f]=n.createFramebuffer(),n.bindFramebuffer(36160,u[f]),n.framebufferTextureLayer(36160,36064,l,0,f);return{width:e,height:t,layers:r,target:l,mipmaps:c,type:o,fbo:u}},e.prototype.renderTexture=function(e,t,r,i){var a=this.context.gl;a.bindFramebuffer(36160,e.fbo[t]),a.disable(3042),a.viewport(0,0,e.width,e.height),a.useProgram(r.target),r.uniforms.uTime=this.context.currentTime;var n=1;for(var o in i)i[o]instanceof WebGLTexture?(a.activeTexture(33984+n),a.bindTexture(3553,i[o]),r.uniforms[o]=n++):r.uniforms[o]=i[o];var s=this.context.get(f.MeshSystem).plane;a.bindVertexArray(s.vao),a.drawElements(4,s.indexCount,5123,s.indexOffset),e.mipmaps&&(a.activeTexture(33984),a.bindTexture(e.type,e.target),a.generateMipmap(3553))},e.prototype.addRenderTexture=function(e,t,r,i,a){var n=this.context.gl;return i.uScreenSize=[e.width,e.height],a<1?(this.renderTexture(e,t,r,i),n.deleteFramebuffer(e.fbo[t]),n.deleteProgram(r.target),e.fbo[t]=null,r.target=null):this.renderQueue.push({rate:a,texture:e,layer:t,program:r,uniforms:i}),e},e.prototype.update=function(){if(this.enabled){this.context.gl;for(var e=this.renderQueue.length-1;e>=0;e--){var t=this.renderQueue[e],r=t.rate,i=t.texture,a=t.layer,n=t.program,o=t.uniforms;this.context.frame%r==0&&this.renderTexture(i,a,n,o)}}},e.prototype.load=function(t,r,i){function a(r,i,a){if(t.model.find((function(e){return e.texture===r.index}))){var n=this.addRenderTexture(this.createRenderTexture(i,a,1),0,s.ShaderProgram(this.context.gl,l.fullscreen_vert,l.bumpmap_frag),{uSampler:r.diffuse,uScale:e.heightmapScale,uScreenSize:[i,a]},0).target;r.normal=n}}for(var n=t.texture.length-1;n>=0;n--){var o=this.materials[n]=new u.MeshMaterial;o.index=n;var c=r.textures[n],f=c.naturalWidth,h=c.naturalHeight,m=s.createTexture(this.context.gl,{width:f,height:h,data:c});o.diffuse=m,a.call(this,o,f,h)}i()},e.prototype.loadTexture=function(){(new Image).crossOrigin="anonymous"},e.pack2x4=function(e,t){return(Math.floor(15*e)+16*Math.floor(15*t))/255},e.unpack2x4=function(e){return[17*e%1,1.0625*e%1]},e.textureSize=256,e.heightmapScale=10,e}();t.MaterialSystem=h},1158:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.MeshMaterial=void 0;var n=r(9479),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.depthTest=515,t.cullFace=1029,t.blendMode=null,t.depthWrite=!0,t}return a(t,e),t.copy=function(e,t){t.diffuse=e.diffuse,t.normal=e.normal,t.array=e.array,t.arrayLayers=e.arrayLayers},t.prototype.bind=function(t){e.prototype.bind.call(this,t),t.activeTexture(33984+n.UniformSamplerBindings.uDiffuseMap),t.bindTexture(3553,this.diffuse),t.activeTexture(33984+n.UniformSamplerBindings.uNormalMap),t.bindTexture(3553,this.normal),this.array&&(t.activeTexture(33984+n.UniformSamplerBindings.uArrayMap),t.bindTexture(35866,this.array),this.program.uniforms.uArrayMapLayers=this.arrayLayers-1)},t.prototype.merge=function(e){return e===this},t}(r(4386).ShaderMaterial);t.MeshMaterial=o},4386:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderMaterial=void 0;var r=function(){function e(){this.depthWrite=!1,this.cullFace=1029,this.depthTest=513,this.blendMode=null,this.program=void 0}return e.prototype.bind=function(e){e.depthMask(this.depthWrite),this.cullFace?(e.enable(2884),e.cullFace(this.cullFace)):e.disable(2884),this.depthTest?(e.enable(2929),e.depthFunc(this.depthTest)):e.disable(2929),this.blendMode?(e.enable(3042),1==this.blendMode[0].length?e.blendEquation(this.blendMode[0][0]):e.blendEquationSeparate(this.blendMode[0][0],this.blendMode[0][1]),2==this.blendMode[1].length?e.blendFunc(this.blendMode[1][0],this.blendMode[1][1]):e.blendFuncSeparate(this.blendMode[1][0],this.blendMode[1][1],this.blendMode[1][2],this.blendMode[1][3])):e.disable(3042)},e.prototype.merge=function(e){return this===e||this.program===e.program&&this.depthWrite===e.depthWrite&&this.depthTest===e.depthTest&&this.cullFace===e.cullFace&&this.blendMode===e.blendMode},e.Add=[[32774],[1,1]],e.Blend=[[32774],[770,771,0,1]],e.Premultiply=[[32774],[1,771,0,1]],e}();t.ShaderMaterial=r},9023:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteMaterial=void 0;var n=r(4454),o=r(4386),s=function(e){function t(t){void 0===t&&(t=n.vec4(0,0,1,1));var r=e.call(this)||this;return r.uvTransform=t,r.size=n.vec2(1,1),r.uvMatrix=n.mat3x2(),r.depthTest=515,r.blendMode=o.ShaderMaterial.Premultiply,r}return a(t,e),t.calculateUVMatrix=function(e,t,r){return r[0]=(e[2]-e[0]-1)/t[0],r[1]=0,r[2]=0,r[3]=(e[3]-e[1]-1)/t[1],r[4]=(e[0]+.5)/t[0],r[5]=(e[1]+.5)/t[1],r},t.applyTransform=function(e,t,r,i){void 0===i&&(i=0);for(var a=t[0],n=t[1],o=t[2],s=t[3],c=t[4],l=t[5],u=e.length-1;u>0;u-=2){var f=e[u-1],h=e[u];r[i+u-1]=a*f+o*h+c,r[i+u]=n*f+s*h+l}},t.copy=function(e,t){return t.diffuse=e.diffuse,t.normal=e.normal,t.cullFace=e.cullFace,t.blendMode=e.blendMode,n.mat3x2.copy(e.uvMatrix,t.uvMatrix),n.vec2.copy(e.size,t.size),t},t.create=function(e,r,i){var a=new t;return t.calculateUVMatrix(r,i,a.uvMatrix),n.vec2.set(r[2]-r[0],r[3]-r[1],a.size),a.diffuse=e,a.cullFace=0,a},t.prototype.bind=function(t){e.prototype.bind.call(this,t),"uUVTransform"in this.program.uniforms&&(this.program.uniforms.uUVTransform=this.uvTransform)},t.prototype.merge=function(t){return e.prototype.merge.call(this,t)&&("uSamplers"in this.program.uniforms||this.diffuse===t.diffuse)},t}(o.ShaderMaterial);t.SpriteMaterial=s},451:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TextureAtlas=t.BoxPacker=void 0;var n=r(4454),o=function(){function e(e,t,r){void 0===r&&(r=0),this.padding=r,this.size=n.vec2(),this.empty=[],n.vec2.set(e,t,this.size),this.empty.push(n.aabb2(0,0,e,t))}return e.prototype.insert=function(e,t){e+=this.padding,t+=this.padding;for(var r=this.empty.length-1;r>=0;r--){var i=this.empty[r],a=i[2]-i[0]-e,o=i[3]-i[1]-t;if(!(a<0||o<0))return 0!=o&&this.empty.push(n.aabb2(i[0],i[1]+t,i[2],i[3])),0!=a&&this.empty.push(n.aabb2(i[0]+e,i[1],i[2],i[1]+t)),r==this.empty.length-1?this.empty.length--:this.empty[r]=this.empty.pop(),n.aabb2.set(i[0],i[1],i[0]+e-this.padding,i[1]+t-this.padding,i)}},e}();t.BoxPacker=o;var s=function(e){function t(t,r,i){var a=e.call(this,r.width,r.height)||this;return a.gl=t,a.texture=r,a.plane=i,a}return a(t,e),t.prototype.render=function(e,t,r,i){var a=this.gl;for(var n in a.bindFramebuffer(36160,this.texture.fbo[0]),a.viewport(e[0],e[1],e[2]-e[0],e[3]-e[1]),i&&(a.enable(3089),a.scissor(e[0],e[1],e[2]-e[0],e[3]-e[1]),a.clearColor(i[0],i[1],i[2],i[3]),a.clear(16384),a.disable(3089)),a.disable(3042),a.useProgram(t.target),r)t.uniforms[n]=r[n];a.bindVertexArray(this.plane.vao),a.drawElements(this.plane.drawMode,this.plane.indexCount,5123,this.plane.indexOffset)},t}(o);t.TextureAtlas=s},3443:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.VectorGraphicsTexture=void 0;var n=r(9479),o=r(451),s=r(9023),c=function(e){function t(t,r,i){var a=e.call(this,r,i,4)||this;return a.gl=t,a.width=r,a.height=i,a.canvas=document.createElement("canvas"),a.ctx=a.canvas.getContext("2d",{alpha:!0}),a.canvas.width=r,a.canvas.height=i,a.ctx.imageSmoothingEnabled=!1,a.texture=n.createTexture(t,{width:r,height:i},{format:32856,wrap:33071,filter:9729,mipmaps:0,type:3553,premultiply:!0}),a}return a(t,e),t.prototype.render=function(e,t,r){for(var i=this.insert(e,t),a=0;a<r.length;a++)this.ctx.save(),this.ctx.setTransform(1,0,0,-1,i[0],i[1]+t),this.renderLayer(r[a]),this.ctx.restore();return s.SpriteMaterial.create(this.texture,i,this.size)},t.prototype.update=function(){this.gl.texSubImage2D(3553,0,0,0,6408,5121,this.canvas)},t.prototype.renderLayer=function(e){var t=e.color,r=e.path,i=e.line,a=e.shadow;if(a&&(this.ctx.shadowBlur=a.blur,this.ctx.shadowOffsetX=a.x,this.ctx.shadowOffsetY=a.y,this.ctx.shadowColor=a.color),i&&(this.ctx.lineWidth=i.width,this.ctx.lineCap=i.cap,this.ctx.lineJoin=i.join,this.ctx.miterLimit=i.miterLimit),"string"==typeof t)this.ctx.fillStyle=this.ctx.strokeStyle=t;else{for(var n="linear"===t.gradient?this.ctx.createLinearGradient(t.x0,t.y0,t.x1,t.y1):this.ctx.createRadialGradient(t.x0,t.y0,t.r0,t.x1,t.y1,t.r1),o=t.stops||t.colors.map((function(e,t,r){return t/(r.length-1)})),s=0;s<t.colors.length;s++)n.addColorStop(o[s],t.colors[s]);this.ctx.fillStyle=this.ctx.strokeStyle=n}i?this.ctx.stroke(new Path2D(r)):this.ctx.fill(new Path2D(r))},t}(o.BoxPacker);t.VectorGraphicsTexture=c},757:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(3248),t),a(r(720),t),a(r(451),t),a(r(3443),t),a(r(4386),t),a(r(1158),t),a(r(9023),t),a(r(8321),t),a(r(3643),t),a(r(4148),t)},9721:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aabb2=void 0,t.aabb2=function(e,r,i,a){return void 0===e&&(e=1/0),void 0===r&&(r=1/0),void 0===i&&(i=-1/0),void 0===a&&(a=-1/0),t.aabb2.set(e,r,i,a,new Float32Array(4))},t.aabb2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.aabb2.set=function(e,t,r,i,a){return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a},t.aabb2.overlap=function(e,t){return e[0]<=t[2]&&e[1]<=t[3]&&e[2]>=t[0]&&e[3]>=t[1]},t.aabb2.contains=function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[2]&&e[3]>=t[3]},t.aabb2.add=function(e,t,r){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r},t.aabb2.intersect=function(e,t,r){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.min(e[3],t[3]),r},t.aabb2.pad=function(e,t,r){return r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]+t,r[3]=e[3]+t,r},t.aabb2.inside=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[0]<e[2]&&t[1]<e[3]},t.aabb2.INFINITE=t.aabb2()},599:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aabb3=void 0,t.aabb3=function(e,r,i,a,n,o){return void 0===e&&(e=1/0),void 0===r&&(r=1/0),void 0===i&&(i=1/0),void 0===a&&(a=-1/0),void 0===n&&(n=-1/0),void 0===o&&(o=1/0),t.aabb3.set(e,r,i,a,n,o,new Float32Array(6))},t.aabb3.set=function(e,t,r,i,a,n,o){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=a,o[5]=n,o},t.aabb3.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.aabb3.overlap=function(e,t){return e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]&&e[3]>=t[0]&&e[4]>=t[1]&&e[5]>=t[2]},t.aabb3.contains=function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]<=t[2]&&e[3]>=t[3]&&e[4]>=t[4]&&e[5]>=t[5]},t.aabb3.add=function(e,t,r){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r[4]=Math.max(e[4],t[4]),r[5]=Math.max(e[5],t[5]),r},t.aabb3.insert=function(e,t,r){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1]),r[5]=Math.max(e[5],t[2]),r},t.aabb3.calculate=function(e,r,i,a){t.aabb3.set(1/0,1/0,1/0,-1/0,-1/0,-1/0,a);for(var n=0;n<e.length;n+=r)a[0]=Math.min(a[0],e[n+i+0]),a[1]=Math.min(a[1],e[n+i+1]),a[2]=Math.min(a[2],e[n+i+2]),a[3]=Math.max(a[3],e[n+i+0]),a[4]=Math.max(a[4],e[n+i+1]),a[5]=Math.max(a[5],e[n+i+2]);return a},t.aabb3.INFINITE=t.aabb3()},3297:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.solveQuadratic=t.insertionSort=t.binarySearch=t.unpairSzudzik=t.pairSzudzik=t.unpairCantor=t.pairCantor=t.hashString=t.int32pow2Floor=t.int32pow2Ceil=t.int32pow2=t.range=t.smootherstep=t.smoothstep=t.lerpAngle=t.moddelta=t.mod=t.clamp=t.lerp=void 0,t.lerp=function(e,t,r){return e+(t-e)*r},t.clamp=function(e,t,r){return Math.min(r,Math.max(t,e))},t.mod=function(e,t){return(e%t+t)%t},t.moddelta=function(e,t,r){var i=(r-t)%e;return 2*i%e-i},t.lerpAngle=function(e,r,i){return e+t.moddelta(2*Math.PI,e,r)*i},t.smoothstep=function(e,r,i){return e===r?i<e?0:1:(i=t.clamp((i-e)/(r-e),0,1))*i*(3-2*i)},t.smootherstep=function(e,r,i){return(i=t.clamp((i-e)/(r-e),0,1))*i*i*(i*(6*i-15)+10)},t.range=function(e,t,r){void 0===r&&(r=[]),null==t&&(t=e,e=0);for(var i=e,a=0;i<t;i++,a++)r[a]=i;return r},t.int32pow2=function(e){return!(e&e-1||!e)},t.int32pow2Ceil=function(e){return e+=+(0===e),--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)},t.int32pow2Floor=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.hashString=function(e){for(var t=0,r=e.length,i=0;i<r;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t},t.pairCantor=function(e,t){return((e=e>=0?2*e:2*-e-1)+(t=t>=0?2*t:2*-t-1))*(e+t+1)/2+e},t.unpairCantor=function(e,t){var r=Math.floor((Math.floor(Math.sqrt(1+8*e))-1)/2);return t[0]=e-r*(r+1)/2,t[1]=r*(r+3)/2-e,t[0]=t[0]%2==0?t[0]/2:(t[0]+1)/-2,t[1]=t[1]%2==0?t[1]/2:(t[1]+1)/-2,t},t.pairSzudzik=function(e,t){return(e=e>=0?2*e:2*-e-1)>=(t=t>=0?2*t:2*-t-1)?e*e+e+t:t*t+e},t.unpairSzudzik=function(e,t){var r=0|Math.sqrt(e),i=r*r;return t[0]=e-i>=r?r:e-i,t[1]=e-i>=r?e-i-r:r,t[0]=t[0]%2==0?t[0]/2:(t[0]+1)/-2,t[1]=t[1]%2==0?t[1]/2:(t[1]+1)/-2,t},t.binarySearch=function(e,t,r,i){for(var a=0,n=e.length;a<n;){var o=a+n>>>1;(i?r(e[o],t)<=0:r(e[o],t)<0)?a=o+1:n=o}return i?n:a},t.insertionSort=function(e,t){for(var r=e.length,i=void 0,a=0;a<r;a++){var n=e[a];for(i=a-1;i>=0&&t(n,e[i])>0;i--)e[i+1]=e[i];e[i+1]=n}},t.solveQuadratic=function(e,t,r){var i=t*t-4*e*r;if(i<0)return-1;var a=-.5*(t+Math.sign(t)*Math.sqrt(i));return Math.max(a/e,r/a)}},3331:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cubicBezierNormal3D=t.quadraticBezierNormal3D=t.cubicBezier3D=t.quadraticBezier3D=void 0,t.quadraticBezier3D=function(e,t,r,i,a){var n=i*i,o=1-i,s=o*o;return a[0]=s*e[0]+2*i*o*t[0]+n*r[0],a[1]=s*e[1]+2*i*o*t[1]+n*r[1],a[2]=s*e[2]+2*i*o*t[2]+n*r[2],a},t.cubicBezier3D=function(e,t,r,i,a,n){var o=a*a,s=a*a*a,c=1-a,l=c*c,u=l*c;return n[0]=u*e[0]+3*a*l*t[0]+3*o*c*r[0]+s*i[0],n[1]=u*e[1]+3*a*l*t[1]+3*o*c*r[1]+s*i[1],n[2]=u*e[2]+3*a*l*t[2]+3*o*c*r[2]+s*i[2],n},t.quadraticBezierNormal3D=function(e,t,r,i,a){return a[0]=2*(1-i)*(t[0]-e[0])+2*i*(r[0]-t[0]),a[1]=2*(1-i)*(t[1]-e[1])+2*i*(r[1]-t[1]),a[2]=2*(1-i)*(t[2]-e[2])+2*i*(r[2]-t[2]),a},t.cubicBezierNormal3D=function(e,t,r,i,a,n){var o=a*a,s=1-a,c=s*s;return n[0]=3*c*(t[0]-e[0])+6*s*a*(r[0]-t[0])+3*o*(i[0]-r[0]),n[1]=3*c*(t[1]-e[1])+6*s*a*(r[1]-t[1])+3*o*(i[1]-r[1]),n[2]=3*c*(t[2]-e[2])+6*s*a*(r[2]-t[2])+3*o*(i[2]-r[2]),n}},1451:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dualquat=void 0,t.dualquat=function(){return t.dualquat.set(0,0,0,1,0,0,0,0,new Float32Array(8))},t.dualquat.set=function(e,t,r,i,a,n,o,s,c){return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=a,c[5]=n,c[6]=o,c[7]=s,c},t.dualquat.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},t.dualquat.slerp=function(e,t,r,i){var a=e[0],n=e[1],o=e[2],s=e[3],c=t[0],l=t[1],u=t[2],f=t[3],h=e[4],m=e[5],d=e[6],p=e[7];return a*c+n*l+o*u+s*f<0?(i[0]=r*(c+a)-a,i[1]=r*(l+n)-n,i[2]=r*(u+o)-o,i[3]=r*(f+s)-s,i[4]=-h+r*(t[4]+h),i[5]=-m+r*(t[5]+m),i[6]=-d+r*(t[6]+d),i[7]=-p+r*(t[7]+p)):(i[0]=a+r*(c-a),i[1]=n+r*(l-n),i[2]=o+r*(u-o),i[3]=s+r*(f-s),i[4]=h+r*(t[4]-h),i[5]=m+r*(t[5]-m),i[6]=d+r*(t[6]-d),i[7]=p+r*(t[7]-p)),i},t.dualquat.fromRotationTranslation=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=e[3],s=.5*t[0],c=.5*t[1],l=.5*t[2];return r[0]=i,r[1]=a,r[2]=n,r[3]=o,r[4]=+s*o+c*n-l*a,r[5]=-s*n+c*o+l*i,r[6]=+s*a-c*i+l*o,r[7]=-s*i-c*a-l*n,r},t.dualquat.multiply=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=e[3],s=t[4],c=t[5],l=t[6],u=t[7],f=e[4],h=e[5],m=e[6],d=e[7],p=t[0],v=t[1],y=t[2],g=t[3];return r[0]=i*g+o*p+a*y-n*v,r[1]=a*g+o*v+n*p-i*y,r[2]=n*g+o*y+i*v-a*p,r[3]=o*g-i*p-a*v-n*y,r[4]=i*u+o*s+a*l-n*c+f*g+d*p+h*y-m*v,r[5]=a*u+o*c+n*s-i*l+h*g+d*v+m*p-f*y,r[6]=n*u+o*l+i*c-a*s+m*g+d*y+f*v-h*p,r[7]=o*u-i*s-a*c-n*l+d*g-f*p-h*v-m*y,r}},4454:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(3297),t),a(r(488),t),a(r(5133),t),a(r(1495),t),a(r(5894),t),a(r(7418),t),a(r(1727),t),a(r(1653),t),a(r(2238),t),a(r(1451),t),a(r(9721),t),a(r(599),t),a(r(4103),t),a(r(3331),t)},5894:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat2=void 0,t.mat2=function(){return t.mat2.identity(new Float32Array(4))},t.mat2.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.mat2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.mat2.transpose=function(e,t){var r=e[1];return t[1]=e[2],t[2]=r,t===e||(t[0]=e[0],t[3]=e[3]),t},t.mat2.invert=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=r*n-a*i;return o=o?1/o:0,t[0]=n*o,t[1]=-i*o,t[2]=-a*o,t[3]=r*o,t},t.mat2.multiply=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=e[3],s=t[0],c=t[1],l=t[2],u=t[3];return r[0]=i*s+n*c,r[1]=a*s+o*c,r[2]=i*l+n*u,r[3]=a*l+o*u,r},t.mat2.transform=function(e,t,r){var i=e[0],a=e[1];return r[0]=t[0]*i+t[2]*a,r[1]=t[1]*i+t[3]*a,r}},1727:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=void 0,t.mat3=function(){return t.mat3.identity(new Float32Array(9))},t.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.mat3.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.mat3.transpose=function(e,t){var r=e[1];return t[1]=e[3],t[3]=r,r=e[2],t[2]=e[6],t[6]=r,r=e[5],t[5]=e[7],t[7]=r,t===e||(t[0]=e[0],t[4]=e[4],t[8]=e[8]),t},t.mat3.invert=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],f=u*o-s*l,h=-u*n+s*c,m=l*n-o*c,d=r*f+i*h+a*m;return d=d?1/d:0,t[0]=f*d,t[1]=(-u*i+a*l)*d,t[2]=(s*i-a*o)*d,t[3]=h*d,t[4]=(u*r-a*c)*d,t[5]=(-s*r+a*n)*d,t[6]=m*d,t[7]=(-l*r+i*c)*d,t[8]=(o*r-i*n)*d,t},t.mat3.multiply=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=e[3],s=e[4],c=e[5],l=e[6],u=e[7],f=e[8],h=t[0],m=t[1],d=t[2];return r[0]=h*i+m*o+d*l,r[1]=h*a+m*s+d*u,r[2]=h*n+m*c+d*f,h=t[3],m=t[4],d=t[5],r[3]=h*i+m*o+d*l,r[4]=h*a+m*s+d*u,r[5]=h*n+m*c+d*f,h=t[6],m=t[7],d=t[8],r[6]=h*i+m*o+d*l,r[7]=h*a+m*s+d*u,r[8]=h*n+m*c+d*f,r},t.mat3.fromMat3x2=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},t.mat3.fromMat4=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.mat3.fromQuat=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=2*r,s=2*i,c=2*a,l=r*o,u=i*s,f=a*c,h=r*s,m=r*c,d=i*c,p=n*o,v=n*s,y=n*c;return t[0]=1-u-f,t[1]=h+y,t[2]=m-v,t[3]=h-y,t[4]=1-l-f,t[5]=d+p,t[6]=m+v,t[7]=d-p,t[8]=1-l-u,t},t.mat3.transform=function(e,t,r){var i=e[0],a=e[1],n=e[2];return r[0]=t[0]*i+t[3]*a+t[6]*n,r[1]=t[1]*i+t[4]*a+t[7]*n,r[2]=t[2]*i+t[5]*a+t[8]*n,r},t.mat3.normalize=function(e,t){var r=Math.hypot(e[0],e[1],e[2]);r=r&&1/r;var i=Math.hypot(e[3],e[4],e[5]);i=i&&1/i;var a=Math.hypot(e[6],e[7],e[8]);return a=a&&1/a,t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*a,t},t.mat3.normalMatrix=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[4],o=e[5],s=e[6],c=e[8],l=e[9],u=e[10];return t[0]=o*u-s*l,t[1]=s*c-n*u,t[2]=n*l-o*c,t[3]=a*l-i*u,t[4]=r*u-a*c,t[5]=i*c-r*l,t[6]=i*s-a*o,t[7]=a*n-r*s,t[8]=r*o-i*n,t},t.mat3.orthonormal=function(e,r){var i=e[2]>=0?1:-1,a=-1/(i+e[2]),n=e[0]*e[1]*a;return r[0]=1+i*e[0]*e[0]*a,r[1]=i*n,r[2]=-i*e[0],r[3]=n,r[4]=i+e[1]*e[1]*a,r[5]=-e[1],r[6]=e[0],r[7]=e[1],r[8]=e[2],t.mat3.normalize(r,r),r},t.mat3.rotation=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=Math.sin(t),s=Math.cos(t),c=1-s,l=i*a*c,u=i*n*c,f=a*n*c;return r[0]=i*i*c+s,r[1]=l+n*o,r[2]=u-a*o,r[3]=l-n*o,r[4]=a*a*c+s,r[5]=f+i*o,r[6]=u+a*o,r[7]=f-i*o,r[8]=n*n*c+s,r},t.mat3.IDENTITY=t.mat3()},7418:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3x2=void 0,t.mat3x2=function(){return t.mat3x2.identity(new Float32Array(6))},t.mat3x2.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.mat3x2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.mat3x2.invert=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=e[4],s=e[5],c=r*n-i*a,l=c&&1/c;return t[0]=n*l,t[1]=-i*l,t[2]=-a*l,t[3]=r*l,t[4]=(a*s-n*o)*l,t[5]=(i*o-r*s)*l,t},t.mat3x2.multiply=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=e[3],s=t[0],c=t[1],l=t[2],u=t[3],f=t[4],h=t[5];return r[0]=i*s+n*c,r[1]=a*s+o*c,r[2]=i*l+n*u,r[3]=a*l+o*u,r[4]=i*f+n*h+e[4],r[5]=a*f+o*h+e[5],r},t.mat3x2.orthogonal=function(e,t,r,i,a){var n=1/(e-t),o=1/(r-i);return a[0]=-2*n,a[1]=0,a[2]=0,a[3]=-2*o,a[4]=(e+t)*n,a[5]=(i+r)*o,a},t.mat3x2.transform=function(e,t,r){var i=e[0],a=e[1];return r[0]=t[0]*i+t[2]*a+t[4],r[1]=t[1]*i+t[3]*a+t[5],r},t.mat3x2.fromTransform=function(e,t,r,i,a,n,o,s,c,l){return l[0]=Math.cos(o+c)*a,l[1]=Math.sin(o+c)*a,l[2]=-Math.sin(o-s)*n,l[3]=Math.cos(o-s)*n,l[4]=e-r*l[0]-i*l[2],l[5]=t-r*l[1]-i*l[3],l},t.mat3x2.IDENTITY=t.mat3x2()},1653:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat4=void 0,t.mat4=function(){return t.mat4.identity(new Float32Array(16))},t.mat4.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.mat4.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.mat4.transpose=function(e,t){var r=e[1];return t[1]=e[4],t[4]=r,r=e[2],t[2]=e[8],t[8]=r,r=e[3],t[3]=e[12],t[12]=r,r=e[6],t[6]=e[9],t[9]=r,r=e[7],t[7]=e[13],t[13]=r,r=e[11],t[11]=e[14],t[14]=r,t===e||(t[0]=e[0],t[5]=e[5],t[10]=e[10],t[15]=e[15]),t},t.mat4.invert=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],f=e[9],h=e[10],m=e[11],d=e[12],p=e[13],v=e[14],y=e[15],g=r*s-i*o,x=r*c-a*o,b=r*l-n*o,S=i*c-a*s,P=i*l-n*s,O=a*l-n*c,T=u*p-f*d,w=u*v-h*d,_=u*y-m*d,A=f*v-h*p,E=f*y-m*p,M=h*y-m*v,I=g*M-x*E+b*A+S*_-P*w+O*T;return I=I?1/I:0,t[0]=(s*M-c*E+l*A)*I,t[1]=(a*E-i*M-n*A)*I,t[2]=(p*O-v*P+y*S)*I,t[3]=(h*P-f*O-m*S)*I,t[4]=(c*_-o*M-l*w)*I,t[5]=(r*M-a*_+n*w)*I,t[6]=(v*b-d*O-y*x)*I,t[7]=(u*O-h*b+m*x)*I,t[8]=(o*E-s*_+l*T)*I,t[9]=(i*_-r*E-n*T)*I,t[10]=(d*P-p*b+y*g)*I,t[11]=(f*b-u*P-m*g)*I,t[12]=(s*w-o*A-c*T)*I,t[13]=(r*A-i*w+a*T)*I,t[14]=(p*x-d*S-v*g)*I,t[15]=(u*S-f*x+h*g)*I,t},t.mat4.multiply=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=e[3],s=e[4],c=e[5],l=e[6],u=e[7],f=e[8],h=e[9],m=e[10],d=e[11],p=e[12],v=e[13],y=e[14],g=e[15],x=t[0],b=t[1],S=t[2],P=t[3];return r[0]=x*i+b*s+S*f+P*p,r[1]=x*a+b*c+S*h+P*v,r[2]=x*n+b*l+S*m+P*y,r[3]=x*o+b*u+S*d+P*g,x=t[4],b=t[5],S=t[6],P=t[7],r[4]=x*i+b*s+S*f+P*p,r[5]=x*a+b*c+S*h+P*v,r[6]=x*n+b*l+S*m+P*y,r[7]=x*o+b*u+S*d+P*g,x=t[8],b=t[9],S=t[10],P=t[11],r[8]=x*i+b*s+S*f+P*p,r[9]=x*a+b*c+S*h+P*v,r[10]=x*n+b*l+S*m+P*y,r[11]=x*o+b*u+S*d+P*g,x=t[12],b=t[13],S=t[14],P=t[15],r[12]=x*i+b*s+S*f+P*p,r[13]=x*a+b*c+S*h+P*v,r[14]=x*n+b*l+S*m+P*y,r[15]=x*o+b*u+S*d+P*g,r},t.mat4.fromEulerRotation=function(e,t,r,i){var a=Math.sin(e),n=Math.sin(t),o=Math.sin(r),s=Math.cos(e),c=Math.cos(t),l=Math.cos(r);return i[0]=c*l,i[1]=c*o,i[2]=-n,i[3]=0,i[4]=a*n*l-s*o,i[5]=a*n*o+s*l,i[6]=a*c,i[7]=0,i[8]=s*n*l+a*o,i[9]=s*n*o-a*l,i[10]=s*c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},t.mat4.perspective=function(e,t,r,i,a){var n=1/Math.tan(e/2),o=1/(r-i);return a[0]=n/t,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(i+r)*o,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*i*r*o,a[15]=0,a},t.mat4.transform=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=null==e[3]?1:e[3];return r[0]=t[0]*i+t[4]*a+t[8]*n+t[12]*o,r[1]=t[1]*i+t[5]*a+t[9]*n+t[13]*o,r[2]=t[2]*i+t[6]*a+t[10]*n+t[14]*o,r[3]=t[3]*i+t[7]*a+t[11]*n+t[15]*o,r},t.mat4.transformNormal=function(e,t,r){var i=e[0],a=e[1],n=e[2];return r[0]=t[0]*i+t[4]*a+t[8]*n,r[1]=t[1]*i+t[5]*a+t[9]*n,r[2]=t[2]*i+t[6]*a+t[10]*n,r},t.mat4.orthogonal=function(e,t,r,i,a,n,o){var s=1/(e-t),c=1/(r-i),l=1/(a-n);return o[0]=-2*s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*c,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*l,o[11]=0,o[12]=(e+t)*s,o[13]=(i+r)*c,o[14]=(n+a)*l,o[15]=1,o},t.mat4.translate=function(e,t,r){var i=t[0],a=t[1],n=t[2];return r[12]=e[0]*i+e[4]*a+e[8]*n+e[12],r[13]=e[1]*i+e[5]*a+e[9]*n+e[13],r[14]=e[2]*i+e[6]*a+e[10]*n+e[14],r[15]=e[3]*i+e[7]*a+e[11]*n+e[15],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11]),r},t.mat4.scale=function(e,t,r){var i=t[0],a=t[1],n=t[2];return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*a,r[5]=e[5]*a,r[6]=e[6]*a,r[7]=e[7]*a,r[8]=e[8]*n,r[9]=e[9]*n,r[10]=e[10]*n,r[11]=e[11]*n,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},t.mat4.rotate=function(e,t,r,i){var a=r[0],n=r[1],o=r[2],s=Math.sin(t),c=Math.cos(t),l=1-c,u=e[0],f=e[1],h=e[2],m=e[3],d=e[4],p=e[5],v=e[6],y=e[7],g=e[8],x=e[9],b=e[10],S=e[11],P=a*a*l+c,O=n*a*l+o*s,T=o*a*l-n*s,w=a*n*l-o*s,_=n*n*l+c,A=o*n*l+a*s,E=a*o*l+n*s,M=n*o*l-a*s,I=o*o*l+c;return i[0]=u*P+d*O+g*T,i[1]=f*P+p*O+x*T,i[2]=h*P+v*O+b*T,i[3]=m*P+y*O+S*T,i[4]=u*w+d*_+g*A,i[5]=f*w+p*_+x*A,i[6]=h*w+v*_+b*A,i[7]=m*w+y*_+S*A,i[8]=u*E+d*M+g*I,i[9]=f*E+p*M+x*I,i[10]=h*E+v*M+b*I,i[11]=m*E+y*M+S*I,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},t.mat4.fromRotationTranslationScale=function(e,t,r,i){var a=e[0],n=e[1],o=e[2],s=e[3],c=a+a,l=n+n,u=o+o,f=a*c,h=a*l,m=a*u,d=n*l,p=n*u,v=o*u,y=s*c,g=s*l,x=s*u,b=r[0],S=r[1],P=r[2];return i[0]=(1-(d+v))*b,i[1]=(h+x)*b,i[2]=(m-g)*b,i[3]=0,i[4]=(h-x)*S,i[5]=(1-(f+v))*S,i[6]=(p+y)*S,i[7]=0,i[8]=(m+g)*P,i[9]=(p-y)*P,i[10]=(1-(f+d))*P,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i},t.mat4.lookAt=function(e,t,r,i){var a=e[0],n=e[1],o=e[2],s=t[0],c=t[1],l=t[2],u=r[0],f=r[1],h=r[2],m=a-s,d=n-c,p=o-l,v=Math.sqrt(m*m+d*d+p*p),y=v?1/v:0,g=f*(p*=y)-h*(d*=y),x=h*(m*=y)-u*p,b=u*d-f*m,S=d*(b*=y=(v=Math.sqrt(g*g+x*x+b*b))?1/v:0)-p*(x*=y),P=p*(g*=y)-m*b,O=m*x-d*g;return S*=y=(v=Math.sqrt(S*S+P*P+O*O))?1/v:0,P*=y,O*=y,i[0]=g,i[1]=S,i[2]=m,i[3]=0,i[4]=x,i[5]=P,i[6]=d,i[7]=0,i[8]=b,i[9]=O,i[10]=p,i[11]=0,i[12]=-(g*a+x*n+b*o),i[13]=-(S*a+P*n+O*o),i[14]=-(m*a+d*n+p*o),i[15]=1,i},t.mat4.targetTo=function(e,t,r,i){var a=e[0],n=e[1],o=e[2],s=r[0],c=r[1],l=r[2],u=a-t[0],f=n-t[1],h=o-t[2],m=Math.sqrt(u*u+f*f+h*h),d=m?1/m:1,p=c*(h*=d)-l*(f*=d),v=l*(u*=d)-s*h,y=s*f-c*u;return p*=d=(m=Math.sqrt(p*p+v*v+y*y))?1/m:1,v*=d,y*=d,i[0]=p,i[1]=v,i[2]=y,i[3]=0,i[4]=f*y-h*v,i[5]=h*p-u*y,i[6]=u*v-f*p,i[7]=0,i[8]=u,i[9]=f,i[10]=h,i[11]=0,i[12]=a,i[13]=n,i[14]=o,i[15]=1,i},t.mat4.fromDualquat=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=2*r*r,f=2*i*i,h=2*a*a,m=2*r*i,d=2*r*a,p=2*r*n,v=2*i*a,y=2*i*n,g=2*a*n;return t[0]=1-f-h,t[1]=m+g,t[2]=d-y,t[3]=0,t[4]=m-g,t[5]=1-u-h,t[6]=v+p,t[7]=0,t[8]=d+y,t[9]=v-p,t[10]=1-u-f,t[11]=0,t[12]=2*(-l*r+o*n-s*a+c*i),t[13]=2*(-l*i+o*a+s*n-c*r),t[14]=2*(-l*a-o*i+s*r+c*n),t[15]=1,t},t.mat4.decompose=function(e,t,r,i){t[0]=e[12],t[1]=e[13],t[2]=e[14];var a=e[0],n=e[1],o=e[2],s=e[4],c=e[5],l=e[6],u=e[8],f=e[9],h=e[10];r[0]=Math.hypot(a,n,o),r[1]=Math.hypot(s,c,l),r[2]=Math.hypot(u,f,h);var m=r[0]&&1/r[0],d=r[1]&&1/r[1],p=r[2]&&1/r[2];s*=m,u*=m,n*=d,f*=d,o*=p,l*=p;var v=(a*=m)+(c*=d)+(h*=p);if(v>0){var y=2*Math.sqrt(v+1);i[3]=.25*y,i[0]=(l-f)/y,i[1]=(u-o)/y,i[2]=(n-s)/y}else a>c&&a>h?(y=2*Math.sqrt(1+a-c-h),i[3]=(l-f)/y,i[0]=.25*y,i[1]=(n+s)/y,i[2]=(u+o)/y):c>h?(y=2*Math.sqrt(1+c-a-h),i[3]=(u-o)/y,i[0]=(n+s)/y,i[1]=.25*y,i[2]=(l+f)/y):(y=2*Math.sqrt(1+h-a-c),i[3]=(n-s)/y,i[0]=(u+o)/y,i[1]=(l+f)/y,i[2]=.25*y)},t.mat4.IDENTITY=t.mat4()},4103:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.perlin2D=t.randomInt=t.randomFloat=t.mulberry32=t.shuffle=t.noise3D=t.noise2D=t.noise1D=void 0;var i=r(3297),a=198491317;function n(e,t){return e*=3039394381,e+=t,e^=e>>8,e+=1759714724,e^=e>>8,e*=458671337,(e^=e>>8)/2147483647}t.noise1D=n,t.noise2D=function(e,t,r){return n(e+a*t,r)},t.noise3D=function(e,t,r,i){return n(e+a*t+6542989*r,i)},t.shuffle=function(e,t){for(var r=e.length-1;r>0;r--){var i=t()*(r+1)|0,a=e[r];e[r]=e[i],e[i]=a}return e},t.mulberry32=function(e){return void 0===e&&(e=502),function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}},t.randomFloat=function(e,t,r){return r*(t-e)+e},t.randomInt=function(e,t,r){return Math.floor(r*(t-e+1))+e};var o=function(e){return e*e*e*(e*(6*e-15)+10)};function s(e,r,i,a,n){var o=2*Math.PI*t.noise2D(e,r,n);return i*Math.cos(o)+a*Math.sin(o)}t.perlin2D=function(e,t,r){var a=Math.floor(e),n=Math.floor(t),c=s(a,n,e-=a,t-=n,r),l=s(a+1,n,e-1,t,r),u=s(a,n+1,e,t-1,r),f=s(a+1,n+1,e-1,t-1,r),h=o(e),m=o(t);return i.lerp(i.lerp(c,l,h),i.lerp(u,f,h),m)}},2238:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quat=void 0;var i=r(5133),a=r(1495);t.quat=function(){return a.vec4(0,0,0,1)},t.quat.copy=a.vec4.copy,t.quat.set=a.vec4.set,t.quat.normalize=a.vec4.normalize,t.quat.multiply=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=e[3],s=t[0],c=t[1],l=t[2],u=t[3];return r[0]=i*u+o*s+a*l-n*c,r[1]=a*u+o*c+n*s-i*l,r[2]=n*u+o*l+i*c-a*s,r[3]=o*u-i*s-a*c-n*l,r},t.quat.conjugate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.quat.transform=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=t[0],s=t[1],c=t[2],l=t[3],u=l*i+s*n-c*a,f=l*a+c*i-o*n,h=l*n+o*a-s*i,m=-o*i-s*a-c*n;return r[0]=u*l+m*-o+f*-c-h*-s,r[1]=f*l+m*-s+h*-o-u*-c,r[2]=h*l+m*-c+u*-s-f*-o,r[3]=null==e[3]?1:e[3],r},t.quat.slerp=function(e,t,r,i){var a=e[0],n=e[1],o=e[2],s=e[3],c=t[0],l=t[1],u=t[2],f=t[3],h=a*c+n*l+o*u+s*f,m=Math.abs(h),d=1-r,p=r;if(1-m>1e-6){var v=Math.acos(m),y=Math.sin(v);d=Math.sin(d*v)/y,p=Math.sin(p*v)/y}return h<0&&(p*=-1),i[0]=d*a+p*c,i[1]=d*n+p*l,i[2]=d*o+p*u,i[3]=d*s+p*f,i},t.quat.axisAngle=function(e,t,r){var i=Math.sin(t*=.5);return r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=Math.cos(t),r};var n={xyz:[1,-1,1,-1],xzy:[-1,-1,1,1],yxz:[1,-1,-1,1],yzx:[1,1,-1,-1],zxy:[-1,1,1,-1],zyx:[-1,1,-1,1]};t.quat.euler=function(e,t,r,i,a){var o=Math.sin(e*=.5),s=Math.cos(e),c=Math.sin(t*=.5),l=Math.cos(t),u=Math.sin(r*=.5),f=Math.cos(r),h=n[i];return a[0]=o*l*f+h[0]*s*c*u,a[1]=s*c*f+h[1]*o*l*u,a[2]=s*l*u+h[2]*o*c*f,a[3]=s*l*f+h[3]*o*c*u,a},t.quat.extractEuler=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=e[3],s=i*i,c=a*a,l=i*i;switch(t){case"yzx":(u=i*a+n*o)*(f=u<0?-1:1)>.5-Number.EPSILON?(r[1]=2*f*Math.atan2(i,o),r[2]=.5*f*Math.PI,r[0]=0):(r[1]=Math.atan2(2*a*o-2*i*n,1-2*c-2*l),r[2]=Math.asin(2*u),r[0]=Math.atan2(2*i*o-2*a*n,1-2*s-2*l));break;case"xyz":var u,f;(u=i*o-a*n)*(f=u<0?-1:1)>.5-Number.EPSILON?(r[1]=2*f*Math.atan2(a,i),r[0]=.5*f*Math.PI,r[2]=0):(r[1]=Math.atan2(2*o*a+2*n*i,1-2*s-2*c),r[0]=Math.asin(2*u),r[2]=Math.atan2(2*o*n+2*i*a,1-2*l-2*s))}return r},t.quat.rotation=function(e,r,a){var n=i.vec3.dot(e,r),o=Math.sqrt(i.vec3.magnitudeSquared(e)*i.vec3.magnitudeSquared(r)),s=n/o;return s>=1?t.quat.copy(t.quat.IDENTITY,a):s<=-1?(i.vec3.orthogonal(e,a),i.vec3.normalize(a,a),a[3]=0,a):(i.vec3.cross(e,r,a),a[3]=o+n,t.quat.normalize(a,a))},t.quat.unitRotation=function(e,r,a){var n=i.vec3.dot(e,r);return n>=1?t.quat.copy(t.quat.IDENTITY,a):(n<=-1?(i.vec3.orthogonal(e,a),a[3]=0):(i.vec3.cross(e,r,a),a[3]=1+n),t.quat.normalize(a,a))},t.quat.fromNormal=function(e,t,r){var a=e[0],n=e[1],o=e[2],s=r;i.vec3.cross(t,e,s),i.vec3.normalize(s,s);var c=s[0],l=s[1],u=s[2];i.vec3.cross(e,s,s);var f=s[0],h=s[1],m=s[2],d=c+h+o;if(d>0){var p=.5/Math.sqrt(d+1);r[0]=(m-n)*p,r[1]=(a-u)*p,r[2]=(l-f)*p,r[3]=.25/p}else c>=h&&c>=o?(p=.5/Math.sqrt(1+c-h-o),r[0]=.25/p,r[1]=(l+f)*p,r[2]=(u+a)*p,r[3]=(m-n)*p):h>o?(p=.5/Math.sqrt(1+h-c-o),r[0]=(f+l)*p,r[1]=.25/p,r[2]=(n+m)*p,r[3]=(a-u)*p):(p=.5/Math.sqrt(1+o-c-h),r[0]=(a+u)*p,r[1]=(n+m)*p,r[2]=.25/p,r[3]=(l-f)*p);return r},t.quat.angle=function(e,t){var r=a.vec4.dot(e,t);return Math.acos(2*r*r-1)},t.quat.pow=function(e,t,r){var a=2*Math.acos(e[3]);i.vec3.normalize(e,r);var n=Math.cos(.5*t*a),o=Math.sin(.5*t*a);return r[0]*=o,r[1]*=o,r[2]*=o,r[3]=n,r},t.quat.decompose=function(e,r,n,o){var s=i.vec3.dot(r,e);if(i.vec3.scale(r,s,o),o[3]=e[3],a.vec4.dot(o,o)<Number.EPSILON)return t.quat.copy(e,n),void t.quat.copy(t.quat.IDENTITY,o);t.quat.normalize(o,o),t.quat.conjugate(o,n),t.quat.multiply(e,n,n)},t.quat.IDENTITY=t.quat(),t.quat.HALF_X=t.quat.axisAngle(i.vec3.AXIS_X,.5*Math.PI,t.quat()),t.quat.HALF_Y=t.quat.axisAngle(i.vec3.AXIS_Y,.5*Math.PI,t.quat()),t.quat.HALF_Z=t.quat.axisAngle(i.vec3.AXIS_Z,.5*Math.PI,t.quat()),t.quat.HALF_N_X=t.quat.axisAngle(i.vec3.AXIS_X,-.5*Math.PI,t.quat()),t.quat.HALF_N_Y=t.quat.axisAngle(i.vec3.AXIS_Y,-.5*Math.PI,t.quat()),t.quat.HALF_N_Z=t.quat.axisAngle(i.vec3.AXIS_Z,-.5*Math.PI,t.quat())},488:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec2=void 0,t.vec2=function(e,r){return void 0===e&&(e=0),void 0===r&&(r=e),t.vec2.set(e,r,new Float32Array(2))},t.vec2.set=function(e,t,r){return r[0]=e,r[1]=t,r},t.vec2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t},t.vec2.cross=function(e,t){return e[0]*t[1]-e[1]*t[0]},t.vec2.rotate=function(e,t,r){var i=Math.cos(t),a=Math.sin(t),n=e[0],o=e[1];return r[0]=i*n-a*o,r[1]=a*n+i*o,r},t.vec2.rotate90cw=function(e,t){var r=-e[0];return t[0]=e[1],t[1]=r,t},t.vec2.rotate90ccw=function(e,t){var r=-e[1];return t[1]=e[0],t[0]=r,t},t.vec2.add=function(e,t,r){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r},t.vec2.subtract=function(e,t,r){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r},t.vec2.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r},t.vec2.divide=function(e,t,r){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r},t.vec2.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r},t.vec2.distanceSquared=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i},t.vec2.distance=function(e,r){return Math.sqrt(t.vec2.distanceSquared(e,r))},t.vec2.manhattan=function(e,t){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])},t.vec2.magnitudeSquared=function(e){return e[0]*e[0]+e[1]*e[1]},t.vec2.magnitude=function(e){return Math.sqrt(t.vec2.magnitudeSquared(e))},t.vec2.normalize=function(e,t){var r=e[0],i=e[1],a=r*r+i*i,n=a&&1/Math.sqrt(a);return t[0]=r*n,t[1]=i*n,t},t.vec2.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.vec2.lerp=function(e,t,r,i){return i[0]=e[0]+r*(t[0]-e[0]),i[1]=e[1]+r*(t[1]-e[1]),i},t.vec2.reflect=function(e,t,r){var i=e[0]*t[0]+e[1]*t[1];return r[0]=e[0]-2*t[0]*i,r[1]=e[1]-2*t[1]*i,r},t.vec2.angle=function(e,r){return Math.acos(t.vec2.dot(e,r))},t.vec2.rotation=function(e){return Math.atan2(e[1],e[0])},t.vec2.equals=function(e,t,r){return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r},t.vec2.ZERO=t.vec2(0,0),t.vec2.HALF=t.vec2(.5,.5),t.vec2.ONE=t.vec2(1,1),t.vec2.AXIS_Y=t.vec2(0,1),t.vec2.AXIS_X=t.vec2(1,0)},5133:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=void 0,t.vec3=function(e,r,i){return void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),t.vec3.set(e,r,i,new Float32Array(3))},t.vec3.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.vec3.set=function(e,t,r,i){return i[0]=e,i[1]=t,i[2]=r,i},t.vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},t.vec3.subtract=function(e,t,r){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r},t.vec3.add=function(e,t,r){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r},t.vec3.cross=function(e,t,r){var i=e[0],a=e[1],n=e[2],o=t[0],s=t[1],c=t[2];return r[0]=a*c-n*s,r[1]=n*o-i*c,r[2]=i*s-a*o,r},t.vec3.magnitudeSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},t.vec3.distanceSquared=function(e,t){var r=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2];return r*r+i*i+a*a},t.vec3.magnitude=function(e){return Math.sqrt(t.vec3.magnitudeSquared(e))},t.vec3.distance=function(e,r){return Math.sqrt(t.vec3.distanceSquared(e,r))},t.vec3.normalize=function(e,t){var r=e[0],i=e[1],a=e[2],n=r*r+i*i+a*a,o=n&&1/Math.sqrt(n);return t[0]=r*o,t[1]=i*o,t[2]=a*o,t},t.vec3.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r},t.vec3.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r},t.vec3.lerp=function(e,t,r,i){return i[0]=e[0]+r*(t[0]-e[0]),i[1]=e[1]+r*(t[1]-e[1]),i[2]=e[2]+r*(t[2]-e[2]),i},t.vec3.angle=function(e,r){var i=Math.sqrt(t.vec3.magnitudeSquared(e)*t.vec3.magnitudeSquared(r)),a=i&&t.vec3.dot(e,r)/i;return Math.acos(Math.min(Math.max(a,-1),1))},t.vec3.random=function(e,t,r){return e=2*e*Math.PI,t=2*t-1,r[2]=t,t=Math.sqrt(1-t*t),r[0]=Math.cos(e)*t,r[1]=Math.sin(e)*t,r},t.vec3.equals=function(e,t,r){return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r},t.vec3.orthogonal=function(e,r){var i=Math.abs(e[0]),a=Math.abs(e[1]),n=Math.abs(e[2]),o=i<a?i<n?t.vec3.AXIS_X:t.vec3.AXIS_Z:a<n?t.vec3.AXIS_Y:t.vec3.AXIS_Z;return t.vec3.cross(e,o,r),r},t.vec3.slerp=function(e,r,i,a){var n=t.vec3.angle(e,r),o=Math.sin(n),s=Math.sin((1-i)*n)/o,c=Math.sin(i*n)/o;return a[0]=e[0]*s+r[0]*c,a[1]=e[1]*s+r[1]*c,a[2]=e[2]*s+r[2]*c,a},t.vec3.project=function(e,r,i){var a=t.vec3.magnitudeSquared(r),n=a&&t.vec3.dot(e,r)/a;return t.vec3.scale(r,n,i)},t.vec3.projectPlane=function(e,r,i){var a=t.vec3.dot(e,r);return i[0]=e[0]-r[0]*a,i[1]=e[1]-r[1]*a,i[2]=e[2]-r[2]*a,i},t.vec3.centroid=function(){for(var e=arguments.length-1,t=1/e,r=0,i=0,a=0,n=e-1;n>=0;n--)r+=arguments[n][0],i+=arguments[n][1],a+=arguments[n][2];return arguments[e][0]=r*t,arguments[e][1]=i*t,arguments[e][2]=a*t,arguments[e]},t.vec3.ZERO=t.vec3(0,0,0),t.vec3.ONE=t.vec3(1,1,1),t.vec3.AXIS_X=t.vec3(1,0,0),t.vec3.AXIS_Y=t.vec3(0,1,0),t.vec3.AXIS_Z=t.vec3(0,0,1)},1495:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=void 0,t.vec4=function(e,r,i,a){return void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=1),t.vec4.set(e,r,i,a,new Float32Array(4))},t.vec4.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.vec4.set=function(e,t,r,i,a){return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a},t.vec4.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.vec4.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r},t.vec4.normalize=function(e,t){var r=e[0],i=e[1],a=e[2],n=e[3],o=r*r+i*i+a*a+n*n,s=o&&1/Math.sqrt(o);return t[0]=r*s,t[1]=i*s,t[2]=a*s,t[3]=n*s,t},t.vec4.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r},t.vec4.lerp=function(e,t,r,i){return i[0]=e[0]+r*(t[0]-e[0]),i[1]=e[1]+r*(t[1]-e[1]),i[2]=e[2]+r*(t[2]-e[2]),i[3]=e[3]+r*(t[3]-e[3]),i},t.vec4.ZERO=t.vec4(0,0,0,0),t.vec4.ONE=t.vec4(1,1,1,1)},6552:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleEmitter=void 0;var i=r(4454),a=r(9479),n=function(){function e(e,t){this.range=i.vec2(),this.offset=0,this.count=0,this.rate=0,this.amount=1,this.elapsed=0,this.queue=[],this.uniform=new a.UniformBlock(e,t.uniforms.EmitterUniforms,a.UniformBlockBindings.EmitterUniforms)}return e.prototype.update=function(e,t,r){var i=e.currentTime,a=e.deltaTime;if(this.uniform.uniforms.uLastID[0]=this.offset+this.range[1],this.rate)for(this.elapsed+=a;this.elapsed>this.rate;this.elapsed-=this.rate)this.count+=this.amount;else this.elapsed=0;for(;this.queue.length&&this.queue[0]<i;){this.queue.shift();var n=this.queue.shift();this.offset+=n,this.count-=n,this.range[1]-=n}var o=Math.min(r.limit-this.offset,0|this.count),s=o-this.range[1],c=this.uniform.uniforms.uLifespan[1]-this.uniform.uniforms.uLifespan[2];return s>0&&this.queue.push(i+c,s),this.range[0]=this.offset,this.range[1]=o,this.offset=t,o},e}();t.ParticleEmitter=n},7650:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleGeometry=t.AttributeCurveSampler=void 0;var i=r(9479);t.AttributeCurveSampler=function(e,t,r){for(var a,n,o,s,c=Math.ceil(r.length/4),l=new Float32Array(t*c*4),u=1/(t-1),f=0;f<c;f++)for(var h=0;h<t;h++){var m=h+f*t,d=h*u;l[4*m+0]=(null===(a=r[4*f+0])||void 0===a?void 0:a.call(r,d))||0,l[4*m+1]=(null===(n=r[4*f+1])||void 0===n?void 0:n.call(r,d))||0,l[4*m+2]=(null===(o=r[4*f+2])||void 0===o?void 0:o.call(r,d))||0,l[4*m+3]=(null===(s=r[4*f+3])||void 0===s?void 0:s.call(r,d))||0}return i.createTexture(e,{width:t,height:c,data:l},{format:34842,filter:9728,wrap:33071,flipY:!1,mipmaps:0,type:3553})};var a=function(){function e(){}return e.quad=function(e){var t=e.createBuffer();return e.bindBuffer(34962,t),e.bufferData(34962,new Float32Array([-.5,.5,0,0,0,-.5,-.5,0,0,1,.5,-.5,0,1,1,.5,.5,0,1,0]),35044),{drawMode:6,vbo:t,frame:0,indexOffset:0,indexCount:4,vao:null,aabb:null,radius:.5,format:[{name:"aPosition",size:3,type:5126,stride:20,offset:0},{name:"aUV",size:2,type:5126,stride:20,offset:12}]}},e.board=function(e,t){var r=e.createBuffer();return e.bindBuffer(34962,r),e.bufferData(34962,new Float32Array([0,t,0,0,0,0,-t,0,0,1,1,-t,0,1,1,1,t,0,1,0]),35044),{drawMode:6,vbo:r,frame:0,indexOffset:0,indexCount:4,vao:null,aabb:null,radius:.5,format:[{name:"aPosition",size:3,type:5126,stride:20,offset:0},{name:"aUV",size:2,type:5126,stride:20,offset:12}]}},e.stripe=function(e,t,r){var i=e.createBuffer();e.bindBuffer(34962,i);for(var a=new Float32Array(2*t*5),n=0;n<t;n++){var o=n/(t-1);a[2*n*5+0]=-.5*r(o),a[2*n*5+1]=o,a[2*n*5+2]=0,a[2*n*5+3]=0,a[2*n*5+4]=o,a[2*n*5+5]=.5*r(o),a[2*n*5+6]=o,a[2*n*5+7]=0,a[2*n*5+8]=1,a[2*n*5+9]=o}return e.bufferData(34962,a,35044),{drawMode:5,vbo:i,frame:0,indexOffset:0,indexCount:2*t,vao:null,aabb:null,radius:0,format:[{name:"aPosition",size:3,type:5126,stride:20,offset:0},{name:"aUV",size:2,type:5126,stride:20,offset:12}]}},e}();t.ParticleGeometry=a},634:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleSystem=void 0;var i=r(9479),a=r(6552),n=function(){function e(e,t,r,i,a){this.context=e,this.options=t,this.mesh=r,this.program=i,this.transform=a,this.pool=[],this.enabled=!0,this.index=0,this.instances=0,this.tfbWrite=[],this.tfbRead=[],this.vao=[],this.buffer=[],this.emitters=[];for(var n=this.context.gl,o=0;o<2;o++){if(this.buffer[o]=n.createBuffer(),n.bindBuffer(34962,this.buffer[o]),n.bufferData(34962,t.limit*t.format[0].stride,a?35042:35048),a&&(this.tfbWrite[o]=n.createTransformFeedback(),n.bindTransformFeedback(36386,this.tfbWrite[o]),n.bindBufferBase(35982,0,this.buffer[o]),n.bindTransformFeedback(36386,null)),a&&r){this.tfbRead[o]=n.createVertexArray(),n.bindVertexArray(this.tfbRead[o]),n.bindBuffer(34962,this.buffer[o]);for(var s=0;s<t.format.length;s++){var c=t.format[s],l=c.size,u=c.type,f=c.normalized,h=c.stride,m=c.offset;n.enableVertexAttribArray(s),n.vertexAttribPointer(s,l,u,f,h,m)}n.bindVertexArray(null)}if(this.program){var d=0;this.vao[o]=n.createVertexArray(),n.bindVertexArray(this.vao[o]),n.bindBuffer(34962,this.buffer[o]);for(var p=0;p<t.format.length;p++,d++){var v=t.format[p];l=v.size,u=v.type,f=v.normalized,h=v.stride,m=v.offset,n.enableVertexAttribArray(d),n.vertexAttribPointer(d,l,u,f,h,m),this.mesh&&n.vertexAttribDivisor(d,1)}if(this.mesh){this.mesh.ibo&&n.bindBuffer(34963,this.mesh.ibo),n.bindBuffer(34962,this.mesh.vbo);for(var y=this.mesh.ibo?1:0;y<this.mesh.format.length;y++,d++){var g=this.mesh.format[y];l=g.size,u=g.type,f=g.normalized,h=g.stride,m=g.offset,n.enableVertexAttribArray(d),n.vertexAttribPointer(d,l,u,f,h,m)}}n.bindVertexArray(null)}if(!a)break}}return e.prototype.apply=function(){if(this.enabled){if(this.transform)for(var e=this.instances=0;e<this.emitters.length;e++)this.instances+=this.emitters[e].update(this.context,this.instances,this.options);if(this.instances){var t=this.context.gl;if(this.material.bind(t),this.transform&&this.emitters.length){for(t.useProgram(this.transform.target),t.bindVertexArray(this.tfbRead[this.index]),t.bindTransformFeedback(36386,this.tfbWrite[this.index^=1]),this.mesh&&t.enable(35977),t.beginTransformFeedback(0),e=0;e<this.emitters.length;e++){var r=this.emitters[e];r.range[1]&&(r.uniform.bind(t,i.UniformBlockBindings.EmitterUniforms),t.drawArrays(0,r.range[0],r.range[1]))}t.endTransformFeedback(),this.mesh&&t.disable(35977),t.bindTransformFeedback(36386,null)}this.program&&(t.useProgram(this.program.target),t.bindVertexArray(this.vao[this.index]),this.mesh?this.mesh.ibo?t.drawElementsInstanced(this.mesh.drawMode,this.mesh.indexCount,5123,this.mesh.indexOffset,this.instances):t.drawArraysInstanced(this.mesh.drawMode,this.mesh.indexOffset,this.mesh.indexCount,this.instances):t.drawArrays(0,0,this.instances))}}},e.prototype.add=function(e){var t=this.pool.pop()||new a.ParticleEmitter(this.context.gl,this.transform);for(var r in e)t.uniform.uniforms[r].set(e[r],0);return this.emitters.push(t),t},e.prototype.remove=function(e){var t=this.emitters.indexOf(e);~t&&(this.emitters[t]=this.emitters[this.emitters.length-1],this.emitters.length--,this.pool.push(e))},e}();t.ParticleSystem=n},7217:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StaticParticleSystem=void 0;var r=function(){function e(e,t,r,i,a){this.context=e,this.options=t,this.mesh=r,this.program=i,this.enabled=!0,this.instances=0,this.list=[],this.samplers=[];var n=this.context.gl;this.buffer=n.createBuffer(),n.bindBuffer(34962,this.buffer),n.bufferData(34962,t.limit*t.format[0].stride,35048);var o=0;this.vao=n.createVertexArray(),n.bindVertexArray(this.vao);for(var s=0;s<t.format.length;s++,o++){var c=t.format[s],l=c.size,u=c.type,f=c.normalized,h=c.stride,m=c.offset;n.enableVertexAttribArray(o),n.vertexAttribPointer(o,l,u,f,h,m),this.mesh&&n.vertexAttribDivisor(o,1)}if(this.mesh)for(this.mesh.ibo&&n.bindBuffer(34963,this.mesh.ibo),n.bindBuffer(34962,this.mesh.vbo),s=this.mesh.ibo?1:0;s<this.mesh.format.length;s++,o++){var d=this.mesh.format[s];l=d.size,u=d.type,f=d.normalized,h=d.stride,m=d.offset,n.enableVertexAttribArray(o),n.vertexAttribPointer(o,l,u,f,h,m)}n.bindVertexArray(null),this.stride=this.options.format[0].stride/Float32Array.BYTES_PER_ELEMENT;var p=function(e){var t=v.options.format.find((function(t){return t.name===e}));if(!t)throw new Error(e+"!="+v.options.format.map((function(e){return e.name})).join(","));var r=t.offset/Float32Array.BYTES_PER_ELEMENT;v.samplers.push({offset:r,sample:a[e]})},v=this;for(var y in a)p(y)}return e.prototype.uploadVertexData=function(){var e=this.context.gl;this.instances=0;for(var t=0,r=0;r<this.list.length;r++){var i=this.list[r];if(i.expiry>0&&i.expiry<=this.context.currentTime)t++;else{t&&(this.list[r-t]=i);var a=this.instances*this.stride*Float32Array.BYTES_PER_ELEMENT;if(this.instances+i.count>=this.options.limit)break;this.instances+=i.count,i.frame>0&&i.offset===a||(i.frame=this.context.frame,e.bindBuffer(34962,this.buffer),e.bufferSubData(34962,i.offset=a,i.vertexArray))}}this.list.length-=t},e.prototype.apply=function(){if(this.enabled){var e=this.context.gl;this.uploadVertexData(),this.instances&&(this.material.bind(e),e.useProgram(this.program.target),e.bindVertexArray(this.vao),this.mesh?this.mesh.ibo?e.drawElementsInstanced(this.mesh.drawMode,this.mesh.indexCount,5123,this.mesh.indexOffset,this.instances):e.drawArraysInstanced(this.mesh.drawMode,this.mesh.indexOffset,this.mesh.indexCount,this.instances):e.drawArrays(0,0,this.instances))}},e.prototype.start=function(e,t){for(var r=new Float32Array(this.stride*e),i=0;i<e;i++)for(var a=i*this.stride,n=this.samplers.length-1;n>=0;n--)this.samplers[n].sample.call(this,t,a+this.samplers[n].offset,r);return this.list.push({count:e,vertexArray:r,offset:-1,frame:0,expiry:-1}),this.list[this.list.length-1]},e.prototype.stop=function(e){for(var t=e.vertexArray,r=e.count,i=this.context.currentTime,a=0;a<r;a++){var n=a*this.stride,o=t[n+0],s=t[n+3],c=Math.max(0,this.context.currentTime-o)%s,l=Math.floor(Math.max(0,this.context.currentTime-o)/s);t[n+0]=this.context.currentTime-c,t[n+2]+=.1*l,t[n+3]=0,i=Math.max(i,this.context.currentTime-c+s)}e.expiry=i,e.frame=0},e}();t.StaticParticleSystem=r},84:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(6552),t),a(r(634),t),a(r(7650),t),a(r(7217),t)},1542:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AmbientLightPass=t.HemisphereLight=void 0;var c=r(4454),l=r(9479),u=r(9333),f=r(944),h=s(r(6534)),m=r(9354),d=r(1905),p=r(9336),v=function(){function e(){this.frame=0,this.axis=c.vec3(0,1,0),this.color0=c.vec3(.15,.16,.18),this.color1=c.vec3(.05,.04,.03)}return e.prototype.update=function(e){this.frame||(this.frame=e.frame,this.uniform||(this.uniform=new l.UniformBlock(e.gl,{byteSize:48},l.UniformBlockBindings.LightUniforms)),this.uniform.data.set(this.axis,0),this.uniform.data.set(this.color0,4),this.uniform.data.set(this.color1,8))},e}();t.HemisphereLight=v;var y=function(e){function t(t){var r=e.call(this,t)||this;return r.environment=new v,r.program=l.ShaderProgram(r.context.gl,h.fullscreen_vert,h.ambient_frag,{REFLECTION_MAP:!0,IRRADIANCE_MAP:!1,IBL:!0}),r.program.uniforms.uBRDFLUT=l.UniformSamplerBindings.uAttributes,r.reflection=new d.LightField(r.context),r}return a(t,e),t.prototype.update=function(){var e=this.context.gl,t=this.context.get(p.CameraSystem),r=t.camera,i=t.controller;this.reflection.relocateProbes(i.cameraTarget),r.uniform.bind(e,l.UniformBlockBindings.CameraUniforms),this.context.get(f.PostEffectPass).swapRenderTarget(!1,!1),e.depthMask(!1),e.disable(2929),e.enable(3042),e.blendFunc(1,1),e.enable(2884),e.cullFace(1029),e.clear(16384),this.context.get(u.DeferredGeometryPass).bindReadBuffer(),this.environment.update(this.context);var a=this.context.get(f.PostEffectPass).plane;e.activeTexture(33984+l.UniformSamplerBindings.uAttributes),e.bindTexture(3553,this.reflection.brdfLUT),e.useProgram(this.program.target),e.bindVertexArray(a.vao),this.environment.uniform.bind(e,l.UniformBlockBindings.LightUniforms);for(var n=this.reflection.probes.length-1;n>=0;n--){var o=this.reflection.probes[n],s=this.reflection.calculateWeight(i.cameraTarget,o);s&&(this.program.uniforms.uWeight=s,e.activeTexture(33984+l.UniformSamplerBindings.uEnvironmentMap),e.bindTexture(34067,this.reflection.enabled?o.cubemap:null),e.drawElements(4,a.indexCount,5123,a.indexOffset))}},t}(m.PipelinePass);t.AmbientLightPass=y},7114:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.DecalPass=t.Decal=void 0;var c=r(4454),l=r(4998),u=r(9333),f=r(8038),h=r(9479),m=r(9940),d=s(r(6534)),p=r(9354),v=function(){function e(){this.frame=0,this.order=0,this.color=c.vec4(1,1,1,1),this.threshold=0,this.bounds=new f.BoundingVolume}return e.prototype.update=function(e,t){this.frame&&this.frame>=this.transform.frame||(this.frame=e,this.bounds.update(this.transform.matrix,1,this.transform.frame))},e}();t.Decal=v;var y=function(e){function t(t){var r=e.call(this,t)||this;r.pool=[],r.list=[],r.effects=[];var i=r.context.gl;r.batch=new m.DecalBatch(i,128),r.program=h.ShaderProgram(i,d.decal_vert,d.decal_frag,{INSTANCED:!0,NORMAL_MAPPING:!0,MASK:!0}),r.program.uniforms.uLayer=1,r.program.uniforms.uDissolveEdge=.1,r.defaultNormalMap=h.createTexture(i,{width:1,height:1,data:new Uint8Array([127,127,127,0])});var a=r.context.get(u.DeferredGeometryPass);return r.fbo=i.createFramebuffer(),i.bindFramebuffer(36160,r.fbo),i.framebufferRenderbuffer(36160,36096,36161,a.depth),i.framebufferTexture2D(36160,36064,3553,a.albedo,0),i.framebufferTexture2D(36160,36065,3553,a.normal,0),i.drawBuffers([36064,36065]),i.bindFramebuffer(36160,null),r}return a(t,e),t.prototype.create=function(e){var r=this.pool.pop()||new v;r.order=e;var i=c.binarySearch(this.list,r,t.orderSort,!0);return this.list.splice(i,0,r),r},t.prototype.delete=function(e){var t=this.list.indexOf(e);-1!=t&&(this.list.splice(t,1),this.pool.push(e),c.vec4.copy(c.vec4.ONE,e.color),e.frame=e.threshold=0,e.transform=e.material=null)},t.prototype.update=function(){var e=this.context.gl;e.bindFramebuffer(36160,this.fbo),e.activeTexture(33984+h.UniformSamplerBindings.uPositionBuffer),e.bindTexture(3553,this.context.get(u.DeferredGeometryPass).position);for(var t=this.context.get(l.CameraSystem).camera,r=null,i=this.list.length-1;i>=0;i--){var a=this.list[i];if(a.update(this.context.frame,this.context),t.culling.cull(a.bounds,65535)){if(r||(r=a.material),a.material.diffuse!==r.diffuse||a.material.program!==r.program)i++;else if(this.batch.render(a)){if(i)continue}else i++;var n=r;r=null;var o=this.batch.instanceOffset;o&&(this.batch.bind(),e.useProgram((n.program||this.program).target),n.bind(e),e.activeTexture(33984+h.UniformSamplerBindings.uDiffuseMap),e.bindTexture(3553,n.diffuse),e.activeTexture(33984+h.UniformSamplerBindings.uNormalMap),e.bindTexture(3553,n.normal||this.defaultNormalMap),e.drawElementsInstanced(4,m.DecalBatch.unitCubeIndices.length,5123,0,o))}}for(i=this.effects.length-1;i>=0;i--)this.effects[i].apply()},t.orderSort=function(e,t){return e.order-t.order},t}(p.PipelinePass);t.DecalPass=y},9333:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.DeferredGeometryPass=void 0;var c=r(9336),l=r(8581),u=r(9479),f=s(r(6534)),h=function(e){function t(t){var r=e.call(this,t)||this;r.effects=[];var i=t.gl;return r.allocateGeometryBuffer(i,i.drawingBufferWidth,i.drawingBufferHeight),r.programs=[u.ShaderProgram(i,f.geometry_vert,f.geometry_frag,{NORMAL_MAPPING:!0}),u.ShaderProgram(i,f.geometry_vert,f.geometry_frag,{SKINNING:!0,NORMAL_MAPPING:!0,COLOR_INDEX:!0}),u.ShaderProgram(i,f.geometry_vert,f.geometry_frag,{NORMAL_MAPPING:!0,COLOR_INDEX:!0})],r}return a(t,e),t.prototype.bindReadBuffer=function(){var e=this.context.gl;e.activeTexture(33984+u.UniformSamplerBindings.uPositionBuffer),e.bindTexture(3553,this.position),e.activeTexture(33984+u.UniformSamplerBindings.uNormalBuffer),e.bindTexture(3553,this.normal),e.activeTexture(33984+u.UniformSamplerBindings.uAlbedoBuffer),e.bindTexture(3553,this.albedo)},t.prototype.update=function(){var e=this.context.gl;e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.bindFramebuffer(36160,this.gbuffer),e.clearColor(0,0,0,0),e.clearDepth(1),e.depthMask(!0),e.clear(16640);var t=this.context.get(c.CameraSystem).camera;t.uniform.bind(e,u.UniformBlockBindings.CameraUniforms),this.context.get(c.CameraSystem).uniform.bind(e,u.UniformBlockBindings.GlobalUniforms);var r=this.context.get(l.MeshSystem).list;this.render(r,t.culling)},t.prototype.render=function(e,t){for(var r=this.context.gl,i=null,a=e.length-1;a>=0;a--){var n=e[a];0!==n.color[3]&&t.cull(n.bounds,n.layer)&&(i!==n.material.program&&r.useProgram((i=n.material.program).target),n.uniform.bind(r,u.UniformBlockBindings.ModelUniforms),n.armature&&(n.material.program.uniforms.uBoneMatrix=n.armature.boneMatrix),n.material.bind(r),r.bindVertexArray(n.buffer.vao),r.drawElements(4,n.buffer.indexCount,5123,n.buffer.indexOffset))}for(a=this.effects.length-1;a>=0;a--)this.effects[a].apply()},t.prototype.allocateGeometryBuffer=function(e,t,r){if(!e.getExtension("EXT_color_buffer_float"))throw new Error("FLOAT color buffer not available");if(this.position=u.createTexture(e,{width:t,height:r},{format:34842,filter:9728,wrap:33071,mipmaps:0}),this.normal=u.createTexture(e,{width:t,height:r},{format:34842,filter:9728,wrap:33071,mipmaps:0}),this.albedo=u.createTexture(e,{width:t,height:r},{format:32856,filter:9728,wrap:33071,mipmaps:0}),this.depth=e.createRenderbuffer(),e.bindRenderbuffer(36161,this.depth),e.renderbufferStorage(36161,33189,t,r),this.gbuffer=e.createFramebuffer(),e.bindFramebuffer(36160,this.gbuffer),e.framebufferRenderbuffer(36160,36096,36161,this.depth),e.framebufferTexture2D(36160,36064,3553,this.albedo,0),e.framebufferTexture2D(36160,36065,3553,this.normal,0),e.framebufferTexture2D(36160,36066,3553,this.position,0),e.drawBuffers([36064,36065,36066]),36053!=e.checkFramebufferStatus(36160))throw new Error("Framebuffer incomplete!");e.bindFramebuffer(36160,null)},t}(r(9354).PipelinePass);t.DeferredGeometryPass=h},7240:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OverlayPass=void 0;var c=r(4454),l=r(9479),u=s(r(6534)),f=r(9940),h=r(9354),m=r(828),d=function(e){function t(r){var i=e.call(this,r)||this;i.list2d=[],i.list=[],i.projectionMatrix=c.mat3(),i.enabled=!0;var a=r.gl.getParameter(34930);i.program=l.ShaderProgram(r.gl,u.batch2d_vert,u.batch2d_frag.replace(/^#FOR(.*)$/gm,(function(e,t){return c.range(a).map((function(e){return t.replace(/#i/g,e)})).join("\n")})),{MAX_TEXTURE_UNITS:a}),i.program.uniforms.uSamplers=c.range(a),i.batch=new f.Batch2D(i.context.gl,4*t.batchSize,6*t.batchSize,null);var n=c.mat3x2.orthogonal(0,r.gl.drawingBufferWidth,0,r.gl.drawingBufferHeight,c.mat3x2());return c.mat3.fromMat3x2(n,i.projectionMatrix),i}return a(t,e),t.prototype.add=function(e){this.list.push(e)},t.prototype.remove=function(e){var t=this.list.indexOf(e);-1!==t&&(t===this.list.length-1?this.list.length--:this.list[t]=this.list.pop())},t.prototype.update=function(){var e=this.context.gl;this.enabled&&this.list.length&&this.context.get(m.ParticleEffectPass).render(this.list),c.insertionSort(this.list2d,t.orderSort);for(var r=null,i=this.list2d.length-1;i>=0;i--){var a=this.list2d[i];if(a.update(this.context.frame),r||(r=a.material),r.merge(a.material))if(this.batch.render(a)){if(i)continue}else i++;else i++;var n=this.batch.indexOffset;n&&(e.useProgram(r.program.target),r.program.uniforms.uProjectionMatrix=this.projectionMatrix,r.bind(e),this.batch.bind(),e.drawElements(4,n,5123,0)),r=null}e.disable(3042)},t.orderSort=function(e,t){return e.order-t.order},t.batchSize=1024,t}(h.PipelinePass);t.OverlayPass=d},828:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleEffectPass=void 0;var c=r(4454),l=r(9479),u=r(9940),f=r(4998),h=r(9333),m=r(9354),d=s(r(6534)),p=function(e){function t(r){var i=e.call(this,r)||this;i.effects=[],i.list=[];var a=r.gl,n=a.getParameter(34930);return i.batch=new u.GeometryBatch(a,4*t.batchSize,6*t.batchSize),i.program=l.ShaderProgram(a,d.batch_vert,d.batch_frag.replace(/^#FOR(.*)$/gm,(function(e,t){return c.range(n).map((function(e){return t.replace(/#i/g,e)})).join("\n")})),{MAX_TEXTURE_UNITS:n}),i.program.uniforms.uSamplers=c.range(n),i}return a(t,e),t.prototype.add=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=this.list).push.apply(e,t)},t.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=e.length-1;r>=0;r--){var i=e[r],a=this.list.indexOf(i);-1!=a&&(this.list[a]=this.list[this.list.length-1],this.list.length--)}},t.prototype.sort=function(e,t){for(var r=e.length,i=void 0,a=0;a<r;a++){var n=e[a];for(i=a-1;i>=0&&n.order>e[i].order;i--)e[i+1]=e[i];e[i+1]=n}},t.prototype.update=function(){this.render(this.list),this.context.get(h.DeferredGeometryPass).bindReadBuffer();for(var e=this.effects.length-1;e>=0;e--)this.effects[e].apply()},t.prototype.render=function(e){var r=this.context.gl,i=this.context.get(f.CameraSystem).camera;c.insertionSort(e,t.orderSort);for(var a=null,n=e.length-1;n>=0;n--){var o=e[n];if(o.update(this.context,i),i.culling.cull(o.bounds,65535)){if(!a){if(!o.vertices){r.bindVertexArray(o.buffer.vao),r.useProgram(o.material.program.target),o.material.bind(r),o.uniform.bind(r,l.UniformBlockBindings.ModelUniforms),r.drawElements(o.buffer.drawMode,o.buffer.indexCount,5123,o.buffer.indexOffset);continue}a=o.material}if(a.merge(o.material))if(this.batch.render(o)){if(n)continue}else n++;else n++;var s=this.batch.indexOffset;s&&(r.useProgram(a.program.target),a.bind(r),this.batch.bind(),r.drawElements(4,s,5123,0)),a=null}}},t.orderSort=function(e,t){return e.order-t.order},t.batchSize=1024,t}(m.PipelinePass);t.ParticleEffectPass=p},9354:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PipelinePass=void 0;t.PipelinePass=function(e){this.context=e}},5369:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.PointLightPass=t.PointLight=void 0;var c=r(4454),l=r(9463),u=r(1772),f=r(4998),h=r(8038),m=r(9479),d=r(9354),p=s(r(6534)),v=function(){function e(){this.index=-1,this.frame=0,this.color=c.vec3(1,1,1),this.intensity=1,this.radius=1,this.bounds=new h.BoundingVolume}return e.prototype.update=function(e){var t;this.frame&&this.frame>=this.transform.frame||(this.frame=e.frame,this.uniform||(this.uniform=new m.UniformBlock(e.gl,{byteSize:88},m.UniformBlockBindings.LightUniforms)),this.bounds.update(this.transform.matrix,this.radius,this.transform.frame),this.uniform.data.set((null===(t=this.transform)||void 0===t?void 0:t.matrix)||c.mat4.IDENTITY,0),this.uniform.data.set(this.color,16),this.uniform.data[20]=this.radius,this.uniform.data[21]=this.intensity)},e}();t.PointLight=v;var y=function(e){function t(t){var r=e.call(this,t)||this;r.pool=[],r.list=[];var i=t.gl;r.program=m.ShaderProgram(i,p.light_vert,p.pbr_frag,{OMNILIGHT:!0,GGX:!0,SCHLICK:!0});var a=l.createSphere({longitude:32,latitude:32,radius:1});return r.sphere=r.context.get(u.MeshSystem).uploadVertexData(a.vertexArray,a.indexArray,a.format),r}return a(t,e),t.prototype.create=function(e){var t=this.pool.pop()||new v;return t.index=this.list.push(t)-1,t.frame=0,c.vec3.copy(e||c.vec3.ONE,t.color),t.intensity=1,t.radius=1,t},t.prototype.delete=function(e){-1!=e.index&&(this.list[e.index]=this.list[this.list.length-1],this.list[e.index].index=e.index,this.list.length--,e.index=-1,this.pool.push(e))},t.prototype.update=function(){var e=this.context.gl,t=this.context.get(f.CameraSystem).camera,r=this.list;e.enable(2884),e.cullFace(1028),e.useProgram(this.program.target),e.bindVertexArray(this.sphere.vao);for(var i=r.length-1;i>=0;i--){var a=r[i];a.update(this.context),t.culling.cull(a.bounds,65535)&&(a.uniform.bind(e,m.UniformBlockBindings.LightUniforms),e.drawElements(4,this.sphere.indexCount,5123,this.sphere.indexOffset))}},t}(d.PipelinePass);t.PointLightPass=y},944:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.PostEffectPass=void 0;var n=r(9463),o=r(1772),s=r(9479),c=r(9333),l=r(828),u=r(1905),f=function(e){function t(t){var r=e.call(this,t)||this;r.fbo=[],r.renderTarget=[],r.index=0,r.list=[],r.effects=[];var i=t.gl,a=n.createPlane({width:2,height:-2,columns:1,rows:1});r.plane=r.context.get(o.MeshSystem).uploadVertexData(a.vertexArray,a.indexArray,a.format);for(var l=0;l<2;l++)r.fbo[l]=i.createFramebuffer(),r.renderTarget[l]=s.createTexture(i,{width:i.drawingBufferWidth,height:i.drawingBufferHeight},{flipY:!1,wrap:33071,format:32856,mipmaps:0,filter:9729}),i.bindFramebuffer(36160,r.fbo[l]),i.framebufferRenderbuffer(36160,36096,36161,r.context.get(c.DeferredGeometryPass).depth),i.framebufferTexture2D(36160,36064,3553,r.renderTarget[l],0);return r.effects.push(r.fog=new u.FogEffect(r.context),r.bloom=new u.BloomEffect(r.context)),r}return a(t,e),t.prototype.swapRenderTarget=function(e,t){var r=this.context.gl;r.activeTexture(33984+s.UniformSamplerBindings.uSampler),r.bindTexture(3553,this.renderTarget[this.index]),e?r.bindFramebuffer(36160,null):r.bindFramebuffer(36160,this.fbo[this.index^=1]),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),t?(r.bindFramebuffer(36009,e?null:this.fbo[this.index]),r.bindFramebuffer(36008,this.fbo[e?this.index:1^this.index]),r.blitFramebuffer(0,0,r.drawingBufferWidth,r.drawingBufferHeight,0,0,r.drawingBufferWidth,r.drawingBufferHeight,16384,9728)):e||(r.clearColor(0,0,0,0),r.clear(16384))},t.prototype.add=function(e){this.list.push(e)},t.prototype.remove=function(e){var t=this.list.indexOf(e);-1!=t&&this.list.splice(t,1)},t.prototype.update=function(){var e=this.context.gl;this.list.length&&(e.activeTexture(33984+s.UniformSamplerBindings.uAlbedoBuffer),e.bindTexture(3553,this.renderTarget[this.index]),this.swapRenderTarget(!1,!0),e.disable(3042),e.disable(2884),e.depthFunc(515),e.enable(2929),this.context.get(l.ParticleEffectPass).render(this.list));for(var t=this.effects.length-1;t>=0;t--)this.effects[t].active&&this.effects[t].apply(this,!1);this.swapRenderTarget(!0,!0)},t}(r(9354).PipelinePass);t.PostEffectPass=f},2885:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Batch2D=void 0;var n=r(9479),o=r(1106),s=r(4376),c=function(e){function t(t,r,i,a){var o=e.call(this,t,n.VertexDataFormat.Batched2D,r,i,a)||this;return o.textures=[],o.maxTextures=t.getParameter(34930),o}return a(t,e),t.prototype.render=function(e){var t=e.vertices,r=e.uvs,i=e.indices,a=e.colors,n=e.material,o=i.length,c=t.length>>>1;0==this.indexOffset&&(this.textures.length=0);var l=this.textures.indexOf(n.diffuse);if(-1==l&&this.textures.length>=this.maxTextures||this.indexOffset+o>this.maxIndices||this.vertexOffset+c>this.maxVertices)return!1;-1==l&&(l=this.textures.push(n.diffuse)-1);var u=s.uintNorm4x8(e.color[0],e.color[1],e.color[2],e.color[3]);if(!u)return!0;var f=l<<24;if(!this.fixedIndices)for(var h=0;h<o;h++)this.indexArray[this.indexOffset+h]=i[h]+this.vertexOffset;this.indexOffset+=o;for(var m=this.format[1].stride>>>2,d=(h=0,this.vertexOffset*m);h<c;h++,d+=m)this.float32View[d+0]=t[2*h+0],this.float32View[d+1]=t[2*h+1],this.uint32View[d+2]=s.uintNorm2x16(r[2*h],r[2*h+1]),this.uint32View[d+3]=a?a[h]:u,this.uint32View[d+4]=f;return this.vertexOffset+=c,!0},t.prototype.bind=function(){e.prototype.bind.call(this),this.bindTextures(this.textures)},t.prototype.bindTextures=function(e){for(var t=this.gl,r=0;r<e.length;r++)t.activeTexture(33984+r),t.bindTexture(3553,e[r])},t.quadIndices=[0,1,2,0,2,3],t}(o.VertexDataBatch);t.Batch2D=c},941:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DecalBatch=void 0;var i=r(4454),a=r(9479),n=r(4376),o=function(){function e(t,r){this.gl=t,this.batchSize=r,this.format=a.VertexDataFormat.Decal,this.instanceOffset=0,this.vao=t.createVertexArray(),t.bindVertexArray(this.vao),this.indexBuffer=t.createBuffer(),t.bindBuffer(34963,this.indexBuffer),t.bufferData(34963,e.unitCubeIndices,35044),this.vertexBuffer=t.createBuffer(),t.bindBuffer(34962,this.vertexBuffer),t.bufferData(34962,e.unitCubeVertices,35044),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,5126,!1,0,0),this.stride=this.format[0].stride/Float32Array.BYTES_PER_ELEMENT,this.float32View=new Float32Array(this.stride*r),this.uint32View=new Uint32Array(this.float32View.buffer),this.instanceBuffer=t.createBuffer(),t.bindBuffer(34962,this.instanceBuffer),t.bufferData(34962,this.float32View.byteLength,35048);for(var i=0,n=0;n<this.format.length;n++)for(var o=this.format[n],s=o.size,c=o.type,l=o.normalized,u=o.stride,f=o.offset,h=s;h>0;h-=4)t.enableVertexAttribArray(++i),t.vertexAttribPointer(i,Math.min(4,h),c,l,u,f),t.vertexAttribDivisor(i,1),f+=Math.min(4,h)*a.GLSLDataType[c].BYTES_PER_ELEMENT;t.bindVertexArray(null)}return e.prototype.render=function(t){var r,a;if(this.instanceOffset+1>=this.batchSize)return!1;var o=n.uintNorm4x8(t.color[0],t.color[1],t.color[2],t.color[3]);if(!o)return!0;var s=(null===(r=t.transform)||void 0===r?void 0:r.matrix)||i.mat4.IDENTITY,c=(null===(a=t.material)||void 0===a?void 0:a.uvTransform)||e.uvTransform,l=this.instanceOffset*this.stride;return this.float32View.set(s,l),this.float32View[l+3]=t.threshold,this.float32View[l+7]=0,this.float32View[l+11]=0,this.float32View[l+15]=1,this.uint32View[l+16]=n.uintNorm2x16(c[0],c[1]),this.uint32View[l+17]=n.uintNorm2x16(c[0]+c[2],c[1]+c[3]),this.uint32View[l+18]=o,this.instanceOffset++,!0},e.prototype.bind=function(){var e=this.gl;e.bindVertexArray(this.vao),this.instanceOffset&&(e.bindBuffer(34962,this.instanceBuffer),e.bufferSubData(34962,0,this.float32View.subarray(0,this.instanceOffset*this.stride)),this.instanceOffset=0)},e.prototype.delete=function(){this.gl.deleteBuffer(this.indexBuffer),this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.instanceBuffer),this.gl.deleteVertexArray(this.vao)},e.uvTransform=i.vec4(0,0,1,1),e.unitCubeVertices=new Float32Array([-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5]),e.unitCubeIndices=new Uint16Array([1,5,7,1,7,3,0,2,6,0,6,4,2,3,7,2,7,6,0,4,5,0,5,1,4,6,7,4,7,5,0,1,3,0,3,2]),e}();t.DecalBatch=o},2341:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryBatch=void 0;var n=r(9479),o=r(1106),s=r(4376),c=function(e){function t(t,r,i,a){var o=e.call(this,t,n.VertexDataFormat.Batched,r,i,a)||this;return o.textures=[],o.maxTextures=t.getParameter(34930),o}return a(t,e),t.prototype.render=function(e){var t=e.vertices,r=e.uvs,i=e.indices,a=e.colors,n=e.normals,o=e.material,c=i.length,l=t.length>>>1;0==this.indexOffset&&(this.textures.length=0);var u=this.textures.indexOf(o.diffuse);if(c>this.maxIndices||l>this.maxVertices)throw new Error(c+">"+this.maxIndices+" or "+l+">"+this.maxVertices);if(-1==u&&this.textures.length>=this.maxTextures||this.indexOffset+c>this.maxIndices||this.vertexOffset+l>this.maxVertices)return!1;var f=s.uintNorm4x8(e.color[0],e.color[1],e.color[2],e.color[3]);if(!f)return!0;-1==u&&(u=this.textures.push(o.diffuse)-1);var h=s.uint8x4(0,0,0,u)|(e.normal?s.intNorm4x8(e.normal[0],e.normal[1],e.normal[2],0):0);if(!this.fixedIndices)for(var m=0;m<c;m++)this.indexArray[this.indexOffset+m]=i[m]+this.vertexOffset;this.indexOffset+=c;for(var d=this.format[1].stride>>>2,p=(m=0,this.vertexOffset*d);m<l;m++,p+=d)this.float32View[p+0]=t[3*m+0],this.float32View[p+1]=t[3*m+1],this.float32View[p+2]=t[3*m+2],this.uint32View[p+3]=s.uintNorm2x16(r[2*m],r[2*m+1]),this.uint32View[p+4]=a?a[m]:f,this.uint32View[p+5]=n?h|s.intNorm4x8(n[3*m+0],n[3*m+1],n[3*m+2],0):h;return this.vertexOffset+=l,!0},t.prototype.bind=function(){e.prototype.bind.call(this),this.bindTextures(this.textures)},t.prototype.bindTextures=function(e){for(var t=this.gl,r=0;r<e.length;r++)t.activeTexture(33984+r),t.bindTexture(3553,e[r])},t.quadIndices=[0,1,2,0,2,3],t}(o.VertexDataBatch);t.GeometryBatch=c},5045:function(e,t,r){"use strict";var i,a,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ModelBatch=void 0;var o=r(4454),s=r(9479),c=r(1106),l=function(){function e(){}return e.prototype.load=function(t,r){var i=s.GLSLDataType[t.type];this.view=new i(r.buffer,r.byteOffset,r.byteLength/i.BYTES_PER_ELEMENT),this.stride=t.stride/i.BYTES_PER_ELEMENT,this.offset=t.offset/i.BYTES_PER_ELEMENT,this.factor=t.normalized?1/e.MAX[t.type]:1,this.value=new Float32Array(t.size)},e.prototype.get=function(e){for(var t=e*this.stride+this.offset,r=0;r<this.value.length;r++)this.value[r]=this.factor*this.view[t+r];return this.value},e.MAX=((a={})[5123]=65535,a[5122]=32767,a[5121]=255,a[5120]=127,a),e}(),u=function(e){function t(t,r,i){var a=e.call(this,t.gl,s.VertexDataFormat.Static,r,i)||this;return a.context=t,a.attributes={position:new l,normal:new l,uv:new l},a.buffer={vbo:a.vertexBuffer,ibo:a.indexBuffer,vao:a.vao,frame:0,indexOffset:0,drawMode:4,format:a.format,indexCount:0,aabb:o.aabb3(),radius:0},a}return n(t,e),t.prototype.render=function(e){var t,r=e.vertices,i=e.indices,a=e.format,n=i.length,s=r.length*r.BYTES_PER_ELEMENT/a[1].stride;if(this.indexOffset+n>this.maxIndices||this.vertexOffset+s>this.maxVertices)return!1;0==this.indexOffset&&(o.aabb3.copy(o.aabb3.INFINITE,this.buffer.aabb),this.buffer.radius=0);for(var c=0;c<n;c++)this.indexArray[this.indexOffset++]=i[c]+this.vertexOffset;var l=this.format[1].stride>>>2;for(c=1;c<a.length;c++)null===(t=this.attributes[a[c].name])||void 0===t||t.load(a[c],r);for(var u=this.attributes,f=u.position,h=u.normal,m=u.uv,d=(c=0,this.vertexOffset*l);c<s;c++,d+=l){var p=f.get(c),v=h.get(c),y=m.get(c);o.mat4.transform(p,e.transform,p),o.mat4.transformNormal(v,e.transform,v),this.buffer.radius=Math.max(this.buffer.radius,Math.hypot(p[0],p[1],p[2])),o.aabb3.insert(this.buffer.aabb,p,this.buffer.aabb),this.float32View[d+0]=p[0],this.float32View[d+1]=p[1],this.float32View[d+2]=p[2],this.float32View[d+3]=v[0],this.float32View[d+4]=v[1],this.float32View[d+5]=v[2],this.float32View[d+6]=y[0],this.float32View[d+7]=y[1]}return this.vertexOffset+=s,this.buffer.indexCount=this.indexOffset,!0},t}(c.VertexDataBatch);t.ModelBatch=u},1106:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexDataBatch=void 0;var r=function(){function e(e,t,r,i,a){if(this.gl=e,this.format=t,this.maxVertices=r,this.maxIndices=i,this.fixedIndices=a,this.indexOffset=0,this.vertexOffset=0,this.indexArray=new Uint16Array(i),a)for(var n=0;n<this.indexArray.length;n++)this.indexArray[n]=a[n%a.length]+4*Math.floor(n/a.length);var o=new ArrayBuffer(r*t[1].stride);this.float32View=new Float32Array(o),this.uint32View=new Uint32Array(o),this.vao=e.createVertexArray(),e.bindVertexArray(this.vao),this.indexBuffer=e.createBuffer(),e.bindBuffer(34963,this.indexBuffer),e.bufferData(34963,this.indexArray,a?35044:35048),this.vertexBuffer=e.createBuffer(),e.bindBuffer(34962,this.vertexBuffer),e.bufferData(34962,o.byteLength,35048);for(var s=1;s<t.length;s++){var c=t[s],l=c.size,u=c.type,f=c.normalized,h=c.stride,m=c.offset;e.enableVertexAttribArray(s-1),e.vertexAttribPointer(s-1,l,u,f,h,m)}e.bindVertexArray(null)}return e.prototype.bind=function(){var e=this.gl;e.bindVertexArray(this.vao),this.indexOffset&&(this.fixedIndices||(e.bindBuffer(34963,this.indexBuffer),e.bufferSubData(34963,0,this.indexArray.subarray(0,this.indexOffset))),e.bindBuffer(34962,this.vertexBuffer),e.bufferSubData(34962,0,this.float32View.subarray(0,this.vertexOffset*(this.format[1].stride>>>2))),this.indexOffset=0,this.vertexOffset=0)},e.prototype.delete=function(){this.gl.deleteBuffer(this.indexBuffer),this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteVertexArray(this.vao)},e}();t.VertexDataBatch=r},4376:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.intNorm4x8=t.uintNorm2x16=t.uintNorm4x8=t.uint16x2=t.uint8x4=void 0,t.uint8x4=function(e,t,r,i){return 255&e|65280&t<<8|16711680&r<<16|4278190080&i<<24},t.uint16x2=function(e,t){return 4294901760&t<<16|65535&e},t.uintNorm4x8=function(e,t,r,i){return 255*e|255*t<<8|255*r<<16|255*i<<24},t.uintNorm2x16=function(e,t){return 65535*t<<16|65535&(65535*e|0)},t.intNorm4x8=function(e,t,r,i){return 127*e&255|(127*t&255)<<8|(127*r&255)<<16|(127*i&255)<<24}},9940:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(4376),t),a(r(1106),t),a(r(2885),t),a(r(2341),t),a(r(941),t),a(r(5045),t)},1908:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BloomEffect=void 0;var o=r(4454),s=r(9479),c=n(r(6534)),l=function(){function e(t){this.context=t,this.enabled=!0,this.fbo=[],this.renderTarget=[],this.iterations=2,this.mask=o.vec4(2,2,2,2);var r=t.gl;this.brightness=s.ShaderProgram(r,c.fullscreen_vert,c.threshold_frag,{MASK:!0,BRIGHTNESS:!1}),this.blur=s.ShaderProgram(r,c.fullscreen_vert,c.blur_frag,{KERNEL_SIZE:9}),this.width=r.drawingBufferWidth/e.downscale,this.height=r.drawingBufferHeight/e.downscale;for(var i=0;i<2;i++)this.renderTarget[i]=s.createTexture(r,{width:this.width,height:this.height},{flipY:!1,wrap:33071,format:32856,mipmaps:0,filter:9729}),this.fbo[i]=r.createFramebuffer(),r.bindFramebuffer(36160,this.fbo[i]),r.framebufferTexture2D(36160,36064,3553,this.renderTarget[i],0);r.bindFramebuffer(36160,null)}return e.prototype.apply=function(t){if(this.enabled){var r=this.context.gl;r.disable(2929),r.disable(3042),r.disable(2884),r.activeTexture(33984+s.UniformSamplerBindings.uSampler),r.bindTexture(3553,t.renderTarget[t.index]),r.useProgram(this.brightness.target),r.bindFramebuffer(36160,this.fbo[0]),r.viewport(0,0,this.width,this.height),r.bindVertexArray(t.plane.vao),this.context.gl.drawElements(4,t.plane.indexCount,5123,t.plane.indexOffset),r.useProgram(this.blur.target);for(var i=0,a=0;a<this.iterations;a++)r.bindTexture(3553,this.renderTarget[i]),i^=1,this.blur.uniforms.uSize=i?e.horizontal:e.vertical,r.bindFramebuffer(36160,this.fbo[i]),this.context.gl.drawElements(4,t.plane.indexCount,5123,t.plane.indexOffset)}},Object.defineProperty(e.prototype,"active",{get:function(){return this.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.enabled?this.renderTarget[1&this.iterations]:null},enumerable:!1,configurable:!0}),e.downscale=4,e.horizontal=o.vec2(1,0),e.vertical=o.vec2(0,1),e}();t.BloomEffect=l},1075:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.FogEffect=void 0;var o=r(9479),s=r(4454),c=n(r(6534)),l=function(){function e(e){this.context=e,this.enabled=!0,this.color=s.vec4(.2,.2,.2,0),this.range=s.vec2(5,30),this.height=s.vec2(0,1),this.frame=0,this.program=o.ShaderProgram(this.context.gl,c.fullscreen_vert,c.fog_frag,{LINEAR_FOG:!0,HALFSPACE:!0,BLOOM:!0}),this.program.uniforms.uBloomMap=o.UniformSamplerBindings.uNormalMap}return Object.defineProperty(e.prototype,"active",{get:function(){return this.enabled},enumerable:!1,configurable:!0}),e.prototype.apply=function(e,t){var r=this.context.gl;r.disable(2929),r.disable(3042),r.disable(2884),e.swapRenderTarget(t,!1),r.useProgram(this.program.target),0==this.frame&&(this.frame=this.context.frame,this.program.uniforms.uFogColor=this.color,this.program.uniforms.uFogRange=this.range,this.program.uniforms.uFogHeight=this.height),r.activeTexture(33984+o.UniformSamplerBindings.uNormalMap),r.bindTexture(3553,e.bloom.texture),this.program.uniforms.uBloomMask=e.bloom.mask,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.bindVertexArray(e.plane.vao),r.drawElements(4,e.plane.indexCount,5123,e.plane.indexOffset)},e}();t.FogEffect=l},5367:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.LightField=t.ReflectionProbe=void 0;var o=r(4454),s=r(9479),c=r(8581),l=r(9336),u=r(9333),f=r(757),h=n(r(6534)),m=function(){function e(e,t){this.gl=e,this.index=t,this.culling=new l.FrustumCulling,this.ubo=e.createBuffer(),this.dataView=new Float32Array(52),this.viewProjectionMatrix=this.dataView.subarray(0,16),this.projectionMatrix=this.dataView.subarray(16,32),this.viewMatrix=this.dataView.subarray(32,48),this.position=this.dataView.subarray(48,52),e.bindBufferBase(35345,s.UniformBlockBindings.CameraUniforms,this.ubo),e.bufferData(35345,this.dataView.byteLength,35048),this.culling.layerMask=3}return e.prototype.update=function(t){o.vec3.scale(t,-1,this.position),o.mat4.copy(e.matrices[this.index],this.viewMatrix),o.mat4.translate(this.viewMatrix,this.position,this.viewMatrix),o.mat4.multiply(this.projectionMatrix,this.viewMatrix,this.viewProjectionMatrix),o.vec3.copy(t,this.position),this.culling.update(this.viewMatrix,this.projectionMatrix)},e.prototype.bind=function(e,t){e.bindBufferBase(35345,t,this.ubo),e.bufferSubData(35345,0,this.dataView)},e.prototype.delete=function(){this.gl.deleteBuffer(this.ubo)},e.matrices=[o.mat4.lookAt(o.vec3.ZERO,o.vec3(1,0,0),o.vec3(0,-1,0),o.mat4()),o.mat4.lookAt(o.vec3.ZERO,o.vec3(-1,0,0),o.vec3(0,-1,0),o.mat4()),o.mat4.lookAt(o.vec3.ZERO,o.vec3(0,1,0),o.vec3(0,0,1),o.mat4()),o.mat4.lookAt(o.vec3.ZERO,o.vec3(0,-1,0),o.vec3(0,0,-1),o.mat4()),o.mat4.lookAt(o.vec3.ZERO,o.vec3(0,0,1),o.vec3(0,-1,0),o.mat4()),o.mat4.lookAt(o.vec3.ZERO,o.vec3(0,0,-1),o.vec3(0,-1,0),o.mat4())],e.targets=[34069,34070,34071,34072,34073,34074],e}(),d=function(){function e(t){this.context=t,this.width=e.resolution,this.height=e.resolution,this.position=o.vec3(0,0,0),this.frame=0,this.fbo=[],this.faces=[];var r=this.context.gl;this.cubemap=r.createTexture(),r.bindTexture(34067,this.cubemap),r.texParameteri(34067,10242,33071),r.texParameteri(34067,10243,33071),r.texParameteri(34067,10241,e.mipmaps?9987:9729),r.texParameteri(34067,10240,9729),this.depth=r.createRenderbuffer(),r.bindRenderbuffer(36161,this.depth),r.renderbufferStorage(36161,33189,this.width,this.height);for(var i=0;i<m.targets.length;i++){var a=m.targets[i];r.texImage2D(a,0,6408,this.width,this.height,0,6408,5121,null);var n=this.fbo[i]=r.createFramebuffer();r.bindFramebuffer(36160,n),r.framebufferRenderbuffer(36160,36096,36161,this.depth),r.framebufferTexture2D(36160,36064,a,this.cubemap,0),r.drawBuffers([36064,0,0]),this.faces[i]=new m(r,i),o.mat4.perspective(.5*Math.PI,1,e.near,e.far,this.faces[i].projectionMatrix)}}return e.prototype.update=function(t){if(!(this.frame>=this.faces.length)){if(0==this.frame){o.vec3.copy(t,this.position);for(var r=this.faces.length-1;r>=0;r--)this.faces[r].update(this.position);console.log("%cenv cubemap "+this.width+"x"+this.height+" - ["+this.position+"]","color:#a0d050")}var i=this.context.gl;for(r=this.faces.length-1;r>=0;r--){var a=this.faces[r];r===this.frame&&(i.viewport(0,0,this.width,this.height),i.bindFramebuffer(36160,this.fbo[r]),i.depthMask(!0),i.clear(16640),a.bind(i,s.UniformBlockBindings.CameraUniforms),this.context.get(u.DeferredGeometryPass).render(this.context.get(c.MeshSystem).list,a.culling))}this.frame++,e.mipmaps&&this.frame===this.faces.length&&(i.activeTexture(33984+s.UniformSamplerBindings.uEnvironmentMap),i.bindTexture(34067,this.cubemap),i.generateMipmap(34067))}},e.prototype.delete=function(){var e=this.context.gl;this.fbo.forEach((function(t){return e.deleteFramebuffer(t)})),this.faces.forEach((function(e){return e.delete()})),e.deleteTexture(this.cubemap),e.deleteRenderbuffer(this.depth)},e.resolution=256,e.near=.1,e.far=100,e.mipmaps=!0,e}();t.ReflectionProbe=d;var p=function(){function e(e){this.context=e,this.probes=[],this.gridSize=2,this.innerSize=18,this.outerSize=22,this.enabled=!0;for(var t=this.gridSize*this.gridSize-1;t>=0;t--)this.probes[t]=new d(this.context);var r=this.context.get(f.MaterialSystem);this.brdfLUT=r.addRenderTexture(r.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0,format:33327}),0,s.ShaderProgram(e.gl,h.fullscreen_vert,h.brdflut_frag),{},0).target}return e.prototype.relocateProbes=function(t){if(this.enabled&&1!=this.context.frame)for(var r=.5*(this.innerSize+this.outerSize),i=Math.floor(t[0]/r),a=Math.floor(t[1]/r),n=Math.floor(t[2]/r),s=0;s<this.gridSize;s++)for(var c=0;c<this.gridSize;c++){var l=this.probes[s+c*this.gridSize],u=i+o.mod(s-i,this.gridSize),f=n+o.mod(c-n,this.gridSize),h=o.vec3.set(u*r,a*r+2,f*r,e.target);h[0]===l.position[0]&&h[2]===l.position[2]||(l.frame=0);var m=l.frame<6;if(l.update(h),m)return}},e.prototype.calculateWeight=function(e,t){var r=2*Math.abs(e[0]-t.position[0]),i=2*Math.abs(e[2]-t.position[2]),a=1/(this.outerSize-this.innerSize);return(1-o.clamp((r-this.innerSize)*a,0,1))*(1-o.clamp((i-this.innerSize)*a,0,1))},e.target=o.vec3(),e}();t.LightField=p},1905:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(1908),t),a(r(1075),t),a(r(5367),t)},296:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(9354),t),a(r(9333),t),a(r(7114),t),a(r(1542),t),a(r(5369),t),a(r(828),t),a(r(944),t),a(r(7240),t)},4998:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSystem=t.PerspectiveCamera=void 0;var i=r(4454),a=r(9479),n=r(5623),o=r(8038),s=function(){this.frame=0,this.zNear=.1,this.zFar=100,this.fieldOfView=Math.PI/2,this.aspectRatio=1,this.viewMatrix=i.mat4(),this.projectionMatrix=i.mat4(),this.viewProjectionMatrix=i.mat4(),this.position=i.vec3(),this.culling=new o.FrustumCulling};t.PerspectiveCamera=s;var c=function(){function e(e){this.camera=e,this.frame=0,this.cameraTarget=i.vec3(0,0,0),this.cameraOffset=i.vec3(0,8,4),this.cameraPivot=i.vec3(0,0,0),this.cameraYaw=i.quat(),this.cameraPitch=i.quat(),this.cameraSmoothness=.1}return e.prototype.adjustCamera=function(e,t){this.frame=t,i.vec3.add(this.cameraOffset,e,this.cameraPivot),i.vec3.lerp(this.camera.transform.position,this.cameraPivot,this.cameraSmoothness,this.camera.transform.position),i.vec3.copy(e,this.cameraTarget);var r=this.camera.transform.position[0]-e[0],a=this.camera.transform.position[1]-e[1],n=this.camera.transform.position[2]-e[2],o=Math.sqrt(r*r+n*n);i.quat.axisAngle(i.vec3.AXIS_Y,Math.atan2(r,n),this.cameraYaw),i.quat.axisAngle(i.vec3.AXIS_X,Math.atan2(-a,o),this.cameraPitch),i.quat.multiply(this.cameraYaw,this.cameraPitch,this.camera.transform.rotation),i.quat.normalize(this.camera.transform.rotation,this.camera.transform.rotation),this.camera.transform.frame=0},e}(),l=function(){function e(e){this.context=e,this.camera=new s,this.camera.transform=this.context.get(n.TransformSystem).create(),this.controller=new c(this.camera),this.uniform=new a.UniformBlock(this.context.gl,{byteSize:16})}return e.prototype.update=function(){this.uniform.data[0]=this.context.currentTime,this.uniform.data[1]=this.context.deltaTime,this.uniform.data[2]=this.context.frame,this.uniform.data[3]=this.context.currentTime%1e3,this.updatePerspectiveCamera(this.camera)},e.prototype.updatePerspectiveCamera=function(e){if(!(e.frame&&e.frame>=e.transform.frame)){e.uniform||(e.uniform=new a.UniformBlock(this.context.gl,{byteSize:208})),e.frame||(e.aspectRatio=this.context.gl.drawingBufferWidth/this.context.gl.drawingBufferHeight,i.mat4.perspective(e.fieldOfView,e.aspectRatio,e.zNear,e.zFar,e.projectionMatrix)),e.culling.updateCamera(e);var t=e.transform?e.transform.matrix:i.mat4.IDENTITY;i.mat4.invert(t,e.viewMatrix),i.mat4.multiply(e.projectionMatrix,e.viewMatrix,e.viewProjectionMatrix),e.uniform.data.set(e.viewProjectionMatrix,0),e.uniform.data.set(e.projectionMatrix,16),e.uniform.data.set(e.viewMatrix,32),e.uniform.data[48]=e.position[0]=t[12],e.uniform.data[49]=e.position[1]=t[13],e.uniform.data[50]=e.position[2]=t[14],e.frame=this.context.frame}},e}();t.CameraSystem=l},8038:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrustumCulling=t.BoundingVolume=t.calculateBoundingRadius=void 0;var i=r(4454);function a(e,t,r,a){void 0===a&&(a=i.vec3.ZERO);for(var n=0,o=0;o<e.length;o+=t){var s=e[o+r+0]-a[0],c=e[o+r+1]-a[1],l=e[o+r+2]-a[2];n=Math.max(n,s*s+c*c+l*l)}return Math.sqrt(n)}t.calculateBoundingRadius=a;var n=function(){function e(){this.frame=-1,this.position=i.vec3(0,0,0),this.scale=i.vec3(1,1,1),this.radius=0}return e.prototype.update=function(e,t,r){this.scale[0]=Math.hypot(e[0],e[1],e[2]),this.scale[1]=Math.hypot(e[4],e[5],e[6]),this.scale[2]=Math.hypot(e[8],e[9],e[10]),i.vec3.set(e[12],e[13],e[14],this.position),this.radius=t*Math.max(this.scale[0],this.scale[1],this.scale[2]),this.frame=r},e.prototype.fromVertices=function(e,t,r,n){i.vec3.copy(i.vec3.ZERO,this.position);for(var o=0;o<e.length;o+=t)this.position[0]+=e[o+r+0],this.position[1]+=e[o+r+1],this.position[2]+=e[o+r+2];i.vec3.scale(this.position,e.length&&t/e.length,this.position),this.radius=a(e,t,r,this.position),this.frame=n},e}();t.BoundingVolume=n;var o=function(){function e(){this.layerMask=65535,this.modelMatrix=i.mat4(),this.AXIS_X=this.modelMatrix.subarray(0,3),this.AXIS_Y=this.modelMatrix.subarray(4,7),this.AXIS_Z=this.modelMatrix.subarray(8,11),this.position=this.modelMatrix.subarray(12,14)}return e.prototype.update=function(e,t){this.near=t[14]/(t[10]-1),this.far=t[14]/(t[10]+1),this.fieldOfView=2*Math.atan(1/t[5]),this.aspectRatio=t[5]/t[0],i.mat4.invert(e,this.modelMatrix),this.tangent=Math.tan(this.fieldOfView/2),this.sphereFactorY=1/Math.cos(this.fieldOfView/2),this.sphereFactorX=1/Math.cos(Math.atan(this.tangent*this.aspectRatio))},e.prototype.updateCamera=function(e){var t;this.fieldOfView=e.fieldOfView,this.aspectRatio=e.aspectRatio,this.near=e.zNear,this.far=e.zFar,this.tangent=Math.tan(this.fieldOfView/2),this.sphereFactorY=1/Math.cos(this.fieldOfView/2),this.sphereFactorX=1/Math.cos(Math.atan(this.tangent*this.aspectRatio));var r=(null===(t=e.transform)||void 0===t?void 0:t.matrix)||i.mat4.IDENTITY;i.vec3.set(r[0],r[1],r[2],this.AXIS_X),i.vec3.set(r[4],r[5],r[6],this.AXIS_Y),i.vec3.set(-r[8],-r[9],-r[10],this.AXIS_Z),i.vec3.set(r[12],r[13],r[14],this.position)},e.prototype.cull=function(e,t){return 0!=(this.layerMask&t)&&this.cullSphere(e.position,e.radius)},e.prototype.cullSphere=function(t,r){var a=i.vec3.subtract(t,this.position,e.temp),n=-i.vec3.dot(a,this.AXIS_Z);if(n>this.far+r||n<this.near-r)return!1;var o=i.vec3.dot(a,this.AXIS_Y),s=n*this.tangent+r*this.sphereFactorY;if(o>s||o<-s)return!1;var c=i.vec3.dot(a,this.AXIS_X),l=n*this.tangent*this.aspectRatio+r*this.sphereFactorX;return!(c>l||c<-l)},e.temp=i.vec3(0,0,0),e}();t.FrustumCulling=o},5623:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransformSystem=t.Transform=void 0;var i=r(4454),a=function(){function e(){this.index=-1,this.frame=0,this.position=i.vec3(0,0,0),this.scale=i.vec3(1,1,1),this.rotation=i.quat(),this.matrix=i.mat4()}return e.prototype.recalculate=function(e){i.mat4.fromRotationTranslationScale(this.rotation,this.position,this.scale,this.matrix),this.parent&&i.mat4.multiply(this.parent.matrix,this.matrix,this.matrix),this.frame=e},e.prototype.calculateNormalMatrix=function(){return i.mat3.normalMatrix(this.matrix,e.normalMatrix)},e.IDENTITY=new e,e.matrix=i.mat4(),e.normalMatrix=i.mat3(),e}();t.Transform=a;var n=function(){function e(e){this.context=e,this.pool=[],this.list=[]}return e.prototype.create=function(e,t,r,n){var o=this.pool.pop()||new a;return o.index=this.list.push(o)-1,o.frame=0,o.parent=n||null,i.vec3.copy(e||i.vec3.ZERO,o.position),i.vec3.copy(r||i.vec3.ONE,o.scale),i.quat.copy(t||i.quat.IDENTITY,o.rotation),o},e.prototype.delete=function(e){-1!=e.index&&(this.list[e.index]=this.list[this.list.length-1],this.list[e.index].index=e.index,this.list.length--,this.pool.push(e),e.index=-1)},e.prototype.update=function(){for(var e=this.list.length-1;e>=0;e--){var t=this.list[e];if(t.parent&&t.parent.index<e){if(-1!=t.parent.index){this.list[t.parent.index]=t,this.list[e]=t.parent,t.index=t.parent.index,t.parent.index=e++;continue}t.parent=null}t.frame&&(!t.parent||t.frame>=t.parent.frame)||t.recalculate(this.context.frame)}},e}();t.TransformSystem=n},9336:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(5623),t),a(r(4998),t),a(r(8038),t)},6534:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.batch2d_frag=t.batch2d_vert=t.blur_frag=t.threshold_frag=t.brdflut_frag=t.bumpmap_frag=t.vfx_frag=t.ambient_frag=t.pbr_frag=t.light_vert=t.fog_frag=t.distortion_frag=t.noise_frag=t.geometry_frag=t.geometry_vert=t.fullscreen_frag=t.fullscreen_vert=t.particle_vert=t.decal_frag=t.decal_vert=t.billboard_frag=t.billboard_vert=t.verlet_vert=t.stripe_vert=t.batch_frag=t.batch_vert=void 0,t.batch_vert=r(8777),t.batch_frag=r(6889),t.stripe_vert=r(4247),t.verlet_vert=r(1818),t.billboard_vert=r(5679),t.billboard_frag=r(8746),t.decal_vert=r(4272),t.decal_frag=r(1615),t.particle_vert=r(6584),t.fullscreen_vert=r(4010),t.fullscreen_frag=r(6410),t.geometry_vert=r(669),t.geometry_frag=r(6426),t.noise_frag=r(2655),t.distortion_frag=r(643),t.fog_frag=r(6687),t.light_vert=r(6935),t.pbr_frag=r(5784),t.ambient_frag=r(7644),t.vfx_frag=r(1511),t.bumpmap_frag=r(6011),t.brdflut_frag=r(7806),t.threshold_frag=r(443),t.blur_frag=r(741),t.batch2d_vert=r(1853),t.batch2d_frag=r(7448)},8621:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9479:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(8621),t),a(r(8536),t),a(r(5341),t),a(r(2502),t),a(r(6518),t)},5341:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UniformBlock=t.locateUniforms=t.compileProgram=t.ShaderProgram=void 0;var i=r(6518);function a(e,t,r,i){var a=e.createShader(35633);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,35713))throw new Error(e.getShaderInfoLog(a));var n=e.createShader(35632);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,35713))throw new Error(e.getShaderInfoLog(n));var o=e.createProgram();if(e.attachShader(o,a),e.attachShader(o,n),i&&e.transformFeedbackVaryings(o,i,35980),e.linkProgram(o),e.deleteShader(a),e.deleteShader(n),!e.getProgramParameter(o,35714))throw new Error(e.getProgramInfoLog(o));return o}function n(e,t){for(var r in e.useProgram(t),i.UniformBlockBindings){var a=e.getUniformBlockIndex(t,r);4294967295!=a&&e.uniformBlockBinding(t,a,i.UniformBlockBindings[r])}for(var n=Object.create(null),o=e.getProgramParameter(t,35382)-1;o>=0;o--){for(var s=e.getActiveUniformBlockParameter(t,o,35392),c=e.getActiveUniformBlockParameter(t,o,35395),l=e.getActiveUniforms(t,c,35387),u=e.getActiveUniformBlockName(t,o),f=(e.getActiveUniforms(t,c,35386),Array(c.length)),h=0;h<c.length;h++)f[h]=e.getActiveUniform(t,c[h]);n[u]={byteSize:s,offsets:l,uniforms:f}}for(o=e.getProgramParameter(t,35718)-1;o>=0;o--){var m=e.getActiveUniform(t,o),d=e.getUniformLocation(t,m.name);if(d){var p=void 0;switch(m.type){case 5124:case 35678:case 36289:case 35680:p=m.size>1?e.uniform1iv.bind(e,d):e.uniform1i.bind(e,d);break;case 5126:p=m.size>1?e.uniform1fv.bind(e,d):e.uniform1f.bind(e,d);break;case 35664:p=e.uniform2fv.bind(e,d);break;case 35665:p=e.uniform3fv.bind(e,d);break;case 35666:p=e.uniform4fv.bind(e,d);break;case 35674:p=e.uniformMatrix2fv.bind(e,d,!1);break;case 35675:p=e.uniformMatrix3fv.bind(e,d,!1);break;case 35676:p=e.uniformMatrix4fv.bind(e,d,!1)}Object.defineProperty(n,m.name.replace(/\[0\]$/,""),{set:p})}}for(var r in i.UniformSamplerBindings)r in n&&(n[r]=i.UniformSamplerBindings[r]);return n}t.ShaderProgram=function(e,t,r,i){if(i)for(var o in i)if(0!=i[o]){var s="\n#define "+o.toUpperCase()+(1==i[o]?"":" "+i[o])+"\n";t=t.replace(/\n/,s),r=null==r?void 0:r.replace(/\n/,s)}var c=[],l=a(e,t=t.replace(/^layout\([^\)]*\) (out \S+ (\S+);)$/gim,(function(e,t,r){return c.push(r),t})),r||"#version 300 es\nvoid main(){}",c.length?c:null);return{target:l,uniforms:n(e,l)}},t.compileProgram=a,t.locateUniforms=n;var o=function(){function e(e,t,r){var a;void 0===r&&(r=0),this.frame=0,this.uniforms=Object.create(null),this.buffer=e.createBuffer(),this.data=new Float32Array(t.byteSize/Float32Array.BYTES_PER_ELEMENT);for(var n=(null===(a=t.uniforms)||void 0===a?void 0:a.length)-1;n>=0;n--){var o=t.offsets[n],s=t.uniforms[n],c=s.type,l=s.size,u=s.name,f=i.GLSLTypeSize[c]*l,h=new i.GLSLDataType[c](this.data.buffer,o,f);this.uniforms[u]=h}e.bindBufferBase(35345,r,this.buffer),e.bufferData(35345,this.data.byteLength,35048)}return e.prototype.bind=function(e,t,r){e.bindBufferBase(35345,t,this.buffer),e.bufferSubData(35345,0,this.data)},e}();t.UniformBlock=o},6518:(e,t)=>{"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.GLSLDataType=t.GLSLTypeSize=t.VertexDataFormat=t.UniformSamplerBindings=t.UniformBlockBindings=void 0,t.UniformBlockBindings={CameraUniforms:0,ModelUniforms:1,LightUniforms:2,GlobalUniforms:3,EmitterUniforms:2,EffectUniforms:4,MaterialUniforms:4},t.UniformSamplerBindings={uEnvironmentMap:0,uSampler:0,uGradient:1,uGradientMap:1,uDisplacementMap:5,uAttributes:6,uDiffuseMap:0,uNormalMap:1,uPositionBuffer:2,uNormalBuffer:3,uAlbedoBuffer:4,uArrayMap:7},t.VertexDataFormat={Skinned:{},Static:[{name:"index",size:1,type:5123},{name:"position",size:3,type:5126,normalized:!1,stride:32,offset:0},{name:"normal",size:3,type:5126,normalized:!1,stride:32,offset:12},{name:"uv",size:2,type:5126,normalized:!1,stride:32,offset:24}],Batched2D:[{name:"index",size:1,type:5123},{name:"position",size:2,type:5126,normalized:!1,stride:20,offset:0},{name:"uv",size:2,type:5123,normalized:!0,stride:20,offset:8},{name:"color",size:4,type:5121,normalized:!0,stride:20,offset:12},{name:"material",size:4,type:5121,normalized:!1,stride:20,offset:16}],Batched:[{name:"index",size:1,type:5123},{name:"position",size:3,type:5126,normalized:!1,stride:24,offset:0},{name:"uv",size:2,type:5123,normalized:!0,stride:24,offset:12},{name:"color",size:4,type:5121,normalized:!0,stride:24,offset:16},{name:"normal",size:3,type:5120,normalized:!0,stride:24,offset:20},{name:"material",size:1,type:5121,normalized:!1,stride:24,offset:23}],Decal:[{name:"aModelMatrix",size:16,type:5126,normalized:!1,stride:76,offset:0},{name:"aUV",size:4,type:5123,normalized:!0,stride:76,offset:64},{name:"aColor",size:4,type:5121,normalized:!0,stride:76,offset:72}],StaticParticle:[{name:"aLifetime",size:4,type:5126,normalized:!1,stride:48,offset:0},{name:"aSize",size:4,type:5126,normalized:!1,stride:48,offset:16},{name:"aTransform",size:4,type:5126,normalized:!1,stride:48,offset:32}],Particle:[{name:"aLifetime",size:4,type:5126,normalized:!1,stride:80,offset:0},{name:"aSize",size:4,type:5126,normalized:!1,stride:80,offset:16},{name:"aTransform",size:4,type:5126,normalized:!1,stride:80,offset:32},{name:"aVelocity",size:4,type:5126,normalized:!1,stride:80,offset:48},{name:"aAcceleration",size:4,type:5126,normalized:!1,stride:80,offset:64}]},t.GLSLTypeSize=((r={})[5124]=1,r[35678]=1,r[36289]=1,r[5126]=1,r[35664]=2,r[35665]=3,r[35666]=4,r[35674]=4,r[35675]=9,r[35676]=16,r),t.GLSLDataType=((i={})[5120]=Int8Array,i[5121]=Uint8Array,i[5122]=Int16Array,i[5123]=Uint16Array,i[5124]=Int32Array,i[5125]=Uint32Array,i[35678]=Int32Array,i[36289]=Int32Array,i[5126]=Float32Array,i[35664]=Float32Array,i[35665]=Float32Array,i[35666]=Float32Array,i[35674]=Float32Array,i[35675]=Float32Array,i[35676]=Float32Array,i)},8536:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLState=void 0;var r=function(){function e(e){var t,r;for(var i in this.gl=e,this.extensions={color_buffer_float:this.gl.getExtension("EXT_color_buffer_float"),color_buffer_half_float:this.gl.getExtension("EXT_color_buffer_half_float"),float_blend:this.gl.getExtension("EXT_float_blend"),texture_filter_anisotropic:this.gl.getExtension("EXT_texture_filter_anisotropic"),texture_norm16:this.gl.getExtension("EXT_texture_norm16"),texture_float_linear:this.gl.getExtension("OES_texture_float_linear")},this.cache=((t={})[35661]=this.gl.getParameter(35661),t[35660]=this.gl.getParameter(35660),t[34930]=this.gl.getParameter(34930),t[34921]=this.gl.getParameter(34921),t[36347]=this.gl.getParameter(36347),t[36349]=this.gl.getParameter(36349),t[36348]=this.gl.getParameter(36348),t[3386]=this.gl.getParameter(3386),t[3379]=this.gl.getParameter(3379),t[34024]=this.gl.getParameter(34024),t[34852]=this.gl.getParameter(34852),t[36063]=this.gl.getParameter(36063),t.fragment=this.gl.getShaderPrecisionFormat(35632,36338),t.vertex=this.gl.getShaderPrecisionFormat(35633,36338),t),this.state=((r={})[34229]=null,r[36006]=null,r[36010]=null,r[36007]=null,r[2978]=new Int32Array(4),r[35725]=null,r[34964]=null,r[34016]=33984,r[3553]=Array(this.cache[34930]),r[35866]=Array(this.cache[34930]),r[34067]=Array(this.cache[34930]),r[32879]=Array(this.cache[34930]),r[3106]=new Float32Array(4),r[2931]=1,r[2961]=0,r[2929]=!1,r[2932]=513,r[2928]=[0,1],r[2930]=!0,r[2884]=!1,r[2885]=1029,r[2886]=2305,r[3042]=!1,r[32969]=1,r[32968]=0,r[32971]=1,r[32970]=0,r[32773]=new Float32Array(4),r[32777]=32774,r[34877]=32774,r[3107]=[!0,!0,!0,!0],r[3089]=!1,r[3088]=new Int32Array(4),r),WebGL2RenderingContext.prototype)if(!(i in this)){var a=this.gl[i];"function"==typeof a&&(this[i]=a.bind(this.gl))}}return Object.defineProperty(e.prototype,"canvas",{get:function(){return this.gl.canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.gl.drawingBufferHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawingBufferWidth",{get:function(){return this.gl.drawingBufferWidth},enumerable:!1,configurable:!0}),e.prototype.disable=function(e){this.state[e]&&(this.state[e]=!1,this.gl.disable(e))},e.prototype.enable=function(e){this.state[e]||(this.state[e]=!0,this.gl.enable(e))},e.prototype.viewport=function(e,t,r,i){this.state[2978][0]===e&&this.state[2978][1]===t&&this.state[2978][2]===r&&this.state[2978][3]===i||this.gl.viewport(this.state[2978][0]=e,this.state[2978][1]=t,this.state[2978][2]=r,this.state[2978][3]=i)},e.prototype.blendColor=function(e,t,r,i){this.state[32773][0]===e&&this.state[32773][1]===t&&this.state[32773][2]===r&&this.state[32773][3]===i||this.gl.blendColor(this.state[32773][0]=e,this.state[32773][1]=t,this.state[32773][2]=r,this.state[32773][3]=i)},e.prototype.blendEquation=function(e){this.state[32777]===e&&this.state[34877]===e||this.gl.blendEquation(this.state[32777]=this.state[34877]=e)},e.prototype.blendEquationSeparate=function(e,t){this.state[32777]===e&&this.state[34877]===t||this.gl.blendEquationSeparate(this.state[32777]=e,this.state[34877]=t)},e.prototype.blendFunc=function(e,t){this.state[32969]===e&&this.state[32968]===t&&this.state[32971]===e&&this.state[32970]===t||this.gl.blendFunc(this.state[32969]=this.state[32971]=e,this.state[32968]=this.state[32970]=t)},e.prototype.blendFuncSeparate=function(e,t,r,i){this.state[32969]===e&&this.state[32968]===t&&this.state[32971]===r&&this.state[32970]===i||this.gl.blendFuncSeparate(this.state[32969]=e,this.state[32968]=t,this.state[32971]=r,this.state[32970]=i)},e.prototype.clearColor=function(e,t,r,i){this.state[3106][0]===e&&this.state[3106][1]===t&&this.state[3106][2]===r&&this.state[3106][3]===i||this.gl.clearColor(this.state[3106][0]=e,this.state[3106][1]=t,this.state[3106][2]=r,this.state[3106][3]=i)},e.prototype.clearDepth=function(e){this.state[2931]!==e&&this.gl.clearDepth(this.state[2931]=e)},e.prototype.colorMask=function(e,t,r,i){this.state[3107][0]===e&&this.state[3107][1]===t&&this.state[3107][2]===r&&this.state[3107][3]===i||this.gl.colorMask(this.state[3107][0]=e,this.state[3107][1]=t,this.state[3107][2]=r,this.state[3107][3]=i)},e.prototype.cullFace=function(e){this.state[2885]!==e&&this.gl.cullFace(this.state[2885]=e)},e.prototype.depthFunc=function(e){this.state[2932]!==e&&this.gl.depthFunc(this.state[2932]=e)},e.prototype.depthMask=function(e){this.state[2930]!==e&&this.gl.depthMask(this.state[2930]=e)},e.prototype.depthRange=function(e,t){this.state[2928][0]===e&&this.state[2928][1]===t||this.gl.depthRange(this.state[2928][0]=e,this.state[2928][1]=t)},e.prototype.frontFace=function(e){this.state[2886]!==e&&this.gl.frontFace(this.state[2886]=e)},e.prototype.scissor=function(e,t,r,i){this.state[3088][0]===e&&this.state[3088][1]===t&&this.state[3088][2]===r&&this.state[3088][3]===i||this.gl.scissor(this.state[3088][0]=e,this.state[3088][1]=t,this.state[3088][2]=r,this.state[3088][3]=i)},e.prototype.bindBuffer=function(e,t){this.gl.bindBuffer(e,t)},e.prototype.bindVertexArray=function(e){this.state[34229]!==e&&this.gl.bindVertexArray(this.state[34229]=e)},e.prototype.activeTexture=function(e){this.state[34016]!==e&&this.gl.activeTexture(this.state[34016]=e)},e.prototype.bindTexture=function(e,t){var r=this.state[34016]-33984;this.state[e][r]!==t&&this.gl.bindTexture(e,this.state[e][r]=t)},e.prototype.useProgram=function(e){this.state[35725]!==e&&this.gl.useProgram(this.state[35725]=e)},e.prototype.blitFramebuffer=function(e,t,r,i,a,n,o,s,c,l){this.gl.blitFramebuffer(e,t,r,i,a,n,o,s,c,l)},e.prototype.drawArraysInstanced=function(e,t,r,i){this.gl.drawArraysInstanced(e,t,r,i)},e.prototype.drawElementsInstanced=function(e,t,r,i,a){this.gl.drawElementsInstanced(e,t,r,i,a)},e.prototype.drawRangeElements=function(e,t,r,i,a,n){this.gl.drawRangeElements(e,t,r,i,a,n)},e.prototype.drawArrays=function(e,t,r){this.gl.drawArrays(e,t,r)},e.prototype.drawElements=function(e,t,r,i){this.gl.drawElements(e,t,r,i)},e.prototype.shaderSource=function(e,t){this.gl.shaderSource(e,t)},e}();t.WebGLState=r},2502:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTexture=void 0;var i=r(3297);t.createTexture=function(e,t,r){var a=void 0===r?{}:r,n=a.flipY,o=a.premultiply,s=a.format,c=void 0===s?32856:s,l=a.mipmaps,u=void 0===l?9728:l,f=a.wrap,h=void 0===f?10497:f,m=a.filter,d=void 0===m?9729:m,p=a.type,v=void 0===p?3553:p,y=e.createTexture();e.activeTexture(33984),e.bindTexture(v,y),e.pixelStorei(37440,n),e.pixelStorei(37441,o);var g=i.int32pow2(t.width)&&i.int32pow2(t.height);return g&&u?(e.texParameteri(v,10240,d),e.texParameteri(v,10241,9729===d?9729===u?9987:9985:9729===u?9986:9984)):(e.texParameteri(v,10240,d),e.texParameteri(v,10241,d)),e.texParameteri(v,10242,h),e.texParameteri(v,10243,h),3553===v?(e.texStorage2D(v,1,c,t.width,t.height),t.data&&e.texSubImage2D(v,0,0,0,t.width,t.height,6408,t.data instanceof Float32Array?5126:5121,t.data)):35866===v&&(e.texStorage3D(v,1,c,t.width,t.height,t.depth),t.data&&e.texSubImage3D(v,0,0,0,0,t.width,t.height,t.depth,6408,5121,t.data)),t.data&&g&&u&&e.generateMipmap(v),y}},9844:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(4967),n=r(5623),o=r(4998),s=r(6815),c=r(9026),l=r(720),u=r(1772),f=r(2867),h=r(296),m=r(2851),d=r(2583),p=i(r(387)),v=new URLSearchParams(location.search);new a.Application([f.KeyboardSystem,c.AnimationSystem,n.TransformSystem,o.CameraSystem,s.AudioSystem,l.MaterialSystem,u.MeshSystem,h.DeferredGeometryPass,h.DecalPass,h.AmbientLightPass,h.PointLightPass,h.ParticleEffectPass,h.PostEffectPass,h.OverlayPass,d.SharedSystem,d.TurnBasedSystem,d.TerrainSystem,d.EconomySystem,d.PlayerSystem,d.AISystem,m.DebugSystem],{width:600,height:400,resolution:parseInt(v.get("resolution"))||1}).load(p.default)},1198:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EconomySystem=void 0;var i=r(4454),a=r(3605),n=r(9131),o=r(845),s=r(5091),c=r(3311),l=function(){function e(e){var t=this;this.context=e,this.order=1,this.list=[],this.menu=new o.UpgradeMenu(this.context),this.workshops=[],this.context.get(n.TurnBasedSystem).add(this),this.context.get(n.TurnBasedSystem).signalEnterTile.add((function(e,r,i){if(i instanceof n.Cube)for(var a=t.workshops.length-1;a>=0;a--)t.context.get(n.TurnBasedSystem).enqueue(t.workshops[a].react(i),!0)})),this.context.get(n.TurnBasedSystem).signalReset.add((function(){for(;t.list.length;)t.list.pop().delete();for(;t.workshops.length;)t.workshops.pop().delete()}))}return e.prototype.execute=function(){for(var e=this.workshops.length-1;e>=0;e--)if(this.workshops[e].cube)return this.workshops[e].enterWorkshop(this.workshops[e].cube)},e.prototype.update=function(){var e=this.context.get(a.TerrainSystem),t=e.bounds;if(!(e.frame<this.context.frame)){for(var r=this.list.length-1;r>=0;r--){var n=this.list[r];i.aabb2.inside(t,n.tile)||this.delete(n)}for(r=this.workshops.length-1;r>=0;r--)i.aabb2.inside(t,this.workshops[r].tile)||this.workshops.splice(r,1)[0].delete()}},e.prototype.createDeposit=function(e,t){var r=c.ResourceSpot.pool.pop()||new c.ResourceSpot(this.context);return r.place(e,t),r.capacity=r.amount=1,this.list.push(r),r},e.prototype.createWorkshop=function(e,t){var r=s.Workshop.pool.pop()||new s.Workshop(this.context);return r.place(e,t),r.menu=this.menu,this.workshops.push(r),r},e.prototype.delete=function(e){var t=this.list.indexOf(e);-1!=t&&(t===this.list.length-1?this.list.length--:this.list[t]=this.list.pop(),e.delete())},e.prototype.get=function(e,t){for(var r=this.list.length-1;r>=0;r--)if(this.list[r].tile[0]===e&&this.list[r].tile[1]===t)return this.list[r];return null},e}();t.EconomySystem=l},4192:function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.IconLibrary=void 0;var a=r(296),n=r(757);t.IconLibrary=function(e){var t,r=new n.VectorGraphicsTexture(e.gl,512,512),o="rgba(155,207,197,0.8)",s=((t={})[0]=r.render(32,32,[{line:{width:4},color:o,path:"M 0 0 H 32 V 32 H 0 Z"}]),t[2]=r.render(32,32,[{line:{width:4},color:o,path:"M 0 0 H 32 V 32 H 0 Z"},{line:{width:4},color:o,path:"M 0 16 H 32 M 16 0 V 32"}]),t[3]=r.render(32,32,[{line:{width:4},color:o,path:"M 0 0 H 32 V 32 H 0 Z"},{line:{width:4},color:o,path:"M 16 0 V 32"}]),t[4]=r.render(32,32,[{line:{width:4},color:o,path:"M 0 0 H 32 V 32 H 0 Z"},{line:{width:4},color:o,path:"M 8 16 H 24 M 16 8 V 24"}]),t[6]=r.render(32,32,[{line:{width:4},color:o,path:"M 0 0 H 32 V 32 H 0 Z"},{line:{width:4},color:o,path:"M 0 16 H 32 M 16 0 V 16"}]),t[7]=r.render(32,32,[{line:{width:4},color:o,path:"M 0 0 H 32 V 32 H 0 Z"},{line:{width:4},color:o,path:"M 0 16 H 8 M 32 16 H 24 M 16 0 V 8 M 16 32 V 24 M 8 8 H 24 V 24 H 8 Z"}]),t[8]=r.render(32,32,[{line:{width:4},color:o,path:"M 0 0 H 32 V 32 H 0 Z"},{line:{width:4},color:o,path:"M 10 10 H 22 V 22 H 10 Z"}]),t[10]=r.render(32,32,[{line:{width:4},color:o,path:"M 0 0 H 32 V 32 H 0 Z"},{line:{width:4},color:o,path:"M 16 0 V 8 M 16 32 V 24 M 16 24 L 8 20 V 12 L 16 8 L 24 12 V 20 Z"}]),t[5]=r.render(32,32,[{line:{width:4},color:o,path:"M 0 0 H 32 V 32 H 0 Z"},{line:{width:4},color:o,path:"M 12 8 H 20 L 24 12 V 20 L 20 24 H 12 L 8 20 V 12 Z"}]),t[9]=r.render(32,32,[{line:{width:4},color:o,path:"M 0 0 H 32 V 32 H 0 Z"},{line:{width:4},color:o,path:"M 12 16 A 4 4 0 1 1 20 16 A 4 4 0 1 1 12 16"}]),t),c={slot:r.render(32,32,[{color:"rgba(34,34,34,0.5)",path:"M 4 4 H 28 V 28 H 4 Z"},{line:{width:2},color:"rgba(75,77,67,1)",path:"M 4 4 H 28 V 28 H 4 Z"}]),filled:r.render(32,32,[{color:"rgba(74,74,74,0.5)",path:"M 4 4 H 28 V 28 H 4 Z"},{line:{width:2},color:"rgba(162,171,108,1)",path:"M 4 4 H 28 V 28 H 4 Z"},{shadow:{x:0,y:0,blur:4,color:"#a2ab6c"},color:"rgba(162,171,108,1)",path:"M 10 10 H 22 V 22 H 10 Z"}]),glow:r.render(32,32,[{shadow:{x:0,y:0,blur:4,color:"#dce0bf"},color:"#dce0bf",path:"M 4 4 H 28 V 28 H 4 Z"}]),armor:r.render(32,32,[{line:{width:2},color:"rgba(48,79,96,1)",path:"M 2 2 H 30 V 30 H 2 Z"},{color:"rgba(48,79,96,1)",path:"M 6 6 H 26 L 24 20 L 16 26 L 8 20 Z"},{line:{width:2},color:"rgba(48,79,96,1)",path:"M 16 8 V 22 M 10 15 H 22"}]),storage:r.render(32,32,[{line:{width:2},color:"rgba(188,186,142,1)",path:"M 2 2 H 30 V 30 H 2 Z"},{color:"rgba(188,186,142,1)",path:["M 17 17 H 28 V 28 H 17 Z","M 4 17 H 15 V 28 H 4 Z","M 10 15 H 22 V 4 H 10 Z"].join(" ")}]),rate:r.render(32,32,[{line:{width:2},color:"rgba(206,122,28,1)",path:"M 2 2 H 30 V 30 H 2 Z"},{color:"rgba(206,122,28,1)",path:["M 4 14 V 18 H 20 V 14 Z","M 4 6 V 10 H 20 V 6 Z","M 4 22 V 26 H 20 V 22 Z","M 21 14 V 18 L 30 16 Z","M 21 6 V 10 L 30 8 Z","M 21 22 V 26 L 30 24 Z"].join(" ")}]),efficacy:r.render(32,32,[{line:{width:2},color:"rgba(135,15,73,1)",path:"M 2 2 H 30 V 30 H 2 Z"},{color:"rgba(135,15,73,1)",path:["M 10 16 A 6 6 0 1 1 22 16 A 6 6 0 1 1 10 16","M 4 4 H 12 V 8 H 8 V 12 H 4 Z","M 28 4 H 20 V 8 H 24 V 12 H 28 Z","M 28 28 H 20 V 24 H 24 V 20 H 28 Z","M 4 28 H 12 V 24 H 8 V 20 H 4 Z"].join(" ")}]),range:r.render(32,32,[{line:{width:2},color:"rgba(15,109,91,1)",path:"M 2 2 H 30 V 30 H 2 Z"},{line:{width:2},color:"rgba(15,109,91,1)",path:["M 4 16 A 12 12 0 1 1 28 16 A 12 12 0 1 1 4 16","M 8 16 A 8 8 0 1 1 24 16 A 8 8 0 1 1 8 16"].join(" ")}])};for(var l in r.update(),c)c[l].program=e.get(a.OverlayPass).program;for(var l in s)s[l].program=e.get(a.ParticleEffectPass).program;return i({moduleIcons:s},c)}},3311:function(e,t,r){"use strict";var i=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceSpot=void 0;var a=r(4454),n=r(9336),o=r(296),s=r(6725),c=r(7822),l=r(3605),u=r(1198),f=function(){function e(e){this.context=e,this.tile=a.vec2()}return e.prototype.place=function(e,t){a.vec2.set(e,t,this.tile);var r=this.context.get(l.TerrainSystem).tilePosition(e,t,a.vec3());this.decal=this.context.get(o.DecalPass).create(8),this.decal.transform=this.context.get(n.TransformSystem).create(r,a.quat.IDENTITY,[10,2,10]),this.decal.material=c.SharedSystem.materials.resourceSpotMaterial,this.emitter=c.SharedSystem.particles.glow.start(16,{uLifespan:[1,2,-3,0],uOrigin:r,uRadius:[0,1.8],uSize:[.2,.6],uGravity:[0,4.2,0]})},e.prototype.delete=function(){this.context.get(n.TransformSystem).delete(this.decal.transform),this.decal=void this.context.get(o.DecalPass).delete(this.decal),this.emitter=void c.SharedSystem.particles.glow.stop(this.emitter),e.pool.push(this)},e.prototype.drain=function(e,t){var r,n,o;return i(this,(function(i){switch(i.label){case 0:this.amount-=t,r=s.AnimationTimeline(this,{"decal.threshold":s.PropertyAnimation([{frame:0,value:this.decal.threshold},{frame:e,value:a.lerp(1,0,this.amount/this.capacity),ease:s.ease.linear}],a.lerp)}),n=this.context.currentTime,i.label=1;case 1:return o=this.context.currentTime-n,r(o,this.context.deltaTime),o>e?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return this.amount>=t||this.context.get(u.EconomySystem).delete(this),[2]}}))},e.pool=[],e}();t.ResourceSpot=f},845:function(e,t,r){"use strict";var i=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpgradeMenu=void 0;var a=r(4454),n=r(6725),o=r(8581),s=r(9336),c=r(296),l=r(6365),u=r(757),f=r(2867),h=r(9131),m=r(7822),d=r(4192),p=function(){function e(e){var t=this;this.context=e,this.upgrades=[{module:0,type:"armor",limit:6,amount:0,cost:4,upgrade:function(e){return e.cube.health.amount=++e.cube.health.capacity}},{module:0,type:"storage",limit:4,amount:0,cost:4,upgrade:function(e){return e.cube.matter.capacity++}},{module:8,type:"storage",limit:4,amount:0,cost:4,upgrade:function(e){return e.skills[8].indicator.capacity++}},{module:4,type:"efficacy",limit:2,amount:0,cost:4,upgrade:function(e){return e.skills[4].damage++}},{module:9,type:"storage",limit:2,amount:0,cost:4,upgrade:function(e){return e.skills[9].indicator.capacity++}},{module:5,type:"efficacy",limit:2,amount:0,cost:4,upgrade:function(e){return e.skills[5].damage++}},{module:7,type:"efficacy",limit:2,amount:0,cost:4,upgrade:function(e){return e.skills[7].damage++}},{module:2,type:"range",limit:3,amount:0,cost:4,upgrade:function(e){return e.skills[2].range++}},{module:2,type:"rate",limit:4,amount:0,cost:4,upgrade:function(e){return e.skills[2].indicator.capacity++}},{module:10,type:"rate",limit:2,amount:0,cost:4,upgrade:function(e){return e.skills[10].indicator.capacity++}},{module:10,type:"efficacy",limit:1,amount:0,cost:4,upgrade:function(e){return e.skills[10].damage++}},{module:3,type:"efficacy",limit:4,amount:0,cost:4,upgrade:function(e){return e.skills[3].damage++}},{module:6,type:"range",limit:2,amount:0,cost:4,upgrade:function(e){return e.skills[6].range++}},{module:6,type:"efficacy",limit:1,amount:0,cost:4,upgrade:function(e){return e.skills[6].damage++}}],this.availableModules=[0,2,3,5,6,4,7,8,9,10],this.color=a.vec4(),this.carouselIcons=[],this.icons=d.IconLibrary(e);var r=o.Transform2D.create();this.upgradePanel=o.Sprite2D.create(-1,a.vec2.HALF),a.vec4.set(.05,.05,.05,.75,this.upgradePanel.color),this.upgradePanel.material=m.SharedSystem.materials.sprite.fade,this.upgradePanel.transform=o.Transform2D.create(a.vec2(0,56),a.vec2(32*this.upgrades.length,272),0,r),this.upgradeIcons=this.upgrades.map((function(e,i){var n=32*(i-.5*(t.upgrades.length-1)),s=o.Sprite2D.create(1,a.vec2.HALF);s.material=u.SpriteMaterial.copy(t.icons.moduleIcons[e.module],new u.SpriteMaterial),s.material.program=t.context.get(c.OverlayPass).program,s.transform=o.Transform2D.create([n,-64],a.vec2.ONE,0,r);var l=o.Sprite2D.create(1,a.vec2.HALF);l.material=t.icons[e.type],l.transform=o.Transform2D.create([n,-32],a.vec2.ONE,0,r);for(var f=[],h=0;h<e.limit;h++){var m=f[h]=o.Sprite2D.create(1,a.vec2.HALF);m.material=t.icons.slot,m.transform=o.Transform2D.create([n,32*h+16],a.vec2.ONE,0,r)}return{module:s,type:l,slots:f}}))}return e.prototype.open=function(t){var r,l,u,f,h,m,d;return i(this,(function(i){switch(i.label){case 0:for(r=a.quat(),this.carouselTransform=this.context.get(s.TransformSystem).create(a.vec3.ZERO,a.quat.IDENTITY,[1.2,1.2,1.2],t.transform),d=0;d<this.availableModules.length;d++)l=this.carouselIcons[d]=o.Sprite.create(0,0),u=2*Math.PI*d/this.availableModules.length,l.transform=this.context.get(s.TransformSystem).create([2*-Math.sin(u),2*Math.cos(u),0],a.quat.HALF_N_X,a.vec3.ONE,this.carouselTransform),a.quat.multiply(a.quat.axisAngle(a.vec3.AXIS_Z,u,r),l.transform.rotation,l.transform.rotation),l.material=this.icons.moduleIcons[this.availableModules[d]],this.context.get(c.OverlayPass).add(l);this.moduleIndex=this.availableModules.indexOf(t.sides[t.side].type),h=this.context.currentTime,i.label=1;case 1:if(-1==this.actionIndex)return[3,4];for(m=this.context.currentTime-h,a.vec4.lerp(a.vec4.ZERO,e.enabled,Math.min(1,m/.5),this.color),this.moduleIndex=a.mod(this.moduleIndex,this.availableModules.length),u=2*Math.PI*(1-this.moduleIndex/this.availableModules.length),a.quat.axisAngle(a.vec3.AXIS_Z,u,r),a.quat.slerp(this.carouselTransform.rotation,r,.1,this.carouselTransform.rotation),this.carouselTransform.frame=0,d=this.carouselIcons.length-1;d>=0;d--)a.vec4.lerp(this.color,a.vec4.ZERO,Math.min(1,.4*Math.abs(a.moddelta(this.availableModules.length,d,this.moduleIndex))),this.carouselIcons[d].color);return[4,n.ActionSignal.WaitNextFrame];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:f=.4,h=this.context.currentTime,i.label=5;case 5:for(m=this.context.currentTime-h,a.vec4.lerp(a.vec4.ZERO,e.enabled,1-Math.min(1,m/.5),this.color),d=this.carouselIcons.length-1;d>=0;d--)a.vec4.lerp(this.color,a.vec4.ZERO,Math.min(1,.4*Math.abs(a.moddelta(this.availableModules.length,d,this.moduleIndex))),this.carouselIcons[d].color);return m>f?[3,9]:[3,6];case 6:return[4,n.ActionSignal.WaitNextFrame];case 7:i.sent(),i.label=8;case 8:return[3,5];case 9:for(d=this.carouselIcons.length-1;d>=0;d--)this.context.get(s.TransformSystem).delete(this.carouselIcons[d].transform),this.context.get(c.OverlayPass).remove(this.carouselIcons[d]),this.carouselIcons[d]=void o.Sprite.delete(this.carouselIcons[d]);return this.context.get(s.TransformSystem).delete(this.carouselTransform),[2]}}))},e.prototype.upgrade=function(){var e,t,r,o,s,u,m,d,p,v,y,g,x,b,S,P,O,T,w,_;return i(this,(function(i){switch(i.label){case 0:e=this.context.get(c.OverlayPass),t=this.upgradeIcons.reduce((function(e,t){return e.concat(t.slots,t.type,t.module)}),[]).concat(this.upgradePanel),(_=e.list2d).push.apply(_,t),this.cameraOffset=this.context.get(h.PlayerSystem).cameraOffset,r=n.AnimationTimeline(this,{cameraOffset:n.PropertyAnimation([{frame:0,value:a.vec3.copy(this.cameraOffset,a.vec3())},{frame:.5,value:[1,0,4],ease:n.ease.quadInOut}],a.vec3.lerp),"upgradePanel.transform.parent.position":n.PropertyAnimation([{frame:0,value:a.vec2(.5*this.context.canvas.width,.5*this.context.canvas.height+this.upgradePanel.transform.scale[1])},{frame:.5,value:a.vec2(.5*this.context.canvas.width,.5*this.context.canvas.height),ease:n.ease.quadInOut}],a.vec2.lerp)}),o=this.context.get(f.KeyboardSystem),s=this.context.get(h.PlayerSystem),u=0,m=a.vec4(.4,.4,.5,1),d=a.vec4(1,1,1,0),this.context.get(l.AudioSystem).create("assets/menu_select.mp3","sfx",null).play(0),P=this.context.currentTime,i.label=1;case 1:return O=this.context.currentTime-P,r(O,this.context.deltaTime),o.trigger(h.PlayerSystem.input.down)?[3,12]:[3,2];case 2:return o.trigger(h.PlayerSystem.input.left)?(u=Math.max(0,u-1),[3,9]):[3,3];case 3:return o.trigger(h.PlayerSystem.input.right)?(u=Math.min(this.upgrades.length-1,u+1),[3,9]):[3,4];case 4:if(!o.down(h.PlayerSystem.input.action))return[3,9];if(!((p=this.upgrades[u]).amount<p.limit&&s.cube.matter.amount>=p.cost))return[3,9];s.cube.matter.amount-=p.cost,(v=this.upgradeIcons[u].slots[p.amount++]).material=this.icons.filled,v.frame=0,p.upgrade(s),y=this.animateSlotUpgrade(v),i.label=5;case 5:return(g=y.next()).done?[3,9]:[3,6];case 6:return[4,g.value];case 7:i.sent(),i.label=8;case 8:return[3,5];case 9:for(T=this.upgradeIcons.length-1;T>=0;T--)for(x=this.upgradeIcons[T],a.vec4.lerp(x.type.color,T===u?d:m,.2,x.type.color),a.vec4.lerp(x.module.color,T===u?d:m,.2,x.module.color),b=x.slots.length-1;b>=0;b--)a.vec4.lerp(x.slots[b].color,T===u?d:m,.2,x.slots[b].color);return[4,n.ActionSignal.WaitNextFrame];case 10:i.sent(),i.label=11;case 11:return[3,1];case 12:this.context.get(l.AudioSystem).create("assets/menu_select.mp3","sfx",null).play(0),S=.5,P=this.context.currentTime,i.label=13;case 13:return O=this.context.currentTime-P,r(S-O,this.context.deltaTime),O>S?[3,17]:[3,14];case 14:return[4,n.ActionSignal.WaitNextFrame];case 15:i.sent(),i.label=16;case 16:return[3,13];case 17:for(T=t.length-1;T>=0;T--)w=e.list2d.indexOf(t[T]),e.list2d[w]=e.list2d[e.list2d.length-1],e.list2d.length--;return[2]}}))},e.prototype.animateSlotUpgrade=function(e){var t,r,s,u,f,h,m;return i(this,(function(i){switch(i.label){case 0:t=this.context.get(c.OverlayPass),(r=o.Sprite2D.create(2,a.vec2.HALF)).material=this.icons.glow,r.transform=e.transform,t.list2d.push(r),s=n.PropertyAnimation([{frame:0,value:a.vec4.ZERO},{frame:.2,value:[1,1,1,0],ease:n.ease.quadOut},{frame:.5,value:a.vec4.ZERO,ease:n.ease.sineIn}],a.vec4.lerp),this.context.get(l.AudioSystem).create("assets/menu_upgrade.mp3","sfx",null).play(0),u=.5,f=this.context.currentTime,i.label=1;case 1:return h=this.context.currentTime-f,s(h,r.color),h>u?[3,5]:[3,2];case 2:return[4,n.ActionSignal.WaitNextFrame];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return m=t.list2d.indexOf(r),t.list2d[m]=t.list2d[t.list2d.length-1],t.list2d.length--,[2]}}))},e.enabled=a.vec4(1,1,1,.4),e}();t.UpgradeMenu=p},5091:function(e,t,r){"use strict";var i=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Workshop=void 0;var a=r(4454),n=r(9336),o=r(6725),s=r(8581),c=r(296),l=r(6365),u=r(2867),f=r(3605),h=r(7822),m=r(9131),d={"cubeMesh.color":o.PropertyAnimation([{frame:0,value:[8,0,2,.2]},{frame:.6,value:a.vec4.ONE,ease:o.ease.quadOut}],a.vec4.lerp),smoke:o.EventTrigger([{frame:0,value:16}],o.EventTrigger.emit),"glow.transform.scale":o.PropertyAnimation([{frame:0,value:[2,0,2]},{frame:.6,value:[2,6,2],ease:o.ease.quintOut}],a.vec3.lerp),"glow.color":o.PropertyAnimation([{frame:0,value:[.9,1,.6,0]},{frame:.6,value:a.vec4.ZERO,ease:o.ease.sineIn}],a.vec4.lerp),"cover.color":o.PropertyAnimation([{frame:0,value:a.vec4.ONE},{frame:.6,value:[1,.6,.2,0],ease:o.ease.sineOut}],a.vec4.lerp)},p=function(){function e(e){this.context=e,this.weight=0,this.tile=a.vec2(),this.opened=!1,this.cube=null}return e.prototype.place=function(t,r){a.vec2.set(t,r,this.tile),this.mesh=this.context.get(s.MeshSystem).loadModel("dock"),this.mesh.layer=2,this.mesh.transform=this.context.get(n.TransformSystem).create();var i=this.mesh.transform.position;this.context.get(f.TerrainSystem).tilePosition(t,r,i);var o=this.context.get(f.TerrainSystem).chunk(t,r),c=[i[0]-3,i[2]-3,i[0]+3,i[2]+3];o.mapRegion(c,c),o.terraform(c,(function(){return i[1]})),this.context.get(f.TerrainSystem).tilePosition(t,r,i),a.quat.axisAngle(a.vec3.AXIS_Y,.5*Math.PI,this.mesh.armature.nodes[0].rotation),h.ModelAnimation.map.dock.open(0,this.mesh.armature);for(var l=0;l<e.area.length;l++)this.context.get(f.TerrainSystem).setTile(e.area[l][0]+t,e.area[l][1]+r,this)},e.prototype.delete=function(){this.context.get(n.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),e.pool.push(this)},e.prototype.react=function(e){var t,r,a,n,s,c;return i(this,(function(i){switch(i.label){case 0:if(t=Math.abs(e.tile[0]-this.tile[0]),r=Math.abs(e.tile[1]-this.tile[1]),this.context.get(m.PlayerSystem).theme.set(1,Math.max(t,r)<=4),(a=0===t&&r<=2)&&0===r&&(e.action.amount=e.movement.amount=0,this.cube=e),this.opened===a)return[2];if(!(this.opened=a))return[3,6];n=.64,s=this.context.currentTime,i.label=1;case 1:return c=this.context.currentTime-s,h.ModelAnimation.map.dock.open(Math.min(1,c/n),this.mesh.armature),c>=n?[3,5]:[3,2];case 2:return[4,o.ActionSignal.WaitNextFrame];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return[3,11];case 6:n=.64,s=this.context.currentTime,i.label=7;case 7:return c=this.context.currentTime-s,h.ModelAnimation.map.dock.open(1-Math.min(1,c/n),this.mesh.armature),c>=n?[3,11]:[3,8];case 8:return[4,o.ActionSignal.WaitNextFrame];case 9:i.sent(),i.label=10;case 10:return[3,7];case 11:return[2]}}))},e.prototype.enterWorkshop=function(e){var t,r,f,p,v,y,g,x,b,S,P,O,T,w;return i(this,(function(i){switch(i.label){case 0:a.vec2.set(this.tile[0],this.tile[1]+3,this.context.get(m.PlayerSystem).origin),t=this.cubeMesh=e.meshes[e.side],r=a.vec3.copy(t.transform.position,a.vec3()),f=a.vec3.add(this.mesh.transform.position,[0,2,0],a.vec3()),p=this.context.get(m.PlayerSystem).cameraOffset,v=a.vec3.copy(p,a.vec3()),y=a.vec3(-2,4,2),this.context.get(l.AudioSystem).create("assets/lift_up.mp3","sfx",this.mesh.transform).play(0),O=1,T=this.context.currentTime,i.label=1;case 1:return w=Math.min(1,(this.context.currentTime-T)/O),h.ModelAnimation.map.dock.lift(w,this.mesh.armature),a.vec3.lerp(r,f,o.ease.quadIn(w),t.transform.position),a.vec3.lerp(v,y,o.ease.quadInOut(w),p),t.transform.frame=0,w>=1?[3,5]:[3,2];case 2:return[4,o.ActionSignal.WaitNextFrame];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:g=this.context.get(u.KeyboardSystem),e.health.amount=e.health.capacity,this.smoke=h.SharedSystem.particles.smoke.add({uOrigin:a.vec3.add(t.transform.position,[0,1,0],a.vec3()),uLifespan:[.8,1.2,-.2,0],uSize:[2,5],uRotation:[0,2*Math.PI],uGravity:[0,10,0],uFieldDomain:a.vec4.ONE,uFieldStrength:[8,0]}),this.glow=s.BatchMesh.create(h.SharedSystem.geometry.openBox),this.glow.material=h.SharedSystem.materials.gradientMaterial,this.glow.transform=this.context.get(n.TransformSystem).create(a.vec3.ZERO,a.quat.IDENTITY,a.vec3.ONE,t.transform),this.context.get(c.ParticleEffectPass).add(this.glow),this.cover=s.Sprite.create(0,0,a.vec4.ZERO),this.cover.material=h.SharedSystem.materials.effect.planeDissolve,this.cover.transform=this.context.get(n.TransformSystem).create([0,2.02,0],a.quat.HALF_X,a.vec3(2,2,2),t.transform),this.context.get(c.ParticleEffectPass).add(this.cover),this.menu.actionIndex=this.context.get(o.AnimationSystem).start(this.menu.open(e),!0),i.label=6;case 6:return[4,o.ActionSignal.WaitNextFrame];case 7:return i.sent(),g.down(m.PlayerSystem.input.down)?[3,21]:[3,8];case 8:return g.trigger(m.PlayerSystem.input.left)?(this.context.get(l.AudioSystem).create("assets/menu_select.mp3","sfx",null).play(0),this.menu.moduleIndex++,[3,15]):[3,9];case 9:return g.trigger(m.PlayerSystem.input.right)?(this.context.get(l.AudioSystem).create("assets/menu_select.mp3","sfx",null).play(0),this.menu.moduleIndex--,[3,15]):[3,10];case 10:if(!g.trigger(m.PlayerSystem.input.action))return[3,15];x=(4-e.direction)%4,e.installModule(e.side,x,this.menu.availableModules[this.menu.moduleIndex]),b=o.AnimationTimeline(this,d),this.context.get(l.AudioSystem).create("assets/menu_install.mp3","sfx",e.transform).play(0),O=.6,T=this.context.currentTime,i.label=11;case 11:return S=this.context.currentTime-T,b(S,this.context.deltaTime),S>O?[3,15]:[3,12];case 12:return[4,o.ActionSignal.WaitNextFrame];case 13:i.sent(),i.label=14;case 14:return[3,11];case 15:if(!g.down(m.PlayerSystem.input.up))return[3,20];P=this.menu.upgrade(),i.label=16;case 16:return P.next().done?[3,20]:[3,17];case 17:return[4,o.ActionSignal.WaitNextFrame];case 18:i.sent(),i.label=19;case 19:return[3,16];case 20:return[3,6];case 21:this.menu.actionIndex=-1,this.context.get(l.AudioSystem).create("assets/lift_down.mp3","sfx",this.mesh.transform).play(0),O=1,T=this.context.currentTime,i.label=22;case 22:return w=Math.min(1,(this.context.currentTime-T)/O),h.ModelAnimation.map.dock.lift(1-w,this.mesh.armature),a.vec3.lerp(r,f,o.ease.quadIn(1-w),t.transform.position),a.vec3.lerp(v,y,o.ease.quadInOut(1-w),p),t.transform.frame=0,w>=1?[3,26]:[3,23];case 23:return[4,o.ActionSignal.WaitNextFrame];case 24:i.sent(),i.label=25;case 25:return[3,22];case 26:return this.cube=null,this.context.get(n.TransformSystem).delete(this.glow.transform),this.context.get(n.TransformSystem).delete(this.cover.transform),this.context.get(c.ParticleEffectPass).remove(this.cover),this.context.get(c.ParticleEffectPass).remove(this.glow),this.cover=void s.Sprite.delete(this.cover),this.glow=void s.BatchMesh.delete(this.glow),this.smoke=void h.SharedSystem.particles.smoke.remove(this.smoke),[2]}}))},e.pool=[],e.area=[[-1,-1],[1,-1],[-1,0],[1,0],[-1,1],[1,1]],e}();t.Workshop=p},8967:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(3311),t),a(r(5091),t),a(r(1198),t)},2583:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(7822),t),a(r(3605),t),a(r(8967),t),a(r(9131),t),a(r(6888),t)},2969:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AISystem=void 0;var i=r(4454),a=r(6725),n=r(9131),o=r(7631),s=r(3605),c=r(8537),l=function(){function e(e){var t=this;this.context=e,this.order=2,this.list=[],this.propagationRadius=2,this.revealRadius=6,this.context.get(n.TurnBasedSystem).add(this),this.context.get(n.TurnBasedSystem).signalReset.add((function(){for(var e=t.list.length-1;e>=0;e--){var r=t.list[e];t.remove(r),r.delete()}}))}var t,r,l;return e.prototype.update=function(){var e=this.context.get(s.TerrainSystem),t=e.bounds;if(!(e.frame<this.context.frame))for(var r=this.list.length-1;r>=0;r--){var a=this.list[r];i.aabb2.inside(t,a.tile)||(this.remove(a),a.delete())}},e.prototype.create=function(e,t,r,i){if(i)for(var a=this.list.length-1;a>=0;a--)if(this.list[a].hash===i)return null;var n=o.UnitFactory[r],s=n.pool.pop()||new n(this.context);return s.hash=i,s.health.amount=s.health.capacity,s.action.amount=s.movement.amount=0,s.strategy.unit=s,s.strategy.aware=!1,this.list.push(s),s.place(e,t),s.status=c.StatusBar.create(this.context,s),s},e.prototype.remove=function(e){var t=this.list.indexOf(e);-1!==t&&(t===this.list.length-1?this.list.length--:this.list[t]=this.list.pop(),e.status.delete(),e.markTiles(!1))},e.prototype.execute=function(){console.time("AI");for(var e=[],t=[],r=this.revealRadius*this.revealRadius,o=this.context.get(n.PlayerSystem).cube.tile,s=this.list.length-1;s>=0;s--)(h=this.list[s]).strategy.aware||(h.strategy.aware=i.vec2.distanceSquared(h.tile,o)<=r);this.propagate(this.propagationRadius);var c=0;for(s=this.list.length-1;s>=0;s--)(h=this.list[s]).health.amount<=0||(h.regenerate(),h.strategy.precalculate(),h.strategy.aware&&e.push(h),h.strategy.aware&&(c=Math.max(h.size[0],c)));for(this.context.get(n.PlayerSystem).theme.set(2,c>0),this.context.get(n.PlayerSystem).theme.set(3,c>1);e.length;){var l=void 0,u=void 0;for(s=e.length-1;s>=0;s--){var f=e[s].strategy.plan(null==u?void 0:u.priority);u&&u.priority>=f.priority||(u=f,l=s)}var h=e[l];e[l]=e[e.length-1],e.length--,h.strategy.clear(),t.push(h.execute(u))}return console.timeEnd("AI"),a.AnimationSystem.zip(t)},e.prototype.propagate=function(e){for(var t=e*e,r=i.range(this.list.length),a=this.list.length-1;a>=0;a--){var n=this.list[a];if(!n.strategy.aware){for(var o=this.list.length-1;o>=0;o--){var s=this.list[o];if(!(i.vec2.distanceSquared(n.tile,s.tile)>t)){if(s.strategy.aware){n.strategy.aware=!0;break}if(!(o>=a))for(var c=o;;){var l=r[c];if(l==a)break;if(l==o){r[c]=r[a],r[a]=o;break}c=l}}}if(n.strategy.aware)for(c=r[a];c!=a;c=r[c])this.list[c].strategy.aware=!0}}},e.special=(t=[{size:0,value:null},{size:2,value:3},{size:3,value:5}],l=(r=[4,3,1]).reduce((function(e,t){return e+t}),0),function(e){for(var i=e*l|0,a=0,n=0;n<r.length;n++)if(i<(a+=r[n]))return t[n]}),e.groups=[[1,1,2,4],[0,0,0,2,4],[0,0,0,4],[0,0,1],[0,0,0,0,2,2],[1,1,4,4,8],[8,8,6,2],[6,6,7,7]],e}();t.AISystem=l},7923:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AIStrategy=void 0;var i=r(4454),a=r(3605),n=r(9131),o=function(){function e(e,t){void 0===t&&(t=6),this.context=e,this.lookahead=t,this.size=2*this.lookahead+1,this.influence=new Uint16Array(this.size*this.size).fill(65535),this.map=this.context.get(a.TerrainSystem).pathfinder,this.optimal={priority:0,delay:0,skill:-1,origin:i.vec2()},this.diagonal=!1,this.fuzzy=0,this.skill=0,this.aware=!1}return e.lineOfSight=function(e,t,r){for(var i=t[0]<=r[0]?1:-1,a=t[1]<=r[1]?1:-1,n=Math.abs(r[0]-t[0]),o=Math.abs(r[1]-t[1]),s=0,c=0;s<n||c<o;){var l=(1+2*s)*o-(1+2*c)*n,u=t[0]+s*i,f=t[1]+c*a;if(0==e.weight[e.tileIndex(u,f)])return!1;if(0===l){if(0==e.weight[e.tileIndex(u+i,f)]&&0==e.weight[e.tileIndex(u,f+a)])return!1;s++,c++}else l<0?s++:c++}return!0},e.prototype.precalculate=function(){if(this.aware){for(var t=this.context.get(a.TerrainSystem).pathfinder,r=e.tile,o=this.context.get(n.PlayerSystem).cube,s=this.unit.skills[this.skill],c=s.range,l=s.cardinal,u=Math.ceil(c),f=c*c,h=-u;h<=u;h++)for(var m=-u;m<=u;m++)h*h+m*m>f||l&&0!=h&&0!=m||(i.vec2.set(o.tile[0]+h,o.tile[1]+m,r),0!==t.weight[t.tileIndex(r[0],r[1])]&&(t.add(r),-1!=(v=this.tileIndex(r[0],r[1]))&&(this.influence[v]=0)));var d=t.linkPath(t.search(this.unit.tile,this.unit.size,this.diagonal));t.clear();for(var p=0;p<d.length;p++){var v;t.indexTile(d[p],r),-1!=(v=this.tileIndex(r[0],r[1]))&&(this.influence[v]=p)}t.add(this.unit.tile),t.walk(this.walkPropagate,this,this.unit.size,this.diagonal,void 0,!0);for(var y=0;y<this.size;y++)for(var g=0;g<this.size;g++){r[0]=y+this.unit.tile[0]-this.lookahead,r[1]=g+this.unit.tile[1]-this.lookahead;var x=y+g*this.size,b=t.tileIndex(r[0],r[1]);this.influence[x]=t.flags[b]?0|this.evaluate(r,t.distance[b],this.influence[x]):0,t.influence[b]+=this.influence[x]}t.clear()}},e.prototype.plan=function(e){var t=this;if(!this.aware)return this.optimal;if(this.optimal.delay=0,this.optimal.priority=Number.MIN_SAFE_INTEGER,i.vec2.copy(this.unit.tile,this.optimal.origin),this.map.add(this.unit.tile),this.unit.markTiles(!1),this.map.walk(this.walkFind,this,this.unit.size,this.diagonal,1,!1),this.optimal.path=null,!(this.optimal.priority===Number.MIN_SAFE_INTEGER||this.optimal.priority<e)){var r=this.map.linkPath(this.map.tileIndex(this.optimal.origin[0],this.optimal.origin[1])).slice(0,1+Math.floor(this.unit.movement.amount));r.length<2||(this.optimal.path=r.map((function(e){return t.map.indexTile(e,i.vec2())})))}if(this.map.clear(),this.optimal.skill=-1,!(this.unit.skills[this.skill].cost>this.unit.action.amount)){var a=this.context.get(n.PlayerSystem).cube;this.optimal.target=this.unit.skills[this.skill].aim(this.optimal.origin,a.tiles,1),(this.optimal.reverse=!this.optimal.target)&&(this.optimal.target=this.unit.skills[this.skill].aim(this.unit.tile,a.tiles,1)),this.optimal.target?this.optimal.skill=this.skill:this.optimal.priority*=.5}return this.unit.markTiles(!0),this.optimal},e.prototype.walkPropagate=function(t,r,i,a,n){if(i>this.lookahead)return!1;var o=this.tileIndex(r[0],r[1]);if(-1!==a){var s=this.map.indexTile(a,e.tile),c=this.tileIndex(s[0],s[1]);this.influence[o]=Math.min(this.influence[o],this.influence[c]+1),this.influence[c]=Math.min(this.influence[c],this.influence[o]+1)}return n&&(this.map.estimate[t]=this.influence[o]),!0},e.prototype.walkFind=function(t,r,a,n,o){if(a>this.unit.movement.amount||!o)return!1;var s=this.influence[this.tileIndex(r[0],r[1])],c=this.map.influence[t]-s,l=i.randomFloat(1-this.fuzzy,1+this.fuzzy,e.random())*s/(1+c/s);return l>this.optimal.priority&&(i.vec2.copy(r,this.optimal.origin),this.optimal.priority=l),!0},e.prototype.evaluate=function(e,t,r){var i=this.context.get(n.PlayerSystem).cube,a=this.unit.skills[this.skill],o=a.range,s=a.cardinal,c=(a.damage,255/(1+r));if(this.unit.skills[this.skill].aim(e,i.tiles)&&(c=510),!(s||o<2)){var l=Math.min(Math.abs(e[0]-i.tile[0]),Math.abs(e[1]-i.tile[1]));c*=Math.min(1,.8+.1*l)}var u=Math.ceil(Math.max(0,t-this.unit.movement.amount)/this.unit.movement.gain);return c*Math.pow(.5,u)},e.prototype.tileIndex=function(e,t){return e-=this.unit.tile[0]-this.lookahead,t-=this.unit.tile[1]-this.lookahead,e<0||t<0||e>=this.size||t>=this.size?-1:e+t*this.size},e.prototype.clear=function(){for(var e=this.unit.tile[0]-this.lookahead,t=this.unit.tile[1]-this.lookahead,r=0;r<this.size;r++)for(var i=0;i<this.size;i++){var a=r+i*this.size,n=this.map.tileIndex(r+e,i+t);this.map.influence[n]-=this.influence[a],this.influence[a]=65535}},e.random=i.mulberry32(),e.tile=i.vec2(),e}();t.AIStrategy=o},1929:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AIUnit=void 0;var o=r(4454),s=r(6725),c=r(3605),l=r(9131),u=r(8474),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shield=0,t.weight=2,t.movementFloat=0,t}return a(t,e),t.prototype.execute=function(e){var t=this.context.get(c.TerrainSystem).pathfinder,r=[];if(-1!=e.skill&&e.reverse&&(e.delay+=this.skills[e.skill].duration),e.path){this.movement.amount-=e.path.length-1;for(var i=[],a=this.context.currentTime+e.delay,n=0;n<e.path.length-1;n++){var l=e.path[n],u=e.path[n+1],f=t.marked[t.tileIndex(u[0],u[1])];a=Math.max(a,f),i.push(a-this.context.currentTime-e.delay),a+=n?this.movementDuration:2*this.movementDuration,t.marked[t.tileIndex(l[0],l[1])]=a}i.push(a-this.context.currentTime),i.push(i[i.length-1]+2*this.movementDuration),r.push(this.move(e.path,i)),this.markTiles(!1),o.vec2.copy(e.path[e.path.length-1],this.tile),this.markTiles(!0)}if(-1!=e.skill){this.action.amount-=this.skills[e.skill].cost;var h=this.skills[e.skill].use(this,e.target);e.reverse?r.unshift(h):r.push(h)}return s.AnimationSystem.join(r)},t.prototype.damage=function(e,t){this.shield||this.health.amount<=0||(this.strategy.aware=!0,this.health.amount-=e,this.status.update(this),0!=(16&t)&&(this.movement.amount=-this.movement.gain),this.health.amount>0?u.DamageEffect.create(this.context,this,t):u.DeathEffect.create(this.context,this))},t.prototype.deactivate=function(){return n(this,(function(e){return[2]}))},t.prototype.moveAlongPath=function(e,t,r){var i,a,c,u,f,h,m,d,p,v,y,g,x,b,S,P,O,T;return n(this,(function(n){switch(n.label){case 0:i=this.mesh.transform,a=o.vec3(),c=o.quat.copy(i.rotation,o.quat()),u=o.vec3(),f=o.vec3(),h=o.vec3(),m=this.context.currentTime,d=t[t.length-1],p=e.length-1,v=0,n.label=1;case 1:if(!(v<=p))return[3,6];y=e[v],this.snapPosition(y,h),this.context.get(l.TurnBasedSystem).signalEnterTile.broadcast(y[0],y[1],this),0==v?o.vec3.copy(h,u):this.snapPosition(e[v-1],u),v==p?o.vec3.copy(h,f):this.snapPosition(e[v+1],f),o.vec3.centroid(u,h,u),o.vec3.centroid(f,h,f),0!=v&&v!=p||o.vec3.centroid(u,f,h),x=0==(g=0==v?0:v==p?2:1)?s.ease.quadIn:2==g?s.ease.quadOut:s.ease.linear,b=t[v],S=t[v+1]-b,n.label=2;case 2:return P=Math.max(0,this.context.currentTime-m-b),O=Math.min(1,P/S),o.quadraticBezier3D(u,h,f,x(O),i.position),r&&(0==g?(o.vec3.subtract(f,u,a),o.quat.fromNormal(o.vec3.normalize(a,a),o.vec3.AXIS_Y,i.rotation),o.quat.slerp(c,i.rotation,s.ease.quadOut(O),i.rotation)):(o.quadraticBezierNormal3D(u,h,f,x(O),a),o.quat.fromNormal(o.vec3.normalize(a,a),o.vec3.AXIS_Y,i.rotation),o.quat.normalize(i.rotation,i.rotation))),i.frame=0,T=this.context.currentTime-m,this.movementFloat=o.clamp(Math.min(d-T,T)/this.movementDuration,0,1),P>S?[3,5]:[4,s.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,2];case 5:return v++,[3,1];case 6:return[2]}}))},t.prototype.rotate=function(e,t){var r,i,a,c,l,u,f;return n(this,(function(n){switch(n.label){case 0:if(r=Math.atan2(e[0]-(this.tile[0]+.5*(this.size[0]-1)),e[1]-(this.tile[1]+.5*(this.size[1]-1))),t&&(r=.5*Math.round(2*r/Math.PI)*Math.PI),i=this.mesh.transform.rotation,a=o.quat.axisAngle(o.vec3.AXIS_Y,r,o.quat()),o.quat.angle(i,a)<.001)return[2];c=this.movementDuration,l=this.context.currentTime,n.label=1;case 1:return u=this.context.currentTime-l,f=Math.min(1,u/c),o.quat.slerp(i,a,s.ease.quadInOut(f),this.mesh.transform.rotation),this.mesh.transform.frame=0,u>c?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return[2]}}))},t.prototype.markTiles=function(e){for(var t=this.context.get(c.TerrainSystem),r=this.size[0]-1;r>=0;r--)for(var i=this.size[1]-1;i>=0;i--)t.setTile(this.tile[0]+r,this.tile[1]+i,e?this:null)},t.prototype.snapPosition=function(e,t){var r=e[0]+.5*(this.size[0]-1),i=e[1]+.5*(this.size[1]-1);this.context.get(c.TerrainSystem).tilePosition(r,i,t)},t}(r(4730).Unit);t.AIUnit=f},448:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.AIUnitSkill=void 0;var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.group=1,t.duration=0,t}return a(t,e),t.prototype.validate=function(e,t){var r=Math.abs(e[0]-t[0]),i=Math.abs(e[1]-t[1]);if(this.cardinal)return 0===r&&i<=this.range&&i>=this.minRange||0===i&&r<=this.range&&r>=this.minRange;var a=r*r+i*i;return a<=this.range*this.range&&a>=this.minRange*this.minRange},t.prototype.aim=function(e,t,r){for(var i=t.length-1;i>=0;i--)if(this.validate(e,t[i]))return t[i]},t.prototype.deactivate=function(e){return null},t}(r(9248).UnitSkill);t.AIUnitSkill=n},4730:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Unit=void 0;var i=r(4454),a=function(){function e(e){this.context=e,this.tile=i.vec2(),this.size=i.vec2.ONE}return e.prototype.regenerate=function(){this.health.amount<=0||(this.health.amount=Math.min(this.health.capacity,this.health.amount+this.health.gain),this.action.amount=Math.min(this.action.capacity,this.action.amount+this.action.gain),this.movement.amount=Math.min(this.movement.capacity,this.movement.amount+this.movement.gain))},e}();t.Unit=a},9248:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnitSkill=void 0;var i=r(3605),a=r(9131),n=r(4730),o=function(){function e(e){this.context=e,this.cost=0,this.minRange=1,this.damageType=0,this.damage=0,this.active=!1}return e.damage=function(e,t){var r=e.context.get(i.TerrainSystem).getTile(t[0],t[1]);r&&r instanceof n.Unit&&0!=(r.group&e.group)&&r.damage(e.damage,e.damageType)},e.queryArea=function(e,t,r,a,o){for(var s=Math.ceil(a),c=r*r,l=a*a,u=e.get(i.TerrainSystem),f=[],h=-s;h<=s;h++)for(var m=-s;m<=s;m++){var d=h*h+m*m;if(!(c>d||d>l)){var p=u.getTile(t[0]+h,t[1]+m);p&&p instanceof n.Unit&&0!=(p.group&o)&&-1==f.indexOf(p.tile)&&f.push(p.tile)}}return f},e.queryLine=function(e,t,r,o,s){for(var c=a.DirectionTile[r],l=e.get(i.TerrainSystem),u=[],f=1;f<=o;f++){var h=t[0]+f*c[0],m=t[1]+f*c[1],d=l.getTile(h,m);null!=d&&d instanceof n.Unit&&0!=(d.group&s)&&-1==u.indexOf(d.tile)&&u.push(d.tile)}return u},e}();t.UnitSkill=o},6888:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(4730),t),a(r(9248),t),a(r(1929),t),a(r(448),t),a(r(7923),t),a(r(2969),t)},2949:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Cube=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6725),u=r(2867),f=r(6365),h=r(296),m=r(72),d=r(2107),p=r(6374),v=r(3605),y=r(7822),g=r(4397),x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.weight=0,t.matter={capacity:8,amount:0,gain:0},t.health={capacity:6,amount:0,gain:0},t.action={capacity:1,amount:0,gain:1},t.movement={capacity:1,amount:0,gain:1},t.order=0,t.group=1,t.hash=0,t.transform=t.context.get(c.TransformSystem).create(),t.meshes=[],t.side=0,t.direction=0,t.sides=o.range(6).map((function(e){return{type:0,direction:0,level:0,open:0}})),t.tiles=[t.tile],t}return a(t,e),t.prototype.place=function(e,t){o.vec2.set(e,t,this.tile),this.context.get(v.TerrainSystem).tilePosition(e,t,this.transform.position),this.transform.frame=0;for(var r=0;r<this.sides.length;r++)this.installModule(r,this.sides[r].direction,this.sides[r].type);this.context.get(v.TerrainSystem).setTile(this.tile[0],this.tile[1],this),this.light=this.context.get(h.PointLightPass).create([1,1,.8]),this.light.transform=this.context.get(c.TransformSystem).create(),this.light.transform.parent=this.transform,this.light.transform.position[1]=4,this.light.radius=12,this.light.intensity=1,this.dust=y.SharedSystem.particles.dust.add({uOrigin:o.vec3.ZERO,uTarget:o.vec3.ZERO,uLifespan:[.8,1.2,-.16,0],uSize:[2,4],uRadius:[.2,.4],uOrientation:o.quat.IDENTITY,uForce:[4,8],uGravity:[0,9.8,0],uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]}),this.health.amount=this.health.capacity,this.context.get(m.TurnBasedSystem).signalEnterTile.broadcast(this.tile[0],this.tile[1],this)},t.prototype.installModule=function(e,t,r){this.meshes[e]&&this.context.get(s.MeshSystem).delete(this.meshes[e]);var i=this.meshes[e]=this.context.get(s.MeshSystem).loadModel(y.CubeModuleModel[r]);i.transform=this.transform,i.color[3]=this.side==e?1:0,this.sides[e].direction=t,this.sides[e].type=r;var a=d.DirectionAngle[(this.direction+this.sides[e].direction)%4];o.quat.copy(a,i.armature.nodes[0].rotation),y.ModelAnimation.map[i.armature.key].close(0,i.armature),this.hash=this.sides.reduce((function(e,t){return 4*e*11+11*t.direction+t.type}),0),this.skill.update()},t.prototype.delete=function(){for(var e=0;e<this.meshes.length;e++)this.meshes[e]&&(this.meshes[e]=void this.context.get(s.MeshSystem).delete(this.meshes[e]));this.dust&&(this.dust=void y.SharedSystem.particles.dust.remove(this.dust)),this.light&&(this.light=void this.context.get(h.PointLightPass).delete(this.light))},Object.defineProperty(t.prototype,"skill",{get:function(){return this.context.get(p.PlayerSystem).skills[this.sides[this.side].type]},enumerable:!1,configurable:!0}),t.prototype.death=function(){var e,t,r,i,a,o,s,c,f,h;return n(this,(function(n){switch(n.label){case 0:if(this.context.get(p.PlayerSystem).theme.set(0,!1),1!=this.sides[this.side].open)return[3,5];e=this.skill.close(),n.label=1;case 1:return(t=e.next()).done?[3,5]:[3,2];case 2:return[4,t.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:r=g.DeathEffect.create(this.context,this),i=this.context.get(l.AnimationSystem).await(r.index),a=this.context.get(u.KeyboardSystem),o=this.context.get(p.PlayerSystem).cameraOffset,s=.1,c=4,f=this.context.currentTime,n.label=6;case 6:return h=this.context.currentTime-f,o[0]=c*Math.sin(h*s),o[2]=c*Math.cos(h*s),a.release("Space")&&i.continue?[3,8]:[4,l.ActionSignal.WaitNextFrame];case 7:return n.sent(),[3,9];case 8:return this.context.get(p.PlayerSystem).restart(),[3,10];case 9:return[3,6];case 10:return[2]}}))},t.prototype.execute=function(){var e,t,r,i,a,o,s,c,f,h,m,v;return n(this,(function(n){switch(n.label){case 0:if(e=this.context.get(u.KeyboardSystem),0!==this.health.amount)return[3,5];h=this.death(),n.label=1;case 1:return(v=h.next()).done?[2,v.value]:[3,2];case 2:return[4,v.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:this.regenerate(),this.skill.update(),t=0,n.label=6;case 6:return this.action.amount<=0&&this.movement.amount<=0?[3,30]:t!==this.context.frame?[3,8]:[4,l.ActionSignal.WaitNextFrame];case 7:n.sent(),n.label=8;case 8:for(s in r=this.sides[this.side],d.DirectionAngle[(this.direction+r.direction)%4],i=this.context.get(p.PlayerSystem).skills[r.type],a=-1,o=!1,p.PlayerSystem.input)e.trigger(p.PlayerSystem.input[s])&&(o=!0);if(e.down(p.PlayerSystem.input.left)?a=3:e.down(p.PlayerSystem.input.right)?a=1:e.down(p.PlayerSystem.input.up)?a=2:e.down(p.PlayerSystem.input.down)&&(a=0),c=e.down(p.PlayerSystem.input.action),t=this.context.frame,0!=r.open||!c)return[3,14];h=i.open(),n.label=9;case 9:return(v=h.next()).done?[3,29]:[3,10];case 10:return[4,v.value];case 11:n.sent(),n.label=12;case 12:return[3,9];case 13:return[3,19];case 14:if(1!=r.open||c||-1==a)return[3,19];h=i.close(),n.label=15;case 15:return(v=h.next()).done?[3,29]:[3,16];case 16:return[4,v.value];case 17:n.sent(),n.label=18;case 18:return[3,15];case 19:if(1!=r.open||!c)return[3,24];if(this.action.amount<=0)return o?[2,void(this.movement.amount=0)]:[3,24];if(!(f=i.query(a)))return[3,24];h=i.activate(f,a),n.label=20;case 20:return(v=h.next()).done?[3,29]:[3,21];case 21:return[4,v.value];case 22:n.sent(),n.label=23;case 23:return[3,20];case 24:if(0!=r.open||-1==a||c)return[3,29];if(this.movement.amount<=0)return[2,void(this.action.amount=0)];if(!(m=this.moveTransition(a)))return[3,29];this.movement.amount--,n.label=25;case 25:return(v=m.next()).done?[3,29]:[3,26];case 26:return[4,v.value];case 27:n.sent(),n.label=28;case 28:return[3,25];case 29:return[3,6];case 30:return[2]}}))},t.prototype.damage=function(e,t){9===this.sides[this.side].type&&this.skill.active&&--this.skill.indicator.amount>0||(16&t&&(this.action.amount=-this.action.gain),this.health.amount=Math.max(0,this.health.amount-e),g.DamageEffect.create(this.context,this,t))},t.prototype.moveTransition=function(e){var t=d.CubeOrientation.roll(d.CubeOrientation(this.side,this.direction),e),r=3&t,i=t>>>2,a=o.vec2.copy(this.tile,o.vec2()),s=o.quat(),c=d.DirectionAngle[(r+this.sides[i].direction)%4],u=o.vec3();switch(e){case 3:a[0]--,o.quat.axisAngle(o.vec3.AXIS_Z,-.5*Math.PI,s),u[0]=-.5*v.TerrainChunk.tileSize;break;case 1:a[0]++,o.quat.axisAngle(o.vec3.AXIS_Z,.5*Math.PI,s),u[0]=.5*v.TerrainChunk.tileSize;break;case 0:a[1]++,o.quat.axisAngle(o.vec3.AXIS_X,-.5*Math.PI,s),u[2]=.5*v.TerrainChunk.tileSize;break;case 2:a[1]--,o.quat.axisAngle(o.vec3.AXIS_X,.5*Math.PI,s),u[2]=-.5*v.TerrainChunk.tileSize}if(null==this.context.get(v.TerrainSystem).getTile(a[0],a[1])){console.log("%cF "+this.side+"-"+i+" D "+this.direction+"-"+r+" > "+e,"color:#80dfaf;text-decoration:underline"),this.meshes[this.side].color[3]=0,this.meshes[i].color[3]=1,this.direction=r,this.side=i,this.context.get(v.TerrainSystem).setTile(this.tile[0],this.tile[1],null),this.context.get(v.TerrainSystem).setTile(a[0],a[1],this),o.vec2.copy(a,this.tile),this.context.get(m.TurnBasedSystem).signalEnterTile.broadcast(a[0],a[1],this),this.skill.update();var h=this.meshes[this.side];y.ModelAnimation.map[h.armature.key].close(0,h.armature);var g=h.armature.nodes[0],x=o.vec3.copy(h.transform.position,o.vec3()),b=this.context.get(v.TerrainSystem).tilePosition(this.tile[0],this.tile[1],o.vec3());o.quat.multiply(s,c,s);var S=o.vec3.subtract(b,u,o.vec3());return o.quat.transform(u,o.quat.conjugate(c,o.quat()),u),this.context.get(p.PlayerSystem).tilemap.renderFaceTiles(this),function(){var e,t,r,i,a,m;return n(this,(function(n){switch(n.label){case 0:e=l.EventTrigger([{frame:.36,value:{amount:16,uOrigin:b,uTarget:o.vec3.ZERO}}],l.EventTrigger.emitReset),t=l.ease.bounceIn(.064,.8),this.context.get(f.AudioSystem).create("assets/cube_step.mp3","sfx",this.transform).volume(0,.4).play(.5,o.randomFloat(.84,1.16,y.SharedSystem.random())),r=.64,i=this.context.currentTime,n.label=1;case 1:return a=this.context.currentTime-i,m=Math.min(1,a/r),h.transform.frame=0,h.armature.frame=0,o.vec3.lerp(x,b,m,h.transform.position),o.quat.slerp(s,c,t(m),g.rotation),o.quat.normalize(g.rotation,g.rotation),o.quat.transform(u,g.rotation,g.position),o.vec3.subtract(g.position,h.transform.position,g.position),o.vec3.add(S,g.position,g.position),g.position[1]+=h.transform.position[1]-b[1],e(a,this.context.deltaTime,this.dust),m>=1?[3,4]:[4,l.ActionSignal.WaitNextFrame];case 2:n.sent(),n.label=3;case 3:return[3,1];case 4:return[2]}}))}.call(this)}},t}(r(6888).Unit);t.Cube=x},9055:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2107:(e,t,r)=>{"use strict";var i,a,n,o,s,c,l,u;Object.defineProperty(t,"__esModule",{value:!0}),t.CubeOrientation=t.DirectionTile=t.DirectionAngle=void 0;var f=r(4454);t.DirectionAngle=((i={})[0]=f.quat.axisAngle(f.vec3.AXIS_Y,.5*Math.PI,f.quat()),i[1]=f.quat.axisAngle(f.vec3.AXIS_Y,1*Math.PI,f.quat()),i[2]=f.quat.axisAngle(f.vec3.AXIS_Y,1.5*Math.PI,f.quat()),i[3]=f.quat.axisAngle(f.vec3.AXIS_Y,2*Math.PI,f.quat()),i),t.DirectionTile=[f.vec2(0,1),f.vec2(1,0),f.vec2(0,-1),f.vec2(-1,0)],t.CubeOrientation=function(e,t){return e<<2|t},t.CubeOrientation.rotate=function(e,r){var i=e>>>2,a=3&e;return t.CubeOrientation(i,(4+a+r)%4)},t.CubeOrientation.roll=function(e,r){var i=3&e,a=h[28&e][(4+r-i)%4];return t.CubeOrientation.rotate(a,i)};var h=((a={})[0]=((n={})[0]=4,n[1]=21,n[2]=18,n[3]=11,n),a[4]=((o={})[0]=12,o[1]=20,o[2]=0,o[3]=8,o),a[8]=((s={})[0]=15,s[1]=4,s[2]=1,s[3]=16,s),a[20]=((c={})[0]=13,c[1]=16,c[2]=3,c[3]=4,c),a[12]=((l={})[0]=18,l[1]=23,l[2]=4,l[3]=9,l),a[16]=((u={})[0]=14,u[1]=8,u[2]=2,u[3]=20,u),a)},9561:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.CubeTileMap=void 0;var o=r(4454),s=r(9479),c=r(9940),l=r(7240),u=r(6514),f=r(757),h=n(r(6534)),m=n(r(3153)),d=r(2107),p=function(){function e(e){this.context=e,this.batchRanges=[],this.tiles=[],this.materials=[],this.projectionMatrix=o.mat3(),this.side=-1,this.hash=-1,this.batch=new c.Batch2D(this.context.gl,144,216,c.Batch2D.quadIndices),this.program=s.ShaderProgram(this.context.gl,h.batch2d_vert,m.batch2d_rg_frag)}return e.prototype.renderTexture=function(e,t,r,i){var a=this.context.gl;a.bindFramebuffer(36160,e.fbo),a.viewport(0,0,e.size[0],e.size[1]),a.useProgram(i.target),i.uniforms.uProjectionMatrix=this.projectionMatrix,i.uniforms.uScale=f.MaterialSystem.heightmapScale,i.uniforms.uScreenSize=e.size,this.batch.bind(),a.drawElements(4,t,5123,2*r)},e.prototype.extractTileMap=function(e,t,r){var i=this.context.gl,a=this.context.get(f.MaterialSystem).createRenderTexture(t*e.length,t,1,{filter:9728,wrap:33071}),n=o.vec2(t*r,t*r),s=u.Sprite2D.create();s.transform=u.Transform2D.create(),s.material=new f.SpriteMaterial,o.vec2.set(t,t,s.material.size),f.SpriteMaterial.calculateUVMatrix(o.aabb2(5*t,0,6*t,t),n,s.material.uvMatrix);for(var c=0;c<e.length;c++){var h=e[c],m=i.createFramebuffer();i.bindFramebuffer(36160,m),i.framebufferTexture2D(36160,36064,3553,h.diffuse,0),i.framebufferTexture2D(36160,36065,3553,h.normal,0),i.drawBuffers([36064,36065]),this.materials[h.index]={size:n,fbo:m},s.material.diffuse=h.diffuse,o.vec2.set(c*t,0,s.transform.position),s.transform.recalculate(0),s.frame=0,s.update(this.context.frame),this.batch.render(s);var d=this.tiles[h.index]=new f.SpriteMaterial;d.diffuse=a.target,o.vec2.set(t,t,d.size),f.SpriteMaterial.calculateUVMatrix(o.aabb2(c*t,0,(c+1)*t,t),o.vec2(t*e.length,t),d.uvMatrix)}var p=this.batch.indexOffset,v=o.mat3x2.orthogonal(0,a.width,0,a.height,o.mat3x2());o.mat3.fromMat3x2(v,this.projectionMatrix),this.renderTexture({fbo:a.fbo[0],size:o.vec2(a.width,a.height)},p,0,this.context.get(l.OverlayPass).program),this.batch.bindTextures(Array(e.length).fill(null)),o.mat3x2.orthogonal(0,t*r,0,t*r,v),o.mat3.fromMat3x2(v,this.projectionMatrix)},e.prototype.precomputeTileFaces=function(e){return o.range(6).map((function(t){var r=d.CubeOrientation(t,(4-e.sides[t].direction)%4),i=d.CubeOrientation.roll(r,0),a=d.CubeOrientation.roll(r,2),n=d.CubeOrientation.roll(i,0),o=d.CubeOrientation.roll(r,3),s=d.CubeOrientation.roll(r,1);return[n,i,s=d.CubeOrientation.rotate(s,3),o=d.CubeOrientation.rotate(o,1),a=d.CubeOrientation.rotate(a,2),r]}))},e.prototype.prepareBatch=function(e){this.tileFaces=this.precomputeTileFaces(e);var t=u.Sprite2D.create(0,[.5,.5]);t.transform=u.Transform2D.create();for(var r=0,i=0;i<6;i++){for(var a=this.tileFaces[i],n=0;n<a.length;n++){var s=a[n]>>>2,c=((3&a[n])+e.sides[s].direction)%4,l=e.meshes[s].material.index;t.material=this.tiles[l],t.transform.rotation=.5*-c*Math.PI,o.vec2.set(n*t.material.size[0]+.5*t.material.size[0],.5*t.material.size[0],t.transform.position),t.transform.recalculate(0),t.frame=0,t.update(this.context.frame),this.batch.render(t)}this.batchRanges[i]=[r,this.batch.indexOffset-r],r=this.batch.indexOffset}},e.prototype.renderFaceTiles=function(e){if(this.side!=e.side||this.hash!=e.hash){this.hash!=e.hash&&this.prepareBatch(e),this.hash=e.hash,this.side=e.side;var t=e.meshes[this.side].material.index,r=this.batchRanges[this.side];this.renderTexture(this.materials[t],r[1],r[0],this.program)}},e.prototype.renderSubstitute=function(e){var t=e.index,r=this.batchRanges[this.side];this.renderTexture(this.materials[t],r[1],r[0],this.program)},e}();t.CubeTileMap=p},237:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Indicator=void 0;var s=r(4454),c=r(757),l=r(296),u=r(8581),f=r(6725),h=r(7822),m=function(){function e(e,t){this.context=e,this.throttleDelay=10,this.frame=0,this.prevCapacity=0,this.prevValue=0,this.capacity=0,this.value=0,this.index=t.index,this.rotation=t.rotation,this.colors=t.colors,this.radialMaterial=p.create(t.size,h.SharedSystem.materials.radialProgram),this.effectMaterial=p.create(t.size,h.SharedSystem.materials.radialProgram),this.radial=u.Sprite2D.create(0,[.5,.5]),this.radial.material=this.radialMaterial.material,this.radial.transform=u.Transform2D.create([.5*t.size,.5*t.size]),this.effect=u.Sprite2D.create(1,[.5,.5]),this.effect.material=this.effectMaterial.material,this.effect.transform=u.Transform2D.create([.5*t.size,.5*t.size]),this.context.get(l.OverlayPass).list2d.push(this.radial),this.context.get(l.OverlayPass).list2d.push(this.effect),this.uniforms={uStrokeWidth:.016,uStrokeColor:s.vec4(.75,.87,.87,.8),uAngle:s.vec2(.04,t.angle),uSegments:s.vec2.ZERO,uColor:s.vec4.ZERO,uRadius:t.radius},this.animateUpgrade=f.AnimationTimeline(this,{"effect.color":f.PropertyAnimation([{frame:0,value:[1,1,1,0]},{frame:.4,value:s.vec4.ZERO,ease:f.ease.sineIn}],s.vec4.lerp),"radial.transform.rotation":f.PropertyAnimation([{frame:0,value:this.rotation+4*Math.PI*(1&this.index?1:-1)},{frame:.4,value:this.rotation,ease:f.ease.cubicOut}],s.lerp)}),this.animateIncrease=f.AnimationTimeline(this,{"effect.color":f.PropertyAnimation([{frame:0,value:[1,1,1,0]},{frame:.4,value:s.vec4.ZERO,ease:f.ease.quadIn}],s.vec4.lerp)}),this.animateDecrease=f.AnimationTimeline(this,{"effect.color":f.PropertyAnimation([{frame:0,value:s.vec4.ONE},{frame:.2,value:[1,0,0,1],ease:f.ease.quadOut},{frame:.4,value:s.vec4.ZERO,ease:f.ease.quadIn}],s.vec4.lerp)})}return e.prototype.update=function(e,t){if(e!==this.capacity||t!==this.value){this.context.frame-this.frame>this.throttleDelay&&(this.prevCapacity=this.capacity,this.prevValue=this.value),this.frame=this.context.frame,this.capacity=e,this.value=t;var r=this.updateTexture(this.prevCapacity,this.prevValue);this.context.get(f.AnimationSystem).start(this.animate(r),!0)}},e.prototype.updateTexture=function(e,t){return this.radialMaterial.render(n(n({},this.uniforms),{uColor:this.colors[0],uSegments:[this.capacity,this.capacity]}),s.vec4.ZERO),this.radialMaterial.render(n(n({},this.uniforms),{uColor:this.colors[1],uSegments:[this.value,this.capacity]})),e!=this.capacity?(this.effectMaterial.render(n(n({},this.uniforms),{uColor:this.uniforms.uStrokeColor,uSegments:[1,0],uStrokeWidth:.04}),s.vec4.ZERO),0):t<this.value?(this.effectMaterial.render(n(n({},this.uniforms),{uColor:this.colors[1],uSegments:[this.value-t,this.capacity]}),s.vec4.ZERO),this.effect.transform.rotation=this.rotation+t/this.capacity*Math.PI*2/this.uniforms.uAngle[1],1):(this.effectMaterial.render(n(n({},this.uniforms),{uColor:this.colors[1],uSegments:[t-this.value,this.capacity]}),s.vec4.ZERO),this.effect.transform.rotation=this.rotation+this.value/this.capacity*Math.PI*2/this.uniforms.uAngle[1],-1)},e.prototype.animate=function(e){var t,r,i,a;return o(this,(function(n){switch(n.label){case 0:t=0==e?this.animateUpgrade:e>0?this.animateIncrease:this.animateDecrease,r=.4,i=this.context.currentTime,n.label=1;case 1:return a=this.context.currentTime-i,t(a,this.context.deltaTime),a>r?[3,5]:[3,2];case 2:return[4,f.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return[2]}}))},e}(),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.updateTexture=function(e,t){if(this.radialMaterial.render(n(n({},this.uniforms),{uColor:this.colors[2&this.value],uSegments:[2,2]}),s.vec4.ZERO),this.radialMaterial.render(n(n({},this.uniforms),{uColor:this.colors[1&this.value],uSegments:[1,2]})),e!=this.capacity)return this.effectMaterial.render(n(n({},this.uniforms),{uColor:this.uniforms.uStrokeColor,uSegments:[1,0],uStrokeWidth:.04}),s.vec4.ZERO),0;var r=(1&this.value)-(1&t),i=(2&this.value)-(2&t);return 0!=r&&0!=i?(this.effectMaterial.render(n(n({},this.uniforms),{uColor:this.colors[2],uSegments:[2,2]}),s.vec4.ZERO),this.effectMaterial.render(n(n({},this.uniforms),{uColor:this.colors[1],uSegments:[1,2]})),this.effect.transform.rotation=this.rotation):0!=r?(this.effectMaterial.render(n(n({},this.uniforms),{uColor:this.colors[1],uSegments:[1,2]}),s.vec4.ZERO),this.effect.transform.rotation=this.rotation):0!=i&&(this.effectMaterial.render(n(n({},this.uniforms),{uColor:this.colors[2],uSegments:[1,2]}),s.vec4.ZERO),this.effect.transform.rotation=this.rotation+.5*Math.PI*2/this.uniforms.uAngle[1]),i<0||r<0?-1:1},t}(m),p=function(){function e(t){this.context=t,e.create=function(e){var t=e.get(c.MaterialSystem).createRenderTexture(1024,1024,1,{filter:9729,wrap:33071,mipmaps:0}),r=new c.TextureAtlas(e.gl,t,e.get(u.MeshSystem).plane);return function(t,i){var a=r.insert(t,t),n=c.SpriteMaterial.create(r.texture.target,a,r.size);return n.program=e.get(l.OverlayPass).program,{material:n,bounds:a,atlas:r,program:i,render:r.render.bind(r,a,i)}}}(t),this.turnRadial=new d(this.context,{index:0,radius:s.vec2(.1,.3),rotation:.25*Math.PI,angle:1,size:128*t.resolution,colors:[s.vec4(.08,.08,.08,.4),s.vec4(.06,.43,.36,.6),s.vec4(.53,.06,.29,.6)]}),this.healthRadial=new m(this.context,{index:1,radius:s.vec2(.38,.54),rotation:.25*Math.PI,angle:1,size:128*t.resolution,colors:[s.vec4(.08,.08,.08,.4),s.vec4(.19,.31,.38,.6)]}),this.resourceRadial=new m(this.context,{index:2,radius:s.vec2(.62,.72),rotation:0*Math.PI,angle:4/3,size:128*t.resolution,colors:[s.vec4(.08,.08,.08,.4),s.vec4(.74,.73,.56,.6)]}),this.skillRadial=new m(this.context,{index:3,radius:s.vec2(.8,.92),rotation:-.25*Math.PI,angle:2,size:128*t.resolution,colors:[s.vec4(.08,.08,.08,.4),s.vec4(.81,.48,.11,.6)]})}return e.prototype.update=function(e){this.turnRadial.update(2,Math.max(0,e.movement.amount)+2*Math.max(0,e.action.amount)),this.healthRadial.update(e.health.capacity,e.health.amount),this.resourceRadial.update(e.matter.capacity,e.matter.amount);var t=e.skill;t.indicator?this.skillRadial.update(t.indicator.capacity,t.indicator.amount):this.skillRadial.update(0,0)},e}();t.Indicator=p},6374:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerSystem=void 0;var i=r(4454),a=r(9336),n=r(6365),o=r(8581),s=r(7083),c=r(7822),l=r(3605),u=r(3912),f=r(72),h=r(9561),m=r(237),d=r(2949),p=function(){function e(e,t){this.context=e,this.themes=t,this.index=-1,this.volume=.8,this.switch=Array(this.themes.length).fill(!1)}return e.prototype.set=function(e,t){this.switch[e]=t;for(var r=this.switch.length-1;!this.switch[r];)r--;if(this.index!==r){var i=this.index;this.index=r,-1!=i&&(this.track=void this.track.volume(this.themes[i].out,0).stop(this.themes[i].out)),-1!=r&&(this.context.get(n.AudioSystem).clips[this.themes[r].clip].loop=0,this.track=this.context.get(n.AudioSystem).create(this.themes[r].clip,"music",null),this.themes[r]&&this.track.volume(0,0),this.track.volume(this.themes[r].in,this.volume),this.track.play(0))}},e}(),v=function(){function e(e){this.context=e,this.origin=i.vec2(4,6),this.cameraOffset=i.vec3(0,8,4),this.cube=new d.Cube(this.context),this.tilemap=new h.CubeTileMap(this.context),this.indicator=new m.Indicator(this.context),this.skills=s.CubeSkills(this.context,this.cube),this.theme=new p(this.context,[{clip:"assets/ambient_theme.mp3",in:.5,out:1},{clip:"assets/menu_theme.mp3",in:.5,out:2},{clip:"assets/conflict_theme.mp3",in:0,out:2},{clip:"assets/war_theme.mp3",in:0,out:2}]),this.context.get(f.TurnBasedSystem).add(this.cube)}return e.prototype.update=function(){0!=this.context.frame&&(1==this.context.frame&&this.restart(),this.tilemap.renderFaceTiles(this.cube),this.indicator.update(this.cube),i.vec3.copy(this.cameraOffset,this.context.get(a.CameraSystem).controller.cameraOffset),this.context.get(a.CameraSystem).controller.adjustCamera(this.cube.transform.position,this.context.frame))},e.prototype.restart=function(){u.FadeEffect.create(this.context,1),this.cube.delete(),this.context.get(f.TurnBasedSystem).signalReset.broadcast(),this.context.get(l.TerrainSystem).tilePosition(this.origin[0],this.origin[1],this.cube.transform.position),this.context.get(a.CameraSystem).controller.adjustCamera(this.cube.transform.position,this.context.frame),this.context.get(l.TerrainSystem).clear(),this.context.get(l.TerrainSystem).update(),this.cube.place(this.origin[0],this.origin[1]),i.vec3.set(0,8,4,this.cameraOffset),this.theme.set(0,!0)},e.prototype.load=function(e,t,r){this.context.get(c.SharedSystem).grid.decal.transform.parent=this.cube.transform;var i=this.context.get(o.MeshSystem).models,a=[];for(var n in i)i[n].material&&(i[n].material.array=c.SharedSystem.textures.indexedTexture.array,i[n].material.arrayLayers=c.SharedSystem.textures.indexedTexture.arrayLayers,-1!=n.indexOf("cube")&&(a[i[n].material.index]=i[n].material));this.tilemap.extractTileMap(a.filter(Boolean),64,8),r()},e.input={up:"KeyW",down:"KeyS",left:"KeyA",right:"KeyD",action:"Space"},e}();t.PlayerSystem=v},72:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TurnBasedSystem=void 0;var i=r(4967),a=r(6725),n=function(){function e(e){this.context=e,this.signalEnterTile=new i.Signal,this.signalReset=new i.Signal,this.agents=[],this.queue=[],this.index=0}return e.prototype.add=function(e){for(var t=this.agents.length-1;t>=0&&this.agents[t].order-e.order>0;)t--;this.agents.splice(t+1,0,e),t+1<=this.index&&this.index++},e.prototype.remove=function(e){var t=this.agents.indexOf(e);this.agents.splice(t,1),t<=this.index&&this.index--},e.prototype.update=function(){for(;this.index<this.agents.length;){for(;this.queue.length;){if(!this.queue[0].continue)return;this.queue.shift()}var e=this.agents[this.index++].execute();e&&this.enqueue(e,!0)}this.index=0},e.prototype.enqueue=function(e,t){var r=this.context.get(a.AnimationSystem);this.queue.push(r.await(r.start(e,!0)))},e}();t.TurnBasedSystem=n},9131:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(72),t),a(r(2107),t),a(r(9055),t),a(r(2949),t),a(r(6374),t)},3153:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.foliage_frag=t.fire_frag=t.smoke_frag=t.grass_vert=t.mist_vert=t.sky_frag=t.debris_vert=t.batch2d_rg_frag=t.battery=t.grid=t.shield=t.spot=t.pulse=t.mark=t.acid=t.beam=t.orb=t.reticle=t.streak=t.swirl=t.rays=t.radial=t.rectangle=t.blink=t.sparkle=t.wave=t.ring=t.bulge=t.glow=t.circle=t.noise_directional=t.wires=t.hatch=t.circuit=t.rust=t.dunes=t.stripes=t.blocklines=t.spiral=t.sandstone=t.wreck=t.solid=t.cracks=t.shatter=t.stamp=t.lightning=t.spike=t.moss=t.plant=void 0,t.plant=r(7143),t.moss=r(2676),t.spike=r(825),t.lightning=r(9917),t.stamp=r(5695),t.shatter=r(3421),t.cracks=r(6282),t.solid=r(404),t.wreck=r(8371),t.sandstone=r(9223),t.spiral=r(1728),t.blocklines=r(6795),t.stripes=r(2619),t.dunes=r(7188),t.rust=r(3475),t.circuit=r(6047),t.hatch=r(9467),t.wires=r(229),t.noise_directional=r(10),t.circle=r(6487),t.glow=r(590),t.bulge=r(2654),t.ring=r(2646),t.wave=r(1934),t.sparkle=r(6540),t.blink=r(6866),t.rectangle=r(2863),t.radial=r(8640),t.rays=r(4241),t.swirl=r(655),t.streak=r(541),t.reticle=r(1223),t.orb=r(1671),t.beam=r(5865),t.acid=r(308),t.mark=r(4063),t.pulse=r(5311),t.spot=r(7718),t.shield=r(1470),t.grid=r(2784),t.battery=r(1795),t.batch2d_rg_frag=r(2422),t.debris_vert=r(3002),t.sky_frag=r(7349),t.mist_vert=r(5743),t.grass_vert=r(5407),t.smoke_frag=r(7685),t.fire_frag=r(6071),t.foliage_frag=r(4102)},4618:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryLibrary=void 0;var i=r(4454),a=r(6725),n=r(9463),o=r(8581);t.GeometryLibrary=function(e){var t=i.mat4(),r=i.quat(),s=n.createSphere({longitude:32,latitude:32,radius:1}),c=n.doubleSided(n.createSphere({longitude:16,latitude:16,radius:1})),l=n.doubleSided(n.applyTransform(n.createSphere({longitude:8,latitude:4,radius:1,thetaStart:0,thetaLength:.5*Math.PI,phiStart:0,phiLength:2*Math.PI}),i.mat4.fromRotationTranslationScale(i.quat.HALF_X,i.vec3(0,0,-1),i.vec3.ONE,t))),u=n.doubleSided(n.createCylinder({radiusTop:.5,radiusBottom:.5,height:1,radial:32,horizontal:1,cap:!1,angleStart:0,angleLength:2*Math.PI})),f=n.doubleSided(n.applyTransform(n.createCylinder({radiusTop:0,radiusBottom:2,height:1,horizontal:4,radial:16,cap:!1,angleStart:0,angleLength:2*Math.PI}),i.mat4.translate(i.mat4.IDENTITY,i.vec3(0,-.5,0),t))),h=n.doubleSided(n.applyTransform(n.createCylinder({radiusTop:.5,radiusBottom:.5,height:1,radial:16,horizontal:1,cap:!1,angleStart:0,angleLength:2*Math.PI}),i.mat4.translate(i.mat4.IDENTITY,i.vec3(0,.5,0),t))),m=n.doubleSided(n.applyTransform(n.createCylinder({radiusTop:.5,radiusBottom:.5,height:1,radial:16,horizontal:1,cap:!1,angleStart:0,angleLength:2*Math.PI}),i.mat4.translate(i.mat4.IDENTITY,i.vec3(0,-.5,0),t))),d=n.doubleSided(n.extrudePolygon([[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,1],[3,1],[3,-1],[1,-1],[1,-3]],1)),p=n.doubleSided(n.createBox({width:1,height:1,depth:1,open:!1})),v=n.doubleSided(n.applyTransform(n.createBox({width:1,height:1,depth:1,open:!0}),i.mat4.fromRotationTranslationScale(i.quat.IDENTITY,i.vec3(0,.5,0),i.vec3.ONE,t))),y=n.doubleSided(n.applyTransform(n.modifyGeometry(n.createCylinder({radiusTop:.5,radiusBottom:4,height:4,horizontal:8,radial:8,cap:!1,angleStart:0,angleLength:2*Math.PI}),(function(e,t){var n=1.6*Math.PI*a.ease.circIn(.5+e[1]/4);i.quat.axisAngle(i.vec3.AXIS_Y,n,r),i.quat.transform(e,r,e),i.quat.transform(t,r,t)})),i.mat4.fromRotationTranslationScale(i.quat.HALF_X,i.vec3(0,0,-2),i.vec3.ONE,t)));return{lowpoly:{sphere:n.createSphere({longitude:16,latitude:16,radius:1}),hemisphere:n.applyTransform(n.createSphere({longitude:8,latitude:4,radius:1,thetaStart:0,thetaLength:.5*Math.PI,phiStart:0,phiLength:2*Math.PI}),i.mat4.fromRotationTranslationScale(i.quat.HALF_X,i.vec3(0,0,-1),i.vec3.ONE,t))},box:p,openBox:v,cross:d,sphere:s,hemisphere:l,lowpolySphere:c,cylinder:u,lowpolyCylinder:h,cone:f,funnel:y,lowpolyCylinderFlip:m,sphereMesh:e.get(o.MeshSystem).uploadVertexData(s.vertexArray,s.indexArray,s.format,!1)}}},9577:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GradientLibrary=void 0;var i=r(3248);t.GradientLibrary=function(e){return{yellowViolet:i.GradientRamp(e.gl,[4294967040,4294759936,4041975808,3267195952,2786021456,0],1),purple:i.GradientRamp(e.gl,[3756847344,2360597376,1582744672,1663673920,1326208032,0],1),teal:i.GradientRamp(e.gl,[4294967040,3741314560,2329193744,1758767136,446787888,123490080,53491744,0],1),darkTeal:i.GradientRamp(e.gl,[4294967040,4294967040,4025808645,3386631186,2580010060,1520741789,508646011,0],1),tealLine:i.GradientRamp(e.gl,[0,71727168,567061024,3388139008,567061024,71727168,0],1),yellowLine:i.GradientRamp(e.gl,[0,1460667168,4159945216,1460667168,0],1),redPurple:i.GradientRamp(e.gl,[4294967040,3951794496,3156629632,3156629664,3106302704,2084077664,706167840,0],1),tealBlue:i.GradientRamp(e.gl,[4042979845,2816072202,2025373465,1822338595,1501337128,1096120094,724850708,455098378,252782853,0],1),yellowRed2D:i.GradientRamp(e.gl,[4294967040,4294946560,4289699584,4286513152,4294967295,4160211887,4293549695,3427338255,3183065519,2104520831,1110388543,0,255,175,127,0],4),purpleGrey2D:i.GradientRamp(e.gl,[3589666048,2620944160,1108813072,0,1347444735,538980351,168431615,0,808468479,269492223,168431615,0,255,175,127,0],4),brightRed:i.GradientRamp(e.gl,[4294967295,4294967295,4294946799,4294946735,4289699711,3766517856,2686459968,0],1),orange2D:i.GradientRamp(e.gl,[4126201600,3179117824,1380403199,0,2139062271,538976511,255,0],2),simple:i.GradientRamp(e.gl,[0,4294967295],2),white:i.GradientRamp(e.gl,[4294967295,0],1),darkRed:i.GradientRamp(e.gl,[4294967295,3956988624,3515520912,2483436704,1361984624,689972016,0,0],1),brightPurple:i.GradientRamp(e.gl,[4294967040,3319849728,2292759808,1854194720,1312530736,2181843232,939726096,0],1)}}},6251:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialLibrary=void 0;var o=r(4454),s=r(9479),c=n(r(6534)),l=n(r(3153)),u=r(757),f=r(296),h=r(7822);function m(e){var t=new u.EffectMaterial(e,{VERTICAL_MASK:!0,PANNING:!0,GREYSCALE:!0,GRADIENT:!0},{uUVTransform:o.vec4(0,0,2,.2),uVerticalMask:o.vec4(0,.5,0,0),uUVPanning:o.vec2(-.2,-.4),uUV2Transform:o.vec4(0,0,1,.5),uUV2Panning:o.vec2(.3,-.7),uColorAdjustment:o.vec3(1,.8,0)});t.diffuse=h.SharedSystem.textures.cellularNoise,t.gradient=h.SharedSystem.gradients.teal;var r=new u.EffectMaterial(e,{PANNING:!0,VERTICAL_MASK:!0,GREYSCALE:!0,GRADIENT:!0},{uVerticalMask:o.vec4(0,.9,.9,1),uUVTransform:o.vec4(0,0,1,1),uUVPanning:o.vec2(0,-.32),uUV2Transform:o.vec4(0,0,1,1),uUV2Panning:o.vec2(0,-.64),uColorAdjustment:o.vec3(1.4,.9,0)});r.diffuse=h.SharedSystem.textures.noiseDirectional,r.gradient=h.SharedSystem.gradients.darkTeal;var i=new u.EffectMaterial(e,{FRESNEL:!0,PANNING:!0,VERTICAL_MASK:!0},{uUVTransform:o.vec4(0,0,1,1),uUVPanning:o.vec2(0,-.6),uVerticalMask:o.vec4(0,0,.8,1),uFresnelMask:o.vec2(.1,.5)});i.diffuse=h.SharedSystem.textures.stripes;var a=new u.EffectMaterial(e,{VERTICAL_MASK:!0,PANNING:!0,GREYSCALE:!0,GRADIENT:!0,POLAR:!0,DEPTH_OFFSET:5.2},{uUVTransform:o.vec4(0,0,1,.8),uVerticalMask:o.vec4(.2,.4,.6,1),uUVPanning:o.vec2(.2,-.1),uUV2Transform:o.vec4(0,0,1,1.6),uUV2Panning:o.vec2(-.2,-.3),uColorAdjustment:o.vec3(1,.9,0)});a.diffuse=h.SharedSystem.textures.cellularNoise,a.gradient=h.SharedSystem.gradients.teal;var n=new u.EffectMaterial(e,{VERTICAL_MASK:!0,PANNING:!0,HALF:!0,GREYSCALE:!0,GRADIENT:!0},{uUVTransform:o.vec4(0,0,1,.3),uUVPanning:o.vec2(.2,-.2),uVerticalMask:o.vec4(0,.4,.6,1),uColorAdjustment:o.vec3(3,1,0),uUV2Transform:o.vec4(0,0,1,.6),uUV2Panning:o.vec2(-.2,-.3)});n.diffuse=h.SharedSystem.textures.voronoiNoise,n.gradient=h.SharedSystem.gradients.purple;var s=new u.EffectMaterial(e,{POLAR:!0,VERTICAL_MASK:!0,PANNING:!0,GRADIENT:!0,DISSOLVE:!0,GREYSCALE:!0},{uUVTransform:o.vec4(.1,0,2,2.4),uUV2Transform:o.vec4(.3,0,1,.6),uColorAdjustment:o.vec3(1,.8,0),uUVPanning:o.vec2(0,-.8),uUV2Panning:o.vec2(.1,-.2),uVerticalMask:o.vec4(.2,.5,.8,1),uDissolveColor:o.vec4(1,0,0,1),uDissolveThreshold:o.vec3(.2,0,0)});s.diffuse=h.SharedSystem.textures.cellularNoise,s.gradient=h.SharedSystem.gradients.yellowViolet;var c=new u.EffectMaterial(e,{PANNING:!0,GRADIENT:!0,DISSOLVE:!0,GREYSCALE:!0,VERTICAL_MASK:!0,FRESNEL:!0},{uUVTransform:o.vec4(0,0,1,1.8),uUVPanning:o.vec2(-.3,0),uDissolveColor:o.vec4.ZERO,uDissolveThreshold:o.vec3(0,.04,0),uColorAdjustment:o.vec3(1,.8,0),uUV2Transform:o.vec4(.71,.29,1,3.8),uUV2Panning:o.vec2(-.5,.2),uVerticalMask:o.vec4(.2,.5,.8,1),uFresnelMask:o.vec2(.1,.5)});c.diffuse=h.SharedSystem.textures.cellularNoise,c.gradient=h.SharedSystem.gradients.yellowRed2D;var l=new u.EffectMaterial(e,{FRESNEL:!0,PANNING:!0,GRADIENT:!0,GREYSCALE:!0},{uUVTransform:o.vec4(0,0,2,1.7),uUVPanning:o.vec2(-.1,.9),uFresnelMask:o.vec2(.2,.6),uColorAdjustment:o.vec3(1,.9,0),uUV2Transform:o.vec4(0,.7,3,2.9),uUV2Panning:o.vec2(.1,.7)});l.diffuse=h.SharedSystem.textures.sineNoise,l.gradient=h.SharedSystem.gradients.brightRed;var f=new u.EffectMaterial(e,{PANNING:!0,GRADIENT:!0,DISSOLVE:!0,GREYSCALE:!0,VERTICAL_MASK:!0},{uUVTransform:o.vec4(0,0,1,.6),uUVPanning:o.vec2(-.3,-.04),uDissolveColor:o.vec4.ZERO,uDissolveThreshold:o.vec3(0,.04,0),uColorAdjustment:o.vec3(1,.64,.1),uUV2Transform:o.vec4(0,0,1,1.7),uUV2Panning:o.vec2(-.5,.1),uVerticalMask:o.vec4(0,.1,.9,1)});f.diffuse=h.SharedSystem.textures.cellularNoise,f.gradient=h.SharedSystem.gradients.orange2D;var m=new u.EffectMaterial(e,{PANNING:!0,GREYSCALE:!0,GRADIENT:!0,VERTICAL_MASK:!0},{uUVTransform:o.vec4(0,0,3,2),uUVPanning:o.vec2(-.4,-.8),uColorAdjustment:o.vec3(1,1,0),uUV2Transform:o.vec4(0,.04,2,2),uUV2Panning:o.vec2(.4,-.8),uVerticalMask:o.vec4(0,.5,.8,1)});m.diffuse=h.SharedSystem.textures.blocklines,m.gradient=h.SharedSystem.gradients.darkRed;var d=new u.EffectMaterial(e,{VERTICAL_MASK:!0,PANNING:!0,HALF:!0,DISSOLVE:!0,GRADIENT:!0,DISPLACEMENT:!0},{uUVTransform:o.vec4(0,0,1,1.4),uUVPanning:o.vec2(-.2,-.4),uVerticalMask:o.vec4(.2,.4,.4,1),uDissolveColor:o.vec4(1,.2,.4,.8),uDissolveThreshold:o.vec3(.1,.02,.1),uDisplacementAmount:[.08],uUV3Transform:o.vec4(0,0,1,3),uUV3Panning:o.vec2(0,.1)});d.diffuse=h.SharedSystem.textures.blocklines,d.gradient=h.SharedSystem.gradients.white,d.displacement=h.SharedSystem.textures.blocklines;var p=new u.EffectMaterial(e,{PANNING:!0,HORIZONTAL_MASK:!0,GREYSCALE:!0,GRADIENT:!0},{uHorizontalMask:o.vec4(0,.4,.6,1),uUVTransform:o.vec4(0,0,.4,1.7),uUVPanning:o.vec2(-.1,1.1),uUV2Transform:o.vec4(0,0,.7,1.5),uUV2Panning:o.vec2(.1,.9),uColorAdjustment:o.vec3(1,.8,.2)});p.gradient=h.SharedSystem.gradients.purpleGrey2D,p.diffuse=h.SharedSystem.textures.cloudNoise;var v=new u.EffectMaterial(e,{PANNING:!0,HORIZONTAL_MASK:!0,GREYSCALE:!0,GRADIENT:!0},{uHorizontalMask:o.vec4(0,.5,.5,1),uUVTransform:o.vec4(0,0,.4,1),uUVPanning:o.vec2(.04,-.6),uUV2Transform:o.vec4(0,0,.25,.8),uUV2Panning:o.vec2(-.08,-.4),uColorAdjustment:o.vec3(1,1.2,.1)});v.diffuse=h.SharedSystem.textures.sineNoise,v.gradient=h.SharedSystem.gradients.purple;var y=new u.EffectMaterial(e,{PANNING:!0,VERTICAL_MASK:!0,FRESNEL:!0,GRADIENT:!0,DISPLACEMENT:!0},{uUVTransform:o.vec4(0,0,1,.6),uUVPanning:o.vec2(0,.16),uVerticalMask:o.vec4(0,.2,.8,1),uFresnelMask:o.vec2(1.2,.5),uDisplacementAmount:[.1],uUV3Transform:o.vec4(0,0,1,1),uUV3Panning:o.vec2(0,-.2)});y.diffuse=h.SharedSystem.textures.sineNoise,y.gradient=h.SharedSystem.gradients.purple,y.displacement=h.SharedSystem.textures.perlinNoise;var g=new u.EffectMaterial(e,{GRADIENT:!0,DISSOLVE:!0,DISPLACEMENT:!0,PANNING:!0},{uUVTransform:o.vec4(0,0,1,1),uUVPanning:o.vec2(0,.1),uDissolveColor:o.vec4(1,.8,.6,1),uDissolveThreshold:o.vec3(0,.01,.2),uDisplacementAmount:[.05],uUV3Transform:o.vec4(0,0,1,1),uUV3Panning:o.vec2(0,.2)});g.diffuse=h.SharedSystem.textures.sineNoise,g.gradient=h.SharedSystem.gradients.white,g.displacement=h.SharedSystem.textures.perlinNoise;var x=new u.EffectMaterial(e,{PANNING:!0,VERTICAL_MASK:!0,GREYSCALE:!0,GRADIENT:!0},{uVerticalMask:o.vec4(0,.4,.6,.8),uUVTransform:o.vec4(-.1,0,1,.5),uUVPanning:o.vec2(-.1,1.4),uUV2Transform:o.vec4(0,0,1,.7),uUV2Panning:o.vec2(.2,1.8),uColorAdjustment:o.vec3(2,2,.2)});return x.diffuse=h.SharedSystem.textures.cellularNoise,x.gradient=h.SharedSystem.gradients.brightPurple,x.cullFace=0,{coneTeal:t,absorbTeal:r,auraTeal:a,energyPurple:y,energyHalfPurple:n,flashYellow:s,coreYellow:c,coreWhite:l,ringDust:f,planeDissolve:g,exhaust:x,stripes:i,stripesRed:m,stripesBlocky:d,trailSmoke:p,trailEnergy:v}}var d=function(e,t,r,i){var a=new u.SpriteMaterial;return a.program=e,a.diffuse=t,r&&(a.cullFace=0),i&&(a.blendMode=null),a};t.MaterialLibrary=function(e){var t=new u.DecalMaterial;t.program=s.ShaderProgram(e.gl,c.decal_vert,l.spot,{INSTANCED:!0,ALPHA_CUTOFF:.01}),t.program.uniforms.uLayer=1;var r=s.ShaderProgram(e.gl,c.batch_vert,c.distortion_frag,{PANNING:!0,VERTICAL_MASK:!0});r.uniforms.uDistortionStrength=.01,r.uniforms.uUVTransform=o.vec4(0,0,4,2),r.uniforms.uUVPanning=o.vec2(0,-.8),r.uniforms.uVerticalMask=o.vec4(0,.2,.8,1);var i=s.ShaderProgram(e.gl,c.batch_vert,c.distortion_frag,{});i.uniforms.uDistortionStrength=.01;var a=s.ShaderProgram(e.gl,c.batch_vert,c.distortion_frag,{CHROMATIC_ABERRATION:!0});a.uniforms.uDistortionStrength=.01;var n=new u.MeshMaterial;n.program=e.get(f.DeferredGeometryPass).programs[0],n.diffuse=h.SharedSystem.textures.sandstone,n.normal=h.SharedSystem.textures.dunesNormal;var p=new u.MeshMaterial;p.program=e.get(f.DeferredGeometryPass).programs[0],p.diffuse=h.SharedSystem.textures.wreck,p.normal=h.SharedSystem.textures.flatNormal;var v=new u.MeshMaterial;v.program=s.ShaderProgram(e.gl,c.geometry_vert,l.orb,{});var y=new u.DecalMaterial;y.program=s.ShaderProgram(e.gl,c.decal_vert,l.acid,{INSTANCED:!0,ALPHA_CUTOFF:.01}),y.program.uniforms.uLayer=4;var g=new u.ShaderMaterial;g.program=s.ShaderProgram(e.gl,c.geometry_vert,l.shield,{}),g.cullFace=0,g.blendMode=u.ShaderMaterial.Add;var x=new u.ShaderMaterial;x.program=s.ShaderProgram(e.gl,c.geometry_vert,l.shield,{DISPLACEMENT:!0});var b=new u.ShaderMaterial;b.cullFace=0,b.depthTest=0,b.depthWrite=!1,b.blendMode=u.ShaderMaterial.Premultiply,b.program=s.ShaderProgram(e.gl,c.geometry_vert,l.pulse,{});var S=new u.SpriteMaterial;S.program=e.get(f.ParticleEffectPass).program,S.diffuse=h.SharedSystem.gradients.simple;var P=s.ShaderProgram(e.gl,c.geometry_vert,c.geometry_frag,{SKINNING:!0,NORMAL_MAPPING:!0,COLOR_INDEX:!0,DISSOLVE:!0});P.uniforms.uDissolveDirection=o.vec3(0,-1,0),P.uniforms.uDissolveThreshold=.36,P.uniforms.uDissolveColor=o.vec4(1,.2,.4,.8),P.uniforms.uDissolveUVScale=o.vec3(16,16,.8);var O=s.ShaderProgram(e.gl,c.batch_vert,l.beam),T=s.ShaderProgram(e.gl,c.batch_vert,l.beam,{RADIAL:!0}),w=new u.DecalMaterial;w.program=s.ShaderProgram(e.gl,c.decal_vert,l.battery,{INSTANCED:!0}),w.program.uniforms.uLayer=w.layer,w.program.uniforms.uDissolveEdge=1;var _=new u.DecalMaterial;_.program=s.ShaderProgram(e.gl,c.decal_vert,l.battery,{INSTANCED:!0,POLAR:!0}),_.program.uniforms.uLayer=_.layer,_.program.uniforms.uDissolveEdge=1;var A=new u.DecalMaterial;A.program=s.ShaderProgram(e.gl,c.decal_vert,l.mark,{INSTANCED:!0}),A.program.uniforms.uLayer=A.layer;var E=new u.DecalMaterial;E.blendMode=null,E.program=s.ShaderProgram(e.gl,c.decal_vert,c.decal_frag,{INSTANCED:!0,ALPHA_CUTOFF:.01,NORMAL_MAPPING:!0,MASK:!0}),E.program.uniforms.uLayer=1,E.program.uniforms.uDissolveEdge=.1,E.diffuse=h.SharedSystem.textures.stamp,E.normal=h.SharedSystem.textures.stampNormal;var M=new u.DecalMaterial;M.program=e.get(f.DecalPass).program,M.diffuse=h.SharedSystem.textures.shatter,M.normal=h.SharedSystem.textures.shatterNormal;var I=new u.DecalMaterial;I.program=e.get(f.DecalPass).program,I.diffuse=h.SharedSystem.textures.cracks,I.normal=h.SharedSystem.textures.cracksNormal;var k=new u.SpriteMaterial(o.vec4(8,10,1,1));k.program=T,k.diffuse=h.SharedSystem.gradients.yellowViolet;var q=new u.SpriteMaterial(o.vec4(4,8,1,1));q.program=O,q.diffuse=h.SharedSystem.gradients.redPurple;var R=new u.SpriteMaterial(o.vec4(8,-16,1,1));return R.program=T,R.diffuse=h.SharedSystem.gradients.redPurple,{effect:m(e.gl),radialProgram:s.ShaderProgram(e.gl,c.fullscreen_vert,l.radial),decal:{glow:u.DecalMaterial.create(e.get(f.DecalPass).program,h.SharedSystem.textures.glow),halo:u.DecalMaterial.create(e.get(f.DecalPass).program,h.SharedSystem.textures.halo),ring:u.DecalMaterial.create(e.get(f.DecalPass).program,h.SharedSystem.textures.ring),rays:u.DecalMaterial.create(e.get(f.DecalPass).program,h.SharedSystem.textures.rays),particle:u.DecalMaterial.create(e.get(f.DecalPass).program,h.SharedSystem.textures.particle),dust:u.DecalMaterial.create(e.get(f.DecalPass).program,h.SharedSystem.textures.dust),reticle:u.DecalMaterial.create(e.get(f.DecalPass).program,h.SharedSystem.textures.reticle),moss:u.DecalMaterial.create(e.get(f.DecalPass).program,h.SharedSystem.textures.moss)},sprite:{glow:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.glow),rays:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.rays),halo:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.halo),burst:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.burst),ring:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.ring),wave:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.wave),beam:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.beam),sparkle:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.sparkle),spiral:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.spiral),dust:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.dust),swirl:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.swirl),streak:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.streak),particle:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.particle),bar:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.textures.bar),lineYellow:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.gradients.yellowLine),lineTeal:d(e.get(f.ParticleEffectPass).program,h.SharedSystem.gradients.tealLine),fade:d(e.get(f.OverlayPass).program,h.SharedSystem.textures.white,!0)},displacement:{ring:d(i,h.SharedSystem.textures.ring,!0,!0),wave:d(i,h.SharedSystem.textures.wave,!0,!0),bulge:d(i,h.SharedSystem.textures.bulge,!0,!0)},distortion:{ring:d(a,h.SharedSystem.textures.ring,!0,!0),wave:d(a,h.SharedSystem.textures.wave,!0,!0),bulge:d(a,h.SharedSystem.textures.bulge,!0,!0),particle:d(a,h.SharedSystem.textures.particle,!0,!0)},heat:d(r,h.SharedSystem.textures.perlinNoise,!0,!0),mesh:{orb:v,dunes:n,metal:p},program:{dissolve:P,beamLinear:O,beamRadial:T},beamRadialYellowMaterial:k,beamLinearRedMaterial:q,beamRadialRedMaterial:R,pulseMaterial:b,stampMaterial:E,shatterMaterial:M,cracksMaterial:I,gradientMaterial:S,glowSquaresLinearMaterial:w,glowSquaresRadialMaterial:_,reticleMaterial:A,shieldDisplacementMaterial:x,shieldMaterial:g,resourceSpotMaterial:t,corrosionMaterial:y}}},8271:function(e,t,r){"use strict";var i,a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelAnimation=t.ArmatureAnimation=t.CubeModuleModel=void 0;var n=r(4454),o=r(6725),s=a(r(8571));t.CubeModuleModel=((i={})[0]="cube_open",i[1]="death",i[2]="cube_0",i[3]="cube_1",i[4]="cube_2",i[5]="cube_3",i[6]="cube_4",i[7]="cube_5",i[8]="cube_6",i[9]="cube_7",i[10]="cube_8",i),t.ArmatureAnimation=function(e){return function(t,r){for(var i,a,n,o=e.length-1;o>=0;o--){var s=e[o],c=r.nodes[s.index];null===(i=s.position)||void 0===i||i.call(s,t,c.position),null===(a=s.rotation)||void 0===a||a.call(s,t,c.rotation),null===(n=s.scale)||void 0===n||n.call(s,t,c.scale)}return r.frame=0,r}};var c=Object.create(null);for(var l in s.default)for(var u in s.default[l]){for(var f=s.default[l][u],h=[],m=0;m<f.length;m++){var d=f[m],p=d.frame,v=d.index,y=d.position,g=d.rotation,x=d.scale,b=o.parseEase(f[m].ease);h[v]||(h[v]={index:v,position:[],rotation:[],scale:[]}),y&&h[v].position.push({frame:p,value:y,ease:b}),x&&h[v].scale.push({frame:p,value:x,ease:b}),g&&h[v].rotation.push({frame:p,value:g,ease:b})}var S=t.ArmatureAnimation(h.map((function(e){var t=e.index,r=e.position,i=e.scale,a=e.rotation;return{index:t,position:r.length?o.PropertyAnimation(r,n.vec3.lerp,1):void 0,scale:i.length?o.PropertyAnimation(i,n.vec3.lerp,1):void 0,rotation:a.length?o.PropertyAnimation(a,n.quat.slerp,1):void 0}})).filter(Boolean));c[l]=c[l]||Object.create(null),c[l][u]=S}t.ModelAnimation=function(e){return function(t,r){return c[r.key][e].apply(this,arguments)}},t.ModelAnimation.map=c},3315:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleLibrary=void 0;var o=r(4967),s=r(4454),c=r(6725),l=r(9479),u=r(296),f=n(r(6534)),h=r(757),m=r(84),d=n(r(3153)),p=r(7822);t.ParticleLibrary=function(e){var t=s.mulberry32(),r=m.ParticleGeometry.quad(e.gl),i=new m.ParticleSystem(e,{limit:512,format:l.VertexDataFormat.Particle},r,l.ShaderProgram(e.gl,f.billboard_vert,f.billboard_frag,{ALIGNED:!0,SOFT:!1,MASK:!1,GRADIENT:!0,STRETCH:.04}),l.ShaderProgram(e.gl,f.particle_vert,null,{SPHERE:!0,TARGETED:!0,LUT:!0,RADIAL:!0}));i.material=new h.EmitterMaterial,i.material.diffuse=p.SharedSystem.textures.blink,i.material.gradientRamp=h.GradientRamp(e.gl,[0,842543487,642596415,2377692672,0,287052623,491404095,1067030016,0,135399983,220602159,962353951,0,0,0,0],4),i.material.curveSampler=m.AttributeCurveSampler(e.gl,32,Object.values({size0:function(e){return 1-c.ease.quadIn(e)},size1:function(e){return 1-c.ease.quartIn(e)},linear0:function(e){return 1-.5*c.ease.cubicIn(e)},linear1:function(e){return 1-.5*c.ease.cubicIn(e)},rotational0:o.Zero,rotational1:o.Zero,radial0:function(e){return 4*c.ease.sineIn(e)},radial1:function(e){return 4*c.ease.sineIn(e)}}));var a=new m.ParticleSystem(e,{limit:1024,format:l.VertexDataFormat.Particle},m.ParticleGeometry.stripe(e.gl,8,(function(e){return 2*e})),l.ShaderProgram(e.gl,f.stripe_vert,f.billboard_frag,{STRIP:!0,SOFT:!1,MASK:!0,GRADIENT:!0}),l.ShaderProgram(e.gl,f.particle_vert,null,{SPHERE:!0,TARGETED:!0,STATIC:!0,TRAIL:!0}));a.material=new h.EmitterMaterial,a.material.diffuse=p.SharedSystem.textures.rectangle,a.material.gradientRamp=h.GradientRamp(e.gl,[0,3355242671,2397300351,1132706367,557224960,152130560,0,2178207103,1335140671,660113920,321086208,101462784,0,713197312,541882368,270292736,101264128,0,0,0,0,0,0,0],4);var n=new m.ParticleSystem(e,{limit:1024,format:l.VertexDataFormat.Particle},r,l.ShaderProgram(e.gl,f.billboard_vert,f.billboard_frag,{SPHERICAL:!0,SOFT:!1,MASK:!0,GRADIENT:!0,UV_OFFSET:.2}),l.ShaderProgram(e.gl,f.particle_vert,null,{CIRCLE:!0,TARGETED:!0,LUT:!0,ANGULAR:!0}));n.material=new h.EmitterMaterial,n.material.diffuse=p.SharedSystem.textures.cloudNoise,n.material.gradientRamp=h.GradientRamp(e.gl,[3216617215,1886019583,420942431,0,420942463,0,0,0],2),n.material.curveSampler=m.AttributeCurveSampler(e.gl,32,Object.values({size0:c.ease.cubicOut,size1:c.ease.cubicOut,linear0:function(e){return 1-.2*c.ease.linear(e)},linear1:function(e){return 1-.2*c.ease.linear(e)},rotational0:function(e){return 1-.2*c.ease.linear(e)},rotational1:function(e){return 1-.2*c.ease.linear(e)},radial0:o.Zero,radial1:o.Zero}));var v=new m.ParticleSystem(e,{limit:1024,format:l.VertexDataFormat.Particle},r,l.ShaderProgram(e.gl,f.billboard_vert,d.smoke_frag,{SPHERICAL:!0,MASK:!0,GRADIENT:!0}),l.ShaderProgram(e.gl,f.particle_vert,null,{LUT:!0,VECTOR_FIELD:!0}));v.material=new h.EmitterMaterial,v.material.diffuse=p.SharedSystem.textures.sineNoise,v.material.gradientRamp=h.GradientRamp(e.gl,[168434351,235802751,437919551,0,0,0,0,0],2),v.material.curveSampler=m.AttributeCurveSampler(e.gl,32,Object.values({size0:c.ease.linear,size1:c.ease.quadOut,linear0:function(e){return.98},linear1:function(e){return.98},rotational0:o.Zero,rotational1:o.Zero,radial0:o.Zero,radial1:o.Zero}));var y=new m.ParticleSystem(e,{limit:1024,format:l.VertexDataFormat.Particle},r,l.ShaderProgram(e.gl,f.billboard_vert,f.billboard_frag,{FRAMES:!0,SWIPE:.1}),l.ShaderProgram(e.gl,f.particle_vert,null,{CIRCLE:!0,FRAMES:!0}));y.material=new h.EmitterMaterial,y.material.diffuse=p.SharedSystem.textures.lightning;var g=new m.ParticleSystem(e,{limit:512,format:l.VertexDataFormat.Particle},r,l.ShaderProgram(e.gl,f.billboard_vert,f.billboard_frag,{ALIGNED:!0,GRADIENT:!0,STRETCH:.04}),l.ShaderProgram(e.gl,f.particle_vert,null,{CIRCLE:!0,TARGETED:!0,LUT:!0}));g.material=new h.EmitterMaterial,g.material.diffuse=p.SharedSystem.textures.particle,g.material.gradientRamp=h.GradientRamp(e.gl,[4294967040,4210608640,4074077184,3482272272,3007715120,2182088736,805502992,0,0,0,0,0,0,0,0,0],2),g.material.curveSampler=m.AttributeCurveSampler(e.gl,32,Object.values({size0:function(e){return 1-c.ease.sineIn(e)},size1:function(e){return 1-c.ease.quadIn(e)},linear0:function(e){return.98},linear1:function(e){return.96},rotational0:o.Zero,rotational1:o.Zero,radial0:o.Zero,radial1:o.Zero}));var x=new m.ParticleSystem(e,{limit:512,format:l.VertexDataFormat.Particle},r,l.ShaderProgram(e.gl,f.billboard_vert,d.fire_frag,{ALIGNED:!0}),l.ShaderProgram(e.gl,f.particle_vert,null,{SPHERE:!0,RELATIVE:!0}));x.material=new h.EmitterMaterial,x.material.diffuse=p.SharedSystem.textures.noise;var b=new m.ParticleSystem(e,{limit:256,format:l.VertexDataFormat.Particle},m.ParticleGeometry.board(e.gl,.2),l.ShaderProgram(e.gl,f.billboard_vert,f.billboard_frag,{ALIGNED:!0,GRADIENT:!0,FRAMES:!0}),l.ShaderProgram(e.gl,f.particle_vert,null,{SPHERE:!0,TARGETED:!0,LUT:!0,FRAMES:!0}));b.material=new h.EmitterMaterial,b.material.diffuse=p.SharedSystem.textures.spike,b.material.gradientRamp=h.GradientRamp(e.gl,[3991720192,1798129663,3341175664,1110324944,1964190032,639443616,0,0],4),b.material.curveSampler=m.AttributeCurveSampler(e.gl,32,Object.values({size0:function(e){return Math.sqrt(c.ease.fadeInOut(c.ease.cubicOut(e)))},size1:function(e){return Math.sqrt(c.ease.fadeInOut(c.ease.cubicOut(e)))},linear0:c.ease.reverse(c.ease.sineIn),linear1:c.ease.reverse(c.ease.sineIn),rotational0:o.Zero,rotational1:o.Zero,radial0:o.Zero,radial1:o.Zero}));var S=new m.StaticParticleSystem(e,{limit:512,format:l.VertexDataFormat.Particle},r,l.ShaderProgram(e.gl,f.verlet_vert,f.billboard_frag,{SPHERICAL:!0,GRADIENT:!0,VECTOR_FIELD:!0,LUT:!0}),{aLifetime:function(r,i,a){a[i+0]=e.currentTime-s.randomFloat(r.uLifespan[2],r.uLifespan[3],t()),a[i+1]=s.randomFloat(r.uLifespan[0],r.uLifespan[1],t()),a[i+2]=t(),a[i+3]=-r.uLifespan[2]},aSize:function(e,r,i){i[r+0]=i[r+1]=s.randomFloat(e.uSize[0],e.uSize[1],t()),i[r+2]=0,i[r+3]=1},aTransform:function(e,r,i){var a=s.randomFloat(0,2*Math.PI,t()),n=s.randomFloat(e.uRadius[0],e.uRadius[1],t()),o=n*Math.cos(a),c=n*Math.sin(a);i[r+0]=e.uOrigin[0]+o,i[r+1]=e.uOrigin[1],i[r+2]=e.uOrigin[2]+c,i[r+3]=0},aVelocity:function(e,t,r){r[t+0]=r[t+1]=r[t+2]=r[t+3]=0},aAcceleration:function(e,t,r){r[t+0]=e.uGravity[0],r[t+1]=e.uGravity[1],r[t+2]=e.uGravity[2],r[t+3]=0}});S.material=new h.EmitterMaterial,S.material.diffuse=p.SharedSystem.textures.glow,S.material.gradientRamp=h.GradientRamp(e.gl,[4160219904,2509606864,3638204944,1532126624,1194804032,858271360,0,0],4),S.material.curveSampler=m.AttributeCurveSampler(e.gl,32,Object.values({size0:c.ease.fadeInOut,size1:c.ease.fadeInOut,displacement0:c.ease.quadIn,displacement1:c.ease.sineIn})),S.material.displacementMap=p.SharedSystem.textures.perlinNoise;var P=new m.StaticParticleSystem(e,{limit:2048,format:l.VertexDataFormat.StaticParticle},m.ParticleGeometry.board(e.gl,.2),l.ShaderProgram(e.gl,d.grass_vert,d.foliage_frag,{FRAMES:!0}),{aLifetime:function(r,i,a){a[i+0]=e.currentTime,a[i+1]=0,a[i+2]=t(),a[i+3]=2},aTransform:function(e,r,i){var a=e.uOrigin[s.randomInt(0,e.uOrigin.length-1,t())],n=s.randomFloat(e.uRadius[0],e.uRadius[1],t()*t()),o=s.randomFloat(0,2*Math.PI,t());i[r+0]=a[0]+n*Math.cos(o),i[r+2]=a[2]+n*Math.sin(o),i[r+1]=a[1],i[r+3]=0},aSize:function(e,r,i){i[r+0]=i[r+1]=s.randomFloat(e.uSize[0],e.uSize[1],t()),i[r+2]=0,i[r+3]=2}});return P.material=new h.EmitterMaterial,P.material.blendMode=null,P.material.cullFace=0,P.material.depthWrite=!0,P.material.diffuse=p.SharedSystem.textures.plant,e.get(u.ParticleEffectPass).effects.push(S,n,b,v,i,a,y,g,x),e.get(u.DeferredGeometryPass).effects.push(P),{foliage:P,glow:S,dust:n,spikes:b,smoke:v,energy:i,sparks:a,bolts:y,embers:g,fire:x}}},9319:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.TextureLibrary=void 0;var o=r(4454),s=r(9479),c=r(720),l=n(r(6534)),u=n(r(3153));function f(e){for(var t=e.get(c.MaterialSystem),r=[{shader:u.solid,rate:0,uniforms:{uColor:[0,0,0,.5]}},{shader:u.solid,rate:0,uniforms:{uColor:[.91,.23,.52,1]}},{shader:u.solid,rate:0,uniforms:{uColor:[.2,.2,.2,.12]}},{shader:u.circuit,rate:2,uniforms:{}},{shader:u.hatch,rate:0,uniforms:{uColor:[.8,.9,1],uScale:4}},{shader:u.rust,define:{RUST:!1},rate:0,uniforms:{}},{shader:u.wires,rate:2,uniforms:{}},{shader:u.rust,define:{RUST:!0},rate:0,uniforms:{}},{shader:u.rust,define:{PIPE:!0},rate:0,uniforms:{}}],i=t.createRenderTexture(c.MaterialSystem.textureSize,c.MaterialSystem.textureSize,r.length),a=0;a<r.length;a++)t.addRenderTexture(i,a,s.ShaderProgram(e.gl,l.fullscreen_vert,r[a].shader,r[a].define),r[a].uniforms,r[a].rate);return{array:i.target,arrayLayers:r.length}}t.TextureLibrary=function(e){var t=e.get(c.MaterialSystem),r=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,l.noise_frag,{}),{uColor:o.vec4.ONE},0).target,i=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,l.noise_frag,{CELLULAR:!0}),{uColor:o.vec4.ONE},0).target,a=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,l.noise_frag,{VORONOI:!0}),{uColor:o.vec4.ONE},0).target,n=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,l.noise_frag,{PERLIN:!0}),{uColor:o.vec4.ONE},0).target,h=t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,l.noise_frag,{SINE:!0}),{uColor:o.vec4.ONE},0).target;return{noise:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,l.noise_frag,{}),{uColor:[3,2.5,1.5,1]},0).target,cloudNoise:r,cellularNoise:i,voronoiNoise:a,perlinNoise:n,sineNoise:h,noiseDirectional:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.noise_directional,{}),{},0).target,white:s.createTexture(e.gl,{width:1,height:1,data:new Uint8Array([255,255,255,255])}),black:s.createTexture(e.gl,{width:1,height:1,data:new Uint8Array([0,0,0,0])}),flatNormal:s.createTexture(e.gl,{width:1,height:1,data:new Uint8Array([127,127,255,255])}),indexedTexture:f(e),particle:t.addRenderTexture(t.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.circle),{uColor:o.vec4.ONE},0).target,glow:t.addRenderTexture(t.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.glow),{uColor:o.vec4.ONE},0).target,bulge:t.addRenderTexture(t.createRenderTexture(64,64,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.bulge),{uColor:o.vec4.ONE},0).target,ring:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.ring),{uColor:o.vec4.ONE},0).target,wave:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.wave),{uColor:o.vec4.ONE},0).target,sparkle:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.sparkle),{uColor:o.vec4.ONE},0).target,blink:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.blink),{uColor:o.vec4.ONE},0).target,rectangle:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.rectangle),{uColor:o.vec4.ONE,uRadius:.4,uSize:o.vec2(.2,.2)},0).target,bar:t.addRenderTexture(t.createRenderTexture(64,64,1,{wrap:33071,mipmaps:9728}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.rectangle,{FRAME:!0}),{uColor:[.5,.5,.5,.4],uRadius:0,uSize:o.vec2(.8,.8)},0).target,reticle:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.reticle),{uColor:o.vec4.ONE},0).target,rays:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.rays),{uColor:o.vec4.ONE},0).target,halo:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.rays,{OUTER:!0}),{uColor:o.vec4.ONE},0).target,burst:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.rays,{INNER:!0}),{uColor:o.vec4.ONE},0).target,swirl:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.swirl),{uColor:o.vec4.ONE},0).target,beam:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.streak),{uColor:o.vec4.ONE},0).target,streak:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.streak,{WRAP:!0}),{uColor:o.vec4.ONE},0).target,dust:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.streak,{GROUND:!0}),{uColor:o.vec4.ONE},0).target,sandstone:t.addRenderTexture(t.createRenderTexture(c.MaterialSystem.textureSize,c.MaterialSystem.textureSize),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.sandstone),{uScale:o.vec2.ONE,uColor:o.vec4.ONE},0).target,dunesNormal:t.addRenderTexture(t.createRenderTexture(c.MaterialSystem.textureSize,c.MaterialSystem.textureSize),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.dunes),{uScreenSize:[c.MaterialSystem.textureSize,c.MaterialSystem.textureSize]},0).target,wreck:t.addRenderTexture(t.createRenderTexture(c.MaterialSystem.textureSize,c.MaterialSystem.textureSize),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.wreck),{uScale:o.vec2.ONE,uColor:o.vec4.ONE},0).target,spiral:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.spiral),{uColor:o.vec4.ONE},0).target,blocklines:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.blocklines),{uColor:o.vec4.ONE},0).target,stripes:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:10497,mipmaps:0}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.stripes),{uColor:[.6,1,1,.6]},0).target,spike:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.spike),{uColor:o.vec4.ONE,uTiles:[2,2]},0).target,lightning:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.lightning),{uColor:o.vec4.ONE,uTiles:[4,4]},0).target,plant:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.plant),{uColor:o.vec4.ONE,uTiles:[2,2]},0).target,moss:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.moss),{uColor:o.vec4.ONE,uTiles:o.vec2.ONE},0).target,stamp:t.addRenderTexture(t.createRenderTexture(512,512,1,{wrap:33071,mipmaps:0,format:32856}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.stamp),{},0).target,stampNormal:t.addRenderTexture(t.createRenderTexture(256,256,1,{wrap:33071,mipmaps:0,format:32856}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.stamp,{NORMAL_MAP:!0}),{},0).target,shatter:t.addRenderTexture(t.createRenderTexture(512,512,1,{wrap:33071,mipmaps:0,format:32856}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.shatter),{},0).target,shatterNormal:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.shatter,{NORMAL_MAP:!0}),{},0).target,cracks:t.addRenderTexture(t.createRenderTexture(256,256,1,{wrap:33071,mipmaps:0,format:32856}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.cracks),{},0).target,cracksNormal:t.addRenderTexture(t.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0,format:32856}),0,s.ShaderProgram(e.gl,l.fullscreen_vert,u.cracks,{NORMAL_MAP:!0}),{},0).target}}},9495:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.DebrisEffect=void 0;var o=r(4454),s=r(9479),c=r(8581),l=r(757),u=r(9336),f=n(r(6534)),h=n(r(3153)),m=r(7822),d=function(){function e(e,t){this.context=e,this.material=new l.MeshMaterial,this.material.program=s.ShaderProgram(this.context.gl,h.debris_vert,f.geometry_frag,{VERTEX_COLOR:!0,COLOR_INDEX:!0}),this.material.array=m.SharedSystem.textures.indexedTexture.array,this.material.arrayLayers=m.SharedSystem.textures.indexedTexture.arrayLayers,Object.assign(this.material.program.uniforms,{uGravity:o.vec3(0,-19.6,0),uAngularVelocity:[.2*Math.PI*2,4*Math.PI*2],uVelocityMax:o.vec3(4,10,4),uVelocityMin:o.vec3(-4,4,-4)});var r=this.context.get(c.MeshSystem).models[t].geometry;this.buffer=this.context.get(c.MeshSystem).uploadVertexData(r.vertexArray,r.indexArray,r.format),this.buffer.radius+=16}return e.prototype.create=function(e){var t=this.context.get(c.MeshSystem).create();return t.transform=this.context.get(u.TransformSystem).create(),o.vec3.copy(e,t.transform.position),t.buffer=this.buffer,t.material=this.material,t.layer=1,t.order=3,t.startTime=this.context.currentTime,t},e.prototype.delete=function(e){this.context.get(u.TransformSystem).delete(e.transform),this.context.get(c.MeshSystem).delete(e)},e}();t.DebrisEffect=d},4446:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.GridEffect=void 0;var o=r(4454),s=r(9479),c=n(r(6534)),l=n(r(3153)),u=r(9336),f=r(757),h=r(296),m=function(){function e(e,t){this.context=e,this.gridSize=t,this.material=new f.DecalMaterial,this.material.program=s.ShaderProgram(this.context.gl,c.decal_vert,l.grid,{INSTANCED:!0,WORLD:!0}),this.material.blendMode=[[32774],[770,771,0,1]],this.material.program.uniforms.uGridSize=1/t,this.decal=this.context.get(h.DecalPass).create(1),this.decal.transform=this.context.get(u.TransformSystem).create(),o.vec3.set(2*t,10,2*t,this.decal.transform.scale),this.decal.material=this.material}return Object.defineProperty(e.prototype,"enabled",{get:function(){return 0!=this.decal.color[3]},set:function(e){o.vec4.copy(e?o.vec4.ONE:o.vec4.ZERO,this.decal.color)},enumerable:!1,configurable:!0}),e}();t.GridEffect=m},2181:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.MistEffect=void 0;var c=r(4454),l=r(9479),u=s(r(6534)),f=s(r(3153)),h=r(4998),m=r(84),d=r(757),p=function(e){function t(t,r,i){var a=e.call(this,t,{limit:r,format:[{name:"aTransform",size:3,type:5126,normalized:!1,stride:12,offset:0}]},null,l.ShaderProgram(t.gl,f.mist_vert,u.billboard_frag,{POINT:!0}),null)||this;a.center=c.vec3(0,0,0),a.ray=c.vec3(0,0,0),a.frame=0,a.material=new d.EmitterMaterial,a.material.blendMode=d.ShaderMaterial.Blend,a.program.uniforms.uArea=c.vec3(i[3]-i[0],i[4]-i[1],i[5]-i[2]),a.instances=r;for(var n=a.context.gl,o=c.mulberry32(),s=new Float32Array(3*a.instances),h=0;h<a.instances;h++)s[3*h+0]=c.randomFloat(i[0],i[3],o()),s[3*h+1]=c.randomFloat(i[1],i[4],o()),s[3*h+2]=c.randomFloat(i[2],i[5],o());n.bindBuffer(34962,a.buffer[0]),n.bufferSubData(34962,0,s);var m=a.context.get(d.MaterialSystem);return a.material.diffuse=m.addRenderTexture(m.createRenderTexture(128,128,1,{wrap:33071,mipmaps:0}),0,l.ShaderProgram(t.gl,u.fullscreen_vert,f.circle),{uColor:[.5,.5,.5,1]},0).target,a}return a(t,e),t.prototype.apply=function(){var t,r,i,a,n,o,s,l,u=this.context.get(h.CameraSystem).camera;this.frame>=u.frame&&this.frame||(this.frame=this.context.frame,c.vec3.set(u.viewMatrix[2],u.viewMatrix[6],u.viewMatrix[10],this.ray),t=u.transform.position,r=this.ray,i=c.vec3.AXIS_Y,a=c.vec3.ZERO,n=this.center,o=-c.vec3.dot(a,i),s=c.vec3.dot(r,i),l=-(c.vec3.dot(t,i)+o)/s,c.vec3.scale(r,l,n),c.vec3.add(n,t,n),this.context.gl.useProgram(this.program.target),this.program.uniforms.uCenter=this.center,this.program.uniforms.uSize=.2*this.context.gl.drawingBufferHeight*.5*u.projectionMatrix[5]),e.prototype.apply.call(this)},t}(m.ParticleSystem);t.MistEffect=p},7233:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SkyEffect=void 0;var o=r(4454),s=r(296),c=r(757),l=r(9479),u=n(r(6534)),f=n(r(3153)),h=function(){function e(e){this.context=e,this.enabled=!0,this.color=o.vec3(1.2,.4,.6),this.buffer=this.context.get(s.PostEffectPass).plane,this.material=new c.ShaderMaterial,this.material.blendMode=null,this.material.cullFace=1029,this.material.depthTest=515,this.material.depthWrite=!0,this.material.program=l.ShaderProgram(this.context.gl,u.fullscreen_vert,f.sky_frag,{RAYCAST:!0}),this.material.program.uniforms.uLayer=0,this.material.program.uniforms.uFogColor=this.context.get(s.PostEffectPass).fog.color,this.material.program.uniforms.uSkyColor=this.color}return e.prototype.apply=function(){if(this.enabled){var e=this.context.gl;e.useProgram(this.material.program.target),this.material.bind(e),e.bindVertexArray(this.buffer.vao),e.drawElements(this.buffer.drawMode,this.buffer.indexCount,5123,this.buffer.indexOffset)}},e}();t.SkyEffect=h},3616:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(9495),t),a(r(4446),t),a(r(7233),t),a(r(2181),t)},7822:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.SharedSystem=void 0;var n=r(4454),o=r(296),s=r(9319),c=r(9577),l=r(6251),u=r(3315),f=r(4618),h=r(3616);a(r(8271),t);var m=function(){function e(t){this.context=t,e.textures=s.TextureLibrary(this.context),e.gradients=c.GradientLibrary(this.context),e.materials=l.MaterialLibrary(this.context),e.geometry=f.GeometryLibrary(this.context),e.particles=u.ParticleLibrary(this.context)}return e.prototype.update=function(){},e.prototype.load=function(e,t,r){this.sky=new h.SkyEffect(this.context),this.context.get(o.DeferredGeometryPass).effects.push(this.sky),this.debris=new h.DebrisEffect(this.context,"cube_debris"),this.grid=new h.GridEffect(this.context,10),this.mist=new h.MistEffect(this.context,256,[-8,0,-8,8,6,8]),this.context.get(o.ParticleEffectPass).effects.push(this.mist),r()},e.random=n.mulberry32(),e}();t.SharedSystem=m},2394:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArtillerySkill=void 0;var s=r(4454),c=r(6725),l=r(9336),u=r(6365),f=r(8581),h=r(296),m=r(7822),d=r(9131),p=r(8137),v=r(3605),y=r(6888),g={"burn.transform.scale":c.PropertyAnimation([{frame:0,value:[0,4,0]},{frame:.4,value:[8,4,8],ease:c.ease.cubicOut}],s.vec3.lerp),"burn.color":c.PropertyAnimation([{frame:0,value:[0,0,0,1]},{frame:1,value:s.vec4.ZERO,ease:c.ease.quadIn}],s.vec4.lerp),"wave.transform.scale":c.PropertyAnimation([{frame:0,value:s.vec3.ZERO},{frame:.6,value:[12,12,12],ease:c.ease.quartOut}],s.vec3.lerp),"wave.color":c.PropertyAnimation([{frame:0,value:s.vec4.ONE},{frame:.6,value:s.vec4.ZERO,ease:c.ease.sineOut}],s.vec4.lerp),"ring.transform.scale":c.PropertyAnimation([{frame:0,value:[0,2,0]},{frame:.8,value:[6,2,6],ease:c.ease.cubicOut}],s.vec3.lerp),"ring.color":c.PropertyAnimation([{frame:0,value:[.3,.3,.4,1]},{frame:.8,value:s.vec4.ZERO,ease:c.ease.sineIn}],s.vec4.lerp),"pillar.transform.scale":c.PropertyAnimation([{frame:0,value:[1,0,1]},{frame:.4,value:[2,6,2],ease:c.ease.quartOut},{frame:.8,value:s.vec3.ZERO,ease:c.ease.quadIn}],s.vec3.lerp),"pillar.color":c.PropertyAnimation([{frame:0,value:[.6,.6,.8,.2]},{frame:.4,value:[.18,.16,.2,1],ease:c.ease.sineIn},{frame:.8,value:s.vec4.ZERO,ease:c.ease.sineOut}],s.vec4.lerp),"flash.transform.scale":c.PropertyAnimation([{frame:0,value:s.vec3.ZERO},{frame:.3,value:[4.4,4.4,4.4],ease:c.ease.quintOut}],s.vec3.lerp),"flash.color":c.PropertyAnimation([{frame:0,value:[1,.9,.8,.2]},{frame:.3,value:s.vec4.ZERO,ease:c.ease.quadIn}],s.vec4.lerp)},x=function(){function e(e,t){this.context=e,this.parent=t,this.origin=s.vec3(),this.target=s.vec3(),this.normal=s.vec3()}return e.prototype.launch=function(e,t){var r,i,a,d,y,x,b,S,P,O,T;return o(this,(function(o){switch(o.label){case 0:r=this.context.currentTime+.6,o.label=1;case 1:return this.context.currentTime<r?[4,c.ActionSignal.WaitNextFrame]:[3,4];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:this.context.get(v.TerrainSystem).tilePosition(e[0],e[1],this.target),this.head=this.context.get(f.MeshSystem).loadModel("missile"),this.head.transform=this.context.get(l.TransformSystem).create(),s.vec3.copy(this.origin,this.head.transform.position),s.quat.fromNormal(this.normal,s.vec3.AXIS_Y,this.head.transform.rotation),s.quat.normalize(this.head.transform.rotation,this.head.transform.rotation),this.trail=f.Line.create(16,4,.4,c.ease.cubicFadeInOut,!0),this.trail.material=m.SharedSystem.materials.effect.trailSmoke,this.context.get(h.ParticleEffectPass).add(this.trail),this.exhaust=f.BatchMesh.create(m.SharedSystem.geometry.hemisphere,2),this.exhaust.material=m.SharedSystem.materials.effect.exhaust,this.exhaust.transform=this.context.get(l.TransformSystem).create(),this.exhaust.transform.parent=this.head.transform,s.vec3.set(.24,.24,1.2,this.exhaust.transform.scale),this.context.get(h.ParticleEffectPass).add(this.exhaust),this.smoke=m.SharedSystem.particles.smoke.add({uLifespan:[1,1.5,-.8,0],uOrigin:s.vec3.add(this.origin,s.vec3.scale(this.normal,-.5,s.vec3()),s.vec3()),uGravity:[0,3.6,0],uRotation:[0,2*Math.PI],uSize:[1,2],uFieldDomain:[.5,.5,.5,0],uFieldStrength:[6,0]}),this.embers=m.SharedSystem.particles.embers.add({uLifespan:[.3,.5,-.04,0],uOrigin:s.vec3.add(this.origin,s.vec3.scale(this.normal,-1,s.vec3()),s.vec3()),uRadius:[0,.04],uOrientation:s.quat.rotation(s.vec3.AXIS_Y,this.normal,s.quat()),uGravity:s.vec3.ZERO,uRotation:s.vec2.ZERO,uSize:[.2,.7],uForce:[8,14],uTarget:s.vec3.scale(this.normal,-.2,s.vec3())}),this.burn=this.context.get(h.DecalPass).create(0),this.burn.transform=this.context.get(l.TransformSystem).create(),s.vec3.copy(this.target,this.burn.transform.position),s.quat.axisAngle(s.vec3.AXIS_Y,s.randomFloat(0,2*Math.PI,m.SharedSystem.random()),this.burn.transform.rotation),this.burn.material=m.SharedSystem.materials.decal.rays,this.wave=f.Sprite.create(0),this.wave.material=m.SharedSystem.materials.distortion.wave,this.wave.transform=this.context.get(l.TransformSystem).create(),s.vec3.add([0,1,0],this.target,this.wave.transform.position),s.quat.axisAngle(s.vec3.AXIS_X,-.5*Math.PI,this.wave.transform.rotation),this.context.get(h.PostEffectPass).add(this.wave),this.ring=f.BatchMesh.create(m.SharedSystem.geometry.cylinder,6),this.ring.material=m.SharedSystem.materials.effect.ringDust,this.ring.transform=this.context.get(l.TransformSystem).create(),s.vec3.copy(this.target,this.ring.transform.position),this.context.get(h.ParticleEffectPass).add(this.ring),this.pillar=f.Sprite.create(3,0,s.vec4.ONE,[0,.5]),this.pillar.material=m.SharedSystem.materials.sprite.dust,this.pillar.transform=this.context.get(l.TransformSystem).create(),s.vec3.copy(this.target,this.pillar.transform.position),this.context.get(h.ParticleEffectPass).add(this.pillar),this.flash=f.Sprite.create(0),this.flash.material=m.SharedSystem.materials.sprite.ring,this.flash.transform=this.context.get(l.TransformSystem).create(),s.vec3.add(s.vec3.AXIS_Y,this.target,this.flash.transform.position),s.quat.axisAngle(s.vec3.AXIS_X,-.5*Math.PI,this.flash.transform.rotation),this.context.get(h.ParticleEffectPass).add(this.flash),i=this.buildPath(this.target,5),a=i.path,d=i.intervals,y=1+.25*t,x=c.FollowPath.spline(a,d.map((function(e){return y*e-y})),{ease:c.ease.CubicBezier(.5,.5,1,.5),tension:.5}),b=c.EventTrigger([{frame:0,value:e}],p.CubeSkill.damage),S=c.AnimationTimeline(this,n(n({},g),{embers:c.EventTrigger([{frame:-y,value:16}],c.EventTrigger.emit),smoke:c.EventTrigger([{frame:-y,value:24}],c.EventTrigger.emit),trail:c.FollowPath.Line(x,{length:.08}),"head.transform":c.FollowPath(x)})),this.context.get(u.AudioSystem).create("assets/cube_8_hit.mp3","sfx",this.head.transform).play(y-.3),P=1,O=this.context.currentTime+y,o.label=5;case 5:return T=this.context.currentTime-O,S(T,this.context.deltaTime),b(T,this.context.deltaTime,this.parent),T>P?[3,9]:[3,6];case 6:return[4,c.ActionSignal.WaitNextFrame];case 7:o.sent(),o.label=8;case 8:return[3,5];case 9:return m.SharedSystem.particles.embers.remove(this.embers),m.SharedSystem.particles.smoke.remove(this.smoke),this.context.get(l.TransformSystem).delete(this.head.transform),this.context.get(l.TransformSystem).delete(this.exhaust.transform),this.context.get(l.TransformSystem).delete(this.burn.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(l.TransformSystem).delete(this.wave.transform),this.context.get(l.TransformSystem).delete(this.pillar.transform),this.context.get(l.TransformSystem).delete(this.flash.transform),this.context.get(f.MeshSystem).delete(this.head),this.context.get(h.DecalPass).delete(this.burn),this.context.get(h.PostEffectPass).remove(this.wave),this.context.get(h.ParticleEffectPass).remove(this.trail),this.context.get(h.ParticleEffectPass).remove(this.exhaust),this.context.get(h.ParticleEffectPass).remove(this.ring),this.context.get(h.ParticleEffectPass).remove(this.pillar),this.context.get(h.ParticleEffectPass).remove(this.flash),f.Sprite.delete(this.pillar),f.Sprite.delete(this.flash),f.Sprite.delete(this.wave),f.BatchMesh.delete(this.ring),f.BatchMesh.delete(this.exhaust),f.Line.delete(this.trail),this.parent.pool.push(this),[2]}}))},e.prototype.buildPath=function(e,t){var r=[this.origin],i=[0],a=s.vec3.scale(this.normal,1,s.vec3());s.vec3.add(this.origin,a,a);var n=s.vec3.scale(this.normal,3,s.vec3());s.vec3.add(a,n,n);var o=s.vec3.subtract(e,n,s.vec3()),c=s.vec3.dot(this.normal,o);s.vec3.scale(this.normal,c,o),s.vec3.subtract(e,o,o);for(var l=s.vec2(1,Math.max(0,this.origin[1])+6),u=s.vec3(),f=0,h=0;h<=t;h++){var d=r[r.length-1],p=s.cubicBezier3D(a,n,o,e,h/t,s.vec3());r.push(p),s.vec3.random(m.SharedSystem.random(),m.SharedSystem.random(),u),s.vec3.scale(u,m.SharedSystem.random()*(0==h||h==t?0:1),u),s.vec3.add(p,u,p),p[1]=s.clamp(p[1],l[0],l[1]),i.push(f+=Math.sqrt(s.vec3.distanceSquared(d,p)))}r.push(s.vec3.subtract(e,[0,2,0],s.vec3())),i.push(i[i.length-1]+1/t);for(var v=1/i[h=i.length-1];h>=0;h--)i[h]*=v;return{path:r,intervals:i}},e}(),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.indicator={capacity:2,amount:2},t.pool=[],t.pivots=[s.vec3(-1,4.4,-2.1),s.vec3(-1.6,3.8,-2.1),s.vec3(-1,4.4,2.1),s.vec3(-1.6,3.8,2.1)],t.damageType=1,t.damage=1,t.range=4,t}return a(t,e),t.prototype.update=function(){this.indicator.amount=this.indicator.capacity},t.prototype.clear=function(){this.indicator.amount<this.indicator.capacity&&(this.cube.action.amount=0)},t.prototype.query=function(e){if(-1!==e&&this.indicator.amount){for(var t=this.cube.tile,r=.5*-(e-1)*Math.PI,i=p.CubeSkill.queryArea(this.context,t,this.minRange,this.range,2),a=[],n=4;n>0;n--){for(var o=-1,c=1/0,l=i.length-1;l>=0;l--){var u=i[l],f=(d=s.moddelta(2*Math.PI,r,Math.atan2(u[1]-t[1],u[0]-t[0])))+(h=s.vec2.distance(t,u)/this.range);f>=c||(c=f,o=l)}if(-1!=o)a.push(i.splice(o,1)[0]);else{var h=s.randomFloat(Math.SQRT2,this.range,m.SharedSystem.random()),d=r+Math.PI*s.randomFloat(-.5,.5,m.SharedSystem.random()),g=s.vec2(Math.cos(d)*h|0,Math.sin(d)*h|0);s.vec2.add(t,g,g);var x=this.context.get(v.TerrainSystem).getTile(g[0],g[1]);x&&x instanceof y.Unit?n++:a.push(g)}}return a}},t.prototype.activate=function(e,t){var r,i,a,n,l,f;return o(this,(function(o){switch(o.label){case 0:for(--this.indicator.amount<=0&&(this.cube.action.amount=0),r=c.AnimationTimeline(this,{"mesh.armature":m.ModelAnimation("activate"),"mesh.armature.nodes.1.rotation":c.PropertyAnimation([{frame:0,value:s.quat.copy(this.mesh.armature.nodes[1].rotation,s.quat())},{frame:.6,value:d.DirectionAngle[s.mod(t-this.direction-3,4)],ease:c.ease.quadInOut}],s.quat.slerp)}),i=0;i<this.pivots.length;i++)a=this.pool.pop()||new x(this.context,this),s.vec3.copy(this.pivots[i],a.origin),s.vec3.normalize([-1,1,0],a.normal),s.quat.transform(a.origin,d.DirectionAngle[t],a.origin),s.mat4.transform(a.origin,this.cube.transform.matrix,a.origin),s.quat.transform(a.normal,d.DirectionAngle[t],a.normal),this.context.get(d.TurnBasedSystem).enqueue(a.launch(e[i],i),!0);this.context.get(u.AudioSystem).create("assets/"+this.mesh.armature.key+"_use.mp3","sfx",this.mesh.transform).play(0),n=2,l=this.context.currentTime,o.label=1;case 1:return f=this.context.currentTime-l,r(f,this.context.deltaTime),f>n?[3,5]:[3,2];case 2:return[4,c.ActionSignal.WaitNextFrame];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return[2]}}))},t.prototype.close=function(){var t,r,i,a,n,l;return o(this,(function(o){switch(o.label){case 0:t=this.mesh,r=c.PropertyAnimation([{frame:0,value:s.quat.copy(t.armature.nodes[1].rotation,s.quat())},{frame:.4,value:s.quat.IDENTITY,ease:c.ease.quadInOut}],s.quat.slerp),i=e.prototype.close.call(this),a=this.context.currentTime,o.label=1;case 1:return n=this.context.currentTime-a,r(n,t.armature.nodes[1].rotation),(l=i.next()).done?[2,l.value]:[3,2];case 2:return[4,l.value];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return[2]}}))},t}(p.CubeSkill);t.ArtillerySkill=b},708:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.BeamSkill=void 0;var s=r(4454),c=r(296),l=r(757),u=r(9336),f=r(6365),h=r(6725),m=r(8581),d=r(7822),p=r(9131),v=r(8137),y={"mesh.armature":d.ModelAnimation("activate"),"light.radius":h.PropertyAnimation([{frame:1,value:0},{frame:1.4,value:8,ease:h.ease.quadOut}],s.lerp),"light.intensity":h.PropertyAnimation([{frame:1,value:0},{frame:1.4,value:4,ease:h.ease.quadOut},{frame:3,value:0,ease:h.ease.quadIn}],s.lerp),"center.transform.scale":h.PropertyAnimation([{frame:1.2,value:s.vec3.ZERO},{frame:1.8,value:[8,8,8],ease:h.ease.cubicOut}],s.vec3.lerp),"center.color":h.PropertyAnimation([{frame:2.4,value:s.vec4.ONE},{frame:3,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),"cone.transform.scale":h.PropertyAnimation([{frame:0,value:[6,0,6]},{frame:1,value:[3,3,3],ease:h.ease.quadOut},{frame:1.5,value:[0,6,0],ease:h.ease.cubicIn}],s.vec3.lerp),"cone.color":h.PropertyAnimation([{frame:0,value:s.vec4.ZERO},{frame:1.2,value:s.vec4.ONE,ease:h.ease.quadOut},{frame:1.4,value:[1,1,1,0],ease:h.ease.quadIn}],s.vec4.lerp),"cone.material.uniform.uniforms.uUVTransform.1":h.PropertyAnimation([{frame:.4,value:0},{frame:1.5,value:.0072*-255,ease:h.ease.quartIn},{frame:2,value:0,ease:h.ease.stepped}],s.lerp),"cone.material.uniform.uniforms.uUV2Transform.1":h.PropertyAnimation([{frame:.4,value:0},{frame:1.5,value:.0144*-255,ease:h.ease.quartIn},{frame:2,value:0,ease:h.ease.stepped}],s.lerp),"ring.transform.scale":h.PropertyAnimation([{frame:.8,value:[4,4,4]},{frame:1.1,value:[8,8,8],ease:h.ease.sineOut},{frame:1.4,value:s.vec3.ZERO,ease:h.ease.cubicIn}],s.vec3.lerp),"ring.color":h.PropertyAnimation([{frame:.8,value:s.vec4.ZERO},{frame:1.1,value:[.1,.5,.6,.5],ease:h.ease.quadOut},{frame:1.4,value:[.5,1,1,0],ease:h.ease.sineIn}],s.vec4.lerp),"flash.transform.scale":h.PropertyAnimation([{frame:1.3,value:s.vec3.ZERO},{frame:1.8,value:[10,10,10],ease:h.ease.cubicOut}],s.vec3.lerp),"flash.color":h.PropertyAnimation([{frame:1.3,value:[.7,1,1,0]},{frame:1.8,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),"beam.width":h.PropertyAnimation([{frame:1.3,value:0},{frame:1.6,value:2,ease:h.ease.sineIn}],s.lerp),"beam.color":h.PropertyAnimation([{frame:2.4,value:s.vec4.ONE},{frame:3,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),energy:h.EventTrigger([{frame:0,value:128}],h.EventTrigger.emit),sparks:h.EventTrigger([{frame:1.2,value:32}],h.EventTrigger.emit),smoke:h.EventTrigger([{frame:2.5,value:8}],h.EventTrigger.emit)},g=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.damageType=6,i.damage=1,i.range=8,i.origin=s.vec3(),i.target=s.vec3(),i.center=m.Sprite.create(2),i.center.material=new l.SpriteMaterial(s.vec4(8,4,1,1)),i.center.material.program=d.SharedSystem.materials.program.beamRadial,i.center.material.diffuse=d.SharedSystem.gradients.tealBlue,i.beam=m.Line.create(2,0),i.beam.material=new l.SpriteMaterial(s.vec4(4,8,1,1)),i.beam.material.program=d.SharedSystem.materials.program.beamLinear,i.beam.material.diffuse=d.SharedSystem.gradients.tealBlue,i}return a(t,e),t.prototype.query=function(e){return v.CubeSkill.queryLine(this.context,this.cube.tile,s.mod(this.direction+2,4),this.range,2)},t.prototype.activate=function(e){var t,r,i,a,l,g,x,b,S,P;return o(this,(function(o){switch(o.label){case 0:this.cube.action.amount=0,t=this.cube.transform.matrix,r=p.DirectionAngle[this.direction],i=s.quat.transform([.6,1.5,0],r,this.origin),a=s.quat.transform([2*this.range,1.5,0],r,this.target),s.mat4.transform(i,t,i),s.mat4.transform(a,t,a),this.cone=m.BatchMesh.create(d.SharedSystem.geometry.cone),this.cone.material=d.SharedSystem.materials.effect.absorbTeal,this.cone.transform=this.context.get(u.TransformSystem).create(i),l=s.vec3.subtract(a,i,s.vec3()),s.quat.rotation([0,-1,0],l,this.cone.transform.rotation),this.context.get(c.ParticleEffectPass).add(this.cone),this.center.transform=this.context.get(u.TransformSystem).create(),s.vec3.copy(i,this.center.transform.position),this.context.get(c.ParticleEffectPass).add(this.center),this.flash=m.Sprite.create(2),this.flash.material=d.SharedSystem.materials.sprite.rays,this.flash.transform=this.context.get(u.TransformSystem).create(i),this.context.get(c.ParticleEffectPass).add(this.flash),this.ring=m.Sprite.create(2),this.ring.material=d.SharedSystem.materials.sprite.ring,this.ring.transform=this.context.get(u.TransformSystem).create(i),this.context.get(c.ParticleEffectPass).add(this.ring),s.vec3.copy(i,this.beam.path[0]),this.context.get(c.ParticleEffectPass).add(this.beam),this.light=this.context.get(c.PointLightPass).create([.5,1,1]),this.light.transform=this.context.get(u.TransformSystem).create(i),this.energy=d.SharedSystem.particles.energy.add({uLifespan:[1,1.8,0,0],uOrigin:i,uTarget:s.vec3.ZERO,uRotation:s.vec2.ZERO,uGravity:s.vec3.ZERO,uSize:[.4,.8],uRadius:[8,12],uForce:s.vec2.ZERO}),this.sparks=d.SharedSystem.particles.sparks.add({uLifespan:[.5,1,-.2,0],uOrigin:i,uTarget:s.vec3.ZERO,uLength:[.2,.4],uGravity:[0,-9.8,0],uSize:[.1,.4],uRadius:[.2,.5],uForce:[4,10]}),this.smoke=this.smoke||d.SharedSystem.particles.smoke.add({uOrigin:i,uLifespan:[1.6,2,-1,0],uRotation:[0,2*Math.PI],uGravity:[0,3.2,0],uSize:[1,3],uFieldDomain:s.vec4.ONE,uFieldStrength:s.vec2.ZERO}),g=h.EventTrigger(e.map((function(e){return{frame:1.6,value:e}})),v.CubeSkill.damage),x=h.AnimationTimeline(this,n(n({},y),{"beam.path.1":h.PropertyAnimation([{frame:1.3,value:i},{frame:1.6,value:a,ease:h.ease.cubicOut}],s.vec3.lerp)})),this.context.get(f.AudioSystem).create("assets/"+this.mesh.armature.key+"_use.mp3","sfx",this.mesh.transform).play(0),b=3,S=this.context.currentTime,o.label=1;case 1:return P=this.context.currentTime-S,x(P,this.context.deltaTime),g(P,this.context.deltaTime,this),P>b?[3,5]:[3,2];case 2:return[4,h.ActionSignal.WaitNextFrame];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return d.SharedSystem.particles.energy.remove(this.energy),d.SharedSystem.particles.sparks.remove(this.sparks),this.context.get(c.ParticleEffectPass).remove(this.cone),this.context.get(c.ParticleEffectPass).remove(this.ring),this.context.get(c.ParticleEffectPass).remove(this.flash),this.context.get(c.ParticleEffectPass).remove(this.beam),this.context.get(c.ParticleEffectPass).remove(this.center),this.context.get(u.TransformSystem).delete(this.ring.transform),this.context.get(u.TransformSystem).delete(this.flash.transform),this.context.get(u.TransformSystem).delete(this.cone.transform),this.context.get(u.TransformSystem).delete(this.center.transform),this.context.get(u.TransformSystem).delete(this.light.transform),this.context.get(c.PointLightPass).delete(this.light),m.Sprite.delete(this.ring),m.Sprite.delete(this.flash),m.BatchMesh.delete(this.cone),[2]}}))},t.prototype.clear=function(){this.smoke&&(this.smoke=void d.SharedSystem.particles.smoke.remove(this.smoke))},t}(v.CubeSkill);t.BeamSkill=g},7574:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CorrosionPhase=void 0;var i=r(4454),a=r(6725),n=r(9131),o=r(3605),s=r(6888),c=function(){function e(e){var t=this;this.context=e,this.order=4,this.list=[],this.context.get(n.TurnBasedSystem).add(this),this.context.get(n.TurnBasedSystem).signalReset.add((function(){for(;t.list.length;)t.list.pop().delete()}))}return e.prototype.execute=function(){for(var e=this.context.get(o.TerrainSystem),t=e.bounds,r=this.list.length-1;r>=0;r--){var c=this.list[r];if(i.aabb2.inside(t,c.tile))if(--c.health.amount<=0)this.context.get(a.AnimationSystem).start(c.dissolve(),!0);else{var l=e.getTile(c.tile[0],c.tile[1]);null!=l&&l instanceof s.Unit&&0!=(l.group&c.group)||i.vec2.add(c.direction,c.tile,c.tile);for(var u=!1,f=this.list.length-1;f>r;f--){var h=this.list[f],m=h.tile,d=h.direction;if(m[0]===c.tile[0]&&m[1]===c.tile[1]||m[0]===c.tile[0]-c.direction[0]&&m[1]===c.tile[1]-c.direction[1]&&m[0]-d[0]===c.tile[0]&&m[1]-d[1]===c.tile[1]){u=!0;break}}if(!u){var p=e.getTile(c.tile[0],c.tile[1]),v=null!=p&&p instanceof s.Unit&&0!=(p.group&c.group)?p.tile:null;this.context.get(n.TurnBasedSystem).enqueue(c.move(v),!0);continue}this.context.get(a.AnimationSystem).start(c.dissolve(),!0)}else c.delete();this.list.splice(r,1)}return null},e.prototype.add=function(e){for(var t=this.list.length-1;t>=0;t--){var r=this.list[t];r.tile[0]===e.tile[0]&&r.tile[1]===e.tile[1]&&(this.list.splice(t,1),this.context.get(a.AnimationSystem).start(r.dissolve(),!0))}this.list.push(e)},e}();t.CorrosionPhase=c},4354:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CorrosiveOrbSkill=void 0;var o=r(4454),s=r(6725),c=r(9336),l=r(6365),u=r(8581),f=r(296),h=r(7822),m=r(9131),d=r(3605),p=r(6888),v=r(8137),y=r(7574),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tile=o.vec2(),t.direction=o.vec2(),t.damageType=24,t.health={capacity:4,amount:0},t.group=2,t.range=2,t.damage=1,t}return a(t,e),t.prototype.place=function(e,t){o.vec2.set(e,t,this.tile),this.health.amount=this.health.capacity,this.transform=this.context.get(c.TransformSystem).create(),this.context.get(d.TerrainSystem).tilePosition(e,t,this.transform.position),o.vec3.add(o.vec3.AXIS_Y,this.transform.position,this.transform.position),this.decal=this.context.get(f.DecalPass).create(8),this.decal.material=h.SharedSystem.materials.corrosionMaterial,this.decal.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ZERO,this.transform),this.orb=this.context.get(u.MeshSystem).create(h.SharedSystem.geometry.sphereMesh,4,8),this.orb.material=h.SharedSystem.materials.mesh.orb,this.orb.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.transform),this.aura=u.Sprite.create(2,4),this.aura.material=h.SharedSystem.materials.effect.auraTeal,this.aura.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.transform),this.context.get(f.ParticleEffectPass).add(this.aura),this.fire=h.SharedSystem.particles.fire.add({uLifespan:o.vec4(.8,1,0,0),uOrigin:this.transform.position,uRotation:o.vec2.ZERO,uGravity:o.vec3.ZERO,uSize:o.vec2(1,3),uRadius:o.vec2(.8,1.2)})},t.prototype.delete=function(){this.transform=void this.context.get(c.TransformSystem).delete(this.transform),this.context.get(c.TransformSystem).delete(this.aura.transform),this.context.get(c.TransformSystem).delete(this.orb.transform),this.context.get(c.TransformSystem).delete(this.decal.transform),this.decal=void this.context.get(f.DecalPass).delete(this.decal),this.context.get(f.ParticleEffectPass).remove(this.aura),this.aura=void u.Sprite.delete(this.aura),this.orb=void this.context.get(u.MeshSystem).delete(this.orb),this.fire=void h.SharedSystem.particles.fire.remove(this.fire),t.pool.push(this)},t.prototype.move=function(e){var t,r,i,a,c,l;return n(this,(function(n){switch(n.label){case 0:if(t=o.vec3.copy(this.transform.position,o.vec3()),r=this.context.get(d.TerrainSystem).tilePosition(this.tile[0],this.tile[1],o.vec3()),o.vec3.add(o.vec3.AXIS_Y,r,r),i=s.AnimationTimeline(this,{"orb.transform.scale":s.PropertyAnimation([{frame:0,value:o.vec3.copy(this.orb.transform.scale,o.vec3())},{frame:1,value:e?[.5,.5,.5]:o.vec3.ONE,ease:s.ease.cubicIn}],o.vec3.lerp),"transform.position":s.PropertyAnimation([{frame:0,value:t},{frame:1,value:r,ease:s.ease.quadInOut}],o.vec3.lerp),"fire.uniform.uniforms.uOrigin":s.PropertyAnimation([{frame:0,value:t},{frame:1,value:r,ease:s.ease.quadInOut}],o.vec3.lerp)}),o.vec3.equals(t,r,1e-6))return[3,5];a=1,c=this.context.currentTime,n.label=1;case 1:return l=this.context.currentTime-c,i(l,this.context.deltaTime),l>a?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return e&&p.UnitSkill.damage(this,this.tile),[2]}}))},t.prototype.appear=function(e,t){var r,i,a,c;return n(this,(function(n){switch(n.label){case 0:r=s.AnimationTimeline(this,{"decal.transform.scale":s.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[8,8,8],ease:s.ease.quadOut}],o.vec3.lerp),"transform.position":s.PropertyAnimation([{frame:0,value:e},{frame:1,value:o.vec3.copy(this.transform.position,o.vec3()),ease:s.ease.sineInOut}],o.vec3.lerp),"aura.transform.scale":s.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[4,4,4],ease:s.ease.elasticOut(1,.5)}],o.vec3.lerp),"orb.transform.scale":s.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:o.vec3.ONE,ease:s.ease.elasticOut(1,.8)}],o.vec3.lerp),"fire.rate":s.PropertyAnimation([{frame:0,value:0},{frame:.2,value:.36,ease:s.ease.stepped}],o.lerp)}),i=1,a=this.context.currentTime+t,n.label=1;case 1:return c=this.context.currentTime-a,r(c,this.context.deltaTime),c>i?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return p.UnitSkill.damage(this,this.tile),[2]}}))},t.prototype.dissolve=function(){var e,t,r,i;return n(this,(function(a){switch(a.label){case 0:e=s.AnimationTimeline(this,{"fire.rate":s.PropertyAnimation([{frame:0,value:0}],o.lerp),"decal.color":s.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:1,value:[1,1,1,0],ease:s.ease.sineOut}],o.vec4.lerp),"aura.color":s.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:1,value:o.vec4.ZERO,ease:s.ease.sineOut}],o.vec4.lerp),"orb.color":s.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:1,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp)}),t=1,r=this.context.currentTime,a.label=1;case 1:return i=this.context.currentTime-r,e(i,this.context.deltaTime),i>t?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:return this.delete(),[2]}}))},t.pool=[],t}(p.UnitSkill),x={"mesh.armature":h.ModelAnimation("activate"),particles:s.EventTrigger([{frame:.2,value:48}],s.EventTrigger.emit),"cone.transform.scale":s.PropertyAnimation([{frame:0,value:[.2,.2,1]},{frame:.6,value:o.vec3.ONE,ease:s.ease.sineOut},{frame:.8,value:[0,0,2],ease:s.ease.quartIn}],o.vec3.lerp),"cone.color":s.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:.6,value:o.vec4.ONE,ease:s.ease.quadOut},{frame:.8,value:[1,0,1,0],ease:s.ease.cubicIn}],o.vec4.lerp),"glow.transform.scale":s.PropertyAnimation([{frame:.5,value:o.vec3.ZERO},{frame:.8,value:[8,8,8],ease:s.ease.quartOut}],o.vec3.lerp),"glow.color":s.PropertyAnimation([{frame:.5,value:[.7,1,.9,0]},{frame:.8,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp),"ring.transform.scale":s.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.7,value:[6,6,6],ease:s.ease.quadIn},{frame:1.6,value:[12,12,12],ease:s.ease.cubicOut}],o.vec3.lerp),"ring.transform.position":s.PropertyAnimation([{frame:0,value:[0,0,-1]},{frame:1.6,value:[0,0,-3],ease:s.ease.quartOut}],o.vec3.lerp),"ring.transform.rotation":s.PropertyAnimation([{frame:0,value:[0,0,0,1]},{frame:.8,value:[0,0,-1,0],ease:s.ease.quadIn},{frame:1.6,value:[0,0,0,-1],ease:s.ease.quadOut}],o.quat.slerp),"ring.color":s.PropertyAnimation([{frame:.8,value:[.6,1,.9,0]},{frame:1.6,value:o.vec4.ZERO,ease:s.ease.sineOut}],o.vec4.lerp),"sphere.transform.position":s.PropertyAnimation([{frame:0,value:[0,0,-2]},{frame:.7,value:[0,0,-2.8],ease:s.ease.quadInOut}],o.vec3.lerp),"sphere.transform.scale":s.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.7,value:[2,2,2],ease:s.ease.quadIn},{frame:1,value:[0,3,0],ease:s.ease.cubicIn}],o.vec3.lerp),"distortion.transform.scale":s.PropertyAnimation([{frame:.7,value:[16,16,16]},{frame:.9,value:o.vec3.ZERO,ease:s.ease.cubicIn}],o.vec3.lerp),"distortion.color":s.PropertyAnimation([{frame:.7,value:o.vec4.ZERO},{frame:.9,value:[1,1,.5,.5],ease:s.ease.sineOut}],o.vec4.lerp)},b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.corrosion=new y.CorrosionPhase(t.context),t.range=4,t.damage=1,t}return a(t,e),t.prototype.query=function(){var e=m.DirectionTile[o.mod(this.direction+2,4)],t=o.vec2.scale(e,2,o.vec2());return o.vec2.add(this.cube.tile,t,t)},t.prototype.activate=function(e){var t,r,i,a,d,p,v,y;return n(this,(function(n){switch(n.label){case 0:this.cube.action.amount=0,t=m.DirectionAngle[o.mod(this.direction+3,4)],r=this.context.get(c.TransformSystem).create(o.vec3.AXIS_Y,t,o.vec3.ONE,this.cube.transform),this.cone=u.BatchMesh.create(h.SharedSystem.geometry.funnel),this.cone.material=h.SharedSystem.materials.effect.coneTeal,this.cone.transform=this.context.get(c.TransformSystem).create(o.vec3.AXIS_Y,t,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.cone),this.sphere=u.BatchMesh.create(h.SharedSystem.geometry.lowpolySphere),this.sphere.material=h.SharedSystem.materials.effect.coneTeal,this.sphere.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.HALF_X,o.vec3.ONE,r),this.context.get(f.ParticleEffectPass).add(this.sphere),this.glow=u.Sprite.create(2,-8),this.glow.material=h.SharedSystem.materials.sprite.sparkle,this.glow.transform=this.context.get(c.TransformSystem).create([0,0,-3],o.quat.IDENTITY,o.vec3.ONE,r),this.context.get(f.ParticleEffectPass).add(this.glow),this.ring=u.Sprite.create(0),this.ring.material=h.SharedSystem.materials.sprite.swirl,this.ring.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,r),this.context.get(f.ParticleEffectPass).add(this.ring),this.distortion=u.Sprite.create(0),this.distortion.material=h.SharedSystem.materials.distortion.wave,this.distortion.transform=this.context.get(c.TransformSystem).create([0,0,-2],o.quat.IDENTITY,o.vec3.ONE,r),this.context.get(f.PostEffectPass).add(this.distortion),this.particles=h.SharedSystem.particles.sparks.add({uLifespan:[.5,.8,-.5,0],uOrigin:o.vec3.add(o.vec3.AXIS_Y,this.cube.transform.position,o.vec3()),uLength:[.2,.5],uGravity:o.quat.transform([0,0,10],t,o.vec3()),uSize:[.2,.8],uRadius:[0,.5],uForce:[6,10],uTarget:o.quat.transform([0,-.2,.5],t,o.vec3())}),(i=g.pool.pop()||new g(this.context)).health.capacity=this.range,i.damage=this.damage,i.direction[0]=Math.sign(e[0]-this.cube.tile[0]),i.direction[1]=Math.sign(e[1]-this.cube.tile[1]),i.place(e[0],e[1]),this.corrosion.add(i),a=o.quat.transform([0,1,-3],r.rotation,o.vec3()),o.vec3.add(this.cube.transform.position,a,a),this.context.get(m.TurnBasedSystem).enqueue(i.appear(a,.8),!0),d=s.AnimationTimeline(this,x),this.context.get(l.AudioSystem).create("assets/"+this.mesh.armature.key+"_use.mp3","sfx",this.mesh.transform).play(0),p=1.6,v=this.context.currentTime,n.label=1;case 1:return y=this.context.currentTime-v,d(y,this.context.deltaTime),y>p?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(c.TransformSystem).delete(r),this.context.get(c.TransformSystem).delete(this.cone.transform),this.context.get(c.TransformSystem).delete(this.glow.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.sphere.transform),this.context.get(c.TransformSystem).delete(this.distortion.transform),this.context.get(f.ParticleEffectPass).remove(this.cone),this.context.get(f.ParticleEffectPass).remove(this.glow),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.ParticleEffectPass).remove(this.sphere),this.context.get(f.PostEffectPass).remove(this.distortion),h.SharedSystem.particles.bolts.remove(this.particles),u.BatchMesh.delete(this.cone),u.BatchMesh.delete(this.sphere),u.Sprite.delete(this.glow),u.Sprite.delete(this.ring),u.Sprite.delete(this.distortion),[2]}}))},t}(v.CubeSkill);t.CorrosiveOrbSkill=b},8137:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CubeSkill=void 0;var o=r(4454),s=r(6725),c=r(6365),l=r(7822),u=function(e){function t(t,r){var i=e.call(this,t)||this;return i.cube=r,i.group=2,i}return a(t,e),Object.defineProperty(t.prototype,"direction",{get:function(){return o.mod(this.cube.direction+this.cube.sides[this.cube.side].direction,4)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this.cube.meshes[this.cube.side]},enumerable:!1,configurable:!0}),t.prototype.open=function(){var e,t,r,i,a,o,u;return n(this,(function(n){switch(n.label){case 0:if(!this.validate())return[2];e=this.cube.sides[this.cube.side],t=this.cube.meshes[this.cube.side],r=l.ModelAnimation("open"),null===(u=this.context.get(c.AudioSystem).create("assets/"+t.armature.key+"_open.mp3","sfx",this.mesh.transform))||void 0===u||u.play(0),i=.8,a=this.context.currentTime,n.label=1;case 1:return o=this.context.currentTime-a,r(o/i,t.armature),o>i?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return e.open=1,[2]}}))},t.prototype.close=function(){var e,t,r,i,a,o,u;return n(this,(function(n){switch(n.label){case 0:e=this.cube.sides[this.cube.side],t=this.cube.meshes[this.cube.side],r=l.ModelAnimation("open"),null===(u=this.context.get(c.AudioSystem).create("assets/"+t.armature.key+"_close.mp3","sfx",this.mesh.transform))||void 0===u||u.play(0),i=.8,a=this.context.currentTime,n.label=1;case 1:return o=this.context.currentTime-a,r(1-o/i,t.armature),o>i?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return e.open=0,this.clear(),[2]}}))},t.prototype.update=function(){},t.prototype.validate=function(){return!0},t.prototype.clear=function(){},t.prototype.query=function(e){return null},t}(r(6888).UnitSkill);t.CubeSkill=u},9634:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.DetonateSkill=void 0;var o=r(4454),s=r(296),c=r(8581),l=r(9336),u=r(6365),f=r(6725),h=r(7822),m=r(8137),d=r(7185),p=r(9131),v={"mesh.armature":h.ModelAnimation("activate"),dust:f.EventTrigger([{frame:1,value:48}],f.EventTrigger.emit),"light.radius":f.PropertyAnimation([{frame:1,value:0},{frame:1.5,value:8,ease:f.ease.cubicOut}],o.lerp),"light.intensity":f.PropertyAnimation([{frame:1,value:8},{frame:1.5,value:0,ease:f.ease.quadOut}],o.lerp),"stamp.transform.scale":f.PropertyAnimation([{frame:1,value:[10,4,10]}],o.vec3.lerp),"stamp.threshold":f.PropertyAnimation([{frame:.9,value:2.5},{frame:1.3,value:0,ease:f.ease.quadOut},{frame:2,value:-2.5,ease:f.ease.sineIn}],o.lerp),"tube.transform.scale":f.PropertyAnimation([{frame:0,value:[0,2,0]},{frame:1.2,value:[2.6,7,2.6],ease:f.ease.cubicOut}],o.vec3.lerp),"tube.color":f.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:1.2,value:o.vec4.ZERO,ease:f.ease.quartIn}],o.vec4.lerp),"chargeX.transform.scale":f.PropertyAnimation([{frame:0,value:[12,2,2]}],o.vec3.lerp),"chargeY.transform.scale":f.PropertyAnimation([{frame:0,value:[12,2,2]}],o.vec3.lerp),"chargeX.threshold":f.PropertyAnimation([{frame:0,value:3},{frame:.7,value:0,ease:f.ease.sineIn},{frame:1.4,value:-3,ease:f.ease.sineOut}],o.lerp),"chargeY.threshold":f.PropertyAnimation([{frame:0,value:3},{frame:.7,value:0,ease:f.ease.sineIn},{frame:1.4,value:-3,ease:f.ease.sineOut}],o.lerp),"beam.transform.scale":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.9,value:[2,7,1],ease:f.ease.sineIn}],o.vec3.lerp),"beam.color":f.PropertyAnimation([{frame:.9,value:[1,.5,.6,0]},{frame:1.4,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp)},y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minefield=new d.Minefield(t.context),t.damage=2,t}return a(t,e),t.prototype.query=function(){return this.cube.tile},t.placeMine=function(e,t){var r=e.minefield.create(t[0],t[1]);r&&(r.damage=e.damage)},t.prototype.activate=function(e){var r,i,a,m,d;return n(this,(function(n){switch(n.label){case 0:this.cube.action.amount=0,this.tube=c.BatchMesh.create(h.SharedSystem.geometry.cylinder),this.tube.material=h.SharedSystem.materials.effect.stripesRed,this.tube.transform=this.context.get(l.TransformSystem).create([0,3,0],o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.context.get(s.ParticleEffectPass).add(this.tube),this.stamp=this.context.get(s.DecalPass).create(0),this.stamp.material=h.SharedSystem.materials.stampMaterial,this.stamp.transform=this.context.get(l.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.chargeX=this.context.get(s.DecalPass).create(0),this.chargeX.material=h.SharedSystem.materials.glowSquaresLinearMaterial,this.chargeX.transform=this.context.get(l.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.chargeY=this.context.get(s.DecalPass).create(0),this.chargeY.material=h.SharedSystem.materials.glowSquaresLinearMaterial,this.chargeY.transform=this.context.get(l.TransformSystem).create(o.vec3.ZERO,p.DirectionAngle[0],o.vec3.ONE,this.cube.transform),this.beam=c.Sprite.create(3,0,o.vec4.ONE,[0,.5]),this.beam.material=h.SharedSystem.materials.sprite.beam,this.beam.transform=this.context.get(l.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.context.get(s.ParticleEffectPass).add(this.beam),this.light=this.context.get(s.PointLightPass).create([1,0,.2]),this.light.transform=this.context.get(l.TransformSystem).create([0,2,0],o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.dust=h.SharedSystem.particles.dust.add({uOrigin:this.cube.transform.position,uTarget:o.vec3.ZERO,uOrientation:o.quat.IDENTITY,uLifespan:[.5,1,0,0],uSize:[3,6],uRadius:[.5,1],uForce:[6,12],uGravity:[0,9.8,0],uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]}),r=f.EventTrigger([{frame:1,value:e}],t.placeMine),i=f.AnimationTimeline(this,v),this.context.get(u.AudioSystem).create("assets/"+this.mesh.armature.key+"_use.mp3","sfx",this.mesh.transform).play(.4),a=2,m=this.context.currentTime,n.label=1;case 1:return d=this.context.currentTime-m,i(d,this.context.deltaTime),r(d,this.context.deltaTime,this),d>a?[3,5]:[3,2];case 2:return[4,f.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(l.TransformSystem).delete(this.chargeX.transform),this.context.get(l.TransformSystem).delete(this.chargeY.transform),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.beam.transform),this.context.get(l.TransformSystem).delete(this.stamp.transform),this.context.get(l.TransformSystem).delete(this.tube.transform),this.context.get(s.DecalPass).delete(this.chargeX),this.context.get(s.DecalPass).delete(this.chargeY),this.context.get(s.DecalPass).delete(this.stamp),h.SharedSystem.particles.dust.remove(this.dust),this.context.get(s.PointLightPass).delete(this.light),this.context.get(s.ParticleEffectPass).remove(this.beam),this.context.get(s.ParticleEffectPass).remove(this.tube),c.BatchMesh.delete(this.tube),c.Sprite.delete(this.beam),[2]}}))},t}(m.CubeSkill);t.DetonateSkill=y},5983:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExtractSkill=void 0;var o=r(4454),s=r(6725),c=r(9336),l=r(6365),u=r(8581),f=r(296),h=r(7822),m=r(9131),d=r(3605),p=r(8967),v=r(8137),y={"mesh.armature":h.ModelAnimation("loop"),"cube.light.intensity":s.PropertyAnimation([{frame:.8,value:1},{frame:1.2,value:3,ease:s.ease.quadIn},{frame:1.6,value:1,ease:s.ease.sineOut}],o.lerp),"glow.transform.scale":s.PropertyAnimation([{frame:1,value:[1,0,1]},{frame:1.8,value:[1,4,1],ease:s.ease.quadOut}],o.vec3.lerp),"glow.color":s.PropertyAnimation([{frame:1,value:[.89,.93,.64,0]},{frame:1.8,value:o.vec4.ZERO,ease:s.ease.sineOut}],o.vec4.lerp),"ring.transform.scale":s.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1,value:[2,2,2],ease:s.ease.quadIn},{frame:1.6,value:[4,4,4],ease:s.ease.cubicOut}],o.vec3.lerp),"ring.color":s.PropertyAnimation([{frame:1,value:[.12,.1,.16,.8]},{frame:1.6,value:o.vec4.ZERO,ease:s.ease.sineIn}],o.vec4.lerp),"beam.transform.scale":s.PropertyAnimation([{frame:.2,value:[1,0,1]},{frame:.8,value:[1,4,1],ease:s.ease.quadOut}],o.vec3.lerp),"beam.color":s.PropertyAnimation([{frame:.8,value:[.89,.93,.64,0]},{frame:1,value:o.vec4.ZERO,ease:s.ease.sineIn}],o.vec4.lerp),"tube.transform.scale":s.PropertyAnimation([{frame:0,value:[4,-10,4]},{frame:.8,value:[2,-8,2],ease:s.ease.sineOut}],o.vec3.lerp),"tube.color":s.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:.8,value:[.4,1,.8,1],ease:s.ease.cubicOut},{frame:1.2,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp),"cracks.transform.scale":s.PropertyAnimation([{frame:0,value:[16,4,16]}],o.vec3.lerp),"cracks.threshold":s.PropertyAnimation([{frame:1,value:-3},{frame:1.4,value:0,ease:s.ease.quadOut},{frame:1.8,value:3,ease:s.ease.cubicIn}],o.lerp),"cracks.color":s.PropertyAnimation([{frame:1.2,value:[.92,.94,.74,0]},{frame:1.8,value:o.vec3.ZERO,ease:s.ease.sineIn}],o.vec4.lerp),"cracks.transform.rotation":s.EventTrigger([{frame:0,value:null}],(function(e){return o.quat.axisAngle(o.vec3.AXIS_Y,2*Math.PI*h.SharedSystem.random(),e)})),"smoke.rate":s.PropertyAnimation([{frame:0,value:.05},{frame:.5,value:.01,ease:s.ease.quadIn},{frame:1,value:0,ease:s.ease.stepped}],o.lerp)},g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.indicator={capacity:4,amount:0},t}return a(t,e),t.prototype.query=function(){return this.cube.tile},t.prototype.update=function(){this.deposit=this.context.get(p.EconomySystem).get(this.cube.tile[0],this.cube.tile[1]),this.indicator.amount=this.deposit?Math.floor(this.deposit.amount*this.indicator.capacity):0},t.prototype.open=function(){var t,r,i,a,o;return n(this,(function(n){switch(n.label){case 0:t=s.EventTrigger([{frame:.6,value:{amount:36,uOrigin:this.cube.transform.position}}],s.EventTrigger.emitReset),r=e.prototype.open.call(this),i=this.context.currentTime,n.label=1;case 1:return a=this.context.currentTime-i,t(a,this.context.deltaTime,this.cube.dust),(o=r.next()).done?[2,o.value]:[3,2];case 2:return[4,o.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return[2]}}))},t.prototype.activate=function(e){var t,r,i,a;return n(this,(function(e){switch(e.label){case 0:this.cube.action.amount=0,this.cracks=this.context.get(f.DecalPass).create(0),this.cracks.material=h.SharedSystem.materials.cracksMaterial,this.cracks.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.tube=u.BatchMesh.create(h.SharedSystem.geometry.cylinder),this.tube.material=h.SharedSystem.materials.effect.stripesRed,this.tube.transform=this.context.get(c.TransformSystem).create([0,4,0],o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.tube),this.beam=u.Sprite.create(3,0,o.vec4.ONE,[0,.5]),this.beam.material=h.SharedSystem.materials.sprite.beam,this.beam.transform=this.context.get(c.TransformSystem).create([0,4,0],o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.beam),this.glow=u.BatchMesh.create(h.SharedSystem.geometry.cross),this.glow.material=h.SharedSystem.materials.gradientMaterial,this.glow.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.glow),this.ring=u.Sprite.create(0),this.ring.material=h.SharedSystem.materials.sprite.ring,this.ring.transform=this.context.get(c.TransformSystem).create([0,4,0],o.quat.HALF_N_X,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.ring),this.smoke=this.smoke||h.SharedSystem.particles.smoke.add({uLifespan:[1,2,0,0],uOrigin:o.vec3.add([0,4,0],this.cube.transform.position,o.vec3()),uRotation:[0,2*Math.PI],uGravity:[0,5.6,0],uSize:[1,4],uFieldDomain:[.4,.4,.4,0],uFieldStrength:[4,0]}),t=s.AnimationTimeline(this,y),this.deposit&&this.indicator.amount&&(this.indicator.amount--,this.context.get(s.AnimationSystem).start(this.deposit.drain(1,1/this.indicator.capacity),!0),this.cube.matter.amount=Math.min(this.cube.matter.capacity,this.cube.matter.amount+1)),this.context.get(l.AudioSystem).create("assets/"+this.mesh.armature.key+"_use.mp3","sfx",this.mesh.transform).play(0),r=2,i=this.context.currentTime,e.label=1;case 1:return a=this.context.currentTime-i,t(a,this.context.deltaTime),a>r?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:e.sent(),e.label=4;case 4:return[3,1];case 5:return this.context.get(c.TransformSystem).delete(this.cracks.transform),this.context.get(c.TransformSystem).delete(this.tube.transform),this.context.get(c.TransformSystem).delete(this.beam.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.glow.transform),this.context.get(f.ParticleEffectPass).remove(this.tube),this.context.get(f.ParticleEffectPass).remove(this.beam),this.context.get(f.ParticleEffectPass).remove(this.glow),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.DecalPass).delete(this.cracks),u.BatchMesh.delete(this.glow),u.BatchMesh.delete(this.tube),u.Sprite.delete(this.beam),u.Sprite.delete(this.ring),[2]}}))},t.prototype.validate=function(){for(var e=this.context.get(d.TerrainSystem),t=this.cube.tile,r=m.DirectionTile.length-1;r>=0;r--)if(null!=e.getTile(t[0]+m.DirectionTile[r][0],t[1]+m.DirectionTile[r][1]))return!1;for(r=m.DirectionTile.length-1;r>=0;r--){var i=o.vec2.add(t,m.DirectionTile[r],o.vec2());e.setTile(i[0],i[1],this.cube),this.cube.tiles.push(i)}return!0},t.prototype.clear=function(){this.smoke&&(this.smoke=void h.SharedSystem.particles.smoke.remove(this.smoke));for(var e=this.context.get(d.TerrainSystem);this.cube.tiles.length>1;){var t=this.cube.tiles.pop();e.setTile(t[0],t[1],null)}},t}(v.CubeSkill);t.ExtractSkill=g},7185:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Minefield=t.LandMine=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(6725),f=r(296),h=r(7822),m=r(3605),d=r(9131),p=r(6888),v={"spark.transform.scale":u.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.2,value:[16,16,16],ease:u.ease.quintOut}],o.vec3.lerp),"spark.color":u.PropertyAnimation([{frame:0,value:[1,.8,.8,0]},{frame:.2,value:o.vec3.ZERO,ease:u.ease.sineIn}],o.vec4.lerp),"core.transform.scale":u.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.6,value:[4,4,4],ease:u.ease.quintOut}],o.vec3.lerp),"core.color":u.PropertyAnimation([{frame:.4,value:o.vec4.ONE},{frame:.6,value:o.vec4.ZERO,ease:u.ease.quadOut}],o.vec4.lerp),"ring.transform.scale":u.PropertyAnimation([{frame:0,value:[0,5,0]},{frame:.8,value:[10,5,10],ease:u.ease.quartOut}],o.vec3.lerp),"ring.color":u.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.8,value:[1,1,1,0],ease:u.ease.linear}],o.vec4.lerp),"light.radius":u.PropertyAnimation([{frame:0,value:0},{frame:.4,value:12,ease:u.ease.quintOut}],o.lerp),"light.intensity":u.PropertyAnimation([{frame:0,value:6},{frame:.4,value:0,ease:u.ease.sineIn}],o.lerp),"perimeter.transform.scale":u.PropertyAnimation([{frame:0,value:[0,4,0]},{frame:.5,value:[18,4,18],ease:u.ease.expoOut}],o.vec3.lerp),"perimeter.color":u.PropertyAnimation([{frame:0,value:[1,.8,.5,.5]},{frame:.5,value:[0,0,0,.5],ease:u.ease.cubicIn},{frame:2,value:o.vec4.ZERO,ease:u.ease.quadIn}],o.vec4.lerp),"wave.transform.scale":u.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.3,value:[20,20,20],ease:u.ease.quartOut}],o.vec3.lerp),"wave.color":u.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.3,value:o.vec4.ZERO,ease:u.ease.sineIn}],o.vec4.lerp),"burn.transform.scale":u.PropertyAnimation([{frame:0,value:[8,2,8]}],o.vec3.lerp),"burn.color":u.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:.8,value:[0,0,0,1],ease:u.ease.cubicIn},{frame:3,value:o.vec4.ZERO,ease:u.ease.quadIn}],o.vec4.lerp),smoke:u.EventTrigger([{frame:0,value:36}],u.EventTrigger.emit),particles:u.EventTrigger([{frame:0,value:64}],u.EventTrigger.emit),"pillar.color":u.PropertyAnimation([{frame:0,value:[1,.5,.6,.8]},{frame:.2,value:o.vec4.ZERO,ease:u.ease.quadOut}],o.vec4.lerp)},y={"pillar.transform.scale":u.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.5,value:[2,5,2],ease:u.ease.quadOut}],o.vec3.lerp),"pillar.color":u.PropertyAnimation([{frame:0,value:[1,.5,.6,.8]}],o.vec4.lerp),"circle.transform.scale":u.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.5,value:[4,4,4],ease:u.ease.cubicOut}],o.vec3.lerp),"circle.color":u.PropertyAnimation([{frame:0,value:[1,.5,.7,1]},{frame:.5,value:o.vec4.ZERO,ease:u.ease.sineIn}],o.vec4.lerp)},g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tile=o.vec2(),t.damageType=5,t.group=2,t.minRange=0,t.range=4,t.damage=2,t.triggered=!1,t}return a(t,e),t.prototype.place=function(e,t){o.vec2.set(e,t,this.tile),this.mesh=this.context.get(s.MeshSystem).loadModel("mine"),this.mesh.transform=this.context.get(c.TransformSystem).create(),this.context.get(m.TerrainSystem).tilePosition(e,t,this.mesh.transform.position)},t.prototype.delete=function(){this.triggered=!1,this.context.get(c.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),this.pillar&&(this.context.get(c.TransformSystem).delete(this.pillar.transform),this.context.get(f.ParticleEffectPass).remove(this.pillar),this.pillar=void s.Sprite.delete(this.pillar)),t.pool.push(this)},t.prototype.trigger=function(){var e,t,r,i;return n(this,(function(a){switch(a.label){case 0:this.triggered=!0,this.pillar=s.Sprite.create(3,0,o.vec4.ONE,[0,.5]),this.pillar.material=h.SharedSystem.materials.sprite.beam,this.pillar.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.pillar),this.circle=s.Sprite.create(0),this.circle.material=h.SharedSystem.materials.sprite.ring,this.circle.transform=this.context.get(c.TransformSystem).create(o.vec3.AXIS_Y,o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.circle),e=u.AnimationTimeline(this,y),this.context.get(l.AudioSystem).create("assets/cube_5_trigger.mp3","sfx",this.mesh.transform).play(0),t=.5,r=this.context.currentTime,a.label=1;case 1:return i=this.context.currentTime-r,e(i,this.context.deltaTime),i>t?[3,5]:[3,2];case 2:return[4,u.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:return this.context.get(c.TransformSystem).delete(this.circle.transform),this.context.get(f.ParticleEffectPass).remove(this.circle),s.Sprite.delete(this.circle),[2]}}))},t.prototype.detonate=function(){var e,t,r,i,a,m,d;return n(this,(function(n){switch(n.label){case 0:o.vec4.copy(o.vec4.ZERO,this.mesh.color),e=this.mesh.transform.position,t=o.vec3(),this.core=s.BatchMesh.create(h.SharedSystem.geometry.lowpoly.sphere,4),this.core.material=h.SharedSystem.materials.effect.coreWhite,this.core.transform=this.context.get(c.TransformSystem).create(e),this.context.get(f.ParticleEffectPass).add(this.core),this.wave=s.Sprite.create(0),this.wave.material=h.SharedSystem.materials.distortion.ring,this.wave.transform=this.context.get(c.TransformSystem).create(o.vec3.add([0,2,0],e,t),o.quat.HALF_N_X,o.vec3.ONE),this.context.get(f.PostEffectPass).add(this.wave),this.ring=s.BatchMesh.create(h.SharedSystem.geometry.cylinder),this.ring.material=h.SharedSystem.materials.effect.ringDust,this.ring.transform=this.context.get(c.TransformSystem).create(e),this.context.get(f.ParticleEffectPass).add(this.ring),this.spark=s.Sprite.create(2),this.spark.material=h.SharedSystem.materials.sprite.rays,this.spark.transform=this.context.get(c.TransformSystem).create(o.vec3.add(o.vec3.AXIS_Y,e,t)),this.context.get(f.ParticleEffectPass).add(this.spark),this.burn=this.context.get(f.DecalPass).create(0),this.burn.material=h.SharedSystem.materials.decal.glow,this.burn.transform=this.context.get(c.TransformSystem).create(e),this.perimeter=this.context.get(f.DecalPass).create(0),this.perimeter.material=h.SharedSystem.materials.decal.halo,this.perimeter.transform=this.context.get(c.TransformSystem).create(e),this.smoke=h.SharedSystem.particles.smoke.add({uLifespan:[1.5,2,-.5,0],uOrigin:o.vec3.add([0,-.8,0],e,t),uRotation:[0,2*Math.PI],uGravity:[0,4.8,0],uSize:[2,6],uFieldDomain:[.2,.2,.2,0],uFieldStrength:[8,0]}),this.particles=h.SharedSystem.particles.embers.add({uLifespan:[.6,.9,-.3,0],uOrigin:e,uRotation:o.vec2.ZERO,uGravity:o.vec3(0,3*-9.8,0),uSize:[.2,.8],uRadius:[.5,1],uOrientation:o.quat.IDENTITY,uForce:[14,28],uTarget:[0,-.5,0]}),this.light=this.context.get(f.PointLightPass).create([1,.5,.5]),this.light.transform=this.context.get(c.TransformSystem).create(o.vec3.add([0,2,0],e,t)),r=u.EventTrigger(p.UnitSkill.queryArea(this.context,this.tile,this.minRange,this.range,this.group).map((function(e){return{frame:.4,value:e}})),p.UnitSkill.damage),i=u.AnimationTimeline(this,v),this.context.get(l.AudioSystem).create("assets/cube_5_explode.mp3","sfx",this.mesh.transform).play(0),a=3,m=this.context.currentTime,n.label=1;case 1:return d=this.context.currentTime-m,i(d,this.context.deltaTime),r(d,this.context.deltaTime,this),d>a?[3,5]:[3,2];case 2:return[4,u.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.spark.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.perimeter.transform),this.context.get(c.TransformSystem).delete(this.light.transform),this.context.get(c.TransformSystem).delete(this.core.transform),this.context.get(c.TransformSystem).delete(this.burn.transform),h.SharedSystem.particles.smoke.remove(this.smoke),h.SharedSystem.particles.embers.remove(this.particles),this.context.get(f.PostEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.spark),this.context.get(f.ParticleEffectPass).remove(this.core),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.DecalPass).delete(this.burn),this.context.get(f.DecalPass).delete(this.perimeter),s.BatchMesh.delete(this.core),s.BatchMesh.delete(this.ring),s.Sprite.delete(this.spark),s.Sprite.delete(this.wave),this.context.get(c.TransformSystem).delete(this.pillar.transform),this.context.get(f.ParticleEffectPass).remove(this.pillar),this.pillar=void s.Sprite.delete(this.pillar),this.delete(),[2]}}))},t.pool=[],t}(p.UnitSkill);t.LandMine=g;var x=function(){function e(e){var t=this;this.context=e,this.order=3,this.list=[],this.context.get(d.TurnBasedSystem).add(this),this.context.get(d.TurnBasedSystem).signalEnterTile.add((function(e,r,i){if(i instanceof p.AIUnit){var a=t.get(e,r);a&&!a.triggered&&(a.triggered=!0,t.context.get(d.TurnBasedSystem).enqueue(a.trigger(),!0))}})),this.context.get(d.TurnBasedSystem).signalReset.add((function(){for(;t.list.length;)t.list.pop().delete()}))}return e.prototype.execute=function(){for(var e=this.context.get(m.TerrainSystem).bounds,t=[],r=this.list.length-1;r>=0;r--){var i=this.list[r];if(o.aabb2.inside(e,i.tile)){if(!i.triggered)continue;t.push(i.detonate())}else i.delete();this.list.splice(r,1)}return t.length?u.AnimationSystem.zip(t):null},e.prototype.get=function(e,t){for(var r=this.list.length-1;r>=0;r--)if(this.list[r].tile[0]===e&&this.list[r].tile[1]===t)return this.list[r]},e.prototype.create=function(e,t){if(this.get(e,t))return null;var r=g.pool.pop()||new g(this.context);return r.place(e,t),this.list.push(r),r},e}();t.Minefield=x},9087:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectileSkill=void 0;var s=r(4454),c=r(8581),l=r(296),u=r(9336),f=r(6365),h=r(6725),m=r(9131),d=r(7822),p=r(3605),v=r(8137),y={"sphere.color":h.PropertyAnimation([{frame:.1,value:s.vec4.ONE},{frame:.6,value:s.vec4.ZERO,ease:h.ease.cubicIn}],s.vec4.lerp),"sphere.transform.scale":h.PropertyAnimation([{frame:.1,value:s.vec3.ZERO},{frame:.6,value:[1.8,1.8,1.8],ease:h.ease.cubicOut}],s.vec3.lerp),"glow.color":h.PropertyAnimation([{frame:0,value:[1,.9,.6,0]},{frame:.3,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),"glow.transform.scale":h.PropertyAnimation([{frame:0,value:s.vec3.ZERO},{frame:.3,value:[8,8,8],ease:h.ease.quartOut}],s.vec3.lerp),"burn.transform.scale":h.PropertyAnimation([{frame:0,value:s.vec3.ZERO},{frame:.1,value:[8,4,8],ease:h.ease.cubicOut}],s.vec3.lerp),"burn.color":h.PropertyAnimation([{frame:1,value:[0,0,0,1]},{frame:2,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"light.radius":h.PropertyAnimation([{frame:0,value:0},{frame:.3,value:4,ease:h.ease.cubicOut}],s.lerp),"light.intensity":h.PropertyAnimation([{frame:0,value:8},{frame:.3,value:0,ease:h.ease.sineIn}],s.lerp),"wave.transform.scale":h.PropertyAnimation([{frame:.1,value:s.vec3.ZERO},{frame:.4,value:[8,8,8],ease:h.ease.quartOut}],s.vec3.lerp),"wave.color":h.PropertyAnimation([{frame:.1,value:[1,1,1,.4]},{frame:.4,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),embers:h.EventTrigger([{frame:0,value:72}],h.EventTrigger.emit)},g={"mesh.armature":d.ModelAnimation("activate"),particles:h.EventTrigger([{frame:0,value:36}],h.EventTrigger.emit),"bulge.transform.scale":h.PropertyAnimation([{frame:0,value:s.vec3.ZERO},{frame:.5,value:[3,3,3],ease:h.ease.quartOut}],s.vec3.lerp),"bulge.color":h.PropertyAnimation([{frame:0,value:s.vec4.ONE},{frame:.5,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),"flash.transform.scale":h.PropertyAnimation([{frame:0,value:s.vec3.ZERO},{frame:.5,value:[4,4,4],ease:h.ease.cubicOut}],s.vec3.lerp),"flash.color":h.PropertyAnimation([{frame:.2,value:s.vec4.ONE},{frame:.5,value:[1,1,1,.2],ease:h.ease.sineIn}],s.vec4.lerp),"core.transform.scale":h.PropertyAnimation([{frame:0,value:s.vec3.ZERO},{frame:.1,value:[4,4,4],ease:h.ease.cubicIn},{frame:.3,value:s.vec3.ZERO,ease:h.ease.quadOut}],s.vec3.lerp),"core.color":h.PropertyAnimation([{frame:0,value:[1,1,.8,0]},{frame:.3,value:[.6,.6,0,0],ease:h.ease.quadIn}],s.vec4.lerp),"light.radius":h.PropertyAnimation([{frame:0,value:0},{frame:.5,value:5,ease:h.ease.quartOut}],s.lerp),"light.intensity":h.PropertyAnimation([{frame:0,value:0},{frame:.1,value:4,ease:h.ease.quadIn},{frame:.5,value:0,ease:h.ease.cubicOut}],s.lerp)},x=function(){function e(e,t){this.context=e,this.parent=t,this.origin=s.vec3(),this.target=s.vec3()}return e.prototype.play=function(e,t){var r,i,a,f,m,g;return o(this,(function(o){switch(o.label){case 0:this.context.get(p.TerrainSystem).tilePosition(t[0],t[1],this.target),s.mat4.transform(s.vec3.ZERO,e,this.origin),this.transform=this.context.get(u.TransformSystem).create(this.origin),this.trail=c.Line.create(8,-2,.4,h.ease.reverse(h.ease.quadIn),!0),this.trail.material=d.SharedSystem.materials.sprite.lineYellow,this.context.get(l.ParticleEffectPass).add(this.trail),this.sphere=c.BatchMesh.create(d.SharedSystem.geometry.lowpoly.sphere,8),this.sphere.material=d.SharedSystem.materials.effect.coreYellow,this.sphere.transform=this.context.get(u.TransformSystem).create(this.target),this.context.get(l.ParticleEffectPass).add(this.sphere),this.glow=c.Sprite.create(0),this.glow.material=d.SharedSystem.materials.sprite.halo,this.glow.transform=this.context.get(u.TransformSystem).create(this.target,s.quat.HALF_N_X),this.context.get(l.ParticleEffectPass).add(this.glow),this.wave=c.Sprite.create(0),this.wave.material=d.SharedSystem.materials.displacement.wave,this.wave.transform=this.context.get(u.TransformSystem).create(this.target,s.quat.HALF_N_X),this.context.get(l.PostEffectPass).add(this.wave),this.burn=this.context.get(l.DecalPass).create(0),this.burn.material=d.SharedSystem.materials.decal.particle,this.burn.transform=this.context.get(u.TransformSystem).create(this.target),this.light=this.context.get(l.PointLightPass).create([1,.9,.5]),this.light.transform=this.context.get(u.TransformSystem).create(this.target),this.light.transform.position[1]+=.5,this.embers=d.SharedSystem.particles.embers.add({uLifespan:[.2,.4,-.2,0],uOrigin:this.target,uRotation:s.vec2.ZERO,uOrientation:s.quat.IDENTITY,uGravity:s.vec3(0,-19.6,0),uSize:[.2,.6],uRadius:[.2,.5],uForce:[8,16],uTarget:[0,-.2,0]}),r=.025*Math.sqrt(s.vec3.distanceSquared(this.origin,this.target)),i=h.EventTrigger([{frame:0,value:t}],v.CubeSkill.damage),a=h.AnimationTimeline(this,n(n({},y),{trail:h.FollowPath.Line(h.FollowPath.separate(h.PropertyAnimation([{frame:-r,value:this.origin[0]},{frame:0,value:this.target[0],ease:h.ease.linear}],s.lerp),h.PropertyAnimation([{frame:-r,value:this.origin[1]},{frame:0,value:this.target[1],ease:h.ease.cubicIn}],s.lerp),h.PropertyAnimation([{frame:-r,value:this.origin[2]},{frame:0,value:this.target[2],ease:h.ease.linear}],s.lerp)),{length:.06}),"transform.position.1":h.PropertyAnimation([{frame:-r,value:this.origin[1]},{frame:0,value:this.target[1],ease:h.ease.cubicIn}],s.lerp),"transform.position":h.PropertyAnimation([{frame:-r,value:this.origin},{frame:0,value:this.target,ease:h.ease.linear}],s.vec3.lerp)})),f=2,m=this.context.currentTime+r,o.label=1;case 1:return g=this.context.currentTime-m,a(g,this.context.deltaTime),i(g,this.context.deltaTime,this.parent),g>f?[3,5]:[3,2];case 2:return[4,h.ActionSignal.WaitNextFrame];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return this.context.get(u.TransformSystem).delete(this.transform),this.context.get(u.TransformSystem).delete(this.glow.transform),this.context.get(u.TransformSystem).delete(this.burn.transform),this.context.get(u.TransformSystem).delete(this.light.transform),this.context.get(u.TransformSystem).delete(this.sphere.transform),this.context.get(u.TransformSystem).delete(this.wave.transform),d.SharedSystem.particles.embers.remove(this.embers),this.context.get(l.PointLightPass).delete(this.light),this.context.get(l.ParticleEffectPass).remove(this.sphere),this.context.get(l.ParticleEffectPass).remove(this.glow),this.context.get(l.ParticleEffectPass).remove(this.trail),this.context.get(l.DecalPass).delete(this.burn),this.context.get(l.PostEffectPass).remove(this.wave),c.Sprite.delete(this.wave),c.Sprite.delete(this.glow),c.BatchMesh.delete(this.sphere),c.Line.delete(this.trail),this.parent.pool.push(this),[2]}}))},e.fade=function(e){return 1-Math.pow(1-e*(1-e)*4,2)},e}(),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pool=[],t.damageType=1,t.damage=1,t.range=4,t.indicator={capacity:4,amount:4},t.pivot=s.vec3(0,1.8,0),t}return a(t,e),t.prototype.update=function(){this.indicator.amount=this.indicator.capacity},t.prototype.clear=function(){this.indicator.amount<this.indicator.capacity&&(this.cube.action.amount=0)},t.prototype.query=function(e){if(-1!==e&&this.indicator.amount){for(var t=this.cube.tile,r=s.vec2(),i=this.context.get(p.TerrainSystem),a=m.DirectionTile[e],n=1;n<=this.range;n++)if(s.vec2.scale(a,n,r),s.vec2.add(t,r,r),null!=i.getTile(r[0],r[1]))return r;return r}},t.prototype.activate=function(e,t){var r,i,a,n,p,v,y,b,S,P,O,T;return o(this,(function(o){switch(o.label){case 0:if(--this.indicator.amount<=0&&(this.cube.action.amount=0),r=s.mod(t-this.cube.direction-this.cube.sides[this.cube.side].direction,4),i=s.mat4.fromRotationTranslationScale(m.DirectionAngle[(t+3)%4],this.pivot,s.vec3.ONE,s.mat4()),s.mat4.multiply(this.cube.transform.matrix,i,i),a=s.vec3(0,0,1.2),s.mat4.transform(a,i,a),n=s.quat.copy(this.mesh.armature.nodes[1].rotation,s.quat()),p=m.DirectionAngle[(r+1)%4],s.quat.angle(n,p)<.001)return[3,4];v=h.PropertyAnimation([{frame:0,value:n},{frame:.2,value:p,ease:h.ease.quadInOut}],s.quat.slerp),P=.2,O=this.context.currentTime,o.label=1;case 1:return T=this.context.currentTime-O,v(T,this.mesh.armature.nodes[1].rotation),this.mesh.armature.frame=0,T>P?[3,4]:[4,h.ActionSignal.WaitNextFrame];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:this.light=this.context.get(l.PointLightPass).create([1,.9,.5]),this.light.transform=this.context.get(u.TransformSystem).create(a,m.DirectionAngle[(t+3)%4]),this.bulge=c.Sprite.create(2),this.bulge.material=d.SharedSystem.materials.distortion.particle,this.bulge.transform=this.context.get(u.TransformSystem).create(a),this.context.get(l.PostEffectPass).add(this.bulge),this.core=c.Sprite.create(2),this.core.material=d.SharedSystem.materials.sprite.rays,this.core.transform=this.context.get(u.TransformSystem).create(a),this.context.get(l.ParticleEffectPass).add(this.core),this.flash=c.Sprite.create(0),this.flash.material=d.SharedSystem.materials.effect.flashYellow,this.flash.transform=this.context.get(u.TransformSystem).create(),this.flash.transform.parent=this.light.transform,this.context.get(l.ParticleEffectPass).add(this.flash),this.particles=d.SharedSystem.particles.embers.add({uLifespan:[.1,.4,-.1,0],uOrigin:s.mat4.transform([0,0,2],i,s.vec3()),uRotation:s.vec2.ZERO,uGravity:s.vec3.ZERO,uSize:[.1,.6],uRadius:[0,.4],uOrientation:s.quat.axisAngle(s.quat.transform(s.vec3.AXIS_Z,m.DirectionAngle[t],s.vec3()),.5*Math.PI,s.quat()),uForce:[8,16],uTarget:s.mat4.transformNormal([0,0,-2],i,s.vec3())}),y=h.AnimationTimeline(this,g),b=d.ModelAnimation("activate"+r),S=this.pool.pop()||new x(this.context,this),this.context.get(m.TurnBasedSystem).enqueue(S.play(i,e),!0),this.context.get(f.AudioSystem).create("assets/"+this.mesh.armature.key+"_use.mp3","sfx",this.mesh.transform).play(0),P=.5,O=this.context.currentTime,o.label=5;case 5:return T=this.context.currentTime-O,y(T,this.context.deltaTime),b(T,this.mesh.armature),T>P?[3,9]:[3,6];case 6:return[4,h.ActionSignal.WaitNextFrame];case 7:o.sent(),o.label=8;case 8:return[3,5];case 9:return d.SharedSystem.particles.embers.remove(this.particles),this.context.get(u.TransformSystem).delete(this.light.transform),this.context.get(u.TransformSystem).delete(this.bulge.transform),this.context.get(u.TransformSystem).delete(this.core.transform),this.context.get(u.TransformSystem).delete(this.flash.transform),this.context.get(l.PointLightPass).delete(this.light),this.context.get(l.ParticleEffectPass).remove(this.core),this.context.get(l.ParticleEffectPass).remove(this.flash),this.context.get(l.PostEffectPass).remove(this.bulge),c.Sprite.delete(this.flash),c.Sprite.delete(this.core),c.Sprite.delete(this.bulge),[2]}}))},t}(v.CubeSkill);t.ProjectileSkill=b},6738:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.RestoreSkill=void 0;var o=r(4454),s=r(6725),c=r(9336),l=r(6365),u=r(8581),f=r(296),h=r(7822),m=r(9131),d=r(8137),p=r(3605),v={"mesh.armature":h.ModelAnimation("activate"),"tubeX.transform.scale":s.PropertyAnimation([{frame:.3,value:[0,6,0]},{frame:1,value:[1.4,6,1.4],ease:s.ease.cubicOut}],o.vec3.lerp),"tubeZ.transform.scale":s.PropertyAnimation([{frame:.3,value:[0,6,0]},{frame:1,value:[1.4,6,1.4],ease:s.ease.cubicOut}],o.vec3.lerp),"tubeX.color":s.PropertyAnimation([{frame:.3,value:[1,0,0,1]},{frame:.6,value:o.vec4.ONE,ease:s.ease.sineIn}],o.vec4.lerp),"tubeZ.color":s.PropertyAnimation([{frame:.3,value:[1,0,0,1]},{frame:.6,value:o.vec4.ONE,ease:s.ease.sineIn}],o.vec4.lerp),"light.radius":s.PropertyAnimation([{frame:.5,value:0},{frame:.8,value:8,ease:s.ease.quartOut}],o.lerp),"light.intensity":s.PropertyAnimation([{frame:.5,value:8},{frame:.8,value:1,ease:s.ease.sineIn}],o.lerp),"bolts.rate":s.PropertyAnimation([{frame:0,value:0},{frame:.5,value:.02,ease:s.ease.stepped}],o.lerp),"ring.transform.scale":s.PropertyAnimation([{frame:0,value:[12,4,12],ease:s.ease.quadOut},{frame:.3,value:o.vec3.ZERO,ease:s.ease.quadIn}],o.vec3.lerp),"ring.color":s.PropertyAnimation([{frame:0,value:o.vec4.ZERO,ease:s.ease.quadIn},{frame:.3,value:[.7,.7,1,.6],ease:s.ease.quadOut}],o.vec4.lerp),sparks:s.EventTrigger([{frame:.4,value:64}],s.EventTrigger.emit),"flash.transform.scale":s.PropertyAnimation([{frame:.5,value:o.vec3.ZERO},{frame:.9,value:[10,10,10],ease:s.ease.quartOut}],o.vec3.lerp),"flash.color":s.PropertyAnimation([{frame:.5,value:[.8,.8,1,0]},{frame:.9,value:o.vec4.ZERO,ease:s.ease.sineIn}],o.vec4.lerp),"conduit.transform.scale":s.PropertyAnimation([{frame:.5,value:[3,0,3]},{frame:1,value:[2.5,4.5,2.5],ease:s.ease.cubicOut}],o.vec3.lerp),"conduit.color":s.PropertyAnimation([{frame:.5,value:[1,0,.3,0]},{frame:.8,value:[.8,.6,.8,1],ease:s.ease.quadIn}],o.vec4.lerp),"cube.light.intensity":s.PropertyAnimation([{frame:0,value:1},{frame:.3,value:0,ease:s.ease.quadIn}],o.lerp)},y={"bolts.rate":s.PropertyAnimation([{frame:0,value:0}],o.lerp),"light.intensity":s.PropertyAnimation([{frame:0,value:1},{frame:.5,value:0,ease:s.ease.quadIn}],o.lerp),"tubeX.transform.scale":s.PropertyAnimation([{frame:0,value:[1.4,6,1.4]},{frame:.5,value:[0,6,0],ease:s.ease.quadIn}],o.vec3.lerp),"tubeZ.transform.scale":s.PropertyAnimation([{frame:0,value:[1.4,6,1.4]},{frame:.5,value:[0,6,0],ease:s.ease.quadIn}],o.vec3.lerp),"tubeX.color":s.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.5,value:[.5,0,0,1],ease:s.ease.quadOut}],o.vec4.lerp),"tubeZ.color":s.PropertyAnimation([{frame:0,value:o.vec4.ONE},{frame:.5,value:[.5,0,0,1],ease:s.ease.quadOut}],o.vec4.lerp),"conduit.transform.scale":s.PropertyAnimation([{frame:0,value:[2.5,4.5,2.5]},{frame:.5,value:[4,0,4],ease:s.ease.sineIn}],o.vec3.lerp),"conduit.color":s.PropertyAnimation([{frame:0,value:[.8,.6,.8,1]},{frame:.5,value:[.5,0,.2,1],ease:s.ease.quadOut}],o.vec4.lerp),"cube.light.intensity":s.PropertyAnimation([{frame:0,value:0},{frame:.5,value:1,ease:s.ease.quadIn}],o.lerp)},g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.damage=1,t}return a(t,e),t.prototype.query=function(){return this.cube.tile},t.prototype.restore=function(){this.cube.matter.amount<=0||this.cube.health.amount>=this.cube.health.capacity||(this.cube.matter.amount--,this.cube.health.amount=Math.min(this.cube.health.capacity,this.cube.health.amount+this.damage))},t.prototype.activate=function(){var e,t,r,i;return n(this,(function(a){switch(a.label){case 0:if(this.cube.action.amount=this.cube.movement.amount=0,this.active)return[2,this.restore()];this.tubeX=u.BatchMesh.create(h.SharedSystem.geometry.cylinder),this.tubeX.material=h.SharedSystem.materials.effect.energyHalfPurple,this.tubeX.transform=this.context.get(c.TransformSystem).create(o.vec3.AXIS_Y,o.quat.HALF_X,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.tubeX),this.tubeZ=u.BatchMesh.create(h.SharedSystem.geometry.cylinder),this.tubeZ.material=h.SharedSystem.materials.effect.energyHalfPurple,this.tubeZ.transform=this.context.get(c.TransformSystem).create(o.vec3.AXIS_Y,o.quat.HALF_Z,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.tubeZ),this.flash=u.Sprite.create(0),this.flash.material=h.SharedSystem.materials.sprite.sparkle,this.flash.transform=this.context.get(c.TransformSystem).create([0,2.2,0],o.quat.HALF_N_X,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.flash),this.light=this.context.get(f.PointLightPass).create([.6,.6,1]),this.light.transform=this.context.get(c.TransformSystem).create([0,3,0],o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.ring=this.context.get(f.DecalPass).create(0),this.ring.material=h.SharedSystem.materials.decal.ring,this.ring.transform=this.context.get(c.TransformSystem).create(o.vec3.AXIS_Y,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.conduit=u.BatchMesh.create(h.SharedSystem.geometry.openBox),this.conduit.material=h.SharedSystem.materials.effect.stripes,this.conduit.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.conduit),this.bolts=h.SharedSystem.particles.bolts.add({uOrigin:o.vec3.add([0,1.5,0],this.cube.transform.position,o.vec3()),uRadius:[1.5,2.5],uLifespan:[.2,.6,0,0],uGravity:o.vec3.ZERO,uRotation:[0,2*Math.PI],uOrientation:o.quat.IDENTITY,uSize:[.6,1.8],uFrame:[3.4,4]}),this.sparks=h.SharedSystem.particles.sparks.add({uLifespan:[.4,.8,-.1,0],uOrigin:o.vec3.add([0,1.5,0],this.cube.transform.position,o.vec3()),uLength:[.05,.1],uGravity:[0,-19.6,0],uSize:[.1,.4],uRadius:[.2,.8],uForce:[7,10],uTarget:[0,-1,0]}),e=s.AnimationTimeline(this,v),this.context.get(l.AudioSystem).create("assets/"+this.mesh.armature.key+"_use.mp3","sfx",this.mesh.transform).play(0),t=1,r=this.context.currentTime,a.label=1;case 1:return i=this.context.currentTime-r,e(i,this.context.deltaTime),i>t?[3,5]:[3,2];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:return this.active=!0,this.restore(),h.SharedSystem.particles.sparks.remove(this.sparks),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.flash.transform),this.context.get(f.DecalPass).delete(this.ring),this.context.get(f.ParticleEffectPass).remove(this.flash),u.Sprite.delete(this.flash),[2]}}))},t.prototype.close=function(){var t,r,i,a,o,l;return n(this,(function(n){switch(n.label){case 0:if(!this.active)return[3,5];t=s.AnimationTimeline(this,y),r=.5,i=this.context.currentTime,n.label=1;case 1:return a=this.context.currentTime-i,t(a,this.context.deltaTime),a>r?[3,4]:[4,s.ActionSignal.WaitNextFrame];case 2:n.sent(),n.label=3;case 3:return[3,1];case 4:this.active=!1,h.SharedSystem.particles.bolts.remove(this.bolts),this.context.get(c.TransformSystem).delete(this.light.transform),this.context.get(c.TransformSystem).delete(this.conduit.transform),this.context.get(c.TransformSystem).delete(this.tubeX.transform),this.context.get(c.TransformSystem).delete(this.tubeZ.transform),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.ParticleEffectPass).remove(this.conduit),this.context.get(f.ParticleEffectPass).remove(this.tubeX),this.context.get(f.ParticleEffectPass).remove(this.tubeZ),u.BatchMesh.delete(this.tubeX),u.BatchMesh.delete(this.tubeZ),u.BatchMesh.delete(this.conduit),n.label=5;case 5:o=e.prototype.close.call(this),n.label=6;case 6:return(l=o.next()).done?[2,l.value]:[3,7];case 7:return[4,l.value];case 8:n.sent(),n.label=9;case 9:return[3,6];case 10:return[2]}}))},t.prototype.validate=function(){for(var e=this.context.get(p.TerrainSystem),t=this.cube.tile,r=m.DirectionTile.length-1;r>=0;r--)if(null!=e.getTile(t[0]+m.DirectionTile[r][0],t[1]+m.DirectionTile[r][1]))return!1;for(r=m.DirectionTile.length-1;r>=0;r--){var i=o.vec2.add(t,m.DirectionTile[r],o.vec2());e.setTile(i[0],i[1],this.cube),this.cube.tiles.push(i)}return!0},t.prototype.clear=function(){for(var e=this.context.get(p.TerrainSystem);this.cube.tiles.length>1;){var t=this.cube.tiles.pop();e.setTile(t[0],t[1],null)}},t}(d.CubeSkill);t.RestoreSkill=g},6511:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShieldSkill=void 0;var o=r(4454),s=r(6725),c=r(9336),l=r(6365),u=r(8581),f=r(296),h=r(7822),m=r(8137),d={dust:s.EventTrigger([{frame:.85,value:36}],s.EventTrigger.emit),"shield.transform.scale":s.PropertyAnimation([{frame:1,value:o.vec3.ZERO},{frame:3,value:[3,5,3],ease:s.ease.elasticOut(1,.75)}],o.vec3.lerp),"shield.color":s.PropertyAnimation([{frame:1,value:[1,0,.5,0]},{frame:2.5,value:o.vec4.ONE,ease:s.ease.cubicOut}],o.vec4.lerp),"displacement.transform.scale":s.PropertyAnimation([{frame:1,value:o.vec3.ZERO},{frame:2.5,value:[3,5,3],ease:s.ease.elasticOut(1,.75)}],o.vec3.lerp),"displacement.color":s.PropertyAnimation([{frame:1,value:[1,.2,.8,1]},{frame:2,value:[1,1,1,.1],ease:s.ease.quadOut}],o.vec4.lerp),"wave.transform.scale":s.PropertyAnimation([{frame:.8,value:[0,2,0]},{frame:1.4,value:[12,2,12],ease:s.ease.cubicOut}],o.vec3.lerp),"wave.color":s.PropertyAnimation([{frame:.8,value:[.6,1,.9,0]},{frame:1.4,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp),"beam.transform.scale":s.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:2,value:[1.4,4.2,1.4],ease:s.ease.cubicOut}],o.vec3.lerp),"beam.color":s.PropertyAnimation([{frame:.8,value:[1,.4,.8,1]},{frame:1.4,value:[.5,1,1,0],ease:s.ease.sineIn},{frame:2,value:o.vec4.ZERO,ease:s.ease.quadIn}],o.vec4.lerp),"tube.transform.scale":s.PropertyAnimation([{frame:.6,value:[1,3,1]},{frame:1,value:[2.4,3.6,2.4],ease:s.ease.quadOut},{frame:1.4,value:[5,2,5],ease:s.ease.sineIn}],o.vec3.lerp),"tube.transform.position":s.PropertyAnimation([{frame:.2,value:o.vec3.ZERO},{frame:1.2,value:[0,4,0],ease:s.ease.sineOut}],o.vec3.lerp),"tube.color":s.PropertyAnimation([{frame:1,value:o.vec4.ONE},{frame:1.4,value:o.vec4.ZERO,ease:s.ease.cubicIn}],o.vec4.lerp),"sphere.transform.rotation":s.PropertyAnimation([{frame:0,value:o.quat.axisAngle(o.vec3.AXIS_X,Math.PI,o.quat())}],o.quat.slerp),"sphere.transform.scale":s.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.2,value:[4,6,4],ease:s.ease.cubicOut},{frame:2.2,value:[3,5,3],ease:s.ease.quadInOut}],o.vec3.lerp),"sphere.color":s.PropertyAnimation([{frame:1.2,value:o.vec4.ONE},{frame:2.2,value:o.vec4.ZERO,ease:s.ease.cubicIn}],o.vec4.lerp)},p={"shield.transform.scale":s.PropertyAnimation([{frame:.2,value:[3,5,3]},{frame:1,value:o.vec3.ZERO,ease:s.ease.CubicBezier(.36,0,.66,-.56)}],o.vec3.lerp),"shield.color":s.PropertyAnimation([{frame:.2,value:o.vec4.ONE},{frame:1,value:o.vec4.ZERO,ease:s.ease.sineIn}],o.vec4.lerp),"displacement.color":s.PropertyAnimation([{frame:0,value:[1,1,1,.1]},{frame:.4,value:[1,.6,.9,1],ease:s.ease.quadOut},{frame:.8,value:[1,1,1,0],ease:s.ease.sineIn}],o.vec4.lerp)},v=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.indicator={capacity:6,amount:6},i.idleIndex=-1,i.shield=u.Mesh.create(h.SharedSystem.geometry.sphereMesh,1),i.shield.material=h.SharedSystem.materials.shieldMaterial,i.displacement=u.Mesh.create(h.SharedSystem.geometry.sphereMesh,0),i.displacement.material=h.SharedSystem.materials.shieldDisplacementMaterial,i}return a(t,e),t.prototype.update=function(){this.indicator.amount=this.indicator.capacity},t.prototype.query=function(){return this.cube.tile},t.prototype.activate=function(){return n(this,(function(e){return this.cube.movement.amount=this.cube.action.amount=0,this.active=!0,[2]}))},t.prototype.open=function(){var e,t,r,i,a,m,p;return n(this,(function(n){switch(n.label){case 0:e=this.cube.sides[this.cube.side],t=this.cube.meshes[this.cube.side],this.wave=this.context.get(f.DecalPass).create(0),this.wave.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.wave.material=h.SharedSystem.materials.decal.ring,this.beam=u.Sprite.create(3,0,o.vec4.ONE,[0,.5]),this.beam.material=h.SharedSystem.materials.sprite.beam,this.beam.transform=this.context.get(c.TransformSystem).create([0,4,0],o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.beam),this.tube=u.BatchMesh.create(h.SharedSystem.geometry.cylinder),this.tube.material=h.SharedSystem.materials.effect.stripes,this.tube.transform=this.context.get(c.TransformSystem).create(),this.tube.transform.parent=this.cube.transform,this.context.get(f.ParticleEffectPass).add(this.tube),this.sphere=u.BatchMesh.create(h.SharedSystem.geometry.lowpolySphere),this.sphere.material=h.SharedSystem.materials.effect.stripes,this.sphere.transform=this.context.get(c.TransformSystem).create(),this.sphere.transform.parent=this.cube.transform,this.context.get(f.ParticleEffectPass).add(this.sphere),this.displacement.transform=this.context.get(c.TransformSystem).create(),this.displacement.transform.parent=this.cube.transform,this.context.get(f.PostEffectPass).add(this.displacement),this.shield.transform=this.context.get(c.TransformSystem).create(),this.shield.transform.parent=this.cube.transform,this.context.get(f.PostEffectPass).add(this.shield),this.dust=h.SharedSystem.particles.dust.add({uOrigin:this.cube.transform.position,uTarget:o.vec3.ZERO,uOrientation:o.quat.IDENTITY,uLifespan:[.6,1,-.1,0],uSize:[2,5],uRadius:[.5,.8],uForce:[6,12],uGravity:[0,9.8,0],uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]}),r=s.AnimationTimeline(this,d),i=h.ModelAnimation("open"),this.context.get(l.AudioSystem).create("assets/"+this.mesh.armature.key+"_open.mp3","sfx",this.mesh.transform).play(0),a=3,m=this.context.currentTime,n.label=1;case 1:return(p=this.context.currentTime-m)<=1?i(p,t.armature):-1==this.idleIndex&&(this.idleIndex=this.context.get(s.AnimationSystem).start(this.idle(),!0)),r(p,this.context.deltaTime),p>a?[3,4]:[4,s.ActionSignal.WaitNextFrame];case 2:n.sent(),n.label=3;case 3:return[3,1];case 4:return e.open=1,this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.beam.transform),this.context.get(c.TransformSystem).delete(this.tube.transform),this.context.get(c.TransformSystem).delete(this.sphere.transform),h.SharedSystem.particles.dust.remove(this.dust),this.context.get(f.ParticleEffectPass).remove(this.sphere),this.context.get(f.ParticleEffectPass).remove(this.tube),this.context.get(f.ParticleEffectPass).remove(this.beam),u.Sprite.delete(this.beam),u.BatchMesh.delete(this.tube),u.BatchMesh.delete(this.sphere),this.context.get(f.DecalPass).delete(this.wave),[2]}}))},t.prototype.close=function(){var e,t,r,i,a,o,u,m;return n(this,(function(n){switch(n.label){case 0:return e=this.cube.sides[this.cube.side],t=this.cube.meshes[this.cube.side],this.active=!1,r=this.context.get(s.AnimationSystem).await(this.idleIndex),this.idleIndex=-1,[4,r];case 1:n.sent(),i=s.AnimationTimeline(this,p),a=h.ModelAnimation("open"),this.context.get(l.AudioSystem).create("assets/"+this.mesh.armature.key+"_close.mp3","sfx",this.mesh.transform).play(0),o=1,u=this.context.currentTime,n.label=2;case 2:return m=this.context.currentTime-u,a(1-m,t.armature),i(m,this.context.deltaTime),m>o?[3,6]:[3,3];case 3:return[4,s.ActionSignal.WaitNextFrame];case 4:n.sent(),n.label=5;case 5:return[3,2];case 6:return e.open=0,this.context.get(c.TransformSystem).delete(this.shield.transform),this.context.get(c.TransformSystem).delete(this.displacement.transform),this.context.get(f.PostEffectPass).remove(this.shield),this.context.get(f.PostEffectPass).remove(this.displacement),[2]}}))},t.prototype.idle=function(){var e,t,r,i,a,o,c,u,f,m;return n(this,(function(n){switch(n.label){case 0:e=this.cube.meshes[this.cube.side],t=s.ease.velocity(0,1,.5),r=h.ModelAnimation("loop"),(i=this.context.get(l.AudioSystem).create("assets/cube_7_loop.mp3","sfx",this.mesh.transform)).volume(0,0).volume(.8,.5).play(0),a=0,f=this.context.currentTime,n.label=1;case 1:return m=this.context.currentTime-f,a=t(m)%1,r(a,e.armature),-1!=this.idleIndex?[3,2]:[3,5];case 2:return[4,s.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:o=.25-a%.25,c=s.ease.velocity.duration(1,0,o),u=s.ease.velocity(1,0,c),i.volume(1,0).stop(1),f=this.context.currentTime,n.label=6;case 6:return m=this.context.currentTime-f,r((a+u(m))%1,e.armature),m>c?[3,10]:[3,7];case 7:return[4,s.ActionSignal.WaitNextFrame];case 8:n.sent(),n.label=9;case 9:return[3,6];case 10:return[2]}}))},t}(m.CubeSkill);t.ShieldSkill=v},9802:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShockwaveSkill=void 0;var o=r(4454),s=r(9336),c=r(6365),l=r(6725),u=r(8581),f=r(296),h=r(7822),m=r(8137),d={"mesh.armature":h.ModelAnimation("activate"),"ring.transform.scale":l.PropertyAnimation([{frame:0,value:[16,2,16]},{frame:.6,value:[0,2,0],ease:l.ease.quadIn}],o.vec3.lerp),"ring.color":l.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:.6,value:[.8,.3,.6,.4],ease:l.ease.quadOut}],o.vec4.lerp),"crack.transform.scale":l.PropertyAnimation([{frame:0,value:[16,2,16]}],o.vec3.lerp),"crack.threshold":l.PropertyAnimation([{frame:.7,value:2.5},{frame:1.2,value:0,ease:l.ease.cubicOut},{frame:2,value:-2.5,ease:l.ease.sineOut}],o.lerp),"crack.color":l.PropertyAnimation([{frame:1,value:o.vec4.ONE},{frame:1.6,value:[0,0,0,1],ease:l.ease.sineOut}],o.vec4.lerp),"bolts.rate":l.PropertyAnimation([{frame:0,value:0},{frame:.8,value:.004,ease:l.ease.stepped},{frame:1.8,value:0,ease:l.ease.stepped}],o.lerp),"bolts.uniform.uniforms.uRadius":l.PropertyAnimation([{frame:.8,value:o.vec2.ONE},{frame:1.8,value:[6,7],ease:l.ease.sineOut}],o.vec2.lerp),"wave.transform.scale":l.PropertyAnimation([{frame:.7,value:o.vec3.ZERO},{frame:1.2,value:[20,20,20],ease:l.ease.cubicOut}],o.vec3.lerp),"wave.color":l.PropertyAnimation([{frame:.8,value:o.vec4.ONE},{frame:1.2,value:o.vec4.ZERO,ease:l.ease.cubicIn}],o.vec4.lerp),"light.radius":l.PropertyAnimation([{frame:.7,value:0},{frame:1.2,value:12,ease:l.ease.cubicOut},{frame:2,value:0,ease:l.ease.cubicIn}],o.lerp),"light.intensity":l.PropertyAnimation([{frame:.6,value:0},{frame:.8,value:4,ease:l.ease.cubicIn},{frame:1.4,value:.5,ease:l.ease.cubicOut},{frame:2,value:0,ease:l.ease.sineIn}],o.lerp),"light.color":l.PropertyAnimation([{frame:.8,value:[.5,.8,1]},{frame:1.4,value:[1,.2,.6],ease:l.ease.cubicOut}],o.vec3.lerp),"flash.transform.scale":l.PropertyAnimation([{frame:.6,value:o.vec3.ZERO},{frame:1,value:[6,6,6],ease:l.ease.quartOut}],o.vec3.lerp),"flash.color":l.PropertyAnimation([{frame:.6,value:[.6,.8,1,0]},{frame:1,value:o.vec4.ZERO,ease:l.ease.quadIn}],o.vec4.lerp),"beam.transform.scale":l.PropertyAnimation([{frame:.6,value:[0,2,1]},{frame:1.2,value:[1.4,4.8,1],ease:l.ease.cubicOut}],o.vec3.lerp),"beam.color":l.PropertyAnimation([{frame:.6,value:[1,.6,.8,0]},{frame:1.2,value:o.vec4.ZERO,ease:l.ease.quadIn}],o.vec4.lerp),"cylinder.transform.scale":l.PropertyAnimation([{frame:0,value:[8,2,8]},{frame:.5,value:[3,8,3],ease:l.ease.sineOut},{frame:.8,value:[6,1,6],ease:l.ease.cubicIn}],o.vec3.lerp),"cylinder.transform.rotation":l.PropertyAnimation([{frame:0,value:o.quat.IDENTITY},{frame:.5,value:o.quat.axisAngle(o.vec3.AXIS_Y,-1*Math.PI,o.quat()),ease:l.ease.quadIn},{frame:.8,value:o.quat.axisAngle(o.vec3.AXIS_Y,-1.5*Math.PI,o.quat()),ease:l.ease.quadOut}],o.quat.slerp),"cylinder.color":l.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:.5,value:o.vec4.ONE,ease:l.ease.quadOut},{frame:.8,value:o.vec4.ZERO,ease:l.ease.quartIn}],o.vec4.lerp)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.damageType=18,t.damage=1,t.range=Math.sqrt(5),t}return a(t,e),t.prototype.query=function(){return m.CubeSkill.queryArea(this.context,this.cube.tile,this.minRange,this.range,2)},t.prototype.activate=function(e){var t,r,i,a,p;return n(this,(function(n){switch(n.label){case 0:this.cube.action.amount=0,this.ring=this.context.get(f.DecalPass).create(0),this.ring.transform=this.context.get(s.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.ring.material=h.SharedSystem.materials.decal.halo,this.crack=this.context.get(f.DecalPass).create(1),this.crack.transform=this.context.get(s.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.crack.material=h.SharedSystem.materials.shatterMaterial,this.wave=u.Sprite.create(0),this.wave.material=h.SharedSystem.materials.displacement.wave,this.wave.transform=this.context.get(s.TransformSystem).create([0,1.5,0],o.quat.HALF_N_X,o.vec3.ONE,this.cube.transform),this.context.get(f.PostEffectPass).add(this.wave),this.flash=u.Sprite.create(0),this.flash.material=h.SharedSystem.materials.sprite.wave,this.flash.transform=this.context.get(s.TransformSystem).create([0,1.6,0],o.quat.HALF_N_X,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.flash),this.beam=u.Sprite.create(3,0,o.vec4.ONE,[0,.5]),this.beam.material=h.SharedSystem.materials.sprite.beam,this.beam.transform=this.context.get(s.TransformSystem).create([0,3,0],o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.beam),this.cylinder=u.BatchMesh.create(h.SharedSystem.geometry.cylinder),this.cylinder.material=h.SharedSystem.materials.sprite.spiral,this.cylinder.transform=this.context.get(s.TransformSystem).create(o.vec3.AXIS_Y,o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.context.get(f.ParticleEffectPass).add(this.cylinder),this.light=this.context.get(f.PointLightPass).create(),this.light.transform=this.context.get(s.TransformSystem).create([0,4,0],o.quat.IDENTITY,o.vec3.ONE,this.cube.transform),this.bolts=this.bolts||h.SharedSystem.particles.bolts.add({uOrigin:o.vec3.add([0,2,0],this.cube.transform.position,o.vec3()),uRadius:o.vec2.ZERO,uGravity:o.vec3.ZERO,uOrientation:o.quat.IDENTITY,uLifespan:[.1,.8,0,0],uRotation:[0,2*Math.PI],uSize:[.1,1.2],uFrame:[8,4]}),t=l.EventTrigger(e.map((function(e){return{frame:.6,value:e}})),m.CubeSkill.damage),r=l.AnimationTimeline(this,d),this.context.get(c.AudioSystem).create("assets/"+this.mesh.armature.key+"_use.mp3","sfx",this.mesh.transform).play(0),i=2,a=this.context.currentTime,n.label=1;case 1:return p=this.context.currentTime-a,r(p,this.context.deltaTime),t(p,this.context.deltaTime,this),p>i?[3,5]:[3,2];case 2:return[4,l.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(s.TransformSystem).delete(this.light.transform),this.context.get(s.TransformSystem).delete(this.crack.transform),this.context.get(s.TransformSystem).delete(this.ring.transform),this.context.get(s.TransformSystem).delete(this.wave.transform),this.context.get(s.TransformSystem).delete(this.flash.transform),this.context.get(s.TransformSystem).delete(this.beam.transform),this.context.get(s.TransformSystem).delete(this.cylinder.transform),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.DecalPass).delete(this.ring),this.context.get(f.DecalPass).delete(this.crack),this.context.get(f.PostEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.flash),this.context.get(f.ParticleEffectPass).remove(this.beam),this.context.get(f.ParticleEffectPass).remove(this.cylinder),u.Sprite.delete(this.wave),u.Sprite.delete(this.flash),u.Sprite.delete(this.beam),u.BatchMesh.delete(this.cylinder),[2]}}))},t.prototype.clear=function(){this.bolts&&(this.bolts=void h.SharedSystem.particles.bolts.remove(this.bolts))},t}(m.CubeSkill);t.ShockwaveSkill=p},7843:function(e,t,r){"use strict";var i=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.DamageEffect=void 0;var a=r(4454),n=r(6725),o=r(8581),s=r(296),c=r(9336),l=r(6365),u=r(7822),f={"debris.transform.scale":n.PropertyAnimation([{frame:0,value:[1.4,1.4,1.4]}],a.vec3.lerp),"ring.transform.scale":n.PropertyAnimation([{frame:.2,value:a.vec3.ZERO},{frame:.7,value:[6,6,6],ease:n.ease.cubicOut}],a.vec3.lerp),"ring.color":n.PropertyAnimation([{frame:.2,value:[.8,.6,.8,.6]},{frame:.7,value:a.vec4.ZERO,ease:n.ease.quadIn}],a.vec4.lerp),spikes:n.EventTrigger([{frame:.2,value:8}],n.EventTrigger.emit)},h=function(){function e(e){this.context=e}return e.create=function(t,r,i){var a=this.pool.pop()||new e(t);return t.get(n.AnimationSystem).start(a.play(r,i),!0),a},e.prototype.play=function(t,r){var h,m,d,p;return i(this,(function(r){switch(r.label){case 0:this.debris=this.context.get(u.SharedSystem).debris.create(t.transform.position),this.ring=o.Sprite.create(0),this.ring.material=u.SharedSystem.materials.sprite.burst,this.ring.transform=this.context.get(c.TransformSystem).create(a.vec3.AXIS_Y,a.quat.HALF_X,a.vec3.ONE,t.transform),this.context.get(s.ParticleEffectPass).add(this.ring),this.spikes=u.SharedSystem.particles.spikes.add({uLifespan:[.6,1,0,0],uOrigin:a.vec3.add([0,.5,0],t.transform.position,a.vec3()),uTarget:[0,-.5,0],uGravity:a.vec3.ZERO,uRotation:a.vec2.ZERO,uFrame:[0,2],uSize:[2,4],uRadius:[.2,.4],uForce:[1,4]}),this.context.get(l.AudioSystem).create("assets/cube_damage.mp3","sfx",t.transform).play(0,a.randomFloat(.84,1.16,u.SharedSystem.random())),h=n.AnimationTimeline(this,f),m=2,d=this.context.currentTime,r.label=1;case 1:return p=this.context.currentTime-d,h(p,this.context.deltaTime),p>m?[3,5]:[3,2];case 2:return[4,n.ActionSignal.WaitNextFrame];case 3:r.sent(),r.label=4;case 4:return[3,1];case 5:return u.SharedSystem.particles.spikes.remove(this.spikes),this.context.get(u.SharedSystem).debris.delete(this.debris),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(s.ParticleEffectPass).remove(this.ring),o.Sprite.delete(this.ring),e.pool.push(this),[2]}}))},e.pool=[],e}();t.DamageEffect=h},6916:function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.DeathEffect=void 0;var n=r(4454),o=r(6725),s=r(9336),c=r(6365),l=r(8581),u=r(296),f=r(7822),h=r(9131),m={"cube.light.intensity":o.PropertyAnimation([{frame:.2,value:1},{frame:.6,value:0,ease:o.ease.quadIn}],n.lerp),"debris.color":o.PropertyAnimation([{frame:0,value:n.vec4.ONE},{frame:.6,value:[0,0,0,.02],ease:o.ease.quadIn}],n.vec4.lerp),"wreck.color":o.PropertyAnimation([{frame:0,value:n.vec4.ONE},{frame:.8,value:[.2,.2,.2,.02],ease:o.ease.quadIn}],n.vec4.lerp),spikes:o.EventTrigger([{frame:0,value:36}],o.EventTrigger.emit),"light.radius":o.PropertyAnimation([{frame:0,value:0},{frame:.4,value:8,ease:o.ease.cubicOut}],n.lerp),"light.intensity":o.PropertyAnimation([{frame:0,value:10},{frame:.4,value:0,ease:o.ease.sineIn}],n.lerp),"wave.transform.scale":o.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.5,value:[12,12,12],ease:o.ease.cubicOut}],n.vec3.lerp),"wave.color":o.PropertyAnimation([{frame:0,value:n.vec4.ONE},{frame:.5,value:n.vec4.ZERO,ease:o.ease.quadIn}],n.vec4.lerp),"burn.transform.scale":o.PropertyAnimation([{frame:.2,value:n.vec3.ZERO},{frame:.6,value:[10,10,10],ease:o.ease.cubicOut}],n.vec3.lerp),"burn.color":o.PropertyAnimation([{frame:.2,value:[0,0,0,1]},{frame:1.2,value:n.vec4.ZERO,ease:o.ease.quadIn}],n.vec4.lerp),"ring.transform.scale":o.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.4,value:[6,6,6],ease:o.ease.quartOut}],n.vec3.lerp),"ring.color":o.PropertyAnimation([{frame:0,value:[1,.5,.6,.6]},{frame:.4,value:n.vec4.ZERO,ease:o.ease.sineIn}],n.vec4.lerp)},d=function(){function e(e){this.context=e}return e.create=function(t,r){var i=new e(t);return i.index=t.get(o.AnimationSystem).start(i.play(r),!0),i},e.prototype.play=function(e){var t,r,d,p,v,y;return a(this,(function(a){switch(a.label){case 0:this.cube=e,n.vec4.copy(n.vec4.ZERO,this.cube.meshes[this.cube.side].color),this.wreck=this.context.get(l.MeshSystem).loadModel(f.CubeModuleModel[1]),this.wreck.transform=this.cube.transform,t=this.cube.sides[this.cube.side],r=h.DirectionAngle[(this.cube.direction+t.direction)%4],n.quat.copy(r,this.wreck.armature.nodes[0].rotation),f.ModelAnimation("close")(0,this.wreck.armature),this.context.get(h.PlayerSystem).tilemap.renderSubstitute(this.wreck.material),this.spikes=f.SharedSystem.particles.spikes.add({uLifespan:[.5,1,-.1,0],uOrigin:this.wreck.transform.position,uTarget:[0,-.2,0],uGravity:n.vec3.ZERO,uRotation:n.vec2.ZERO,uFrame:[0,2],uSize:[1,4],uRadius:[.2,.4],uForce:[1,4]}),this.light=this.context.get(u.PointLightPass).create([1,.4,.6]),this.light.transform=this.context.get(s.TransformSystem).create([0,1,0],n.quat.IDENTITY,n.vec3.ONE,this.wreck.transform),this.wave=l.Sprite.create(0),this.wave.material=f.SharedSystem.materials.displacement.ring,this.wave.transform=this.context.get(s.TransformSystem).create([0,1,0],n.quat.HALF_X,n.vec3.ONE,this.wreck.transform),this.context.get(u.PostEffectPass).add(this.wave),this.burn=this.context.get(u.DecalPass).create(4),this.burn.material=f.SharedSystem.materials.decal.rays,this.burn.transform=this.context.get(s.TransformSystem).create(n.vec3.ZERO,n.quat.IDENTITY,n.vec3.ONE,this.wreck.transform),this.ring=l.Sprite.create(0),this.ring.material=f.SharedSystem.materials.sprite.burst,this.ring.transform=this.context.get(s.TransformSystem).create(n.vec3.AXIS_Y,n.quat.HALF_X,n.vec3.ONE,this.wreck.transform),this.context.get(u.ParticleEffectPass).add(this.ring),this.debris=this.context.get(f.SharedSystem).debris.create(this.wreck.transform.position),d=o.AnimationTimeline(this,i(i({},m),{"wreck.armature":(g=this.wreck.armature.nodes.slice(1).map((function(e,t){var r=n.vec3.copy(e.position,n.vec3()),i=n.quat.copy(e.rotation,n.quat()),a=n.vec3.subtract(r,[n.randomFloat(-.4,.4,f.SharedSystem.random()),n.randomFloat(-2,-1,f.SharedSystem.random()),n.randomFloat(-.4,.4,f.SharedSystem.random())],n.vec3());n.vec3.normalize(a,a),n.vec3.scale(a,n.randomFloat(6,12,f.SharedSystem.random()),a);var o=n.vec3.subtract(n.vec3.AXIS_Y,r,n.vec3());return n.vec3.cross(o,a,o),{index:t+1,position:r,rotation:i,gravity:n.vec3(0,-30,0),velocity:a,angular:o}})),x=g.map((function(e){var t=e.gravity,r=e.velocity,i=e.position;return n.solveQuadratic(t[1],2*r[1],2*i[1])})),function(e,t){for(var r=g.length-1;r>=0;r--){var i=g[r],a=i.index,o=i.position,s=i.rotation,c=i.velocity,l=i.angular,u=i.gravity,f=n.clamp(e,0,x[r]),h=t.nodes[a];h.position[0]=o[0]+f*c[0]+.5*f*f*u[0],h.position[1]=o[1]+f*c[1]+.5*f*f*u[1],h.position[2]=o[2]+f*c[2]+.5*f*f*u[2],h.rotation[0]=s[0]+.5*f*(l[0]*s[3]+l[1]*s[2]-l[2]*s[1]),h.rotation[1]=s[1]+.5*f*(l[1]*s[3]+l[2]*s[0]-l[0]*s[2]),h.rotation[2]=s[2]+.5*f*(l[2]*s[3]+l[0]*s[1]-l[1]*s[0]),h.rotation[3]=s[3]+.5*f*(-l[0]*s[0]-l[1]*s[1]-l[2]*s[2])}return t.frame=0,t}),"wreck.armature.nodes.0.position":o.PropertyAnimation([{frame:1.2,value:n.vec3.ZERO},{frame:1.6,value:[0,-1,0],ease:o.ease.quadIn}],n.vec3.lerp)})),this.context.get(c.AudioSystem).create("assets/cube_death.mp3","sfx",this.wreck.transform).play(0),p=1.6,v=this.context.currentTime+.2,a.label=1;case 1:return y=this.context.currentTime-v,d(y,this.context.deltaTime),y>p?[3,5]:[3,2];case 2:return[4,o.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:return this.context.get(f.SharedSystem).debris.delete(this.debris),this.context.get(s.TransformSystem).delete(this.ring.transform),this.context.get(s.TransformSystem).delete(this.burn.transform),this.context.get(s.TransformSystem).delete(this.wave.transform),this.context.get(s.TransformSystem).delete(this.light.transform),f.SharedSystem.particles.spikes.remove(this.spikes),this.context.get(u.PostEffectPass).remove(this.wave),this.context.get(u.PointLightPass).delete(this.light),this.context.get(u.ParticleEffectPass).remove(this.ring),this.context.get(u.DecalPass).delete(this.burn),this.context.get(l.MeshSystem).delete(this.wreck),l.Sprite.delete(this.ring),l.Sprite.delete(this.wave),[2]}var g,x}))},e}();t.DeathEffect=d},3912:function(e,t,r){"use strict";var i=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.FadeEffect=void 0;var a=r(4454),n=r(6725),o=r(8581),s=r(296),c=r(7822),l=function(){function e(){}return e.create=function(t,r){t.get(n.AnimationSystem).start(e.fade(t,r),!1)},e.fade=function(e,t){var r,l,u,f,h;return i(this,(function(i){switch(i.label){case 0:r=e.get(s.OverlayPass),(l=o.Sprite2D.create(16)).transform=o.Transform2D.create(a.vec2.ZERO,[e.canvas.width,e.canvas.height]),l.material=c.SharedSystem.materials.sprite.fade,r.list2d.push(l),u=n.PropertyAnimation([{frame:0,value:[0,0,0,1]},{frame:t,value:a.vec4.ZERO,ease:n.ease.sineIn}],a.vec4.lerp),f=e.currentTime,i.label=1;case 1:return h=e.currentTime-f,u(h,l.color),h>t?[3,5]:[3,2];case 2:return[4,n.ActionSignal.WaitNextFrame];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:return r.list2d.splice(r.list2d.indexOf(l),1),o.Transform2D.delete(l.transform),o.Sprite2D.delete(l),[2]}}))},e}();t.FadeEffect=l},4397:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(7843),t),a(r(6916),t)},7083:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CubeSkills=void 0;var i=r(8137),a=r(708),n=r(9802),o=r(6511),s=r(9087),c=r(9634),l=r(4354),u=r(2394),f=r(6738),h=r(5983);t.CubeSkills=function(e,t){var r;return(r={})[0]=new i.CubeSkill(e,t),r[3]=new a.BeamSkill(e,t),r[5]=new n.ShockwaveSkill(e,t),r[9]=new o.ShieldSkill(e,t),r[2]=new s.ProjectileSkill(e,t),r[7]=new c.DetonateSkill(e,t),r[6]=new l.CorrosiveOrbSkill(e,t),r[10]=new u.ArtillerySkill(e,t),r[4]=new f.RestoreSkill(e,t),r[8]=new h.ExtractSkill(e,t),r}},2572:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroundPlane=void 0;var i=r(4454),a=r(9463),n=r(8581),o=r(296),s=r(9336),c=r(7822),l=function(){function e(e,t,r,o,s){this.context=e,this.parent=t,this.columns=r,this.rows=o,this.size=s,this.decals=[],this.foliageOptions={uOrigin:i.range(10).map((function(e){return i.vec3()})),uRadius:i.vec2(0,4),uSize:i.vec2(.6,1.8)};var c=a.createPlane({columns:r,rows:o,width:this.size,height:this.size}),l=c.vertexArray,u=c.indexArray,f=c.format;this.heightmap=new Float32Array((r+3)*(o+3)),this.vertexArray=l,this.vertexBuffer=this.context.get(n.MeshSystem).uploadVertexData(l,u,f),this.stride=this.vertexBuffer.format[1].stride>>>2}return e.prototype.build=function(){for(var e=this.rows+1,t=this.rows+3,r=0;r<=this.columns;r++)for(var a=0;a<=this.rows;a++){var l=(r*e+a)*this.stride;this.vertexArray[l+1]=this.heightmap[(r+1)*t+(a+1)];var u=this.heightmap[(r+2)*t+(a+1)],f=this.heightmap[(r+0)*t+(a+1)],h=this.heightmap[(r+1)*t+(a+2)],m=this.heightmap[(r+1)*t+(a+0)],d=this.vertexArray.subarray(l+3,l+6);i.vec3.set(2*(u-f),4,2*(m-h),d),i.vec3.normalize(d,d)}this.mesh=this.context.get(n.MeshSystem).create(),this.context.get(n.MeshSystem).updateVertexData(this.vertexBuffer,this.vertexArray),this.mesh.layer=1,this.mesh.buffer=this.vertexBuffer,this.mesh.buffer.frame=0,this.mesh.transform=this.context.get(s.TransformSystem).create(),i.vec3.set(this.parent.column*this.size,0,this.parent.row*this.size,this.mesh.transform.position),this.mesh.material=c.SharedSystem.materials.mesh.dunes;for(var p=i.mulberry32(124),v=this.foliageOptions.uOrigin.length-1;v>=0;v--){var y=this.foliageOptions.uOrigin[v];y[0]=i.randomFloat(0,this.size,p())-.5*this.size+this.mesh.transform.position[0],y[2]=i.randomFloat(0,this.size,p())-.5*this.size+this.mesh.transform.position[2],y[1]=this.sample(y[0],y[2]);var g=this.context.get(o.DecalPass).create(1);g.material=c.SharedSystem.materials.decal.moss;var x=i.randomFloat(4,12,p());g.transform=this.context.get(s.TransformSystem).create(y,i.quat.IDENTITY,[x,10,x]),i.quat.axisAngle(i.vec3.AXIS_Y,2*p()*Math.PI,g.transform.rotation),this.decals.push(g)}this.foliage=c.SharedSystem.particles.foliage.start(128,this.foliageOptions)},e.prototype.sample=function(e,t){var r=this.rows+1,i=this.rows+3,a=0|(e/this.size-this.parent.column+.5)*r,n=0|(t/this.size-this.parent.row+.5)*r;return this.heightmap[(a+1)*i+(n+1)]},e.prototype.clear=function(){for(this.context.get(s.TransformSystem).delete(this.mesh.transform),this.context.get(n.MeshSystem).delete(this.mesh),this.mesh=null,c.SharedSystem.particles.foliage.stop(this.foliage);this.decals.length;){var e=this.decals.pop();this.context.get(s.TransformSystem).delete(e.transform),this.context.get(o.DecalPass).delete(e)}},e.prototype.delete=function(){this.context.get(n.MeshSystem).unloadVertexData(this.vertexBuffer)},e}();t.GroundPlane=l},7463:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LevelGenerator=void 0;var i=r(4454),a=r(8967),n=r(6888),o=r(821),s=r(8586),c=r(5275),l=r(8444),u=r(1226),f=4278190080,h=4278222848,m=4278251520,d=4294901760,p=4294934528,v=4294963200,y=new ImageData(new Uint8ClampedArray(new Uint32Array([f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,h,h,h,f,f,f,f,f,f,f,f,f,f,f,f,f,h,m,h,f,f,f,d,d,d,d,h,d,d,d,f,f,h,h,h,f,f,f,d,f,f,f,f,f,f,d,f,f,f,f,f,f,f,f,d,f,f,f,f,f,f,h,f,f,f,f,f,f,d,d,d,h,d,d,d,f,f,h,f,f,f,f,f,f,d,f,f,f,f,f,d,f,f,h,f,f,f,d,f,f,h,f,f,f,f,f,d,f,f,d,f,f,f,f,f,f,d,f,f,h,d,d,d,d,h,d,f,f,d,d,h,d,d,f,f,h,f,f,d,f,f,d,f,f,d,f,f,f,d,d,d,d,f,f,d,f,f,h,f,f,d,f,f,f,f,f,f,d,f,f,h,f,f,d,f,f,h,f,f,f,f,f,f,d,d,d,h,h,d,d,f,f,d,f,f,f,f,f,f,d,f,f,f,f,f,f,f,f,d,d,d,h,h,d,d,d,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,d,f,f,f,f,f]).buffer),16,16),g=function(){function e(e,t){this.context=e,this.zoneSize=t,this.stack=[],this.zones=[],this.limit=4,this.groupRadius=16,this.tilemap=new c.TextureMapGenerator(3,this.zoneSize+1,this.zoneSize+1,!1,y,!0,8),this.groupSampler=new l.PoissonDisk(this.zoneSize-this.groupRadius,this.zoneSize-this.groupRadius,this.groupRadius),this.flags=new Uint8Array(this.tilemap.width*this.tilemap.height)}return e.random2D=function(e,t,r){void 0===r&&(r=214);var a=39916801*i.noise2D(e,t,r),n=1;return function(){return n=i.noise1D(2147483647*n,a)}},e.prototype.generateZone=function(t,r){for(var a=0;a<this.zones.length;a++)if(this.zones[a].x===t&&this.zones[a].y===r)return a>0&&this.zones.unshift(this.zones.splice(a,1)[0]),this.zones[0];console.log("%czone("+t+","+r+")","color:#5f8cb0;text-decoration:underline");var o=e.random2D(t,r,e.initialSeeds[0]);for(this.tilemap.unset(),a=0;a<=this.zoneSize;a++)this.tilemap.set(a,0,f),this.tilemap.set(a,this.zoneSize,f),this.tilemap.set(0,a,f),this.tilemap.set(this.zoneSize,a,f);this.groupSampler.clear();var s=this.groupSampler.fill(o,10);for(a=0;a<s.length;a+=2)for(var c=1+s[a]|0,l=1+s[a+1]|0,u=-1;u<=1;u++)for(var h=-1;h<=1;h++)this.tilemap.set(c+u,l+h,f);for(var m=6;!this.tilemap.generate(o,-1);m--)if(m<=0)throw"zone("+t+","+r+")";var d={x:t,y:r,offsetX:t*this.zoneSize,offsetY:r*this.zoneSize,map:this.zones.length>=this.limit?this.zones.pop().map:null,data:null};d.map=this.tilemap.graphics(d.map),d.data=new Uint32Array(d.map.data.buffer),this.zones.unshift(d);var y=o()*s.length&-2;for(a=0;a<s.length;a+=2){var g=(c=1+s[a]|0)+(l=1+s[a+1]|0)*this.tilemap.width;if(0!=a){if(a===y){var x=n.AISystem.special(o());for(u=0;u<x.size;u++)for(h=0;h<x.size;h++)d.data[c+u+(l+h)*this.tilemap.width]=v+(u||h?0:x.value+1)}var b=n.AISystem.groups[o()*n.AISystem.groups.length|0];i.shuffle(b,o),this.stack.push(g),this.randomFill(d.data,b,o)}else d.data[g]=p,d.data[c+(l+2)*this.tilemap.width]=f}return d},e.prototype.randomFill=function(e,t,r){for(var i=u.Pathfinder.neighbours.cardinal,a=t.length-1;this.stack.length;){var n=r()*this.stack.length|0,o=this.stack[n]%this.tilemap.width,s=this.stack[n]/this.tilemap.width|0;if(n===this.stack.length-1?this.stack.length--:this.stack[n]=this.stack.pop(),(-256&e[o+s*this.tilemap.width])>>>0!==v&&(e[o+s*this.tilemap.width]=v+t[a]+1,--a<0))break;for(var c=i.length-1;c>=0;c--){var l=o+i[c][0],f=s+i[c][1];if(!(l<0||f<0||l>=this.tilemap.width||f>=this.tilemap.height)){var h=l+f*this.tilemap.width;this.flags[h]||(this.flags[h]=1,this.stack.push(h))}}}this.flags.fill(0),this.stack.length=0},e.prototype.sample=function(e,t){var r=Math.floor(e/this.zoneSize),i=Math.floor(t/this.zoneSize),a=this.generateZone(r,i),n=e-a.offsetX,o=t-a.offsetY;return a.data[n+o*a.map.width]},e.prototype.populate=function(t){var r=this,c=s.TerrainChunk.chunkTiles,l=e.random2D(t.column,t.row);t.terraform(i.aabb2.pad(s.TerrainChunk.bounds,1,e.region),(function(e,t){return 8*r.sampleDunes(.2*e,.2*t,173)}));for(var u=0;u<c;u++)for(var f=0;f<c;f++){var h=u-t.offsetX,y=f-t.offsetZ,g=this.sample(h,y);switch((-256&g)>>>0){case d:var x=this.sample(h-1,y)===d?8:0,b=this.sample(h+1,y)===d?2:0,S=this.sample(h,y-1)===d?1:0,P=this.sample(h,y+1)===d?4:0;t.wall.set(h,y,S|b|P|x,l()),this.context.get(o.TerrainSystem).setTile(h,y,t.wall);break;case m:this.context.get(a.EconomySystem).createDeposit(h,y);break;case p:this.context.get(a.EconomySystem).createWorkshop(h,y);break;case v:var O=255&g;if(!O)break;var T=i.pairSzudzik(h,y);this.context.get(n.AISystem).create(h,y,O-1,T)}}},e.prototype.sampleDunes=function(e,t,r){return(1*Math.pow(1-2*Math.abs(i.perlin2D(.5*e,.5*t,r)-.5),2)+2*Math.pow(1-2*Math.abs(i.perlin2D(.25*e,.25*t,r)-.5),2)+4*i.smoothstep(0,1,i.perlin2D(.2*e,.2*t,r)))/7},e.initialSeeds=[162594236,138634774,118064914,73388824,108683203,224993818,255459704,266957880,251508831,208836611,36465745,66614592,185526930,116401718,77449729,265749459,20448906,232077659,223955159,89084952,45972607,218806953,175579336,168396611],e.region=i.aabb2(),e}();t.LevelGenerator=g},3233:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MazeWall=void 0;var i=r(4454),a=r(821),n=r(8581),o=r(9336),s=r(7822),c=r(9940),l=r(9131),u=function(){function e(e){this.context=e,this.weight=0,this.batch=new c.ModelBatch(this.context,65535,65535)}return e.prototype.set=function(t,r,o,s){var c=e.orientations[o],l=c.rotation,u=c.models,f=this.context.get(a.TerrainSystem).tilePosition(t,r,e.position),h=i.mat4.fromRotationTranslationScale(l,f,i.vec3.ONE,e.transform),m=u[s*u.length|0],d=this.context.get(n.MeshSystem).models[m];if(!this.batch.render({format:d.geometry.format,vertices:d.geometry.vertexArray,indices:d.geometry.indexArray,transform:h}))throw new Error(m+"("+t+","+r+")")},e.prototype.build=function(){this.mesh=this.context.get(n.MeshSystem).create(),this.mesh.layer=2,this.batch.bind(),this.mesh.buffer=this.batch.buffer,this.mesh.transform=o.Transform.IDENTITY,this.mesh.material=s.SharedSystem.materials.mesh.metal},e.prototype.clear=function(){this.context.get(n.MeshSystem).delete(this.mesh)},e.prototype.delete=function(){},e.transform=i.mat4(),e.position=i.vec3(),e.orientations=[{rotation:l.DirectionAngle[3],models:["wall_O_0","wall_O_1"]},{rotation:l.DirectionAngle[0],models:["wall_U_0","wall_U_1","wall_U_2"]},{rotation:l.DirectionAngle[3],models:["wall_U_0","wall_U_1","wall_U_2"]},{rotation:l.DirectionAngle[0],models:["wall_L_0","wall_L_1"]},{rotation:l.DirectionAngle[2],models:["wall_U_0","wall_U_1","wall_U_2"]},{rotation:l.DirectionAngle[2],models:["wall_I_0","wall_I_1","wall_I_2","wall_I_3"]},{rotation:l.DirectionAngle[3],models:["wall_L_0","wall_L_1"]},{rotation:l.DirectionAngle[1],models:["wall_T_0"]},{rotation:l.DirectionAngle[1],models:["wall_U_0","wall_U_1","wall_U_2"]},{rotation:l.DirectionAngle[1],models:["wall_L_0","wall_L_1"]},{rotation:l.DirectionAngle[3],models:["wall_I_0","wall_I_1","wall_I_2","wall_I_3"]},{rotation:l.DirectionAngle[2],models:["wall_T_0"]},{rotation:l.DirectionAngle[2],models:["wall_L_0","wall_L_1"]},{rotation:l.DirectionAngle[3],models:["wall_T_0"]},{rotation:l.DirectionAngle[0],models:["wall_T_0"]},{rotation:l.DirectionAngle[3],models:["wall_X_0"]}],e}();t.MazeWall=u},1226:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pathfinder=void 0;var i=r(4967),a=r(4454),n=function(){function e(e,t){var r=this;this.context=e,this.size=t,this.heap=new i.BinaryHeap((function(e,t){return r.estimate[e]+r.distance[e]-(r.estimate[t]+r.distance[t])})),this.orderedQueue=new i.BinaryHeap((function(e,t){return r.distance[e]-r.distance[t]||r.estimate[e]-r.estimate[t]})),this.dirty=[],this.queue=[],this.parent=new Uint32Array(this.size*this.size),this.flags=new Uint8Array(this.size*this.size),this.distance=new Float32Array(this.size*this.size),this.estimate=new Float32Array(this.size*this.size),this.weight=new Float32Array(this.size*this.size).fill(-1),this.marked=new Float32Array(this.size*this.size),this.influence=new Uint32Array(this.size*this.size),this.offset=a.vec2(0,0)}return e.prototype.calculateSingleWeight=function(e,t,r,i){var a=this.weight[t[0]+t[1]*this.size];if(e[0]!==t[0]&&e[1]!==t[1]){var n=this.weight[e[0]+t[1]*this.size],o=this.weight[t[0]+e[1]*this.size];if(!n&&!o)return 0;a+=(Math.SQRT2-1)*Math.max(n,o)}return null!=i&&a>i?0:a},e.prototype.calculateAreaWeight=function(e,t,r,i){var a=t[0],n=t[0]+r[0],o=t[1],s=t[1]+r[1],c=t[0]-e[0],l=t[1]-e[1];0===c?l>0?o=Math.max(o,s-l):s=Math.min(s,o-l):0===l&&(c>0?a=Math.max(a,n-c):n=Math.min(n,a-c));for(var u=1,f=a;f<n;f++)for(var h=o;h<s;h++){var m=this.weight[f+h*this.size];if(!m)return 0;u=Math.max(u,m)}return null!=i&&u>i?0:u},e.prototype.tileIndex=function(e,t){return e+this.offset[0]+(t+this.offset[1])*this.size},e.prototype.indexTile=function(e,t){return t[0]=e%this.size-this.offset[0],t[1]=(e/this.size|0)-this.offset[1],t},e.prototype.add=function(e){this.dirty.push(this.tileIndex(e[0],e[1]))},e.prototype.search=function(t,r,i,n){for(var o=i?e.heuristic.diagonal:e.heuristic.manhattan,s=i?e.neighbours.diagonal:e.neighbours.cardinal,c=a.vec2.equals(a.vec2.ONE,r,0)?this.calculateSingleWeight:this.calculateAreaWeight,l=e.tile0,u=e.tile1,f=this.dirty.length-1;f>=0;f--){var h=this.dirty[f];this.flags[h]||(this.indexTile(h,l),this.estimate[h]=o(l,t),this.flags[h]|=1,this.heap.push(h))}for(var m=this.tileIndex(t[0],t[1]),d=this.heap.get(0);this.heap.length;){var p=this.heap.shift();if(p===m)break;for(this.flags[p]|=2,l[0]=p%this.size,l[1]=p/this.size|0,f=s.length-1;f>=0;f--)if(a.vec2.add(s[f],l,u),!(u[0]<0||u[1]<0||u[0]>=this.size||u[1]>=this.size)){var v=u[0]+u[1]*this.size,y=c.call(this,l,u,r,n);if(0==(2&this.flags[v])&&0!=y){var g=this.distance[p]+y,x=0!=(1&this.flags[v]);x&&g>=this.distance[v]||(this.parent[v]=p+1,this.distance[v]=g,x||(this.flags[v]|=1,a.vec2.subtract(u,this.offset,u),this.estimate[v]=o(u,t),this.dirty.push(v)),(this.estimate[v]===this.estimate[d]?this.distance[v]<this.distance[d]:this.estimate[v]<this.estimate[d])&&(d=v),x?this.heap.update(v):this.heap.push(v))}}}return d},e.prototype.linkPath=function(e){for(var t=[],r=e;r>=0;r=this.parent[r]-1)t.unshift(r);return t},e.prototype.walk=function(t,r,i,n,o,s){for(var c=n?e.neighbours.diagonal:e.neighbours.cardinal,l=a.vec2.equals(a.vec2.ONE,i,0)?this.calculateSingleWeight:this.calculateAreaWeight,u=s?this.orderedQueue:this.queue,f=e.tile0,h=e.tile1,m=this.dirty.length-1;m>=0;m--){var d=this.dirty[m];this.flags[d]||t.call(r,d,this.indexTile(d,f),0,-1,!0)&&(u.push(d),this.flags[d]=1)}for(;u.length;){var p=u.shift(),v=this.distance[p];for(f[0]=p%this.size,f[1]=p/this.size|0,m=c.length-1;m>=0;m--)if(a.vec2.add(c[m],f,h),!(h[0]<0||h[1]<0||h[0]>=this.size||h[1]>=this.size)){var y=h[0]+h[1]*this.size;0!=l.call(this,f,h,i,o)&&t.call(r,y,a.vec2.subtract(h,this.offset,h),v+1,p,!this.flags[y])&&1!==this.flags[y]&&(this.flags[y]=1,this.parent[y]=p+1,this.distance[y]=v+1,this.dirty.push(y),u.push(y))}}},e.prototype.clear=function(){for(this.heap.clear(),this.orderedQueue.clear(),this.queue.length=0;this.dirty.length;){var e=this.dirty.pop();this.estimate[e]=this.distance[e]=0,this.parent[e]=this.flags[e]=0}},e.heuristic={manhattan:a.vec2.manhattan,euclidean:a.vec2.distance,diagonal:function(e,t){var r=Math.abs(t[0]-e[0]),i=Math.abs(t[1]-e[1]);return Math.max(r,i)+(Math.SQRT2-1)*Math.min(r,i)}},e.neighbours={cardinal:[a.vec2(1,0),a.vec2(0,1),a.vec2(-1,0),a.vec2(0,-1)],diagonal:[a.vec2(1,0),a.vec2(1,1),a.vec2(0,1),a.vec2(-1,1),a.vec2(-1,0),a.vec2(-1,-1),a.vec2(0,-1),a.vec2(1,-1)]},e.tile0=a.vec2(),e.tile1=a.vec2(),e}();t.Pathfinder=n},8444:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoissonDisk=void 0;var r=function(){function e(e,t,r){this.width=e,this.height=t,this.radius=r,this.squaredRadius=this.radius*this.radius,this.cellSize=this.radius*Math.SQRT1_2,this.samples=[],this.stack=[],this.gridWidth=Math.ceil(this.width/this.cellSize),this.gridHeight=Math.ceil(this.height/this.cellSize),this.grid=new Uint32Array(this.gridWidth*this.gridHeight)}return e.prototype.fill=function(e,t){this.samples.length||this.add(e()*this.width,e()*this.height);var r=this.radius+1e-6,i=2*Math.PI/t;e:for(;this.stack.length>0;){for(var a=e()*this.stack.length|0,n=this.stack[a],o=this.samples[n-2],s=this.samples[n-1],c=2*e()*Math.PI,l=0;l<t;l++,c+=i){var u=o+Math.cos(c)*r,f=s+Math.sin(c)*r;if(!(u<0||f<0||u>=this.width||f>=this.height||this.overlap(u,f))){this.add(u,f);continue e}}this.stack[a]=this.stack[this.stack.length-1],this.stack.length--}return this.samples},e.prototype.add=function(e,t){var r=(e/this.cellSize|0)+(t/this.cellSize|0)*this.gridWidth;return this.samples.push(e,t),this.stack.push(this.samples.length),this.grid[r]=this.samples.length},e.prototype.overlap=function(t,r){for(var i=t/this.cellSize|0,a=r/this.cellSize|0,n=e.neighbourhood.length-1;n>=0;n--){var o=i+e.neighbourhood[n][0],s=a+e.neighbourhood[n][1];if(!(o<0||s<0||o>=this.gridWidth||s>=this.gridHeight)){var c=this.grid[o+s*this.gridWidth];if(0!=c){var l=t-this.samples[c-2],u=r-this.samples[c-1];if(l*l+u*u<this.squaredRadius)return!0}}}return!1},e.prototype.clear=function(){this.grid.fill(0),this.samples.length=this.stack.length=0},e.neighbourhood=[[0,0],[0,-1],[-1,0],[1,0],[0,1],[-1,-1],[1,-1],[-1,1],[1,1],[0,-2],[-2,0],[2,0],[0,2],[-1,-2],[1,-2],[-2,-1],[2,-1],[-2,1],[2,1],[-1,2],[1,2]],e}();t.PoissonDisk=r},821:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainSystem=void 0;var i=r(4454),a=r(9336),n=r(7463),o=r(1226),s=r(8586),c=function(){function e(e){this.context=e,this.positionOffset=-.5*s.TerrainChunk.chunkSize+.5*s.TerrainChunk.tileSize,this.gridSize=3,this.gridBounds=i.aabb2(),this.bounds=i.aabb2(),this.frame=0,this.chunks=Array(this.gridSize*this.gridSize),this.levelGenerator=new n.LevelGenerator(this.context,64),this.pathfinder=new o.Pathfinder(this.context,this.gridSize*s.TerrainChunk.chunkTiles)}return e.prototype.update=function(){var t=this.context.get(a.CameraSystem).controller,r=t.cameraTarget;if(0!=t.frame){var n=Math.floor(r[0]/s.TerrainChunk.chunkSize-.5*this.gridSize+1),o=Math.floor(r[2]/s.TerrainChunk.chunkSize-.5*this.gridSize+1);if(this.gridBounds[0]!=n||this.gridBounds[1]!=o||!this.frame){for(var c=this.chunks.length-1;c>=0;c--)if(y=this.chunks[c]){var l=y.column-n+(y.row-o)*this.gridSize;l!==c&&(y.column<n||y.row<o||y.column>=n+this.gridSize||y.row>=o+this.gridSize?(y.clear(),e.pool.push(y),this.chunks[c]=null):(this.chunks[c]=this.chunks[l],this.chunks[l]=y,c++))}this.frame=this.context.frame,i.aabb2.set(n,o,n+this.gridSize,o+this.gridSize,this.gridBounds),i.vec4.scale(this.gridBounds,s.TerrainChunk.chunkTiles,this.bounds);var u=this.pathfinder,f=u.offset,h=u.size,m=u.weight;i.vec2.set(-n*s.TerrainChunk.chunkTiles,-o*s.TerrainChunk.chunkTiles,f);for(var d=h-1;d>=0;d--)for(var p=h-1;p>=0;p--){var v=this.getTile(d-f[0],p-f[1]);m[d+p*h]=v?v.weight:1}for(d=this.gridSize-1;d>=0;d--)for(p=this.gridSize-1;p>=0;p--)if(!this.chunks[d+p*this.gridSize]){var y,g=d+n,x=p+o;(y=e.pool.pop()||new s.TerrainChunk(this.context)).column=g,y.row=x,y.offsetX=-g*s.TerrainChunk.chunkTiles,y.offsetZ=-x*s.TerrainChunk.chunkTiles,this.chunks[d+p*this.gridSize]=y,this.levelGenerator.populate(y),y.build()}}}},e.prototype.clear=function(){for(var t=this.chunks.length-1;t>=0;t--)this.chunks[t]&&(this.chunks[t].clear(),this.chunks[t]=void e.pool.push(this.chunks[t]));i.aabb2.copy(i.aabb2.INFINITE,this.bounds),this.frame=0},e.prototype.chunk=function(e,t){var r=Math.floor(e/s.TerrainChunk.chunkTiles)-this.gridBounds[0],i=Math.floor(t/s.TerrainChunk.chunkTiles)-this.gridBounds[1];return r<0||i<0||r>=this.gridSize||i>=this.gridSize?null:this.chunks[r+i*this.gridSize]},e.prototype.getTile=function(e,t){var r;return null===(r=this.chunk(e,t))||void 0===r?void 0:r.get(e,t)},e.prototype.setTile=function(e,t,r){var i;null===(i=this.chunk(e,t))||void 0===i||i.set(e,t,r),this.pathfinder.weight[this.pathfinder.tileIndex(e,t)]=r?r.weight:1},e.prototype.tilePosition=function(e,t,r){var i;return r[0]=s.TerrainChunk.tileSize*e+this.positionOffset,r[2]=s.TerrainChunk.tileSize*t+this.positionOffset,r[1]=(null===(i=this.chunk(e,t))||void 0===i?void 0:i.plane.sample(r[0],r[2]))||0,r},e.prototype.snapToGround=function(e){var t,r=Math.round((e[0]-this.positionOffset)/s.TerrainChunk.tileSize),i=Math.round((e[1]-this.positionOffset)/s.TerrainChunk.tileSize);e[1]=(null===(t=this.chunk(r,i))||void 0===t?void 0:t.plane.sample(e[0],e[2]))||0},e.pool=[],e}();t.TerrainSystem=c},8586:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainChunk=void 0;var i=r(4454),a=r(2572),n=r(3233),o=function(){function e(t){this.context=t,this.columns=e.chunkTiles,this.rows=e.chunkTiles,this.wall=new n.MazeWall(this.context),this.plane=new a.GroundPlane(this.context,this,e.chunkLOD,e.chunkLOD,e.chunkSize),this.grid=Array(this.columns*this.rows).fill(null)}return e.prototype.mapRegion=function(t,r){var a=e.chunkLOD+1;return r[0]=Math.floor((t[0]/e.chunkSize-this.column+.5)*a),r[1]=Math.floor((t[1]/e.chunkSize-this.row+.5)*a),r[2]=Math.floor((t[2]/e.chunkSize-this.column+.5)*a),r[3]=Math.floor((t[3]/e.chunkSize-this.row+.5)*a),i.aabb2.intersect(e.bounds,r,r)},e.prototype.terraform=function(t,r){for(var i=e.chunkLOD+1+2,a=e.chunkSize/e.chunkLOD,n=-.5*e.chunkSize+this.column*e.chunkSize,o=-.5*e.chunkSize+this.row*e.chunkSize,s=t[0];s<=t[2];s++)for(var c=t[1];c<=t[3];c++){var l=(s+1)*i+(c+1),u=n+s*a,f=o+c*a;this.plane.heightmap[l]=r(u,f)}},e.prototype.tileIndex=function(e,t){return e+this.offsetX+(t+this.offsetZ)*this.columns},e.prototype.get=function(e,t){var r=e+this.offsetX+(t+this.offsetZ)*this.columns;return this.grid[r]},e.prototype.set=function(e,t,r){var i=e+this.offsetX+(t+this.offsetZ)*this.columns;this.grid[i]=r},e.prototype.build=function(){this.plane.build(),this.wall.build()},e.prototype.clear=function(){this.grid.fill(null),this.plane.clear(),this.wall.clear()},e.chunkLOD=16,e.chunkSize=20,e.tileSize=2,e.chunkTiles=e.chunkSize/e.tileSize,e.bounds=i.aabb2(0,0,e.chunkLOD,e.chunkLOD),e}();t.TerrainChunk=o},5275:function(e,t){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.TileSetMapGenerator=t.TextureMapGenerator=void 0;var a=function(){function e(e,t,r,i,a){this.width=e,this.height=t,this.size=r,this.periodic=i,this.heuristic=a,this.lastVisited=0,this.stack=[]}return e.randomIndex=function(e,t,r){if(void 0===r&&(r=0),!r)for(var i=e.length-1;i>=0;i--)r+=e[i];for(t*=r,i=e.length-1;i>=0;i--)if((r-=e[i])<=t)return i},e.prototype.precalculate=function(){if(!this.wave){this.visited=new Int32Array(this.width*this.height),this.wave=new Uint8Array(this.visited.length*this.count),this.compatible=new Uint32Array(this.visited.length*this.count*4),this.distribution=new Float32Array(this.count),this.logWeights=new Float32Array(this.count),this.totalWeight=this.totalLogWeight=0;for(var e=0;e<this.count;e++)this.totalWeight+=this.weights[e],this.logWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.totalLogWeight+=this.logWeights[e];this.initialEntropy=Math.log(this.totalWeight)-this.totalLogWeight/this.totalWeight,this.remainders=new Int32Array(this.visited.length),this.nodeTotalWeight=new Float32Array(this.visited.length),this.nodeTotalLogWeight=new Float32Array(this.visited.length),this.entropies=new Float32Array(this.visited.length)}},e.prototype.generate=function(e,t){this.precalculate(),this.clear();for(var r=0;r<t||t<0;r++){var i=this.next(e);if(!(i>=0))break;if(this.visit(i,e),!this.propagate())return!1}for(var a=0;a<this.visited.length;a++)if(1==this.remainders[a])for(var n=0;n<this.count;n++)if(this.wave[a*this.count+n]){this.visited[a]=n;break}return!0},e.prototype.next=function(e){for(var t=1e3,r=-1,i=this.lastVisited;i<this.visited.length;i++)if((this.periodic||!(i%this.width+this.size>this.width||(i/this.width|0)+this.size>this.height))&&!(this.remainders[i]<=1)){if("scanline"===this.heuristic)return this.lastVisited=i+1,i;var a="entropy"==this.heuristic?this.entropies[i]:this.remainders[i];a>t||(a+=1e-6*e())>=t||(t=a,r=i)}return r},e.prototype.visit=function(t,r){for(var i=0,a=t*this.count,n=0;n<this.count;n++)i+=this.distribution[n]=this.wave[a+n]?this.weights[n]:0;var o=e.randomIndex(this.distribution,r(),i);for(n=0;n<this.count;n++)this.wave[a+n]&&n!=o&&this.remove(t,n)},e.prototype.propagate=function(){for(var t=e.dx,r=e.dy;this.stack.length;)for(var i=this.stack.pop(),a=this.stack.pop(),n=a%this.width,o=a/this.width|0,s=0;s<4;s++){var c=n+t[s],l=o+r[s];if(this.periodic||!(c<0||l<0||c+this.size>this.width||l+this.size>this.height)){c<0?c+=this.width:c>=this.width&&(c-=this.width),l<0?l+=this.height:l>=this.height&&(l-=this.height);for(var u=c+l*this.width,f=this.propagator[4*i+s],h=0;h<f.length;h++){var m=f[h];0==--this.compatible[4*(u*this.count+m)+s]&&this.remove(u,m)}}}return this.remainders[0]>0},e.prototype.remove=function(e,t){this.stack.push(e,t),this.wave[e*this.count+t]=0;for(var r=4*(e*this.count+t),i=0;i<4;i++)this.compatible[r+i]=0;this.remainders[e]-=1,this.nodeTotalWeight[e]-=this.weights[t],this.nodeTotalLogWeight[e]-=this.logWeights[t],this.entropies[e]=Math.log(this.nodeTotalWeight[e])-this.nodeTotalLogWeight[e]/this.nodeTotalWeight[e]},e.prototype.clear=function(){for(var t=this.lastVisited=0;t<this.visited.length;t++){this.remainders[t]=this.weights.length,this.nodeTotalWeight[t]=this.totalWeight,this.nodeTotalLogWeight[t]=this.totalLogWeight,this.entropies[t]=this.initialEntropy,this.visited[t]=-1;for(var r=t*this.count,i=0;i<this.count;i++){this.wave[r+i]=1;for(var a=4*(r+i),n=0;n<4;n++)this.compatible[a+n]=this.propagator[4*i+e.opposite[n]].length}}},e.dx=[-1,0,1,0],e.dy=[0,1,0,-1],e.opposite=[2,3,0,1],e}(),n=function(e){function t(r,i,n,o,s,c,l){var u=e.call(this,i,n,r,o,"min")||this;u.colors=[];for(var f=s.width,h=s.height,m=new Uint32Array(s.data.buffer),d=new Uint32Array(f*h),p={},v=0;v<h;v++)for(var y=0;y<f;y++){var g=m[y+v*f];null==p[g]&&(p[g]=u.colors.push(g)-1),d[y+v*f]=p[g]}for(var x={},b=[],S=Array(8),P=0;P<8;P++)S[P]=Array(r*r);var O=c?h:h-r+1;for(v=0;v<O;v++){var T=c?f:f-r+1;for(y=0;y<T;y++){t.extract(d,f,h,y,v,u.size,S[0]),t.copy(r,t.symmetries[4],S[0],S[1]),t.copy(r,t.symmetries[1],S[0],S[2]),t.copy(r,t.symmetries[5],S[0],S[3]),t.copy(r,t.symmetries[2],S[0],S[4]),t.copy(r,t.symmetries[6],S[0],S[5]),t.copy(r,t.symmetries[3],S[0],S[6]),t.copy(r,t.symmetries[7],S[0],S[7]);for(var w=0;w<l;w++){var _=u.patternHash(S[w]);x[_]?x[_]++:(x[_]=1,b.push(_))}}}for(u.count=b.length,u.patterns=new Array(u.count),u.weights=new Float32Array(u.count),P=0;P<u.count;P++)u.patterns[P]=u.hashPattern(b[P],Array(r*r)),u.weights[P]=x[b[P]];u.propagator=new Array(4*u.count);for(var A=0;A<4;A++)for(var E=0;E<u.count;E++)for(var M=u.propagator[4*E+A]=[],I=0;I<u.count;I++)t.overlap(u.patterns[E],u.patterns[I],a.dx[A],a.dy[A],r)&&M.push(I);return u}return i(t,e),t.copy=function(e,t,r,i){for(var a=0;a<e;a++)for(var n=0;n<e;n++)i[a+n*e]=r[t(a,n,e)];return i},t.extract=function(e,t,r,i,a,n,o){for(var s=0;s<n;s++)for(var c=0;c<n;c++)o[c+s*n]=e[(i+c)%t+(a+s)%r*t];return o},t.overlap=function(e,t,r,i,a){for(var n=r<0?0:r,o=r<0?r+a:a,s=i<0?i+a:a,c=i<0?0:i;c<s;c++)for(var l=n;l<o;l++)if(e[l+a*c]!=t[l-r+a*(c-i)])return!1;return!0},t.prototype.patternHash=function(e){for(var t=0,r=1,i=this.colors.length,a=e.length,n=0;n<a;n++,r*=i)t+=e[a-1-n]*r;return t},t.prototype.hashPattern=function(e,t){for(var r=this.colors.length,i=Math.pow(r,this.size*this.size-1),a=0;a<t.length;a++,i/=r)e-=(t[a]=e/i|0)*i;return t},t.prototype.graphics=function(e){if(!(this.visited[0]<0)){e=e||new ImageData(new Uint8ClampedArray(this.width*this.height*4),this.width,this.height);for(var t=new Uint32Array(e.data.buffer),r=0;r<this.height;r++)for(var i=r<this.height-this.size+1?0:this.size-1,a=0;a<this.width;a++){var n=a<this.width-this.size+1?0:this.size-1,o=this.colors[this.patterns[this.visited[a-n+(r-i)*this.width]][n+i*this.size]];t[a+r*this.width]=o}return e}},t.prototype.set=function(e,t,r){this.mask||(this.mask=new Array(this.width*this.height*this.count));for(var i=this.colors.indexOf(r),a=0;a<this.size;a++)for(var n=0;n<this.size;n++){var o=e-n,s=t-a;if(this.periodic||!(o+this.size>this.width||s+this.size>this.height||o<0||s<0)){o<0&&(o+=this.width),s<0&&(s+=this.height);for(var c=0;c<this.count;c++)this.patterns[c][n+a*this.size]!==i&&(this.mask[(o+s*this.width)*this.count+c]=!0)}}},t.prototype.unset=function(){this.mask||(this.mask=new Array(this.width*this.height*this.count)),this.mask.fill(!1)},t.prototype.clear=function(){if(e.prototype.clear.call(this),this.mask){for(var t=0;t<this.visited.length;t++)for(var r=0;r<this.count;r++)this.mask[t*this.count+r]&&this.remove(t,r);if(!this.propagate())throw"Impossible configuration"}},t.symmetries=[function(e,t,r){return e+t*r},function(e,t,r){return r-1-t+e*r},function(e,t,r){return r-1-e+(r-1-t)*r},function(e,t,r){return t+(r-1-e)*r},function(e,t,r){return r-1-e+t*r},function(e,t,r){return r-1-t+(r-1-e)*r},function(e,t,r){return e+(r-1-t)*r},function(e,t,r){return t+e*r}],t}(a);t.TextureMapGenerator=n;var o=function(e){function t(r,i,a,n){var o=e.call(this,i,a,1,n,"min")||this;o.tiles=[];for(var s=[],c=[],l=[],u=0;u<r.symmetry.length;u++){var f=t.symmetry[r.symmetry[u]],h=f.rotate,m=f.reflect,d=f.cardinality,p=l.length;c.push(p);for(var v=0;v<d;v++)l.push([p+v,p+h(v),p+h(h(v)),p+h(h(h(v))),p+m(v),p+m(h(v)),p+m(h(h(v))),p+m(h(h(h(v))))]),o.tiles.push(8*u+v),s.push(r.weight[u]||1)}o.count=l.length,o.weights=new Float32Array(s),o.propagator=new Array(4*o.count);var y=new Array(4*o.count*o.count);for(u=0;u<r.constraints.length;u++){var g=r.constraints[u],x=g[0],b=g[1],S=g[2],P=g[3],O=l[c[x]][b],T=l[O][1],w=l[c[S]][P],_=l[w][1];y[0+4*w+4*o.count*O]=!0,y[0+4*l[w][6]+4*o.count*l[O][6]]=!0,y[0+4*l[O][4]+4*o.count*l[w][4]]=!0,y[0+4*l[O][2]+4*o.count*l[w][2]]=!0,y[1+4*_+4*o.count*T]=!0,y[1+4*l[T][6]+4*o.count*l[_][6]]=!0,y[1+4*l[_][4]+4*o.count*l[T][4]]=!0,y[1+4*l[T][2]+4*o.count*l[_][2]]=!0}for(var A=0;A<o.count;A++)for(var E=0;E<o.count;E++)y[2+4*A+4*o.count*E]=y[0+4*E+4*o.count*A],y[3+4*A+4*o.count*E]=y[1+4*E+4*o.count*A];for(var M=0;M<4;M++)for(E=0;E<o.count;E++){var I=o.propagator[4*E+M]=[];for(A=0;A<o.count;A++)y[M+4*E+4*o.count*A]&&I.push(A);if(!I.length)throw"Tile "+(o.tiles[E]/8|0)+" has no neighbours in direction "+M}return o}return i(t,e),t.prototype.graphics=function(e,t){if(!(this.visited[0]<0)){var r=e[0].width;t=t||new ImageData(new Uint8ClampedArray(this.width*this.height*r*r*4),this.width*r,this.height*r);for(var i=new Uint32Array(t.data.buffer),a=new Uint32Array(r*r),o=0;o<this.width;o++)for(var s=0;s<this.height;s++){var c=this.tiles[this.visited[o+s*this.width]],l=c/8|0,u=c%8;n.copy(r,n.symmetries[u],new Uint32Array(e[l].data.buffer),a);for(var f=0;f<r;f++)for(var h=0;h<r;h++){var m=a[f+h*r];i[o*r+f+(s*r+h)*this.width*r]=m}}return t}},t.symmetry={L:{cardinality:4,rotate:function(e){return(e+1)%4},reflect:function(e){return e%2==0?e+1:e-1}},T:{cardinality:4,rotate:function(e){return(e+1)%4},reflect:function(e){return e%2==0?e:4-e}},I:{cardinality:2,rotate:function(e){return 1-e},reflect:function(e){return e}},"\\":{cardinality:2,rotate:function(e){return 1-e},reflect:function(e){return 1-e}},F:{cardinality:8,rotate:function(e){return e<4?(e+1)%4:4+(e-1)%4},reflect:function(e){return e<4?e+4:e-4}},X:{cardinality:1,rotate:function(e){return e},reflect:function(e){return e}}},t}(a);t.TileSetMapGenerator=o},3605:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(8586),t),a(r(7463),t),a(r(1226),t),a(r(821),t)},6327:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Decapod=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(296),f=r(6725),h=r(3605),m=r(7822),d=r(6888),p=r(4783),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new p.MortarSkill(t.context)],t.strategy=new d.AIStrategy(t.context),t.health={capacity:2,amount:0,gain:0},t.action={capacity:1,amount:0,gain:1},t.movement={capacity:1,amount:0,gain:.5},t.group=2,t.movementDuration=.4,t}return a(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("decapod"),this.mesh.transform=this.context.get(c.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),m.ModelAnimation("activate")(0,this.mesh.armature),this.markTiles(!0)},t.prototype.delete=function(){this.skills[0].deactivate(!0).next(),this.dust=void m.SharedSystem.particles.dust.remove(this.dust),this.context.get(c.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),t.pool.push(this)},t.prototype.deactivate=function(){return this.skills[0].deactivate()},t.prototype.move=function(e,t){var r,i,a,s,d,p;return n(this,(function(n){switch(n.label){case 0:this.shadow=this.context.get(u.DecalPass).create(4),this.shadow.transform=this.context.get(c.TransformSystem).create(),this.shadow.transform.parent=this.mesh.transform,this.shadow.material=m.SharedSystem.materials.decal.glow,this.dust=this.dust||m.SharedSystem.particles.dust.add({uOrigin:o.vec3.ZERO,uTarget:o.vec3.ZERO,uLifespan:[.6,1.2,0,0],uSize:[2,4],uRadius:[0,.2],uOrientation:o.quat.IDENTITY,uForce:[2,5],uGravity:o.vec3.ZERO,uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]}),r=f.AnimationTimeline(this,{"shadow.color":f.PropertyAnimation([{frame:0,value:[.4,.6,1,.4]}],o.vec4.lerp),"shadow.transform.scale":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[6,6,6],ease:f.ease.quadOut}],o.vec3.lerp),"mesh.transform.position":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.4,0],ease:f.ease.cubicOut}],f.BlendTween.vec3),"mesh.transform.rotation":f.PropertyAnimation([{frame:0,value:o.quat.IDENTITY},{frame:1,value:o.quat.axisAngle(o.vec3.AXIS_X,.1*Math.PI,o.quat()),ease:f.ease.sineOut}],f.BlendTween.quat)}),this.context.get(h.TerrainSystem).tilePosition(e[e.length-1][0],e[e.length-1][1],this.dust.uniform.uniforms.uOrigin),i=f.EventTrigger([{frame:t[t.length-1]-.5*this.movementDuration,value:16}],f.EventTrigger.emit),this.context.get(l.AudioSystem).create("assets/unit_land.mp3","sfx",this.mesh.transform).volume(0,.5).play(t[t.length-1]-.2),a=this.moveAlongPath(e,t,!0),s=this.context.currentTime,n.label=1;case 1:return d=a.next(),p=this.context.currentTime-s,r(this.movementFloat,this.context.deltaTime),i(p,this.context.deltaTime,this.dust),d.done?[3,5]:[3,2];case 2:return[4,d.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(c.TransformSystem).delete(this.shadow.transform),this.shadow=void this.context.get(u.DecalPass).delete(this.shadow),[2]}}))},t.pool=[],t}(d.AIUnit);t.Decapod=v},3524:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Isopod=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(296),f=r(6725),h=r(3605),m=r(7822),d=r(6888),p=r(144),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new p.StaticOrbSkill(t.context)],t.strategy=new d.AIStrategy(t.context),t.health={capacity:6,amount:0,gain:0},t.action={capacity:1,amount:0,gain:.25},t.movement={capacity:1,amount:0,gain:.5},t.group=2,t.movementDuration=.4,t}return a(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("isopod"),this.mesh.transform=this.context.get(c.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),m.ModelAnimation("activate")(0,this.mesh.armature),this.markTiles(!0)},t.prototype.delete=function(){this.dust=void m.SharedSystem.particles.dust.remove(this.dust),this.context.get(c.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),t.pool.push(this)},t.prototype.move=function(e,t){var r,i,a,s,d,p;return n(this,(function(n){switch(n.label){case 0:this.shadow=this.context.get(u.DecalPass).create(4),this.shadow.transform=this.context.get(c.TransformSystem).create(),this.shadow.transform.parent=this.mesh.transform,this.shadow.material=m.SharedSystem.materials.decal.glow,this.dust=this.dust||m.SharedSystem.particles.dust.add({uOrigin:o.vec3.ZERO,uTarget:o.vec3.ZERO,uLifespan:[.6,1.2,0,0],uSize:[2,4],uRadius:[0,.2],uOrientation:o.quat.IDENTITY,uForce:[2,5],uGravity:o.vec3.ZERO,uRotation:[0,2*Math.PI],uAngular:[-Math.PI,Math.PI,0,0]}),r=f.AnimationTimeline(this,{"shadow.transform.scale":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[6,6,6],ease:f.ease.quadOut}],o.vec3.lerp),"shadow.color":f.PropertyAnimation([{frame:0,value:[.4,.6,1,.4]}],o.vec4.lerp),"mesh.transform.position":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,1,0],ease:f.ease.quartOut}],f.BlendTween.vec3)}),this.context.get(h.TerrainSystem).tilePosition(e[e.length-1][0],e[e.length-1][1],this.dust.uniform.uniforms.uOrigin),i=f.EventTrigger([{frame:t[t.length-1]-.1,value:16}],f.EventTrigger.emit),this.context.get(l.AudioSystem).create("assets/unit_land.mp3","sfx",this.mesh.transform).volume(0,1).play(t[t.length-1]-.2),a=this.moveAlongPath(e,t,!0),s=this.context.currentTime,n.label=1;case 1:return d=a.next(),p=this.context.currentTime-s,r(this.movementFloat,this.context.deltaTime),i(p,this.context.deltaTime,this.dust),d.done?[3,5]:[3,2];case 2:return[4,d.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(c.TransformSystem).delete(this.shadow.transform),this.shadow=void this.context.get(u.DecalPass).delete(this.shadow),[2]}}))},t.pool=[],t}(d.AIUnit);t.Isopod=v},7005:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Locust=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(6725),f=r(296),h=r(7822),m=r(6888),d=r(7576),p=r(6907),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=o.vec2(2,2),t.skills=[new d.FlamethrowerSkill(t.context),new p.ShieldLinkSkill(t.context)],t.strategy=new m.AIStrategy(t.context),t.health={capacity:8,amount:0,gain:0},t.action={capacity:1,amount:0,gain:1},t.movement={capacity:1,amount:0,gain:.25},t.group=2,t.movementDuration=.8,t}return a(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("locust"),this.mesh.transform=this.context.get(c.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),h.ModelAnimation("activate")(0,this.mesh.armature),this.markTiles(!0)},t.prototype.delete=function(){this.skills[1].deactivate(!0).next(),this.context.get(c.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),t.pool.push(this)},t.prototype.deactivate=function(){return this.skills[1].deactivate()},t.prototype.execute=function(t){var r=[];return this.skills[1].active&&(t.delay+=1,r.unshift(this.deactivate())),r.push(e.prototype.execute.call(this,t)),this.skills[1].query(this).length>=2&&!this.skills[1].active&&(this.movement.amount=0,r.push(this.skills[1].use(this,null))),u.AnimationSystem.join(r)},t.prototype.move=function(e,t){var r,i,a;return n(this,(function(n){switch(n.label){case 0:this.motorLeft=s.BatchMesh.create(h.SharedSystem.geometry.lowpolyCylinder),this.motorLeft.material=h.SharedSystem.materials.effect.stripes,this.motorLeft.transform=this.context.get(c.TransformSystem).create([1.3,.7,1.2],o.quat.HALF_X,[1,-1.6,1],this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.motorLeft),this.motorRight=s.BatchMesh.create(h.SharedSystem.geometry.lowpolyCylinder),this.motorRight.material=h.SharedSystem.materials.effect.stripes,this.motorRight.transform=this.context.get(c.TransformSystem).create([-1.3,.7,1.2],o.quat.HALF_X,[1,-1.6,1],this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.motorRight),r=u.AnimationTimeline(this,{"motorLeft.color":u.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:1,value:[.5,.3,.8,1],ease:u.ease.cubicOut}],o.vec4.lerp),"motorRight.color":u.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:1,value:[.5,.3,.8,1],ease:u.ease.cubicOut}],o.vec4.lerp)}),this.context.get(l.AudioSystem).create("assets/unit_move.mp3","sfx",this.mesh.transform).play(0),i=this.moveAlongPath(e,t,!0),n.label=1;case 1:return a=i.next(),r(this.movementFloat,this.context.deltaTime),a.done?[3,5]:[3,2];case 2:return[4,a.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(c.TransformSystem).delete(this.motorLeft.transform),this.context.get(c.TransformSystem).delete(this.motorRight.transform),this.context.get(f.ParticleEffectPass).remove(this.motorLeft),this.context.get(f.ParticleEffectPass).remove(this.motorRight),this.motorLeft=void s.BatchMesh.delete(this.motorLeft),this.motorRight=void s.BatchMesh.delete(this.motorRight),[2]}}))},t.pool=[],t}(m.AIUnit);t.Locust=v},2127:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Monolith=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(296),f=r(6725),h=r(7822),m=r(6888),d=r(9131),p=r(8771),v=r(2856),y=r(7153),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=o.vec2(3,3),t.skills=[new v.TurretSkill(t.context),new y.SpawnerSkill(t.context),new p.ShockwaveSkill(t.context)],t.strategy=new m.AIStrategy(t.context),t.health={capacity:12,amount:0,gain:0},t.action={capacity:1,amount:0,gain:1},t.movement={capacity:1,amount:0,gain:.2},t.group=2,t.movementDuration=1,t}return a(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("monolith"),this.mesh.transform=this.context.get(c.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),h.ModelAnimation("activate")(0,this.mesh.armature),this.markTiles(!0)},t.prototype.delete=function(){this.context.get(c.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),t.pool.push(this)},t.prototype.execute=function(t){var r=[e.prototype.execute.call(this,t)],i=o.vec2.subtract(this.tile,o.vec2.ONE,o.vec2());if(!t.path){var a=this.skills[1];console.log(p.ShockwaveSkill.queryArea(this.context,i,0,8,2)),a.validate(this.tile,null)&&(p.ShockwaveSkill.queryArea(this.context,i,0,8,2).length>4||r.push(a.use(this,null)))}if(!t.path&&-1==t.skill){a=this.skills[2];var n=this.context.get(d.PlayerSystem).cube;a.validate(this.tile,n.tile)&&r.push(a.use(this,n.tile))}return f.AnimationSystem.join(r)},t.prototype.move=function(e,t){var r,i,a;return n(this,(function(n){switch(n.label){case 0:this.glow=s.BatchMesh.create(h.SharedSystem.geometry.openBox),this.glow.material=h.SharedSystem.materials.gradientMaterial,this.glow.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.glow),this.light=this.context.get(u.PointLightPass).create(),this.light.transform=this.context.get(c.TransformSystem).create([0,2,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),r=f.AnimationTimeline(this,{"glow.transform.scale":f.PropertyAnimation([{frame:0,value:[6,0,6]},{frame:1,value:[6,3,6],ease:f.ease.quadOut}],o.vec3.lerp),"glow.color":f.PropertyAnimation([{frame:0,value:[1,0,.5,1]},{frame:.5,value:[.5,.7,1,.2],ease:f.ease.sineIn}],o.vec4.lerp),"light.color":f.PropertyAnimation([{frame:0,value:[1,0,.5]},{frame:.5,value:[.5,.7,1],ease:f.ease.sineIn}],o.vec3.lerp),"light.radius":f.PropertyAnimation([{frame:0,value:0},{frame:1,value:6,ease:f.ease.cubicOut}],o.lerp),"light.intensity":f.PropertyAnimation([{frame:0,value:0},{frame:1,value:8,ease:f.ease.sineOut}],o.lerp),"mesh.transform.position":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.2,0],ease:f.ease.sineInOut}],f.BlendTween.vec3)}),this.context.get(l.AudioSystem).create("assets/unit_move.mp3","sfx",this.mesh.transform).play(0),i=this.moveAlongPath(e,t,!1),n.label=1;case 1:return a=i.next(),r(this.movementFloat,this.context.deltaTime),a.done?[3,5]:[3,2];case 2:return[4,a.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(c.TransformSystem).delete(this.light.transform),this.context.get(c.TransformSystem).delete(this.glow.transform),this.light=void this.context.get(u.PointLightPass).delete(this.light),this.context.get(u.ParticleEffectPass).remove(this.glow),this.glow=void s.BatchMesh.delete(this.glow),[2]}}))},t.pool=[],t}(m.AIUnit);t.Monolith=g},7066:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Obelisk=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6725),u=r(7822),f=r(6888),h=r(3605),m=r(9131),d=r(8046),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new d.LaserSkill(t.context)],t.strategy=new f.AIStrategy(t.context),t.health={capacity:6,amount:0,gain:0},t.action={capacity:1,amount:0,gain:1},t.movement={capacity:1,amount:0,gain:.2},t.group=2,t.movementDuration=.6,t.expanded=!1,t}return a(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("obelisk"),this.mesh.transform=this.context.get(c.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),u.ModelAnimation("activate")(0,this.mesh.armature),this.markTiles(!0)},t.prototype.delete=function(){this.skills[0].deactivate(!0).next(),this.context.get(c.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),t.pool.push(this)},t.prototype.execute=function(t){if(this.expanded&&t.path){this.markTiles(!1),this.expanded=!1,t.delay+=1;for(var r=this.context.get(h.TerrainSystem).pathfinder,i=this.context.currentTime+2*this.movementDuration+t.delay,a=0;a<m.DirectionTile.length;a++)r.marked[r.tileIndex(this.tile[0]+m.DirectionTile[a][0],this.tile[1]+m.DirectionTile[a][1])]=i}var n=e.prototype.execute.call(this,t);return-1!=t.skill&&this.markTiles(this.expanded=!0),n},t.prototype.markTiles=function(e){var t=this.context.get(h.TerrainSystem);if(t.setTile(this.tile[0],this.tile[1],e?this:null),this.expanded)for(var r=0;r<m.DirectionTile.length;r++)t.setTile(this.tile[0]+m.DirectionTile[r][0],this.tile[1]+m.DirectionTile[r][1],e?this:null),e&&this.context.get(m.TurnBasedSystem).signalEnterTile.broadcast(this.tile[0]+m.DirectionTile[r][0],this.tile[1]+m.DirectionTile[r][1],this)},t.prototype.deactivate=function(){return this.skills[0].deactivate()},t.prototype.move=function(e,t){var r,i,a;return n(this,(function(n){switch(n.label){case 0:i=this.deactivate(),n.label=1;case 1:return(a=i.next()).done?[3,5]:[3,2];case 2:return[4,a.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:r=l.AnimationTimeline(this,{"mesh.transform.position":l.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.5,0],ease:l.ease.sineOut}],l.BlendTween.vec3)}),i=this.moveAlongPath(e,t,!1),n.label=6;case 6:return a=i.next(),r(this.movementFloat,this.context.deltaTime),a.done?[3,10]:[3,7];case 7:return[4,a.value];case 8:n.sent(),n.label=9;case 9:return[3,6];case 10:return[2]}}))},t.pool=[],t}(f.AIUnit);t.Obelisk=p},1744:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Scarab=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6725),u=r(7822),f=r(6888),h=r(1086),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new h.StrikeSkill(t.context)],t.strategy=new f.AIStrategy(t.context),t.health={capacity:2,amount:0,gain:0},t.action={capacity:1,amount:0,gain:1},t.movement={capacity:3,amount:0,gain:3},t.group=2,t.movementDuration=.4,t}return a(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("scarab"),this.mesh.transform=this.context.get(c.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),u.ModelAnimation("activate")(0,this.mesh.armature),this.markTiles(!0)},t.prototype.delete=function(){this.context.get(c.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),t.pool.push(this)},t.prototype.move=function(e,t){var r,i,a;return n(this,(function(n){switch(n.label){case 0:r=l.AnimationTimeline(this,{"mesh.transform.position":l.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.2,0],ease:l.ease.quadIn}],l.BlendTween.vec3),"mesh.transform.rotation":l.PropertyAnimation([{frame:0,value:o.quat.IDENTITY},{frame:1,value:o.quat.axisAngle(o.vec3.AXIS_X,.04*Math.PI,o.quat()),ease:l.ease.sineIn}],l.BlendTween.quat)}),i=this.moveAlongPath(e,t,!0),n.label=1;case 1:return a=i.next(),r(this.movementFloat,this.context.deltaTime),a.done?[3,5]:[3,2];case 2:return[4,a.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return[2]}}))},t.pool=[],t}(f.AIUnit);t.Scarab=m},7037:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stingray=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6725),u=r(7822),f=r(6888),h=r(1408),m=r(1517);function d(e,t){var r=e.amplitude,i=e.frequency,a=o.vec3();return function(e,n){return a[0]=r[0]*Math.cos(this.context.currentTime*i[0])*e,a[1]=r[1]*Math.cos(this.context.currentTime*i[1])*e,a[2]=r[2]*Math.cos(this.context.currentTime*i[2])*e,t(a,n,n)}}var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new h.LungeSkill(t.context)],t.strategy=new f.AIStrategy(t.context),t.health={capacity:4,amount:0,gain:0},t.action={capacity:1,amount:0,gain:1},t.movement={capacity:2,amount:0,gain:2},t.group=2,t.movementDuration=.4,t}return a(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("stingray"),this.mesh.transform=this.context.get(c.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),u.ModelAnimation("activate")(0,this.mesh.armature),this.markTiles(!0);var r=new m.SnakeRig(this.context);r.build(this.mesh),this.mesh.armature.ik=r},t.prototype.delete=function(){this.context.get(c.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),t.pool.push(this)},t.prototype.damage=function(t,r){e.prototype.damage.call(this,t,r),this.health.amount<=0&&(this.mesh.armature.ik.enabled=!1)},t.prototype.move=function(e,t){var r,i,a;return n(this,(function(n){switch(n.label){case 0:r=l.AnimationTimeline(this,{"mesh.transform.position":d({amplitude:[0,.1,0],frequency:[0,7.1,0]},o.vec3.add),"mesh.transform.rotation":(s=d({amplitude:[.2,.2,0],frequency:[6.3,7.1,0]},o.vec3.copy),c=o.vec3(),u=o.quat(),function(e,t){return s.call(this,e,c),c[2]+=2,o.vec3.normalize(c,c),o.quat.unitRotation(o.vec3.AXIS_Z,c,u),o.quat.multiply(t,u,t)})}),i=this.moveAlongPath(e,t,!0),n.label=1;case 1:return a=i.next(),r(this.movementFloat,this.context.deltaTime),a.done?[3,5]:[3,2];case 2:return[4,a.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return[2]}var s,c,u}))},t.pool=[],t}(f.AIUnit);t.Stingray=p},7485:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.TarantulaVariant=t.Tarantula=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6725),u=r(7822),f=r(6888),h=r(9413),m=r(364),d=r(5450),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new m.WaveSkill(t.context)],t.strategy=new f.AIStrategy(t.context),t.health={capacity:4,amount:0,gain:0},t.action={capacity:1,amount:0,gain:1},t.movement={capacity:1,amount:0,gain:1},t.group=2,t.movementDuration=.8,t}return a(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("tarantula"),this.mesh.transform=this.context.get(c.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),u.ModelAnimation("activate")(0,this.mesh.armature),this.markTiles(!0);var r=new h.Spider4Rig(this.context);r.build(this.mesh),this.mesh.armature.ik=r},t.prototype.delete=function(){this.context.get(c.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),t.pool.push(this)},t.prototype.move=function(e,t){var r,i,a;return n(this,(function(n){switch(n.label){case 0:r=l.AnimationTimeline(this,{"mesh.transform.position":l.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.5,0],ease:l.ease.sineOut}],l.BlendTween.vec3)}),i=this.moveAlongPath(e,t,!1),n.label=1;case 1:return a=i.next(),r(this.movementFloat,this.context.deltaTime),a.done?[3,5]:[3,2];case 2:return[4,a.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return[2]}}))},t.pool=[],t}(f.AIUnit);t.Tarantula=p;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.skills=[new d.ProjectileSkill(t.context)],t.strategy=new f.AIStrategy(t.context),t.health={capacity:4,amount:0,gain:0},t.action={capacity:1,amount:0,gain:.5},t.movement={capacity:1,amount:0,gain:1},t.group=2,t.movementDuration=.8,t}return a(t,e),t.prototype.place=function(e,t){this.mesh=this.context.get(s.MeshSystem).loadModel("tarantula"),this.mesh.transform=this.context.get(c.TransformSystem).create(),this.snapPosition(o.vec2.set(e,t,this.tile),this.mesh.transform.position),u.ModelAnimation("activateVariant")(0,this.mesh.armature),this.markTiles(!0);var r=new h.Spider4Rig(this.context);r.build(this.mesh),this.mesh.armature.ik=r},t.prototype.delete=function(){this.context.get(c.TransformSystem).delete(this.mesh.transform),this.mesh=void this.context.get(s.MeshSystem).delete(this.mesh),t.pool.push(this)},t.prototype.move=function(e,t){var r,i,a;return n(this,(function(n){switch(n.label){case 0:r=l.AnimationTimeline(this,{"mesh.transform.position":l.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:1,value:[0,.5,0],ease:l.ease.sineOut}],l.BlendTween.vec3)}),i=this.moveAlongPath(e,t,!1),n.label=1;case 1:return a=i.next(),r(this.movementFloat,this.context.deltaTime),a.done?[3,5]:[3,2];case 2:return[4,a.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return[2]}}))},t.pool=[],t}(f.AIUnit);t.TarantulaVariant=v},870:function(e,t,r){"use strict";var i,a=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.DamageEffect=void 0;var n=r(4454),o=r(8581),s=r(296),c=r(9336),l=r(6365),u=r(6725),f=r(7822),h=((i={})[1]={embers:u.EventTrigger([{frame:0,value:24}],u.EventTrigger.emit),"ring.transform.scale":u.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.3,value:[8,8,8],ease:u.ease.cubicOut}],n.vec3.lerp),"ring.color":u.PropertyAnimation([{frame:0,value:[1,.8,.5,.4]},{frame:.3,value:n.vec4.ZERO,ease:u.ease.sineIn}],n.vec4.lerp)},i[2]={sparks:u.EventTrigger([{frame:0,value:24}],u.EventTrigger.emit),"sphere.transform.scale":u.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.4,value:[3,3,3],ease:u.ease.cubicOut}],n.vec3.lerp),"sphere.color":u.PropertyAnimation([{frame:0,value:[.5,1,1,.8]},{frame:.4,value:n.vec4.ZERO,ease:u.ease.sineIn}],n.vec4.lerp)},i[8]={fire:u.EventTrigger([{frame:0,value:24}],u.EventTrigger.emit)},i[4]={"flash.transform.scale":u.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.6,value:[6,6,6],ease:u.ease.quartOut}],n.vec3.lerp),"flash.color":u.PropertyAnimation([{frame:0,value:n.vec4.ONE},{frame:.6,value:n.vec4.ZERO,ease:u.ease.sineIn}],n.vec4.lerp),"wave.transform.scale":u.PropertyAnimation([{frame:0,value:n.vec3.ZERO},{frame:.4,value:[6,6,6],ease:u.ease.quartOut}],n.vec3.lerp),"wave.color":u.PropertyAnimation([{frame:0,value:[.6,.8,1,.4]},{frame:.4,value:n.vec4.ZERO,ease:u.ease.quadIn}],n.vec4.lerp)},i),m=function(){function e(e){this.context=e,this.origin=n.vec3()}return e.create=function(t,r,i){var a=this.pool.pop()||new e(t);return t.get(u.AnimationSystem).start(a.damage(r,i),!0),a},e.prototype.damage=function(t,r){var i,m,d,p,v,y;return a(this,(function(a){switch(a.label){case 0:i=n.vec3.add(n.vec3.AXIS_Y,t.mesh.transform.position,this.origin),m={},1&r&&(this.embers=f.SharedSystem.particles.embers.add({uLifespan:[.4,.6,0,0],uOrigin:i,uRotation:n.vec2.ZERO,uOrientation:n.quat.IDENTITY,uGravity:[0,-10,0],uSize:[.2,.8],uRadius:[0,1],uForce:[8,16],uTarget:[0,-.2,0]}),this.ring=o.Sprite.create(0),this.ring.material=f.SharedSystem.materials.sprite.burst,this.ring.transform=this.context.get(c.TransformSystem).create(i,n.quat.HALF_X,n.vec3.ONE),this.context.get(s.ParticleEffectPass).add(this.ring),Object.assign(m,h[1])),2&r&&(this.sparks=f.SharedSystem.particles.sparks.add({uLifespan:[.4,.6,0,0],uOrigin:i,uTarget:n.vec3.ZERO,uForce:[6,12],uGravity:[0,-10,0],uRadius:[0,.4],uSize:[.2,.8],uLength:[.2,.4]}),this.sphere=o.BatchMesh.create(f.SharedSystem.geometry.lowpoly.sphere,0),this.sphere.material=f.SharedSystem.materials.effect.energyPurple,this.sphere.transform=this.context.get(c.TransformSystem).create(i,n.quat.IDENTITY,n.vec3.ONE),this.context.get(s.ParticleEffectPass).add(this.sphere),Object.assign(m,h[2])),8&r&&(this.fire=f.SharedSystem.particles.fire.add({uLifespan:[.4,.6,0,0],uOrigin:i,uRadius:[0,1],uSize:[.5,2],uGravity:[0,6,0],uRotation:n.vec2.ZERO}),Object.assign(m,h[8])),4&r&&(this.flash=o.Sprite.create(2),this.flash.material=f.SharedSystem.materials.beamRadialYellowMaterial,this.flash.transform=this.context.get(c.TransformSystem).create(i,n.quat.IDENTITY,n.vec3.ONE),this.context.get(s.ParticleEffectPass).add(this.flash),this.wave=o.Sprite.create(2),this.wave.material=f.SharedSystem.materials.sprite.ring,this.wave.transform=this.context.get(c.TransformSystem).create(i,n.quat.HALF_X,n.vec3.ONE),this.context.get(s.ParticleEffectPass).add(this.wave),Object.assign(m,h[4])),d=u.AnimationTimeline(this,m),this.context.get(l.AudioSystem).create("assets/unit_damage.mp3","sfx",t.mesh.transform).play(0,n.randomFloat(.84,1.16,f.SharedSystem.random())),p=.8,v=this.context.currentTime,a.label=1;case 1:return y=this.context.currentTime-v,d(y,this.context.deltaTime),y>p?[3,5]:[3,2];case 2:return[4,u.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:return 1&r&&(this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(s.ParticleEffectPass).remove(this.ring),o.Sprite.delete(this.ring),f.SharedSystem.particles.embers.remove(this.embers)),2&r&&(this.context.get(c.TransformSystem).delete(this.sphere.transform),this.context.get(s.ParticleEffectPass).remove(this.sphere),o.BatchMesh.delete(this.sphere),f.SharedSystem.particles.sparks.remove(this.sparks)),8&r&&f.SharedSystem.particles.fire.remove(this.fire),4&r&&(this.context.get(c.TransformSystem).delete(this.flash.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(s.ParticleEffectPass).remove(this.flash),this.context.get(s.ParticleEffectPass).remove(this.wave),o.Sprite.delete(this.flash),o.Sprite.delete(this.wave)),e.pool.push(this),[2]}}))},e.pool=[],e}();t.DamageEffect=m},1085:function(e,t,r){"use strict";var i=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.DeathEffect=void 0;var a=r(4454),n=r(757),o=r(8581),s=r(296),c=r(9336),l=r(6365),u=r(6725),f=r(7822),h=r(6888),m=function(){function e(e){this.context=e,this.material=new n.MeshMaterial}return e.create=function(t,r){var i=this.pool.pop()||new e(t);return t.get(h.AISystem).remove(r),t.get(u.AnimationSystem).start(i.use(r),!0),i},e.prototype.use=function(t){var r,h,m,d,p,v,y;return i(this,(function(i){switch(i.label){case 0:r=t.deactivate(),i.label=1;case 1:return(h=r.next()).done?[3,5]:[3,2];case 2:return[4,h.value];case 3:i.sent(),i.label=4;case 4:return[3,1];case 5:this.mesh=t.mesh,n.MeshMaterial.copy(this.mesh.material,this.material),this.material.program=f.SharedSystem.materials.program.dissolve,this.mesh.material=this.material,this.burn=this.context.get(s.DecalPass).create(4),this.burn.transform=this.context.get(c.TransformSystem).create(a.vec3.ZERO,a.quat.IDENTITY,a.vec3.ONE,this.mesh.transform),this.burn.material=f.SharedSystem.materials.decal.glow,this.wave=o.Sprite.create(0),this.wave.material=f.SharedSystem.materials.distortion.wave,this.wave.transform=this.context.get(c.TransformSystem).create(a.vec3.add([0,.5,0],this.mesh.transform.position,a.vec3()),a.quat.HALF_X,a.vec3.ONE),this.context.get(s.PostEffectPass).add(this.wave),this.ring=o.Sprite.create(0),this.ring.material=f.SharedSystem.materials.sprite.burst,this.ring.transform=this.context.get(c.TransformSystem).create(a.vec3.add([0,.5,0],this.mesh.transform.position,a.vec3()),a.quat.HALF_X,a.vec3.ONE),this.context.get(s.ParticleEffectPass).add(this.ring),this.light=this.context.get(s.PointLightPass).create(),this.light.transform=this.context.get(c.TransformSystem).create([0,1.5,0],a.quat.IDENTITY,a.vec3.ONE,this.mesh.transform),this.pillar=o.Sprite.create(3,0,a.vec4.ONE,[0,.5]),this.pillar.transform=this.context.get(c.TransformSystem).create(a.vec3.ZERO,a.quat.IDENTITY,a.vec3.ONE,this.mesh.transform),this.pillar.material=f.SharedSystem.materials.sprite.dust,this.context.get(s.ParticleEffectPass).add(this.pillar),this.spikes=f.SharedSystem.particles.spikes.add({uLifespan:[.4,.8,-.1,0],uOrigin:this.mesh.transform.position,uGravity:a.vec3.ZERO,uSize:[1*t.size[0],4*t.size[0]],uRotation:a.vec2.ZERO,uForce:[2,6],uTarget:[0,-.2,0],uRadius:[.2,.2],uFrame:[0,2]}),m=u.AnimationTimeline(this,{spikes:u.EventTrigger([{frame:0,value:8*t.size[0]}],(function(e,t){return e.count+=t})),"pillar.transform.scale":u.PropertyAnimation([{frame:.1,value:[0,3,0]},{frame:.3,value:[2,6,2],ease:u.ease.cubicOut},{frame:.8,value:[4,1,4],ease:u.ease.sineIn}],a.vec3.lerp),"pillar.color":u.PropertyAnimation([{frame:.1,value:[.1,.02,.05,1]},{frame:.8,value:a.vec4.ZERO,ease:u.ease.quadIn}],a.vec4.lerp),"light.color":u.PropertyAnimation([{frame:0,value:[1,.2,.4]}],a.vec3.lerp),"light.radius":u.PropertyAnimation([{frame:0,value:0},{frame:.6,value:4*t.size[0],ease:u.ease.cubicOut}],a.lerp),"light.intensity":u.PropertyAnimation([{frame:0,value:8},{frame:.6,value:0,ease:u.ease.sineIn}],a.lerp),"ring.transform.scale":u.PropertyAnimation([{frame:.1,value:a.vec3.ZERO},{frame:.7,value:[8*t.size[0],8*t.size[1],1],ease:u.ease.cubicOut}],a.vec3.lerp),"ring.color":u.PropertyAnimation([{frame:.1,value:[.6,.4,.5,.8]},{frame:.7,value:a.vec4.ZERO,ease:u.ease.sineIn}],a.vec4.lerp),"wave.transform.scale":u.PropertyAnimation([{frame:.1,value:a.vec3.ZERO},{frame:.5,value:[8*t.size[0],8*t.size[1],1],ease:u.ease.quartOut}],a.vec3.lerp),"wave.color":u.PropertyAnimation([{frame:.1,value:a.vec4.ONE},{frame:.5,value:a.vec4.ZERO,ease:u.ease.sineIn}],a.vec4.lerp),"mesh.color":u.PropertyAnimation([{frame:0,value:[1,1,1,-2*t.mesh.buffer.radius]},{frame:.1,value:[.8,1,0,-2*t.mesh.buffer.radius],ease:u.ease.sineIn},{frame:.4,value:[.2,.5,0,-t.mesh.buffer.radius],ease:u.ease.quadOut},{frame:3,value:[.2,.5,0,1],ease:u.ease.slowInOut}],a.vec4.lerp),"mesh.transform.position":u.PropertyAnimation([{frame:0,value:a.vec3.copy(t.mesh.transform.position,a.vec3())},{frame:.4,value:a.vec3.add(t.mesh.transform.position,[0,-.5,0],a.vec3()),ease:u.ease.bounceIn(.1,.6)}],a.vec3.lerp),"burn.transform.scale":u.PropertyAnimation([{frame:0,value:a.vec3.ZERO},{frame:.4,value:[8*t.size[0],4,8*t.size[1]],ease:u.ease.cubicOut}],a.vec3.lerp),"burn.color":u.PropertyAnimation([{frame:.4,value:[.2,.2,.2,1]},{frame:3,value:a.vec4.ZERO,ease:u.ease.cubicIn}],a.vec4.lerp)}),this.context.get(l.AudioSystem).create("assets/unit_death.mp3","sfx",this.mesh.transform).play(0),this.debris=this.context.get(f.SharedSystem).debris.create(this.mesh.transform.position),d=.4+.4*t.size[0],a.vec3.set(d,d,d,this.debris.transform.scale),a.vec4.set(0,0,0,1,this.debris.color),p=3,v=this.context.currentTime,i.label=6;case 6:return y=this.context.currentTime-v,m(y,this.context.deltaTime),y>p?[3,10]:[3,7];case 7:return[4,u.ActionSignal.WaitNextFrame];case 8:i.sent(),i.label=9;case 9:return[3,6];case 10:return f.SharedSystem.particles.spikes.remove(this.spikes),this.context.get(c.TransformSystem).delete(this.burn.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.pillar.transform),this.context.get(c.TransformSystem).delete(this.light.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(s.PointLightPass).delete(this.light),this.context.get(s.PostEffectPass).remove(this.wave),this.context.get(s.DecalPass).delete(this.burn),this.context.get(s.ParticleEffectPass).remove(this.pillar),this.context.get(s.ParticleEffectPass).remove(this.ring),o.Sprite.delete(this.wave),o.Sprite.delete(this.pillar),o.Sprite.delete(this.ring),this.debris=void this.context.get(f.SharedSystem).debris.delete(this.debris),t.delete(),e.pool.push(this),[2]}}))},e.pool=[],e}();t.DeathEffect=m},1517:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SnakeRig=void 0;var n=r(4454),o=r(8581),s=function(e){function t(t){var r=e.call(this)||this;return r.context=t,r.inverseModelMatrix=n.mat4(),r.worldTransform=n.mat4(),r.rotation=n.quat(),r.deltaMove=n.vec3(),r.prevJoints=[],r.friction=.96,r.frequency=Math.PI,r.amplitude=.6,r.distanceTravelled=0,r.constraint=new o.SwingTwistConstraint,r.constraint.swingAngle=.4*Math.PI,r.constraint.twistAngle=0*Math.PI,r.mode=1,r}return a(t,e),t.prototype.attachTail=function(e){var t=n.vec3(),r=n.quat(),i=n.quat();n.mat4.multiply(this.mesh.transform.matrix,e[0].globalTransform,this.worldTransform),n.mat4.decompose(this.worldTransform,t,r,r);var a=this.add(t);a.target=null,a.parent=new o.IKBone,a.parent.set(n.vec3.ZERO,a.origin),a.parent.index=this.mesh.armature.nodes.indexOf(e[0]);for(var s=0;s<e.length;s++){var c=e[s],l=e[s+1];n.quat.copy(r,i),l?(n.mat4.multiply(this.mesh.transform.matrix,l.globalTransform,this.worldTransform),n.mat4.decompose(this.worldTransform,t,r,r)):n.mat4.transform(n.vec3.AXIS_Y,this.worldTransform,t);var u=a.add(t);u.joint=this.constraint,u.index=this.mesh.armature.nodes.indexOf(c),n.quat.multiply(n.quat.conjugate(u.rotation,u.inverseBind),i,u.inverseBind),this.prevJoints.push(n.vec3.copy(u.end,n.vec3()))}},t.prototype.build=function(e){this.mesh=e,e.armature.update(this.context),e.transform.recalculate(this.context.frame),this.attachTail([e.armature.nodes[2],e.armature.nodes[3],e.armature.nodes[4],e.armature.nodes[5]]),this.distanceTravelled=0},t.prototype.update=function(){this.verletIntegration(),e.prototype.update.call(this),this.updateArmature()},t.prototype.verletIntegration=function(){if(this.enabled)for(var e=0;e<this.chains.length;e++){n.vec3.copy(n.vec3.ONE,this.chains[e].lastOrigin);var t=this.chains[e].parent,r=this.mesh.armature.nodes[t.index],i=this.mesh.armature.nodes[r.parent];n.mat4.fromRotationTranslationScale(r.rotation,r.position,r.scale,this.worldTransform),n.mat4.multiply(i.globalTransform,this.worldTransform,this.worldTransform),n.mat4.multiply(this.mesh.transform.matrix,this.worldTransform,this.worldTransform),n.mat4.transform(n.vec3.ZERO,this.worldTransform,t.start),this.distanceTravelled+=n.vec3.distance(t.end,t.start),n.vec3.copy(t.start,t.end),n.mat4.transform([0,-1,0],this.worldTransform,t.start),t.set(t.start,t.end);for(var a=0;a<this.chains[e].bones.length;a++){var o=this.chains[e].bones[a],s=this.prevJoints[a];if(n.vec3.subtract(o.end,s,this.deltaMove),n.vec3.scale(this.deltaMove,this.friction,this.deltaMove),n.vec3.copy(o.end,s),n.vec3.add(this.deltaMove,o.end,o.end),0==a){var c=2*this.distanceTravelled+this.context.currentTime,l=this.amplitude*Math.cos(c*this.frequency);n.vec3.set(0,o.length,l,this.deltaMove),n.mat4.transform(this.deltaMove,this.worldTransform,this.deltaMove),n.vec3.lerp(o.end,this.deltaMove,.6,o.end)}}}},t.prototype.updateArmature=function(){n.mat4.invert(this.mesh.transform.matrix,this.inverseModelMatrix);for(var e=this.chains.length-1;e>=0;e--)for(var t=0;t<this.chains[e].bones.length;t++){var r=this.chains[e].bones[t],i=this.mesh.armature.nodes[r.index];n.quat.multiply(r.rotation,r.inverseBind,this.rotation),n.mat4.fromRotationTranslationScale(this.rotation,r.start,n.vec3.ONE,i.globalTransform),n.mat4.multiply(this.inverseModelMatrix,i.globalTransform,i.globalTransform),this.mesh.armature.updateBone(r.index)}},t}(o.IKRig);t.SnakeRig=s},9413:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Spider4Rig=void 0;var o=r(4454),s=r(8581),c=r(6725),l=r(3605),u=function(e){function t(t){var r=e.call(this)||this;return r.context=t,r.ballJoint=new s.BallJointConstraint,r.hingeJoint=new s.LocalHingeConstraint,r.inverseModelMatrix=o.mat4(),r.worldOrientation=o.quat(),r.targets=[],r.hingeJoint.min=0,r.hingeJoint.max=Math.PI,r.ballJoint.rotor=2/3*Math.PI,r}return a(t,e),t.prototype.attachLimb=function(e,t){var r=o.vec3(),i=o.vec3(),a=o.vec3(),n=o.quat(),c=o.quat();o.mat4.decompose(e.globalTransform,r,a,n),o.mat4.decompose(t.globalTransform,i,a,c),o.mat4.transform(o.vec3.AXIS_Y,t.globalTransform,a);var l=this.add(r);l.parent=new s.IKBone,l.parent.set(o.vec3.ZERO,r),l.parent.index=e.parent;var u=l.add(i),f=l.add(a);return u.index=this.mesh.armature.nodes.indexOf(e),f.index=this.mesh.armature.nodes.indexOf(t),u.joint=this.ballJoint,f.joint=this.hingeJoint,o.quat.multiply(o.quat.conjugate(u.rotation,u.inverseBind),n,u.inverseBind),o.quat.multiply(o.quat.conjugate(f.rotation,f.inverseBind),c,f.inverseBind),o.vec3.copy(a,l.target),this.targets.push({world:o.mat4.transform(l.target,this.mesh.transform.matrix,o.vec3()),local:l.target,center:o.vec3.copy(l.target,o.vec3()),delta:o.vec3(),radius:.2,moving:!1}),l},t.prototype.build=function(e){this.mesh=e,e.armature.update(this.context),e.transform.recalculate(this.context.frame),this.attachLimb(e.armature.nodes[1],e.armature.nodes[2]),this.attachLimb(e.armature.nodes[3],e.armature.nodes[4]),this.attachLimb(e.armature.nodes[5],e.armature.nodes[6]),this.attachLimb(e.armature.nodes[7],e.armature.nodes[8])},t.prototype.moveTarget=function(e,t){var r,i,a,s,l,u;return n(this,(function(n){switch(n.label){case 0:e.moving=!0,r=o.vec3.copy(e.world,o.vec3()),i=.5,a=.1,s=this.context.currentTime,n.label=1;case 1:return l=this.context.currentTime-s,u=Math.min(1,l/a),e.world[0]=o.lerp(r[0],t[0],c.ease.sineInOut(u)),e.world[1]=o.lerp(r[1],t[1],c.ease.slowInOut(u))+i*c.ease.fadeInOut(u),e.world[2]=o.lerp(r[2],t[2],c.ease.sineInOut(u)),l>a?[3,4]:[4,c.ActionSignal.WaitNextFrame];case 2:n.sent(),n.label=3;case 3:return[3,1];case 4:return e.moving=!1,[2]}}))},t.prototype.update=function(){o.mat4.invert(this.mesh.transform.matrix,this.inverseModelMatrix);for(var t=0,r=-1,i=0,a=this.targets.length-1;a>=0;a--){var n=this.targets[a];if(o.mat4.transform(n.world,this.inverseModelMatrix,n.local),i+=+n.moving,!n.moving){o.vec3.subtract(n.local,n.center,n.delta),o.vec3.projectPlane(n.delta,o.vec3.AXIS_Y,n.delta);var s=o.vec3.magnitudeSquared(n.delta);s<=n.radius*n.radius||t>=s||(t=s,r=a)}}if(-1!=r&&0==i){t=Math.sqrt(t),n=this.targets[r],o.vec3.scale(n.delta,-Math.min(n.radius,t-n.radius)/t,n.delta);var u=o.vec3.add(n.center,n.delta,o.vec3());o.mat4.transform(u,this.mesh.transform.matrix,u),this.context.get(l.TerrainSystem).snapToGround(u),this.context.get(c.AnimationSystem).start(this.moveTarget(n,u),!0)}for(e.prototype.update.call(this),a=this.chains.length-1;a>=0;a--)for(var f=0;f<this.chains[a].bones.length;f++){var h=this.chains[a].bones[f];if(-1!=h.index){var m=this.mesh.armature.nodes[h.index];o.quat.multiply(h.rotation,h.inverseBind,this.worldOrientation),o.mat4.fromRotationTranslationScale(this.worldOrientation,h.start,o.vec3.ONE,m.globalTransform),this.mesh.armature.updateBone(h.index)}}},t}(s.IKRig);t.Spider4Rig=u},8537:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusBar=void 0;var i=r(4454),a=r(5623),n=r(296),o=r(8581),s=r(7822),c=function(){function e(e){this.context=e}return e.create=function(t,r){var i=e.pool.pop()||new e(t);return i.attach(r),i},e.prototype.delete=function(){this.context.get(a.TransformSystem).delete(this.segments[0].transform);for(var t=this.segments.length-1;t>=0;t--)this.context.get(n.OverlayPass).remove(this.segments[t]),this.segments[t]=void o.Sprite.delete(this.segments[t]);e.pool.push(this)},e.prototype.attach=function(t){var r=this,c=this.context.get(a.TransformSystem).create([0,t.size[0]+1,0],i.quat.IDENTITY,e.scale,t.mesh.transform);this.segments=i.range(t.health.capacity).map((function(e){var i=o.Sprite.create(2,64);return i.origin[0]=.5+e-.5*t.health.capacity,i.transform=c,i.material=s.SharedSystem.materials.sprite.bar,r.context.get(n.OverlayPass).add(i),i})),this.update(t)},e.prototype.update=function(t){for(var r=this.segments.length-1;r>=0;r--)i.vec4.copy(t.health.amount>r?e.enabled:e.disabled,this.segments[r].color)},e.pool=[],e.scale=i.vec3(.4,.4,.4),e.enabled=i.vec4(1,.6,.8,1),e.disabled=i.vec4(0,0,0,.8),e}();t.StatusBar=c},8474:function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(870),t),a(r(1085),t)},7631:(e,t,r)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.UnitFactory=void 0;var a=r(1744),n=r(7485),o=r(7037),s=r(7005),c=r(7066),l=r(2127),u=r(6327),f=r(3524);t.UnitFactory=((i={})[0]=a.Scarab,i[1]=n.Tarantula,i[2]=o.Stingray,i[3]=s.Locust,i[4]=c.Obelisk,i[5]=l.Monolith,i[6]=u.Decapod,i[7]=f.Isopod,i[8]=n.TarantulaVariant,i)},7576:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.FlamethrowerSkill=void 0;var s=r(4454),c=r(8581),l=r(9336),u=r(6365),f=r(6725),h=r(296),m=r(7822),d=r(6888),p={"mesh.armature":m.ModelAnimation("activateVariant"),"ring.transform.scale":f.PropertyAnimation([{frame:.2,value:s.vec3.ZERO},{frame:1.2,value:[6,6,6],ease:f.ease.cubicOut}],s.vec3.lerp),"ring.color":f.PropertyAnimation([{frame:.2,value:[.5,1,.8,1]},{frame:1.2,value:s.vec4.ZERO,ease:f.ease.quadIn}],s.vec4.lerp),"heat.transform.scale":f.PropertyAnimation([{frame:.2,value:[2,0,2]},{frame:1.6,value:[3,8,3],ease:f.ease.cubicOut}],s.vec3.lerp),"heat.color":f.PropertyAnimation([{frame:.2,value:[.2,1,1,1]},{frame:1.6,value:s.vec4.ZERO,ease:f.ease.quadIn}],s.vec4.lerp),"light.radius":f.PropertyAnimation([{frame:.3,value:0},{frame:1.4,value:5,ease:f.ease.cubicOut}],s.lerp),"light.intensity":f.PropertyAnimation([{frame:.3,value:10},{frame:1.4,value:0,ease:f.ease.quadIn}],s.lerp),"corridor.transform.scale":f.PropertyAnimation([{frame:.2,value:[1.5,0,2]},{frame:1,value:[1.5,6,2],ease:f.ease.sineOut}],s.vec3.lerp),"corridor.color":f.PropertyAnimation([{frame:.2,value:[.2,1,1,1]},{frame:1,value:[0,1,1,0],ease:f.ease.quadIn}],s.vec4.lerp),fire:f.EventTrigger([{frame:.2,value:48}],f.EventTrigger.emit),"lineA.color":f.PropertyAnimation([{frame:.4,value:[.2,1,.8,1]},{frame:1.4,value:s.vec4.ZERO,ease:f.ease.quadIn}],s.vec4.lerp),"lineB.color":f.PropertyAnimation([{frame:.4,value:[.2,1,.8,1]},{frame:1.4,value:s.vec4.ZERO,ease:f.ease.quadIn}],s.vec4.lerp),"burn.transform.scale":f.PropertyAnimation([{frame:0,value:[10,4,5]}],s.vec3.lerp),"burn.color":f.PropertyAnimation([{frame:.4,value:s.vec4.ZERO},{frame:1,value:[0,0,0,1],ease:f.ease.sineOut},{frame:1.8,value:s.vec4.ZERO,ease:f.ease.quadIn}],s.vec4.lerp)},v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.range=4,t.cardinal=!0,t.pierce=!0,t.damageType=12,t.damage=2,t}return a(t,e),t.prototype.validate=function(e,t){var r=Math.max(t[0]-e[0]-1,e[0]-t[0]),i=Math.max(t[1]-e[1]-1,e[1]-t[1]);return Math.max(r,i)<=this.range&&0==Math.min(r,i)},t.prototype.use=function(e,t){var r,i,a,v,y,g,x;return o(this,(function(o){switch(o.label){case 0:r=e.rotate(t,!0),o.label=1;case 1:return(i=r.next()).done?[3,5]:[3,2];case 2:return[4,i.value];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:this.mesh=e.mesh,this.corridor=c.BatchMesh.create(m.SharedSystem.geometry.openBox),this.corridor.material=m.SharedSystem.materials.effect.coreYellow,this.corridor.transform=this.context.get(l.TransformSystem).create([0,1.2,0],s.quat.HALF_X,s.vec3.ONE,this.mesh.transform),this.context.get(h.ParticleEffectPass).add(this.corridor),this.fire=m.SharedSystem.particles.fire.add({uLifespan:s.vec4(.4,.8,-.3,0),uOrigin:s.mat4.transform([0,1,1],this.mesh.transform.matrix,s.vec3()),uRotation:s.vec2.ZERO,uGravity:s.mat4.transformNormal([0,0,12],this.mesh.transform.matrix,s.vec3()),uSize:s.vec2(.5,1.5),uRadius:s.vec2(0,1.5)}),this.lineA=c.Line.create(2,0,1.6),this.lineB=c.Line.create(2,0,1.6),s.mat4.transform([0,1.3,0],this.mesh.transform.matrix,this.lineA.path[0]),s.mat4.transform([0,1.7,0],this.mesh.transform.matrix,this.lineB.path[0]),s.mat4.transform([0,1.3,10],this.mesh.transform.matrix,this.lineA.path[1]),s.mat4.transform([0,1.7,10],this.mesh.transform.matrix,this.lineB.path[1]),this.lineA.material=m.SharedSystem.materials.effect.exhaust,this.lineB.material=m.SharedSystem.materials.effect.exhaust,this.context.get(h.ParticleEffectPass).add(this.lineA),this.context.get(h.ParticleEffectPass).add(this.lineB),this.burn=this.context.get(h.DecalPass).create(4),this.burn.material=m.SharedSystem.materials.decal.dust,this.burn.transform=this.context.get(l.TransformSystem).create([0,0,6],s.quat.axisAngle(s.vec3.AXIS_Y,-.5*Math.PI,s.quat()),s.vec3.ONE,this.mesh.transform),this.light=this.context.get(h.PointLightPass).create([.2,1,.6]),this.light.transform=this.context.get(l.TransformSystem).create([0,2,2],s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.heat=c.BatchMesh.create(m.SharedSystem.geometry.openBox),this.heat.material=m.SharedSystem.materials.heat,this.heat.transform=this.context.get(l.TransformSystem).create([0,1,0],s.quat.HALF_X,s.vec3.ONE,this.mesh.transform),this.context.get(h.PostEffectPass).add(this.heat),this.ring=c.Sprite.create(0),this.ring.material=m.SharedSystem.materials.effect.auraTeal,this.ring.transform=this.context.get(l.TransformSystem).create([0,1,1.5],s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.context.get(h.ParticleEffectPass).add(this.ring),a=f.EventTrigger([{frame:.8,value:t}],d.AIUnitSkill.damage),v=f.AnimationTimeline(this,n(n({},p),{"lineA.path.1":f.PropertyAnimation([{frame:.4,value:this.lineA.path[0]},{frame:1.4,value:s.vec3.copy(this.lineA.path[1],s.vec3()),ease:f.ease.quartOut}],s.vec3.lerp),"lineB.path.1":f.PropertyAnimation([{frame:.4,value:this.lineB.path[0]},{frame:1.4,value:s.vec3.copy(this.lineB.path[1],s.vec3()),ease:f.ease.quartOut}],s.vec3.lerp)})),this.context.get(u.AudioSystem).create("assets/flamethrower_use.mp3","sfx",this.mesh.transform).play(0),y=1.8,g=this.context.currentTime,o.label=6;case 6:return x=this.context.currentTime-g,v(x,this.context.deltaTime),a(x,this.context.deltaTime,this),x>y?[3,10]:[3,7];case 7:return[4,f.ActionSignal.WaitNextFrame];case 8:o.sent(),o.label=9;case 9:return[3,6];case 10:return this.context.get(l.TransformSystem).delete(this.corridor.transform),this.context.get(l.TransformSystem).delete(this.burn.transform),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.heat.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),m.SharedSystem.particles.fire.remove(this.fire),this.context.get(h.PostEffectPass).remove(this.heat),this.context.get(h.PointLightPass).delete(this.light),this.context.get(h.DecalPass).delete(this.burn),this.context.get(h.ParticleEffectPass).remove(this.corridor),this.context.get(h.ParticleEffectPass).remove(this.ring),this.context.get(h.ParticleEffectPass).remove(this.lineA),this.context.get(h.ParticleEffectPass).remove(this.lineB),c.Sprite.delete(this.ring),c.BatchMesh.delete(this.heat),c.BatchMesh.delete(this.corridor),c.Line.delete(this.lineA),c.Line.delete(this.lineB),[2]}}))},t}(d.AIUnitSkill);t.FlamethrowerSkill=v},8046:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LaserSkill=void 0;var s=r(4454),c=r(8581),l=r(9336),u=r(6365),f=r(296),h=r(6725),m=r(3605),d=r(7822),p=r(6888),v=r(9131),y={"mesh.armature":d.ModelAnimation("activate"),"mesh.color":h.PropertyAnimation([{frame:.8,value:s.vec4.ONE},{frame:1.2,value:[10,.5,.8,1],ease:h.ease.quadOut},{frame:1.6,value:s.vec4.ONE,ease:h.ease.sineIn}],s.vec4.lerp),"light.radius":h.PropertyAnimation([{frame:.4,value:0},{frame:1.4,value:5,ease:h.ease.quadOut}],s.lerp),"light.intensity":h.PropertyAnimation([{frame:.4,value:4},{frame:1.4,value:0,ease:h.ease.sineIn}],s.lerp),"light.color":h.PropertyAnimation([{frame:0,value:[1,.5,.8]}],s.vec3.lerp),"center.transform.scale":h.PropertyAnimation([{frame:.6,value:s.vec3.ZERO},{frame:1.8,value:[6,6,6],ease:h.ease.quartOut}],s.vec3.lerp),"center.color":h.PropertyAnimation([{frame:.6,value:s.vec4.ONE},{frame:1.8,value:s.vec4.ZERO,ease:h.ease.cubicIn}],s.vec4.lerp),"cylinder.transform.scale":h.PropertyAnimation([{frame:.4,value:[4,0,-4]},{frame:1,value:[.8,3,-.8],ease:h.ease.cubicOut}],s.vec3.lerp),"cylinder.transform.rotation":h.PropertyAnimation([{frame:.4,value:s.quat.IDENTITY},{frame:1,value:s.quat.axisAngle(s.vec3.AXIS_Y,Math.PI,s.quat()),ease:h.ease.sineIn}],s.quat.slerp),"cylinder.color":h.PropertyAnimation([{frame:.4,value:[.4,1,.8,.2]},{frame:1,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),"tubeX.transform.scale":h.PropertyAnimation([{frame:.6,value:[1,0,1]},{frame:1.2,value:[1,8,1],ease:h.ease.quadOut}],s.vec3.lerp),"tubeZ.transform.scale":h.PropertyAnimation([{frame:.6,value:[1,0,1]},{frame:1.2,value:[1,8,1],ease:h.ease.quadOut}],s.vec3.lerp),"tubeX.color":h.PropertyAnimation([{frame:.6,value:[1,1,1,0]},{frame:1.2,value:[.6,1,1,1],ease:h.ease.sineOut}],s.vec4.lerp),"tubeZ.color":h.PropertyAnimation([{frame:.6,value:[1,1,1,0]},{frame:1.2,value:[.6,1,1,1],ease:h.ease.sineOut}],s.vec4.lerp),"beam.transform.scale":h.PropertyAnimation([{frame:.4,value:s.vec3.ZERO},{frame:1,value:[1,4,1],ease:h.ease.cubicOut}],s.vec3.lerp),"beam.color":h.PropertyAnimation([{frame:.4,value:[1,.2,.5,.2]},{frame:1,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),"ring.transform.rotation":h.PropertyAnimation([{frame:.5,value:s.quat.HALF_X},{frame:1,value:s.quat.multiply(s.quat.axisAngle(s.vec3.AXIS_Y,-Math.PI,s.quat()),s.quat.HALF_X,s.quat()),ease:h.ease.quadOut}],s.quat.slerp),"ring.transform.scale":h.PropertyAnimation([{frame:.5,value:s.vec3.ZERO},{frame:1,value:[6,6,6],ease:h.ease.cubicOut}],s.vec3.lerp),"ring.color":h.PropertyAnimation([{frame:.5,value:[.6,1,.9,.4]},{frame:1,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"beams.0.width":h.PropertyAnimation([{frame:.7,value:0},{frame:1.4,value:1,ease:h.ease.quadOut}],s.lerp),"beams.1.width":h.PropertyAnimation([{frame:.7,value:0},{frame:1.4,value:1,ease:h.ease.quadOut}],s.lerp),"beams.2.width":h.PropertyAnimation([{frame:.7,value:0},{frame:1.4,value:1,ease:h.ease.quadOut}],s.lerp),"beams.3.width":h.PropertyAnimation([{frame:.7,value:0},{frame:1.4,value:1,ease:h.ease.quadOut}],s.lerp)},g={"mesh.armature":d.ModelAnimation("deactivate"),"tubeX.color":h.PropertyAnimation([{frame:0,value:[.6,1,1,1]},{frame:.6,value:[1,0,1,0],ease:h.ease.quadIn}],s.vec4.lerp),"tubeZ.color":h.PropertyAnimation([{frame:0,value:[.6,1,1,1]},{frame:.6,value:[1,0,1,0],ease:h.ease.quadIn}],s.vec4.lerp),"beams.0.color":h.PropertyAnimation([{frame:0,value:s.vec4.ONE},{frame:.5,value:[0,.4,.3,.8],ease:h.ease.quadOut}],s.vec4.lerp),"beams.1.color":h.PropertyAnimation([{frame:0,value:s.vec4.ONE},{frame:.5,value:[0,.4,.3,.8],ease:h.ease.quadOut}],s.vec4.lerp),"beams.2.color":h.PropertyAnimation([{frame:0,value:s.vec4.ONE},{frame:.5,value:[0,.4,.3,.8],ease:h.ease.quadOut}],s.vec4.lerp),"beams.3.color":h.PropertyAnimation([{frame:0,value:s.vec4.ONE},{frame:.5,value:[0,.4,.3,.8],ease:h.ease.quadOut}],s.vec4.lerp),"beams.0.width":h.PropertyAnimation([{frame:0,value:1},{frame:.5,value:0,ease:h.ease.sineIn}],s.lerp),"beams.1.width":h.PropertyAnimation([{frame:0,value:1},{frame:.5,value:0,ease:h.ease.sineIn}],s.lerp),"beams.2.width":h.PropertyAnimation([{frame:0,value:1},{frame:.5,value:0,ease:h.ease.sineIn}],s.lerp),"beams.3.width":h.PropertyAnimation([{frame:0,value:1},{frame:.5,value:0,ease:h.ease.sineIn}],s.lerp)},x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.minRange=2,t.range=8,t.cardinal=!0,t.pierce=!0,t.damageType=4,t.damage=1,t.beams=[],t.targets=Array(4).fill(null).map((function(){return s.vec3()})),t}return a(t,e),t.prototype.aim=function(t,r,i){for(var a=this.context.get(m.TerrainSystem).pathfinder,n=0;n<v.DirectionTile.length;n++){var o=a.weight[a.tileIndex(t[0]+v.DirectionTile[n][0],t[1]+v.DirectionTile[n][1])];if(null!=i&&o>i)return null;if(0==o)return null}return e.prototype.aim.call(this,t,r)},t.prototype.use=function(e,t){var r,i,a,g,x,b,S,P,O,T,w,_,A,E=this;return o(this,(function(o){switch(o.label){case 0:for(this.mesh=e.mesh,r=!1,i=this.context.get(m.TerrainSystem),a=i.pathfinder,P=0;P<v.DirectionTile.length;P++){for(g=void 0,x=void 0,b=0;++b<=this.range;)if(g=e.tile[0]+v.DirectionTile[P][0]*b,x=e.tile[1]+v.DirectionTile[P][1]*b,t[0]===g&&t[1]===x)r=!0;else if(0==a.weight[a.tileIndex(g,x)])break;i.tilePosition(g,x,this.targets[P]),this.targets[P][1]=this.mesh.transform.position[1]+.8}if(this.active&&r&&p.AIUnitSkill.damage(this,t),this.active)return[2];for(this.active=!0,S=[s.vec3(0,.8,.5),s.vec3(.5,.8,0),s.vec3(0,.8,-.5),s.vec3(-.5,.8,0)].map((function(e){return s.mat4.transform(e,E.mesh.transform.matrix,s.vec3())})),P=0;P<4;P++)this.beams[P]=c.Line.create(2),this.beams[P].material=d.SharedSystem.materials.beamLinearRedMaterial,this.context.get(f.ParticleEffectPass).add(this.beams[P]),s.vec3.copy(S[P],this.beams[P].path[0]);this.center=c.Sprite.create(0),this.center.material=d.SharedSystem.materials.beamRadialRedMaterial,this.center.transform=this.context.get(l.TransformSystem).create([0,1,0],s.quat.HALF_X,s.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.center),this.beam=c.Sprite.create(3,0,s.vec4.ONE,[0,.5]),this.beam.material=d.SharedSystem.materials.sprite.beam,this.beam.transform=this.context.get(l.TransformSystem).create([0,2,0],s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.beam),this.ring=c.Sprite.create(0),this.ring.material=d.SharedSystem.materials.sprite.swirl,this.ring.transform=this.context.get(l.TransformSystem).create([0,2,0],s.quat.HALF_X,s.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.ring),this.tubeX=c.BatchMesh.create(d.SharedSystem.geometry.cylinder),this.tubeZ=c.BatchMesh.create(d.SharedSystem.geometry.cylinder),this.tubeX.transform=this.context.get(l.TransformSystem).create([0,.8,0],s.quat.axisAngle(s.vec3.AXIS_X,.5*Math.PI,s.quat()),s.vec3.ONE,this.mesh.transform),this.tubeZ.transform=this.context.get(l.TransformSystem).create([0,.8,0],s.quat.axisAngle(s.vec3.AXIS_Z,.5*Math.PI,s.quat()),s.vec3.ONE,this.mesh.transform),this.tubeX.material=d.SharedSystem.materials.effect.stripesBlocky,this.tubeZ.material=d.SharedSystem.materials.effect.stripesBlocky,this.context.get(f.ParticleEffectPass).add(this.tubeX),this.context.get(f.ParticleEffectPass).add(this.tubeZ),this.cylinder=c.BatchMesh.create(d.SharedSystem.geometry.lowpolyCylinder),this.cylinder.transform=this.context.get(l.TransformSystem).create(s.vec3.ZERO,s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.cylinder.material=d.SharedSystem.materials.sprite.spiral,this.context.get(f.ParticleEffectPass).add(this.cylinder),this.light=this.context.get(f.PointLightPass).create(),this.light.transform=this.context.get(l.TransformSystem).create([0,2,0],s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),O=h.EventTrigger([{frame:.8,value:t}],p.AIUnitSkill.damage),T=h.AnimationTimeline(this,n(n({},y),{"beams.0.path.1":h.PropertyAnimation([{frame:.7,value:S[0]},{frame:1.2,value:this.targets[0],ease:h.ease.cubicOut}],s.vec3.lerp),"beams.1.path.1":h.PropertyAnimation([{frame:.7,value:S[1]},{frame:1.2,value:this.targets[1],ease:h.ease.cubicOut}],s.vec3.lerp),"beams.2.path.1":h.PropertyAnimation([{frame:.7,value:S[2]},{frame:1.2,value:this.targets[2],ease:h.ease.cubicOut}],s.vec3.lerp),"beams.3.path.1":h.PropertyAnimation([{frame:.7,value:S[3]},{frame:1.2,value:this.targets[3],ease:h.ease.cubicOut}],s.vec3.lerp)})),this.context.get(u.AudioSystem).clips["assets/laser_loop.mp3"].loop=.06,this.context.get(u.AudioSystem).create("assets/laser_use.mp3","sfx",this.mesh.transform).play(0),this.sound=this.context.get(u.AudioSystem).create("assets/laser_loop.mp3","sfx",this.mesh.transform),this.sound.volume(0,0).volume(.5,.5).play(0),w=2,_=this.context.currentTime,o.label=1;case 1:return A=this.context.currentTime-_,T(A,this.context.deltaTime),r&&O(A,this.context.deltaTime,this),A>w?[3,5]:[3,2];case 2:return[4,h.ActionSignal.WaitNextFrame];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(l.TransformSystem).delete(this.beam.transform),this.context.get(l.TransformSystem).delete(this.center.transform),this.context.get(l.TransformSystem).delete(this.cylinder.transform),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.ParticleEffectPass).remove(this.beam),this.context.get(f.ParticleEffectPass).remove(this.center),this.context.get(f.ParticleEffectPass).remove(this.cylinder),c.Sprite.delete(this.ring),c.Sprite.delete(this.center),c.Sprite.delete(this.beam),c.BatchMesh.delete(this.cylinder),[2]}}))},t.prototype.deactivate=function(e){var t,r,i,a,n;return o(this,(function(o){switch(o.label){case 0:if(!this.active)return[2];if(this.active=!1,t=h.AnimationTimeline(this,g),this.sound=void this.sound.stop(0),e||this.context.get(u.AudioSystem).create("assets/laser_close.mp3","sfx",this.mesh.transform).play(0),e)return[3,5];r=1,i=this.context.currentTime,o.label=1;case 1:return a=this.context.currentTime-i,t(a,this.context.deltaTime),a>r?[3,5]:[3,2];case 2:return[4,h.ActionSignal.WaitNextFrame];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:for(this.context.get(l.TransformSystem).delete(this.tubeX.transform),this.context.get(l.TransformSystem).delete(this.tubeZ.transform),this.context.get(f.ParticleEffectPass).remove(this.tubeX),this.context.get(f.ParticleEffectPass).remove(this.tubeZ),c.BatchMesh.delete(this.tubeX),c.BatchMesh.delete(this.tubeZ),n=0;n<4;n++)this.context.get(f.ParticleEffectPass).remove(this.beams[n]),c.Line.delete(this.beams[n]);return[2]}}))},t}(p.AIUnitSkill);t.LaserSkill=x},1408:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LungeSkill=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(6725),f=r(296),h=r(7822),m=r(6888),d={"mesh.armature":h.ModelAnimation("activate"),"cone.transform.position":u.PropertyAnimation([{frame:.7,value:[0,1.5,.5]},{frame:1.1,value:[0,1.3,3.5],ease:u.ease.quintOut}],o.vec3.lerp),"cone.transform.scale":u.PropertyAnimation([{frame:.8,value:[1.5,6,1.5]},{frame:1.1,value:[1,.8,1],ease:u.ease.quadOut}],o.vec3.lerp),"cone.color":u.PropertyAnimation([{frame:.7,value:o.vec4.ZERO},{frame:.8,value:[.6,.7,.9,.4],ease:u.ease.quartOut},{frame:1.1,value:o.vec4.ZERO,ease:u.ease.sineIn}],o.vec4.lerp),spikesLeft:u.EventTrigger([{frame:.16,value:24}],u.EventTrigger.emit),spikesRight:u.EventTrigger([{frame:.16,value:24}],u.EventTrigger.emit),sparksLeft:u.EventTrigger([{frame:.8,value:36}],u.EventTrigger.emit),sparksRight:u.EventTrigger([{frame:.8,value:36}],u.EventTrigger.emit),"wave.transform.scale":u.PropertyAnimation([{frame:1,value:[1,0,0]},{frame:1.7,value:[2,2,1.5],ease:u.ease.sineOut}],o.vec3.lerp),"wave.color":u.PropertyAnimation([{frame:1,value:[.4,.2,1,1]},{frame:1.7,value:o.vec4.ZERO,ease:u.ease.sineInOut}],o.vec4.lerp),"tubeLeft.transform.scale":u.PropertyAnimation([{frame:.8,value:[2.4,0,2.4]},{frame:1,value:[.6,2,.6],ease:u.ease.quadOut},{frame:1.6,value:[0,2,0],ease:u.ease.sineIn}],o.vec3.lerp),"tubeRight.transform.scale":u.PropertyAnimation([{frame:.8,value:[2.4,0,2.4]},{frame:1,value:[.6,2,.6],ease:u.ease.quadOut},{frame:1.6,value:[0,2,0],ease:u.ease.sineIn}],o.vec3.lerp),"tubeLeft.color":u.PropertyAnimation([{frame:1,value:o.vec4.ONE},{frame:1.6,value:[.4,0,.6,1],ease:u.ease.quadIn}],o.vec4.lerp),"tubeRight.color":u.PropertyAnimation([{frame:1,value:o.vec4.ONE},{frame:1.6,value:[.4,0,.6,1],ease:u.ease.quadIn}],o.vec4.lerp),"beamLeft.transform.scale":u.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.2,value:[1.6,4.8,1.6],ease:u.ease.expoOut}],o.vec3.lerp),"beamRight.transform.scale":u.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.2,value:[1.6,4.8,1.6],ease:u.ease.expoOut}],o.vec3.lerp),"beamLeft.color":u.PropertyAnimation([{frame:.8,value:[.7,.9,1,0]},{frame:1.2,value:o.vec4.ZERO,ease:u.ease.cubicIn}],o.vec4.lerp),"beamRight.color":u.PropertyAnimation([{frame:.8,value:[.7,.9,1,0]},{frame:1.2,value:o.vec4.ZERO,ease:u.ease.cubicIn}],o.vec4.lerp),"ringLeft.transform.scale":u.PropertyAnimation([{frame:.9,value:o.vec3.ZERO},{frame:1.3,value:[2,2,2],ease:u.ease.quartOut}],o.vec3.lerp),"ringRight.transform.scale":u.PropertyAnimation([{frame:.9,value:o.vec3.ZERO},{frame:1.3,value:[2,2,2],ease:u.ease.quartOut}],o.vec3.lerp),"ringLeft.color":u.PropertyAnimation([{frame:.9,value:[.4,.6,1,.2]},{frame:1.3,value:o.vec4.ZERO,ease:u.ease.sineIn}],o.vec4.lerp),"ringRight.color":u.PropertyAnimation([{frame:.9,value:[.4,.6,1,.2]},{frame:1.3,value:o.vec4.ZERO,ease:u.ease.sineIn}],o.vec4.lerp)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.range=2,t.cardinal=!1,t.pierce=!1,t.damageType=1,t.damage=2,t}return a(t,e),t.prototype.use=function(e,t){var r,i,a,p,v,y,g;return n(this,(function(n){switch(n.label){case 0:r=e.rotate(t),n.label=1;case 1:return(i=r.next()).done?[3,5]:[3,2];case 2:return[4,i.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:this.mesh=e.mesh,this.spikesLeft=h.SharedSystem.particles.energy.add({uLifespan:[.8,1.2,0,0],uOrigin:o.mat4.transform(o.vec3(.5,1.5,-.5),this.mesh.transform.matrix,o.vec3()),uRotation:o.vec2.ZERO,uGravity:o.vec3.ZERO,uSize:[.4,1.2],uRadius:[.5,1.5],uForce:[6,8],uTarget:o.mat4.transformNormal(o.vec3(0,-.5,3.5),this.mesh.transform.matrix,o.vec3())}),this.spikesRight=h.SharedSystem.particles.energy.add({uLifespan:[.8,1.2,0,0],uOrigin:o.mat4.transform(o.vec3(-.5,1.5,-.5),this.mesh.transform.matrix,o.vec3()),uRotation:o.vec2.ZERO,uGravity:o.vec3.ZERO,uSize:[.4,1.2],uRadius:[.5,1.5],uForce:[6,8],uTarget:o.mat4.transformNormal(o.vec3(0,-.5,3.5),this.mesh.transform.matrix,o.vec3())}),this.tubeLeft=s.BatchMesh.create(h.SharedSystem.geometry.lowpolyCylinder),this.tubeRight=s.BatchMesh.create(h.SharedSystem.geometry.lowpolyCylinder),this.tubeLeft.material=h.SharedSystem.materials.effect.absorbTeal,this.tubeRight.material=h.SharedSystem.materials.effect.absorbTeal,this.tubeLeft.transform=this.context.get(c.TransformSystem).create([.5,1.3,1.2],o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.tubeRight.transform=this.context.get(c.TransformSystem).create([-.5,1.3,1.2],o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.tubeLeft),this.context.get(f.ParticleEffectPass).add(this.tubeRight),this.beamLeft=s.Sprite.create(3,4),this.beamRight=s.Sprite.create(3,4),this.beamLeft.material=h.SharedSystem.materials.sprite.sparkle,this.beamRight.material=h.SharedSystem.materials.sprite.sparkle,this.beamLeft.transform=this.context.get(c.TransformSystem).create([-.5,1.3,3],o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.beamRight.transform=this.context.get(c.TransformSystem).create([.5,1.3,3],o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.beamLeft),this.context.get(f.ParticleEffectPass).add(this.beamRight),this.ringLeft=s.Sprite.create(2,4),this.ringRight=s.Sprite.create(2,4),this.ringLeft.material=h.SharedSystem.materials.sprite.burst,this.ringRight.material=h.SharedSystem.materials.sprite.burst,this.ringLeft.transform=this.context.get(c.TransformSystem).create([-.5,1.3,3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.ringRight.transform=this.context.get(c.TransformSystem).create([.5,1.3,3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.ringLeft),this.context.get(f.ParticleEffectPass).add(this.ringRight),this.sparksLeft=h.SharedSystem.particles.sparks.add({uLifespan:[.4,.6,-.15,0],uOrigin:o.mat4.transform(o.vec3(-.5,1.3,3),this.mesh.transform.matrix,o.vec3()),uGravity:[0,-4,0],uLength:[.2,.3],uSize:[.2,.4],uForce:[2,5],uRadius:[0,.1],uTarget:o.vec3.ZERO}),this.sparksRight=h.SharedSystem.particles.sparks.add({uLifespan:[.4,.6,-.15,0],uOrigin:o.mat4.transform(o.vec3(.5,1.3,3),this.mesh.transform.matrix,o.vec3()),uGravity:[0,-4,0],uLength:[.2,.3],uSize:[.2,.4],uForce:[2,5],uRadius:[0,.1],uTarget:o.vec3.ZERO}),this.wave=s.BatchMesh.create(h.SharedSystem.geometry.lowpolyCylinder),this.wave.material=h.SharedSystem.materials.effect.stripes,this.wave.transform=this.context.get(c.TransformSystem).create(o.vec3(0,1.3,3),o.quat.axisAngle(o.vec3.AXIS_X,-.5*Math.PI,o.quat()),o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.wave),this.cone=s.BatchMesh.create(h.SharedSystem.geometry.cone),this.cone.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.cone.material=h.SharedSystem.materials.sprite.streak,this.context.get(f.ParticleEffectPass).add(this.cone),a=u.EventTrigger([{frame:.6,value:t}],m.AIUnitSkill.damage),p=u.AnimationTimeline(this,d),this.context.get(l.AudioSystem).create("assets/lunge_use.mp3","sfx",this.mesh.transform).play(.25),v=2,y=this.context.currentTime,n.label=6;case 6:return g=this.context.currentTime-y,p(g,this.context.deltaTime),a(g,this.context.deltaTime,this),g>v?[3,10]:[3,7];case 7:return[4,u.ActionSignal.WaitNextFrame];case 8:n.sent(),n.label=9;case 9:return[3,6];case 10:return h.SharedSystem.particles.energy.remove(this.spikesLeft),h.SharedSystem.particles.energy.remove(this.spikesRight),h.SharedSystem.particles.sparks.remove(this.sparksLeft),h.SharedSystem.particles.sparks.remove(this.sparksRight),this.context.get(c.TransformSystem).delete(this.ringLeft.transform),this.context.get(c.TransformSystem).delete(this.ringRight.transform),this.context.get(c.TransformSystem).delete(this.tubeLeft.transform),this.context.get(c.TransformSystem).delete(this.tubeRight.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.beamLeft.transform),this.context.get(c.TransformSystem).delete(this.beamRight.transform),this.context.get(c.TransformSystem).delete(this.cone.transform),this.context.get(f.ParticleEffectPass).remove(this.ringLeft),this.context.get(f.ParticleEffectPass).remove(this.ringRight),this.context.get(f.ParticleEffectPass).remove(this.tubeLeft),this.context.get(f.ParticleEffectPass).remove(this.tubeRight),this.context.get(f.ParticleEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.beamLeft),this.context.get(f.ParticleEffectPass).remove(this.beamRight),this.context.get(f.ParticleEffectPass).remove(this.cone),s.Sprite.delete(this.beamLeft),s.Sprite.delete(this.beamRight),s.Sprite.delete(this.ringLeft),s.Sprite.delete(this.ringRight),s.BatchMesh.delete(this.tubeLeft),s.BatchMesh.delete(this.tubeRight),s.BatchMesh.delete(this.wave),s.BatchMesh.delete(this.cone),[2]}}))},t}(m.AIUnitSkill);t.LungeSkill=p},4783:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.MortarSkill=void 0;var s=r(4454),c=r(8581),l=r(9336),u=r(6365),f=r(296),h=r(6725),m=r(3605),d=r(7822),p=r(6888),v=r(9131),y={"mesh.armature":d.ModelAnimation("deactivate"),"projectile.color":h.PropertyAnimation([{frame:0,value:[1,1,.5,1]}],s.vec4.lerp),"projectile.transform.scale":h.PropertyAnimation([{frame:.6,value:s.vec3.ZERO},{frame:.7,value:[.2,.2,1],ease:h.ease.expoOut},{frame:1.4,value:s.vec3.ZERO,ease:h.ease.expoIn}],s.vec3.lerp),embers:h.EventTrigger([{frame:1.4,value:36}],h.EventTrigger.emit),"hitLight.intensity":h.PropertyAnimation([{frame:1.4,value:10},{frame:1.6,value:0,ease:h.ease.sineIn}],s.lerp),"hitLight.radius":h.PropertyAnimation([{frame:1.4,value:0},{frame:1.6,value:6,ease:h.ease.quartOut}],s.lerp),"pillar.transform.scale":h.PropertyAnimation([{frame:1.4,value:s.vec3.ZERO},{frame:1.9,value:[2,6,2],ease:h.ease.cubicOut}],s.vec3.lerp),"pillar.color":h.PropertyAnimation([{frame:1.4,value:[1,.9,.6,.4]},{frame:1.9,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"splash.transform.scale":h.PropertyAnimation([{frame:1.4,value:s.vec3.ZERO},{frame:1.8,value:[6,6,6],ease:h.ease.cubicOut}],s.vec3.lerp),"splash.color":h.PropertyAnimation([{frame:1.4,value:[1,.8,.4,.4]},{frame:1.8,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"burn.transform.scale":h.PropertyAnimation([{frame:1.4,value:s.vec3.ZERO},{frame:1.8,value:[8,4,8],ease:h.ease.quartOut}],s.vec3.lerp),"burn.color":h.PropertyAnimation([{frame:1.6,value:[.2,0,0,1]},{frame:2.4,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),"wave.transform.scale":h.PropertyAnimation([{frame:1.4,value:s.vec3.ZERO},{frame:2,value:[10,10,10],ease:h.ease.cubicOut}],s.vec3.lerp),"wave.color":h.PropertyAnimation([{frame:1.4,value:s.vec4.ONE},{frame:2,value:s.vec4.ZERO,ease:h.ease.cubicIn}],s.vec4.lerp),smoke:h.EventTrigger([{frame:.6,value:24}],h.EventTrigger.emit),"muzzle.transform.scale":h.PropertyAnimation([{frame:.6,value:s.vec3.ZERO},{frame:.9,value:[4,4,4],ease:h.ease.quartOut}],s.vec3.lerp),"muzzle.color":h.PropertyAnimation([{frame:.6,value:[1,.8,.4,0]},{frame:.9,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"light.intensity":h.PropertyAnimation([{frame:.7,value:2},{frame:.9,value:20,ease:h.ease.cubicOut}],s.lerp),"light.color":h.PropertyAnimation([{frame:.6,value:[1,.4,.6]},{frame:.8,value:[1,.6,.4],ease:h.ease.quadIn},{frame:1.1,value:s.vec3.ZERO,ease:h.ease.sineOut}],s.vec3.lerp),"aura.threshold":h.PropertyAnimation([{frame:0,value:0},{frame:1,value:3,ease:h.ease.sineOut}],s.lerp),"reticle.color":h.PropertyAnimation([{frame:0,value:[1,.4,.8,.6]},{frame:1,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp)},g={"mesh.armature":d.ModelAnimation("activate"),"flash.transform.scale":h.PropertyAnimation([{frame:.9,value:s.vec3.ZERO},{frame:1.2,value:[2,2,2],ease:h.ease.quartOut}],s.vec3.lerp),"flash.color":h.PropertyAnimation([{frame:.9,value:[1,.7,.9,0]},{frame:1.2,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"ring.transform.scale":h.PropertyAnimation([{frame:.5,value:s.vec3.ZERO},{frame:.9,value:[6,6,6],ease:h.ease.quartOut}],s.vec3.lerp),"ring.color":h.PropertyAnimation([{frame:.5,value:[.8,.2,.4,1]},{frame:.9,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"light.intensity":h.PropertyAnimation([{frame:.8,value:0},{frame:1.4,value:2,ease:h.ease.sineOut}],s.lerp),"light.color":h.PropertyAnimation([{frame:0,value:[1,.4,.6]}],s.vec3.lerp),"aura.transform.scale":h.PropertyAnimation([{frame:.4,value:[0,4,0]},{frame:.8,value:[5,4,5],ease:h.ease.cubicOut}],s.vec3.lerp),"aura.threshold":h.PropertyAnimation([{frame:.2,value:-3},{frame:1.6,value:0,ease:h.ease.sineOut}],s.lerp),"reticle.transform.scale":h.PropertyAnimation([{frame:.4,value:s.vec3.ZERO},{frame:.8,value:[4,4,4],ease:h.ease.sineOut}],s.vec3.lerp),"reticle.color":h.PropertyAnimation([{frame:0,value:[1,.4,.8,.4]}],s.vec4.lerp),"cylinder.transform.rotation":h.PropertyAnimation([{frame:.4,value:[0,0,0,1]},{frame:.8,value:[.309017,0,0,.951057],ease:h.ease.sineIn}],s.quat.slerp),"cylinder.transform.scale":h.PropertyAnimation([{frame:.4,value:[3,0,3]},{frame:1,value:[0,3,0],ease:h.ease.CubicBezier(.25,.75,.5,.5)}],s.vec3.lerp),"cylinder.color":h.PropertyAnimation([{frame:.4,value:s.vec4.ZERO},{frame:.6,value:[1,.2,.4,1],ease:h.ease.cubicOut}],s.vec4.lerp)},x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.range=8,t.cardinal=!1,t.pierce=!1,t.damageType=5,t.damage=3,t.target=s.vec2(),t.origin=s.vec2(),t.targetPosition=s.vec3(),t}return a(t,e),t.prototype.aim=function(t,r){return this.active?t[0]===this.origin[0]&&t[1]===this.origin[1]?this.target:null:e.prototype.aim.call(this,t,r)},t.prototype.use=function(e,t){if(this.mesh=e.mesh,this.active)return this.active=!1,this.launch(this.target);for(var r=Array(4).fill(t),i=0;i<v.DirectionTile.length;i++){var a=s.vec2.add(t,v.DirectionTile[i],s.vec2());this.context.get(m.TerrainSystem).getTile(a[0],a[1])||r.push(a)}return t=r[d.SharedSystem.random()*r.length|0],s.vec2.copy(t,this.target),s.vec2.copy(e.tile,this.origin),this.context.get(m.TerrainSystem).tilePosition(t[0],t[1],this.targetPosition),this.active=!0,this.activate(this.targetPosition)},t.prototype.launch=function(e){var t,r,i,a,m,v,g,x,b;return o(this,(function(o){switch(o.label){case 0:this.smoke=d.SharedSystem.particles.smoke.add({uLifespan:[.8,1.4,-.3,0],uOrigin:s.mat4.transform([0,3.2,.8],this.mesh.transform.matrix,s.vec3()),uGravity:[0,4,0],uRotation:[0,2*Math.PI],uSize:[1,3],uFieldDomain:[.5,.5,.5,0],uFieldStrength:[8,0]}),this.muzzle=c.Sprite.create(2),this.muzzle.material=d.SharedSystem.materials.sprite.rays,this.muzzle.transform=this.context.get(l.TransformSystem).create([0,3.4,1],s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.muzzle),this.trail=c.Line.create(8,0,.6,h.ease.cubicFadeInOut),this.trail.addColorFade(this.trail.ease,s.vec3(1,.6,.4)),this.trail.material=d.SharedSystem.materials.effect.trailSmoke,this.context.get(f.ParticleEffectPass).add(this.trail),this.wave=c.Sprite.create(0),this.wave.material=d.SharedSystem.materials.displacement.wave,this.wave.transform=this.context.get(l.TransformSystem).create(s.vec3.add([0,.5,0],this.targetPosition,s.vec3()),s.quat.HALF_X,s.vec3.ONE),this.context.get(f.PostEffectPass).add(this.wave),this.embers=d.SharedSystem.particles.embers.add({uLifespan:[.4,.8,0,0],uOrigin:this.targetPosition,uTarget:[0,-.2,0],uRotation:s.vec2.ZERO,uOrientation:s.quat.IDENTITY,uGravity:[0,-14,0],uSize:[.2,.8],uRadius:[0,.5],uForce:[6,16]}),this.projectile=c.BatchMesh.create(d.SharedSystem.geometry.hemisphere),this.projectile.transform=this.context.get(l.TransformSystem).create(),this.projectile.material=d.SharedSystem.materials.effect.exhaust,this.context.get(f.ParticleEffectPass).add(this.projectile),this.splash=c.Sprite.create(0),this.splash.transform=this.context.get(l.TransformSystem).create(s.vec3.add(this.targetPosition,[0,.5,0],s.vec3()),s.quat.HALF_X,s.vec3.ONE),this.splash.material=d.SharedSystem.materials.sprite.burst,this.context.get(f.ParticleEffectPass).add(this.splash),this.burn=this.context.get(f.DecalPass).create(4),this.burn.transform=this.context.get(l.TransformSystem).create(this.targetPosition),this.burn.material=d.SharedSystem.materials.decal.rays,this.pillar=c.Sprite.create(3,0,s.vec4.ONE,[0,.5]),this.pillar.material=d.SharedSystem.materials.sprite.dust,this.pillar.transform=this.context.get(l.TransformSystem).create(this.targetPosition),this.context.get(f.ParticleEffectPass).add(this.pillar),this.hitLight=this.context.get(f.PointLightPass).create([1,.8,.5]),this.hitLight.transform=this.context.get(l.TransformSystem).create(s.vec3.add(this.targetPosition,[0,2,0],s.vec3())),t=s.mat4.transform([0,3.4,.8],this.mesh.transform.matrix,s.vec3()),r=s.mat4.transform([0,5,3],this.mesh.transform.matrix,s.vec3()),i=s.vec3.set(this.targetPosition[0],r[1],this.targetPosition[2],s.vec3()),s.vec3.centroid(i,r,i),a=h.FollowPath.curve(s.cubicBezier3D.bind(null,t,r,i,this.targetPosition),{frame:.6,duration:.8,ease:h.ease.CubicBezier(0,.75,1,.75)}),m=h.EventTrigger([{frame:1.4,value:e}],p.AIUnitSkill.damage),v=h.AnimationTimeline(this,n(n({},y),{trail:h.FollowPath.Line(a,{length:.1}),"projectile.transform":h.FollowPath(a)})),this.context.get(u.AudioSystem).create("assets/mortar_use.mp3","sfx",this.mesh.transform).play(0),this.context.get(u.AudioSystem).create("assets/mortar_hit.mp3","sfx",this.burn.transform).play(1.4),g=2.4,x=this.context.currentTime,o.label=1;case 1:return b=this.context.currentTime-x,v(b,this.context.deltaTime),m(b,this.context.deltaTime,this),b>g?[3,5]:[3,2];case 2:return[4,h.ActionSignal.WaitNextFrame];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return d.SharedSystem.particles.smoke.remove(this.smoke),d.SharedSystem.particles.embers.remove(this.embers),this.context.get(l.TransformSystem).delete(this.aura.transform),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.muzzle.transform),this.context.get(l.TransformSystem).delete(this.wave.transform),this.context.get(l.TransformSystem).delete(this.burn.transform),this.context.get(l.TransformSystem).delete(this.splash.transform),this.context.get(l.TransformSystem).delete(this.pillar.transform),this.context.get(l.TransformSystem).delete(this.projectile.transform),this.context.get(l.TransformSystem).delete(this.reticle.transform),this.context.get(l.TransformSystem).delete(this.hitLight.transform),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.PointLightPass).delete(this.hitLight),this.context.get(f.DecalPass).delete(this.aura),this.context.get(f.DecalPass).delete(this.burn),this.context.get(f.DecalPass).delete(this.reticle),this.context.get(f.PostEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.trail),this.context.get(f.ParticleEffectPass).remove(this.muzzle),this.context.get(f.ParticleEffectPass).remove(this.splash),this.context.get(f.ParticleEffectPass).remove(this.pillar),this.context.get(f.ParticleEffectPass).remove(this.projectile),c.Sprite.delete(this.pillar),c.Sprite.delete(this.splash),c.Sprite.delete(this.muzzle),c.Sprite.delete(this.wave),c.Line.delete(this.trail),c.BatchMesh.delete(this.projectile),[2]}}))},t.prototype.activate=function(e){var t,r,i,a,m,p;return o(this,(function(o){switch(o.label){case 0:t=this.mesh.transform.position,r=Math.atan2(e[0]-t[0],e[2]-t[2]),this.aura=this.context.get(f.DecalPass).create(4),this.aura.transform=this.context.get(l.TransformSystem).create(s.vec3.ZERO,s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.aura.material=d.SharedSystem.materials.glowSquaresRadialMaterial,this.reticle=this.context.get(f.DecalPass).create(4),this.reticle.transform=this.context.get(l.TransformSystem).create(e),this.reticle.material=d.SharedSystem.materials.decal.reticle,this.cylinder=c.BatchMesh.create(d.SharedSystem.geometry.lowpolyCylinder),this.cylinder.material=d.SharedSystem.materials.effect.stripes,this.cylinder.transform=this.context.get(l.TransformSystem).create([0,1.8,0],s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.cylinder),this.light=this.context.get(f.PointLightPass).create(),this.light.transform=this.context.get(l.TransformSystem).create([0,3,0],s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.light.radius=4,this.flash=c.Sprite.create(2),this.flash.transform=this.context.get(l.TransformSystem).create([0,3.4,1.2],s.quat.IDENTITY,s.vec3.ONE,this.mesh.transform),this.flash.material=d.SharedSystem.materials.sprite.sparkle,this.context.get(f.ParticleEffectPass).add(this.flash),this.ring=c.Sprite.create(0),this.ring.transform=this.context.get(l.TransformSystem).create(s.vec3.AXIS_Y,s.quat.HALF_X,s.vec3.ONE,this.mesh.transform),this.ring.material=d.SharedSystem.materials.sprite.ring,this.context.get(f.ParticleEffectPass).add(this.ring),i=h.AnimationTimeline(this,n(n({},g),{"mesh.transform.rotation":h.PropertyAnimation([{frame:.2,value:s.quat.copy(this.mesh.transform.rotation,s.quat())},{frame:.8,value:s.quat.axisAngle(s.vec3.AXIS_Y,r,s.quat()),ease:h.ease.quadInOut}],s.quat.slerp)})),this.context.get(u.AudioSystem).create("assets/mortar_aim.mp3","sfx",this.mesh.transform).play(0),a=1.6,m=this.context.currentTime,o.label=1;case 1:return p=this.context.currentTime-m,i(p,this.context.deltaTime),p>a?[3,5]:[3,2];case 2:return[4,h.ActionSignal.WaitNextFrame];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return this.context.get(l.TransformSystem).delete(this.flash.transform),this.context.get(l.TransformSystem).delete(this.cylinder.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(f.ParticleEffectPass).remove(this.flash),this.context.get(f.ParticleEffectPass).remove(this.cylinder),this.context.get(f.ParticleEffectPass).remove(this.ring),c.Sprite.delete(this.ring),c.Sprite.delete(this.flash),c.BatchMesh.delete(this.cylinder),[2]}}))},t.prototype.deactivate=function(e){var t,r,i,a;return o(this,(function(n){switch(n.label){case 0:if(!this.active)return[2];if(this.active=!1,t=h.AnimationTimeline(this,{"mesh.armature":d.ModelAnimation("activate"),"light.intensity":h.PropertyAnimation([{frame:0,value:0},{frame:.5,value:2,ease:h.ease.sineOut}],s.lerp),"aura.threshold":h.PropertyAnimation([{frame:0,value:-3},{frame:.5,value:0,ease:h.ease.sineOut}],s.lerp),"reticle.color":h.PropertyAnimation([{frame:0,value:s.vec4.ZERO},{frame:.5,value:[1,.4,.8,.4],ease:h.ease.quadOut}],s.vec4.lerp)}),e)return[3,5];r=.5,i=this.context.currentTime,n.label=1;case 1:return a=this.context.currentTime-i,t(r-a,this.context.deltaTime),a>r?[3,5]:[3,2];case 2:return[4,h.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(l.TransformSystem).delete(this.aura.transform),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.reticle.transform),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.DecalPass).delete(this.aura),this.context.get(f.DecalPass).delete(this.reticle),[2]}}))},t}(p.AIUnitSkill);t.MortarSkill=x},5450:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectileSkill=void 0;var s=r(4454),c=r(8581),l=r(9336),u=r(6365),f=r(296),h=r(6725),m=r(3605),d=r(7822),p=r(6888),v={"mesh.armature":d.ModelAnimation("activateVariant"),"light.radius":h.PropertyAnimation([{frame:1.1,value:0},{frame:1.7,value:6,ease:h.ease.quadOut}],s.lerp),"light.intensity":h.PropertyAnimation([{frame:1.1,value:8},{frame:1.7,value:0,ease:h.ease.sineIn}],s.lerp),fire:h.EventTrigger([{frame:1,value:48}],h.EventTrigger.emit),"wave.transform.scale":h.PropertyAnimation([{frame:1.2,value:s.vec3.ZERO},{frame:1.6,value:[8,8,8],ease:h.ease.cubicOut}],s.vec3.lerp),"wave.color":h.PropertyAnimation([{frame:1.2,value:s.vec4.ONE},{frame:1.6,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),"core.transform.scale":h.PropertyAnimation([{frame:1,value:s.vec3.ZERO},{frame:1.6,value:[3,3,3],ease:h.ease.cubicOut}],s.vec3.lerp),"core.color":h.PropertyAnimation([{frame:1,value:[.2,1,.6,1]},{frame:1.6,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"circle.transform.scale":h.PropertyAnimation([{frame:1,value:s.vec3.ZERO},{frame:1.4,value:[6,6,6],ease:h.ease.quartOut}],s.vec3.lerp),"circle.color":h.PropertyAnimation([{frame:1,value:[.6,1,1,0]},{frame:1.4,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"pillar.transform.scale":h.PropertyAnimation([{frame:0,value:[2,0,2]},{frame:.5,value:[1,3,1],ease:h.ease.quadOut},{frame:.8,value:[0,4,0],ease:h.ease.quadIn}],s.vec3.lerp),"pillar.color":h.PropertyAnimation([{frame:0,value:s.vec4.ZERO},{frame:.5,value:[.4,1,.8,1],ease:h.ease.cubicOut}],s.vec4.lerp),"muzzle.transform.scale":h.PropertyAnimation([{frame:.7,value:[0,-1,0]},{frame:1.1,value:[.6,-2.8,.6],ease:h.ease.cubicOut}],s.vec3.lerp),"muzzle.color":h.PropertyAnimation([{frame:.7,value:[.4,1,.8,0]},{frame:1.1,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),"flash.transform.scale":h.PropertyAnimation([{frame:.8,value:s.vec3.ZERO},{frame:1.4,value:[3,3,3],ease:h.ease.cubicOut}],s.vec3.lerp),"flash.color":h.PropertyAnimation([{frame:.8,value:[.4,1,.9,1]},{frame:1.4,value:[0,1,.5,.2],ease:h.ease.quadIn}],s.vec4.lerp),"ring.transform.scale":h.PropertyAnimation([{frame:.7,value:s.vec3.ZERO},{frame:1,value:[4,4,4],ease:h.ease.quadOut}],s.vec3.lerp),"ring.color":h.PropertyAnimation([{frame:.7,value:[.6,1,1,0]},{frame:1,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp)},y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.range=5,t.cardinal=!0,t.pierce=!1,t.damageType=9,t.damage=1,t}return a(t,e),t.prototype.validate=function(t,r){return e.prototype.validate.call(this,t,r)&&p.AIStrategy.lineOfSight(this.context.get(m.TerrainSystem).pathfinder,t,r)},t.prototype.use=function(e,t){var r,i,a,y,g,x,b,S,P;return o(this,(function(o){switch(o.label){case 0:this.mesh=e.mesh,r=s.quat.axisAngle(s.vec3.AXIS_Y,Math.atan2(t[0]-e.tile[0],t[1]-e.tile[1]),s.quat()),i=this.context.get(l.TransformSystem).create(s.vec3.ZERO,r,s.vec3.ONE,this.mesh.transform),this.pillar=c.BatchMesh.create(d.SharedSystem.geometry.lowpolyCylinder),this.pillar.material=d.SharedSystem.materials.effect.stripesRed,this.pillar.transform=this.context.get(l.TransformSystem).create([0,1.8,0],s.quat.HALF_X,s.vec3.ONE,i),this.context.get(f.ParticleEffectPass).add(this.pillar),this.muzzle=c.BatchMesh.create(d.SharedSystem.geometry.cone),this.muzzle.material=d.SharedSystem.materials.sprite.streak,this.muzzle.transform=this.context.get(l.TransformSystem).create([0,1.8,1.2],s.quat.HALF_X,s.vec3.ONE,i),this.context.get(f.ParticleEffectPass).add(this.muzzle),this.flash=c.Sprite.create(0),this.flash.material=d.SharedSystem.materials.effect.flashYellow,this.flash.transform=this.context.get(l.TransformSystem).create([0,1.8,1.8],s.quat.IDENTITY,s.vec3.ONE,i),this.context.get(f.ParticleEffectPass).add(this.flash),this.ring=c.Sprite.create(0),this.ring.material=d.SharedSystem.materials.sprite.swirl,this.ring.transform=this.context.get(l.TransformSystem).create([0,1.8,2],s.quat.IDENTITY,s.vec3.ONE,i),this.context.get(f.ParticleEffectPass).add(this.ring),this.trail=c.Line.create(8,0,.8,h.ease.reverse(h.ease.quadIn),!0),this.trail.material=d.SharedSystem.materials.sprite.lineTeal,this.context.get(f.ParticleEffectPass).add(this.trail),a=s.mat4.transform([0,1.8,0],this.mesh.transform.matrix,s.vec3()),y=this.context.get(m.TerrainSystem).tilePosition(t[0],t[1],s.vec3()),this.light=this.context.get(f.PointLightPass).create([.4,1,.9]),this.light.transform=this.context.get(l.TransformSystem).create(s.vec3.add([0,1,0],y,s.vec3())),this.fire=d.SharedSystem.particles.fire.add({uLifespan:s.vec4(.4,.8,-.2,0),uOrigin:s.vec3.add([0,.5,0],y,s.vec3()),uRotation:s.vec2.ZERO,uGravity:s.vec3.ZERO,uSize:s.vec2(1,3),uRadius:s.vec2(.8,1.4)}),this.wave=c.Sprite.create(2),this.wave.material=d.SharedSystem.materials.displacement.bulge,this.wave.transform=this.context.get(l.TransformSystem).create(y),this.context.get(f.PostEffectPass).add(this.wave),this.core=c.BatchMesh.create(d.SharedSystem.geometry.lowpolySphere),this.core.material=d.SharedSystem.materials.effect.energyPurple,this.core.transform=this.context.get(l.TransformSystem).create(y),this.context.get(f.ParticleEffectPass).add(this.core),this.circle=c.Sprite.create(0),this.circle.material=d.SharedSystem.materials.sprite.burst,this.circle.transform=this.context.get(l.TransformSystem).create(s.vec3.add([0,.5,0],y,s.vec3()),s.quat.HALF_X),this.context.get(f.ParticleEffectPass).add(this.circle),g=h.EventTrigger([{frame:1,value:t}],p.AIUnitSkill.damage),x=h.AnimationTimeline(this,n({"mesh.armature.nodes.0.rotation":h.PropertyAnimation([{frame:0,value:s.quat.copy(this.mesh.armature.nodes[0].rotation,s.quat())},{frame:.5,value:s.quat.multiply(s.quat.axisAngle(s.vec3.AXIS_Y,-.5*Math.PI,s.quat()),r,s.quat()),ease:h.ease.quadInOut}],s.quat.slerp),trail:h.FollowPath.Line(h.FollowPath.separate(h.PropertyAnimation([{frame:.6,value:a[0]},{frame:1,value:y[0],ease:h.ease.linear}],s.lerp),h.PropertyAnimation([{frame:.6,value:a[1]},{frame:1,value:y[1],ease:h.ease.cubicIn}],s.lerp),h.PropertyAnimation([{frame:.6,value:a[2]},{frame:1,value:y[2],ease:h.ease.linear}],s.lerp)),{length:.06})},v)),this.context.get(u.AudioSystem).create("assets/cannon_use.mp3","sfx",this.mesh.transform).play(.6),this.context.get(u.AudioSystem).create("assets/cannon_hit.mp3","sfx",this.light.transform).play(1),b=2,S=this.context.currentTime,o.label=1;case 1:return P=this.context.currentTime-S,x(P,this.context.deltaTime),g(P,this.context.deltaTime,this),P>b?[3,5]:[3,2];case 2:return[4,h.ActionSignal.WaitNextFrame];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return this.context.get(l.TransformSystem).delete(i),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(l.TransformSystem).delete(this.flash.transform),this.context.get(l.TransformSystem).delete(this.muzzle.transform),this.context.get(l.TransformSystem).delete(this.pillar.transform),this.context.get(l.TransformSystem).delete(this.circle.transform),this.context.get(l.TransformSystem).delete(this.core.transform),this.context.get(l.TransformSystem).delete(this.wave.transform),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.wave.transform),d.SharedSystem.particles.fire.remove(this.fire),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.PostEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.trail),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.ParticleEffectPass).remove(this.flash),this.context.get(f.ParticleEffectPass).remove(this.muzzle),this.context.get(f.ParticleEffectPass).remove(this.pillar),this.context.get(f.ParticleEffectPass).remove(this.circle),this.context.get(f.ParticleEffectPass).remove(this.core),c.Sprite.delete(this.ring),c.Sprite.delete(this.flash),c.Sprite.delete(this.wave),c.Sprite.delete(this.circle),c.BatchMesh.delete(this.pillar),c.BatchMesh.delete(this.muzzle),c.BatchMesh.delete(this.core),c.Line.delete(this.trail),[2]}}))},t}(p.AIUnitSkill);t.ProjectileSkill=y},6907:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShieldLinkSkill=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(6725),f=r(296),h=r(3605),m=r(7822),d=r(6888),p=function(){function e(t){this.context=t,this.idleIndex=-1,this.start=o.vec3(),this.middle=o.vec3(),this.end=o.vec3(),this.curve=u.FollowPath.curve(o.quadraticBezier3D.bind(null,this.start,this.middle,this.end),{frame:0,duration:1,ease:u.ease.sineOut}),this.line=s.Line.create(16,0,1,(function(e){return.2+.8*u.ease.sineIn(Math.max(0,1-2*e))})),this.line.addColorFade(e.fade,[1,.8,1]),this.line.material=m.SharedSystem.materials.effect.trailEnergy}return e.prototype.activate=function(t){var r,i,a,l,h,d,p,v;return n(this,(function(n){switch(n.label){case 0:r=this.context.currentTime+t,n.label=1;case 1:return this.context.currentTime<r?[4,u.ActionSignal.WaitNextFrame]:[3,4];case 2:n.sent(),n.label=3;case 3:return[3,1];case 4:this.shield=s.Mesh.create(m.SharedSystem.geometry.sphereMesh),this.shield.buffer=m.SharedSystem.geometry.sphereMesh,this.shield.material=m.SharedSystem.materials.shieldMaterial,this.shield.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.target.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.shield),this.glow=s.Sprite.create(2),this.glow.material=m.SharedSystem.materials.sprite.particle,this.glow.transform=this.context.get(c.TransformSystem).create([0,1.5,0],o.quat.IDENTITY,o.vec3.ONE,this.target.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.glow),this.line.material=m.SharedSystem.materials.effect.trailEnergy,this.context.get(f.ParticleEffectPass).add(this.line),i=u.AnimationTimeline(this,{"shield.color":u.PropertyAnimation([{frame:1,value:[.6,.2,1,1]},{frame:2,value:o.vec4.ZERO,ease:u.ease.sineIn}],o.vec3.lerp),"shield.transform.scale":u.PropertyAnimation([{frame:.2,value:o.vec3.ZERO},{frame:1,value:[1,2,1],ease:u.ease.elasticOut(1,.75)}],o.vec3.lerp),line:u.FollowPath.Line(this.curve,{length:1/(this.line.path.length-1)}),"line.width":u.PropertyAnimation([{frame:0,value:0},{frame:1,value:3,ease:u.ease.quartOut},{frame:2,value:0,ease:u.ease.quadIn}],o.lerp),"glow.transform.scale":u.PropertyAnimation([{frame:.2,value:o.vec3.ZERO},{frame:1,value:[4,4,4],ease:u.ease.quadOut}],o.vec3.lerp),"glow.color":u.PropertyAnimation([{frame:1,value:[.6,.4,1,.2]},{frame:2,value:o.vec4.ZERO,ease:u.ease.sineIn}],o.vec4.lerp)}),a=o.vec3(0,4.5,-1.3),l=o.vec3(0,2,0),this.target.shield++,h=1,d=this.context.currentTime,n.label=5;case 5:if(!(this.idleIndex>=-1))return[3,9];for(p=this.context.currentTime-d,o.mat4.transform(a,this.parent.mesh.transform.matrix,this.start),o.mat4.transform(l,this.target.mesh.transform.matrix,this.end),o.vec3.set(this.end[0],this.start[1],this.end[2],this.middle),i(Math.min(1,p),this.context.deltaTime),v=0;v<this.line.path.length;v++)this.line.path[v][1]+=.4*Math.cos((this.context.currentTime+.08*v)*Math.PI*2)*e.fade(v/(this.line.path.length-1));return p>h&&this.idleIndex<0?[3,9]:[3,6];case 6:return[4,u.ActionSignal.WaitNextFrame];case 7:n.sent(),n.label=8;case 8:return[3,5];case 9:this.target.shield--,h=2,d=this.context.currentTime,n.label=10;case 10:if(!(this.idleIndex>=-1))return[3,14];for(p=this.context.currentTime-d+1,o.mat4.transform(a,this.parent.mesh.transform.matrix,this.start),o.mat4.transform(l,this.target.mesh.transform.matrix,this.end),o.vec3.set(this.end[0],this.start[1],this.end[2],this.middle),i(p,this.context.deltaTime),v=0;v<this.line.path.length;v++)this.line.path[v][1]+=.4*Math.cos((this.context.currentTime+.08*v)*Math.PI*2)*e.fade(v/(this.line.path.length-1));return p>h?[3,14]:[3,11];case 11:return[4,u.ActionSignal.WaitNextFrame];case 12:n.sent(),n.label=13;case 13:return[3,10];case 14:return this.context.get(c.TransformSystem).delete(this.shield.transform),this.context.get(c.TransformSystem).delete(this.glow.transform),this.context.get(f.ParticleEffectPass).remove(this.shield),this.context.get(f.ParticleEffectPass).remove(this.glow),this.context.get(f.ParticleEffectPass).remove(this.line),s.Sprite.delete(this.glow),e.pool.push(this),[2]}}))},e.prototype.deactivate=function(e){var t=this.idleIndex;t<0||(this.idleIndex=e?-2:-1,e&&this.context.get(u.AnimationSystem).stop(t,!0))},e.pool=[],e.fade=function(e){return 1-u.ease.quadOut(Math.max(0,1-2*e))-u.ease.quadIn(Math.max(0,4*(e-1)+1))},e}(),v={"mesh.armature":m.ModelAnimation("activate"),"cylinder.transform.scale":u.PropertyAnimation([{frame:0,value:[3,1,3]},{frame:.8,value:[1,5,1],ease:u.ease.quadOut}],o.vec3.lerp),"cylinder.transform.rotation":u.PropertyAnimation([{frame:0,value:o.quat.IDENTITY},{frame:.8,value:[0,-1,0,0],ease:u.ease.sineOut}],o.quat.slerp),"cylinder.color":u.PropertyAnimation([{frame:0,value:o.vec4.ZERO},{frame:.3,value:[.4,.6,1,.6],ease:u.ease.quadOut},{frame:.8,value:o.vec4.ZERO,ease:u.ease.quadIn}],o.vec4.lerp),"wave.transform.scale":u.PropertyAnimation([{frame:.6,value:o.vec3.ZERO},{frame:1.2,value:[4,4,4],ease:u.ease.cubicOut}],o.vec3.lerp),"wave.color":u.PropertyAnimation([{frame:.6,value:[.8,.4,1,.4]},{frame:1.2,value:o.vec4.ZERO,ease:u.ease.sineIn}],o.vec4.lerp),"core.transform.scale":u.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.8,value:[1.4,1.4,1.4],ease:u.ease.elasticOut(1,.6)}],o.vec3.lerp),"core.color":u.PropertyAnimation([{frame:0,value:[.4,.4,1,.8]}],o.vec4.lerp),"core.transform.position":u.PropertyAnimation([{frame:.6,value:[0,5.5,-1.3]},{frame:1,value:[0,4.5,-1.3],ease:u.ease.sineInOut}],o.vec3.lerp),"glow.transform.scale":u.PropertyAnimation([{frame:.6,value:o.vec3.ZERO},{frame:1.2,value:[4,4,4],ease:u.ease.quadOut}],o.vec3.lerp),"glow.color":u.PropertyAnimation([{frame:.6,value:o.vec4.ONE},{frame:1.2,value:[.6,.4,1,0],ease:u.ease.sineIn}],o.vec4.lerp),"glow.transform.position":u.PropertyAnimation([{frame:.6,value:[0,5.5,-1.3]},{frame:1,value:[0,4.5,-1.3],ease:u.ease.sineInOut}],o.vec3.lerp),"pillar.transform.scale":u.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.6,value:[4,6,4],ease:u.ease.quartOut}],o.vec3.lerp),"pillar.color":u.PropertyAnimation([{frame:0,value:[1,.5,1,0]},{frame:.6,value:o.vec4.ZERO,ease:u.ease.quadIn}],o.vec4.lerp),"circle.transform.scale":u.PropertyAnimation([{frame:.7,value:o.vec3.ZERO},{frame:1.8,value:[5,5,5],ease:u.ease.cubicOut}],o.vec3.lerp),"circle.color":u.PropertyAnimation([{frame:.7,value:[.4,.2,1,1]},{frame:1.8,value:[0,0,1,0],ease:u.ease.quadIn}],o.vec4.lerp),"bulge.transform.scale":u.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[6,6,6],ease:u.ease.quadOut}],o.vec3.lerp),"bulge.color":u.PropertyAnimation([{frame:.8,value:o.vec4.ONE},{frame:1.4,value:o.vec4.ZERO,ease:u.ease.cubicIn}],o.vec4.lerp)},y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.range=4,t.cardinal=!1,t.pierce=!1,t.links=[],t.idleIndex=-1,t}return a(t,e),t.prototype.query=function(e){var t=this.context.get(h.TerrainSystem);return d.AIUnitSkill.queryArea(this.context,e.tile,this.minRange,this.range,2).map((function(e){return t.getTile(e[0],e[1])})).filter((function(t){return t&&t instanceof d.AIUnit&&t!==e&&1==t.size[0]}))},t.prototype.use=function(e,t){var r,i,a,h,d,y,g;return n(this,(function(t){switch(t.label){case 0:for(this.mesh=e.mesh,this.cylinder=s.BatchMesh.create(m.SharedSystem.geometry.lowpolyCylinder),this.cylinder.material=m.SharedSystem.materials.sprite.spiral,this.cylinder.transform=this.context.get(c.TransformSystem).create([0,.5,-1.3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.cylinder),this.wave=s.Sprite.create(0),this.wave.material=m.SharedSystem.materials.sprite.ring,this.wave.transform=this.context.get(c.TransformSystem).create([0,4,-1.3],o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.wave),this.core=s.BatchMesh.create(m.SharedSystem.geometry.lowpoly.sphere),this.core.material=m.SharedSystem.materials.effect.energyPurple,this.core.transform=this.context.get(c.TransformSystem).create([0,4.5,-1.3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.core),this.glow=s.Sprite.create(2),this.glow.material=m.SharedSystem.materials.sprite.glow,this.glow.transform=this.context.get(c.TransformSystem).create([0,4.5,-1.3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.glow),this.pillar=s.Sprite.create(3,0,o.vec4.ONE,[0,.5]),this.pillar.material=m.SharedSystem.materials.sprite.beam,this.pillar.transform=this.context.get(c.TransformSystem).create([0,2,-1.3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.pillar),this.circle=s.Sprite.create(0),this.circle.material=m.SharedSystem.materials.effect.flashYellow,this.circle.transform=this.context.get(c.TransformSystem).create([0,4.5,-1.3],o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(f.ParticleEffectPass).add(this.circle),this.bulge=s.Sprite.create(2),this.bulge.material=m.SharedSystem.materials.displacement.bulge,this.bulge.transform=this.context.get(c.TransformSystem).create([0,4.5,-1.3],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(f.PostEffectPass).add(this.bulge),r=this.query(e),i=0;i<r.length;i++)(a=p.pool.pop()||new p(this.context)).parent=e,a.target=r[i],this.links.push(a),a.idleIndex=this.context.get(u.AnimationSystem).start(a.activate(.5),!0);h=u.AnimationTimeline(this,v),this.context.get(l.AudioSystem).create("assets/link_use.mp3","sfx",this.mesh.transform).play(0),this.sound=this.context.get(l.AudioSystem).create("assets/link_loop.mp3","sfx",this.mesh.transform),this.sound.volume(0,0).volume(.5,.5).play(0),d=1.8,y=this.context.currentTime,t.label=1;case 1:return g=this.context.currentTime-y,h(g,this.context.deltaTime),g>d?[3,5]:[3,2];case 2:return[4,u.ActionSignal.WaitNextFrame];case 3:t.sent(),t.label=4;case 4:return[3,1];case 5:return this.idleIndex=this.context.get(u.AnimationSystem).start(this.idle(),!0),this.active=!0,this.context.get(c.TransformSystem).delete(this.cylinder.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.pillar.transform),this.context.get(c.TransformSystem).delete(this.circle.transform),this.context.get(c.TransformSystem).delete(this.bulge.transform),this.context.get(f.PostEffectPass).remove(this.bulge),this.context.get(f.ParticleEffectPass).remove(this.cylinder),this.context.get(f.ParticleEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.pillar),this.context.get(f.ParticleEffectPass).remove(this.circle),s.Sprite.delete(this.bulge),s.Sprite.delete(this.wave),s.Sprite.delete(this.pillar),s.Sprite.delete(this.circle),s.BatchMesh.delete(this.cylinder),[2]}}))},t.prototype.idle=function(){var e,t,r,i,a,l;return n(this,(function(n){switch(n.label){case 0:t=-.5*Math.PI/.6,a=this.context.currentTime,n.label=1;case 1:return l=this.context.currentTime-a,e=(l*t-.5*Math.PI)%(2*Math.PI),o.quat.axisAngle(o.vec3.AXIS_Y,e,this.mesh.armature.nodes[2].rotation),this.mesh.armature.frame=0,this.idleIndex<0?[3,5]:[3,2];case 2:return[4,u.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:for(this.active=!1,r=u.AnimationTimeline(this,{"mesh.armature.nodes.2.rotation":u.PropertyAnimation([{frame:0,value:o.quat.axisAngle(o.vec3.AXIS_Y,e,o.quat())},{frame:.5,value:o.quat.IDENTITY,ease:u.ease.quadOut}],o.quat.slerp),"mesh.armature":m.ModelAnimation("deactivate"),"core.color":u.PropertyAnimation([{frame:0,value:[.4,.4,1,.8]},{frame:.6,value:o.vec4.ZERO,ease:u.ease.quadOut}],o.vec4.lerp),"glow.color":u.PropertyAnimation([{frame:0,value:[.6,.4,1,0]},{frame:.4,value:o.vec4.ZERO,ease:u.ease.sineIn}],o.vec4.lerp)});this.links.length;)this.links.pop().deactivate(this.idleIndex<-1);this.sound=void this.sound.volume(1,0).stop(1),i=1,a=this.context.currentTime,n.label=6;case 6:return this.idleIndex>=-1?(l=this.context.currentTime-a,r(l,this.context.deltaTime),l>i?[3,10]:[3,7]):[3,10];case 7:return[4,u.ActionSignal.WaitNextFrame];case 8:n.sent(),n.label=9;case 9:return[3,6];case 10:return this.context.get(c.TransformSystem).delete(this.core.transform),this.context.get(c.TransformSystem).delete(this.glow.transform),this.context.get(f.ParticleEffectPass).remove(this.core),this.context.get(f.ParticleEffectPass).remove(this.glow),s.Sprite.delete(this.glow),s.BatchMesh.delete(this.core),[2]}}))},t.prototype.deactivate=function(e){var t;return n(this,(function(r){switch(r.label){case 0:return(t=this.idleIndex)<0?[2]:(this.idleIndex=e?-2:-1,e?(this.context.get(u.AnimationSystem).stop(t,!0),[3,3]):[3,1]);case 1:return[4,this.context.get(u.AnimationSystem).await(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))},t}(d.AIUnitSkill);t.ShieldLinkSkill=y},8771:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShockwaveSkill=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(296),f=r(6725),h=r(7822),m=r(6888),d={"mesh.armature":h.ModelAnimation("activate"),"mesh.color":f.PropertyAnimation([{frame:1,value:o.vec4.ONE},{frame:1.4,value:[.8,0,.6,1],ease:f.ease.cubicOut},{frame:2,value:o.vec4.ONE,ease:f.ease.sineIn}],o.vec4.lerp),"pulse.transform.scale":f.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:2,value:[16,16,16],ease:f.ease.quadOut}],o.vec3.lerp),"pulse.color":f.PropertyAnimation([{frame:1.4,value:o.vec4.ONE},{frame:2,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"core.transform.scale":f.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.3,value:[2.6,2.6,2.6],ease:f.ease.cubicOut}],o.vec3.lerp),"core.color":f.PropertyAnimation([{frame:.8,value:[.4,1,.8,1]},{frame:1.3,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"sparkle.transform.scale":f.PropertyAnimation([{frame:.7,value:o.vec3.ZERO},{frame:.9,value:[6,2,2],ease:f.ease.cubicOut}],o.vec3.lerp),"sparkle.color":f.PropertyAnimation([{frame:.7,value:[.6,1,1,0]},{frame:.9,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"ring.transform.scale":f.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[8,8,8],ease:f.ease.cubicOut}],o.vec3.lerp),"ring.color":f.PropertyAnimation([{frame:.8,value:[.5,1,1,.4]},{frame:1.4,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"cylinder.transform.scale":f.PropertyAnimation([{frame:.4,value:[0,8,0]},{frame:1.2,value:[2.4,5,2.4],ease:f.ease.quadOut}],o.vec3.lerp),"cylinder.color":f.PropertyAnimation([{frame:.4,value:[.4,.8,1,1]},{frame:1.2,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),speedlines:f.EventTrigger([{frame:0,value:32}],f.EventTrigger.emit),"cone.transform.scale":f.PropertyAnimation([{frame:.4,value:[0,0,10]},{frame:1.6,value:[3,3,4],ease:f.ease.cubicOut}],o.vec3.lerp),"cone.color":f.PropertyAnimation([{frame:.4,value:[.2,.8,1,0]},{frame:1.6,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"flash.transform.scale":f.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[5,5,5],ease:f.ease.quartOut}],o.vec3.lerp),"flash.color":f.PropertyAnimation([{frame:.8,value:[1,.8,1,.6]},{frame:1.4,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.range=5,t.cardinal=!1,t.pierce=!1,t.damageType=31,t.damage=1,t}return a(t,e),t.prototype.use=function(e,t){var r,i,a,p,v;return n(this,(function(n){switch(n.label){case 0:this.mesh=e.mesh,this.pulse=s.Mesh.create(h.SharedSystem.geometry.sphereMesh,1),this.pulse.material=h.SharedSystem.materials.pulseMaterial,this.pulse.transform=this.context.get(c.TransformSystem).create([0,6,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.PostEffectPass).add(this.pulse),this.ring=s.Sprite.create(0),this.ring.material=h.SharedSystem.materials.sprite.swirl,this.ring.transform=this.context.get(c.TransformSystem).create([0,4,0],o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.ring),this.cylinder=s.BatchMesh.create(h.SharedSystem.geometry.lowpolyCylinder),this.cylinder.material=h.SharedSystem.materials.effect.energyHalfPurple,this.cylinder.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.cylinder),this.speedlines=h.SharedSystem.particles.energy.add({uLifespan:[.6,1,-.2,0],uOrigin:o.mat4.transform(o.vec3.ZERO,this.mesh.transform.matrix,o.vec3()),uRotation:o.vec2.ZERO,uGravity:[0,8,0],uSize:[.2,.6],uRadius:[3,5],uForce:o.vec2.ZERO,uTarget:[0,5,0]}),this.cone=s.BatchMesh.create(h.SharedSystem.geometry.hemisphere),this.cone.material=h.SharedSystem.materials.effect.absorbTeal,this.cone.transform=this.context.get(c.TransformSystem).create([0,2.5,0],o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.cone),this.flash=s.Sprite.create(2),this.flash.material=h.SharedSystem.materials.sprite.halo,this.flash.transform=this.context.get(c.TransformSystem).create([0,5,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.flash),this.core=s.BatchMesh.create(h.SharedSystem.geometry.lowpolySphere),this.core.material=h.SharedSystem.materials.effect.energyPurple,this.core.transform=this.context.get(c.TransformSystem).create([0,4,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.core),this.sparkle=s.Sprite.create(2),this.sparkle.material=h.SharedSystem.materials.sprite.sparkle,this.sparkle.transform=this.context.get(c.TransformSystem).create([0,5.4,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.sparkle),r=f.EventTrigger([{frame:1,value:t}],m.AIUnitSkill.damage),i=f.AnimationTimeline(this,d),this.context.get(l.AudioSystem).create("assets/wave_use.mp3","sfx",this.mesh.transform).play(.2),a=3,p=this.context.currentTime,n.label=1;case 1:return v=this.context.currentTime-p,i(v,this.context.deltaTime),r(v,this.context.deltaTime,this),v>a?[3,5]:[3,2];case 2:return[4,f.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(c.TransformSystem).delete(this.core.transform),this.context.get(c.TransformSystem).delete(this.sparkle.transform),this.context.get(c.TransformSystem).delete(this.flash.transform),this.context.get(c.TransformSystem).delete(this.cone.transform),this.context.get(c.TransformSystem).delete(this.cylinder.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.pulse.transform),h.SharedSystem.particles.energy.remove(this.speedlines),this.context.get(u.ParticleEffectPass).remove(this.core),this.context.get(u.ParticleEffectPass).remove(this.sparkle),this.context.get(u.ParticleEffectPass).remove(this.flash),this.context.get(u.ParticleEffectPass).remove(this.cylinder),this.context.get(u.ParticleEffectPass).remove(this.cone),this.context.get(u.ParticleEffectPass).remove(this.ring),this.context.get(u.PostEffectPass).remove(this.pulse),s.Sprite.delete(this.sparkle),s.Sprite.delete(this.flash),s.Sprite.delete(this.ring),s.BatchMesh.delete(this.cylinder),s.BatchMesh.delete(this.cone),s.BatchMesh.delete(this.core),[2]}}))},t}(m.AIUnitSkill);t.ShockwaveSkill=p},7153:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SpawnerSkill=void 0;var s=r(4454),c=r(8581),l=r(9336),u=r(6365),f=r(296),h=r(6725),m=r(7822),d=r(6888),p=r(3605),v={"scarab.mesh.color":h.PropertyAnimation([{frame:.4,value:[16,0,0,.2]},{frame:1.6,value:s.vec4.ONE,ease:h.ease.quadIn}],s.vec4.lerp),"light.radius":h.PropertyAnimation([{frame:.2,value:0},{frame:1.2,value:4,ease:h.ease.quadOut}],s.lerp),"light.intensity":h.PropertyAnimation([{frame:.2,value:6},{frame:1.2,value:0,ease:h.ease.sineIn}],s.lerp),"glow.transform.scale":h.PropertyAnimation([{frame:.2,value:[1,0,1]},{frame:1.1,value:[1,4,1],ease:h.ease.cubicOut}],s.vec3.lerp),"glow.color":h.PropertyAnimation([{frame:.2,value:[1,.4,.6,0]},{frame:1.1,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"beam.transform.scale":h.PropertyAnimation([{frame:.4,value:[4,0,4]},{frame:.8,value:[2,4,2],ease:h.ease.quartOut}],s.vec3.lerp),"beam.color":h.PropertyAnimation([{frame:.4,value:[.8,.7,1,0]},{frame:.8,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),smoke:h.EventTrigger([{frame:0,value:24}],h.EventTrigger.emit),"ring.transform.scale":h.PropertyAnimation([{frame:.4,value:s.vec3.ZERO},{frame:1,value:[6,6,6],ease:h.ease.cubicOut}],s.vec3.lerp),"ring.color":h.PropertyAnimation([{frame:.4,value:[1,.7,.8,.4]},{frame:1,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp)},y=function(){function e(e,t,r,i,a){this.context=e,this.skill=t,this.key=r,this.index=i,this.tile=a}return e.prototype.validate=function(e){return null==this.context.get(p.TerrainSystem).getTile(e[0]+this.tile[0],e[1]+this.tile[1])},e.prototype.activate=function(e,t){var r,i,a,y,g,x,b;return o(this,(function(o){switch(o.label){case 0:if(this.mesh=e.mesh,null!=this.context.get(p.TerrainSystem).getTile(e.tile[0]+this.tile[0],e.tile[1]+this.tile[1]))return[2];this.scarab=this.context.get(d.AISystem).create(e.tile[0]+this.tile[0],e.tile[1]+this.tile[1],0),r=this.mesh.armature.nodes[this.index].position,i=this.mesh.armature.nodes[this.index].rotation,(a=this.context.get(l.TransformSystem).create(r,i,s.vec3.ONE,this.mesh.transform)).recalculate(this.context.frame),this.glow=c.BatchMesh.create(m.SharedSystem.geometry.openBox),this.glow.material=m.SharedSystem.materials.gradientMaterial,this.glow.transform=this.context.get(l.TransformSystem).create(s.vec3.ZERO,s.quat.HALF_Y,s.vec3.ONE,a),this.context.get(f.ParticleEffectPass).add(this.glow),this.beam=c.Sprite.create(3,0,s.vec4.ONE,[0,.5]),this.beam.material=m.SharedSystem.materials.sprite.beam,this.beam.transform=this.context.get(l.TransformSystem).create(s.vec3.ZERO,s.quat.HALF_Y,s.vec3.ONE,a),this.context.get(f.ParticleEffectPass).add(this.beam),this.smoke=m.SharedSystem.particles.smoke.add({uLifespan:[.8,1.2,-.4,0],uOrigin:s.mat4.transform([0,.5,-1],a.matrix,s.vec3()),uGravity:[0,8,0],uRotation:[0,2*Math.PI],uSize:[1,4],uFieldDomain:s.vec4.ONE,uFieldStrength:[4,0]}),this.ring=c.Sprite.create(0),this.ring.material=m.SharedSystem.materials.sprite.swirl,this.ring.transform=this.context.get(l.TransformSystem).create([0,1,0],s.quat.HALF_X,s.vec3.ONE,a),this.context.get(f.ParticleEffectPass).add(this.ring),this.light=this.context.get(f.PointLightPass).create([1,.6,.7]),this.light.transform=a,y=h.AnimationTimeline(this,n({"mesh.armature":m.ModelAnimation(this.key),"scarab.mesh.transform.rotation":h.PropertyAnimation([{frame:0,value:s.quat.axisAngle(s.vec3.AXIS_Y,Math.atan2(r[0],r[2]),s.quat())}],s.quat.slerp),"scarab.mesh.transform.position":h.PropertyAnimation([{frame:.4,value:s.mat4.transform([0,-.5,-1],a.matrix,s.vec3())},{frame:1.6,value:s.vec3.copy(this.scarab.mesh.transform.position,s.vec3()),ease:h.ease.quartOut}],s.vec3.lerp)},v)),0==t&&this.context.get(u.AudioSystem).create("assets/spawner_use.mp3","sfx",e.mesh.transform).play(0),g=1.6,x=this.context.currentTime,o.label=1;case 1:return b=this.context.currentTime-x,y(b,this.context.deltaTime),b>g?[3,5]:[3,2];case 2:return[4,h.ActionSignal.WaitNextFrame];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(l.TransformSystem).delete(this.glow.transform),this.context.get(l.TransformSystem).delete(this.beam.transform),this.context.get(f.ParticleEffectPass).remove(this.ring),this.context.get(f.ParticleEffectPass).remove(this.glow),this.context.get(f.ParticleEffectPass).remove(this.beam),m.SharedSystem.particles.smoke.remove(this.smoke),this.context.get(f.PointLightPass).delete(this.light),c.Sprite.delete(this.ring),c.Sprite.delete(this.beam),c.BatchMesh.delete(this.glow),[2]}}))},e}(),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.range=0,t.cardinal=!0,t.pierce=!1,t.damage=0,t.spawners=[new y(t.context,t,"spawner6",6,s.vec2(3,1)),new y(t.context,t,"spawner7",7,s.vec2(1,-1)),new y(t.context,t,"spawner8",8,s.vec2(1,3)),new y(t.context,t,"spawner9",9,s.vec2(-1,1))],t}return a(t,e),t.prototype.validate=function(e,t){for(var r=0,i=0;i<this.spawners.length;i++)this.spawners[i].validate(e)&&r++;return r>=4},t.prototype.use=function(e,t){return h.AnimationSystem.zip(this.spawners.filter((function(t){return t.validate(e.tile)})).map((function(t,r){return t.activate(e,r)})))},t}(d.AIUnitSkill);t.SpawnerSkill=g},144:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.StaticOrbSkill=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(296),f=r(6725),h=r(7822),m=r(3605),d=r(9131),p=r(6888),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tile=o.vec2(),t.direction=o.vec2(),t.damageType=10,t.damage=1,t.health={capacity:4,amount:0},t.group=1,t.range=1,t}return a(t,e),t.prototype.place=function(e,t){o.vec2.set(e,t,this.tile),this.health.amount=this.health.capacity,this.transform=this.context.get(c.TransformSystem).create(),this.context.get(m.TerrainSystem).tilePosition(this.tile[0],this.tile[1],this.transform.position),o.vec3.add(o.vec3.AXIS_Y,this.transform.position,this.transform.position),this.orb=this.context.get(s.MeshSystem).create(h.SharedSystem.geometry.sphereMesh,4,8),this.orb.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.transform),this.orb.material=h.SharedSystem.materials.mesh.orb,this.decal=this.context.get(u.DecalPass).create(8),this.decal.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ZERO,this.transform),this.decal.material=h.SharedSystem.materials.corrosionMaterial,this.bolts=h.SharedSystem.particles.bolts.add({uOrigin:this.transform.position,uLifespan:[.2,.4,0,0],uRadius:[.6,1.2],uRotation:[0,2*Math.PI],uGravity:o.vec3.ZERO,uOrientation:o.quat.IDENTITY,uSize:[.5,2],uFrame:[0,4]})},t.prototype.delete=function(){this.transform=void this.context.get(c.TransformSystem).delete(this.transform),this.context.get(c.TransformSystem).delete(this.orb.transform),this.context.get(c.TransformSystem).delete(this.decal.transform),this.decal=void this.context.get(u.DecalPass).delete(this.decal),this.orb=void this.context.get(s.MeshSystem).delete(this.orb),this.bolts=void h.SharedSystem.particles.bolts.remove(this.bolts),t.pool.push(this)},t.prototype.move=function(e){var t,r,i,a,s,c;return n(this,(function(n){switch(n.label){case 0:if(t=o.vec3.copy(this.transform.position,o.vec3()),r=this.context.get(m.TerrainSystem).tilePosition(this.tile[0],this.tile[1],o.vec3()),o.vec3.add(o.vec3.AXIS_Y,r,r),i=f.AnimationTimeline(this,{"transform.position":f.PropertyAnimation([{frame:0,value:t},{frame:1,value:r,ease:f.ease.quadInOut}],o.vec3.lerp),"bolts.uniform.uniforms.uOrigin":f.PropertyAnimation([{frame:.5,value:r}],o.vec3.lerp)}),o.vec3.equals(t,r,1e-6))return[3,5];a=1,s=this.context.currentTime,n.label=1;case 1:return c=this.context.currentTime-s,i(c,this.context.deltaTime),c>a?[3,5]:[3,2];case 2:return[4,f.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return e&&p.UnitSkill.damage(this,e),[2]}}))},t.prototype.appear=function(e,t){var r,i,a,s;return n(this,(function(n){switch(n.label){case 0:r=f.AnimationTimeline(this,{"transform.position":f.PropertyAnimation([{frame:0,value:o.vec3(this.transform.position[0],e[1]+.7,this.transform.position[2])},{frame:.5,value:o.vec3.copy(this.transform.position,o.vec3()),ease:f.ease.quadIn}],o.vec3.lerp),"decal.transform.scale":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.5,value:[8,8,8],ease:f.ease.cubicOut}],o.vec3.lerp),"decal.color":f.PropertyAnimation([{frame:0,value:[0,1,1,1]}],o.vec4.lerp),"orb.color":f.PropertyAnimation([{frame:0,value:[0,1,1,1]}],o.vec4.lerp),"orb.transform.scale":f.PropertyAnimation([{frame:0,value:o.vec3.ZERO},{frame:.5,value:o.vec3.ONE,ease:f.ease.elasticOut(1,.8)}],o.vec3.lerp),"bolts.rate":f.PropertyAnimation([{frame:0,value:0},{frame:.2,value:.02,ease:f.ease.stepped}],o.lerp)}),i=.5,a=this.context.currentTime+t,n.label=1;case 1:return s=this.context.currentTime-a,r(s,this.context.deltaTime),s>i?[3,5]:[3,2];case 2:return[4,f.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return p.UnitSkill.damage(this,this.tile),[2]}}))},t.prototype.dissolve=function(){var e,t,r,i;return n(this,(function(a){switch(a.label){case 0:e=f.AnimationTimeline(this,{"bolts.rate":f.PropertyAnimation([{frame:0,value:0}],o.lerp),"orb.color":f.PropertyAnimation([{frame:0,value:[0,1,1,1]},{frame:1,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"decal.color":f.PropertyAnimation([{frame:0,value:[0,1,1,1]},{frame:1,value:[0,1,1,0],ease:f.ease.sineOut}],o.vec4.lerp)}),t=1,r=this.context.currentTime,a.label=1;case 1:return i=this.context.currentTime-r,e(i,this.context.deltaTime),i>t?[3,5]:[3,2];case 2:return[4,f.ActionSignal.WaitNextFrame];case 3:a.sent(),a.label=4;case 4:return[3,1];case 5:return this.delete(),[2]}}))},t.pool=[],t}(p.UnitSkill),y={"mesh.armature":h.ModelAnimation("activate"),"ring.transform.scale":f.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[8,8,8],ease:f.ease.quadOut}],o.vec3.lerp),"ring.transform.rotation":f.PropertyAnimation([{frame:.8,value:o.quat.IDENTITY},{frame:1.4,value:o.quat.axisAngle(o.vec3.AXIS_Z,Math.PI,o.quat()),ease:f.ease.sineIn}],o.quat.slerp),"ring.color":f.PropertyAnimation([{frame:.8,value:[.8,.2,1,.4]},{frame:1.4,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"bulge.transform.scale":f.PropertyAnimation([{frame:1,value:o.vec3.ZERO},{frame:1.8,value:[10,10,10],ease:f.ease.cubicOut}],o.vec3.lerp),"bulge.color":f.PropertyAnimation([{frame:1,value:o.vec4.ONE},{frame:1.8,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"light.radius":f.PropertyAnimation([{frame:.8,value:0},{frame:1.6,value:5,ease:f.ease.cubicOut}],o.lerp),"light.intensity":f.PropertyAnimation([{frame:.8,value:6},{frame:1.6,value:0,ease:f.ease.sineIn}],o.lerp),"light.color":f.PropertyAnimation([{frame:1,value:[.4,.2,1]}],o.vec3.lerp),"beam.transform.position":f.PropertyAnimation([{frame:0,value:[0,-.5,0]},{frame:.6,value:[0,.7,1.8],ease:f.ease.quadInOut}],o.vec3.lerp),"beam.transform.scale":f.PropertyAnimation([{frame:.2,value:o.vec3.ZERO},{frame:.8,value:[1.5,6,1.5],ease:f.ease.quartOut}],o.vec3.lerp),"beam.color":f.PropertyAnimation([{frame:.2,value:[1,.6,1,0]},{frame:.8,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"funnel.transform.scale":f.PropertyAnimation([{frame:.4,value:[0,0,-2]},{frame:1.4,value:[.6,.6,-.6],ease:f.ease.quadInOut}],o.vec3.lerp),"funnel.color":f.PropertyAnimation([{frame:.8,value:[.8,.2,1,1],ease:f.ease.cubicOut},{frame:1.4,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"core.transform.scale":f.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.6,value:[1.5,1.5,1.5],ease:f.ease.quadOut}],o.vec3.lerp),"core.color":f.PropertyAnimation([{frame:.8,value:[.4,.2,1,1]},{frame:1.6,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"cone.transform.scale":f.PropertyAnimation([{frame:.6,value:[0,1,0]},{frame:1.2,value:[.6,4,.6],ease:f.ease.sineOut}],o.vec3.lerp),"cone.transform.rotation":f.PropertyAnimation([{frame:.6,value:o.quat.HALF_N_X},{frame:1.2,value:o.quat.multiply(o.quat.HALF_N_X,o.quat.axisAngle(o.vec3.AXIS_Y,Math.PI,o.quat()),o.quat()),ease:f.ease.quadOut}],o.quat.slerp),"cone.color":f.PropertyAnimation([{frame:.6,value:[.4,.6,1,1]},{frame:1.2,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp)},g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.target=o.vec2(),t.cost=1,t.range=4,t.cardinal=!0,t.pierce=!1,t}return a(t,e),t.prototype.aim=function(t,r,i){if(null==i)return e.prototype.aim.call(this,t,r,i);for(var a=r.length-1;a>=0;a--){var n=r[a][0]-t[0],s=r[a][1]-t[1];if(o.vec2.copy(t,this.target),Math.abs(n)>Math.abs(s)?this.target[0]+=this.range*Math.sign(n):this.target[1]+=this.range*Math.sign(s),o.vec2.manhattan(this.target,r[a])<this.range)return this.target}},t.prototype.use=function(e,t){var r,i,a,m,p,g,x;return n(this,(function(n){switch(n.label){case 0:r=e.rotate(t),n.label=1;case 1:return(i=r.next()).done?[3,5]:[3,2];case 2:return[4,i.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:this.mesh=e.mesh,this.funnel=s.BatchMesh.create(h.SharedSystem.geometry.funnel),this.funnel.transform=this.context.get(c.TransformSystem).create([0,.7,.8],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.funnel.material=h.SharedSystem.materials.effect.coneTeal,this.context.get(u.ParticleEffectPass).add(this.funnel),this.core=s.BatchMesh.create(h.SharedSystem.geometry.lowpolySphere),this.core.transform=this.context.get(c.TransformSystem).create([0,.7,2.5],o.quat.HALF_N_X,o.vec3.ONE,this.mesh.transform),this.core.material=h.SharedSystem.materials.effect.coreYellow,this.context.get(u.ParticleEffectPass).add(this.core),this.cone=s.BatchMesh.create(h.SharedSystem.geometry.cone),this.cone.transform=this.context.get(c.TransformSystem).create([0,.7,.8],o.quat.HALF_N_X,o.vec3.ONE,this.mesh.transform),this.cone.material=h.SharedSystem.materials.sprite.spiral,this.context.get(u.ParticleEffectPass).add(this.cone),this.beam=s.Sprite.create(3,0,o.vec4.ONE,[0,.5]),this.beam.material=h.SharedSystem.materials.sprite.beam,this.beam.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.beam),this.light=this.context.get(u.PointLightPass).create(),this.light.transform=this.context.get(c.TransformSystem).create([0,1,2.5],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.bulge=s.Sprite.create(2),this.bulge.material=h.SharedSystem.materials.distortion.bulge,this.bulge.transform=this.context.get(c.TransformSystem).create([0,.7,2.5],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.PostEffectPass).add(this.bulge),this.ring=s.Sprite.create(0),this.ring.material=h.SharedSystem.materials.sprite.swirl,this.ring.transform=this.context.get(c.TransformSystem).create([0,.7,1.5],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.ring),(a=v.pool.pop()||new v(this.context)).direction[0]=Math.sign(t[0]-e.tile[0]),a.direction[1]=Math.sign(t[1]-e.tile[1]),a.place(e.tile[0]+a.direction[0],e.tile[1]+a.direction[1]),this.context.get(d.PlayerSystem).skills[6].corrosion.add(a),this.context.get(d.TurnBasedSystem).enqueue(a.appear(this.mesh.transform.position,1),!0),m=f.AnimationTimeline(this,y),this.context.get(l.AudioSystem).create("assets/orb_use.mp3","sfx",this.mesh.transform).play(0),p=2,g=this.context.currentTime,n.label=6;case 6:return x=this.context.currentTime-g,m(x,this.context.deltaTime),x>p?[3,10]:[3,7];case 7:return[4,f.ActionSignal.WaitNextFrame];case 8:n.sent(),n.label=9;case 9:return[3,6];case 10:return this.context.get(c.TransformSystem).delete(this.cone.transform),this.context.get(c.TransformSystem).delete(this.core.transform),this.context.get(c.TransformSystem).delete(this.funnel.transform),this.context.get(c.TransformSystem).delete(this.beam.transform),this.context.get(c.TransformSystem).delete(this.light.transform),this.context.get(c.TransformSystem).delete(this.bulge.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(u.PointLightPass).delete(this.light),this.context.get(u.PostEffectPass).remove(this.bulge),this.context.get(u.ParticleEffectPass).remove(this.cone),this.context.get(u.ParticleEffectPass).remove(this.core),this.context.get(u.ParticleEffectPass).remove(this.funnel),this.context.get(u.ParticleEffectPass).remove(this.beam),this.context.get(u.ParticleEffectPass).remove(this.ring),s.Sprite.delete(this.bulge),s.Sprite.delete(this.beam),s.Sprite.delete(this.ring),s.BatchMesh.delete(this.funnel),s.BatchMesh.delete(this.core),s.BatchMesh.delete(this.cone),[2]}}))},t}(p.AIUnitSkill);t.StaticOrbSkill=g},1086:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.StrikeSkill=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(296),f=r(6725),h=r(7822),m=r(6888),d={"mesh.armature":h.ModelAnimation("activate"),"beam.transform.scale":f.PropertyAnimation([{frame:.4,value:o.vec3.ZERO},{frame:1,value:[2,6,2],ease:f.ease.quartOut}],o.vec3.lerp),"beam.color":f.PropertyAnimation([{frame:.4,value:[.9,.7,1,.2]},{frame:1,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"cone.transform.position":f.PropertyAnimation([{frame:.2,value:[0,1,1]},{frame:.8,value:[0,1,2],ease:f.ease.quartOut}],o.vec3.lerp),"cone.transform.scale":f.PropertyAnimation([{frame:.2,value:o.vec3.ZERO},{frame:.8,value:[2,2,6],ease:f.ease.cubicOut}],o.vec3.lerp),"cone.color":f.PropertyAnimation([{frame:.2,value:[.9,.6,1,.4]},{frame:.8,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),sparks:f.EventTrigger([{frame:.2,value:36}],f.EventTrigger.emit),"ring.transform.scale":f.PropertyAnimation([{frame:.3,value:o.vec3.ZERO},{frame:.8,value:[8,8,8],ease:f.ease.cubicOut}],o.vec3.lerp),"ring.transform.position":f.PropertyAnimation([{frame:.3,value:[0,1,1.5]},{frame:.8,value:[0,1,.5],ease:f.ease.quadOut}],o.vec3.lerp),"ring.transform.rotation":f.PropertyAnimation([{frame:.3,value:o.quat.IDENTITY},{frame:.8,value:o.quat.axisAngle(o.vec3.AXIS_Z,-Math.PI,o.quat()),ease:f.ease.sineOut}],o.quat.slerp),"ring.color":f.PropertyAnimation([{frame:.3,value:[.8,.7,.8,.6]},{frame:.8,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"rays.transform.scale":f.PropertyAnimation([{frame:.2,value:o.vec3.ZERO},{frame:.6,value:[5,5,5],ease:f.ease.quartOut}],o.vec3.lerp),"rays.color":f.PropertyAnimation([{frame:.4,value:[.6,.7,.8,.2]},{frame:.6,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.range=Math.SQRT2,t.cardinal=!1,t.pierce=!1,t.damageType=1,t.damage=1,t}return a(t,e),t.prototype.use=function(e,t){var r,i,a,p,v,y,g;return n(this,(function(n){switch(n.label){case 0:r=e.rotate(t),n.label=1;case 1:return(i=r.next()).done?[3,5]:[3,2];case 2:return[4,i.value];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:this.mesh=e.mesh,this.cone=s.BatchMesh.create(h.SharedSystem.geometry.hemisphere),this.cone.material=h.SharedSystem.materials.effect.coneTeal,this.cone.transform=this.context.get(c.TransformSystem).create(),this.cone.transform.parent=this.mesh.transform,this.context.get(u.ParticleEffectPass).add(this.cone),this.ring=s.Sprite.create(0),this.ring.material=h.SharedSystem.materials.sprite.swirl,this.ring.transform=this.context.get(c.TransformSystem).create(),this.ring.transform.parent=this.mesh.transform,this.context.get(u.ParticleEffectPass).add(this.ring),this.rays=s.Sprite.create(0),this.rays.material=h.SharedSystem.materials.sprite.rays,this.rays.transform=this.context.get(c.TransformSystem).create([0,1,.96],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),o.quat.axisAngle(o.vec3.AXIS_Z,2*h.SharedSystem.random()*Math.PI,this.rays.transform.rotation),this.context.get(u.ParticleEffectPass).add(this.rays),this.beam=s.Sprite.create(3,0,o.vec4.ONE,[0,.5]),this.beam.material=h.SharedSystem.materials.sprite.beam,this.beam.transform=this.context.get(c.TransformSystem).create(o.vec3.AXIS_Y,o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.beam),this.sparks=h.SharedSystem.particles.sparks.add({uLifespan:[.3,.6,-.2,0],uOrigin:o.mat4.transform(o.vec3(0,1,1),this.mesh.transform.matrix,o.vec3()),uTarget:o.vec3.ZERO,uGravity:o.vec3.ZERO,uLength:[.1,.2],uSize:[.1,.2],uForce:[4,8],uRadius:[0,.5]}),a=f.EventTrigger([{frame:.2,value:t}],m.AIUnitSkill.damage),p=f.AnimationTimeline(this,d),this.context.get(l.AudioSystem).create("assets/strike_use.mp3","sfx",this.mesh.transform).play(.2),v=1,y=this.context.currentTime,n.label=6;case 6:return g=this.context.currentTime-y,p(g,this.context.deltaTime),a(g,this.context.deltaTime,this),g>v?[3,10]:[3,7];case 7:return[4,f.ActionSignal.WaitNextFrame];case 8:n.sent(),n.label=9;case 9:return[3,6];case 10:return h.SharedSystem.particles.sparks.remove(this.sparks),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.rays.transform),this.context.get(c.TransformSystem).delete(this.beam.transform),this.context.get(c.TransformSystem).delete(this.cone.transform),this.context.get(u.ParticleEffectPass).remove(this.ring),this.context.get(u.ParticleEffectPass).remove(this.rays),this.context.get(u.ParticleEffectPass).remove(this.beam),this.context.get(u.ParticleEffectPass).remove(this.cone),s.Sprite.delete(this.ring),s.Sprite.delete(this.rays),s.Sprite.delete(this.beam),s.BatchMesh.delete(this.cone),[2]}}))},t}(m.AIUnitSkill);t.StrikeSkill=p},2856:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.TurretSkill=void 0;var s=r(4454),c=r(8581),l=r(9336),u=r(6365),f=r(296),h=r(6725),m=r(3605),d=r(7822),p=r(6888),v={"dust.transform.scale":h.PropertyAnimation([{frame:.7,value:s.vec3.ZERO},{frame:1.2,value:[1.6,4,1.6],ease:h.ease.quartOut}],s.vec3.lerp),"dust.color":h.PropertyAnimation([{frame:.7,value:[0,.1,.1,1]},{frame:1.2,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"flashLeft.transform.scale":h.PropertyAnimation([{frame:.3,value:s.vec3.ZERO},{frame:.5,value:[3,3,3],ease:h.ease.cubicOut}],s.vec3.lerp),"flashLeft.color":h.PropertyAnimation([{frame:.3,value:[.6,1,1,0]},{frame:.5,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),"flashRight.transform.scale":h.PropertyAnimation([{frame:.3,value:s.vec3.ZERO},{frame:.5,value:[3,3,3],ease:h.ease.cubicOut}],s.vec3.lerp),"flashRight.color":h.PropertyAnimation([{frame:.3,value:[.6,1,1,0]},{frame:.5,value:s.vec4.ZERO,ease:h.ease.quadIn}],s.vec4.lerp),sparks:h.EventTrigger([{frame:.5,value:24}],h.EventTrigger.emit),"ring.transform.scale":h.PropertyAnimation([{frame:.6,value:s.vec3.ZERO},{frame:1,value:[4,4,4],ease:h.ease.cubicOut}],s.vec3.lerp),"ring.color":h.PropertyAnimation([{frame:.6,value:[.4,1,.9,.4]},{frame:1,value:s.vec4.ZERO,ease:h.ease.sineIn}],s.vec4.lerp),"light.radius":h.PropertyAnimation([{frame:.6,value:0},{frame:1,value:4,ease:h.ease.cubicOut}],s.lerp),"light.intensity":h.PropertyAnimation([{frame:.6,value:4},{frame:1,value:0,ease:h.ease.sineIn}],s.lerp),"wave.transform.scale":h.PropertyAnimation([{frame:.7,value:[0,2,0]},{frame:1.2,value:[4,1,4],ease:h.ease.quartOut}],s.vec3.lerp),"wave.color":h.PropertyAnimation([{frame:.7,value:[.2,1,.8,1]},{frame:1.2,value:s.vec4.ZERO,ease:h.ease.sineOut}],s.vec4.lerp)},y=function(){function e(e,t,r,i,a){this.context=e,this.skill=t,this.key=r,this.index=i,this.tile=a,this.maxAngle=.25*Math.PI,this.angle=Math.atan2(a[0]-1,a[1]-1)}return e.prototype.validate=function(e,t){var r=t[0]-e[0]-this.tile[0],i=t[1]-e[1]-this.tile[1];return!(r*r+i*i>this.skill.range*this.skill.range||Math.abs(s.moddelta(2*Math.PI,this.angle,Math.atan2(r,i)))>this.maxAngle)},e.prototype.activate=function(e,t){var r,i,a,y,g,x,b,S,P,O,T,w,_,A,E,M,I;return o(this,(function(o){switch(o.label){case 0:if(this.mesh=e.mesh,r=s.mat4.transform(s.vec3.ZERO,this.mesh.armature.nodes[this.index].globalTransform,s.vec3()),s.vec3.add(this.mesh.transform.position,r,r),i=this.context.get(m.TerrainSystem).tilePosition(t[0],t[1],s.vec3()),a=s.vec3.subtract(i,r,s.vec3()),!this.validate(e.tile,t))return[2];if(y=s.vec2.add(this.tile,e.tile,s.vec2()),!p.AIStrategy.lineOfSight(this.context.get(m.TerrainSystem).pathfinder,y,t))return[2];g=s.quat.axisAngle(s.vec3.AXIS_Y,this.angle,s.quat()),x=s.quat.fromNormal(s.vec3.normalize(a,s.vec3()),s.vec3.AXIS_Y,s.quat()),this.dust=c.Sprite.create(3,0,s.vec4.ONE,[0,.5]),this.dust.material=d.SharedSystem.materials.sprite.dust,this.dust.transform=this.context.get(l.TransformSystem).create(i),this.context.get(f.ParticleEffectPass).add(this.dust),this.trailLeft=c.Line.create(2,0,.3,h.ease.reverse(h.ease.quadIn),!0),this.trailLeft.material=d.SharedSystem.materials.sprite.lineTeal,this.context.get(f.ParticleEffectPass).add(this.trailLeft),this.trailRight=c.Line.create(2,0,.3,h.ease.reverse(h.ease.quadIn),!0),this.trailRight.material=d.SharedSystem.materials.sprite.lineTeal,this.context.get(f.ParticleEffectPass).add(this.trailRight),b=s.mat4.fromRotationTranslationScale(x,r,s.vec3.ONE,s.mat4()),S=s.mat4.transform([.25,0,1],b,s.vec3()),P=s.mat4.transform([-.25,0,1],b,s.vec3()),O=s.vec3.add(S,a,s.vec3()),T=s.vec3.add(P,a,s.vec3()),this.flashLeft=c.Sprite.create(2),this.flashLeft.material=d.SharedSystem.materials.sprite.rays,this.flashRight=c.Sprite.create(2),this.flashRight.material=this.flashLeft.material,this.flashLeft.transform=this.context.get(l.TransformSystem).create(s.mat4.transform([.25,0,1.5],b,s.vec3())),this.flashRight.transform=this.context.get(l.TransformSystem).create(s.mat4.transform([-.25,0,1.5],b,s.vec3())),this.context.get(f.ParticleEffectPass).add(this.flashLeft),this.context.get(f.ParticleEffectPass).add(this.flashRight),this.sparks=d.SharedSystem.particles.sparks.add({uLifespan:[.4,.8,0,0],uOrigin:i,uTarget:[0,-.2,0],uLength:[.1,.2],uSize:[.2,.4],uForce:[4,12],uRadius:[.2,.2],uGravity:[0,-24,0]}),this.ring=c.Sprite.create(0),this.ring.material=d.SharedSystem.materials.sprite.ring,this.ring.transform=this.context.get(l.TransformSystem).create(s.vec3.add(i,[0,.2,0],s.vec3()),s.quat.HALF_X),this.context.get(f.ParticleEffectPass).add(this.ring),this.wave=c.BatchMesh.create(d.SharedSystem.geometry.lowpolyCylinder),this.wave.material=d.SharedSystem.materials.effect.ringDust,this.wave.transform=this.context.get(l.TransformSystem).create(i,s.quat.IDENTITY),this.context.get(f.ParticleEffectPass).add(this.wave),this.light=this.context.get(f.PointLightPass).create([.4,1,.9]),this.light.transform=this.context.get(l.TransformSystem).create(s.vec3.add([0,1,0],i,s.vec3())),w=h.EventTrigger([{frame:.6,value:t}],p.AIUnitSkill.damage),_=h.AnimationTimeline(this,n(((I={"mesh.armature":d.ModelAnimation(this.key)})["mesh.armature.nodes."+this.index+".rotation"]=h.PropertyAnimation([{frame:0,value:g},{frame:.4,value:x,ease:h.ease.cubicOut},{frame:.8,value:x,ease:h.ease.linear},{frame:1.4,value:g,ease:h.ease.quadInOut}],s.quat.slerp),I.trailLeft=h.FollowPath.Line(h.PropertyAnimation([{frame:.4,value:S},{frame:.6,value:O,ease:h.ease.linear}],s.vec3.lerp),{length:.24}),I.trailRight=h.FollowPath.Line(h.PropertyAnimation([{frame:.4,value:P},{frame:.6,value:T,ease:h.ease.linear}],s.vec3.lerp),{length:.24}),I),v)),this.context.get(u.AudioSystem).create("assets/turret_use.mp3","sfx",this.mesh.transform).play(.4),A=1.4,E=this.context.currentTime,o.label=1;case 1:return M=this.context.currentTime-E,_(M,this.context.deltaTime),w(M,this.context.deltaTime,this.skill),M>A?[3,5]:[3,2];case 2:return[4,h.ActionSignal.WaitNextFrame];case 3:o.sent(),o.label=4;case 4:return[3,1];case 5:return d.SharedSystem.particles.sparks.remove(this.sparks),this.context.get(l.TransformSystem).delete(this.wave.transform),this.context.get(l.TransformSystem).delete(this.dust.transform),this.context.get(l.TransformSystem).delete(this.flashLeft.transform),this.context.get(l.TransformSystem).delete(this.flashRight.transform),this.context.get(l.TransformSystem).delete(this.light.transform),this.context.get(l.TransformSystem).delete(this.ring.transform),this.context.get(f.PointLightPass).delete(this.light),this.context.get(f.ParticleEffectPass).remove(this.wave),this.context.get(f.ParticleEffectPass).remove(this.dust),this.context.get(f.ParticleEffectPass).remove(this.flashLeft),this.context.get(f.ParticleEffectPass).remove(this.flashRight),this.context.get(f.ParticleEffectPass).remove(this.ring),c.Sprite.delete(this.dust),c.Sprite.delete(this.flashLeft),c.Sprite.delete(this.flashRight),c.Sprite.delete(this.ring),c.BatchMesh.delete(this.wave),c.Line.delete(this.trailLeft),c.Line.delete(this.trailRight),[2]}}))},e}(),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.range=4,t.cardinal=!1,t.pierce=!1,t.damageType=1,t.damage=1,t.turrets=[new y(t.context,t,"turret11",10,s.vec2(2,0)),new y(t.context,t,"turret01",12,s.vec2(2,2)),new y(t.context,t,"turret00",14,s.vec2(0,2)),new y(t.context,t,"turret10",16,s.vec2(0,0))],t}return a(t,e),t.prototype.validate=function(e,t){for(var r=this.turrets.length-1;r>=0;r--)if(this.turrets[r].validate(e,t))return!0},t.prototype.use=function(e,t){return h.AnimationSystem.zip(this.turrets.map((function(r){return r.activate(e,t)})))},t}(p.AIUnitSkill);t.TurretSkill=g},364:function(e,t,r){"use strict";var i,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__generator||function(e,t){var r,i,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.WaveSkill=void 0;var o=r(4454),s=r(8581),c=r(9336),l=r(6365),u=r(296),f=r(6725),h=r(7822),m=r(6888),d={"mesh.armature":h.ModelAnimation("activate"),"core.transform.scale":f.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.5,value:[4,-4,4],ease:f.ease.quadOut}],o.vec3.lerp),"core.color":f.PropertyAnimation([{frame:.8,value:[.6,.8,1,.4]},{frame:1.5,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"light.radius":f.PropertyAnimation([{frame:.6,value:0},{frame:1.4,value:8,ease:f.ease.cubicOut}],o.lerp),"light.intensity":f.PropertyAnimation([{frame:.6,value:8},{frame:1.4,value:0,ease:f.ease.quadIn}],o.lerp),bolts:f.EventTrigger([{frame:.8,value:48}],f.EventTrigger.emit),"beam.transform.scale":f.PropertyAnimation([{frame:.7,value:o.vec3.ZERO},{frame:1.2,value:[3,8,3],ease:f.ease.cubicOut}],o.vec3.lerp),"beam.color":f.PropertyAnimation([{frame:.7,value:[.6,.6,1,.4]},{frame:1.2,value:o.vec4.ZERO,ease:f.ease.quadIn}],o.vec4.lerp),"cracks.transform.rotation":f.EventTrigger([{frame:0,value:null}],(function(e){return o.quat.axisAngle(o.vec3.AXIS_Y,2*Math.PI*h.SharedSystem.random(),e)})),"cracks.transform.scale":f.PropertyAnimation([{frame:.8,value:[16,4,16]}],o.vec3.lerp),"cracks.color":f.PropertyAnimation([{frame:.8,value:[.6,.6,1,1]}],o.vec4.lerp),"cracks.threshold":f.PropertyAnimation([{frame:.8,value:-3},{frame:1,value:0,ease:f.ease.quadOut},{frame:2,value:3,ease:f.ease.quartIn}],o.lerp),"wave.transform.scale":f.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[12,12,12],ease:f.ease.cubicOut}],o.vec3.lerp),"wave.color":f.PropertyAnimation([{frame:.8,value:o.vec4.ONE},{frame:1.4,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"ring.transform.scale":f.PropertyAnimation([{frame:.8,value:o.vec3.ZERO},{frame:1.4,value:[16,16,16],ease:f.ease.quartOut}],o.vec3.lerp),"ring.color":f.PropertyAnimation([{frame:.8,value:[.6,.4,1,0]},{frame:1.4,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp),"cylinder.transform.scale":f.PropertyAnimation([{frame:.4,value:[4,1,4]},{frame:1,value:[0,6,0],ease:f.ease.sineOut}],o.vec3.lerp),"cylinder.color":f.PropertyAnimation([{frame:.4,value:o.vec4.ZERO},{frame:1,value:[.4,.2,1,1],ease:f.ease.cubicOut}],o.vec4.lerp),"pillar.transform.scale":f.PropertyAnimation([{frame:.8,value:[0,-8,0]},{frame:1.4,value:[7,-2,7],ease:f.ease.cubicOut}],o.vec3.lerp),"pillar.color":f.PropertyAnimation([{frame:.8,value:[.8,.6,1,.4]},{frame:1.4,value:o.vec4.ZERO,ease:f.ease.sineIn}],o.vec4.lerp)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cost=1,t.range=Math.sqrt(5),t.cardinal=!1,t.pierce=!1,t.damageType=2,t.damage=2,t}return a(t,e),t.prototype.use=function(e,t){var r,i,a,p,v;return n(this,(function(n){switch(n.label){case 0:this.mesh=e.mesh,this.beam=s.Sprite.create(3,0,o.vec4.ONE,[0,.5]),this.beam.material=h.SharedSystem.materials.sprite.beam,this.beam.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.beam),this.cracks=this.context.get(u.DecalPass).create(4),this.cracks.material=h.SharedSystem.materials.cracksMaterial,this.cracks.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.wave=s.Sprite.create(0),this.wave.material=h.SharedSystem.materials.displacement.ring,this.wave.transform=this.context.get(c.TransformSystem).create([0,1,0],o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(u.PostEffectPass).add(this.wave),this.ring=s.Sprite.create(0),this.ring.material=h.SharedSystem.materials.sprite.swirl,this.ring.transform=this.context.get(c.TransformSystem).create([0,.5,0],o.quat.HALF_X,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.ring),this.cylinder=s.BatchMesh.create(h.SharedSystem.geometry.lowpolyCylinder),this.cylinder.material=h.SharedSystem.materials.effect.stripes,this.cylinder.transform=this.context.get(c.TransformSystem).create([0,2,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.cylinder),this.pillar=s.BatchMesh.create(h.SharedSystem.geometry.lowpolyCylinderFlip),this.pillar.material=h.SharedSystem.materials.sprite.streak,this.pillar.transform=this.context.get(c.TransformSystem).create(o.vec3.ZERO,o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.pillar),this.bolts=h.SharedSystem.particles.bolts.add({uOrigin:o.vec3.add([0,1,0],this.mesh.transform.position,o.vec3()),uRadius:[2,4],uLifespan:[.2,.8,-.4,0],uGravity:o.vec3.ZERO,uRotation:[0,2*Math.PI],uOrientation:o.quat.IDENTITY,uSize:[.4,1.6],uFrame:[16,4]}),this.light=this.context.get(u.PointLightPass).create([.7,.6,1]),this.light.transform=this.context.get(c.TransformSystem).create([0,4,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.core=s.BatchMesh.create(h.SharedSystem.geometry.lowpolySphere),this.core.material=h.SharedSystem.materials.effect.energyPurple,this.core.transform=this.context.get(c.TransformSystem).create([0,1,0],o.quat.IDENTITY,o.vec3.ONE,this.mesh.transform),this.context.get(u.ParticleEffectPass).add(this.core),r=f.EventTrigger([{frame:1,value:t}],m.AIUnitSkill.damage),i=f.AnimationTimeline(this,d),this.context.get(l.AudioSystem).create("assets/shock_use.mp3","sfx",this.mesh.transform).play(0),a=2,p=this.context.currentTime,n.label=1;case 1:return v=this.context.currentTime-p,i(v,this.context.deltaTime),r(v,this.context.deltaTime,this),v>a?[3,5]:[3,2];case 2:return[4,f.ActionSignal.WaitNextFrame];case 3:n.sent(),n.label=4;case 4:return[3,1];case 5:return this.context.get(c.TransformSystem).delete(this.beam.transform),this.context.get(c.TransformSystem).delete(this.pillar.transform),this.context.get(c.TransformSystem).delete(this.cylinder.transform),this.context.get(c.TransformSystem).delete(this.ring.transform),this.context.get(c.TransformSystem).delete(this.wave.transform),this.context.get(c.TransformSystem).delete(this.cracks.transform),this.context.get(c.TransformSystem).delete(this.light.transform),this.context.get(c.TransformSystem).delete(this.core.transform),h.SharedSystem.particles.bolts.remove(this.bolts),this.context.get(u.DecalPass).delete(this.cracks),this.context.get(u.PointLightPass).delete(this.light),this.context.get(u.PostEffectPass).remove(this.wave),this.context.get(u.ParticleEffectPass).remove(this.beam),this.context.get(u.ParticleEffectPass).remove(this.pillar),this.context.get(u.ParticleEffectPass).remove(this.cylinder),this.context.get(u.ParticleEffectPass).remove(this.ring),this.context.get(u.ParticleEffectPass).remove(this.core),s.Sprite.delete(this.beam),s.Sprite.delete(this.wave),s.Sprite.delete(this.ring),s.BatchMesh.delete(this.cylinder),s.BatchMesh.delete(this.pillar),s.BatchMesh.delete(this.core),[2]}}))},t}(m.AIUnitSkill);t.WaveSkill=p},7644:e=>{e.exports="#version 300 es\nprecision highp float;\n\nuniform sampler2D uAlbedoBuffer;\nuniform sampler2D uNormalBuffer;\nuniform sampler2D uPositionBuffer;\n\nin vec2 vUV;\n\nlayout(location=0) out vec4 fragColor;\n\nuniform LightUniforms {\n vec3 uLightDirection;\n vec3 uSkyColor;\n vec3 uGroundColor;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\nuniform float uWeight;\nuniform samplerCube uEnvironmentMap;\nuniform sampler2D uBRDFLUT;\n\nvec3 fresnelSchlickRoughness(float cosTheta, vec3 F0, float roughness){\n return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\n}\n\nvoid main(){\n ivec2 fragCoord = ivec2(gl_FragCoord.xy);\n vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\n vec4 normal = texelFetch(uNormalBuffer, fragCoord, 0);\n vec4 albedo = texelFetch(uAlbedoBuffer, fragCoord, 0);\n\n float emission = max(0.,2.*albedo.a-1.);\n float roughness = clamp(2.*albedo.a,0.04,1.0);\n float metallic = normal.a;\n\n vec3 N = normalize(normal.xyz);\n vec3 V = normalize(position.xyz);\n\n vec3 F0 = mix(vec3(0.04), albedo.rgb, metallic);\n float NdotV = max(dot(N, V), 0.0);\n\n vec3 F = fresnelSchlickRoughness(NdotV, F0, roughness);\n vec3 kD = (1.0 - F) * (1.0 - metallic);\n\n#ifdef IRRADIANCE_MAP\n vec3 irradiance = texture(uIrradianceMap, N).rgb;\n#else\n float blend = length(normal.xyz);\n vec3 light = mix(uGroundColor, uSkyColor, clamp(0.5 + 0.5 * dot(N, uLightDirection),0.,1.));\n light = mix(light, vec3(1), max(emission,1.-blend));\n vec3 irradiance = light;\n#endif\n vec3 indirectDiffuse = irradiance * albedo.rgb;\n#ifdef REFLECTION_MAP\n vec3 prefilteredColor = textureLod(uEnvironmentMap, reflect(V, N), roughness * 8.0).rgb; \n vec2 envBRDF = texture(uBRDFLUT, vec2(NdotV, roughness)).rg;\n vec3 indirectSpecular = prefilteredColor * (F * envBRDF.x + envBRDF.y);\n#else\n vec3 indirectSpecular = vec3(0);\n#endif\n vec3 ambient = (kD * indirectDiffuse + indirectSpecular);\n \n ambient = mix(albedo.rgb, ambient, step(0.5, position.w));\n fragColor = uWeight * vec4(ambient, emission);\n}"},7448:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\n\nin vec2 vUV;\nin vec4 vColor;\nin vec4 vMaterial;\n\nout vec4 fragColor;\n\nuniform sampler2D uSamplers[MAX_TEXTURE_UNITS];\n\nvoid main(){\n int tex = int(vMaterial.a);\n vec4 color = vec4(0);\n switch(tex){\n#FOR case #i:color=texture(uSamplers[#i],vUV);break;\n }\n fragColor = vColor * color;\n}"},1853:e=>{e.exports="#version 300 es\nprecision highp float;\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec2 aPosition;\nlayout(location=1) in vec2 aUV;\nlayout(location=2) in vec4 aColor;\nlayout(location=3) in vec4 aMaterial;\n\nuniform mat3 uProjectionMatrix;\n\nout vec2 vUV;\nout vec4 vColor;\nout vec4 vMaterial;\n\nvoid main(){\n gl_Position = vec4((uProjectionMatrix * vec3(aPosition,1.)).xy,0.,1.);\n vUV = aUV;\n vColor = aColor;\n vMaterial = aMaterial + vec4(0,0,0,.5);\n}"},6889:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\n\nin vec2 vUV;\nin vec3 vPosition;\nin vec4 vColor;\nin vec3 vNormal;\nin float vMaterial;\n\nout vec4 fragColor;\n\nuniform sampler2D uSamplers[MAX_TEXTURE_UNITS];\n\nvoid main(){\n int tex = int(vMaterial);\n vec2 uv = vUV;\n vec4 color = vec4(0);\n switch(tex){\n#FOR case #i:color=texture(uSamplers[#i],uv);break;\n }\n fragColor = color * vColor;\n}"},8777:e=>{e.exports="#version 300 es\nprecision highp float;\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec3 aPosition;\nlayout(location=1) in vec2 aUV;\nlayout(location=2) in vec4 aColor;\nlayout(location=3) in vec3 aNormal;\nlayout(location=4) in float aMaterial;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n\nout vec2 vUV;\nout vec3 vPosition;\nout vec4 vColor;\nout vec3 vNormal;\nout float vMaterial;\n\nvoid main(){\n vUV = aUV;\n vPosition = aPosition;\n vColor = aColor;\n vMaterial = aMaterial + .5;\n vNormal = aNormal;\n gl_Position = uViewProjectionMatrix * vec4(aPosition, 1.0);\n}"},8746:e=>{e.exports="#version 300 es\nprecision highp float;\n\n#ifndef POINT\nin vec2 vUV;\nin vec4 vUVClamp;\n#endif\nin vec2 vLife;\nin vec3 vPosition;\n\nout vec4 fragColor;\n\nuniform sampler2D uSampler;\nuniform sampler2D uGradient;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\n#ifdef SOFT\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\nuniform sampler2D uPositionBuffer;\n#endif\n\nvoid main(void){\n#ifdef POINT\n vec2 uv = gl_PointCoord;\n const vec4 vUVClamp = vec4(0,0,1,1);\n#else\n vec2 uv = vUV;\n#endif\n\n#ifdef UV_OFFSET\n float offsetScale = UV_OFFSET;\n vec4 color = texture(uSampler, uv - offsetScale * uTime.x + vLife.y);\n color *= 4.0 * texture(uSampler, 2.0 * uv + 2.0 * offsetScale * uTime.x + vLife.y);\n#else\n vec4 color = texture(uSampler, uv);\n#endif\n\n#if defined(GRADIENT)\n color = texture(uGradient, vec2(vLife.x, color.a));\n#elif defined(SWIPE)\n vec2 uv0 = (uv - vUVClamp.xy) / (vUVClamp.zw - vUVClamp.xy);\n color *= smoothstep(0.5+SWIPE,0.5,abs(uv0.x-.5 + mix(-1.0,1.0,vLife.x)));\n#else\n color *= 4.*vLife.x*(1.-vLife.x);\n#endif\n#ifdef MASK\n color *= smoothstep(1.0,0.5,length(2.*uv-1.));\n#endif\n\n#ifdef SOFT\n ivec2 fragCoord = ivec2(gl_FragCoord.xy);\n vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\n float difference = length(position.xyz) - length(vPosition - uEyePosition);\n color.a *= smoothstep(0.0, 0.5, difference);\n#endif\n fragColor = color;\n}"},5679:e=>{e.exports="#version 300 es\nprecision highp float;\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec4 aLifetime;\nlayout(location=1) in vec4 aSize;\nlayout(location=2) in vec4 aTransform;\nlayout(location=3) in vec4 aVelocity;\nlayout(location=4) in vec4 aAcceleration;\n#ifndef POINT\nlayout(location=5) in vec3 aPosition;\nlayout(location=6) in vec2 aUV;\nout vec2 vUV;\nout vec4 vUVClamp;\n#endif\n\nout vec2 vLife;\nout vec3 vPosition;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n\nmat2 rotate(in float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\n\nvoid main(){\n vLife = vec2(clamp(aLifetime.x * aLifetime.y, 0.0, 1.0), aLifetime.z);\n float size = aSize.y * step(0.,aLifetime.x)*step(aLifetime.x*aLifetime.y,1.);\n\n#ifdef POINT\n gl_PointSize = size;\n vPosition = aTransform.xyz;\n#else\n vec3 position = vec3(rotate(aTransform.w) * aPosition.xy, aPosition.z);\n#ifdef VIEWPLANE\n vec3 forward = -vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\n vec3 right = vec3(uViewMatrix[0][0], uViewMatrix[1][0], uViewMatrix[2][0]);\n#else\n vec3 forward = normalize(aTransform.xyz - uEyePosition);\n#endif\n\n#if defined(ALIGNED)\n vec3 right = normalize(aVelocity.xyz);\n vec3 up = cross(forward, right);\n forward = cross(right, up);\n mat3 matrix = mat3(right, up, forward);\n position = size * matrix * position;\n#ifdef STRETCH\n position += dot(position, aVelocity.xyz) * aVelocity.xyz * STRETCH;\n#endif\n\n#elif defined(CYLINDRICAL)\n vec3 up = vec3(0,1,0);\n vec3 right = cross(forward, up);\n position = size * (right * position.x + up * position.y);\n#elif defined(SPHERICAL)\n vec3 right = vec3(uViewMatrix[0][0], uViewMatrix[1][0], uViewMatrix[2][0]);\n vec3 up = vec3(uViewMatrix[0][1], uViewMatrix[1][1], uViewMatrix[2][1]);\n position = size * (right * position.x + up * position.y);\n#ifdef STRETCH\n vec3 viewVelocity = (uViewMatrix * vec4(aVelocity.xyz,0.0)).xyz;\n position += dot(position, aVelocity.xyz) * aVelocity.xyz * STRETCH;\n#endif\n\n#else\n position = size * position.xzy * vec3(1,1,-1);\n#endif\n vPosition = position + aTransform.xyz;\n#ifdef FRAMES\n float uvSize = 1.0/aSize.w; float uvFrame = mod(floor(aSize.z),aSize.w*aSize.w);\n vec2 uvTile = vec2(mod(uvFrame, aSize.w), floor(uvFrame * uvSize)) * uvSize;\n vUVClamp = vec4(uvTile, uvTile + uvSize);\n vUV = uvTile + uvSize * aUV;\n#else\n vUV = aUV;\n vUVClamp = vec4(0,0,1,1);\n#endif\n#endif\n gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\n}"},741:(e,t,r)=>{e.exports=r(1765)+"\n"+r(562)+"\n\nuniform sampler2D uSampler;\nuniform vec2 uSize;\n\nvoid main(){\n fragColor = blur(uSampler, uSize);\n}"},7806:e=>{e.exports="#version 300 es\nprecision highp float;\nin vec2 vUV;\nout vec4 fragColor;\n\n#define PI 3.141592653589793\n\nfloat RadicalInverse_VdC(uint bits){\n bits = (bits << 16u) | (bits >> 16u);\n bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\n bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\n bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\n bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\n return float(bits) * 2.3283064365386963e-10; // / 0x100000000\n}\nvec2 Hammersley(uint i, uint N){\n return vec2(float(i)/float(N), RadicalInverse_VdC(i));\n} \n\nvec3 ImportanceSampleGGX(vec2 Xi, vec3 N, float roughness){\n float a = roughness*roughness;\n\t\n float phi = 2.0 * PI * Xi.x;\n float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a*a - 1.0) * Xi.y));\n float sinTheta = sqrt(1.0 - cosTheta*cosTheta);\n\t\n // from spherical coordinates to cartesian coordinates\n vec3 H;\n H.x = cos(phi) * sinTheta;\n H.y = sin(phi) * sinTheta;\n H.z = cosTheta;\n\t\n // from tangent-space vector to world-space sample vector\n vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n vec3 tangent = normalize(cross(up, N));\n vec3 bitangent = cross(N, tangent);\n\t\n vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\n return normalize(sampleVec);\n}\n\nfloat GeometrySchlickGGX(float NdotV, float roughness){\n float a = roughness;\n float k = (a * a) / 2.0;\n\n float nom = NdotV;\n float denom = NdotV * (1.0 - k) + k;\n\n return nom / denom;\n}\nfloat GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness){\n float NdotV = max(dot(N, V), 0.0);\n float NdotL = max(dot(N, L), 0.0);\n float ggx2 = GeometrySchlickGGX(NdotV, roughness);\n float ggx1 = GeometrySchlickGGX(NdotL, roughness);\n\n return ggx1 * ggx2;\n}\n\nvec2 integrateBRDF(float NdotV, float roughness){\n vec3 V = vec3(\n sqrt(1.0 - NdotV*NdotV),\n 0.0,\n NdotV\n );\n float A = 0.0;\n float B = 0.0;\n\n vec3 N = vec3(0.0, 0.0, 1.0);\n\n const uint SAMPLE_COUNT = 1024u;\n for(uint i = 0u; i < SAMPLE_COUNT; ++i){\n vec2 Xi = Hammersley(i, SAMPLE_COUNT);\n vec3 H = ImportanceSampleGGX(Xi, N, roughness);\n vec3 L = normalize(2.0 * dot(V, H) * H - V);\n\n float NdotL = max(L.z, 0.0);\n float NdotH = max(H.z, 0.0);\n float VdotH = max(dot(V, H), 0.0);\n\n if(NdotL > 0.0){\n float G = GeometrySmith(N, V, L, roughness);\n float G_Vis = (G * VdotH) / (NdotH * NdotV);\n float Fc = pow(1.0 - VdotH, 5.0);\n\n A += (1.0 - Fc) * G_Vis;\n B += Fc * G_Vis;\n }\n }\n A /= float(SAMPLE_COUNT);\n B /= float(SAMPLE_COUNT);\n return vec2(A, B);\n}\n\nvoid main(){\n vec2 integratedBRDF = integrateBRDF(vUV.x, vUV.y);\n fragColor = vec4(integratedBRDF,0,0);\n}"},6011:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform sampler2D uSampler;\nuniform vec2 uScreenSize;\nuniform float uScale;\n\nvoid main(){\n float alpha = texture(uSampler, vUV).b;\n float height = alpha / uScale;\n float dhdx = dFdx(height) * uScreenSize.x;\n float dhdy = dFdy(height) * uScreenSize.y;\n vec3 normal = normalize(vec3(-dhdx, -dhdy, 1));\n fragColor = vec4(0.5+0.5*normal, alpha);\n}"},562:e=>{e.exports="vec4 blur(in sampler2D map, in vec2 size){\n vec4 color = vec4(0);\n vec2 offset = size / vec2(textureSize(map, 0));\n#if KERNEL_SIZE == 13\n vec2 off1 = vec2(1.411764705882353) * offset;\n vec2 off2 = vec2(3.2941176470588234) * offset;\n vec2 off3 = vec2(5.176470588235294) * offset;\n color += texture(map, vUV) * 0.1964825501511404;\n color += texture(map, vUV + off1) * 0.2969069646728344;\n color += texture(map, vUV - off1) * 0.2969069646728344;\n color += texture(map, vUV + off2) * 0.09447039785044732;\n color += texture(map, vUV - off2) * 0.09447039785044732;\n color += texture(map, vUV + off3) * 0.010381362401148057;\n color += texture(map, vUV - off3) * 0.010381362401148057;\n#elif KERNEL_SIZE == 9\n vec2 off1 = vec2(1.3846153846) * offset;\n vec2 off2 = vec2(3.2307692308) * offset;\n color += texture(map, vUV) * 0.2270270270;\n color += texture(map, vUV + off1) * 0.3162162162;\n color += texture(map, vUV - off1) * 0.3162162162;\n color += texture(map, vUV + off2) * 0.0702702703;\n color += texture(map, vUV - off2) * 0.0702702703;\n#elif KERNEL_SIZE == 5\n vec2 off1 = vec2(1.3333333333333333) * offset;\n color += texture(map, vUV) * 0.29411764705882354;\n color += texture(map, vUV + off1) * 0.35294117647058826;\n color += texture(map, vUV - off1) * 0.35294117647058826;\n#endif\n return color;\n}\n\n\n "},1287:e=>{e.exports="float hash11(in float v){\n uint q = floatBitsToUint(v);\n\tuvec2 n = q * uvec2(1597334673U, 3812015801U);\n\tq = (n.x ^ n.y) * 1597334673U;\n\treturn float(q) * (1.0 / float(0xffffffffU));\n}\nfloat hash21(in vec2 v){\n uvec2 q = floatBitsToUint(v);\n\tq *= uvec2(1597334673U, 3812015801U);\n\tuint n = (q.x ^ q.y) * 1597334673U;\n\treturn float(n) * (1.0 / float(0xffffffffU));\n}\nfloat hash31(in vec3 v){\n uvec3 q = floatBitsToUint(v);\n\tq *= uvec3(1597334673U, 3812015801U, 2798796415U);\n\tuint n = (q.x ^ q.y ^ q.z) * 1597334673U;\n\treturn float(n) * (1.0 / float(0xffffffffU));\n}\nvec2 hash12(in float v){\n uint q = floatBitsToUint(v);\n\tuvec2 n = q * uvec2(1597334673U, 3812015801U);\n\tn = (n.x ^ n.y) * uvec2(1597334673U, 3812015801U);\n\treturn vec2(n) * (1.0 / float(0xffffffffU));\n}\nvec2 hash22(in vec2 v){\n uvec2 q = floatBitsToUint(v);\n\tq *= uvec2(1597334673U, 3812015801U);\n\tq = (q.x ^ q.y) * uvec2(1597334673U, 3812015801U);\n\treturn vec2(q) * (1.0 / float(0xffffffffU));\n}\nvec2 hash32(in vec3 v){\n uvec3 q = floatBitsToUint(v);\n\tq *= uvec3(1597334673U, 3812015801U, 2798796415U);\n\tuvec2 n = (q.x ^ q.y ^ q.z) * uvec2(1597334673U, 3812015801U);\n\treturn vec2(n) * (1.0 / float(0xffffffffU));\n}\nvec3 hash13(in float v){\n uint q = floatBitsToUint(v);\n\tuvec3 n = q * uvec3(1597334673U, 3812015801U, 2798796415U);\n\tn = (n.x ^ n.y ^ n.z) * uvec3(1597334673U, 3812015801U, 2798796415U);\n\treturn vec3(n) * (1.0 / float(0xffffffffU));\n}\nvec3 hash23(in vec2 v){\n uvec2 q = floatBitsToUint(v);\n\tuvec3 n = q.xyx * uvec3(1597334673U, 3812015801U, 2798796415U);\n\tn = (n.x ^ n.y ^n.z) * uvec3(1597334673U, 3812015801U, 2798796415U);\n\treturn vec3(n) * (1.0 / float(0xffffffffU));\n}\nvec3 hash33(in vec3 v){\n uvec3 q = floatBitsToUint(v);\n\tq *= uvec3(1597334673U, 3812015801U, 2798796415U);\n\tq = (q.x ^ q.y ^ q.z)*uvec3(1597334673U, 3812015801U, 2798796415U);\n\treturn vec3(q) * (1.0 / float(0xffffffffU));\n}\n\nfloat hash11(uint n){\n\tn = (n << 13U) ^ n;\n n = n * (n * n * 15731U + 789221U) + 1376312589U;\n return float(n & uvec3(0x7fffffffU))/float(0x7fffffff);\n}\nvec2 hash22(uvec2 x){\n x = 1103515245U*((x >> 1U)^(x.yx));\n uint h32 = 1103515245U*((x.x)^(x.y>>3U));\n h32 = h32^(h32 >> 16);\n uvec2 rz = uvec2(h32, h32*48271U);\n return vec2((rz.xy >> 1) & uvec2(0x7fffffffU))/float(0x7fffffff);\n}"},5404:e=>{e.exports="#define TAU 6.283185307179586\n\nmat2 rotate(in float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\nvec2 polar(in vec2 uv){return vec2(atan(uv.y,uv.x)/TAU+0.5,length(uv));}\nvec2 cartesian(in vec2 uv){float a=(uv.x-0.5)*TAU;return vec2(cos(a),sin(a))*uv.y;}\n\nvec3 saturation(vec3 rgb, float adjustment){\n const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n vec3 intensity = vec3(dot(rgb, W));\n return mix(intensity, rgb, adjustment);\n}"},4950:e=>{e.exports="float hash11(in float uv){\n uint v = floatBitsToUint(uv);\n const uint M = 0x5bd1e995u;\n uint h = 1190494759u;\n v *= M; v ^= v>>24u; v *= M;\n h *= M; h ^= v;\n h ^= h>>13u; h *= M; h ^= h>>15u;\n return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\n}\nfloat hash21(in vec2 uv) {\n uvec2 v = floatBitsToUint(uv);\n const uint M = 0x5bd1e995u;\n uint h = 1190494759u;\n v *= M; v ^= v>>24u; v *= M;\n h *= M; h ^= v.x; h *= M; h ^= v.y;\n h ^= h>>13u; h *= M; h ^= h>>15u;\n return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\n}\nfloat hash31(in vec3 uv){\n uvec3 v = floatBitsToUint(uv);\n const uint M = 0x5bd1e995u;\n uint h = 1190494759u;\n v *= M; v ^= v>>24u; v *= M;\n h *= M; h ^= v.x; h *= M; h ^= v.y; h *= M; h ^= v.z;\n h ^= h>>13u; h *= M; h ^= h>>15u;\n return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\n}\nfloat hash41(in vec4 uv){\n uvec4 v = floatBitsToUint(uv);\n const uint M = 0x5bd1e995u;\n uint h = 1190494759u;\n v *= M; v ^= v>>24u; v *= M;\n h *= M; h ^= v.x; h *= M; h ^= v.y; h *= M; h ^= v.z; h *= M; h ^= v.w;\n h ^= h>>13u; h *= M; h ^= h>>15u;\n return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\n}"},905:e=>{e.exports="float noise1D(in float v, in float period, in float seed){\n float i = floor(v);\n float f = fract(v); f = f*f*(3.0-2.0*f);\n return mix(hash11(mod(i,period)+seed), hash11(mod(i+1.,period)+seed), f);\n}\nfloat noise2D(in vec2 v){\n vec4 i = floor(v).xyxy + vec2(0,1).xxyy;\n vec2 f = fract(v); f = f*f*(3.0-2.0*f);\n return mix(mix(hash21(i.xy), hash21(i.zy), f.x),\n mix(hash21(i.xw), hash21(i.zw), f.x), f.y);\n}\nfloat noise2D(in vec2 v, in vec2 period, in float seed){\n vec4 i = floor(v).xyxy + vec2(0,1).xxyy;\n vec2 f = fract(v); f = f*f*(3.0-2.0*f);\n i = mod(i, period.xyxy)+seed;\n return mix(mix(hash21(i.xy), hash21(i.zy), f.x),\n mix(hash21(i.xw), hash21(i.zw), f.x), f.y);\n}\nfloat noise3D(in vec3 v){\n vec3 i = floor(v);\n vec3 f = fract(v); f = f*f*(3.0-2.0*f);\n return mix(mix(mix(hash31(i+vec3(0,0,0)), hash31(i+vec3(1,0,0)),f.x),\n mix(hash31(i+vec3(0,1,0)), hash31(i+vec3(1,1,0)),f.x),f.y),\n mix(mix(hash31(i+vec3(0,0,1)), hash31(i+vec3(1,0,1)),f.x),\n mix(hash31(i+vec3(0,1,1)), hash31(i+vec3(1,1,1)),f.x),f.y),f.z);\n}\nfloat noise3D(in vec3 uv, in vec3 period, in float seed){\n vec3 i0 = floor(mod(uv, period))+seed;\n vec3 i1 = floor(mod(uv+vec3(1), period))+seed;\n vec3 f = fract(uv); f = f*f*(3.0-2.0*f);\n return mix(mix(mix(hash31(vec3(i0.x,i0.y,i0.z)), hash31(vec3(i1.x,i0.y,i0.z)),f.x),\n mix(hash31(vec3(i0.x,i1.y,i0.z)), hash31(vec3(i1.x,i1.y,i0.z)),f.x),f.y),\n mix(mix(hash31(vec3(i0.x,i0.y,i1.z)), hash31(vec3(i1.x,i0.y,i1.z)),f.x),\n mix(hash31(vec3(i0.x,i1.y,i1.z)), hash31(vec3(i1.x,i1.y,i1.z)),f.x),f.y),f.z);\n}"},8812:e=>{e.exports="vec3 encodeNormal(in float height, in float alpha){\n float dhdx = dFdx(height);\n float dhdy = dFdy(height);\n vec3 normal = alpha * normalize(vec3(-dhdx, -dhdy, 1));\n return 0.5+0.5*normal;\n}"},4346:e=>{e.exports="vec4 quat(in vec3 axis, in float angle){return vec4(axis*sin(.5*angle),cos(.5*angle));}\nvec3 qrotate(in vec4 q, in vec3 v){return v + 2.0*cross(q.xyz, cross(q.xyz,v) + q.w*v);}\nvec4 qmul(vec4 a, vec4 b){return vec4(cross(a.xyz,b.xyz) + a.xyz*b.w + b.xyz*a.w, a.w*b.w - dot(a.xyz,b.xyz));}\nvec4 qrandom(float u1, float u2, float u3){\n float is1 = sqrt(1.-u1); float s1 = sqrt(u1);\n return vec4(is1 * sin(TAU * u2),\n is1 * cos(TAU * u2),\n s1 * sin(TAU * u3),\n s1 * cos(TAU * u3));\n}"},8924:e=>{e.exports="vec4 voronoi(in vec2 uv, in vec2 period, in float jitter, in float width, in float seed){\n uv *= period;\n vec2 i = floor(uv); vec2 f = uv - i;\n vec2 minPos, tilePos;\n float md = 1e+5;\n for(int y=-1;y<=1;y++)\n for(int x=-1;x<=1;x++){\n vec2 n = vec2(x,y);\n vec2 cPos = jitter * hash22(mod(i + n, period) + seed);\n vec2 rPos = n + cPos - f;\n float d = dot(rPos, rPos);\n if(d >= md) continue;\n md = d;\n minPos = rPos;\n tilePos = cPos;\n }\n float md0 = 1e+5, md1 = 1e+5;\n for(int y=-2;y<=2;y++)\n for(int x=-2;x<=2;x++){\n vec2 n = vec2(x,y);\n vec2 cPos = jitter * hash22(mod(i + n, period) + seed);\n vec2 rPos = n + cPos - f;\n vec2 v = minPos - rPos;\n if(dot(v, v) <= 1e-5) continue;\n float d = dot(0.5 * (minPos + rPos), normalize(rPos - minPos));\n if(d < md0){\n md1 = md0; md0 = d;\n }else if(d < md1){\n md1 = d;\n }\n }\n md0 += (md1 - md0) * width;\n return vec4(md0, md, tilePos);\n}"},1615:(e,t,r)=>{e.exports=r(1552)+"\n\nvoid main(){\n"+r(4380)+"\n vec4 color = vColor * texture(uDiffuseMap, uv);\n#ifdef ALPHA_CUTOFF\n if(color.a < ALPHA_CUTOFF) discard;\n#endif\n fragAlbedo = color;\n#ifdef NORMAL_MAPPING\n vec3 dpdx = dFdx(worldPosition.xyz);\n vec3 dpdy = dFdy(worldPosition.xyz);\n vec3 normal = normalize(cross(dpdx, dpdy));\n vec3 binormal = normalize(dpdx);\n vec3 tangent = normalize(dpdy);\n mat3 TBN = mat3(tangent, binormal, normal);\n\n vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\n float blend = dot(mappedNormal, mappedNormal);\n mappedNormal = normalize(TBN * mappedNormal);\n fragNormal = blend * vec4(mappedNormal, 1.0);\n\n#ifdef ALPHA_CUTOFF\n fragNormal.a=0.0;\n#endif\n\n#else\n fragNormal = vec4(0);\n#endif\n\n#ifdef MASK\n float alpha = texture(uNormalMap, uv).a;\n float threshold = smoothstep(1.0+uDissolveEdge,1.0,abs(alpha*2.-1.+vThreshold));\n#ifdef ALPHA_CUTOFF\n if(color.a * threshold < ALPHA_CUTOFF) discard;\n#endif\n fragAlbedo *= threshold;\n fragNormal *= threshold;\n#endif\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n//In any case, here are the shader snippets for when I construct the tangent space based on the depth buffer:\n\n// These ones are hard-edges, but orientated to the scene geometry.\n//float3 pixelNormal = normalize(cross(ddy(worldPosition), ddx(worldPosition)));\n//float3x3 tbn = cotangent_frame(pixelNormal, worldPosition, decalTexCoord);\n\n// So now we can sample from the normal map, and turn it into a world normal, which we then encode.\n//float3 normal = mul(normalMap.xyz, tbn);\n//normal = normalize(normal); // this is the worldspace normal\n\n//and then:\n\n// N is the vertex normal.\n// uv is the texcoord for the decal.\n// p is the worldspace position.\n//float3x3 cotangent_frame(float3 N, float3 p, float2 uv)\n//{\n// get edge vectors of the pixel triangle\n//float3 dp1 = ddx(p);\n//float3 dp2 = ddy(p);\n//float2 duv1 = ddx(uv);\n//float2 duv2 = ddy(uv);\n\n// solve the linear system\n//float3 dp2perp = cross(dp2, N);\n//float3 dp1perp = cross(N, dp1);\n//float3 T = dp2perp * duv1.x + dp1perp * duv2.x;\n//float3 B = dp2perp * duv1.y + dp1perp * duv2.y;\n\n// construct a scale-invariant frame\n//float invmax = rsqrt(max(dot(T,T), dot(B,B)));\n//return float3x3(T * invmax, B * invmax, N);\n//}"},4272:e=>{e.exports="#version 300 es\nprecision highp float;\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec3 aPosition;\n#ifdef INSTANCED\nlayout(location=1) in mat4 aModelMatrix;\nlayout(location=5) in vec4 aUV;\nlayout(location=6) in vec4 aColor;\n\nout vec3 vPosition;\n#ifdef WORLD\nout mat4 vModel;\n#else\nout mat4 vInvModel;\n#endif\nout vec4 vUV;\nout vec4 vColor;\nout float vThreshold;\n#else\nuniform ModelUniforms {\n mat4 uModelMatrix;\n vec4 uColor;\n float uLayer;\n};\n#endif\n\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n\nvoid main(){\n mat4 modelMatrix = aModelMatrix;\n modelMatrix[0][3]=0.0;modelMatrix[1][3]=0.0;modelMatrix[2][3]=0.0;modelMatrix[3][3]=1.0;\n vPosition = (modelMatrix * vec4(aPosition, 1.0)).xyz;\n#ifdef WORLD\n vModel = modelMatrix;\n#else\n vInvModel = inverse(modelMatrix);\n#endif\n vThreshold = aModelMatrix[0][3];\n vUV = aUV;\n vColor = aColor;\n gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\n}"},643:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\n\nin vec2 vUV;\nin vec3 vPosition;\nin vec3 vNormal;\n#ifndef MESH\nin vec4 vColor;\nin float vMaterial;\n#endif\n\nout vec4 fragColor;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n\nuniform sampler2D uAlbedoBuffer;\nuniform sampler2D uSampler;\n\nuniform float uDistortionStrength;\n#ifdef PANNING\nuniform vec4 uUVTransform;\nuniform vec2 uUVPanning;\n#endif\n#ifdef VERTICAL_MASK\nuniform vec4 uVerticalMask;\n#endif\n#ifdef HORIZONTAL_MASK\nuniform vec4 uHorizontalMask;\n#endif\n\nvoid main(){\n#ifdef PANNING\n vec2 uv0 = uUVTransform.xy + uUVTransform.zw * vUV;\n vec4 color = texture(uSampler,uv0 + uTime.x * uUVPanning);\n#else\n vec4 color = texture(uSampler,vUV);\n#endif\n\n#ifdef VERTICAL_MASK\n color *= smoothstep(uVerticalMask.x,uVerticalMask.y,vUV.y);\n color *= smoothstep(uVerticalMask.w,uVerticalMask.z,vUV.y);\n#endif\n#ifdef HORIZONTAL_MASK\n color *= smoothstep(uHorizontalMask.x,uHorizontalMask.y,vUV.x);\n color *= smoothstep(uHorizontalMask.w,uHorizontalMask.z,vUV.x);\n#endif\n\n#ifdef MESH\n vec3 normal = normalize(vNormal);\n vec3 view = normalize(uEyePosition - vPosition);\n float NdV = dot(normal, view);\n vec3 viewNormal = (uViewMatrix * vec4(normal, 0.0)).xyz;\n vec2 distortion = NdV * 0.1 * viewNormal.rg;\n#else\n color *= vColor;\n float height = color.r;\n vec2 duvdx = dFdx(vUV);\n vec2 duvdy = dFdy(vUV);\n float dhdx = dFdx(height) / length(duvdx);\n float dhdy = dFdy(height) / length(duvdy);\n vec2 distortion = uDistortionStrength * color.a * vec2(dhdx, dhdy);\n#endif\n vec2 uv = vec2(gl_FragCoord.xy) / vec2(textureSize(uAlbedoBuffer, 0));\n uv += distortion;\n#ifdef CHROMATIC_ABERRATION\n float red = texture(uAlbedoBuffer, uv - vec2(.01*color.b,0)).r;\n vec4 diffuse = texture(uAlbedoBuffer, uv);\n float blue = texture(uAlbedoBuffer, uv + vec2(.01*color.b,0)).b;\n fragColor = vec4(red, diffuse.g, blue, diffuse.a);\n#else\n fragColor = texture(uAlbedoBuffer, uv);\n#endif\n}"},6687:(e,t,r)=>{e.exports=r(1765)+"\n\n#define LOG2 1.4426950408889634\n\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n\nuniform sampler2D uSampler;\nuniform sampler2D uPositionBuffer;\n#ifdef BLOOM\nuniform sampler2D uBloomMap;\nuniform vec4 uBloomMask;\n#endif\n\n#if defined(LINEAR_FOG)\nuniform vec4 uFogColor;\nuniform vec2 uFogRange;\n#elif defined(EXPONENTIAL_FOG)\nuniform vec4 uFogColor;\nuniform float uFogDensity;\n#endif\n\n#ifdef HALFSPACE\nuniform vec2 uFogHeight;\nfloat halfspace(vec3 origin, vec3 position, vec3 ray, float fogHeight, float fogDensity){\n float fdc = origin.y-fogHeight;\n float fdp = position.y-fogHeight;\n float fdv = position.y-origin.y;\n float k = step(fdc,0.);\n float c1 = k * (fdp + fdc);\n float c2 = (1.-2.*k) * fdp;\n float g = min(c2, 0.0);\n g = -length(.5*fogDensity * ray) * (c1 - g * g / abs(fdv+1.0e-5f));\n return g;\n}\n#endif\n\nvoid main(){\n ivec2 fragCoord = ivec2(gl_FragCoord.xy);\n vec4 color = texelFetch(uSampler, fragCoord, 0);\n\n vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\n vec3 viewRay = position.xyz;\n float distance = length(viewRay) * step(.5,position.a);\n\n#ifdef HALFSPACE\n distance += halfspace(uEyePosition, position.xyz + uEyePosition, viewRay, uFogHeight.x, uFogHeight.y);\n#endif\n\n#if defined(LINEAR_FOG)\n float fogAmount = 1.-smoothstep(uFogRange.x, uFogRange.y, distance);\n color = mix(uFogColor, color, fogAmount);\n#elif defined(EXP_FOG)\n float fogAmount = clamp(exp2(-uFogDensity * distance * LOG2)),0.,1.);\n //float fogAmount = (a/b) * exp(-uEyePosition.y*uFogDensity) * (1.0-exp( -distance*viewRay.y*uFogDensity ))/viewRay.y;\n color = mix(uFogColor, color, fogAmount);\n#elif defined(EXP2_FOG)\n float fogAmount = clamp(exp2(-uFogDensity*uFogDensity * distance*distance * LOG2)),0.,1.);\n color = mix(uFogColor, color, fogAmount);\n#endif\n\n#ifdef BLOOM\n vec4 bloom = uBloomMask * texture(uBloomMap, vUV);\n color += bloom;\n#endif\n fragColor = color;\n}"},6410:(e,t,r)=>{e.exports=r(1765)+"\n\n#ifdef CUBEMAP\nuniform samplerCube uSampler;\n#else\nuniform sampler2D uSampler;\n#endif\nuniform vec4 uMask;\n\n#define TAU 6.283185307179586\n\nvoid main(){\n#ifdef CUBEMAP\n vec2 uv = vUV * vec2(TAU,.5*TAU);\n vec3 ray = vec3(\n -sin(uv.x) * sin(uv.y),\n -cos(uv.y),\n -cos(uv.x) * sin(uv.y)\n );\n fragColor = texture(uSampler, ray);\n#else\n#ifdef NEAREST\n ivec2 fragCoord = ivec2(gl_FragCoord.xy);\n fragColor = uMask * texelFetch(uSampler, fragCoord, 0);\n#else\n fragColor = uMask * texture(uSampler, vUV);\n#endif\n#endif\n}"},4010:e=>{e.exports="#version 300 es\nprecision highp float;\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec3 aPosition;\n\nout vec2 vUV;\n\n#ifdef RAYCAST\nout vec3 vOrigin;\nout vec3 vRay;\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n#endif\n\nvoid main(){\n gl_Position = vec4(aPosition.xzy, 1.0);\n vUV = 0.5 + 0.5 * aPosition.xz;\n#ifdef RAYCAST\n mat4 invProjectionView = inverse(uProjectionMatrix * uViewMatrix);\n float near = uProjectionMatrix[2][3] / (uProjectionMatrix[2][2] - 1.0);\n float far = uProjectionMatrix[2][3] / (uProjectionMatrix[2][2] + 1.0);\n vOrigin = (invProjectionView * vec4(aPosition.xz, -1.0, 1.0) * near).xyz;\n vRay = (invProjectionView * vec4(aPosition.xz * (far - near), far + near, far - near)).xyz;\n#endif\n}"},6426:(e,t,r)=>{e.exports=r(7154)+"\n\n#define MAP_SCALE 10.0\n\nuniform sampler2D uDiffuseMap;\nuniform sampler2D uNormalMap;\n\n#ifdef COLOR_INDEX\n uniform sampler2DArray uArrayMap;\n uniform float uArrayMapLayers;\n#endif\n\nvec2 hash22(in vec2 uv){\n uvec2 q = floatBitsToUint(uv);\n\tq *= uvec2(1597334673U, 3812015801U);\n\tq = (q.x ^ q.y) * uvec2(1597334673U, 3812015801U);\n\treturn vec2(q) * (1.0 / float(0xffffffffU));\n}\nfloat simplex2D(in vec2 uv){\n const float K1 = (sqrt(3.)-1.)/2.;\n const float K2 = (3.-sqrt(3.))/6.;\n\n\tvec2 i = floor(uv + (uv.x+uv.y)*K1);\n vec2 a = uv - i + (i.x+i.y)*K2;\n float m = step(a.y,a.x); \n vec2 o = vec2(m,1.0-m);\n vec2 b = a - o + K2;\n\tvec2 c = a - 1.0 + 2.0*K2;\n vec3 h = max(0.5-vec3(dot(a,a), dot(b,b), dot(c,c)), 0.0);\n vec2 rx = 1.-2.*hash22(i+0.0);\n vec2 ry = 1.-2.*hash22(i+o);\n vec2 rz = 1.-2.*hash22(i+1.0);\n\tvec3 n = h*h*h*h*vec3(dot(a,rx), dot(b,ry), dot(c,rz));\n return 0.5 + 0.5*dot(n, vec3(70.0));\n}\n#ifdef DISSOLVE\n uniform vec3 uDissolveDirection;\n uniform float uDissolveThreshold;\n uniform vec4 uDissolveColor;\n uniform vec3 uDissolveUVScale;\n#endif\n\nvec2 parallaxMapping(in vec2 uv, in vec3 viewDirection, in float heightScale){\n#ifndef PARALLAX_LAYERS\n float depth = texture(uNormalMap, uv).w;\n return uv - viewDirection.xy * heightScale * depth / viewDirection.z;\n#else\n float numLayers = float(PARALLAX_LAYERS) - float(PARALLAX_LAYERS-1) * abs(dot(vec3(0,0,1), viewDirection));\n float layerDepth = 1.0 / numLayers;\n vec2 deltaUV = heightScale * viewDirection.xy / (viewDirection.z * numLayers);\n float depth = 0.0, value = texture(uNormalMap, uv).w;\n for(int i=0;i<PARALLAX_LAYERS;i++){\n if(value < depth) break;\n uv -= deltaUV;\n value = texture(uNormalMap, uv).w;\n depth += layerDepth;\n }\n vec2 prevUV = uv + deltaUV;\n float depthAfter = value - depth;\n float depthBefore = texture(uNormalMap, prevUV).w - depth + layerDepth;\n float weight = depthAfter / (depthAfter - depthBefore);\n return mix(uv, prevUV, weight);\n#endif\n}\n\nvoid main(){\n vec2 uv = vUV;\n vec3 position = vPosition;\n//#ifdef SKINNING\n// vec3 normal = normalize(cross(dFdx(position),dFdy(position)));\n//#else\n vec3 normal = normalize(vNormal);\n//#endif\n\n#ifdef NORMAL_MAPPING\n vec3 dpdx = dFdx(position);\n vec3 dpdy = dFdy(position);\n vec2 duvdx = dFdx(uv);\n vec2 duvdy = dFdy(uv);\n vec3 r1 = cross(dpdy, normal);\n vec3 r2 = cross(normal, dpdx);\n#ifdef BUMP_MAPPING\n vec3 tangent = r1 * duvdx.x + r2 * duvdy.x;\n vec3 binormal = r1 * duvdx.y + r2 * duvdy.y;\n float invMax = inversesqrt(max(dot(tangent, tangent), dot(binormal, binormal)));\n mat3 TBN = mat3(tangent * invMax, binormal * invMax, normal);\n\n mat3 invTBN = mat3(vec3(TBN[0].x,TBN[1].x,TBN[2].x),vec3(TBN[0].y,TBN[1].y,TBN[2].y),vec3(TBN[0].z,TBN[1].z,TBN[2].z));\n vec3 viewDirection = invTBN * normalize(position - uEyePosition);\n uv = parallaxMapping(uv, viewDirection, 0.1);\n\n vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\n normal = normalize(TBN * mappedNormal);\n#else\n vec3 mappedNormal = texture(uNormalMap, uv).xyz*2.-1.;\n vec2 heightGradient = MAP_SCALE * 2.0 * mappedNormal.xy / -mappedNormal.z;\n \n float dhdx = dot(heightGradient, duvdx);\n float dhdy = dot(heightGradient, duvdy);\n\n vec3 surfaceGradient = (r1 * dhdx + r2 * dhdy) / dot(dpdx, r1);\n normal = normalize(normal - surfaceGradient);\n#endif\n#endif\n vec4 diffuse = texture(uDiffuseMap, uv);\n\n#ifdef COLOR_INDEX\n#ifdef VERTEX_COLOR\n diffuse = texture(uArrayMap, vec3(4.*uv, uArrayMapLayers * vColor.a));\n diffuse.rgb *= vColor.rgb;\n#else\n vec2 size = vec2(textureSize(uDiffuseMap, 0));\n float colorIndex = texelFetch(uDiffuseMap, ivec2(uv * size), 0).r;\n float ao = diffuse.g;\n diffuse = texture(uArrayMap, vec3(4.*uv, uArrayMapLayers * colorIndex));\n diffuse.rgb *= ao;\n#endif\n#endif\n\n#ifdef DISSOLVE\n diffuse = mix(uColor.rrrg, diffuse, uColor.b);\n float threshold = dot(position, uDissolveDirection) + uDissolveUVScale.z * simplex2D(uv * uDissolveUVScale.xy);\n if(threshold < uColor.a) discard;\n diffuse = mix(diffuse, uDissolveColor, smoothstep(-uDissolveThreshold,0.,uColor.a - threshold));\n#else\n diffuse.rgb *= uColor.rgb;\n diffuse.a = mix(0.5, diffuse.a, uColor.a);\n#endif\n float metallic = 2.0 * 0.5 * smoothstep(0.25, 0.0, diffuse.a);\n\n fragPosition = vec4(position - uEyePosition, uLayer);\n fragNormal = vec4(normal, metallic);\n fragAlbedo = diffuse;\n}"},669:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\n\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec3 aPosition;\nlayout(location=1) in vec3 aNormal;\nlayout(location=2) in vec2 aUV;\n#ifdef SKINNING\nlayout(location=3) in vec4 aJoint;\nlayout(location=4) in vec4 aWeight;\n\nuniform vec4 uBoneMatrix[64];\n\nmat4 boneMatrix(uint joint){\n vec4 col0 = uBoneMatrix[joint*3U+0U];\n vec4 col1 = uBoneMatrix[joint*3U+1U];\n vec4 col2 = uBoneMatrix[joint*3U+2U];\n return mat4(col0[0], col1[0], col2[0], 0.0,\n col0[1], col1[1], col2[1], 0.0,\n col0[2], col1[2], col2[2], 0.0,\n col0[3], col1[3], col2[3], 1.0);\n}\n#endif\n\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\nuniform ModelUniforms {\n mat4 uModelMatrix;\n vec4 uColor;\n float uLayer;\n float uStartTime;\n};\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nvoid main(){\n#ifdef SKINNING\n mat4 skinMatrix =\n aWeight.x * boneMatrix(uint(aJoint.x)) +\n aWeight.y * boneMatrix(uint(aJoint.y)) +\n aWeight.z * boneMatrix(uint(aJoint.z)) +\n aWeight.w * boneMatrix(uint(aJoint.w));\n mat4 modelTransform = uModelMatrix * skinMatrix;\n#else\n mat4 modelTransform = uModelMatrix;\n#endif\n vPosition = (modelTransform * vec4(aPosition, 1.0)).xyz;\n vNormal = (modelTransform * vec4(aNormal, 0.0)).xyz;\n vUV = aUV;\n gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\n}"},6935:e=>{e.exports="#version 300 es\n\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec3 aPosition;\n\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\nuniform LightUniforms {\n mat4 uModelMatrix;\n vec4 uColor;\n float uRadius;\n float uIntensity;\n};\n\nvoid main(){\n gl_Position = uViewProjectionMatrix * uModelMatrix * vec4(aPosition * uRadius, 1.0);\n}"},2655:(e,t,r)=>{e.exports=r(1765)+"\n"+r(1287)+"\n"+r(905)+"\n\nfloat noise11(in float u, in float period, float seed){\n u *= period;\n vec2 i = mod(floor(vec2(u,u+1.0)),vec2(period))+seed;\n float f = fract(u);\n return mix(hash11(i.x),hash11(i.y),f);\n}\nfloat noise21(in vec2 uv, in vec2 period, float seed){\n uv *= period;\n vec4 i = mod(floor(uv).xyxy+vec2(0,1).xxyy,period.xyxy)+seed;\n vec2 f = fract(uv); f = f*f*f*(f*(f*6.0-15.0)+10.0);\n return mix(mix(hash21(i.xy), \n hash21(i.zy), f.x),\n mix(hash21(i.xw), \n hash21(i.zw), f.x), f.y);\n}\nvec3 noise21d(in vec2 uv, in vec2 period, float seed){\n uv *= period;\n vec4 i = mod(floor(uv).xyxy+vec2(0,1).xxyy,period.xyxy)+seed;\n vec2 u = fract(uv);\n vec2 du = 30.0 * u * u * (u * (u - 2.0) + 1.0);\n u = u*u*u*(u*(u*6.0-15.0)+10.0);\n float a = hash21(i.xy);\n float b = hash21(i.zy);\n float c = hash21(i.xw);\n float d = hash21(i.zw);\n float abcd = a - b - c + d;\n float value = a + (b - a) * u.x + (c - a) * u.y + abcd * u.x * u.y;\n vec2 derivative = du.xy * (u.yx * abcd + vec2(b, c) - a);\n return vec3(value * 2.0 - 1.0, derivative);\n}\n\nfloat perlin2D(vec2 uv, vec2 period, float seed){\n uv *= period;\n vec4 i = floor(uv).xyxy + vec2(0,1).xxyy;\n vec4 f = uv.xyxy - i.xyxy - vec2(0,1).xxyy;\n i = mod(i, period.xyxy) + seed;\n vec2 a = hash22(i.xy);\n vec2 b = hash22(i.zy);\n vec2 c = hash22(i.xw);\n vec2 d = hash22(i.zw);\n vec4 gradientX = vec4(a.x,b.x,c.x,d.x)-.5;\n vec4 gradientY = vec4(a.y,b.y,c.y,d.y)-.5;\n vec4 gradients = inversesqrt(gradientX * gradientX + gradientY * gradientY) * (gradientX * f.xzxz + gradientY * f.yyww);\n gradients *= 2.3703703703703703703703703703704;\n vec4 lengthSq = f * f;\n lengthSq = lengthSq.xzxz + lengthSq.yyww;\n vec4 xSq = 1.0 - min(vec4(1.0), lengthSq); \n xSq = xSq * xSq * xSq;\n return .5+.5*dot(xSq, gradients);\n}\n\nfloat fbm(vec2 uv, vec2 frequency, int octaves, float shift, float gain, float lacunarity, float factor, float seed){\n uv *= frequency;\n vec2 offset = vec2(shift,0);\n float value = 0.0, amplitude = gain;\n vec2 sc = vec2(sin(shift), cos(shift)); mat2 rotate = mat2(sc.y,sc.x,-sc.x,sc.y);\n for(int i=0;i<octaves;i++){\n value += amplitude * (noise21(uv / frequency, frequency, seed)*2.-1.);\n uv = uv * lacunarity + offset * float(i+1);\n frequency *= lacunarity;\n amplitude = pow(amplitude * gain, factor);\n offset *= rotate;\n }\n return .5+.5*value;\n}\nvec3 fbmd(vec2 uv, vec2 frequency, int octaves, vec2 shift, float gain, vec2 lacunarity, float slopeness, float factor, float seed){\n uv *= frequency;\n vec3 value = vec3(0); vec2 derivative = vec2(0); float amplitude = gain;\n vec2 sc = vec2(sin(shift.x),cos(shift.y)); mat2 rotate = mat2(sc.y,sc.x,-sc.x,sc.y);\n for(int i=0;i<octaves;i++){\n vec3 n = noise21d(uv / frequency, frequency, seed).xyz;\n derivative += n.yz;\n\n n *= amplitude;\n n.x /= (1.0 + mix(0.0, dot(derivative, derivative), slopeness));\n value += n; \n \n uv = (uv + shift) * lacunarity;\n frequency *= lacunarity;\n amplitude = pow(amplitude * gain, factor);\n shift *= rotate;\n }\n value.x = value.x * 0.5 + 0.5;\n return value;\n}\n"+r(8924)+"\n\nvec4 rectangularNoise(in vec2 uv, in vec2 period){\n uv *= period;\n vec2 i = floor(uv);\n vec2 f = uv - i;\n vec2 c = vec2(0);\n int o = int(i.x+i.y) & 1;\n int u = o ^ 1;\n bool s = f[o]>hash21(mod(i,period));\n if(s) c[o] = 1.;\n vec2 n = i;\n n[o] += s ? 1. : -1.;\n if(f[u]>hash21(mod(n,period))) c[u] = 1.;\n c = i+c;\n\n vec4 d = vec4(\n hash21(mod(c + vec2(-1,-1), period)), \n hash21(mod(c + vec2( 0,-1), period)), \n hash21(mod(c + vec2( 0, 0), period)), \n \thash21(mod(c + vec2(-1, 0), period))\n );\n o = int(c.x+c.y) & 1;\n if(o==1) d = d.wxyz;\n d = d + vec4(c-1.,c);\n vec2 mi = d.xy;\n vec2 ma = d.zw;\n return vec4(uv-mi, uv-ma);\n}\n\nfloat sineNoise(vec2 uv, int layers, float shift){\n vec2 p = vec2(uv); float v = 0.0;\n\tfor(int i=0;i<layers;i++){\n\t\tfloat t = shift * (.75+.25*sin(float(i+1)*43758.5453));\n uv.y -= t;\n\t\tp = uv + vec2(cos(t - p.x) + sin(t + p.y), sin(t - p.y) + cos(t + p.x));\n v += 1.0/length(1.0/vec2(sin(p.x+t), cos(p.y+t)));\n\t}\n v = smoothstep(1.0,0.0,v / float(layers));\n return pow(v,1.4);\n}\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = vUV;\n#ifdef SKEW\n uv = vec2(uv.x+uv.y,uv.x-uv.y);\n#endif\n#if defined(CELLULAR)\n vec4 w = voronoi(uv, vec2(8), 1.0, 0.0, 0.0);\n float alpha = 1.0-(1.0-1.5*w.y);\n vec4 color = vec4(alpha);\n#elif defined(VORONOI)\n vec4 w = voronoi(uv, vec2(8), 1.0, 0.0, 0.0);\n float alpha = smoothstep(0.8,-0.2,w.x);\n vec4 color = vec4(alpha);\n#elif defined(PERLIN)\n float nx = perlin2D(uv, vec2(8.0), 0.0);\n float ny = perlin2D(uv + vec2(0.3), vec2(8.0), 0.0);\n float nz = perlin2D(uv + vec2(0.7), vec2(8.0), 0.0);\n vec4 color = vec4(nx,ny,nz,1);\n#elif defined(RECTANGULAR)\n vec4 minmax = rectangularNoise(uv, vec2(8));\n float alpha = min(min(abs(minmax.x), abs(minmax.y)), min(abs(minmax.z),abs(minmax.w)));\n vec4 color = vec4(alpha);\n#elif defined(SINE)\n float alpha = sineNoise(uv*TAU, 8, 411.37);\n alpha = smoothstep(0.2,1.0,alpha);\n vec4 color = vec4(alpha);\n#elif defined(WARP)\n const float gain = 0.5, slopeness = 0.5, factor = 0.94, seed = 0.0;\n const vec2 lacunarity = vec2(2), frequency = vec2(8.0);\n\n float f0 = fbmd(uv, frequency, 7, vec2(123), gain, lacunarity, slopeness, factor, seed).x;\n float f1 = fbmd(uv, frequency, 7, vec2(235), gain, lacunarity, slopeness, factor, seed).x;\n uv = uv + 0.2 * vec2(f0, f1);\n float alpha = fbmd(uv, frequency, 7, vec2(0.0), gain, lacunarity, slopeness, factor, seed).x;\n vec4 color = vec4(alpha);\n#else\n float f0 = fbm(uv, vec2(8.0), 7, 23.0, 0.5, 2.0, 0.95, 0.0);\n float alpha = smoothstep(0.2, 1.0, f0);\n vec4 color = vec4(alpha);\n#endif\n\tfragColor = uColor * color;\n}"},6584:e=>{e.exports="#version 300 es\nprecision highp float;\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec4 aLifetime;\nlayout(location=1) in vec4 aSize;\nlayout(location=2) in vec4 aTransform;\nlayout(location=3) in vec4 aVelocity;\nlayout(location=4) in vec4 aAcceleration;\n\nlayout(xfb_offset=0) out vec4 vLifetime;\nlayout(xfb_offset=0) out vec4 vSize;\nlayout(xfb_offset=0) out vec4 vTransform;\nlayout(xfb_offset=0) out vec4 vVelocity;\nlayout(xfb_offset=0) out vec4 vAcceleration;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform EmitterUniforms {\n vec4 uLifespan;\n vec3 uOrigin;\n vec2 uSize;\n vec3 uGravity;\n#if defined(SPHERE)\n vec2 uRadius;\n#elif defined(CIRCLE)\n vec2 uRadius;\n vec4 uOrientation;\n#elif defined(BOX)\n vec3 uExtents;\n#endif\n#ifdef TARGETED\n vec2 uForce;\n vec3 uTarget;\n#endif\n#ifdef VECTOR_FIELD\n\tvec4 uFieldDomain;\n\tvec2 uFieldStrength;\n#endif\n#ifdef TRAIL\n vec2 uLength;\n#else\n vec2 uRotation;\n#endif\n#ifdef ANGULAR\n vec4 uAngular;\n#endif\n#ifdef FRAMES\n vec2 uFrame;\n#endif\n int uLastID;\n};\n\n#ifdef LUT\nuniform sampler2D uAttributes;\nvec4 lerpLUT(sampler2D texture, float u, int v){\n float width = float(textureSize(texture,0).x);\n ivec2 uv = ivec2(u * width, v);\n vec4 a = texelFetchOffset(texture,uv,0,ivec2(0,0));\n vec4 b = texelFetchOffset(texture,uv,0,ivec2(1,0));\n float f = fract(u * width);\n return mix(a, b, f);\n}\n#endif\n\n#define TAU 6.283185307179586\nfloat hash11(uint n){\n\tn = (n << 13U) ^ n;\n n = n * (n * n * 15731U + 789221U) + 1376312589U;\n return float(n & uvec3(0x7fffffffU))/float(0x7fffffff);\n}\nfloat hash31(vec3 uv){\n\tconst uvec3 u = uvec3(1597334673U, 3812015801U, 2798796415U);\n\tuvec3 q = floatBitsToUint(uv);\n\tq *= u;\n\tuint n = (q.x ^ q.y ^ q.z) * 1597334673U;\n\treturn -1.0 + 2.0 * float(n) * (1.0 / float(0xffffffffU));\n}\nvec3 hash33(vec3 uv){\n\tconst uvec3 u = uvec3(1597334673U, 3812015801U, 2798796415U);\n\tuvec3 q = floatBitsToUint(uv);\n\tq *= u;\n\tq = (q.x ^ q.y ^ q.z)*u;\n\treturn -1.0 + 2.0 * vec3(q) * (1.0 / float(0xffffffffU));\n}\n\nfloat noise3D(vec3 p, float seed){\n vec3 pi = floor(p);\n vec3 pf = p - pi; pi += seed;\n vec3 w = pf * pf * (3.0 - 2.0 * pf);\n return mix(mix(mix(hash31(pi + vec3(0, 0, 0)), hash31(pi + vec3(1, 0, 0)), w.x),\n \t mix(hash31(pi + vec3(0, 0, 1)), hash31(pi + vec3(1, 0, 1)), w.x), w.z),\n mix(mix(hash31(pi + vec3(0, 1, 0)), hash31(pi + vec3(1, 1, 0)), w.x),\n mix(hash31(pi + vec3(0, 1, 1)), hash31(pi + vec3(1, 1, 1)), w.x), w.z), w.y);\n}\nfloat perlin3D(vec3 p, float seed){\n vec3 pi = floor(p);\n vec3 pf = p - pi; pi += seed;\n vec3 w = pf * pf * (3.0 - 2.0 * pf);\n return mix(mix(mix(dot(pf - vec3(0, 0, 0), hash33(pi + vec3(0, 0, 0))), \n dot(pf - vec3(1, 0, 0), hash33(pi + vec3(1, 0, 0))), w.x),\n mix(dot(pf - vec3(0, 0, 1), hash33(pi + vec3(0, 0, 1))), \n dot(pf - vec3(1, 0, 1), hash33(pi + vec3(1, 0, 1))), w.x), w.z),\n mix(mix(dot(pf - vec3(0, 1, 0), hash33(pi + vec3(0, 1, 0))), \n dot(pf - vec3(1, 1, 0), hash33(pi + vec3(1, 1, 0))), w.x),\n mix(dot(pf - vec3(0, 1, 1), hash33(pi + vec3(0, 1, 1))), \n dot(pf - vec3(1, 1, 1), hash33(pi + vec3(1, 1, 1))), w.x), w.z), w.y);\n}\nfloat simplex3D(vec3 p){\n const float K1 = 0.333333333;\n const float K2 = 0.166666667;\n vec3 i = floor(p + (p.x + p.y + p.z) * K1);\n vec3 d0 = p - (i - (i.x + i.y + i.z) * K2);\n vec3 e = step(vec3(0.0), d0 - d0.yzx);\n\tvec3 i1 = e * (1.0 - e.zxy);\n\tvec3 i2 = 1.0 - e.zxy * (1.0 - e);\n vec3 d1 = d0 - (i1 - 1.0 * K2);\n vec3 d2 = d0 - (i2 - 2.0 * K2);\n vec3 d3 = d0 - (1.0 - 3.0 * K2);\n vec4 h = max(0.6 - vec4(dot(d0, d0), dot(d1, d1), dot(d2, d2), dot(d3, d3)), 0.0);\n vec4 n = h * h * h * h * vec4(dot(d0, hash33(i)), dot(d1, hash33(i + i1)), dot(d2, hash33(i + i2)), dot(d3, hash33(i + 1.0)));\n return dot(vec4(31.316), n);\n}\n\nvec4 quat(in vec3 axis, in float angle){return vec4(axis*sin(.5*angle),cos(.5*angle));}\nvec3 qrotate(in vec4 q, in vec3 v){return v + 2.0*cross(q.xyz, cross(q.xyz,v) + q.w*v);}\nvec4 qmul(vec4 a, vec4 b){return vec4(cross(a.xyz,b.xyz) + a.xyz*b.w + b.xyz*a.w, a.w*b.w - dot(a.xyz,b.xyz));}\n\nvoid main(){\n if(gl_VertexID >= uLastID){\n uint seed = uint(gl_VertexID) ^ floatBitsToUint(uTime.z);\n vLifetime.z = hash11(seed+=1U);\n#ifdef STATIC\n vLifetime.x = uTime.x - mix(uLifespan.z, uLifespan.w, hash11(seed+=1U));\n vLifetime.y = mix(uLifespan.x, uLifespan.y, hash11(seed+=1U));\n#else\n vLifetime.x = mix(uLifespan.z, uLifespan.w, hash11(seed+=1U));\n vLifetime.y = 1.0 / mix(uLifespan.x, uLifespan.y, hash11(seed+=1U));\n#endif\n#if defined(SPHERE)\n float theta = TAU * hash11(seed+=1U);\n float phi = acos(2. * hash11(seed+=1U) - 1.);\n float radius = mix(uRadius.x, uRadius.y, hash11(seed+=1U));\n vec3 normal = vec3(sin(phi) * cos(theta), sin(phi) * sin(theta), cos(phi));\n vTransform.xyz = uOrigin + radius * normal;\n#elif defined(CIRCLE)\n float theta = TAU * hash11(seed+=1U);\n float radius = mix(uRadius.x, uRadius.y, hash11(seed+=1U));\n vec3 normal = qrotate(uOrientation,vec3(cos(theta), 0, sin(theta)));\n vTransform.xyz = uOrigin + radius * normal;\n#elif defined(BOX)\n vTransform.xyz = uOrigin + uExtents * (vec3(hash11(seed+=1U), hash11(seed+=1U), hash11(seed+=1U))-.5);\n#else\n vTransform.xyz = uOrigin;\n#endif\n#ifdef TRAIL\n vTransform.w = mix(uLength.x, uLength.y, hash11(seed+=1U));\n#else\n vTransform.w = mix(uRotation.x, uRotation.y, hash11(seed+=1U));\n#endif\n\n#if defined(TARGETED)\n vec3 direction = normalize(vTransform.xyz - (uOrigin + uTarget));\n vVelocity.xyz = direction * mix(uForce.x, uForce.y, hash11(seed+=1U));\n#elif defined(RELATIVE)\n vVelocity.xyz = normal;\n#endif\n vAcceleration.xyz = uGravity;\n#ifdef ANGULAR\n vVelocity.w = mix(uAngular.x,uAngular.y,hash11(seed+=1U));\n vAcceleration.w = mix(uAngular.z,uAngular.w,hash11(seed+=1U));\n#else\n vVelocity.w = 0.0;\n vAcceleration.w = 0.0;\n#endif\n\n vSize.x = mix(uSize.x, uSize.y, hash11(seed+=1U));\n vSize.y = 0.0;\n#ifdef FRAMES\n vSize.zw = vec2(floor(uFrame.y * uFrame.y * hash11(seed+=1U)), uFrame.y);\n#else\n vSize.zw = vec2(0,1);\n#endif\n }else{\n#ifdef STATIC\n vLifetime = aLifetime;\n vTransform = aTransform;\n vVelocity = aVelocity;\n vAcceleration = aAcceleration;\n vSize = aSize;\n#else\n vLifetime = aLifetime + vec4(uTime.y,0,0,0);\n float life = clamp(vLifetime.x * vLifetime.y, 0.0, 1.0);\n float deltaTime = max(0.0,vLifetime.x) - max(0.0,aLifetime.x);\n\n#ifdef LUT\n float f = hash11(floatBitsToUint(vLifetime.z));\n vec4 s0 = lerpLUT(uAttributes, life, 0);\n vec4 s1 = lerpLUT(uAttributes, life, 1);\n float mSize = mix(s0.x, s0.y, f);\n vec2 mVelocity = vec2(mix(s0.z,s0.w,f),mix(s1.x,s1.y,f));\n float mRadial = mix(s1.z,s1.w,f);\n\t\tmVelocity = 1.0 / (1.0 + (1.0-mVelocity) * deltaTime * 60.);\n#else\n const float mSize = 1.0;\n const vec2 mVelocity = vec2(1.0);\n const float mRadial = 1.0;\n#endif\n\n vAcceleration = aAcceleration;\n vVelocity = aVelocity + vAcceleration * deltaTime;\n#ifdef VECTOR_FIELD\n\t\tvec3 fieldPosition = aTransform.xyz*uFieldDomain.xyz + vec3(3972.8371)*vLifetime.z;\n\t\tvec3 fieldForce = vec3(\n\t\t\tsimplex3D(fieldPosition),\n\t\t\tsimplex3D(fieldPosition+vec3(189.234)),\n\t\t\tsimplex3D(fieldPosition+vec3(411.321))\n\t\t);\n\t\tvVelocity.xyz += fieldForce * deltaTime * uFieldStrength.x;\n#endif\n#ifdef RADIAL\n vec3 radial = uOrigin + uTarget - aTransform.xyz;\n vec3 attractor = mRadial * normalize(radial);\n vVelocity.xyz += attractor;\n#endif\n vVelocity *= mVelocity.xxxy;\n vTransform = aTransform + deltaTime * vVelocity;\n vSize = vec4(aSize.x, mSize * aSize.x, aSize.z, aSize.w);\n#ifdef FRAMES\n vSize.z = mod(aSize.z + deltaTime * uFrame.x, vSize.w * vSize.w);\n#endif\n#endif\n }\n}"},5784:e=>{e.exports="#version 300 es\nprecision highp float;\n#define PI 3.141592653589793\n\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n#ifdef OMNILIGHT\nuniform LightUniforms {\n mat4 uModelMatrix;\n vec4 uColor;\n float uRadius;\n float uIntensity;\n};\n#endif\n\nuniform sampler2D uAlbedoBuffer;\nuniform sampler2D uNormalBuffer;\nuniform sampler2D uPositionBuffer;\n\nlayout(location=0) out vec4 fragColor;\n\n//Normal Distribution Functions\nfloat ndfBlinnPhong(in float NdH, in float alpha){\n float n = 2.0 / (alpha * alpha) - 2.0;\n return pow(NdH, n) * (n + 2.0) / (2.0 * PI);\n}\nfloat ndfPhong(in vec3 L, in vec3 N, in vec3 V, in float alpha){\n vec3 R = reflect(-L, N);\n float VdR = max(0.0, dot(V, R));\n float n = 2.0 / (alpha * alpha) - 2.0;\n return pow(VdR, n) * (n + 2.0) / (2.0 * PI);\n}\nfloat ndfBeckmann(in float NdH, in float alpha){\n float a2 = alpha*alpha;\n float NdH2 = NdH*NdH;\n return exp((NdH2 - 1.0) / (a2 * NdH2)) / (PI * a2 * NdH2 * NdH2);\n}\nfloat ndfGGX(in float NdH, in float alpha){\n float a2 = alpha*alpha;\n float denom = (NdH*NdH) * (a2 - 1.0) + 1.0;\n return a2 / (PI * denom * denom);\n}\n\n//Geometric Shadowing Functions\nfloat gsfImplicit(in float NdL, in float NdV){return NdL*NdV;}\nfloat gsfKalemen(in float NdV, in float NdL, in float alpha){\n const float c = sqrt(2./PI);\n float k = alpha * alpha * c;\n float gH = NdV * k +(1.-k);\n\treturn gH * gH * NdL;\n}\nfloat gsfCookTorrence(in float NdL, in float NdV, in float VdH, in float NdH){\n return min(1., min(2.*NdH*NdV / VdH, 2.*NdH*NdL / VdH));\n}\nfloat gsfWalter(in float NdL, in float NdV, in float alpha){\n float a2 = alpha*alpha;\n float L = (2.*NdL)/(NdL + sqrt(a2 + (1.-a2) * NdL*NdL));\n float V = (2.*NdV)/(NdV + sqrt(a2 + (1.-a2) * NdV*NdV));\n return L * V;\n}\nfloat gsfSchlick(in float NdL, in float NdV, in float alpha){\n#if defined(BECKMANN)\n float a2 = alpha * alpha;\n float k = a2 * 0.797884560802865;\n#elif defined(GGX)\n float k = alpha * 0.5;\n#else\n float k = alpha * alpha;\n#endif\n float V = NdV / (NdV * (1.0 - k) + k);\n float L = NdL / (NdL * (1.0 - k) + k);\n return V * L;\n}\n\nvec3 fresnelSchlick(vec3 F0, float cosTheta){\n return mix(F0, vec3(1.0), pow(1.0 - cosTheta, 5.0));\n}\nvec3 fresnelSchlick(vec3 F0, float cosTheta, float roughness){\n return mix(F0, max(vec3(1.0-roughness), F0), pow(1.0 - cosTheta, 5.0));\n}\n\nvoid main(){\n ivec2 fragCoord = ivec2(gl_FragCoord.xy);\n vec3 position = texelFetch(uPositionBuffer, fragCoord, 0).xyz + uEyePosition;\n vec4 normal = texelFetch(uNormalBuffer, fragCoord, 0);\n vec4 albedo = texelFetch(uAlbedoBuffer, fragCoord, 0);\n float emission = max(0.,2.*albedo.a-1.);\n float roughness = clamp(2.*albedo.a,0.04,1.0);\n float metalness = normal.a;\n\n#ifdef OMNILIGHT\n vec3 lightPosition = vec3(uModelMatrix[3]);\n float attenuation = smoothstep(-uRadius, 0.0, -length(lightPosition - position));\n vec3 light = attenuation * uIntensity * uColor.rgb;\n light = mix(light,vec3(0),emission);\n#endif\n\n vec3 N = normalize(normal.xyz);\n vec3 V = normalize(uEyePosition - position);\n vec3 L = normalize(lightPosition - position);\n vec3 H = normalize(L + V);\n\n float NdL = max(0.001, dot(N, L));\n float NdV = max(0.001, dot(N, V));\n float NdH = max(0.001, dot(N, H));\n float HdV = max(0.001, dot(H, V));\n\n vec3 F0 = mix(vec3(0.04), albedo.rgb, metalness);\n float alpha = roughness*roughness;\n\n#ifdef PHONG\n vec3 F = fresnelSchlick(F0, NdV);\n#else\n vec3 F = fresnelSchlick(F0, HdV);\n#endif\n#if defined(BLINN)\n float D = ndfBlinnPhong(NdH, alpha);\n#elif defined(PHONG)\n float D = ndfPhong(N, L, V, alpha);\n#elif defined(BECKMANN)\n float D = ndfBeckmann(NdH, alpha);\n#elif defined(GGX)\n float D = ndfGGX(NdH, alpha);\n#endif\n\n#if defined(SCHLICK)\n float G = gsfSchlick(NdL, NdV, alpha);\n#elif defined(KALEMEN)\n float G = gsfKalemen(NdV, NdL, alpha);\n#elif defined(WALTER)\n float G = gsfWalter(NdL, NdV, alpha);\n#else\n float G = gsfImplicit(NdL, NdV);\n#endif\n vec3 specular = (F * D * G) / (4.0 * NdL * NdV);\n vec3 diffuse = albedo.rgb * mix(vec3(1.0) - F, vec3(0.0), metalness);\n\n fragColor = vec4(NdL*light*(diffuse+specular),0.);\n}"},4247:e=>{e.exports="#version 300 es\nprecision highp float;\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec4 aLifetime;\nlayout(location=1) in vec4 aSize;\nlayout(location=2) in vec4 aTransform;\nlayout(location=3) in vec4 aVelocity;\nlayout(location=4) in vec4 aAcceleration;\n\nlayout(location=5) in vec3 aPosition;\nlayout(location=6) in vec2 aUV;\n\nout vec2 vUV;\nout vec2 vLife;\nout vec3 vPosition;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n\nvoid main(){\n float time = uTime.x - aLifetime.x + aPosition.y * aTransform.w;\n time = (time - aTransform.w) * (aLifetime.y + aTransform.w) / aLifetime.y;\n time = clamp(time, 0.0, aLifetime.y);\n vLife = vec2(time / aLifetime.y, aLifetime.z);\n\n float size = mix(aSize.x, aSize.y, vLife.x);\n\n vec3 position = aTransform.xyz + time * aVelocity.xyz + 0.5 * time * time * aAcceleration.xyz;\n vec3 direction = normalize(aVelocity.xyz + time * aAcceleration.xyz);\n vec3 front = -vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\n position = position + size * cross(front, direction) * aPosition.x;\n\n vUV = aUV;\n vPosition = position;\n gl_Position = uViewProjectionMatrix * vec4(position, 1.0);\n}"},1552:e=>{e.exports="#version 300 es\nprecision highp float;\n\nin vec3 vPosition;\n#ifdef INSTANCED\nin mat4 vInvModel;\nin vec4 vUV;\nin vec4 vColor;\nin float vThreshold;\n#else\nuniform ModelUniforms {\n mat4 uModelMatrix;\n mat4 uInvModelMatrix;\n vec4 uColor;\n float uLayer;\n};\n#endif\n\nlayout(location=0) out vec4 fragAlbedo;\nlayout(location=1) out vec4 fragNormal;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n#ifdef INSTANCED\nuniform float uLayer;\nuniform float uDissolveEdge;\n#endif\nuniform sampler2D uDiffuseMap;\nuniform sampler2D uNormalMap;\nuniform sampler2D uPositionBuffer;\n\n#define TAU 6.283185307179586"},4380:e=>{e.exports="ivec2 fragCoord = ivec2(gl_FragCoord.xy);\nvec3 viewRay = vPosition.xyz - uEyePosition;\nvec4 worldPosition = texelFetch(uPositionBuffer, fragCoord, 0);\nif(worldPosition.a > uLayer) discard;\nvec4 objectPosition = vInvModel * vec4(worldPosition.xyz + uEyePosition, 1.0);\nif(0.5 < abs(objectPosition.x) || 0.5 < abs(objectPosition.y) || 0.5 < abs(objectPosition.z)) discard;\nvec2 uv = mix(vUV.xy, vUV.zw, objectPosition.xz + 0.5);"},1765:e=>{e.exports="#version 300 es\nprecision highp float;\nin vec2 vUV;\nlayout(location=0) out vec4 fragColor;\n#define TAU 6.283185307179586"},7154:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision highp sampler2DArray;\n\nin vec2 vUV;\nin vec3 vPosition;\nin vec3 vNormal;\n#ifdef VERTEX_COLOR\nin vec4 vColor;\n#endif\n#ifdef TRANSPARENT\nin vec4 vColor;\nin float vMaterial;\nlayout(location=0) out vec4 fragColor;\n#else\nlayout(location=0) out vec4 fragAlbedo;\nlayout(location=1) out vec4 fragNormal;\nlayout(location=2) out vec4 fragPosition;\n#endif\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n#ifndef TRANSPARENT\nuniform ModelUniforms {\n mat4 uModelMatrix;\n vec4 uColor;\n float uLayer;\n float uStartTime;\n};\n#endif\n\n#define TAU 6.283185307179586"},443:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform sampler2D uSampler;\n\nvoid main(){\n vec4 color = texture(uSampler, vUV);\n#ifdef BRIGHTNESS\n float brightness = dot(color.rgb, vec3(0.2126, 0.7152, 0.0722));\n color *= step(0.5, brightness);\n#endif\n#ifdef MASK\n color *= color.a;\n#endif\n fragColor = vec4(color.rgb,1);\n}"},1818:(e,t,r)=>{e.exports="#version 300 es\nprecision highp float;\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec4 aLifetime;\nlayout(location=1) in vec4 aSize;\nlayout(location=2) in vec4 aTransform;\nlayout(location=3) in vec4 aVelocity;\nlayout(location=4) in vec4 aAcceleration;\n\nlayout(location=5) in vec3 aPosition;\nlayout(location=6) in vec2 aUV;\n\nout vec3 vPosition;\nout vec2 vLife;\nout vec2 vUV;\nout vec4 vUVClamp;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n\n#ifdef LUT\nuniform sampler2D uAttributes;\nvec4 lerpLUT(sampler2D texture, float u, int v){\n float width = float(textureSize(texture,0).x);\n ivec2 uv = ivec2(u * width, v);\n vec4 a = texelFetchOffset(texture,uv,0,ivec2(0,0));\n vec4 b = texelFetchOffset(texture,uv,0,ivec2(1,0));\n float f = fract(u * width);\n return mix(a, b, f);\n}\n#endif\nuniform sampler2D uDisplacementMap;\n\nfloat hash11(uint n){\n\tn = (n << 13U) ^ n;\n n = n * (n * n * 15731U + 789221U) + 1376312589U;\n return float(n & uvec3(0x7fffffffU))/float(0x7fffffff);\n}\n"+r(5404)+"\n\nvoid main(){\n float time = max(0.,uTime.x - aLifetime.x);\n float duration = aLifetime.w > 0. ? aLifetime.w : time+1.;\n float seed = aLifetime.z + 0.1 * floor(time / duration);\n time = min(mod(time, duration), aLifetime.y);\n vLife = vec2(time / aLifetime.y, seed);\n\n float size = mix(aSize.x, aSize.y, vLife.x);\n#ifdef LUT\n float f = hash11(floatBitsToUint(seed));\n vec4 s0 = lerpLUT(uAttributes, vLife.x, 0);\n size *= mix(s0.x, s0.y, f);\n#endif\n vec4 transform = aTransform + time * aVelocity + 0.5 * time * time * aAcceleration;\n#ifdef VECTOR_FIELD\n transform.xyz += mix(s0.z,s0.w,f)*(-1.+2.*texture(uDisplacementMap, vec2(seed, vLife.x * 0.4)).rgb);\n#endif\n vec3 position = vec3(rotate(transform.w) * aPosition.xy, aPosition.z);\n \n#ifdef VIEWPLANE\n vec3 forward = -vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\n#else\n vec3 forward = normalize(transform.xyz - uEyePosition);\n#endif\n\n#if defined(SPHERICAL)\n vec3 right = vec3(uViewMatrix[0][0], uViewMatrix[1][0], uViewMatrix[2][0]);\n vec3 up = vec3(uViewMatrix[0][1], uViewMatrix[1][1], uViewMatrix[2][1]);\n position = size * (right * position.x + up * position.y);\n#elif defined(ALIGNED)\n vec3 velocity = aVelocity.xyz + time * aAcceleration.xyz;\n\n vec3 direction = -normalize(velocity);\n vec3 up = cross(forward, direction);\n vec3 right = cross(forward, up);\n forward = cross(right, up);\n mat3 matrix = mat3(right, up, forward);\n position = size * matrix * position;\n#endif\n vPosition = position + transform.xyz;\n\n vUVClamp = vec4(0,0,1,1);\n vUV = aUV;\n gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\n}"},1511:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\n\nin vec2 vUV;\nin vec3 vPosition;\nin vec3 vNormal;\nin vec4 vColor;\nin float vMaterial;\nout vec4 fragColor;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n\nuniform sampler2D uDiffuseMap;\nuniform sampler2D uGradientMap;\nuniform sampler2D uDisplacementMap;\n\nuniform EffectUniforms {\n uniform vec4 uUVTransform;\n uniform vec3 uColorAdjustment;\n#ifdef VERTICAL_MASK\n uniform vec4 uVerticalMask;\n#endif\n#ifdef HORIZONTAL_MASK\n uniform vec4 uHorizontalMask;\n#endif\n#ifdef FRESNEL\n uniform vec2 uFresnelMask;\n#endif\n#ifdef PANNING\n uniform vec2 uUVPanning;\n#endif\n#ifdef GREYSCALE\n uniform vec4 uUV2Transform;\n#ifdef PANNING\n uniform vec2 uUV2Panning;\n#endif\n#endif\n#ifdef DISPLACEMENT\n uniform vec4 uUV3Transform;\n uniform vec2 uUV3Panning;\n uniform float uDisplacementAmount;\n#endif\n#ifdef DISSOLVE\n uniform vec4 uDissolveColor;\n uniform vec3 uDissolveThreshold;\n#endif\n};\n\n#define TAU 6.283185307179586\nfloat linearizeDepth(){\n float z_ndc = gl_FragCoord.z * 2.0 - 1.0;\n //float linearDepth = (2.0 * near * far) / (far + near - z_ndc * (far - near));\n float linearDepth = uProjectionMatrix[2][3] / (uProjectionMatrix[2][2] + z_ndc);\n return linearDepth;\n}\nfloat projectDepth(in float z){\n float z_ndc = uProjectionMatrix[2][3] / z - uProjectionMatrix[2][2];\n return .5+.5*z_ndc;\n}\n\nvoid main(){\n vec2 uv = vUV;\n#ifdef HALF\n uv.y = abs(uv.y*2.-1.);\n#endif\n#ifdef POLAR\n uv=uv*2.-1.;uv=vec2(atan(uv.y,uv.x)/TAU+.5,length(uv));\n#endif\n vec2 uv0 = uUVTransform.xy + uv * uUVTransform.zw;\n#ifdef PANNING\n uv0 += uTime.x * uUVPanning.xy;\n#endif\n\n#ifdef DISPLACEMENT\n vec2 uv3 = uUV3Transform.xy + uv * uUV3Transform.zw;\n uv3 += uTime.x * uUV3Panning.xy;\n vec2 displacement = uDisplacementAmount*(texture(uDisplacementMap, uv3).xy*2.-1.);\n uv0 += displacement;\n#endif\n\n#ifdef GREYSCALE\n float grey = texture(uDiffuseMap, uv0).r;\n grey = pow(clamp(mix(1.-grey,grey,uColorAdjustment.y),0.,1.), uColorAdjustment.x)+uColorAdjustment.z;\n\n vec2 uv2 = uUV2Transform.xy + uv * uUV2Transform.zw;\n#ifdef PANNING\n uv2 += uTime.x * uUV2Panning.xy;\n#endif\n float grey2 = texture(uDiffuseMap, uv2).g;\n grey2 = pow(clamp(mix(1.-grey2,grey2,uColorAdjustment.y),0.,1.), uColorAdjustment.x)+uColorAdjustment.z;\n grey *= 2.0 * grey2;\n\n vec4 color = vec4(min(1.,grey));\n#else\n vec4 color = texture(uDiffuseMap, uv0);\n#endif\n\n#ifdef DISSOLVE\n color += max(0.,-uDissolveThreshold.x);\n#endif\n\n#ifdef VERTICAL_MASK\n color *= smoothstep(uVerticalMask.x,uVerticalMask.y,uv.y);\n color *= smoothstep(uVerticalMask.w,uVerticalMask.z,uv.y);\n#endif\n#ifdef HORIZONTAL_MASK\n color *= smoothstep(uHorizontalMask.x,uHorizontalMask.y,uv.x);\n color *= smoothstep(uHorizontalMask.w,uHorizontalMask.z,uv.x);\n#endif\n\n#ifdef FRESNEL\n vec3 position = vPosition;\n vec3 normal = normalize(vNormal);\n vec3 view = normalize(uEyePosition - position);\n float NdV = abs(dot(normal, view));\n color *= smoothstep(uFresnelMask.x,uFresnelMask.y,NdV);\n#endif\n\n float value = color.a;\n#ifdef GRADIENT\n#ifdef DISSOLVE\n color = texture(uGradientMap, vec2(1.-value,vColor.a));\n#else\n color = texture(uGradientMap, vec2(1.-value,uv.y));\n#endif\n#endif\n\n#ifdef DISSOLVE\n float cutoff = uDissolveThreshold.x + 1. - vColor.a;\n color = mix(color, uDissolveColor, smoothstep(-uDissolveThreshold.z,0.,cutoff-value));\n color.rgb *= vColor.rgb;\n color *= smoothstep(0.,uDissolveThreshold.y,value-cutoff);\n#else\n color *= vColor;\n#endif\n fragColor = color;\n\n#ifdef DEPTH_OFFSET\n gl_FragDepth = projectDepth(linearizeDepth() - DEPTH_OFFSET);\n#endif\n}"},2422:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\n\nin vec2 vUV;\nin vec4 vColor;\nin vec4 vMaterial;\n\nlayout(location=0) out vec4 fragColor;\nlayout(location=1) out vec4 fragNormal;\n\nuniform sampler2D uSampler;\nuniform vec2 uScreenSize;\nuniform float uScale;\n\nvec3 calculateNormal(in float height){\n float dhdx = dFdx(height) * uScreenSize.x;\n float dhdy = dFdy(height) * uScreenSize.y;\n vec3 normal = normalize(vec3(-dhdx, -dhdy, 1));\n return 0.5+0.5*normal;\n}\n\nvoid main(){\n fragColor = texture(uSampler, vUV);\n\n float height = fragColor.b;\n fragNormal = vec4(calculateNormal(height / uScale), height);\n}"},3002:(e,t,r)=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\n\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec3 aPosition;\nlayout(location=1) in vec3 aNormal;\nlayout(location=2) in vec2 aUV;\nlayout(location=3) in vec4 aColor;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\nuniform ModelUniforms {\n mat4 uModelMatrix;\n vec4 uColor;\n float uLayer;\n float uStartTime;\n};\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\nout vec4 vColor;\n\nuniform float uArrayMapLayers;\nuniform vec3 uVelocityMin;\nuniform vec3 uVelocityMax;\nuniform vec2 uAngularVelocity;\nuniform vec3 uGravity;\n\n#define TAU 6.283185307179586\nfloat hash11(uint n){\n\tn = (n << 13U) ^ n;\n n = n * (n * n * 15731U + 789221U) + 1376312589U;\n return float(n & uvec3(0x7fffffffU))/float(0x7fffffff);\n}\n"+r(4346)+"\nfloat solveQuadratic(float a, float b, float c){\n float d = b*b - 4.*a*c;\n if(d < 0.) return -1.;\n float t = -0.5 * (b + sign(b) * sqrt(d));\n return max(t / a, c / t);\n}\n\nvoid main(){\n vec3 position = aPosition; vec3 normal = aNormal;\n\n float elapsedTime = max(0.,uTime.x - uStartTime);\n uint seed = floatBitsToUint(uStartTime) ^ floatBitsToUint(aColor.b);\n vec3 velocity = vec3(\n mix(uVelocityMin.x, uVelocityMax.x, hash11(seed+=1U)),\n mix(uVelocityMin.y, uVelocityMax.y, hash11(seed+=1U)),\n mix(uVelocityMin.z, uVelocityMax.z, hash11(seed+=1U))\n );\n vec3 acceleration = uGravity;\n vec3 rotationAxis = normalize(cross(velocity, vec3(0,1,0)));\n float angularVelocity = mix(uAngularVelocity.x, uAngularVelocity.y, hash11(seed+=1U));\n float angularTime = 2.0;\n float angularDeceleration = -angularVelocity/angularTime;\n float at0 = min(angularTime, elapsedTime);\n \n float angle = at0 * angularVelocity + angularDeceleration*0.5*at0*at0;\n vec4 quaternion = quat(rotationAxis, angle);\n#ifdef RANDOM_ROTATION\n quaternion = qmul(qrandom(hash11(seed+=1U), hash11(seed+=1U), hash11(seed+=1U)), quaternion);\n#endif\n position = qrotate(quaternion, position);\n normal = qrotate(quaternion, normal);\n\n float timeToGround = solveQuadratic(acceleration.y, 2.*velocity.y, 2.*uModelMatrix[3][1]);\n float t0 = max(0., min(elapsedTime, timeToGround));\n float t1 = max(0., elapsedTime - timeToGround);\n vec3 velocity1 = vec3(.8*velocity.x, -.5 * (velocity.y + acceleration.y * t0), .8*velocity.z);\n position += velocity * t0 + .5*acceleration * t0*t0;\n position += velocity1 * t1 + .5*acceleration * t1*t1;\n\n vColor.rgb = vec3(1);\n vColor.a = mix(1.0, uArrayMapLayers, hash11(seed+=1U)) / uArrayMapLayers;\n\n vPosition = (uModelMatrix * vec4(position, 1.0)).xyz;\n vNormal = (uModelMatrix * vec4(normal, 0.0)).xyz;\n vUV = aUV;\n gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\n}"},308:(e,t,r)=>{e.exports=r(1552)+"\n"+r(1287)+"\n"+r(905)+"\n\nvoid main(){\n"+r(4380)+"\n\n float f0 = noise3D(worldPosition.xyz-uTime.x*vec3(0,2,0));\n float f1 = noise3D(worldPosition.xyz * 1.6 + (f0*2.-1.) - uTime.x*vec3(0,1,0));\n\n vec4 color = vec4(0.1,0,0.1,0.8);\n color += vec4(0.4,0.8,0.6,0.8) * smoothstep(0.0,1.0,f0);\n color += vec4(0.5,1.0,1.0,1.0) * smoothstep(0.5,1.0,f1);\n color *= smoothstep(0.5,0.2,length(objectPosition.xyz));\n color.rgb = mix(color.grb, color.rgb, vColor.r);\n color *= vColor.a;\n\n#ifdef ALPHA_CUTOFF\n if(color.a < ALPHA_CUTOFF) discard;\n#endif\n fragAlbedo = color;\n fragNormal = vec4(0,0,0, smoothstep(0.5,1.0,color.a));\n}"},1795:(e,t,r)=>{e.exports=r(1552)+"\n"+r(4950)+"\n\nfloat sdfBox(in vec2 p, in vec2 size){\n vec2 d = abs(p)-size;\n return length(max(d,0.0)) + min(max(d.x,d.y),0.0);\n}\nfloat glow(in float distance){return pow(max(0.,0.02/abs(distance)-0.1),0.8);}\n\nvoid main(){\n"+r(4380)+"\n\n#ifdef POLAR\n uv = uv*2.-1.;\n uv = vec2(.5+atan(uv.y,uv.x)/TAU,length(uv));\n uv = vec2(uv.x + 0.06*uTime.x, uv.y);\n#endif\n vec2 uv0 = uv*2.-1.;\n vec2 uv1 = vec2(round(uv0.x*4.)/4.,0);\n vec2 uv2 = round(uv0*8.)/8.;\n#ifdef POLAR\n float t0 = smoothstep(1.0+uDissolveEdge, 1.0, abs(uv0.y-vThreshold));\n float t1 = smoothstep(1.0+uDissolveEdge, 1.0, abs(uv0.y-vThreshold));\n float t2 = smoothstep(1.0+uDissolveEdge, 1.0, abs(uv0.y-vThreshold));\n#else\n float t0 = smoothstep(1.0+uDissolveEdge, 1.0, abs(abs(uv0.x)*2.-1.-vThreshold));\n float t1 = smoothstep(1.0+uDissolveEdge, 1.0, abs(abs(uv1.x)*2.-1.-vThreshold));\n float t2 = smoothstep(1.0+uDissolveEdge, 1.0, abs(abs(uv2.x)*2.-1.-vThreshold));\n#endif\n\n uv0.y -= 0.4*(1.0-t2)*(1.-2.*hash21(round(uv0 * 8.0)));\n\n float d0 = sdfBox(uv1-uv0, vec2(0.3/4.,0.4)*t1);\n float d1 = abs(uv0.y)-0.6;\n float d2 = sdfBox(uv1-uv0, vec2(0.1/4.,0.2) * t1);\n\n vec4 color = vec4(0);\n color.rgb += vec3(0.4,0.1,0.16) * t0 * glow(d0);\n color.rgb += vec3(0.4,0.1,0.16) * t0 * glow(d1);\n color.rgb += vec3(0.4,0.1,0.16) * t0 * glow(d2);\n color.a = smoothstep(0.0,1.0,color.r);\n color.rgb = mix(color.rgb,color.gbr*2.,1.-t0);\n#ifndef POLAR\n color *= smoothstep(1.,1.-0.25,abs(uv0.x));\n#endif\n color = min(color,vec4(1));\n\n fragAlbedo = vColor * color;\n fragNormal = vec4(0,0,0,smoothstep(0.75,1.0,fragAlbedo.a));\n}"},5865:e=>{e.exports="#version 300 es\nprecision highp float;\nin vec2 vUV;\nin vec3 vPosition;\nin vec4 vColor;\nin vec3 vNormal;\nin float vMaterial;\nout vec4 fragColor;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform vec4 uUVTransform;\nuniform sampler2D uSampler;\n\n#define TAU 6.283185307179586\nfloat hash13(in vec3 src) {\n const uint M = 0x5bd1e995u;\n uint h = 1190494759u;\n uvec3 v = floatBitsToUint(src);\n v *= M; v ^= v>>24u; v *= M;\n h *= M; h ^= v.x; h *= M; h ^= v.y; h *= M; h ^= v.z;\n h ^= h>>13u; h *= M; h ^= h>>15u;\n return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\n}\nfloat noise3D(in vec3 x){\n vec3 i = floor(x);\n vec3 f = fract(x);\n f = f*f*(3.0-2.0*f);\n return mix(mix(mix( hash13(i+vec3(0,0,0)), \n hash13(i+vec3(1,0,0)),f.x),\n mix( hash13(i+vec3(0,1,0)), \n hash13(i+vec3(1,1,0)),f.x),f.y),\n mix(mix( hash13(i+vec3(0,0,1)), \n hash13(i+vec3(1,0,1)),f.x),\n mix( hash13(i+vec3(0,1,1)), \n hash13(i+vec3(1,1,1)),f.x),f.y),f.z);\n}\nfloat noise3D(in vec3 uv, in vec3 period){\n vec3 i0 = floor(mod(uv, period));\n vec3 i1 = floor(mod(uv+vec3(1), period));\n vec3 f = fract(uv); f = f*f*(3.0-2.0*f);\n return mix(mix(mix( hash13(vec3(i0.x,i0.y,i0.z)), \n hash13(vec3(i1.x,i0.y,i0.z)),f.x),\n mix( hash13(vec3(i0.x,i1.y,i0.z)), \n hash13(vec3(i1.x,i1.y,i0.z)),f.x),f.y),\n mix(mix( hash13(vec3(i0.x,i0.y,i1.z)), \n hash13(vec3(i1.x,i0.y,i1.z)),f.x),\n mix( hash13(vec3(i0.x,i1.y,i1.z)), \n hash13(vec3(i1.x,i1.y,i1.z)),f.x),f.y),f.z);\n}\nfloat fbm(in vec3 uv, in int octaves){\n float total = 0.0, amplitude = 1.0;\n const mat2 r = mat2(1.6, 1.2, -1.2, 1.6);\n for(int i = 0; i < octaves; i++){\n total += .5*amplitude*noise3D(uv);\n uv.xy = r * uv.xy + 100.0;\n amplitude *= 0.5;\n }\n return total;\n}\nfloat fbm(in vec3 uv, in int octaves, in vec3 period){\n float total = 0.0, amplitude = 1.0;\n for(int i = 0; i < octaves; i++){\n total += .5*amplitude*noise3D(uv, period);\n uv = 2.0 * uv + 100.0;\n period *= 2.0;\n amplitude *= 0.5;\n }\n return total;\n}\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n float time = 4.0*uTime.x;\n#ifndef RADIAL\n uv = uv.yx;\n float fade = smoothstep(1.0, 0.8, abs(uv.x));\n float f0 = 1.-2.*fbm(vec3(uUVTransform.xy * uv + vec2(time,0), -.5*time), 4);\n f0 *= 1.-2.*noise3D(vec3(uUVTransform.xy * uv,f0)*vec3(2,0.25,3)+vec3(time,0,time));\n float d0 = abs(uv.y+0.5*f0);\n#else\n float fade = 1.0;\n uv = vec2(atan(uv.y,uv.x)/TAU+.5, length(uv));\n float f0 = 1.-2.*fbm(vec3(uUVTransform.xy * uv.xy + vec2(0,-time),-.5*time), 4, vec3(uUVTransform.xy,10));\n float d0 = abs(uv.y+0.5*f0)-0.5*smoothstep(0.1,.0,uv.y);\n#endif\n\n vec4 color = texture(uSampler, vec2(smoothstep(-0.25,1.0,d0), 0.0));\n fragColor = vColor * color * fade;\n}"},2784:e=>{e.exports="#version 300 es\nprecision highp float;\n\nin vec3 vPosition;\n#ifdef INSTANCED\nin mat4 vModel;\nin vec4 vUV;\nin vec4 vColor;\nin float vThreshold;\n#else\n#endif\n\nlayout(location=0) out vec4 fragAlbedo;\nlayout(location=1) out vec4 fragNormal;\n\nuniform sampler2D uPositionBuffer;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\nuniform float uGridSize;\n\n#define TAU 6.283185307179586\nfloat grid(in vec2 uv, in float tiles, in float width){\n uv = cos(TAU*(uv*tiles));\n return smoothstep(1.0-width,1.0,max(uv.x,uv.y));\n}\n\nvoid main(){\n ivec2 fragCoord = ivec2(gl_FragCoord.xy);\n vec4 position = texelFetch(uPositionBuffer, fragCoord, 0);\n if(position.a > 1.0) discard;\n vec3 center = vec3(vModel[3]);\n vec2 uv = (position.xz + uEyePosition.xz - center.xz) * uGridSize;\n\n float fade = max(abs(uv.x), abs(uv.y));\n float grid1 = max(0.0,cos(TAU * (fade - 0.4 * uTime.x)));\n float grid0 = grid(position.xz + uEyePosition.xz,0.5,mix(0.01,0.1,grid1)) * smoothstep(1.0,0.8,fade);\n vec3 color = mix(vec3(0.6,0.9,0.8),vec3(0.8,1.0,1.0), grid1);\n\n fragAlbedo = vec4(color,grid0);\n fragNormal = vec4(0);\n}"},4063:(e,t,r)=>{e.exports=r(1552)+"\n\nfloat hash11(in float u){\n uint n = floatBitsToUint(u);\n n = (n << 13U) ^ n;\n n = n * (n * n * 15731U + 789221U) + 1376312589U;\n return float( n & 0x7fffffffU)/float(0x7fffffff);\n}\n\nvoid main(){\n"+r(4380)+"\n\n uv = uv*2.-1.;\n const float rings = 6.0;\n vec2 polar = vec2(atan(uv.y,uv.x)/TAU+.5,length(uv));\n polar.y = pow(polar.y,0.8);\n \n float radius = floor(polar.y * rings)/rings;\n float r0 = hash11(floor(polar.y * rings));\n polar.x = fract(polar.x + uTime.x * mix(-0.2,0.2,r0));\n float r1 = hash11(floor(polar.x * (2.+8.*r0*radius)));\n polar.x = fract(polar.x - uTime.x * mix(-0.1,0.1,r1));\n float r2 = hash11(floor(polar.x * (2.+32.*r1*radius)));\n \n float l = fract(polar.y * rings);\n \n float alpha = smoothstep(1.0,0.8,l+.6*r1);\n alpha *= smoothstep(0.0,0.2,l-.2*r2);\n alpha *= step(1.0 / rings, radius) * step(polar.y,1.0);\n alpha *= step(.5+.5*sin(polar.x*TAU*(2.0+r1*8.0)),0.9);\n alpha = alpha + 4.0 * alpha * (1.0-alpha);\n \n vec3 color = alpha * mix(vec3(0.4,0.2,1), vec3(1,0.2,0.4), r0);\n \n fragAlbedo = vColor * vec4(color, alpha);\n fragNormal = vec4(0,0,0,smoothstep(0.8,1.6,fragAlbedo.a));\n}"},1671:(e,t,r)=>{e.exports=r(7154)+"\n\nvec3 hash(vec3 p){\n\tp = vec3( dot(p,vec3(127.1,311.7, 74.7)),\n\t\t\t dot(p,vec3(269.5,183.3,246.1)),\n\t\t\t dot(p,vec3(113.5,271.9,124.6)));\n\treturn -1.0 + 2.0*fract(sin(p)*43758.5453123);\n}\nfloat noise3D(in vec3 p){\n vec3 i = floor( p );\n vec3 f = fract( p );\n\tvec3 u = f*f*(3.0-2.0*f);\n return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0) ), f - vec3(0.0,0.0,0.0) ), \n dot( hash( i + vec3(1.0,0.0,0.0) ), f - vec3(1.0,0.0,0.0) ), u.x),\n mix( dot( hash( i + vec3(0.0,1.0,0.0) ), f - vec3(0.0,1.0,0.0) ), \n dot( hash( i + vec3(1.0,1.0,0.0) ), f - vec3(1.0,1.0,0.0) ), u.x), u.y),\n mix( mix( dot( hash( i + vec3(0.0,0.0,1.0) ), f - vec3(0.0,0.0,1.0) ), \n dot( hash( i + vec3(1.0,0.0,1.0) ), f - vec3(1.0,0.0,1.0) ), u.x),\n mix( dot( hash( i + vec3(0.0,1.0,1.0) ), f - vec3(0.0,1.0,1.0) ), \n dot( hash( i + vec3(1.0,1.0,1.0) ), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );\n}\nfloat fbm(in vec3 uv, in float period, in int layers){\n float f = 0.0, scale = 1.0;\n for(int i=0;i<layers;i++){\n f += scale * abs(noise3D(uv * period));\n scale *= 0.5;\n period *= 2.0;\n uv += f;\n }\n return f;\n}\n\nvoid main(){\n vec2 uv = vUV;\n vec3 normal = normalize(vNormal);\n vec3 view = normalize(uEyePosition - vPosition);\n float NdV = dot(normal, view);\n\n float n0 = fbm(vPosition + vec3(0,uTime.x,0), 1.6, 2);\n float n1 = fbm(vPosition - normal*n0*2.0 - 0.2*vec3(0,uTime.x,0), 2.6, 3);\n n0 = 2.0 * n0 * n0;\n n0 *= smoothstep(0.0,1.6,abs(NdV));\n n1 *= smoothstep(0.2,0.8,abs(NdV));\n\n vec4 color = vec4(0.01,0,0.02,0);\n color = mix(color, vec4(0.6,0.4,0.8,0.0), n1 * n1);\n color = mix(color, vec4(0.4,0.8,0.8,0.0), 2.0 * (1.0-n1) * n0);\n color = mix(color, vec4(0.08,0.32,0.22,0.2), min(8.0,0.04/n0-1.0));\n color.rgb = mix(color.grb, color.rgb, uColor.r);\n\n color *= 0.2+0.8*max(0.,dot(vec3(0,1,0),normal));\n\n#ifdef TRANSPARENT\n fragColor = color * vColor;\n#else\n float alpha = n1;\n const float uThresholdEdge = 0.25;\n float threshold = mix(1.0,-uThresholdEdge,uColor.a);\n color.rgb = mix(color.rgb, vec3(0.3,0.1,0.5), smoothstep(-uThresholdEdge,0.0,threshold - alpha));\n if(alpha <= threshold) discard; \n const float metallic = 0.0;\n fragPosition = vec4(vPosition - uEyePosition, uLayer);\n fragNormal = vec4(0,0,0, metallic);\n fragAlbedo = vec4(color.rgb,.5+.5*color.a);\n#endif\n}"},5311:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\n\nin vec3 vPosition;\nin vec3 vNormal; \nin vec2 vUV;\n\nlayout(location=0) out vec4 fragColor;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\nuniform ModelUniforms {\n mat4 uModelMatrix;\n vec4 uColor;\n float uLayer;\n float uStartTime;\n};\nuniform sampler2D uPositionBuffer;\nuniform sampler2D uAlbedoBuffer;\n\n#define TAU 6.283185307179586\nfloat hash13(in vec3 uv){\n uvec3 q = floatBitsToUint(uv);\n\tq *= uvec3(1597334673U, 3812015801U, 2798796415U);\n\tuint n = (q.x ^ q.y ^ q.z) * 1597334673U;\n\treturn float(n) * (1.0 / float(0xffffffffU));\n}\nfloat noise3D(in vec3 x){\n vec3 i = floor(x);\n vec3 f = fract(x);\n f = f*f*(3.0-2.0*f);\n return mix(mix(mix(hash13(i+vec3(0,0,0)), \n hash13(i+vec3(1,0,0)),f.x),\n mix(hash13(i+vec3(0,1,0)), \n hash13(i+vec3(1,1,0)),f.x),f.y),\n mix(mix(hash13(i+vec3(0,0,1)), \n hash13(i+vec3(1,0,1)),f.x),\n mix(hash13(i+vec3(0,1,1)), \n hash13(i+vec3(1,1,1)),f.x),f.y),f.z);\n}\nfloat fbm(in vec3 p, in int layers){\n float f = 0.0, scale = 0.5;\n for(int i=0;i<layers;i++){\n float n = noise3D(p);\n f += scale * abs(n*2.-1.);\n scale *= 0.5;\n p = p * 1.6;\n }\n return f;\n}\n\nvec3 saturation(vec3 rgb, float adjustment){\n const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n vec3 intensity = vec3(dot(rgb, W));\n return mix(intensity, rgb, adjustment);\n}\nfloat sine(in float x){return .5-.5*cos(x*TAU);}\n\nvoid main(){\n vec3 normal = normalize(vNormal);\n vec3 view = normalize(uEyePosition - vPosition);\n float NdV = dot(normal, view);\n\n ivec2 fragCoord = ivec2(gl_FragCoord.xy);\n vec2 uv = vec2(gl_FragCoord.xy) / vec2(textureSize(uAlbedoBuffer, 0));\n vec4 fragPosition = texelFetch(uPositionBuffer, fragCoord, 0);\n vec3 viewNormal = (uViewMatrix * vec4(normal, 0.0)).xyz;\n\n vec3 center = uModelMatrix[3].xyz;\n float radius = length(vPosition - center);\n vec3 relativePosition = fragPosition.xyz + uEyePosition - center;\n float distance = radius - length(relativePosition);\n if(distance <= 0.0) discard;\n\n vec2 uvOffset = viewNormal.rg * 0.24 * sine(min(1.0,distance*0.4));\n uvOffset *= min(1.0, 4.0 / length(relativePosition));\n vec4 dstColor = texture(uAlbedoBuffer, uv + uvOffset);\n\n vec3 color = saturation(dstColor.rgb, smoothstep(1.0,0.0,distance*0.4));\n\n float alpha = 1.0;\n fragColor = uColor * vec4(alpha * color, alpha);\n}"},1470:e=>{e.exports="#version 300 es\nprecision highp float;\nprecision highp int;\n\nin vec3 vPosition;\nin vec3 vNormal; \nin vec2 vUV;\n\nlayout(location=0) out vec4 fragColor;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\nuniform ModelUniforms {\n mat4 uModelMatrix;\n vec4 uColor;\n float uLayer;\n float uStartTime;\n};\nuniform sampler2D uPositionBuffer;\n#ifdef DISPLACEMENT\nuniform sampler2D uAlbedoBuffer;\n#endif\n\n#define TAU 6.283185307179586\nvec3 hash33(vec3 p){\n\tp = vec3( dot(p,vec3(127.1,311.7, 74.7)),\n\t\t\t dot(p,vec3(269.5,183.3,246.1)),\n\t\t\t dot(p,vec3(113.5,271.9,124.6)));\n\treturn -1.0 + 2.0*fract(sin(p)*43758.5453123);\n}\nfloat noise3D(in vec3 p){\n vec3 i = floor( p );\n vec3 f = fract( p );\n\tvec3 u = f*f*(3.0-2.0*f);\n return mix( mix( mix( dot( hash33( i + vec3(0.0,0.0,0.0) ), f - vec3(0.0,0.0,0.0) ), \n dot( hash33( i + vec3(1.0,0.0,0.0) ), f - vec3(1.0,0.0,0.0) ), u.x),\n mix( dot( hash33( i + vec3(0.0,1.0,0.0) ), f - vec3(0.0,1.0,0.0) ), \n dot( hash33( i + vec3(1.0,1.0,0.0) ), f - vec3(1.0,1.0,0.0) ), u.x), u.y),\n mix( mix( dot( hash33( i + vec3(0.0,0.0,1.0) ), f - vec3(0.0,0.0,1.0) ), \n dot( hash33( i + vec3(1.0,0.0,1.0) ), f - vec3(1.0,0.0,1.0) ), u.x),\n mix( dot( hash33( i + vec3(0.0,1.0,1.0) ), f - vec3(0.0,1.0,1.0) ), \n dot( hash33( i + vec3(1.0,1.0,1.0) ), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );\n}\nfloat fbm(in vec3 p, in int layers){\n float f = 0.0, scale = 1.0;\n for(int i=0;i<layers;i++){\n f += scale * abs(noise3D(p));\n scale *= 0.5;\n p *= 1.8;\n }\n return f;\n}\n\nvoid main(){\n vec3 position = vPosition;\n vec3 normal = normalize(vNormal);\n vec3 view = normalize(uEyePosition - position);\n float NdV = dot(normal, view);\n\n float n = fbm(position + vec3(0,2.*uTime.x,0), 4);\n\n#ifdef DISPLACEMENT\n vec3 viewNormal = (uViewMatrix * vec4(normal, 0.0)).xyz;\n float fresnel = smoothstep(0.4,1.0,NdV*NdV);\n vec2 distortion = fresnel * 0.1 * viewNormal.rg;\n distortion *= 20.0 * uColor.a * n;\n\n vec2 uv = vec2(gl_FragCoord.xy) / vec2(textureSize(uAlbedoBuffer, 0));\n uv += distortion;\n fragColor = texture(uAlbedoBuffer, uv);\n fragColor.rgb *= mix(vec3(1),uColor.rgb,fresnel);\n#else\n ivec2 fragCoord = ivec2(gl_FragCoord.xy);\n vec4 fragPosition = texelFetch(uPositionBuffer, fragCoord, 0);\n float distance = length(fragPosition.xyz + uEyePosition - position);\n\n float edge = smoothstep(1.0,0.0,NdV)*smoothstep(-0.5,0.0,NdV);\n edge += smoothstep(0.5,0.0,distance);\n\n vec3 color = vec3(0.0,0.1,0.1);\n color = mix(color, vec3(0.4,0.6,0.6), smoothstep(0.5,0.0,n));\n color = mix(color, vec3(0.6,0.8,0.8), smoothstep(0.2,0.0,n));\n float wave = smoothstep(0.6,1.0,sin(TAU * (0.2*position.y + 0.5*n) + 2.*uTime.x));\n color *= mix(edge,1.0,wave);\n\n fragColor = uColor * vec4(color,0.1*edge);\n#endif\n}"},7718:(e,t,r)=>{e.exports=r(1552)+"\n"+r(1287)+"\n"+r(905)+"\n\nfloat fbm(in vec2 x, in int octaves, in vec2 period) {\n\tfloat v = 0.0, a = 0.5, m = 0.0;\n\tvec2 shift = vec2(100);\n const mat2 rot = mat2(cos(0.4), sin(0.4), -sin(0.4), cos(0.4));\n\tfor(int i = 0; i < octaves; ++i){\n m += a;\n\t\tv += a * noise2D(x * period, period, 0.0);\n x += shift;\n shift = rot * shift;\n\t\ta *= 0.5;\n period *= 2.0;\n\t}\n\treturn v/m;\n}\n\nvoid main(){\n"+r(4380)+"\n\n uv = uv*2.-1.;\n uv = vec2(atan(uv.y,uv.x)/TAU+.5,length(uv));\n \n float f0 = fbm(uv - .01*vec2(uTime.x,uTime.x), 2, vec2(10,4));\n f0 += smoothstep(0.4,.0,uv.y);\n f0 -= vThreshold;\n float f1 = fbm(uv + 0.5*f0 - vec2(uv.y - .1*uTime.x,0), 2, vec2(8,4));\n float f2 = fbm(uv + vec2(f1,f0), 2, vec2(12,6));\n f2 += smoothstep(0.4,.0,uv.y) + max(0.,f1-f0);\n \n f2 *= smoothstep(1.0,0.8,uv.y*(0.6+f1));\n\n vec4 color = vec4(0);\n color.rgb = mix(vec3(1.3,1.2,1.6), color.rgb, pow(smoothstep(.0,.9,f2),2.0));\n color.rgb += vec3(0.42,0.4,0.36) * pow(smoothstep(0., 1., f0*f2+f1*f0),2.0);\n color.rgb = mix(color.rgb, vec3(0.6,0,0.2)*f0, vThreshold);\n color.rgb *= pow(f1*f2*f0+f2, 2.0); \n color.a = smoothstep(0.0,0.2,color.r);\n color *= smoothstep(1.0,0.5,uv.y);\n\n#ifdef ALPHA_CUTOFF\n if(color.a < ALPHA_CUTOFF) discard;\n#endif\n fragAlbedo = color;\n fragNormal = vec4(0,0,0, smoothstep(0.2,0.8,f2*f0));\n}"},6071:e=>{e.exports="#version 300 es\nprecision highp float;\n\nin vec2 vUV;\nin vec4 vUVClamp;\nin vec2 vLife;\nin vec3 vPosition;\n\nout vec4 fragColor;\n\nuniform sampler2D uSampler;\nuniform sampler2D uGradient;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\n\nvoid main(void){\n vec2 uv = vUV.yx;\n float time = -uTime.x * 1.6 + 1891.87 * vLife.y;\n uv.x = mix(.5+2.0*(uv.x-.5), uv.x, smoothstep(0.0,0.5,uv.y));\n float n0 = texture(uSampler, 0.2*(uv+0.7*vLife.y) + vec2(0,0.05*time)).r;\n float n1 = texture(uSampler, 0.5*(uv+0.9*vLife.y) + vec2(0,0.2*time + 0.2*n0)).r;\n float n2 = texture(uSampler, 1.0*(uv+0.5*vLife.y)*mix(0.8,1.0,n1) + vec2(0,0.5*time - 0.4*n0)).r;\n \n uv=vUV*2.-1.;\n float fade = pow(4.*vLife.x*(1.-vLife.x)-1.,2.);\n float n = pow(max(0.,length(uv) + n2 + fade),4.0);\n n = max(0.,smoothstep(0.6,0.0,n)-n);\n vec4 color = vec4(1.5*n,1.5*n*n,n*n*n,0.2*n).brga;\n\n fragColor = color;\n}"},4102:e=>{e.exports="#version 300 es\nprecision highp float;\n\nin vec2 vUV;\nin vec3 vNormal;\nin vec3 vPosition;\n\nlayout(location=0) out vec4 fragAlbedo;\nlayout(location=1) out vec4 fragNormal;\nlayout(location=2) out vec4 fragPosition;\n\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n\nuniform sampler2D uDiffuseMap;\n\nvoid main(void){\n vec4 diffuse = texture(uDiffuseMap, vUV);\n if(diffuse.a < 0.1) discard;\n fragPosition = vec4(vPosition - uEyePosition,8);\n fragNormal = vec4(normalize(vNormal),0);\n fragAlbedo = vec4(diffuse.rgb,0.5);\n}"},5407:e=>{e.exports="#version 300 es\nprecision highp float;\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec4 aLifetime;\nlayout(location=1) in vec4 aSize;\nlayout(location=2) in vec4 aTransform;\n#ifndef POINT\nlayout(location=3) in vec3 aPosition;\nlayout(location=4) in vec2 aUV;\n#endif\n\nout vec2 vUV;\nout vec3 vNormal;\nout vec3 vPosition;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\n\nvoid main(){\n#ifdef VIEWPLANE\n vec3 forward = -vec3(uViewMatrix[0][2], uViewMatrix[1][2], uViewMatrix[2][2]);\n#else\n vec3 forward = normalize(aTransform.xyz - uEyePosition);\n#endif\n const vec3 up = vec3(0,1,0);\n const vec3 wind = normalize(vec3(1,0,0.4));\n vec3 right = cross(forward, up);\n\n vec3 position = aSize.x * (right * aPosition.y + up * aPosition.x);\n position += wind * aUV.x * 0.2*sin(2.0*uTime.x + dot(aTransform.xyz, wind));\n\n#ifdef FRAMES\n float uvSize = 1.0/aSize.w; float uvFrame = mod(floor(aLifetime.z * aSize.w * aSize.w),aSize.w*aSize.w);\n vec2 uvTile = vec2(mod(uvFrame, aSize.w), floor(uvFrame * uvSize)) * uvSize;\n vUV = uvTile + uvSize * aUV;\n#else\n vUV = aUV;\n#endif\n vPosition = position + aTransform.xyz;\n vNormal = normalize(-cross(up, right));\n gl_Position = uViewProjectionMatrix * vec4(vPosition, 1.0);\n}"},5743:e=>{e.exports="#version 300 es\nprecision highp float;\nlayout(std140, column_major) uniform;\n\nlayout(location=0) in vec3 aTransform;\n\nout vec2 vLife;\nout vec3 vPosition;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\nuniform vec3 uArea;\nuniform float uSize;\nuniform vec3 uCenter;\n\nfloat hash11(uint n){\n n = (n << 13U) ^ n;\n n = n * (n * n * 15731U + 789221U) + 1376312589U;\n return float( n & uvec3(0x7fffffffU))/float(0x7fffffff);\n}\nvec3 hash13(uint n){\n\tn = (n << 13U) ^ n;\n n = n * (n * n * 15731U + 789221U) + 1376312589U;\n uvec3 k = n * uvec3(n,n*16807U,n*48271U);\n return vec3( k & uvec3(0x7fffffffU))/float(0x7fffffff);\n}\nfloat noise1D(in float p){\n uint i = uint(floor(p));\n float f = fract(p);\n\tfloat u = f*f*(3.0-2.0*f);\n float g0 = hash11(i+0u)*2.0-1.0;\n float g1 = hash11(i+1u)*2.0-1.0;\n return 2.4*mix( g0*(f-0.0), g1*(f-1.0), u);\n}\n\nvoid main(){\n vec3 random = hash13(uint(gl_VertexID));\n\n vec3 relative = aTransform.xyz - uCenter + 0.5*uArea;\n relative.xz = mod(relative.xz, uArea.xz);\n vec3 position = uCenter - 0.5*uArea + relative;\n\n float t = 0.1 * uTime.x;\n position += 0.1 * uArea * vec3(\n noise1D(random.x + t + abs(aTransform.x)),\n noise1D(random.y + t + abs(aTransform.y)),\n noise1D(random.z + t + abs(aTransform.z))\n );\n\n vLife = vec2(fract(t + random.x), 0.0);\n vPosition = position;\n gl_Position = uViewProjectionMatrix * vec4(position, 1.0);\n gl_PointSize = max(1.0, uSize / gl_Position.w);\n}"},7685:e=>{e.exports="#version 300 es\nprecision highp float;\nin vec2 vUV;\nin vec2 vLife;\nin vec3 vPosition;\nout vec4 fragColor;\n\nuniform sampler2D uSampler;\nuniform sampler2D uGradient;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\n\n#define TAU 6.283185307179586\nfloat sineNoise(vec2 uv, int layers, float shift){\n vec2 p = vec2(uv); float v = 0.0;\n\tfor(int i=0;i<layers;i++){\n\t\tfloat t = shift * (.75+.25*sin(float(i+1)*43758.5453));\n uv.y -= t;\n\t\tp = uv + vec2(cos(t - p.x) + sin(t + p.y), sin(t - p.y) + cos(t + p.x));\n v += 1.0/length(1.0/vec2(sin(p.x+t), cos(p.y+t)));\n\t}\n v = smoothstep(1.0,0.0,v / float(layers));\n return pow(v,1.4);\n}\n\nvoid main(void){\n vec2 uv = vUV;\n\n float alpha = sineNoise(uv*TAU, 4, 411.37+uTime.x+0.2*vPosition.y);\n vec4 color = vec4(mix(smoothstep(0.0,0.8,alpha), smoothstep(0.2,1.0,alpha), vLife.x));\n\n#ifdef GRADIENT\n color = texture(uGradient, vec2(vLife.x, color.a));\n#else\n color *= 4.*vLife.x*(1.-vLife.x);\n#endif\n#ifdef MASK\n color *= smoothstep(1.0,0.5,length(2.*uv-1.));\n#endif\n fragColor = color;\n}"},6866:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n\n uv = abs(uv);\n float x0 = 1.0-uv.x*uv.x;\n float x1 = 1.0-uv.x;\n float y0 = mix(pow(1.0-uv.y,8.0), pow(1.0-uv.y,2.0), x1*x1);\n float alpha = smoothstep(0.0, 1.0, x0*y0);\n\n fragColor = uColor * alpha;\n}"},2654:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n\n float alpha = 1.0-pow(length(uv),4.0);\n \n fragColor = uColor * alpha;\n}"},6487:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n\n float alpha = pow(max(0.0, 1.0-length(uv)),2.0);\n \n fragColor = uColor * alpha;\n}"},6282:(e,t,r)=>{e.exports=r(1765)+"\n"+r(5404)+"\n"+r(8812)+"\n"+r(4950)+"\n"+r(905)+"\n\nfloat fbm(in vec2 x, in int octaves, in vec2 period, float seed) {\n\tfloat v = 0.0, a = 1.0;\n\tvec2 shift = vec2(100);\n const mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\n\tfor(int i = 0; i < octaves; ++i){\n\t\tv += 0.5 * a * noise2D(x * period, period,seed);\n x += shift;\n shift = rot * shift;\n\t\ta *= 0.5;\n period *= 2.0;\n\t}\n\treturn v;\n}\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n \n vec2 uvp = polar(uv);\n uvp.x += 0.08*(1.-2.*noise2D(uvp.yx*vec2(4,8)+12.4, vec2(4,8),0.0));\n float width = pow(mix(1.2,0.0,uvp.y),4.0);\n float f0 = smoothstep(1.0-width,1.0,.5+.5*cos(uvp.x*TAU*12.0));\n f0 = max(1.2*f0, 1.4*fbm(vec2(64.0, uvp.x), 4, vec2(1e3,48),0.0));\n float alpha = smoothstep(0.0, 1.0, f0 - uvp.y);\n#ifdef NORMAL_MAP\n float height = alpha * -12.8;\n fragColor = vec4(encodeNormal(height, smoothstep(0.0,0.8,alpha)), alpha);\n#else\n fragColor = vec4(1) * alpha;\n#endif\n}"},590:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n\n float alpha = 0.5*(1.0/length(uv)-1.0);\n\n fragColor = uColor * alpha;\n}"},9917:(e,t,r)=>{e.exports=r(1765)+"\n"+r(1287)+"\n"+r(905)+"\n\nfloat lightning(in vec2 uv, in float width, in float seed){\n float b = \n (noise1D(uv.x * 4.0, 4.0, seed)-.5)*0.25+\n (noise1D(uv.x * 8.0, 8.0, seed)-.5)*0.1+\n (noise1D(uv.x * 24.0, 24.0, seed)-.5)*0.05;\n \n width *= smoothstep(0.5, 0.4, abs(uv.x));\n\n float l = .000025+(uv.x+.5)*.00001;\n float m = .0005/smoothstep(0., l*25e3 * width, abs(b-uv.y) + pow(0.4 * abs(uv.x), 2.4));\n\n return m;\n}\n\nuniform vec2 uTiles;\nuniform vec4 uColor;\n\nvoid main(){\n float seed = floor(vUV.x * uTiles.x) + floor(vUV.y * uTiles.y) * uTiles.x;\n vec2 uv = fract(vUV * uTiles)*2.-1.;\n\n float weight = lightning(uv * 0.5, 2.0, seed);\n vec3 color = vec3(0.2,0.2,0.4) * min(4.8,weight);\n float alpha = mix(color.b, 0.0, smoothstep(1.0,2.0,color.b));\n\n fragColor = uColor * vec4(color,alpha);\n}"},2676:(e,t,r)=>{e.exports=r(1765)+"\n"+r(1287)+"\n"+r(905)+"\n\nfloat fbm(in vec2 uv, int octaves){\t\n\tfloat a=.5,v=0.;\n const mat2 r = mat2(1.6,1.2,-1.2,1.6);\n\tfor(int i=0;i<octaves;i++){\n\t\tv+=a*noise2D(uv);\n\t\ta*=.5; uv*=r;\n\t}\n\treturn v;\n}\n\nuniform vec2 uTiles;\nuniform vec4 uColor;\n\nvoid main(){\n float seed = floor(vUV.x * uTiles.x) + floor(vUV.y * uTiles.y) * uTiles.x;\n vec2 uv = fract(vUV * uTiles)*2.-1.;\n \n float d0 = length(uv);\n float f0 = fbm(uv * 8.0+seed*184.32, 6);\n float f1 = fbm(uv * 16.0 + 4.0*(f0*2.-1.)+seed*928.19, 4);\n vec4 color = vec4(0);\n color += vec4(0.4,0.4,0.3,0.8) * smoothstep(-1.0,1.0,f0*f0-d0);\n color += vec4(0.5,0.4,0.2,0.8) * smoothstep(-0.5,0.8, f0 * f1 - d0);\n color -= vec4(0.3,0.3,0.2,0.0) * smoothstep(0.0,0.4,f0-d0);\n\n fragColor = uColor * color;\n}"},7143:(e,t,r)=>{e.exports=r(1765)+"\n"+r(5404)+"\n"+r(1287)+"\n"+r(905)+"\n\nfloat fbm(in vec2 uv, int octaves){\t\n\tfloat a=.5,v=0.;\n\tfor(int i=0;i<octaves;i++){\n float r = noise2D(uv);\n\t\tv+=a*abs(r*2.-1.);\n\t\ta*=.5;uv=uv*2.+r+100.;\n\t}\n\treturn v;\n}\n\nuniform vec2 uTiles;\nuniform vec4 uColor;\n\nvoid main(){\n float seed = floor(vUV.x * uTiles.x) + floor(vUV.y * uTiles.y) * uTiles.x;\n vec2 uv = fract(vUV * uTiles)*2.-1.;\n \n uv = uv*.5+.5;\n float f0 = .5-fbm(uv*vec2(4,8)+seed*184.32, 4);\n float f1 = .5-fbm(uv*vec2(6,12)+f0+seed*928.19, 2);\n float alpha = smoothstep(-0.8,0.4, f0-abs(uv.y*2.-1.));\n alpha *= smoothstep(0.2,1.0,f1+1.0-uv.x);\n alpha *= smoothstep(0.0,0.2,pow(uv.x,0.6)-abs(uv.y-.5));\n vec4 color = vec4(1.4*alpha,1.0*alpha*alpha,2.0*alpha*f0,alpha);\n color.rgb = .2+saturation(color.rgb, f1);\n\n fragColor = uColor * color;\n}"},8640:(e,t,r)=>{e.exports=r(1765)+"\n"+r(5404)+"\n\nuniform vec2 uRadius;\nuniform vec2 uSegments;\nuniform vec4 uColor;\nuniform vec2 uAngle;\nuniform vec4 uStrokeColor;\nuniform float uStrokeWidth;\n\nvoid main(){\n vec2 uv = vUV*2.-1.;\n vec2 uvp = polar(uv);\n float d = max(uRadius.x - uvp.y, uvp.y - uRadius.y);\n uvp.x = max(0.0, uvp.x * uAngle.y + 1.0 - uAngle.y);\n float angle = TAU * (round(uvp.x * uSegments.y)/uSegments.y - 0.25);\n uv = cartesian(uvp);\n uv *= rotate(angle);\n d = max(d, uAngle.x-abs(uv.x)-step(0.0,uv.y));\n \n vec4 color = uColor * step(d, 0.0);\n color = mix(uStrokeColor, color, smoothstep(0.0, uStrokeWidth, abs(d)));\n color *= step(ceil(uvp.x * uSegments.y), uSegments.x);\n\n if(color.a <= 0.0 || uSegments.x < 1.0) discard;\n fragColor = color;\n}"},4241:(e,t,r)=>{e.exports=r(1765)+"\n"+r(5404)+"\n"+r(4950)+"\n"+r(905)+"\n\nfloat fbm(in vec2 x, in int octaves, in vec2 period, float seed) {\n\tfloat v = 0.0, a = 1.0;\n\tvec2 shift = vec2(100);\n const mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\n\tfor(int i = 0; i < octaves; ++i){\n\t\tv += 0.5 * a * noise2D(x * period, period,seed);\n x += shift;\n shift = rot * shift;\n\t\ta *= 0.5;\n period *= 2.0;\n\t}\n\treturn v;\n}\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n vec2 uvp = polar(uv);\n\n#if defined(OUTER)\n float f0 = fbm(vec2(0.0, uvp.x), 4, vec2(1e3,36), 0.0);\n float y0 = mix(0.5,0.75,f0);\n float alpha = smoothstep(1.0-y0,0.0,abs(uvp.y-y0)) * f0 * 1.5;\n#elif defined(INNER)\n float f0 = 3.0 * fbm(vec2(0.0, uvp.x), 4, vec2(1e3,48), 0.0);\n f0 = max(0.,mix(uvp.y - f0*f0, 1.2, uvp.y));\n float alpha = smoothstep(1.0,0.9,uvp.y) * f0;\n alpha = pow(alpha, 1.6);\n#else\n float f0 = 2.0*fbm(vec2(0.0, uvp.x), 4, vec2(1e3,36), 0.0);\n f0 += smoothstep(1.0, -1.0, uvp.y - max(0.0,0.5-f0));\n float alpha = smoothstep(0.0, 1.0, f0 - 1.5*uvp.y);\n#endif\n\n fragColor = uColor * alpha;\n}"},2863:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform vec4 uColor;\nuniform vec2 uSize;\nuniform float uRadius;\n\nfloat rectSDF(vec2 uv, vec2 size, float r){\n vec2 d = abs(uv) - size + vec2(r);\n return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - r; \n}\n\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n\n float distance = rectSDF(uv, uSize, uRadius);\n#ifdef FRAME\n float alpha = 4.*smoothstep(0.08,0.,abs(distance))+smoothstep(0.1,0.,distance);\n#else\n float alpha = 1.0-smoothstep(0.0, 1.0 - uSize.x, distance);\n#endif\n\n fragColor = uColor * alpha;\n}"},1223:(e,t,r)=>{e.exports=r(1765)+"\n"+r(5404)+"\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n\n const float edge = 0.02;\n vec2 uvp = polar(uv);\n uvp.y *= max(abs(uv.x),abs(uv.y)) * 1.2;\n float outer = smoothstep(.9,.9-edge,uvp.y)*smoothstep(.7-edge,.7,uvp.y);\n outer *= smoothstep(.7,.7-edge,abs(fract(uvp.x*4.)*2.-1.));\n float plus = smoothstep(.04+edge,.04,min(abs(uv.x),abs(uv.y)));\n plus = max(0., plus - smoothstep(.04,.04-edge,uvp.y));\n float inner = smoothstep(.3,.3-edge,uvp.y)*smoothstep(.2-edge,.2,uvp.y);\n inner = max(0., inner - smoothstep(.1+edge,.1,min(abs(uv.x),abs(uv.y))));\n float alpha = plus + outer + inner;\n\n fragColor = uColor * alpha;\n}"},2646:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n\n float distance = max(0.0, 1.0-length(uv));\n float alpha = pow(smoothstep(0.0,0.1,distance) * smoothstep(0.5,0.0,distance), 1.4);\n\n fragColor = uColor * alpha;\n}"},3421:(e,t,r)=>{e.exports=r(1765)+"\n"+r(5404)+"\n"+r(8812)+"\n"+r(1287)+"\n"+r(905)+"\n"+r(8924)+"\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n vec2 uvp = polar(uv);\n\n vec2 uv0 = vec2(max(0.5,pow(uvp.y,0.1)), uvp.x);\n uv0.x += 0.01 * abs(noise1D(uvp.x*40.0, 40.0, 0.0));\n vec4 w = voronoi(uv0, vec2(24,16), 0.6, 0.1, 0.0);\n float e0 = mix(.1, .0, pow(uvp.y, .1));\n float edge = smoothstep(e0+0.18, e0, w.x) * smoothstep(1.0,0.8,uvp.y);\n#ifdef NORMAL_MAP\n float alpha = smoothstep(-0.5,2.0,2.0*uvp.y-edge*noise1D(uvp.x*32.0, 32.0, 0.0));\n float height = 1.0 - pow(edge, 4.0);\n fragColor = vec4(encodeNormal(height, smoothstep(0.0,0.5,edge)), alpha);\n#else\n vec3 color = vec3(0.0);\n color = mix(color, vec3(0.15,0.10,0.20), edge);\n color = mix(color, vec3(0.30,0.20,0.40), smoothstep(0.7,1.0,edge));\n color = mix(color, vec3(1.00,0.20,0.50), smoothstep(0.9,1.0,edge));\n color = mix(color, vec3(1.20,0.80,1.00), smoothstep(0.99,1.0,edge));\n\n float alpha = mix(edge * edge, 0.0, smoothstep(0.95,1.0,edge));\n\n fragColor = vec4(color, alpha);\n#endif\n}"},6540:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n\n uv = abs(uv);\n uv += mix(0.0,-0.16*(1.0-max(uv.x,uv.y)),max(uv.x,uv.y));\n float sparkle = max(0.0, 1.0 - (16.0*uv.x*uv.y + 0.8*(uv.x+uv.y)));\n sparkle = pow(1.0/(1.0-sparkle),0.2) - 1.0;\n float alpha = sparkle * 2.0;\n\n fragColor = uColor * alpha;\n}"},825:(e,t,r)=>{e.exports=r(1765)+"\n"+r(4950)+"\n"+r(905)+"\n\nfloat fbm(in vec2 uv, in int octaves, in vec2 period, float seed) {\n\tfloat v = 0.0, a = 1.0;\n\tvec2 shift = vec2(100);\n const mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\n\tfor(int i = 0; i < octaves; ++i){\n\t\tv += 0.5 * a * noise2D(uv * period, period, seed);\n uv += shift;\n shift = rot * shift;\n\t\ta *= 0.5;\n period *= 2.0;\n\t}\n\treturn v;\n}\n\nuniform vec2 uTiles;\nuniform vec4 uColor;\n\nvoid main(){\n float seed = floor(vUV.x * uTiles.x) + floor(vUV.y * uTiles.y) * uTiles.x;\n vec2 uv = fract(vUV * uTiles)*2.-1.;\n \n uv.x = pow(.5+.5*uv.x,0.5)*2.-1.; uv.y *= 0.8;\n float f0 = fbm(uv,4,vec2(2,4),seed);\n float f1 = fbm(uv + 0.5*f0,2,vec2(2,6),seed);\n float alpha = smoothstep(0.0,-4.*f1,1.2*uv.x+f0-2.0*(1.0-abs(uv.y)));\n alpha *= smoothstep(1.6,0.8,-uv.x + f1 + 2.0*abs(uv.y));\n\n fragColor = uColor * alpha;\n}"},5695:(e,t,r)=>{e.exports=r(1765)+"\n"+r(8812)+"\n\nvec3 fractal(in vec2 z, in float c, in float width, float radius, int layers){\n float minit=0.;\n\tfloat o,ot2,ot=ot2=1000.;\n\tfor (int i=0; i<layers; i++) {\n\t\tz=abs(z)/clamp(dot(z,z),.1,.5)-c;\n float l=length(z);\n o=min(max(abs(min(z.x,z.y)),-l+radius),abs(l-radius));\n\t\tot=min(ot,o);\n\t\tot2=min(l*.1,ot2);\n\t\tminit=max(minit,float(i)*(1.-abs(sign(ot-o))));\n\t}\n float w=width*minit*2.;\n return vec3(minit/float(layers),(w-ot2)/w,1.*(w-ot)/w);\n}\n\nvoid main(){\n vec2 uv = vUV*2.-1.;\n vec2 uv0 = uv * 0.5 * 0.16;\n \n vec2 f0 = fractal(uv0, 1.2, .01, 0.2, 4).gb;\n float f1 = fractal(uv0, 1.2, 1.0, 0.0, 6).r;\n float f2 = fractal(uv0, 0.8, 1.0, 0.4, 3).r;\n float f3 = fractal(uv0, 1.0, 1.0, 0.1, 5).r;\n\n vec3 color = vec3(0);\n color += 0.6 * vec3(0.2,0.3,0.5) * smoothstep(0.2,1.0,f2/f1);\n color += 0.6 * vec3(0.9,0.5,0.6) * smoothstep(2.0,4.0,f2/f3);\n color = mix(color, vec3(0.2,0.6,0.7), smoothstep(0.2,1.0,f0.y));\n color = mix(color, vec3(1.0,0.6,0.7), smoothstep(0.2,1.0,f0.x));\n\n float edge = smoothstep(1.0,0.8,max(abs(uv.x),abs(uv.y))+min(f1,f2));\n\n#ifdef NORMAL_MAP\n float alpha = 0.5*max(abs(uv.x),abs(uv.y))+0.5*smoothstep(-4.0,4.0,f0.y + f0.x);\n float height = (1.0-.4*max(-1e3,f0.y))*smoothstep(0.5,0.0,f0.x);\n fragColor = vec4(encodeNormal(height, edge), alpha);\n#else\n color *= edge;\n float alpha = .8*smoothstep(0.75, 1.0, length(color))+.2*smoothstep(0.0,0.5,length(color));\n color = vec3(1.,0.6,0.5)*mix(color*2., color*color*4.0, smoothstep(0.5,1.0,f0.x));\n fragColor = vec4(color, alpha);\n#endif\n}"},541:(e,t,r)=>{e.exports=r(1765)+"\n"+r(4950)+"\n"+r(905)+"\n\nfloat fbm(in vec2 x, in int octaves, in vec2 period, float seed) {\n\tfloat v = 0.0, a = 1.0;\n\tvec2 shift = vec2(100);\n const mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\n\tfor(int i = 0; i < octaves; ++i){\n\t\tv += 0.5 * a * noise2D(x * period, period,seed);\n x += shift;\n shift = rot * shift;\n\t\ta *= 0.5;\n period *= 2.0;\n\t}\n\treturn v;\n}\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n#if defined(WRAP)\n float f0 = smoothstep(0.2,1.0,fbm(vec2(0.0, uv.x), 4, vec2(1e3,12),0.0));\n float f1 = smoothstep(0.2,1.0,fbm(vec2(0.1, uv.x), 4, vec2(1e3,8),0.0));\n float alpha = 0.5 * smoothstep(0.0, 1.0, 1.5*f0 + uv.y);\n alpha += 0.5 * smoothstep(0.0, 1.0,f1*f1 + uv.y);\n#elif defined(GROUND)\n float f0 = fbm(uv,8,vec2(3,6),0.0);\n float f1 = fbm(uv + 0.3*f0,4,vec2(4,8),0.0);\n float alpha = smoothstep(1.0,mix(0.0,-4.0,f1),uv.x -f0 + 2.0*pow(abs(uv.y),2.0));\n float angle = abs(atan(uv.y,uv.x+1.5)/TAU);\n alpha *= smoothstep(0.2,0.0,angle) * smoothstep(-1.0,-0.5,uv.x);\n#else\n float f0 = fbm(vec2(0.0, uv.y), 8, vec2(4.0), 0.0);\n float f1 = fbm(vec2(0.0, uv.y), 4, vec2(16.0), 0.0);\n float alpha = smoothstep(1.0,mix(0.9,-2.0,f0),uv.x - 0.2*f1 + 2.0*pow(abs(uv.y),2.0)) * pow(1.0-abs(uv.y),2.0);\n#endif\n \n fragColor = uColor * alpha;\n}"},655:(e,t,r)=>{e.exports=r(1765)+"\n"+r(5404)+"\n"+r(4950)+"\n"+r(905)+"\n\nfloat fbm(in vec2 p, in vec2 period, int octaves, float seed){\t\n\tfloat a=.5,v=0.;\n\tfor(int i=1;i<octaves;i++){\n\t\tv += a*abs(noise2D(p * period, period, seed)*2.-1.);\n\t\ta*=.5; period*=2.;\n\t}\n\treturn v;\n}\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n vec2 uvp = polar(uv);\n \n float r0 = fbm(uvp,vec2(1,2),4,0.0);\n uvp.x += 1.0 * r0;\n uv = cartesian(uvp);\n\n vec2 basis = vec2(fbm(uv-0.1,vec2(2),4,0.0), fbm(uv+0.1,vec2(2),4,0.0));\n uv += (basis-.5);\n float f0 = fbm(uv*rotate(basis.x - basis.y), vec2(2),4,0.0);\n \n f0 *= abs(uvp.y-0.5)*2.;\n f0 = mix(0.01 / f0, 0.1 / f0, f0);\n f0 *= smoothstep(1.0,0.5,uvp.y);\n float alpha = f0;\n \n fragColor = uColor * alpha;\n}"},1934:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = 2.*vUV-1.;\n\n float alpha = pow(.5-.5*cos(smoothstep(0.2,1.0,length(uv))*TAU),2.0);\n\n fragColor = uColor * alpha;\n}"},7349:(e,t,r)=>{e.exports="#version 300 es\nprecision highp float;\nin vec2 vUV;\nin vec3 vOrigin;\nin vec3 vRay;\nlayout(location=0) out vec4 fragAlbedo;\nlayout(location=1) out vec4 fragNormal;\nlayout(location=2) out vec4 fragPosition;\n\nuniform GlobalUniforms {\n vec4 uTime;\n};\nuniform CameraUniforms {\n mat4 uViewProjectionMatrix;\n mat4 uProjectionMatrix;\n mat4 uViewMatrix;\n vec3 uEyePosition;\n};\nuniform float uLayer;\nuniform vec4 uFogColor;\nuniform vec3 uSkyColor;\n\n"+r(1287)+"\n"+r(905)+"\nfloat fbm(vec3 p, int octaves, float scale, float offset){\n const mat3 m = mat3( 0.00, 0.80, 0.60,\n -0.80, 0.36, -0.48,\n -0.60, -0.48, 0.64 );\n float f = 0.0, a = 0.5, s = 0.0;\n for(int i = 0; i < octaves; ++i){\n s += a;\n f += a*abs(noise3D(p)*scale-offset);\n p = m*p*2.02;\n a *= 0.5;\n }\n return f/s;\n}\n\nvec3 sky(in vec3 ray){\n const vec3 sun = normalize(vec3(0,1,0.5));\n\n ray.y = max(ray.y, 0.);\n\n vec3 color = vec3(0);\n color += vec3(.4,.1,.3) * dot(ray,vec3(0,1,0));\n \n float f0 = fbm(ray * 10.0 + vec3(0,0,1)*uTime.x*0.1, 4,2.,1.);\n float f1 = fbm(ray * 8.0 + f0, 2,1.,0.);\n \n color += vec3(1.0,0.8,0.8) * (f1 * f1 - 0.2 * f0) * ray.y;\n color += vec3(1.4,1.2,1.0) * pow(max(0.,dot(ray, sun)),16.);\n return color * color;\n}\n\nvoid main(){\n vec3 position = vOrigin + vRay;\n vec3 ray = normalize(vRay);\n gl_FragDepth = gl_DepthRange.far;\n fragPosition = vec4(position - uEyePosition,uLayer);\n fragNormal = vec4(-ray*0.0,0);\n\n float rayDotUp = max(0.0,dot(vec3(0,1,0),ray));\n vec3 color = mix(uFogColor.rgb, sky(ray), rayDotUp);\n fragAlbedo = vec4(color,0.5);\n}"},6795:(e,t,r)=>{e.exports=r(1765)+"\n\nfloat hash21(in vec2 src) {\n const uint M = 0x5bd1e995u;\n uint h = 1190494759u;\n uvec2 v = floatBitsToUint(src); \n v *= M; v ^= v>>24u; v *= M;\n h *= M; h ^= v.x; h *= M; h ^= v.y;\n h ^= h>>13u; h *= M; h ^= h>>15u;\n return uintBitsToFloat(h & 0x007fffffu | 0x3f800000u) - 1.0;\n}\n\nvec4 rectangularNoise(in vec2 uv, in vec2 period){\n uv *= period;\n vec2 i = floor(uv);\n vec2 f = uv - i;\n vec2 c = vec2(0);\n int o = int(i.x+i.y) & 1;\n int u = o ^ 1;\n bool s = f[o]>hash21(mod(i,period));\n if(s) c[o] = 1.;\n vec2 n = i;\n n[o] += s ? 1. : -1.;\n if(f[u]>hash21(mod(n,period))) c[u] = 1.;\n c = i+c;\n\n vec4 d = vec4(\n hash21(mod(c + vec2(-1,-1), period)), \n hash21(mod(c + vec2( 0,-1), period)), \n hash21(mod(c + vec2( 0, 0), period)), \n \thash21(mod(c + vec2(-1, 0), period))\n );\n o = int(c.x+c.y) & 1;\n if(o==1) d = d.wxyz;\n d = d + vec4(c-1.,c);\n return d;\n}\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = vUV;\n float alpha = 0.0; float alpha2 = 0.0;\n float scale = 24.0;\n uv.y += 0.2;\n const int iterations = 4;\n for(int i = 0; i < iterations; i++){\n vec4 v = rectangularNoise(uv, vec2(scale));\n float y = floor(0.5+uv.y*scale/8.0)*8.0;\n \n alpha += smoothstep(0.5,0.0,min(abs(y-v.y),abs(v.w-y)));\n alpha2 += smoothstep(0.0,0.5,min(y-v.y,v.w-y));\n uv.y += 1.0 / scale;\n uv.x += sin(y + float(i+1));\n }\n alpha*=1.5/float(iterations);\n alpha2*=2.0/float(iterations);\n fragColor = uColor * vec4(alpha,alpha2,alpha,alpha);\n}"},6047:e=>{e.exports="#version 300 es\nprecision highp float;\nin vec2 vUV;\nout vec4 fragColor;\n\n#define RESOLUTION 1.0\n#define TAU 6.283185307179586\n#define PI 3.141592653589793\n\nuvec2 wrap2(in vec2 v, float period){return uvec2(v-period*floor(v/period));}\nuvec3 wrap2(in vec3 v, float period){return uvec3(v-period*floor(v/period));}\nuint hash(uint x){\n x = (x^(x>>16))*0x7feb352dU;\n x = (x^(x>>15))*0x846ca68bU;\n return (x^(x>>16));\n}\nvec2 hash22(uvec2 v){\n uint n = v.x*1597334677U^v.y*3812015801U;\n n = hash(n);\n return vec2(n*uvec2(0x1U,0x3fffU))*(1.0/float(0xffffffffU));\n}\nfloat hash21(uvec2 v){\n uint n = v.x*1597334677U^v.y*3812015801U;\n n = hash(n);\n return float(n)*(1.0/float(0xffffffffU));\n}\nfloat hash31(uvec3 v){\n uint n = v.x*1597334677U^v.y*3812015801U^v.z*3299493293U;\n n = hash(n);\n return float(n)*(1.0/float(0xffffffffU));\n}\n\nvec3 voronoi3(in vec2 uv, in float period, out vec4 center){\n vec2 n = floor(uv);\n vec2 f = fract(uv);\n vec4 mc = vec4(0.0);\n vec3 md = vec3(8.0);\n\n for(int j=-1;j<=1;j++)\n for(int i=-1;i<=1;i++){\n vec2 g = vec2(i, j);\n vec2 r = g - f + hash22(wrap2(n + g, period)) * 0.8;\n float d = abs(r.x)+abs(r.y);\n if(d < md.x){\n md.z = md.y;\n md.y = md.x;\n md.x = d;\n mc.zw = mc.xy;\n mc.xy = n + g;\n }else if(d < md.y){\n md.z = md.y;\n md.y = d;\n mc.zw = n + g;\n }else if(d < md.z){\n md.z = d;\n }\n }\n center = mc;\n return md;\n}\n\nfloat cubicPulse(float c, float w, float x){\n x = abs(x-c)/w;return step(x,1.0)*(1.0-x*x*(3.0-2.0*x));\n}\n\nuniform vec2 uScreenSize;\nuniform float uTime;\n\nvoid main(){\n vec2 uv = vUV * RESOLUTION;\n float t = .5+.5*cos(TAU * (uv.x - uTime));\n uv = vec2(uv.x+uv.y,uv.x-uv.y);\n float width = 0.6, scale = 8.0;\n\n vec4 cellCenters;\n vec3 vr = voronoi3(uv * scale, scale * RESOLUTION, cellCenters);\n float d = max(width + vr.y - vr.z, vr.y - vr.x);\n \n float h0 = hash21(wrap2(cellCenters.xy, scale * RESOLUTION));\n float h1 = hash21(wrap2(cellCenters.zw, scale * RESOLUTION));\n \n\tfloat wire = cubicPulse(width, 0.06, d);\n wire += step(0.0, h0 - h1) * cubicPulse(width-0.1, 0.06, d);\n wire += step(0.5, h0 - h1) * cubicPulse(width-0.2, 0.06, d);\n \n vec3 color = vec3(0.12,0.28,0.36) +\n wire * vec3(0.1,0.5,0.4) +\n vr.x * vec3(0,0.42,0.38) +\n t*(h0*h1) * vec3(0.0,0.4,0.3) +\n t*t*(wire+0.2*vr.y*vr.z+0.4*vr.x) * vec3(0.5,0.6,0.5);\n\n fragColor = vec4(color,.5+.5*color.b);\n}"},7188:e=>{e.exports="#version 300 es\nprecision highp float;\nin vec2 vUV;\nout vec4 fragColor;\n\nuniform vec2 uScreenSize;\n\n#define TAU 6.283185307179586\n#define RESOLUTION 1.0\n#define MAP_SCALE 10.0\n\nvec2 hash22(ivec2 iv, float period){\n vec2 p = mod(vec2(iv), period * RESOLUTION);\n return fract(vec2(2097152, 262144)*sin(dot(p, vec2(113, 1))))*2.-1.;\n}\nmat2 rotate(in float a){float c=cos(a),s=sin(a);return mat2(c,s,-s,c);}\nfloat gradN2D(in vec2 value, float period){ \n const ivec2 ie = ivec2(0, 1);\n const vec2 fe = vec2(0, 1);\n ivec2 p = ivec2(floor(value));\n vec2 f = fract(value);\n vec2 w = f*f*(3. - 2.*f); \n float c = mix(mix(dot(hash22(p + ie.xx,period), f - fe.xx), dot(hash22(p + ie.yx,period), f - fe.yx), w.x),\n mix(dot(hash22(p + ie.xy,period), f - fe.xy), dot(hash22(p + ie.yy,period), f - fe.yy), w.x), w.y);\n return c*.5 + .5;\n}\nfloat stripes(float x, float offset){\n x = 2.*abs(fract(x/6.283185307179586+offset-.25)-.5);\n float x2 = clamp(x*x*(2.*x-1.),0.,1.);\n return mix(smoothstep(0.,1.,x),x2,0.15);\n}\nfloat sandLayer(vec2 p, float lines){\n vec2 q = rotate(atan(1.0/lines,1.0))*p;\n q.y += (gradN2D(p*18.,18.0) - .5)*.05;\n float grad1 = stripes(q.y*lines*TAU, 0.);\n \n q = rotate(-atan(1.0/lines,1.0))*p;\n q.y += (gradN2D(p*12.,12.0) - .5)*.05;\n float grad2 = stripes(q.y*lines*TAU, .5);\n \n q = vec2(p.x+p.y,-p.x+p.y);\n \n float a2 = dot(sin(q*2.*TAU - cos(q.yx*2.*TAU)), vec2(.25)) + .5;\n float a1 = 1. - a2;\n \n float c = 1. - (1. - grad1*a1)*(1. - grad2*a2);\n return c;\n}\n\nvec3 calculateNormal(in float height){\n float dhdx = dFdx(height) * uScreenSize.x;\n float dhdy = dFdy(height) * uScreenSize.y;\n vec3 normal = normalize(vec3(-dhdx, -dhdy, 1));\n return 0.5+0.5*normal;\n}\n\nvoid main(){\n vec2 uv = vUV * RESOLUTION;\n float layer0 = sandLayer(uv, 10.);\n float layer1 = sandLayer(uv + gradN2D(uv*7.,7.)*.2, 7.);\n float height = mix(layer0, layer1, smoothstep(.1,.9, gradN2D(uv*2.0+128.0,2.0)));\n\n float fbm0 = gradN2D(uv.yx*16.,16.)*.5+gradN2D(uv.yx*32.,32.)*.3+gradN2D(uv.yx*64.,64.)*.2;\n height += 0.1*(fbm0*2.-1.);\n height *= 0.16;\n\n fragColor = vec4(calculateNormal(height / MAP_SCALE), height);\n}"},9467:e=>{e.exports="#version 300 es\nprecision highp float;\nin vec2 vUV;\nout vec4 fragColor;\n\n#define TAU 6.283185307179586\n\nuvec2 wrap2(in vec2 v, in vec2 period){return uvec2(v-period*floor(v/period));}\nfloat hash21(in uvec2 v){\n uint n = v.x*1597334677U^v.y*3812015801U;\n\tn = (n << 13U) ^ n;\n n = n * (n * n * 15731U + 789221U) + 1376312589U;\n return float( n & uvec3(0x7fffffffU))/float(0x7fffffff);\n}\nfloat noise2D(in vec2 p, in vec2 period){\n const vec2 e = vec2(0,1);\n vec2 f = fract(p);\n p = floor(p);\n f = f*f*(3.0-2.0*f);\n return mix(mix(hash21(wrap2(p+e.xx, period)),\n\t\t\t\t hash21(wrap2(p+e.yx, period)), f.x),\n\t\t\t\tmix(hash21(wrap2(p+e.xy, period)),\n\t\t\t\t\thash21(wrap2(p+e.yy, period)), f.x), f.y);\n}\nfloat hatch(in vec2 uv, in float period, in int strength){\n float rz=1.,st=float(strength)*0.1;\n const vec2 s = vec2(1,20);\n for(int i=0;i<=strength;i++){\n uv.x += uv.y;\n float g = noise2D(s*uv,s*period);\n g = smoothstep(0.5,1.0,g);\n rz = rz+g; //min(1.-g,rz);\n uv.xy = uv.yx;\n uv += 128.767;\n }\n return rz;\n}\n\nuniform vec3 uColor;\nuniform float uScale;\n\nvoid main(){\n vec2 uv = vUV.yx;\n\n float h = hatch(uv*uScale,uScale,3);\n vec3 color = vec3(0.6,0.62,0.66);\n color += vec3(0.16,0.18,0.20) * smoothstep(0.0,3.0,h);\n color += vec3(0.1) * smoothstep(1.0,3.0,h);\n color += vec3(0.2) * smoothstep(2.0,3.0,h);\n \n color += 0.1*(cos(2.0*TAU*uv.y));\n color *= uColor;\n \t\n float roughness = mix(0.2,0.8,color.b);\n\tfragColor = vec4(color,.5*roughness);\n}"},10:(e,t,r)=>{e.exports=r(1765)+"\n"+r(4950)+"\n"+r(905)+"\n\nfloat fbm(in vec3 uv, in int octaves, in vec3 period){\n float total = 0.0, amplitude = 1.0;\n for(int i = 0; i < octaves; i++){\n total += .5*amplitude*noise3D(uv, period,0.);\n uv = uv*2.0 + 100.0 + uv.x;\n period *= 2.0;\n amplitude *= 0.5;\n }\n return total;\n}\n\nvoid main(){\n vec2 uv = vUV;\n vec3 scale = vec3(16.0, 4.0, 36.0);\n float f2 = fbm(uv.xyx*scale, 6, scale);\n scale = vec3(12.0, 8.0, 24.0);\n float f1 = fbm(uv.xyx*scale, 7, scale);\n\n\tfragColor = vec4(f1,f2,f1,f2);\n}"},3475:e=>{e.exports="#version 300 es\nprecision highp float;\nin vec2 vUV;\nout vec4 fragColor;\n\n#define TAU 6.283185307179586\nfloat hash21(in vec2 uv){\n uvec2 q = floatBitsToUint(uv);\n q = 1103515245u * ((q >> 1u) ^ q.yx);\n uint n = 1103515245u * (q.x ^ (q.y >> 3u));\n return float(n) * (1.0 / float(0xffffffffu));\n}\nfloat noise21(in vec2 uv, in vec2 period, float seed){\n uv *= period;\n vec4 i = mod(floor(uv).xyxy+vec2(0,1).xxyy,period.xyxy)+seed;\n vec2 f = fract(uv); f = f*f*f*(f*(f*6.0-15.0)+10.0);\n return mix(mix(hash21(i.xy), \n hash21(i.zy), f.x),\n mix(hash21(i.xw), \n hash21(i.zw), f.x), f.y);\n}\nfloat fbm(vec2 uv, vec2 frequency, int octaves, float shift, float gain, float lacunarity, float factor, float seed){\n uv *= frequency;\n vec2 offset = vec2(shift,0);\n float value = 0.0, amplitude = gain;\n vec2 sc = vec2(sin(shift), cos(shift)); mat2 rotate = mat2(sc.y,sc.x,-sc.x,sc.y);\n for(int i=0;i<octaves;i++){\n value += amplitude * (noise21(uv / frequency, frequency, seed)*2.-1.);\n uv = uv * lacunarity + offset * float(i+1);\n frequency *= lacunarity;\n amplitude = pow(amplitude * gain, factor);\n offset *= rotate;\n }\n return .5+.5*value;\n}\nfloat rfbm(vec2 uv, vec2 frequency, int octaves, float seed){\n uv *= frequency;\n float value = 0.0, amplitude = 0.5;\n for(int i=0;i<octaves;i++){\n float r = noise21(uv / frequency, frequency, seed)*2.-1.;\n value += amplitude * abs(r);\n uv += r;\n uv = uv * 2.0 + vec2(100) * float(i+1);\n frequency *= 2.0;\n amplitude *= 0.5;\n }\n return value;\n}\n\nuvec2 wrap2(in vec2 v, float period){return uvec2(v-period*floor(v/period));}\nfloat hash21(in uvec2 v){\n uint n = v.x*1597334677U^v.y*3812015801U;\n\tn = (n << 13U) ^ n;\n n = n * (n * n * 15731U + 789221U) + 1376312589U;\n return float( n & uvec3(0x7fffffffU))/float(0x7fffffff);\n}\nfloat noise2D(in vec2 p, in float period){\n const vec2 e = vec2(0,1);\n vec2 f = fract(p);\n p = floor(p);\n f = f*f*(3.0-2.0*f);\n return mix(mix(hash21(wrap2(p+e.xx, period)),\n\t\t\t\t hash21(wrap2(p+e.yx, period)), f.x),\n\t\t\t\tmix(hash21(wrap2(p+e.xy, period)),\n\t\t\t\t\thash21(wrap2(p+e.yy, period)), f.x), f.y);\n}\nfloat fbm(in vec2 uv, in float period, in int octaves){\n float value=0.0,amplitude=0.5;\n for(int i=0;i<octaves;i++){\n value += noise2D(uv, period) * amplitude;\n amplitude*=0.5;\n period*=2.0;\n uv*=2.0;\n }\n return value;\n}\nvec3 saturation(vec3 rgb, float adjustment){\n const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n vec3 intensity = vec3(dot(rgb, W));\n return mix(intensity, rgb, adjustment);\n}\n\nvoid main(){\n#if defined(RUST)\n vec2 uv = vUV.yx;\n float scale = 1.0;\n\tfloat f0 = fbm(uv*8.0*scale, 8.0*scale, 4);\n uv.x -= f0*0.5;\n float f1 = fbm(uv*16.0*scale + 128.0, 16.0*scale, 2);\n uv -= f0*f1;\n float f2 = fbm(uv*12.*scale + 256.0, 12.*scale, 4);\n \n vec3 color = vec3(0.4,0.3,0.3);\n color = mix(color, vec3(0.8,0.3,0.3), f0);\n color = mix(color, vec3(0.4,0.5,0.4), f1);\n color = mix(color, vec3(0.2,0.1,0.2), smoothstep(0.2,1.,f2));\n\t\n float roughness = 1.0-f1*f2;\n\tfragColor = vec4(color,.5*roughness);\n#elif defined(PIPE)\n vec2 uv = vUV;\n\n float f0 = 1.-2.*fbm(uv, vec2(8,12), 2, 0.0, 0.5, 2.0, 0.9, 0.);\n float f1 = .4+.6*rfbm(uv.yx + .6*f0, vec2(8,16), 6, 0.5);\n \n vec3 color = vec3(f1*f1*f1,f1*f1*(f1+0.5),f1*(f1+0.5));\n color -= vec3(f1*abs(f0));\n float roughness = mix(0.8, 0.4, color.r);\n color = mix((vec3(1.0,0.85,0.95)-color.bgr)*0.5, color.ggb, color.b*color.g);\n\n fragColor = vec4(color,.5*roughness);\n#else\n vec2 uv = vUV;\n\n float f0 = fbm(uv, vec2(4,8), 6, 0., 0.5, 2.0, 0.8, 0.);\n uv += vec2(1,0.2) * f0;\n float f1 = fbm(uv, vec2(4), 2, 100., 0.3, 1.4, 0.8, 0.);\n \n vec3 color = vec3(0.06,0,0.08);\n color += vec3(0.8*f1*f1,f1*f1,0.7*f1);\n color += 0.8 * vec3(f0*f0,f0*f1*f0,f0*f1);\n\t\n float roughness = mix(0.8, 0.4, smoothstep(0.2,0.5,f1*f0));\n\tfragColor = vec4(color,.5*roughness);\n#endif\n}"},9223:(e,t,r)=>{e.exports=r(1765)+"\n"+r(1287)+"\n"+r(905)+"\n\nuniform vec2 uScale;\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = vUV * uScale;\n\n float l3 = noise2D(512.0 * uv, 512. * uScale, 0.0);\n float l2 = noise2D(128.0 * uv, 128. * uScale, 0.0);\n float l1 = noise2D(32.0 * uv, 32. * uScale, 0.0);\n uv += 0.4*noise2D(16.0*uv.yx - l1 + 128.0, 16. * uScale, 0.0);\n float l0 = noise2D(8.0*uv,8. * uScale, 0.0);\n \n vec3 color = vec3(0.04,0.04,0.12)\n + vec3(0.63,0.55,0.42) * l0\n + vec3(0.2,0.1,0.1) * (1.0-l0*l1)\n + vec3(0.42,0.42,0.44) * l1\n + vec3(0.16,0.30,0.27) * l2\n + vec3(0.12,0.16,0.22) * (l3-1.0);\n color = 0.25 + 0.5 * color;\n\n float roughness = mix(0.8,1.0,color.g);\n fragColor = uColor * vec4(color,.5*roughness);\n}"},404:(e,t,r)=>{e.exports=r(1765)+"\n\nuniform vec4 uColor;\n\nvoid main(){\n fragColor = uColor;\n}"},1728:(e,t,r)=>{e.exports=r(1765)+"\n"+r(4950)+"\n"+r(905)+"\n\nfloat fbm(in vec2 x, in int octaves, in vec2 period) {\n\tfloat v = 0.0, a = 1.0;\n\tvec2 shift = vec2(100);\n const mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\n\tfor(int i = 0; i < octaves; ++i){\n\t\tv += 0.5 * a * noise2D(x / a, period * a, 0.0);\n x += shift;\n shift = rot * shift;\n\t\ta *= 0.5;\n\t}\n\treturn v;\n}\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = vUV;\n\n float fade = smoothstep(1.0,0.5,abs(uv.y*2.-1.));\n vec2 uv0 = vec2(uv.x+uv.y,uv.x-uv.y);\n\n uv0 += 0.2*(1.-2.*fbm(uv * vec2(4.0,2.0), 4, vec2(4.0,2.0)));\n uv.x += 0.6*(1.-2.*fbm(uv0 * vec2(4.0,16.0), 4, vec2(4.0,16.0)));\n \n float offset = sin(uv.x*TAU);\n offset -= sin(uv0.y * TAU * 2.0);\n offset += cos(uv0.x * TAU * 1.0);\n float l = .5+.5*cos(uv0.y*TAU*4.0 + offset);\n l = mix(l, pow(l, 8.0), smoothstep(0.5,1.0,abs(uv.y*2.-1.)));\n\n vec3 color = smoothstep(0.1,1.0,l) * fade * vec3(0.14,0.08,0.2) / (.08+1.0-l);\n color *= color.r;\n float alpha = color.r;\n\n fragColor = uColor * vec4(color, alpha);\n}"},2619:(e,t,r)=>{e.exports=r(1765)+"\n"+r(5404)+"\n\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = vUV;\n\n float line = .5+.5*cos(TAU*(4.0*uv.y+0.5));\n float l0 = 1.0/pow(1.0-line,0.2);\n float alpha = 0.4 * line * l0;\n\n fragColor = uColor * alpha;\n}"},229:e=>{e.exports="#version 300 es\nprecision highp float;\nin vec2 vUV;\nout vec4 fragColor;\n\n#define RESOLUTION 1.0\n#define TAU 6.283185307179586\n\nuvec2 wrap2(in vec2 v, float period){return uvec2(v-period*floor(v/period));}\nuint hash(uint x){\n x = (x^(x>>16))*0x7feb352dU;\n x = (x^(x>>15))*0x846ca68bU;\n return (x^(x>>16));\n}\nvec2 hash22(uvec2 v){\n uint n = v.x*1597334677U^v.y*3812015801U;\n n = hash(n);\n return vec2(n*uvec2(0x1U,0x3fffU))*(1.0/float(0xffffffffU));\n}\nfloat hash21(uvec2 v){\n uint n = v.x*1597334677U^v.y*3812015801U;\n n = hash(n);\n return float(n)*(1.0/float(0xffffffffU));\n}\nfloat gradN2D(in vec2 value, float period){ \n const vec2 ie = vec2(0, 1);\n vec2 p = floor(value);\n vec2 f = fract(value);\n vec2 w = f*f*(3. - 2.*f); \n return .5+.5*mix(mix(\n dot(hash22(wrap2(p + ie.xx,period)), f-ie.xx),\n dot(hash22(wrap2(p + ie.yx,period)), f-ie.yx), w.x),\n mix(dot(hash22(wrap2(p + ie.xy,period)), f-ie.xy),\n dot(hash22(wrap2(p + ie.yy,period)), f-ie.yy), w.x), w.y);\n}\n\nfloat fbm(in vec2 uv, in float period, in int octaves){\n float value = 0.0, scale = 1.0, weight = 0.0;\n for(int i=0;i<octaves;i++){\n float n = gradN2D(uv,period/scale);\n value += abs(1.-2.*n)*scale;\n weight += scale;\n scale *= 0.5;\n uv *= 2.0;\n }\n return value/weight;\n}\n\nfloat tile0(vec2 uv){\n return max(abs(uv.x),-uv.y);\n}\nfloat tile1(vec2 uv){\n return abs(min(uv.x, uv.y));\n}\nfloat tile2(vec2 uv){\n return abs(uv.x);\n}\nfloat tile3(vec2 uv){\n return min(abs(uv.x), max(-uv.x, abs(uv.y)));\n}\nfloat tile4(vec2 uv){\n return min(abs(uv.x), abs(uv.y));\n}\nfloat tileMap(in vec2 uv, in float period){\n int tile = 0;\n vec2 id = floor(uv);\n uv = fract(uv)-.5;\n if(hash21(wrap2(id, period)) >= .5)\n tile += 1;\n if(hash21(wrap2(-id, period)) >= .5)\n tile += 8;\n if(hash21(wrap2(id-vec2(0,1), period)) >= .5)\n tile += 4;\n if(hash21(wrap2(-id-vec2(1,0), period)) >= .5)\n tile += 2;\n switch(tile){\n case 0: return 0.5;\n case 1: return tile0(uv);\n case 2: return tile0(uv.yx);\n case 3: return tile1(uv);\n case 4: return tile0(vec2(uv.x,-uv.y));\n case 5: return tile2(uv);\n case 6: return tile1(vec2(uv.x,-uv.y));\n case 7: return tile3(uv);\n case 8: return tile0(vec2(uv.y,-uv.x));\n case 9: return tile1(vec2(-uv.x,uv.y));\n case 10: return tile2(uv.yx);\n case 11: return tile3(uv.yx);\n case 12: return tile1(vec2(-uv.x,-uv.y));\n case 13: return tile3(vec2(-uv.x, uv.y));\n case 14: return tile3(vec2(-uv.y, uv.x));\n case 15: return tile4(uv);\n }\n}\n\nuniform vec2 uScreenSize;\nuniform float uTime;\n\nvoid main(){\n vec2 uv = vUV * RESOLUTION;\n float scale = 8.0;\n \n float n = fbm(uv*scale, scale, 2);\n n *= .5+.5*cos(TAU * (n + uv.y - 0.5*uTime));\n \n float v = tileMap(uv*scale*2.0,scale*2.0);\n v += 0.25*(1.-2.*smoothstep(0.,0.3,n));\n \n vec3 color = vec3(0.1,0.3,0.2);\n color += smoothstep(0.,0.4, 0.4-v) * vec3(0.3,0.4,0.4);\n color += smoothstep(0.,0.8, 0.8-v) * vec3(0.3,0.5,0.4);\n color += smoothstep(0.05,.1, .1-abs(v-0.1)) * vec3(0.2,0.5,0.4);\n color += smoothstep(0.,.2, .1-abs(v-0.3)) * vec3(0.3,0.6,0.7);\n color += smoothstep(0.,0.1,n) * vec3(0.1,0.1,0.2);\n\n fragColor = vec4(color,.5+.5*smoothstep(0.5,1.0,color.b));\n}"},8371:(e,t,r)=>{e.exports=r(1765)+"\n"+r(1287)+"\n"+r(905)+"\n\nfloat fbm(in vec2 uv, in int octaves, in vec2 period){\n float value=0.0,amplitude=0.5;\n for(int i=0;i<octaves;i++){\n value += amplitude * noise2D(uv * period, period, 0.0);\n amplitude*=0.5;\n period*=2.0;\n }\n return value;\n}\n\nuniform vec2 uScale;\nuniform vec4 uColor;\n\nvoid main(){\n vec2 uv = vUV;\n\tfloat f0 = fbm(uv, 4, 18.0*uScale);\n float f1 = fbm(uv + vec2(f0*2.-1.,0), 4, 12.0*uScale);\n \n vec3 color = vec3(0.7,0.65,0.6);\n color = mix(color, vec3(0.2,0.1,0.1), f0);\n color = mix(2.0 * color * color, vec3(0), f1);\n float roughness = min(1.0,.5+f0*f1);\n\n fragColor = uColor * vec4(color,.5*roughness);\n}"}},t={};!function r(i){var a=t[i];if(void 0!==a)return a.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,r),n.exports}(9844)})();